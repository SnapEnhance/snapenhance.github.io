<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: ff menu bar (#59) - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/ab8c4ddb665961961bd6629ace762f0bd67e8675.html">ab8c4ddb665961961bd6629ace762f0bd67e8675</a>
<b>parent</b> <a href="../commit/bbfc0a835074a44f770ca85a9a3857e8b5a1f4c7.html">bbfc0a835074a44f770ca85a9a3857e8b5a1f4c7</a>
<b>Author:</b> auth &lt;<a href="mailto:64337177+authorisation@users.noreply.github.com">64337177+authorisation@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sun, 11 Jun 2023 01:10:24 +0200

feat: ff menu bar (#59)

fix: amoled dark mode

Co-authored-by: rhunk &lt;101876869+rhunk@users.noreply.github.com&gt;
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></td><td> | </td><td class="num">36</td><td><span class="i">+++++++++++++++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt</a></td><td> | </td><td class="num">39</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt</a></td><td> | </td><td class="num">99</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a></td><td> | </td><td class="num">67</td><td><span class="i">+++++++++++++++++++++++++++</span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">251</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/OperaContextActionMenu.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a></td><td> | </td><td class="num">46</td><td><span class="i">+++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
</table></pre><pre>9 files changed, 378 insertions(+), 178 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a> b/<a href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -69,7 +69,10 @@
</a>         &quot;picture_resolution&quot;: &quot;Override Picture Resolution&quot;,
         &quot;force_highest_frame_rate&quot;: &quot;Force Highest Frame Rate&quot;,
         &quot;force_camera_source_encoding&quot;: &quot;Force Camera Source Encoding&quot;,
<a href="#h0-0-3" id="h0-0-3" class="d">-        &quot;amoled_dark_mode&quot;: &quot;AMOLED Dark Mode&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+        &quot;amoled_dark_mode&quot;: &quot;AMOLED Dark Mode&quot;,
</a><a href="#h0-0-5" id="h0-0-5" class="i">+        &quot;enable_friend_feed_menu_bar&quot;: &quot;Enable New Friend Feed Menu Bar&quot;,
</a><a href="#h0-0-6" id="h0-0-6" class="i">+        &quot;friend_feed_menu_buttons&quot;: &quot;Friend Feed Menu Buttons&quot;,
</a><a href="#h0-0-7" id="h0-0-7" class="i">+        &quot;friend_feed_menu_buttons_position&quot;: &quot;Friend Feed Buttons Position Index&quot;
</a>     },
 
     &quot;option&quot;: {
<a href="#h0-1" id="h0-1" class="h">@@ -79,6 +82,12 @@
</a>                 &quot;snap&quot;: &quot;Show medias&quot;,
                 &quot;reply_button&quot;: &quot;Add reply button&quot;
             },
<a href="#h0-1-3" id="h0-1-3" class="i">+            &quot;friend_feed_menu_buttons&quot;: {
</a><a href="#h0-1-4" id="h0-1-4" class="i">+                &quot;auto_download_blacklist&quot;: &quot;\u2B07\uFE0F Auto Download Blacklist&quot;,
</a><a href="#h0-1-5" id="h0-1-5" class="i">+                &quot;anti_auto_save&quot;: &quot;\uD83D\uDCAC Anti Auto Save Messages&quot;,
</a><a href="#h0-1-6" id="h0-1-6" class="i">+                &quot;stealth_mode&quot;: &quot;\uD83D\uDC7B Stealth Mode&quot;,
</a><a href="#h0-1-7" id="h0-1-7" class="i">+                &quot;conversation_info&quot;: &quot;\uD83D\uDC64 Conversation Info&quot;
</a><a href="#h0-1-8" id="h0-1-8" class="i">+            },
</a>             &quot;download_options&quot;: {
                 &quot;format_user_folder&quot;: &quot;Create folder for each user&quot;,
                 &quot;format_hash&quot;: &quot;Add a unique hash to the file path&quot;,
<a href="#h0-2" id="h0-2" class="h">@@ -140,7 +149,7 @@
</a>     &quot;friend_menu_option&quot;: {
         &quot;preview&quot;: &quot;Preview&quot;,
         &quot;stealth_mode&quot;: &quot;Stealth Mode&quot;,
<a href="#h0-2-3" id="h0-2-3" class="d">-        &quot;anti_auto_download&quot;: &quot;Anti Auto Download&quot;,
</a><a href="#h0-2-4" id="h0-2-4" class="i">+        &quot;auto_download_blacklist&quot;: &quot;Auto Download Blacklist&quot;,
</a>         &quot;anti_auto_save&quot;: &quot;Anti Auto Save&quot;
     },
 
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -141,12 +141,6 @@ enum class ConfigProperty(
</a>         ConfigCategory.MEDIA_MANAGEMENT,
         ConfigStateValue(false)
     ),
<a href="#h1-0-3" id="h1-0-3" class="d">-    DOWNLOAD_BLACKLIST(
</a><a href="#h1-0-4" id="h1-0-4" class="d">-        &quot;property.auto_download_blacklist&quot;,
</a><a href="#h1-0-5" id="h1-0-5" class="d">-        &quot;description.auto_download_blacklist&quot;,
</a><a href="#h1-0-6" id="h1-0-6" class="d">-        ConfigCategory.MEDIA_MANAGEMENT,
</a><a href="#h1-0-7" id="h1-0-7" class="d">-        ConfigStateValue(false)
</a><a href="#h1-0-8" id="h1-0-8" class="d">-    ),
</a>     GALLERY_MEDIA_SEND_OVERRIDE(
         &quot;property.gallery_media_send_override&quot;,
         &quot;description.gallery_media_send_override&quot;,
<a href="#h1-1" id="h1-1" class="h">@@ -163,11 +157,6 @@ enum class ConfigProperty(
</a>             listOf(&quot;CHAT&quot;, &quot;SNAP&quot;, &quot;NOTE&quot;, &quot;EXTERNAL_MEDIA&quot;, &quot;STICKER&quot;)
         )
     ),
<a href="#h1-1-3" id="h1-1-3" class="d">-    ANTI_AUTO_SAVE(&quot;property.anti_auto_save&quot;,
</a><a href="#h1-1-4" id="h1-1-4" class="d">-        &quot;description.anti_auto_save&quot;,
</a><a href="#h1-1-5" id="h1-1-5" class="d">-        ConfigCategory.MEDIA_MANAGEMENT,
</a><a href="#h1-1-6" id="h1-1-6" class="d">-        ConfigStateValue(false)
</a><a href="#h1-1-7" id="h1-1-7" class="d">-    ),
</a> 
     FORCE_MEDIA_SOURCE_QUALITY(
         &quot;property.force_media_source_quality&quot;,
<a href="#h1-2" id="h1-2" class="h">@@ -177,6 +166,31 @@ enum class ConfigProperty(
</a>     ),
     
     //UI AND TWEAKS
<a href="#h1-2-3" id="h1-2-3" class="i">+    ENABLE_FRIEND_FEED_MENU_BAR(
</a><a href="#h1-2-4" id="h1-2-4" class="i">+        &quot;property.enable_friend_feed_menu_bar&quot;,
</a><a href="#h1-2-5" id="h1-2-5" class="i">+        &quot;description.enable_friend_feed_menu_bar&quot;,
</a><a href="#h1-2-6" id="h1-2-6" class="i">+        ConfigCategory.UI_TWEAKS,
</a><a href="#h1-2-7" id="h1-2-7" class="i">+        ConfigStateValue(false)
</a><a href="#h1-2-8" id="h1-2-8" class="i">+    ),
</a><a href="#h1-2-9" id="h1-2-9" class="i">+    FRIEND_FEED_MENU_BUTTONS(
</a><a href="#h1-2-10" id="h1-2-10" class="i">+        &quot;property.friend_feed_menu_buttons&quot;,
</a><a href="#h1-2-11" id="h1-2-11" class="i">+        &quot;description.friend_feed_menu_buttons&quot;,
</a><a href="#h1-2-12" id="h1-2-12" class="i">+        ConfigCategory.UI_TWEAKS,
</a><a href="#h1-2-13" id="h1-2-13" class="i">+        ConfigStateListValue(
</a><a href="#h1-2-14" id="h1-2-14" class="i">+            listOf(&quot;auto_download_blacklist&quot;, &quot;anti_auto_save&quot;, &quot;stealth_mode&quot;, &quot;conversation_info&quot;),
</a><a href="#h1-2-15" id="h1-2-15" class="i">+            mutableMapOf(
</a><a href="#h1-2-16" id="h1-2-16" class="i">+                &quot;auto_download_blacklist&quot; to false,
</a><a href="#h1-2-17" id="h1-2-17" class="i">+                &quot;anti_auto_save&quot; to false,
</a><a href="#h1-2-18" id="h1-2-18" class="i">+                &quot;stealth_mode&quot; to true,
</a><a href="#h1-2-19" id="h1-2-19" class="i">+                &quot;conversation_info&quot; to true
</a><a href="#h1-2-20" id="h1-2-20" class="i">+            )
</a><a href="#h1-2-21" id="h1-2-21" class="i">+        )
</a><a href="#h1-2-22" id="h1-2-22" class="i">+    ),
</a><a href="#h1-2-23" id="h1-2-23" class="i">+    FRIEND_FEED_MENU_POSITION(&quot;property.friend_feed_menu_buttons_position&quot;,
</a><a href="#h1-2-24" id="h1-2-24" class="i">+        &quot;description.friend_feed_menu_buttons_position&quot;,
</a><a href="#h1-2-25" id="h1-2-25" class="i">+        ConfigCategory.UI_TWEAKS,
</a><a href="#h1-2-26" id="h1-2-26" class="i">+        ConfigIntegerValue(1)
</a><a href="#h1-2-27" id="h1-2-27" class="i">+    ),
</a>     CAMERA_DISABLE(
         &quot;property.disable_camera&quot;,
         &quot;description.disable_camera&quot;,
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,38 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+package me.rhunk.snapenhance.data.wrapper.impl
</a><a href="#h2-0-1" id="h2-0-1" class="i">+
</a><a href="#h2-0-2" id="h2-0-2" class="i">+import android.content.Context
</a><a href="#h2-0-3" id="h2-0-3" class="i">+import android.graphics.drawable.Drawable
</a><a href="#h2-0-4" id="h2-0-4" class="i">+import android.util.AttributeSet
</a><a href="#h2-0-5" id="h2-0-5" class="i">+import android.view.View
</a><a href="#h2-0-6" id="h2-0-6" class="i">+import me.rhunk.snapenhance.SnapEnhance
</a><a href="#h2-0-7" id="h2-0-7" class="i">+import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
</a><a href="#h2-0-8" id="h2-0-8" class="i">+
</a><a href="#h2-0-9" id="h2-0-9" class="i">+class FriendActionButton(
</a><a href="#h2-0-10" id="h2-0-10" class="i">+    obj: View
</a><a href="#h2-0-11" id="h2-0-11" class="i">+) : AbstractWrapper(obj) {
</a><a href="#h2-0-12" id="h2-0-12" class="i">+    private val iconDrawableContainer by lazy {
</a><a href="#h2-0-13" id="h2-0-13" class="i">+        instanceNonNull().javaClass.declaredFields.first { it.type != Int::class.javaPrimitiveType }[instanceNonNull()]
</a><a href="#h2-0-14" id="h2-0-14" class="i">+    }
</a><a href="#h2-0-15" id="h2-0-15" class="i">+
</a><a href="#h2-0-16" id="h2-0-16" class="i">+    private val setIconDrawableMethod by lazy {
</a><a href="#h2-0-17" id="h2-0-17" class="i">+        iconDrawableContainer.javaClass.declaredMethods.first {
</a><a href="#h2-0-18" id="h2-0-18" class="i">+            it.parameterTypes.size == 1 &amp;&amp;
</a><a href="#h2-0-19" id="h2-0-19" class="i">+                    it.parameterTypes[0] == Drawable::class.java &amp;&amp;
</a><a href="#h2-0-20" id="h2-0-20" class="i">+                    it.name != &quot;invalidateDrawable&quot; &amp;&amp;
</a><a href="#h2-0-21" id="h2-0-21" class="i">+                    it.returnType == Void::class.javaPrimitiveType
</a><a href="#h2-0-22" id="h2-0-22" class="i">+        }
</a><a href="#h2-0-23" id="h2-0-23" class="i">+    }
</a><a href="#h2-0-24" id="h2-0-24" class="i">+
</a><a href="#h2-0-25" id="h2-0-25" class="i">+    fun setIconDrawable(drawable: Drawable) {
</a><a href="#h2-0-26" id="h2-0-26" class="i">+        setIconDrawableMethod.invoke(iconDrawableContainer, drawable)
</a><a href="#h2-0-27" id="h2-0-27" class="i">+    }
</a><a href="#h2-0-28" id="h2-0-28" class="i">+
</a><a href="#h2-0-29" id="h2-0-29" class="i">+    companion object {
</a><a href="#h2-0-30" id="h2-0-30" class="i">+        fun new(context: Context): FriendActionButton {
</a><a href="#h2-0-31" id="h2-0-31" class="i">+            val instance = SnapEnhance.classLoader.loadClass(&quot;com.snap.profile.shared.view.FriendActionButton&quot;)
</a><a href="#h2-0-32" id="h2-0-32" class="i">+                .getConstructor(Context::class.java, AttributeSet::class.java)
</a><a href="#h2-0-33" id="h2-0-33" class="i">+                .newInstance(context, null) as View
</a><a href="#h2-0-34" id="h2-0-34" class="i">+            return FriendActionButton(instance)
</a><a href="#h2-0-35" id="h2-0-35" class="i">+        }
</a><a href="#h2-0-36" id="h2-0-36" class="i">+    }
</a><a href="#h2-0-37" id="h2-0-37" class="i">+}</a><a href="#h2-0-38" id="h2-0-38" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -36,7 +36,8 @@ class AmoledDarkMode : Feature(&quot;Amoled Dark Mode&quot;, loadParams = FeatureLoadParam
</a>                 getAttribute(&quot;sigColorTextPrimary&quot;) -&gt; {
                     ephemeralHook(&quot;getColor&quot;, 0xFFFFFFFF.toInt())
                 }
<a href="#h3-0-3" id="h3-0-3" class="d">-                getAttribute(&quot;sigColorBackgroundMain&quot;) -&gt; {
</a><a href="#h3-0-4" id="h3-0-4" class="i">+                getAttribute(&quot;sigColorBackgroundMain&quot;),
</a><a href="#h3-0-5" id="h3-0-5" class="i">+                getAttribute(&quot;sigColorBackgroundSurface&quot;) -&gt; {
</a>                     ephemeralHook(&quot;getColor&quot;, 0xFF000000.toInt())
                 }
                 getAttribute(&quot;actionSheetBackgroundDrawable&quot;),
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -3,8 +3,11 @@ package me.rhunk.snapenhance.features.impl.ui.menus
</a> import android.annotation.SuppressLint
 import android.content.res.ColorStateList
 import android.graphics.Color
<a href="#h4-0-3" id="h4-0-3" class="i">+import android.graphics.drawable.ColorDrawable
</a><a href="#h4-0-4" id="h4-0-4" class="i">+import android.graphics.drawable.Drawable
</a><a href="#h4-0-5" id="h4-0-5" class="i">+import android.graphics.drawable.ShapeDrawable
</a><a href="#h4-0-6" id="h4-0-6" class="i">+import android.graphics.drawable.StateListDrawable
</a> import android.view.Gravity
<a href="#h4-0-8" id="h4-0-8" class="d">-import android.view.MotionEvent
</a> import android.view.View
 import android.widget.Switch
 import android.widget.TextView
<a href="#h4-1" id="h4-1" class="h">@@ -14,65 +17,77 @@ object ViewAppearanceHelper {
</a>     @SuppressLint(&quot;UseSwitchCompatOrMaterialCode&quot;, &quot;RtlHardcoded&quot;, &quot;DiscouragedApi&quot;,
         &quot;ClickableViewAccessibility&quot;
     )
<a href="#h4-1-3" id="h4-1-3" class="d">-    fun applyTheme(viewModel: View, view: TextView) {
</a><a href="#h4-1-4" id="h4-1-4" class="d">-        val sigColorTextPrimary = viewModel.context.theme.obtainStyledAttributes(
</a><a href="#h4-1-5" id="h4-1-5" class="d">-            intArrayOf(viewModel.resources.getIdentifier(&quot;sigColorTextPrimary&quot;, &quot;attr&quot;, Constants.SNAPCHAT_PACKAGE_NAME))
</a><a href="#h4-1-6" id="h4-1-6" class="d">-        ).getColor(0, 0)
</a><a href="#h4-1-7" id="h4-1-7" class="i">+    private var sigColorTextPrimary: Int = 0
</a><a href="#h4-1-8" id="h4-1-8" class="i">+    private var sigColorBackgroundSurface: Int = 0
</a> 
<a href="#h4-1-10" id="h4-1-10" class="d">-        val sigColorBackgroundMain = viewModel.context.theme.obtainStyledAttributes(
</a><a href="#h4-1-11" id="h4-1-11" class="d">-            intArrayOf(viewModel.resources.getIdentifier(&quot;sigColorBackgroundMain&quot;, &quot;attr&quot;, Constants.SNAPCHAT_PACKAGE_NAME))
</a><a href="#h4-1-12" id="h4-1-12" class="d">-        ).getColor(0, 0)
</a><a href="#h4-1-13" id="h4-1-13" class="i">+    private fun createRoundedBackground(color: Int, hasRadius: Boolean): Drawable {
</a><a href="#h4-1-14" id="h4-1-14" class="i">+        if (!hasRadius) return ColorDrawable(color)
</a><a href="#h4-1-15" id="h4-1-15" class="i">+        //FIXME: hardcoded radius
</a><a href="#h4-1-16" id="h4-1-16" class="i">+        return ShapeDrawable().apply {
</a><a href="#h4-1-17" id="h4-1-17" class="i">+            paint.color = color
</a><a href="#h4-1-18" id="h4-1-18" class="i">+            shape = android.graphics.drawable.shapes.RoundRectShape(
</a><a href="#h4-1-19" id="h4-1-19" class="i">+                floatArrayOf(20f, 20f, 20f, 20f, 20f, 20f, 20f, 20f),
</a><a href="#h4-1-20" id="h4-1-20" class="i">+                null,
</a><a href="#h4-1-21" id="h4-1-21" class="i">+                null
</a><a href="#h4-1-22" id="h4-1-22" class="i">+            )
</a><a href="#h4-1-23" id="h4-1-23" class="i">+        }
</a><a href="#h4-1-24" id="h4-1-24" class="i">+    }
</a> 
<a href="#h4-1-26" id="h4-1-26" class="d">-        val snapchatFontResId = view.context.resources.getIdentifier(&quot;avenir_next_medium&quot;, &quot;font&quot;, &quot;com.snapchat.android&quot;)
</a><a href="#h4-1-27" id="h4-1-27" class="d">-        //remove the shadow
</a><a href="#h4-1-28" id="h4-1-28" class="d">-        view.setBackgroundColor(sigColorBackgroundMain)
</a><a href="#h4-1-29" id="h4-1-29" class="d">-        view.setTextColor(sigColorTextPrimary)
</a><a href="#h4-1-30" id="h4-1-30" class="d">-        view.setShadowLayer(0F, 0F, 0F, 0)
</a><a href="#h4-1-31" id="h4-1-31" class="d">-        view.outlineProvider = null
</a><a href="#h4-1-32" id="h4-1-32" class="d">-        view.gravity = Gravity.LEFT or Gravity.CENTER_VERTICAL
</a><a href="#h4-1-33" id="h4-1-33" class="d">-        view.width = viewModel.width
</a><a href="#h4-1-34" id="h4-1-34" class="i">+    @SuppressLint(&quot;DiscouragedApi&quot;)
</a><a href="#h4-1-35" id="h4-1-35" class="i">+    fun applyTheme(component: View, componentWidth: Int? = null, hasRadius: Boolean = false) {
</a><a href="#h4-1-36" id="h4-1-36" class="i">+        val resources = component.context.resources
</a><a href="#h4-1-37" id="h4-1-37" class="i">+        if (sigColorBackgroundSurface == 0 || sigColorTextPrimary == 0) {
</a><a href="#h4-1-38" id="h4-1-38" class="i">+            with(component.context.theme) {
</a><a href="#h4-1-39" id="h4-1-39" class="i">+                sigColorTextPrimary = obtainStyledAttributes(
</a><a href="#h4-1-40" id="h4-1-40" class="i">+                    intArrayOf(resources.getIdentifier(&quot;sigColorTextPrimary&quot;, &quot;attr&quot;, Constants.SNAPCHAT_PACKAGE_NAME))
</a><a href="#h4-1-41" id="h4-1-41" class="i">+                ).getColor(0, 0)
</a> 
<a href="#h4-1-43" id="h4-1-43" class="d">-        //DPI Calculator
</a><a href="#h4-1-44" id="h4-1-44" class="d">-        val scalingFactor = view.context.resources.displayMetrics.densityDpi.toDouble() / 400
</a><a href="#h4-1-45" id="h4-1-45" class="d">-        view.height = (150 * scalingFactor).toInt()
</a><a href="#h4-1-46" id="h4-1-46" class="d">-        view.setPadding((40 * scalingFactor).toInt(), 0, (40 * scalingFactor).toInt(), 0)
</a><a href="#h4-1-47" id="h4-1-47" class="d">-        view.isAllCaps = false
</a><a href="#h4-1-48" id="h4-1-48" class="d">-        view.textSize = 16f
</a><a href="#h4-1-49" id="h4-1-49" class="d">-        view.typeface = view.context.resources.getFont(snapchatFontResId)
</a><a href="#h4-1-50" id="h4-1-50" class="d">-        
</a><a href="#h4-1-51" id="h4-1-51" class="d">-        //FIXME: wrong color, shouldn&#39;t be that much noticeable though
</a><a href="#h4-1-52" id="h4-1-52" class="d">-        view.setOnTouchListener { _, event -&gt;
</a><a href="#h4-1-53" id="h4-1-53" class="d">-            when (event.action) {
</a><a href="#h4-1-54" id="h4-1-54" class="d">-                MotionEvent.ACTION_DOWN -&gt; {
</a><a href="#h4-1-55" id="h4-1-55" class="d">-                    view.setBackgroundColor(0x5395026)
</a><a href="#h4-1-56" id="h4-1-56" class="d">-                }
</a><a href="#h4-1-57" id="h4-1-57" class="d">-                MotionEvent.ACTION_UP, MotionEvent.ACTION_CANCEL -&gt; {
</a><a href="#h4-1-58" id="h4-1-58" class="d">-                    view.setBackgroundColor(sigColorBackgroundMain)
</a><a href="#h4-1-59" id="h4-1-59" class="d">-                }
</a><a href="#h4-1-60" id="h4-1-60" class="i">+                sigColorBackgroundSurface = obtainStyledAttributes(
</a><a href="#h4-1-61" id="h4-1-61" class="i">+                    intArrayOf(resources.getIdentifier(&quot;sigColorBackgroundSurface&quot;, &quot;attr&quot;, Constants.SNAPCHAT_PACKAGE_NAME))
</a><a href="#h4-1-62" id="h4-1-62" class="i">+                ).getColor(0, 0)
</a>             }
<a href="#h4-1-64" id="h4-1-64" class="d">-            false
</a>         }
<a href="#h4-1-66" id="h4-1-66" class="d">-        
</a><a href="#h4-1-67" id="h4-1-67" class="d">-        if (view is Switch) {
</a><a href="#h4-1-68" id="h4-1-68" class="d">-            with(viewModel.resources) {
</a><a href="#h4-1-69" id="h4-1-69" class="d">-                view.switchMinWidth = getDimension(getIdentifier(&quot;v11_switch_min_width&quot;, &quot;dimen&quot;, Constants.SNAPCHAT_PACKAGE_NAME)).toInt()
</a><a href="#h4-1-70" id="h4-1-70" class="i">+
</a><a href="#h4-1-71" id="h4-1-71" class="i">+        val snapchatFontResId = resources.getIdentifier(&quot;avenir_next_medium&quot;, &quot;font&quot;, &quot;com.snapchat.android&quot;)
</a><a href="#h4-1-72" id="h4-1-72" class="i">+        val scalingFactor = resources.displayMetrics.densityDpi.toDouble() / 400
</a><a href="#h4-1-73" id="h4-1-73" class="i">+
</a><a href="#h4-1-74" id="h4-1-74" class="i">+        with(component) {
</a><a href="#h4-1-75" id="h4-1-75" class="i">+            if (this is TextView) {
</a><a href="#h4-1-76" id="h4-1-76" class="i">+                setTextColor(sigColorTextPrimary)
</a><a href="#h4-1-77" id="h4-1-77" class="i">+                setShadowLayer(0F, 0F, 0F, 0)
</a><a href="#h4-1-78" id="h4-1-78" class="i">+                gravity = Gravity.CENTER_VERTICAL
</a><a href="#h4-1-79" id="h4-1-79" class="i">+                componentWidth?.let { width = it}
</a><a href="#h4-1-80" id="h4-1-80" class="i">+                height = (150 * scalingFactor).toInt()
</a><a href="#h4-1-81" id="h4-1-81" class="i">+                isAllCaps = false
</a><a href="#h4-1-82" id="h4-1-82" class="i">+                textSize = 16f
</a><a href="#h4-1-83" id="h4-1-83" class="i">+                typeface = resources.getFont(snapchatFontResId)
</a><a href="#h4-1-84" id="h4-1-84" class="i">+                outlineProvider = null
</a><a href="#h4-1-85" id="h4-1-85" class="i">+                setPadding((40 * scalingFactor).toInt(), 0, (40 * scalingFactor).toInt(), 0)
</a><a href="#h4-1-86" id="h4-1-86" class="i">+            }
</a><a href="#h4-1-87" id="h4-1-87" class="i">+            background = StateListDrawable().apply {
</a><a href="#h4-1-88" id="h4-1-88" class="i">+                addState(intArrayOf(), createRoundedBackground(color = sigColorBackgroundSurface, hasRadius))
</a><a href="#h4-1-89" id="h4-1-89" class="i">+                addState(intArrayOf(android.R.attr.state_pressed), createRoundedBackground(color = 0x5395026, hasRadius))
</a><a href="#h4-1-90" id="h4-1-90" class="i">+            }
</a><a href="#h4-1-91" id="h4-1-91" class="i">+        }
</a><a href="#h4-1-92" id="h4-1-92" class="i">+
</a><a href="#h4-1-93" id="h4-1-93" class="i">+        if (component is Switch) {
</a><a href="#h4-1-94" id="h4-1-94" class="i">+            with(resources) {
</a><a href="#h4-1-95" id="h4-1-95" class="i">+                component.switchMinWidth = getDimension(getIdentifier(&quot;v11_switch_min_width&quot;, &quot;dimen&quot;, Constants.SNAPCHAT_PACKAGE_NAME)).toInt()
</a>             }
<a href="#h4-1-97" id="h4-1-97" class="d">-            val colorStateList = ColorStateList(
</a><a href="#h4-1-98" id="h4-1-98" class="i">+            component.trackTintList = ColorStateList(
</a>                 arrayOf(intArrayOf(-android.R.attr.state_checked), intArrayOf(android.R.attr.state_checked)
                 ), intArrayOf(
                     Color.parseColor(&quot;#1d1d1d&quot;),
                     Color.parseColor(&quot;#26bd49&quot;)
                 )
             )
<a href="#h4-1-105" id="h4-1-105" class="d">-            val thumbStateList = ColorStateList(
</a><a href="#h4-1-106" id="h4-1-106" class="i">+            component.thumbTintList = ColorStateList(
</a>                 arrayOf(intArrayOf(-android.R.attr.state_checked), intArrayOf(android.R.attr.state_checked)
                 ), intArrayOf(
                     Color.parseColor(&quot;#F5F5F5&quot;),
                     Color.parseColor(&quot;#26bd49&quot;)
                 )
             )
<a href="#h4-1-113" id="h4-1-113" class="d">-            view.trackTintList = colorStateList
</a><a href="#h4-1-114" id="h4-1-114" class="d">-            view.thumbTintList = thumbStateList
</a>         }
     }
 }
<b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,11 +1,7 @@
</a> package me.rhunk.snapenhance.features.impl.ui.menus.impl
 
 import android.annotation.SuppressLint
<a href="#h5-0-3" id="h5-0-3" class="d">-import android.content.res.Resources
</a><a href="#h5-0-4" id="h5-0-4" class="d">-import android.graphics.Color
</a><a href="#h5-0-5" id="h5-0-5" class="d">-import android.graphics.drawable.ColorDrawable
</a> import android.os.SystemClock
<a href="#h5-0-7" id="h5-0-7" class="d">-import android.util.TypedValue
</a> import android.view.MotionEvent
 import android.view.View
 import android.view.ViewGroup
<a href="#h5-1" id="h5-1" class="h">@@ -15,8 +11,8 @@ import me.rhunk.snapenhance.Constants.VIEW_INJECTED_CODE
</a> import me.rhunk.snapenhance.config.ConfigProperty
 import me.rhunk.snapenhance.features.impl.Messaging
 import me.rhunk.snapenhance.features.impl.downloader.MediaDownloader
<a href="#h5-1-3" id="h5-1-3" class="d">-import me.rhunk.snapenhance.features.impl.spying.MessageLogger
</a> import me.rhunk.snapenhance.features.impl.ui.menus.AbstractMenu
<a href="#h5-1-5" id="h5-1-5" class="i">+import me.rhunk.snapenhance.features.impl.ui.menus.ViewAppearanceHelper
</a> 
 
 class ChatActionMenu : AbstractMenu() {
<a href="#h5-2" id="h5-2" class="h">@@ -26,27 +22,6 @@ class ChatActionMenu : AbstractMenu() {
</a>         return false
     }
 
<a href="#h5-2-3" id="h5-2-3" class="d">-    private fun applyButtonTheme(parent: View, button: Button) {
</a><a href="#h5-2-4" id="h5-2-4" class="d">-        button.background = ColorDrawable(Color.WHITE)
</a><a href="#h5-2-5" id="h5-2-5" class="d">-        button.setTextColor(Color.BLACK)
</a><a href="#h5-2-6" id="h5-2-6" class="d">-        button.transformationMethod = null
</a><a href="#h5-2-7" id="h5-2-7" class="d">-        val margin = TypedValue.applyDimension(
</a><a href="#h5-2-8" id="h5-2-8" class="d">-            TypedValue.COMPLEX_UNIT_DIP,
</a><a href="#h5-2-9" id="h5-2-9" class="d">-            20f,
</a><a href="#h5-2-10" id="h5-2-10" class="d">-            Resources.getSystem().displayMetrics
</a><a href="#h5-2-11" id="h5-2-11" class="d">-        ).toInt()
</a><a href="#h5-2-12" id="h5-2-12" class="d">-        val params = MarginLayoutParams(parent.layoutParams)
</a><a href="#h5-2-13" id="h5-2-13" class="d">-        params.setMargins(margin, 5, margin, 5)
</a><a href="#h5-2-14" id="h5-2-14" class="d">-        params.marginEnd = margin
</a><a href="#h5-2-15" id="h5-2-15" class="d">-        params.marginStart = margin
</a><a href="#h5-2-16" id="h5-2-16" class="d">-        button.layoutParams = params
</a><a href="#h5-2-17" id="h5-2-17" class="d">-        button.height = TypedValue.applyDimension(
</a><a href="#h5-2-18" id="h5-2-18" class="d">-            TypedValue.COMPLEX_UNIT_DIP,
</a><a href="#h5-2-19" id="h5-2-19" class="d">-            50f,
</a><a href="#h5-2-20" id="h5-2-20" class="d">-            Resources.getSystem().displayMetrics
</a><a href="#h5-2-21" id="h5-2-21" class="d">-        ).toInt()
</a><a href="#h5-2-22" id="h5-2-22" class="d">-    }
</a><a href="#h5-2-23" id="h5-2-23" class="d">-
</a>     @SuppressLint(&quot;SetTextI18n&quot;)
     fun inject(viewGroup: ViewGroup) {
         val parent = viewGroup.parent.parent as ViewGroup
<a href="#h5-3" id="h5-3" class="h">@@ -64,9 +39,23 @@ class ChatActionMenu : AbstractMenu() {
</a>                 )
             )
         }
<a href="#h5-3-3" id="h5-3-3" class="i">+
</a><a href="#h5-3-4" id="h5-3-4" class="i">+        val injectButton = { button: Button -&gt;
</a><a href="#h5-3-5" id="h5-3-5" class="i">+            ViewAppearanceHelper.applyTheme(button, parent.width, hasRadius = true)
</a><a href="#h5-3-6" id="h5-3-6" class="i">+
</a><a href="#h5-3-7" id="h5-3-7" class="i">+            with(button) {
</a><a href="#h5-3-8" id="h5-3-8" class="i">+                layoutParams = MarginLayoutParams(
</a><a href="#h5-3-9" id="h5-3-9" class="i">+                    ViewGroup.LayoutParams.MATCH_PARENT,
</a><a href="#h5-3-10" id="h5-3-10" class="i">+                    ViewGroup.LayoutParams.WRAP_CONTENT
</a><a href="#h5-3-11" id="h5-3-11" class="i">+                ).apply {
</a><a href="#h5-3-12" id="h5-3-12" class="i">+                    setMargins(40, 0, 40, 15)
</a><a href="#h5-3-13" id="h5-3-13" class="i">+                }
</a><a href="#h5-3-14" id="h5-3-14" class="i">+                parent.addView(this)
</a><a href="#h5-3-15" id="h5-3-15" class="i">+            }
</a><a href="#h5-3-16" id="h5-3-16" class="i">+        }
</a><a href="#h5-3-17" id="h5-3-17" class="i">+
</a>         if (context.config.bool(ConfigProperty.CHAT_DOWNLOAD_CONTEXT_MENU)) {
<a href="#h5-3-19" id="h5-3-19" class="d">-            parent.addView(Button(viewGroup.context).apply {
</a><a href="#h5-3-20" id="h5-3-20" class="d">-                applyButtonTheme(parent, this)
</a><a href="#h5-3-21" id="h5-3-21" class="i">+            injectButton(Button(viewGroup.context).apply {
</a>                 text = this@ChatActionMenu.context.translation.get(&quot;chat_action_menu.preview_button&quot;)
                 setOnClickListener {
                     closeActionMenu()
<a href="#h5-4" id="h5-4" class="h">@@ -74,8 +63,7 @@ class ChatActionMenu : AbstractMenu() {
</a>                 }
             })
 
<a href="#h5-4-3" id="h5-4-3" class="d">-            parent.addView(Button(viewGroup.context).apply {
</a><a href="#h5-4-4" id="h5-4-4" class="d">-                applyButtonTheme(parent, this)
</a><a href="#h5-4-5" id="h5-4-5" class="i">+            injectButton(Button(viewGroup.context).apply {
</a>                 text = this@ChatActionMenu.context.translation.get(&quot;chat_action_menu.download_button&quot;)
                 setOnClickListener {
                     closeActionMenu()
<a href="#h5-5" id="h5-5" class="h">@@ -90,18 +78,17 @@ class ChatActionMenu : AbstractMenu() {
</a> 
         //delete logged message button
         if (context.config.bool(ConfigProperty.MESSAGE_LOGGER)) {
<a href="#h5-5-3" id="h5-5-3" class="d">-            val downloadButton = Button(viewGroup.context)
</a><a href="#h5-5-4" id="h5-5-4" class="d">-            applyButtonTheme(parent, downloadButton)
</a><a href="#h5-5-5" id="h5-5-5" class="d">-            downloadButton.text = context.translation.get(&quot;chat_action_menu.delete_logged_message_button&quot;)
</a><a href="#h5-5-6" id="h5-5-6" class="d">-            downloadButton.setOnClickListener {
</a><a href="#h5-5-7" id="h5-5-7" class="d">-                closeActionMenu()
</a><a href="#h5-5-8" id="h5-5-8" class="d">-                context.executeAsync {
</a><a href="#h5-5-9" id="h5-5-9" class="d">-                    with(context.feature(Messaging::class)) {
</a><a href="#h5-5-10" id="h5-5-10" class="d">-                        context.feature(MessageLogger::class).deleteMessage(lastOpenedConversationUUID.toString(), lastFocusedMessageId)
</a><a href="#h5-5-11" id="h5-5-11" class="i">+            injectButton(Button(viewGroup.context).apply {
</a><a href="#h5-5-12" id="h5-5-12" class="i">+                text = this@ChatActionMenu.context.translation.get(&quot;chat_action_menu.delete_logged_message_button&quot;)
</a><a href="#h5-5-13" id="h5-5-13" class="i">+                setOnClickListener {
</a><a href="#h5-5-14" id="h5-5-14" class="i">+                    closeActionMenu()
</a><a href="#h5-5-15" id="h5-5-15" class="i">+                    this@ChatActionMenu.context.executeAsync {
</a><a href="#h5-5-16" id="h5-5-16" class="i">+                        with(this@ChatActionMenu.context.feature(Messaging::class)) {
</a><a href="#h5-5-17" id="h5-5-17" class="i">+                            context.feature(me.rhunk.snapenhance.features.impl.spying.MessageLogger::class).deleteMessage(lastOpenedConversationUUID.toString(), lastFocusedMessageId)
</a><a href="#h5-5-18" id="h5-5-18" class="i">+                        }
</a>                     }
                 }
<a href="#h5-5-21" id="h5-5-21" class="d">-            }
</a><a href="#h5-5-22" id="h5-5-22" class="d">-            parent.addView(downloadButton)
</a><a href="#h5-5-23" id="h5-5-23" class="i">+            })
</a>         }
     }
 }
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -5,26 +5,35 @@ import android.app.AlertDialog
</a> import android.content.Context
 import android.content.DialogInterface
 import android.content.res.Resources
<a href="#h6-0-3" id="h6-0-3" class="i">+import android.graphics.Bitmap
</a> import android.graphics.BitmapFactory
<a href="#h6-0-5" id="h6-0-5" class="i">+import android.graphics.Canvas
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import android.graphics.Color
</a><a href="#h6-0-7" id="h6-0-7" class="i">+import android.graphics.Paint
</a> import android.graphics.drawable.BitmapDrawable
 import android.graphics.drawable.Drawable
<a href="#h6-0-10" id="h6-0-10" class="i">+import android.view.Gravity
</a><a href="#h6-0-11" id="h6-0-11" class="i">+import android.view.MotionEvent
</a> import android.view.View
<a href="#h6-0-13" id="h6-0-13" class="i">+import android.view.ViewGroup
</a> import android.widget.Button
 import android.widget.CompoundButton
<a href="#h6-0-16" id="h6-0-16" class="i">+import android.widget.LinearLayout
</a> import android.widget.Switch
 import android.widget.Toast
 import me.rhunk.snapenhance.Logger
 import me.rhunk.snapenhance.config.ConfigProperty
 import me.rhunk.snapenhance.data.ContentType
<a href="#h6-0-22" id="h6-0-22" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.FriendActionButton
</a> import me.rhunk.snapenhance.database.objects.ConversationMessage
 import me.rhunk.snapenhance.database.objects.FriendInfo
 import me.rhunk.snapenhance.database.objects.UserConversationLink
 import me.rhunk.snapenhance.features.impl.Messaging
 import me.rhunk.snapenhance.features.impl.downloader.AntiAutoDownload
<a href="#h6-0-28" id="h6-0-28" class="d">-import me.rhunk.snapenhance.features.impl.tweaks.AntiAutoSave
</a> import me.rhunk.snapenhance.features.impl.spying.StealthMode
<a href="#h6-0-30" id="h6-0-30" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.AntiAutoSave
</a> import me.rhunk.snapenhance.features.impl.ui.menus.AbstractMenu
<a href="#h6-0-32" id="h6-0-32" class="d">-import me.rhunk.snapenhance.features.impl.ui.menus.ViewAppearanceHelper.applyTheme
</a><a href="#h6-0-33" id="h6-0-33" class="i">+import me.rhunk.snapenhance.features.impl.ui.menus.ViewAppearanceHelper
</a> import java.net.HttpURLConnection
 import java.net.URL
 import java.text.DateFormat
<a href="#h6-1" id="h6-1" class="h">@@ -164,77 +173,203 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>         builder.show()
     }
 
<a href="#h6-1-3" id="h6-1-3" class="d">-    private fun createToggleFeature(viewModel: View, viewConsumer: ((View) -&gt; Unit), text: String, isChecked: () -&gt; Boolean, toggle: (Boolean) -&gt; Unit) {
</a><a href="#h6-1-4" id="h6-1-4" class="d">-        val switch = Switch(viewModel.context)
</a><a href="#h6-1-5" id="h6-1-5" class="i">+    private fun createEmojiDrawable(text: String, width: Int, height: Int, textSize: Float, disabled: Boolean = false): Drawable {
</a><a href="#h6-1-6" id="h6-1-6" class="i">+        val bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888)
</a><a href="#h6-1-7" id="h6-1-7" class="i">+        val canvas = Canvas(bitmap)
</a><a href="#h6-1-8" id="h6-1-8" class="i">+        val paint = Paint()
</a><a href="#h6-1-9" id="h6-1-9" class="i">+        paint.textSize = textSize
</a><a href="#h6-1-10" id="h6-1-10" class="i">+        paint.color = Color.BLACK
</a><a href="#h6-1-11" id="h6-1-11" class="i">+        paint.textAlign = Paint.Align.CENTER
</a><a href="#h6-1-12" id="h6-1-12" class="i">+        canvas.drawText(text, width / 2f, height.toFloat() - paint.descent(), paint)
</a><a href="#h6-1-13" id="h6-1-13" class="i">+        if (disabled) {
</a><a href="#h6-1-14" id="h6-1-14" class="i">+            paint.color = Color.RED
</a><a href="#h6-1-15" id="h6-1-15" class="i">+            paint.strokeWidth = 5f
</a><a href="#h6-1-16" id="h6-1-16" class="i">+            canvas.drawLine(0f, 0f, width.toFloat(), height.toFloat(), paint)
</a><a href="#h6-1-17" id="h6-1-17" class="i">+        }
</a><a href="#h6-1-18" id="h6-1-18" class="i">+        return BitmapDrawable(context.resources, bitmap)
</a><a href="#h6-1-19" id="h6-1-19" class="i">+    }
</a><a href="#h6-1-20" id="h6-1-20" class="i">+
</a><a href="#h6-1-21" id="h6-1-21" class="i">+    private fun getCurrentConversationId(): Pair&lt;String, String?&gt; {
</a><a href="#h6-1-22" id="h6-1-22" class="i">+        val messaging = context.feature(Messaging::class)
</a><a href="#h6-1-23" id="h6-1-23" class="i">+        var focusedConversationTargetUser: String? = null
</a><a href="#h6-1-24" id="h6-1-24" class="i">+        val conversationId = if (messaging.lastFetchConversationUUID == null) {
</a><a href="#h6-1-25" id="h6-1-25" class="i">+            focusedConversationTargetUser = messaging.lastFetchConversationUserUUID.toString()
</a><a href="#h6-1-26" id="h6-1-26" class="i">+            val conversation: UserConversationLink = context.database.getDMConversationIdFromUserId(focusedConversationTargetUser) ?: throw IllegalStateException(&quot;No conversation found&quot;)
</a><a href="#h6-1-27" id="h6-1-27" class="i">+            conversation.client_conversation_id!!.trim().lowercase()
</a><a href="#h6-1-28" id="h6-1-28" class="i">+        } else {
</a><a href="#h6-1-29" id="h6-1-29" class="i">+            messaging.lastFetchConversationUUID.toString()
</a><a href="#h6-1-30" id="h6-1-30" class="i">+        }
</a><a href="#h6-1-31" id="h6-1-31" class="i">+
</a><a href="#h6-1-32" id="h6-1-32" class="i">+        return Pair(conversationId, focusedConversationTargetUser)
</a><a href="#h6-1-33" id="h6-1-33" class="i">+    }
</a><a href="#h6-1-34" id="h6-1-34" class="i">+
</a><a href="#h6-1-35" id="h6-1-35" class="i">+    private fun createToggleFeature(viewConsumer: ((View) -&gt; Unit), text: String, isChecked: () -&gt; Boolean, toggle: (Boolean) -&gt; Unit) {
</a><a href="#h6-1-36" id="h6-1-36" class="i">+        val switch = Switch(context.androidContext)
</a>         switch.text = context.translation.get(text)
         switch.isChecked = isChecked()
<a href="#h6-1-39" id="h6-1-39" class="d">-        applyTheme(viewModel, switch)
</a><a href="#h6-1-40" id="h6-1-40" class="i">+        ViewAppearanceHelper.applyTheme(switch)
</a>         switch.setOnCheckedChangeListener { _: CompoundButton?, checked: Boolean -&gt;
             toggle(checked)
         }
         viewConsumer(switch)
     }
 
<a href="#h6-1-47" id="h6-1-47" class="d">-    @SuppressLint(&quot;SetTextI18n&quot;, &quot;UseSwitchCompatOrMaterialCode&quot;, &quot;DefaultLocale&quot;)
</a><a href="#h6-1-48" id="h6-1-48" class="i">+    fun injectOldButtons(viewModel: View, viewConsumer: ((View) -&gt; Unit)) {
</a><a href="#h6-1-49" id="h6-1-49" class="i">+
</a><a href="#h6-1-50" id="h6-1-50" class="i">+    }
</a><a href="#h6-1-51" id="h6-1-51" class="i">+
</a><a href="#h6-1-52" id="h6-1-52" class="i">+    @SuppressLint(&quot;SetTextI18n&quot;, &quot;UseSwitchCompatOrMaterialCode&quot;, &quot;DefaultLocale&quot;, &quot;InflateParams&quot;,
</a><a href="#h6-1-53" id="h6-1-53" class="i">+        &quot;DiscouragedApi&quot;, &quot;ClickableViewAccessibility&quot;
</a><a href="#h6-1-54" id="h6-1-54" class="i">+    )
</a>     fun inject(viewModel: View, viewConsumer: ((View) -&gt; Unit)) {
<a href="#h6-1-56" id="h6-1-56" class="d">-        val messaging = context.feature(Messaging::class)
</a><a href="#h6-1-57" id="h6-1-57" class="d">-        var focusedConversationTargetUser: String? = null
</a><a href="#h6-1-58" id="h6-1-58" class="d">-        val conversationId: String
</a><a href="#h6-1-59" id="h6-1-59" class="d">-        if (messaging.lastFetchConversationUserUUID != null) {
</a><a href="#h6-1-60" id="h6-1-60" class="d">-            focusedConversationTargetUser = messaging.lastFetchConversationUserUUID.toString()
</a><a href="#h6-1-61" id="h6-1-61" class="d">-            val conversation: UserConversationLink = context.database.getDMConversationIdFromUserId(focusedConversationTargetUser) ?: return
</a><a href="#h6-1-62" id="h6-1-62" class="d">-            conversationId = conversation.client_conversation_id!!.trim().lowercase()
</a><a href="#h6-1-63" id="h6-1-63" class="d">-        } else {
</a><a href="#h6-1-64" id="h6-1-64" class="d">-            conversationId = messaging.lastFetchConversationUUID.toString()
</a><a href="#h6-1-65" id="h6-1-65" class="d">-        }
</a><a href="#h6-1-66" id="h6-1-66" class="d">-
</a><a href="#h6-1-67" id="h6-1-67" class="d">-        //preview button
</a><a href="#h6-1-68" id="h6-1-68" class="d">-        val previewButton = Button(viewModel.context)
</a><a href="#h6-1-69" id="h6-1-69" class="d">-        previewButton.text = context.translation.get(&quot;friend_menu_option.preview&quot;)
</a><a href="#h6-1-70" id="h6-1-70" class="d">-        applyTheme(viewModel, previewButton)
</a><a href="#h6-1-71" id="h6-1-71" class="d">-        val finalFocusedConversationTargetUser = focusedConversationTargetUser
</a><a href="#h6-1-72" id="h6-1-72" class="d">-        previewButton.setOnClickListener {
</a><a href="#h6-1-73" id="h6-1-73" class="d">-            showPreview(
</a><a href="#h6-1-74" id="h6-1-74" class="d">-                finalFocusedConversationTargetUser,
</a><a href="#h6-1-75" id="h6-1-75" class="d">-                conversationId,
</a><a href="#h6-1-76" id="h6-1-76" class="d">-                previewButton.context
</a><a href="#h6-1-77" id="h6-1-77" class="d">-            )
</a><a href="#h6-1-78" id="h6-1-78" class="d">-        }
</a><a href="#h6-1-79" id="h6-1-79" class="d">-
</a><a href="#h6-1-80" id="h6-1-80" class="d">-        //stealth switch
</a><a href="#h6-1-81" id="h6-1-81" class="d">-        val stealthSwitch = Switch(viewModel.context)
</a><a href="#h6-1-82" id="h6-1-82" class="d">-        stealthSwitch.text = context.translation.get(&quot;friend_menu_option.stealth_mode&quot;)
</a><a href="#h6-1-83" id="h6-1-83" class="d">-        stealthSwitch.isChecked = context.feature(StealthMode::class).isStealth(conversationId)
</a><a href="#h6-1-84" id="h6-1-84" class="d">-        applyTheme(viewModel, stealthSwitch)
</a><a href="#h6-1-85" id="h6-1-85" class="d">-        stealthSwitch.setOnCheckedChangeListener { _: CompoundButton?, isChecked: Boolean -&gt;
</a><a href="#h6-1-86" id="h6-1-86" class="d">-            context.feature(StealthMode::class).setStealth(
</a><a href="#h6-1-87" id="h6-1-87" class="d">-                conversationId,
</a><a href="#h6-1-88" id="h6-1-88" class="d">-                isChecked
</a><a href="#h6-1-89" id="h6-1-89" class="d">-            )
</a><a href="#h6-1-90" id="h6-1-90" class="d">-        }
</a><a href="#h6-1-91" id="h6-1-91" class="d">-
</a><a href="#h6-1-92" id="h6-1-92" class="d">-        run {
</a><a href="#h6-1-93" id="h6-1-93" class="d">-            val userId = context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId ?: return@run
</a><a href="#h6-1-94" id="h6-1-94" class="d">-            if (context.config.bool(ConfigProperty.DOWNLOAD_BLACKLIST)) {
</a><a href="#h6-1-95" id="h6-1-95" class="d">-                createToggleFeature(viewModel,
</a><a href="#h6-1-96" id="h6-1-96" class="d">-                    viewConsumer,
</a><a href="#h6-1-97" id="h6-1-97" class="d">-                    &quot;friend_menu_option.anti_auto_download&quot;,
</a><a href="#h6-1-98" id="h6-1-98" class="d">-                    { context.feature(AntiAutoDownload::class).isUserIgnored(userId) },
</a><a href="#h6-1-99" id="h6-1-99" class="d">-                    { context.feature(AntiAutoDownload::class).setUserIgnored(userId, it) }
</a><a href="#h6-1-100" id="h6-1-100" class="i">+        val modContext = context
</a><a href="#h6-1-101" id="h6-1-101" class="i">+
</a><a href="#h6-1-102" id="h6-1-102" class="i">+        val friendFeedMenuOptions = context.config.options(ConfigProperty.FRIEND_FEED_MENU_BUTTONS)
</a><a href="#h6-1-103" id="h6-1-103" class="i">+        if (friendFeedMenuOptions.none { it.value }) return
</a><a href="#h6-1-104" id="h6-1-104" class="i">+
</a><a href="#h6-1-105" id="h6-1-105" class="i">+        val (conversationId, focusedConversationTargetUser) = getCurrentConversationId()
</a><a href="#h6-1-106" id="h6-1-106" class="i">+
</a><a href="#h6-1-107" id="h6-1-107" class="i">+        if (!context.config.bool(ConfigProperty.ENABLE_FRIEND_FEED_MENU_BAR)) {
</a><a href="#h6-1-108" id="h6-1-108" class="i">+            //preview button
</a><a href="#h6-1-109" id="h6-1-109" class="i">+            val previewButton = Button(viewModel.context).apply {
</a><a href="#h6-1-110" id="h6-1-110" class="i">+                text = modContext.translation.get(&quot;friend_menu_option.preview&quot;)
</a><a href="#h6-1-111" id="h6-1-111" class="i">+                ViewAppearanceHelper.applyTheme(this, viewModel.width)
</a><a href="#h6-1-112" id="h6-1-112" class="i">+                setOnClickListener {
</a><a href="#h6-1-113" id="h6-1-113" class="i">+                    showPreview(
</a><a href="#h6-1-114" id="h6-1-114" class="i">+                        focusedConversationTargetUser,
</a><a href="#h6-1-115" id="h6-1-115" class="i">+                        conversationId,
</a><a href="#h6-1-116" id="h6-1-116" class="i">+                        context
</a><a href="#h6-1-117" id="h6-1-117" class="i">+                    )
</a><a href="#h6-1-118" id="h6-1-118" class="i">+                }
</a><a href="#h6-1-119" id="h6-1-119" class="i">+            }
</a><a href="#h6-1-120" id="h6-1-120" class="i">+
</a><a href="#h6-1-121" id="h6-1-121" class="i">+            //stealth switch
</a><a href="#h6-1-122" id="h6-1-122" class="i">+            val stealthSwitch = Switch(viewModel.context).apply {
</a><a href="#h6-1-123" id="h6-1-123" class="i">+                text = modContext.translation.get(&quot;friend_menu_option.stealth_mode&quot;)
</a><a href="#h6-1-124" id="h6-1-124" class="i">+                isChecked = modContext.feature(StealthMode::class).isStealth(conversationId)
</a><a href="#h6-1-125" id="h6-1-125" class="i">+                ViewAppearanceHelper.applyTheme(this)
</a><a href="#h6-1-126" id="h6-1-126" class="i">+                setOnCheckedChangeListener { _: CompoundButton?, isChecked: Boolean -&gt;
</a><a href="#h6-1-127" id="h6-1-127" class="i">+                    modContext.feature(StealthMode::class).setStealth(
</a><a href="#h6-1-128" id="h6-1-128" class="i">+                        conversationId,
</a><a href="#h6-1-129" id="h6-1-129" class="i">+                        isChecked
</a><a href="#h6-1-130" id="h6-1-130" class="i">+                    )
</a><a href="#h6-1-131" id="h6-1-131" class="i">+                }
</a><a href="#h6-1-132" id="h6-1-132" class="i">+            }
</a><a href="#h6-1-133" id="h6-1-133" class="i">+
</a><a href="#h6-1-134" id="h6-1-134" class="i">+            run {
</a><a href="#h6-1-135" id="h6-1-135" class="i">+                val userId = context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId ?: return@run
</a><a href="#h6-1-136" id="h6-1-136" class="i">+                if (friendFeedMenuOptions[&quot;auto_download_blacklist&quot;] == true) {
</a><a href="#h6-1-137" id="h6-1-137" class="i">+                    createToggleFeature(viewConsumer,
</a><a href="#h6-1-138" id="h6-1-138" class="i">+                        &quot;friend_menu_option.auto_download_blacklist&quot;,
</a><a href="#h6-1-139" id="h6-1-139" class="i">+                        { context.feature(AntiAutoDownload::class).isUserIgnored(userId) },
</a><a href="#h6-1-140" id="h6-1-140" class="i">+                        { context.feature(AntiAutoDownload::class).setUserIgnored(userId, it) }
</a><a href="#h6-1-141" id="h6-1-141" class="i">+                    )
</a><a href="#h6-1-142" id="h6-1-142" class="i">+                }
</a><a href="#h6-1-143" id="h6-1-143" class="i">+
</a><a href="#h6-1-144" id="h6-1-144" class="i">+                if (friendFeedMenuOptions[&quot;anti_auto_save&quot;] == true) {
</a><a href="#h6-1-145" id="h6-1-145" class="i">+                    createToggleFeature(viewConsumer,
</a><a href="#h6-1-146" id="h6-1-146" class="i">+                        &quot;friend_menu_option.anti_auto_save&quot;,
</a><a href="#h6-1-147" id="h6-1-147" class="i">+                        { context.feature(AntiAutoSave::class).isConversationIgnored(conversationId) },
</a><a href="#h6-1-148" id="h6-1-148" class="i">+                        { context.feature(AntiAutoSave::class).setConversationIgnored(conversationId, it) }
</a><a href="#h6-1-149" id="h6-1-149" class="i">+                    )
</a><a href="#h6-1-150" id="h6-1-150" class="i">+                }
</a><a href="#h6-1-151" id="h6-1-151" class="i">+            }
</a><a href="#h6-1-152" id="h6-1-152" class="i">+
</a><a href="#h6-1-153" id="h6-1-153" class="i">+            viewConsumer(stealthSwitch)
</a><a href="#h6-1-154" id="h6-1-154" class="i">+            viewConsumer(previewButton)
</a><a href="#h6-1-155" id="h6-1-155" class="i">+            return
</a><a href="#h6-1-156" id="h6-1-156" class="i">+        }
</a><a href="#h6-1-157" id="h6-1-157" class="i">+
</a><a href="#h6-1-158" id="h6-1-158" class="i">+        val menuButtonBar = LinearLayout(viewModel.context).apply {
</a><a href="#h6-1-159" id="h6-1-159" class="i">+            layoutParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT)
</a><a href="#h6-1-160" id="h6-1-160" class="i">+            orientation = LinearLayout.HORIZONTAL
</a><a href="#h6-1-161" id="h6-1-161" class="i">+            gravity = Gravity.CENTER
</a><a href="#h6-1-162" id="h6-1-162" class="i">+        }
</a><a href="#h6-1-163" id="h6-1-163" class="i">+
</a><a href="#h6-1-164" id="h6-1-164" class="i">+        fun createActionButton(icon: String, isDisabled: Boolean? = null, onClick: (Boolean) -&gt; Unit) {
</a><a href="#h6-1-165" id="h6-1-165" class="i">+            //FIXME: hardcoded values
</a><a href="#h6-1-166" id="h6-1-166" class="i">+            menuButtonBar.addView(LinearLayout(viewModel.context).apply {
</a><a href="#h6-1-167" id="h6-1-167" class="i">+                layoutParams = LinearLayout.LayoutParams(0, ViewGroup.LayoutParams.MATCH_PARENT, 1f)
</a><a href="#h6-1-168" id="h6-1-168" class="i">+                gravity = Gravity.CENTER
</a><a href="#h6-1-169" id="h6-1-169" class="i">+                setPadding(0, 20, 0, 20)
</a><a href="#h6-1-170" id="h6-1-170" class="i">+                isClickable = true
</a><a href="#h6-1-171" id="h6-1-171" class="i">+                scaleX = 1.1f
</a><a href="#h6-1-172" id="h6-1-172" class="i">+                scaleY = 1.1f
</a><a href="#h6-1-173" id="h6-1-173" class="i">+
</a><a href="#h6-1-174" id="h6-1-174" class="i">+                var isLineThrough = isDisabled ?: false
</a><a href="#h6-1-175" id="h6-1-175" class="i">+                FriendActionButton.new(viewModel.context).apply {
</a><a href="#h6-1-176" id="h6-1-176" class="i">+                    fun setLineThrough(value: Boolean) {
</a><a href="#h6-1-177" id="h6-1-177" class="i">+                        setIconDrawable(createEmojiDrawable(icon, 60, 60, 50f, if (isDisabled == null) false else value))
</a><a href="#h6-1-178" id="h6-1-178" class="i">+                    }
</a><a href="#h6-1-179" id="h6-1-179" class="i">+                    setLineThrough(isLineThrough)
</a><a href="#h6-1-180" id="h6-1-180" class="i">+                    (instanceNonNull() as View).apply {
</a><a href="#h6-1-181" id="h6-1-181" class="i">+                        layoutParams = LinearLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT).apply {
</a><a href="#h6-1-182" id="h6-1-182" class="i">+                            setMargins(0, 60, 0, 60)
</a><a href="#h6-1-183" id="h6-1-183" class="i">+                        }
</a><a href="#h6-1-184" id="h6-1-184" class="i">+                        setOnTouchListener { _, event -&gt;
</a><a href="#h6-1-185" id="h6-1-185" class="i">+                            if (event.action == MotionEvent.ACTION_UP) {
</a><a href="#h6-1-186" id="h6-1-186" class="i">+                                isLineThrough = !isLineThrough
</a><a href="#h6-1-187" id="h6-1-187" class="i">+                                onClick(isLineThrough)
</a><a href="#h6-1-188" id="h6-1-188" class="i">+                                setLineThrough(isLineThrough)
</a><a href="#h6-1-189" id="h6-1-189" class="i">+                            }
</a><a href="#h6-1-190" id="h6-1-190" class="i">+                            false
</a><a href="#h6-1-191" id="h6-1-191" class="i">+                        }
</a><a href="#h6-1-192" id="h6-1-192" class="i">+                    }
</a><a href="#h6-1-193" id="h6-1-193" class="i">+
</a><a href="#h6-1-194" id="h6-1-194" class="i">+                }.also { addView(it.instanceNonNull() as View) }
</a><a href="#h6-1-195" id="h6-1-195" class="i">+
</a><a href="#h6-1-196" id="h6-1-196" class="i">+            })
</a><a href="#h6-1-197" id="h6-1-197" class="i">+        }
</a><a href="#h6-1-198" id="h6-1-198" class="i">+
</a><a href="#h6-1-199" id="h6-1-199" class="i">+        if (friendFeedMenuOptions[&quot;auto_download_blacklist&quot;] == true) {
</a><a href="#h6-1-200" id="h6-1-200" class="i">+            run {
</a><a href="#h6-1-201" id="h6-1-201" class="i">+                val userId =
</a><a href="#h6-1-202" id="h6-1-202" class="i">+                    context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId
</a><a href="#h6-1-203" id="h6-1-203" class="i">+                        ?: return@run
</a><a href="#h6-1-204" id="h6-1-204" class="i">+                createActionButton(
</a><a href="#h6-1-205" id="h6-1-205" class="i">+                    &quot;\u2B07\uFE0F&quot;,
</a><a href="#h6-1-206" id="h6-1-206" class="i">+                    isDisabled = !context.feature(AntiAutoDownload::class).isUserIgnored(userId)
</a><a href="#h6-1-207" id="h6-1-207" class="i">+                ) {
</a><a href="#h6-1-208" id="h6-1-208" class="i">+                    context.feature(AntiAutoDownload::class).setUserIgnored(userId, !it)
</a><a href="#h6-1-209" id="h6-1-209" class="i">+                }
</a><a href="#h6-1-210" id="h6-1-210" class="i">+            }
</a><a href="#h6-1-211" id="h6-1-211" class="i">+        }
</a><a href="#h6-1-212" id="h6-1-212" class="i">+
</a><a href="#h6-1-213" id="h6-1-213" class="i">+        if (friendFeedMenuOptions[&quot;anti_auto_save&quot;] == true) {
</a><a href="#h6-1-214" id="h6-1-214" class="i">+            //diskette
</a><a href="#h6-1-215" id="h6-1-215" class="i">+            createActionButton(&quot;\uD83D\uDCAC&quot;,
</a><a href="#h6-1-216" id="h6-1-216" class="i">+                isDisabled = !context.feature(AntiAutoSave::class)
</a><a href="#h6-1-217" id="h6-1-217" class="i">+                    .isConversationIgnored(conversationId)
</a><a href="#h6-1-218" id="h6-1-218" class="i">+            ) {
</a><a href="#h6-1-219" id="h6-1-219" class="i">+                context.feature(AntiAutoSave::class).setConversationIgnored(conversationId, !it)
</a><a href="#h6-1-220" id="h6-1-220" class="i">+            }
</a><a href="#h6-1-221" id="h6-1-221" class="i">+        }
</a><a href="#h6-1-222" id="h6-1-222" class="i">+
</a><a href="#h6-1-223" id="h6-1-223" class="i">+
</a><a href="#h6-1-224" id="h6-1-224" class="i">+        if (friendFeedMenuOptions[&quot;stealth_mode&quot;] == true) {
</a><a href="#h6-1-225" id="h6-1-225" class="i">+            //eyes
</a><a href="#h6-1-226" id="h6-1-226" class="i">+            createActionButton(
</a><a href="#h6-1-227" id="h6-1-227" class="i">+                &quot;\uD83D\uDC7B&quot;,
</a><a href="#h6-1-228" id="h6-1-228" class="i">+                isDisabled = !context.feature(StealthMode::class).isStealth(conversationId)
</a><a href="#h6-1-229" id="h6-1-229" class="i">+            ) { isChecked -&gt;
</a><a href="#h6-1-230" id="h6-1-230" class="i">+                context.feature(StealthMode::class).setStealth(
</a><a href="#h6-1-231" id="h6-1-231" class="i">+                    conversationId,
</a><a href="#h6-1-232" id="h6-1-232" class="i">+                    !isChecked
</a>                 )
             }
<a href="#h6-1-235" id="h6-1-235" class="i">+        }
</a> 
<a href="#h6-1-237" id="h6-1-237" class="d">-            if (context.config.bool(ConfigProperty.ANTI_AUTO_SAVE)) {
</a><a href="#h6-1-238" id="h6-1-238" class="d">-                createToggleFeature(viewModel,
</a><a href="#h6-1-239" id="h6-1-239" class="d">-                    viewConsumer,
</a><a href="#h6-1-240" id="h6-1-240" class="d">-                    &quot;friend_menu_option.anti_auto_save&quot;,
</a><a href="#h6-1-241" id="h6-1-241" class="d">-                    { context.feature(AntiAutoSave::class).isConversationIgnored(conversationId) },
</a><a href="#h6-1-242" id="h6-1-242" class="d">-                    { context.feature(AntiAutoSave::class).setConversationIgnored(conversationId, it) }
</a><a href="#h6-1-243" id="h6-1-243" class="i">+        if (friendFeedMenuOptions[&quot;conversation_info&quot;] == true) {
</a><a href="#h6-1-244" id="h6-1-244" class="i">+            //user
</a><a href="#h6-1-245" id="h6-1-245" class="i">+            createActionButton(&quot;\uD83D\uDC64&quot;) {
</a><a href="#h6-1-246" id="h6-1-246" class="i">+                showPreview(
</a><a href="#h6-1-247" id="h6-1-247" class="i">+                    focusedConversationTargetUser,
</a><a href="#h6-1-248" id="h6-1-248" class="i">+                    conversationId,
</a><a href="#h6-1-249" id="h6-1-249" class="i">+                    viewModel.context
</a>                 )
             }
         }
 
<a href="#h6-1-254" id="h6-1-254" class="d">-        viewConsumer(stealthSwitch)
</a><a href="#h6-1-255" id="h6-1-255" class="d">-        viewConsumer(previewButton)
</a><a href="#h6-1-256" id="h6-1-256" class="i">+        viewConsumer(menuButtonBar)
</a>     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/OperaContextActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/OperaContextActionMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/OperaContextActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/OperaContextActionMenu.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -72,7 +72,7 @@ class OperaContextActionMenu : AbstractMenu() {
</a>             val button = Button(childView.getContext())
             button.text = context.translation.get(&quot;opera_context_menu.download&quot;)
             button.setOnClickListener { context.feature(MediaDownloader::class).downloadLastOperaMediaAsync() }
<a href="#h7-0-3" id="h7-0-3" class="d">-            applyTheme(linearLayout, button)
</a><a href="#h7-0-4" id="h7-0-4" class="i">+            applyTheme(button)
</a>             linearLayout.addView(button)
             (childView as ViewGroup).addView(linearLayout, 0)
         } catch (e: Throwable) {
<b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -24,10 +24,10 @@ import me.rhunk.snapenhance.features.impl.ui.menus.ViewAppearanceHelper
</a> 
 class SettingsMenu : AbstractMenu() {
     @SuppressLint(&quot;ClickableViewAccessibility&quot;)
<a href="#h8-0-3" id="h8-0-3" class="d">-    private fun createCategoryTitle(viewModel: View, key: String): TextView {
</a><a href="#h8-0-4" id="h8-0-4" class="d">-        val categoryText = TextView(viewModel.context)
</a><a href="#h8-0-5" id="h8-0-5" class="i">+    private fun createCategoryTitle(key: String): TextView {
</a><a href="#h8-0-6" id="h8-0-6" class="i">+        val categoryText = TextView(context.androidContext)
</a>         categoryText.text = context.translation.get(key)
<a href="#h8-0-8" id="h8-0-8" class="d">-        ViewAppearanceHelper.applyTheme(viewModel, categoryText)
</a><a href="#h8-0-9" id="h8-0-9" class="i">+        ViewAppearanceHelper.applyTheme(categoryText)
</a>         categoryText.textSize = 20f
         categoryText.typeface = categoryText.typeface?.let { Typeface.create(it, Typeface.BOLD) }
         categoryText.setOnTouchListener { _, _ -&gt; true }
<a href="#h8-1" id="h8-1" class="h">@@ -35,7 +35,7 @@ class SettingsMenu : AbstractMenu() {
</a>     }
 
     @SuppressLint(&quot;SetTextI18n&quot;)
<a href="#h8-1-3" id="h8-1-3" class="d">-    private fun createPropertyView(viewModel: View, property: ConfigProperty): View {
</a><a href="#h8-1-4" id="h8-1-4" class="i">+    private fun createPropertyView(property: ConfigProperty): View {
</a>         val propertyName = context.translation.get(property.nameKey)
         val updateButtonText: (TextView, String) -&gt; Unit = { textView, text -&gt;
             textView.text = &quot;$propertyName${if (text.isEmpty()) &quot;&quot; else &quot;: $text&quot;}&quot;
<a href="#h8-2" id="h8-2" class="h">@@ -57,10 +57,10 @@ class SettingsMenu : AbstractMenu() {
</a>         }
 
         val textEditor: ((String) -&gt; Unit) -&gt; Unit = { updateValue -&gt;
<a href="#h8-2-3" id="h8-2-3" class="d">-            val builder = AlertDialog.Builder(viewModel.context)
</a><a href="#h8-2-4" id="h8-2-4" class="i">+            val builder = AlertDialog.Builder(context.mainActivity!!)
</a>             builder.setTitle(propertyName)
 
<a href="#h8-2-7" id="h8-2-7" class="d">-            val input = EditText(viewModel.context)
</a><a href="#h8-2-8" id="h8-2-8" class="i">+            val input = EditText(context.androidContext)
</a>             input.inputType = InputType.TYPE_CLASS_TEXT
             input.setText(property.valueContainer.value().toString())
 
<a href="#h8-3" id="h8-3" class="h">@@ -75,12 +75,12 @@ class SettingsMenu : AbstractMenu() {
</a> 
         val resultView: View = when (property.valueContainer) {
             is ConfigStringValue -&gt; {
<a href="#h8-3-3" id="h8-3-3" class="d">-                val textView = TextView(viewModel.context)
</a><a href="#h8-3-4" id="h8-3-4" class="i">+                val textView = TextView(context.androidContext)
</a>                 updateButtonText(textView, property.valueContainer.let {
                     if (it.isHidden) it.hiddenValue()
                     else it.value()
                 })
<a href="#h8-3-9" id="h8-3-9" class="d">-                ViewAppearanceHelper.applyTheme(viewModel, textView)
</a><a href="#h8-3-10" id="h8-3-10" class="i">+                ViewAppearanceHelper.applyTheme(textView)
</a>                 textView.setOnClickListener {
                     textEditor { value -&gt;
                         property.valueContainer.writeFrom(value)
<a href="#h8-4" id="h8-4" class="h">@@ -93,7 +93,7 @@ class SettingsMenu : AbstractMenu() {
</a>                 textView
             }
             is ConfigIntegerValue -&gt; {
<a href="#h8-4-3" id="h8-4-3" class="d">-                val button = Button(viewModel.context)
</a><a href="#h8-4-4" id="h8-4-4" class="i">+                val button = Button(context.androidContext)
</a>                 updateButtonText(button, property.valueContainer.value().toString())
                 button.setOnClickListener {
                     textEditor { value -&gt;
<a href="#h8-5" id="h8-5" class="h">@@ -105,25 +105,25 @@ class SettingsMenu : AbstractMenu() {
</a>                         }
                     }
                 }
<a href="#h8-5-3" id="h8-5-3" class="d">-                ViewAppearanceHelper.applyTheme(viewModel, button)
</a><a href="#h8-5-4" id="h8-5-4" class="i">+                ViewAppearanceHelper.applyTheme(button)
</a>                 button
             }
             is ConfigStateValue -&gt; {
<a href="#h8-5-8" id="h8-5-8" class="d">-                val switch = Switch(viewModel.context)
</a><a href="#h8-5-9" id="h8-5-9" class="i">+                val switch = Switch(context.androidContext)
</a>                 switch.text = propertyName
                 switch.isChecked = property.valueContainer.value()
                 switch.setOnCheckedChangeListener { _, isChecked -&gt;
                     property.valueContainer.writeFrom(isChecked.toString())
                 }
<a href="#h8-5-15" id="h8-5-15" class="d">-                ViewAppearanceHelper.applyTheme(viewModel, switch)
</a><a href="#h8-5-16" id="h8-5-16" class="i">+                ViewAppearanceHelper.applyTheme(switch)
</a>                 switch
             }
             is ConfigStateSelection -&gt; {
<a href="#h8-5-20" id="h8-5-20" class="d">-                val button = Button(viewModel.context)
</a><a href="#h8-5-21" id="h8-5-21" class="i">+                val button = Button(context.androidContext)
</a>                 updateLocalizedText(button, property.valueContainer.value())
 
                 button.setOnClickListener {_ -&gt;
<a href="#h8-5-25" id="h8-5-25" class="d">-                    val builder = AlertDialog.Builder(viewModel.context)
</a><a href="#h8-5-26" id="h8-5-26" class="i">+                    val builder = AlertDialog.Builder(context.mainActivity!!)
</a>                     builder.setTitle(propertyName)
 
                     builder.setSingleChoiceItems(
<a href="#h8-6" id="h8-6" class="h">@@ -142,15 +142,15 @@ class SettingsMenu : AbstractMenu() {
</a> 
                     builder.show()
                 }
<a href="#h8-6-3" id="h8-6-3" class="d">-                ViewAppearanceHelper.applyTheme(viewModel, button)
</a><a href="#h8-6-4" id="h8-6-4" class="i">+                ViewAppearanceHelper.applyTheme(button)
</a>                 button
             }
             is ConfigStateListValue -&gt; {
<a href="#h8-6-8" id="h8-6-8" class="d">-                val button = Button(viewModel.context)
</a><a href="#h8-6-9" id="h8-6-9" class="i">+                val button = Button(context.androidContext)
</a>                 updateButtonText(button, &quot;(${property.valueContainer.value().count { it.value }})&quot;)
 
                 button.setOnClickListener {_ -&gt;
<a href="#h8-6-13" id="h8-6-13" class="d">-                    val builder = AlertDialog.Builder(viewModel.context)
</a><a href="#h8-6-14" id="h8-6-14" class="i">+                    val builder = AlertDialog.Builder(context.mainActivity!!)
</a>                     builder.setTitle(propertyName)
 
                     val sortedStates = property.valueContainer.value().toSortedMap()
<a href="#h8-7" id="h8-7" class="h">@@ -173,11 +173,11 @@ class SettingsMenu : AbstractMenu() {
</a> 
                     builder.show()
                 }
<a href="#h8-7-3" id="h8-7-3" class="d">-                ViewAppearanceHelper.applyTheme(viewModel, button)
</a><a href="#h8-7-4" id="h8-7-4" class="i">+                ViewAppearanceHelper.applyTheme(button)
</a>                 button
             }
             else -&gt; {
<a href="#h8-7-8" id="h8-7-8" class="d">-                TextView(viewModel.context)
</a><a href="#h8-7-9" id="h8-7-9" class="i">+                TextView(context.androidContext)
</a>             }
         }
         return resultView
<a href="#h8-8" id="h8-8" class="h">@@ -203,7 +203,7 @@ class SettingsMenu : AbstractMenu() {
</a>         }
         val titleText = TextView(viewModel.context)
         titleText.text = versionTextBuilder.toString()
<a href="#h8-8-3" id="h8-8-3" class="d">-        ViewAppearanceHelper.applyTheme(viewModel, titleText)
</a><a href="#h8-8-4" id="h8-8-4" class="i">+        ViewAppearanceHelper.applyTheme(titleText)
</a>         titleText.textSize = 18f
         titleText.minHeight = 80 * versionTextBuilder.chars().filter { ch: Int -&gt; ch == &#39;\n&#39;.code }
                 .count().coerceAtLeast(2).toInt()
<a href="#h8-9" id="h8-9" class="h">@@ -216,7 +216,7 @@ class SettingsMenu : AbstractMenu() {
</a>                 button.setOnClickListener { _ -&gt;
                     it.run()
                 }
<a href="#h8-9-3" id="h8-9-3" class="d">-                ViewAppearanceHelper.applyTheme(viewModel, button)
</a><a href="#h8-9-4" id="h8-9-4" class="i">+                ViewAppearanceHelper.applyTheme(button)
</a>                 button
             }
         }
<a href="#h8-10" id="h8-10" class="h">@@ -224,9 +224,9 @@ class SettingsMenu : AbstractMenu() {
</a>         context.config.entries().groupBy {
             it.key.category
         }.forEach { (category, value) -&gt;
<a href="#h8-10-3" id="h8-10-3" class="d">-            addView(createCategoryTitle(viewModel, category.key))
</a><a href="#h8-10-4" id="h8-10-4" class="i">+            addView(createCategoryTitle(category.key))
</a>             value.filter { it.key.shouldAppearInSettings }.forEach { (property, _) -&gt;
<a href="#h8-10-6" id="h8-10-6" class="d">-                addView(createPropertyView(viewModel, property))
</a><a href="#h8-10-7" id="h8-10-7" class="i">+                addView(createPropertyView(property))
</a>                 actions.find { pair -&gt; pair.first.dependsOnProperty == property}?.let { pair -&gt;
                     addView(pair.second())
                 }
</pre>
</div>
</body>
</html>
