<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat(scripting): integrated ui - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/72c9b92a3e07d6b60832204aac661c989fe841df.html">72c9b92a3e07d6b60832204aac661c989fe841df</a>
<b>parent</b> <a href="../commit/37becec35047bee5e4493cd03ea26fbac3263492.html">37becec35047bee5e4493cd03ea26fbac3263492</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Mon, 25 Dec 2023 23:10:31 +0100

feat(scripting): integrated ui

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a></td><td> | </td><td class="num">2</td><td><span class="i"></span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/InterfaceManager.kt</a></td><td> | </td><td class="num">104</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/Node.kt</a></td><td> | </td><td class="num">52</td><td><span class="i"></span><span class="d">----------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/NodeType.kt</a></td><td> | </td><td class="num">12</td><td><span class="i"></span><span class="d">------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/ActionNode.kt</a></td><td> | </td><td class="num">16</td><td><span class="i"></span><span class="d">----------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/RowColumnNode.kt</a></td><td> | </td><td class="num">48</td><td><span class="i"></span><span class="d">------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptInterface.kt</a></td><td> | </td><td class="num">183</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptsSection.kt</a></td><td> | </td><td class="num">16</td><td><span class="i">+++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">common/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Scripting.kt</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/JSModule.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/EnumScriptInterface.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/InterfaceManager.kt</a></td><td> | </td><td class="num">117</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/ScriptInterface.kt</a></td><td> | </td><td class="num">182</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/Node.kt</a></td><td> | </td><td class="num">52</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/NodeType.kt</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h16">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/ActionNode.kt</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h17">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/RowColumnNode.kt</a></td><td> | </td><td class="num">48</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/MenuViewInjector.kt</a></td><td> | </td><td class="num">160</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h21">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/MenuViewInjector.kt</a></td><td> | </td><td class="num">152</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
</table></pre><pre>22 files changed, 647 insertions(+), 581 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -14,7 +14,6 @@ import me.rhunk.snapenhance.common.scripting.type.ModuleInfo
</a> import me.rhunk.snapenhance.scripting.impl.IPCListeners
 import me.rhunk.snapenhance.scripting.impl.ManagerIPC
 import me.rhunk.snapenhance.scripting.impl.ManagerScriptConfig
<a href="#h0-0-3" id="h0-0-3" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.InterfaceManager
</a> import java.io.File
 import java.io.InputStream
 import kotlin.system.exitProcess
<a href="#h0-1" id="h0-1" class="h">@@ -67,7 +66,6 @@ class RemoteScriptManager(
</a>             putConst(&quot;currentSide&quot;, this, BindingSide.MANAGER.key)
             module.registerBindings(
                 ManagerIPC(ipcListeners),
<a href="#h0-1-3" id="h0-1-3" class="d">-                InterfaceManager(),
</a>                 ManagerScriptConfig(this@RemoteScriptManager)
             )
         }
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/InterfaceManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/InterfaceManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/InterfaceManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/InterfaceManager.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,103 +0,0 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-package me.rhunk.snapenhance.scripting.impl.ui
</a><a href="#h1-0-1" id="h1-0-1" class="d">-
</a><a href="#h1-0-2" id="h1-0-2" class="d">-import me.rhunk.snapenhance.common.scripting.bindings.AbstractBinding
</a><a href="#h1-0-3" id="h1-0-3" class="d">-import me.rhunk.snapenhance.common.scripting.bindings.BindingSide
</a><a href="#h1-0-4" id="h1-0-4" class="d">-import me.rhunk.snapenhance.common.scripting.ktx.contextScope
</a><a href="#h1-0-5" id="h1-0-5" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.Node
</a><a href="#h1-0-6" id="h1-0-6" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.NodeType
</a><a href="#h1-0-7" id="h1-0-7" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.impl.ActionNode
</a><a href="#h1-0-8" id="h1-0-8" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.impl.ActionType
</a><a href="#h1-0-9" id="h1-0-9" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.impl.RowColumnNode
</a><a href="#h1-0-10" id="h1-0-10" class="d">-import org.mozilla.javascript.Function
</a><a href="#h1-0-11" id="h1-0-11" class="d">-import org.mozilla.javascript.annotations.JSFunction
</a><a href="#h1-0-12" id="h1-0-12" class="d">-
</a><a href="#h1-0-13" id="h1-0-13" class="d">-
</a><a href="#h1-0-14" id="h1-0-14" class="d">-class InterfaceBuilder {
</a><a href="#h1-0-15" id="h1-0-15" class="d">-    val nodes = mutableListOf&lt;Node&gt;()
</a><a href="#h1-0-16" id="h1-0-16" class="d">-    var onDisposeCallback: (() -&gt; Unit)? = null
</a><a href="#h1-0-17" id="h1-0-17" class="d">-
</a><a href="#h1-0-18" id="h1-0-18" class="d">-    private fun createNode(type: NodeType, block: Node.() -&gt; Unit): Node {
</a><a href="#h1-0-19" id="h1-0-19" class="d">-        return Node(type).apply(block).also { nodes.add(it) }
</a><a href="#h1-0-20" id="h1-0-20" class="d">-    }
</a><a href="#h1-0-21" id="h1-0-21" class="d">-
</a><a href="#h1-0-22" id="h1-0-22" class="d">-    fun onDispose(block: () -&gt; Unit) {
</a><a href="#h1-0-23" id="h1-0-23" class="d">-        nodes.add(ActionNode(ActionType.DISPOSE, callback = block))
</a><a href="#h1-0-24" id="h1-0-24" class="d">-    }
</a><a href="#h1-0-25" id="h1-0-25" class="d">-
</a><a href="#h1-0-26" id="h1-0-26" class="d">-    fun onLaunched(block: () -&gt; Unit) {
</a><a href="#h1-0-27" id="h1-0-27" class="d">-        onLaunched(Unit, block)
</a><a href="#h1-0-28" id="h1-0-28" class="d">-    }
</a><a href="#h1-0-29" id="h1-0-29" class="d">-
</a><a href="#h1-0-30" id="h1-0-30" class="d">-    fun onLaunched(key: Any, block: () -&gt; Unit) {
</a><a href="#h1-0-31" id="h1-0-31" class="d">-        nodes.add(ActionNode(ActionType.LAUNCHED, key, block))
</a><a href="#h1-0-32" id="h1-0-32" class="d">-    }
</a><a href="#h1-0-33" id="h1-0-33" class="d">-
</a><a href="#h1-0-34" id="h1-0-34" class="d">-    fun row(block: (InterfaceBuilder) -&gt; Unit) = RowColumnNode(NodeType.ROW).apply {
</a><a href="#h1-0-35" id="h1-0-35" class="d">-        children.addAll(InterfaceBuilder().apply(block).nodes)
</a><a href="#h1-0-36" id="h1-0-36" class="d">-    }.also { nodes.add(it) }
</a><a href="#h1-0-37" id="h1-0-37" class="d">-
</a><a href="#h1-0-38" id="h1-0-38" class="d">-    fun column(block: (InterfaceBuilder) -&gt; Unit) = RowColumnNode(NodeType.COLUMN).apply {
</a><a href="#h1-0-39" id="h1-0-39" class="d">-        children.addAll(InterfaceBuilder().apply(block).nodes)
</a><a href="#h1-0-40" id="h1-0-40" class="d">-    }.also { nodes.add(it) }
</a><a href="#h1-0-41" id="h1-0-41" class="d">-
</a><a href="#h1-0-42" id="h1-0-42" class="d">-    fun text(text: String) = createNode(NodeType.TEXT) {
</a><a href="#h1-0-43" id="h1-0-43" class="d">-        label(text)
</a><a href="#h1-0-44" id="h1-0-44" class="d">-    }
</a><a href="#h1-0-45" id="h1-0-45" class="d">-
</a><a href="#h1-0-46" id="h1-0-46" class="d">-    fun switch(state: Boolean?, callback: (Boolean) -&gt; Unit) = createNode(NodeType.SWITCH) {
</a><a href="#h1-0-47" id="h1-0-47" class="d">-        attributes[&quot;state&quot;] = state
</a><a href="#h1-0-48" id="h1-0-48" class="d">-        attributes[&quot;callback&quot;] = callback
</a><a href="#h1-0-49" id="h1-0-49" class="d">-    }
</a><a href="#h1-0-50" id="h1-0-50" class="d">-
</a><a href="#h1-0-51" id="h1-0-51" class="d">-    fun button(label: String, callback: () -&gt; Unit) = createNode(NodeType.BUTTON) {
</a><a href="#h1-0-52" id="h1-0-52" class="d">-        label(label)
</a><a href="#h1-0-53" id="h1-0-53" class="d">-        attributes[&quot;callback&quot;] = callback
</a><a href="#h1-0-54" id="h1-0-54" class="d">-    }
</a><a href="#h1-0-55" id="h1-0-55" class="d">-
</a><a href="#h1-0-56" id="h1-0-56" class="d">-    fun slider(min: Int, max: Int, step: Int, value: Int, callback: (Int) -&gt; Unit) = createNode(
</a><a href="#h1-0-57" id="h1-0-57" class="d">-        NodeType.SLIDER
</a><a href="#h1-0-58" id="h1-0-58" class="d">-    ) {
</a><a href="#h1-0-59" id="h1-0-59" class="d">-        attributes[&quot;value&quot;] = value
</a><a href="#h1-0-60" id="h1-0-60" class="d">-        attributes[&quot;min&quot;] = min
</a><a href="#h1-0-61" id="h1-0-61" class="d">-        attributes[&quot;max&quot;] = max
</a><a href="#h1-0-62" id="h1-0-62" class="d">-        attributes[&quot;step&quot;] = step
</a><a href="#h1-0-63" id="h1-0-63" class="d">-        attributes[&quot;callback&quot;] = callback
</a><a href="#h1-0-64" id="h1-0-64" class="d">-    }
</a><a href="#h1-0-65" id="h1-0-65" class="d">-
</a><a href="#h1-0-66" id="h1-0-66" class="d">-    fun list(label: String, items: List&lt;String&gt;, callback: (String) -&gt; Unit) = createNode(NodeType.LIST) {
</a><a href="#h1-0-67" id="h1-0-67" class="d">-        label(label)
</a><a href="#h1-0-68" id="h1-0-68" class="d">-        attributes[&quot;items&quot;] = items
</a><a href="#h1-0-69" id="h1-0-69" class="d">-        attributes[&quot;callback&quot;] = callback
</a><a href="#h1-0-70" id="h1-0-70" class="d">-    }
</a><a href="#h1-0-71" id="h1-0-71" class="d">-}
</a><a href="#h1-0-72" id="h1-0-72" class="d">-
</a><a href="#h1-0-73" id="h1-0-73" class="d">-
</a><a href="#h1-0-74" id="h1-0-74" class="d">-
</a><a href="#h1-0-75" id="h1-0-75" class="d">-class InterfaceManager : AbstractBinding(&quot;interface-manager&quot;, BindingSide.MANAGER) {
</a><a href="#h1-0-76" id="h1-0-76" class="d">-    private val interfaces = mutableMapOf&lt;String, () -&gt; InterfaceBuilder?&gt;()
</a><a href="#h1-0-77" id="h1-0-77" class="d">-
</a><a href="#h1-0-78" id="h1-0-78" class="d">-    fun buildInterface(name: String): InterfaceBuilder? {
</a><a href="#h1-0-79" id="h1-0-79" class="d">-        return interfaces[name]?.invoke()
</a><a href="#h1-0-80" id="h1-0-80" class="d">-    }
</a><a href="#h1-0-81" id="h1-0-81" class="d">-
</a><a href="#h1-0-82" id="h1-0-82" class="d">-    override fun onDispose() {
</a><a href="#h1-0-83" id="h1-0-83" class="d">-        interfaces.clear()
</a><a href="#h1-0-84" id="h1-0-84" class="d">-    }
</a><a href="#h1-0-85" id="h1-0-85" class="d">-
</a><a href="#h1-0-86" id="h1-0-86" class="d">-    @Suppress(&quot;unused&quot;)
</a><a href="#h1-0-87" id="h1-0-87" class="d">-    @JSFunction fun create(name: String, callback: Function) {
</a><a href="#h1-0-88" id="h1-0-88" class="d">-        interfaces[name] = {
</a><a href="#h1-0-89" id="h1-0-89" class="d">-            val interfaceBuilder = InterfaceBuilder()
</a><a href="#h1-0-90" id="h1-0-90" class="d">-            runCatching {
</a><a href="#h1-0-91" id="h1-0-91" class="d">-                contextScope {
</a><a href="#h1-0-92" id="h1-0-92" class="d">-                    callback.call(this, callback, callback, arrayOf(interfaceBuilder))
</a><a href="#h1-0-93" id="h1-0-93" class="d">-                }
</a><a href="#h1-0-94" id="h1-0-94" class="d">-                interfaceBuilder
</a><a href="#h1-0-95" id="h1-0-95" class="d">-            }.onFailure {
</a><a href="#h1-0-96" id="h1-0-96" class="d">-                context.runtime.logger.error(&quot;Failed to create interface $name for ${context.moduleInfo.name}&quot;, it)
</a><a href="#h1-0-97" id="h1-0-97" class="d">-            }.getOrNull()
</a><a href="#h1-0-98" id="h1-0-98" class="d">-        }
</a><a href="#h1-0-99" id="h1-0-99" class="d">-    }
</a><a href="#h1-0-100" id="h1-0-100" class="d">-
</a><a href="#h1-0-101" id="h1-0-101" class="d">-    override fun getObject() = this
</a><a href="#h1-0-102" id="h1-0-102" class="d">-}</a><a href="#h1-0-103" id="h1-0-103" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/Node.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/Node.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/Node.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/Node.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,52 +0,0 @@
</a><a href="#h2-0-0" id="h2-0-0" class="d">-package me.rhunk.snapenhance.scripting.impl.ui.components
</a><a href="#h2-0-1" id="h2-0-1" class="d">-
</a><a href="#h2-0-2" id="h2-0-2" class="d">-open class Node(
</a><a href="#h2-0-3" id="h2-0-3" class="d">-    val type: NodeType,
</a><a href="#h2-0-4" id="h2-0-4" class="d">-) {
</a><a href="#h2-0-5" id="h2-0-5" class="d">-    lateinit var uiChangeDetection: (key: String, value: Any?) -&gt; Unit
</a><a href="#h2-0-6" id="h2-0-6" class="d">-
</a><a href="#h2-0-7" id="h2-0-7" class="d">-    val children = mutableListOf&lt;Node&gt;()
</a><a href="#h2-0-8" id="h2-0-8" class="d">-    val attributes = object: HashMap&lt;String, Any?&gt;() {
</a><a href="#h2-0-9" id="h2-0-9" class="d">-        override fun put(key: String, value: Any?): Any? {
</a><a href="#h2-0-10" id="h2-0-10" class="d">-            return super.put(key, value).also {
</a><a href="#h2-0-11" id="h2-0-11" class="d">-                if (::uiChangeDetection.isInitialized) {
</a><a href="#h2-0-12" id="h2-0-12" class="d">-                    uiChangeDetection(key, value)
</a><a href="#h2-0-13" id="h2-0-13" class="d">-                }
</a><a href="#h2-0-14" id="h2-0-14" class="d">-            }
</a><a href="#h2-0-15" id="h2-0-15" class="d">-        }
</a><a href="#h2-0-16" id="h2-0-16" class="d">-    }
</a><a href="#h2-0-17" id="h2-0-17" class="d">-
</a><a href="#h2-0-18" id="h2-0-18" class="d">-    fun setAttribute(key: String, value: Any?) {
</a><a href="#h2-0-19" id="h2-0-19" class="d">-        attributes[key] = value
</a><a href="#h2-0-20" id="h2-0-20" class="d">-    }
</a><a href="#h2-0-21" id="h2-0-21" class="d">-
</a><a href="#h2-0-22" id="h2-0-22" class="d">-    fun fillMaxWidth(): Node {
</a><a href="#h2-0-23" id="h2-0-23" class="d">-        attributes[&quot;fillMaxWidth&quot;] = true
</a><a href="#h2-0-24" id="h2-0-24" class="d">-        return this
</a><a href="#h2-0-25" id="h2-0-25" class="d">-    }
</a><a href="#h2-0-26" id="h2-0-26" class="d">-
</a><a href="#h2-0-27" id="h2-0-27" class="d">-    fun fillMaxHeight(): Node {
</a><a href="#h2-0-28" id="h2-0-28" class="d">-        attributes[&quot;fillMaxHeight&quot;] = true
</a><a href="#h2-0-29" id="h2-0-29" class="d">-        return this
</a><a href="#h2-0-30" id="h2-0-30" class="d">-    }
</a><a href="#h2-0-31" id="h2-0-31" class="d">-
</a><a href="#h2-0-32" id="h2-0-32" class="d">-    fun label(text: String): Node {
</a><a href="#h2-0-33" id="h2-0-33" class="d">-        attributes[&quot;label&quot;] = text
</a><a href="#h2-0-34" id="h2-0-34" class="d">-        return this
</a><a href="#h2-0-35" id="h2-0-35" class="d">-    }
</a><a href="#h2-0-36" id="h2-0-36" class="d">-
</a><a href="#h2-0-37" id="h2-0-37" class="d">-    fun padding(padding: Int): Node {
</a><a href="#h2-0-38" id="h2-0-38" class="d">-        attributes[&quot;padding&quot;] = padding
</a><a href="#h2-0-39" id="h2-0-39" class="d">-        return this
</a><a href="#h2-0-40" id="h2-0-40" class="d">-    }
</a><a href="#h2-0-41" id="h2-0-41" class="d">-
</a><a href="#h2-0-42" id="h2-0-42" class="d">-    fun fontSize(size: Int): Node {
</a><a href="#h2-0-43" id="h2-0-43" class="d">-        attributes[&quot;fontSize&quot;] = size
</a><a href="#h2-0-44" id="h2-0-44" class="d">-        return this
</a><a href="#h2-0-45" id="h2-0-45" class="d">-    }
</a><a href="#h2-0-46" id="h2-0-46" class="d">-
</a><a href="#h2-0-47" id="h2-0-47" class="d">-    fun color(color: Long): Node {
</a><a href="#h2-0-48" id="h2-0-48" class="d">-        attributes[&quot;color&quot;] = color
</a><a href="#h2-0-49" id="h2-0-49" class="d">-        return this
</a><a href="#h2-0-50" id="h2-0-50" class="d">-    }
</a><a href="#h2-0-51" id="h2-0-51" class="d">-}
</a><b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/NodeType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/NodeType.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/NodeType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/NodeType.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,11 +0,0 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-package me.rhunk.snapenhance.scripting.impl.ui.components
</a><a href="#h3-0-1" id="h3-0-1" class="d">-enum class NodeType {
</a><a href="#h3-0-2" id="h3-0-2" class="d">-    ROW,
</a><a href="#h3-0-3" id="h3-0-3" class="d">-    COLUMN,
</a><a href="#h3-0-4" id="h3-0-4" class="d">-    TEXT,
</a><a href="#h3-0-5" id="h3-0-5" class="d">-    SWITCH,
</a><a href="#h3-0-6" id="h3-0-6" class="d">-    BUTTON,
</a><a href="#h3-0-7" id="h3-0-7" class="d">-    SLIDER,
</a><a href="#h3-0-8" id="h3-0-8" class="d">-    LIST,
</a><a href="#h3-0-9" id="h3-0-9" class="d">-    ACTION
</a><a href="#h3-0-10" id="h3-0-10" class="d">-}</a><a href="#h3-0-11" id="h3-0-11" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/ActionNode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/ActionNode.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/ActionNode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/ActionNode.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,15 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-package me.rhunk.snapenhance.scripting.impl.ui.components.impl
</a><a href="#h4-0-1" id="h4-0-1" class="d">-
</a><a href="#h4-0-2" id="h4-0-2" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.Node
</a><a href="#h4-0-3" id="h4-0-3" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.NodeType
</a><a href="#h4-0-4" id="h4-0-4" class="d">-
</a><a href="#h4-0-5" id="h4-0-5" class="d">-enum class ActionType {
</a><a href="#h4-0-6" id="h4-0-6" class="d">-    LAUNCHED,
</a><a href="#h4-0-7" id="h4-0-7" class="d">-    DISPOSE
</a><a href="#h4-0-8" id="h4-0-8" class="d">-}
</a><a href="#h4-0-9" id="h4-0-9" class="d">-
</a><a href="#h4-0-10" id="h4-0-10" class="d">-class ActionNode(
</a><a href="#h4-0-11" id="h4-0-11" class="d">-    val actionType: ActionType,
</a><a href="#h4-0-12" id="h4-0-12" class="d">-    val key: Any = Unit,
</a><a href="#h4-0-13" id="h4-0-13" class="d">-    val callback: () -&gt; Unit
</a><a href="#h4-0-14" id="h4-0-14" class="d">-): Node(NodeType.ACTION)</a><a href="#h4-0-15" id="h4-0-15" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/RowColumnNode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/RowColumnNode.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/RowColumnNode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/impl/ui/components/impl/RowColumnNode.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,47 +0,0 @@
</a><a href="#h5-0-0" id="h5-0-0" class="d">-package me.rhunk.snapenhance.scripting.impl.ui.components.impl
</a><a href="#h5-0-1" id="h5-0-1" class="d">-
</a><a href="#h5-0-2" id="h5-0-2" class="d">-import androidx.compose.foundation.layout.Arrangement
</a><a href="#h5-0-3" id="h5-0-3" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h5-0-4" id="h5-0-4" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.Node
</a><a href="#h5-0-5" id="h5-0-5" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.NodeType
</a><a href="#h5-0-6" id="h5-0-6" class="d">-
</a><a href="#h5-0-7" id="h5-0-7" class="d">-
</a><a href="#h5-0-8" id="h5-0-8" class="d">-class RowColumnNode(
</a><a href="#h5-0-9" id="h5-0-9" class="d">-    type: NodeType,
</a><a href="#h5-0-10" id="h5-0-10" class="d">-) : Node(type) {
</a><a href="#h5-0-11" id="h5-0-11" class="d">-    companion object {
</a><a href="#h5-0-12" id="h5-0-12" class="d">-        private val arrangements = mapOf(
</a><a href="#h5-0-13" id="h5-0-13" class="d">-            &quot;start&quot; to Arrangement.Start,
</a><a href="#h5-0-14" id="h5-0-14" class="d">-            &quot;end&quot; to Arrangement.End,
</a><a href="#h5-0-15" id="h5-0-15" class="d">-            &quot;top&quot; to Arrangement.Top,
</a><a href="#h5-0-16" id="h5-0-16" class="d">-            &quot;bottom&quot; to Arrangement.Bottom,
</a><a href="#h5-0-17" id="h5-0-17" class="d">-            &quot;center&quot; to Arrangement.Center,
</a><a href="#h5-0-18" id="h5-0-18" class="d">-            &quot;spaceBetween&quot; to Arrangement.SpaceBetween,
</a><a href="#h5-0-19" id="h5-0-19" class="d">-            &quot;spaceAround&quot; to Arrangement.SpaceAround,
</a><a href="#h5-0-20" id="h5-0-20" class="d">-            &quot;spaceEvenly&quot; to Arrangement.SpaceEvenly,
</a><a href="#h5-0-21" id="h5-0-21" class="d">-        )
</a><a href="#h5-0-22" id="h5-0-22" class="d">-        private val alignments = mapOf(
</a><a href="#h5-0-23" id="h5-0-23" class="d">-            &quot;start&quot; to Alignment.Start,
</a><a href="#h5-0-24" id="h5-0-24" class="d">-            &quot;end&quot; to Alignment.End,
</a><a href="#h5-0-25" id="h5-0-25" class="d">-            &quot;top&quot; to Alignment.Top,
</a><a href="#h5-0-26" id="h5-0-26" class="d">-            &quot;bottom&quot; to Alignment.Bottom,
</a><a href="#h5-0-27" id="h5-0-27" class="d">-            &quot;centerVertically&quot; to Alignment.CenterVertically,
</a><a href="#h5-0-28" id="h5-0-28" class="d">-            &quot;centerHorizontally&quot; to Alignment.CenterHorizontally,
</a><a href="#h5-0-29" id="h5-0-29" class="d">-        )
</a><a href="#h5-0-30" id="h5-0-30" class="d">-    }
</a><a href="#h5-0-31" id="h5-0-31" class="d">-
</a><a href="#h5-0-32" id="h5-0-32" class="d">-    fun arrangement(arrangement: String): RowColumnNode {
</a><a href="#h5-0-33" id="h5-0-33" class="d">-        attributes[&quot;arrangement&quot;] = arrangements[arrangement] ?: throw IllegalArgumentException(&quot;Invalid arrangement&quot;)
</a><a href="#h5-0-34" id="h5-0-34" class="d">-        return this
</a><a href="#h5-0-35" id="h5-0-35" class="d">-    }
</a><a href="#h5-0-36" id="h5-0-36" class="d">-
</a><a href="#h5-0-37" id="h5-0-37" class="d">-    fun alignment(alignment: String): RowColumnNode {
</a><a href="#h5-0-38" id="h5-0-38" class="d">-        attributes[&quot;alignment&quot;] = alignments[alignment] ?: throw IllegalArgumentException(&quot;Invalid alignment&quot;)
</a><a href="#h5-0-39" id="h5-0-39" class="d">-        return this
</a><a href="#h5-0-40" id="h5-0-40" class="d">-    }
</a><a href="#h5-0-41" id="h5-0-41" class="d">-
</a><a href="#h5-0-42" id="h5-0-42" class="d">-    fun spacedBy(spacing: Int): RowColumnNode {
</a><a href="#h5-0-43" id="h5-0-43" class="d">-        attributes[&quot;spacing&quot;] = spacing
</a><a href="#h5-0-44" id="h5-0-44" class="d">-        return this
</a><a href="#h5-0-45" id="h5-0-45" class="d">-    }
</a><a href="#h5-0-46" id="h5-0-46" class="d">-}</a><a href="#h5-0-47" id="h5-0-47" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptInterface.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptInterface.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptInterface.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptInterface.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,182 +0,0 @@
</a><a href="#h6-0-0" id="h6-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.sections.scripting
</a><a href="#h6-0-1" id="h6-0-1" class="d">-
</a><a href="#h6-0-2" id="h6-0-2" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h6-0-3" id="h6-0-3" class="d">-import androidx.compose.material3.OutlinedButton
</a><a href="#h6-0-4" id="h6-0-4" class="d">-import androidx.compose.material3.Slider
</a><a href="#h6-0-5" id="h6-0-5" class="d">-import androidx.compose.material3.Switch
</a><a href="#h6-0-6" id="h6-0-6" class="d">-import androidx.compose.material3.Text
</a><a href="#h6-0-7" id="h6-0-7" class="d">-import androidx.compose.runtime.*
</a><a href="#h6-0-8" id="h6-0-8" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h6-0-9" id="h6-0-9" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h6-0-10" id="h6-0-10" class="d">-import androidx.compose.ui.graphics.Color
</a><a href="#h6-0-11" id="h6-0-11" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h6-0-12" id="h6-0-12" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h6-0-13" id="h6-0-13" class="d">-import kotlinx.coroutines.launch
</a><a href="#h6-0-14" id="h6-0-14" class="d">-import me.rhunk.snapenhance.common.logger.AbstractLogger
</a><a href="#h6-0-15" id="h6-0-15" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.InterfaceBuilder
</a><a href="#h6-0-16" id="h6-0-16" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.Node
</a><a href="#h6-0-17" id="h6-0-17" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.NodeType
</a><a href="#h6-0-18" id="h6-0-18" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.impl.ActionNode
</a><a href="#h6-0-19" id="h6-0-19" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.components.impl.ActionType
</a><a href="#h6-0-20" id="h6-0-20" class="d">-import kotlin.math.abs
</a><a href="#h6-0-21" id="h6-0-21" class="d">-
</a><a href="#h6-0-22" id="h6-0-22" class="d">-
</a><a href="#h6-0-23" id="h6-0-23" class="d">-@Composable
</a><a href="#h6-0-24" id="h6-0-24" class="d">-@Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h6-0-25" id="h6-0-25" class="d">-private fun DrawNode(node: Node) {
</a><a href="#h6-0-26" id="h6-0-26" class="d">-    val coroutineScope = rememberCoroutineScope()
</a><a href="#h6-0-27" id="h6-0-27" class="d">-    val cachedAttributes = remember { mutableStateMapOf(*node.attributes.toList().toTypedArray()) }
</a><a href="#h6-0-28" id="h6-0-28" class="d">-
</a><a href="#h6-0-29" id="h6-0-29" class="d">-    node.uiChangeDetection = { key, value -&gt;
</a><a href="#h6-0-30" id="h6-0-30" class="d">-        coroutineScope.launch {
</a><a href="#h6-0-31" id="h6-0-31" class="d">-            cachedAttributes[key] = value
</a><a href="#h6-0-32" id="h6-0-32" class="d">-        }
</a><a href="#h6-0-33" id="h6-0-33" class="d">-    }
</a><a href="#h6-0-34" id="h6-0-34" class="d">-
</a><a href="#h6-0-35" id="h6-0-35" class="d">-    DisposableEffect(Unit) {
</a><a href="#h6-0-36" id="h6-0-36" class="d">-        onDispose {
</a><a href="#h6-0-37" id="h6-0-37" class="d">-            node.uiChangeDetection = { _, _ -&gt; }
</a><a href="#h6-0-38" id="h6-0-38" class="d">-        }
</a><a href="#h6-0-39" id="h6-0-39" class="d">-    }
</a><a href="#h6-0-40" id="h6-0-40" class="d">-
</a><a href="#h6-0-41" id="h6-0-41" class="d">-    val arrangement = cachedAttributes[&quot;arrangement&quot;]
</a><a href="#h6-0-42" id="h6-0-42" class="d">-    val alignment = cachedAttributes[&quot;alignment&quot;]
</a><a href="#h6-0-43" id="h6-0-43" class="d">-    val spacing = cachedAttributes[&quot;spacing&quot;]?.toString()?.toInt()?.let { abs(it) }
</a><a href="#h6-0-44" id="h6-0-44" class="d">-
</a><a href="#h6-0-45" id="h6-0-45" class="d">-    val rowColumnModifier = Modifier
</a><a href="#h6-0-46" id="h6-0-46" class="d">-        .then(if (cachedAttributes[&quot;fillMaxWidth&quot;] as? Boolean == true) Modifier.fillMaxWidth() else Modifier)
</a><a href="#h6-0-47" id="h6-0-47" class="d">-        .then(if (cachedAttributes[&quot;fillMaxHeight&quot;] as? Boolean == true) Modifier.fillMaxHeight() else Modifier)
</a><a href="#h6-0-48" id="h6-0-48" class="d">-        .padding(
</a><a href="#h6-0-49" id="h6-0-49" class="d">-            (cachedAttributes[&quot;padding&quot;]
</a><a href="#h6-0-50" id="h6-0-50" class="d">-                ?.toString()
</a><a href="#h6-0-51" id="h6-0-51" class="d">-                ?.toInt()
</a><a href="#h6-0-52" id="h6-0-52" class="d">-                ?.let { abs(it) } ?: 2).dp)
</a><a href="#h6-0-53" id="h6-0-53" class="d">-
</a><a href="#h6-0-54" id="h6-0-54" class="d">-    fun runCallbackSafe(callback: () -&gt; Unit) {
</a><a href="#h6-0-55" id="h6-0-55" class="d">-        runCatching {
</a><a href="#h6-0-56" id="h6-0-56" class="d">-            callback()
</a><a href="#h6-0-57" id="h6-0-57" class="d">-        }.onFailure {
</a><a href="#h6-0-58" id="h6-0-58" class="d">-            AbstractLogger.directError(&quot;Error running callback&quot;, it)
</a><a href="#h6-0-59" id="h6-0-59" class="d">-        }
</a><a href="#h6-0-60" id="h6-0-60" class="d">-    }
</a><a href="#h6-0-61" id="h6-0-61" class="d">-
</a><a href="#h6-0-62" id="h6-0-62" class="d">-    @Composable
</a><a href="#h6-0-63" id="h6-0-63" class="d">-    fun NodeLabel() {
</a><a href="#h6-0-64" id="h6-0-64" class="d">-        Text(
</a><a href="#h6-0-65" id="h6-0-65" class="d">-            text = cachedAttributes[&quot;label&quot;] as String,
</a><a href="#h6-0-66" id="h6-0-66" class="d">-            fontSize = (cachedAttributes[&quot;fontSize&quot;]?.toString()?.toInt() ?: 14).sp,
</a><a href="#h6-0-67" id="h6-0-67" class="d">-            color = (cachedAttributes[&quot;color&quot;] as? Long)?.let { Color(it) } ?: Color.Unspecified
</a><a href="#h6-0-68" id="h6-0-68" class="d">-        )
</a><a href="#h6-0-69" id="h6-0-69" class="d">-    }
</a><a href="#h6-0-70" id="h6-0-70" class="d">-
</a><a href="#h6-0-71" id="h6-0-71" class="d">-    when (node.type) {
</a><a href="#h6-0-72" id="h6-0-72" class="d">-        NodeType.ACTION -&gt; {
</a><a href="#h6-0-73" id="h6-0-73" class="d">-            when ((node as ActionNode).actionType) {
</a><a href="#h6-0-74" id="h6-0-74" class="d">-                ActionType.LAUNCHED -&gt; {
</a><a href="#h6-0-75" id="h6-0-75" class="d">-                    LaunchedEffect(node.key) {
</a><a href="#h6-0-76" id="h6-0-76" class="d">-                        runCallbackSafe {
</a><a href="#h6-0-77" id="h6-0-77" class="d">-                            node.callback()
</a><a href="#h6-0-78" id="h6-0-78" class="d">-                        }
</a><a href="#h6-0-79" id="h6-0-79" class="d">-                    }
</a><a href="#h6-0-80" id="h6-0-80" class="d">-                }
</a><a href="#h6-0-81" id="h6-0-81" class="d">-                ActionType.DISPOSE -&gt; {
</a><a href="#h6-0-82" id="h6-0-82" class="d">-                    DisposableEffect(Unit) {
</a><a href="#h6-0-83" id="h6-0-83" class="d">-                        onDispose {
</a><a href="#h6-0-84" id="h6-0-84" class="d">-                            runCallbackSafe {
</a><a href="#h6-0-85" id="h6-0-85" class="d">-                                node.callback()
</a><a href="#h6-0-86" id="h6-0-86" class="d">-                            }
</a><a href="#h6-0-87" id="h6-0-87" class="d">-                        }
</a><a href="#h6-0-88" id="h6-0-88" class="d">-                    }
</a><a href="#h6-0-89" id="h6-0-89" class="d">-                }
</a><a href="#h6-0-90" id="h6-0-90" class="d">-            }
</a><a href="#h6-0-91" id="h6-0-91" class="d">-        }
</a><a href="#h6-0-92" id="h6-0-92" class="d">-        NodeType.COLUMN -&gt; {
</a><a href="#h6-0-93" id="h6-0-93" class="d">-            Column(
</a><a href="#h6-0-94" id="h6-0-94" class="d">-                verticalArrangement = arrangement as? Arrangement.Vertical ?: spacing?.let { Arrangement.spacedBy(it.dp) } ?: Arrangement.Top,
</a><a href="#h6-0-95" id="h6-0-95" class="d">-                horizontalAlignment = alignment as? Alignment.Horizontal ?: Alignment.Start,
</a><a href="#h6-0-96" id="h6-0-96" class="d">-                modifier = rowColumnModifier
</a><a href="#h6-0-97" id="h6-0-97" class="d">-            ) {
</a><a href="#h6-0-98" id="h6-0-98" class="d">-                node.children.forEach { child -&gt;
</a><a href="#h6-0-99" id="h6-0-99" class="d">-                    DrawNode(child)
</a><a href="#h6-0-100" id="h6-0-100" class="d">-                }
</a><a href="#h6-0-101" id="h6-0-101" class="d">-            }
</a><a href="#h6-0-102" id="h6-0-102" class="d">-        }
</a><a href="#h6-0-103" id="h6-0-103" class="d">-        NodeType.ROW -&gt; {
</a><a href="#h6-0-104" id="h6-0-104" class="d">-            Row(
</a><a href="#h6-0-105" id="h6-0-105" class="d">-                horizontalArrangement = arrangement as? Arrangement.Horizontal ?: spacing?.let { Arrangement.spacedBy(it.dp) } ?: Arrangement.SpaceBetween,
</a><a href="#h6-0-106" id="h6-0-106" class="d">-                verticalAlignment = alignment as? Alignment.Vertical ?: Alignment.CenterVertically,
</a><a href="#h6-0-107" id="h6-0-107" class="d">-                modifier = rowColumnModifier
</a><a href="#h6-0-108" id="h6-0-108" class="d">-            ) {
</a><a href="#h6-0-109" id="h6-0-109" class="d">-                node.children.forEach { child -&gt;
</a><a href="#h6-0-110" id="h6-0-110" class="d">-                    DrawNode(child)
</a><a href="#h6-0-111" id="h6-0-111" class="d">-                }
</a><a href="#h6-0-112" id="h6-0-112" class="d">-            }
</a><a href="#h6-0-113" id="h6-0-113" class="d">-        }
</a><a href="#h6-0-114" id="h6-0-114" class="d">-        NodeType.TEXT -&gt; NodeLabel()
</a><a href="#h6-0-115" id="h6-0-115" class="d">-        NodeType.SWITCH -&gt; {
</a><a href="#h6-0-116" id="h6-0-116" class="d">-            var switchState by remember {
</a><a href="#h6-0-117" id="h6-0-117" class="d">-                mutableStateOf(cachedAttributes[&quot;state&quot;] as Boolean)
</a><a href="#h6-0-118" id="h6-0-118" class="d">-            }
</a><a href="#h6-0-119" id="h6-0-119" class="d">-            Switch(
</a><a href="#h6-0-120" id="h6-0-120" class="d">-                checked = switchState,
</a><a href="#h6-0-121" id="h6-0-121" class="d">-                onCheckedChange = { state -&gt;
</a><a href="#h6-0-122" id="h6-0-122" class="d">-                    runCallbackSafe {
</a><a href="#h6-0-123" id="h6-0-123" class="d">-                        switchState = state
</a><a href="#h6-0-124" id="h6-0-124" class="d">-                        node.setAttribute(&quot;state&quot;, state)
</a><a href="#h6-0-125" id="h6-0-125" class="d">-                        (cachedAttributes[&quot;callback&quot;] as? (Boolean) -&gt; Unit)?.let { it(state) }
</a><a href="#h6-0-126" id="h6-0-126" class="d">-                    }
</a><a href="#h6-0-127" id="h6-0-127" class="d">-                }
</a><a href="#h6-0-128" id="h6-0-128" class="d">-            )
</a><a href="#h6-0-129" id="h6-0-129" class="d">-        }
</a><a href="#h6-0-130" id="h6-0-130" class="d">-        NodeType.SLIDER -&gt; {
</a><a href="#h6-0-131" id="h6-0-131" class="d">-            var sliderValue by remember {
</a><a href="#h6-0-132" id="h6-0-132" class="d">-                mutableFloatStateOf((cachedAttributes[&quot;value&quot;] as Int).toFloat())
</a><a href="#h6-0-133" id="h6-0-133" class="d">-            }
</a><a href="#h6-0-134" id="h6-0-134" class="d">-            Slider(
</a><a href="#h6-0-135" id="h6-0-135" class="d">-                value = sliderValue,
</a><a href="#h6-0-136" id="h6-0-136" class="d">-                onValueChange = { value -&gt;
</a><a href="#h6-0-137" id="h6-0-137" class="d">-                    runCallbackSafe {
</a><a href="#h6-0-138" id="h6-0-138" class="d">-                        sliderValue = value
</a><a href="#h6-0-139" id="h6-0-139" class="d">-                        node.setAttribute(&quot;value&quot;, value.toInt())
</a><a href="#h6-0-140" id="h6-0-140" class="d">-                        (cachedAttributes[&quot;callback&quot;] as? (Int) -&gt; Unit)?.let { it(value.toInt()) }
</a><a href="#h6-0-141" id="h6-0-141" class="d">-                    }
</a><a href="#h6-0-142" id="h6-0-142" class="d">-                },
</a><a href="#h6-0-143" id="h6-0-143" class="d">-                valueRange = (cachedAttributes[&quot;min&quot;] as Int).toFloat()..(cachedAttributes[&quot;max&quot;] as Int).toFloat(),
</a><a href="#h6-0-144" id="h6-0-144" class="d">-                steps = cachedAttributes[&quot;step&quot;] as Int,
</a><a href="#h6-0-145" id="h6-0-145" class="d">-            )
</a><a href="#h6-0-146" id="h6-0-146" class="d">-        }
</a><a href="#h6-0-147" id="h6-0-147" class="d">-        NodeType.BUTTON -&gt; {
</a><a href="#h6-0-148" id="h6-0-148" class="d">-            OutlinedButton(onClick = {
</a><a href="#h6-0-149" id="h6-0-149" class="d">-                runCallbackSafe {
</a><a href="#h6-0-150" id="h6-0-150" class="d">-                    (cachedAttributes[&quot;callback&quot;] as? () -&gt; Unit)?.let { it() }
</a><a href="#h6-0-151" id="h6-0-151" class="d">-                }
</a><a href="#h6-0-152" id="h6-0-152" class="d">-            }) {
</a><a href="#h6-0-153" id="h6-0-153" class="d">-                NodeLabel()
</a><a href="#h6-0-154" id="h6-0-154" class="d">-            }
</a><a href="#h6-0-155" id="h6-0-155" class="d">-        }
</a><a href="#h6-0-156" id="h6-0-156" class="d">-        else -&gt; {}
</a><a href="#h6-0-157" id="h6-0-157" class="d">-    }
</a><a href="#h6-0-158" id="h6-0-158" class="d">-}
</a><a href="#h6-0-159" id="h6-0-159" class="d">-
</a><a href="#h6-0-160" id="h6-0-160" class="d">-@Composable
</a><a href="#h6-0-161" id="h6-0-161" class="d">-fun ScriptInterface(interfaceBuilder: InterfaceBuilder) {
</a><a href="#h6-0-162" id="h6-0-162" class="d">-    Column(
</a><a href="#h6-0-163" id="h6-0-163" class="d">-        modifier = Modifier
</a><a href="#h6-0-164" id="h6-0-164" class="d">-            .fillMaxWidth()
</a><a href="#h6-0-165" id="h6-0-165" class="d">-            .padding(8.dp)
</a><a href="#h6-0-166" id="h6-0-166" class="d">-    ) {
</a><a href="#h6-0-167" id="h6-0-167" class="d">-        interfaceBuilder.nodes.forEach { node -&gt;
</a><a href="#h6-0-168" id="h6-0-168" class="d">-            DrawNode(node)
</a><a href="#h6-0-169" id="h6-0-169" class="d">-        }
</a><a href="#h6-0-170" id="h6-0-170" class="d">-
</a><a href="#h6-0-171" id="h6-0-171" class="d">-        DisposableEffect(Unit) {
</a><a href="#h6-0-172" id="h6-0-172" class="d">-            onDispose {
</a><a href="#h6-0-173" id="h6-0-173" class="d">-                runCatching {
</a><a href="#h6-0-174" id="h6-0-174" class="d">-                    interfaceBuilder.onDisposeCallback?.invoke()
</a><a href="#h6-0-175" id="h6-0-175" class="d">-                }.onFailure {
</a><a href="#h6-0-176" id="h6-0-176" class="d">-                    AbstractLogger.directError(&quot;Error running onDisposed callback&quot;, it)
</a><a href="#h6-0-177" id="h6-0-177" class="d">-                }
</a><a href="#h6-0-178" id="h6-0-178" class="d">-            }
</a><a href="#h6-0-179" id="h6-0-179" class="d">-        }
</a><a href="#h6-0-180" id="h6-0-180" class="d">-    }
</a><a href="#h6-0-181" id="h6-0-181" class="d">-}</a><a href="#h6-0-182" id="h6-0-182" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptsSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptsSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptsSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/scripting/ScriptsSection.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -20,7 +20,9 @@ import androidx.documentfile.provider.DocumentFile
</a> import kotlinx.coroutines.delay
 import kotlinx.coroutines.launch
 import me.rhunk.snapenhance.common.scripting.type.ModuleInfo
<a href="#h7-0-3" id="h7-0-3" class="d">-import me.rhunk.snapenhance.scripting.impl.ui.InterfaceManager
</a><a href="#h7-0-4" id="h7-0-4" class="i">+import me.rhunk.snapenhance.common.scripting.ui.EnumScriptInterface
</a><a href="#h7-0-5" id="h7-0-5" class="i">+import me.rhunk.snapenhance.common.scripting.ui.InterfaceManager
</a><a href="#h7-0-6" id="h7-0-6" class="i">+import me.rhunk.snapenhance.common.scripting.ui.ScriptInterface
</a> import me.rhunk.snapenhance.ui.manager.Section
 import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
 import me.rhunk.snapenhance.ui.util.chooseFolder
<a href="#h7-1" id="h7-1" class="h">@@ -140,22 +142,14 @@ class ScriptsSection : Section() {
</a> 
     @Composable
     fun ScriptSettings(script: ModuleInfo) {
<a href="#h7-1-3" id="h7-1-3" class="d">-        var settingsError by remember {
</a><a href="#h7-1-4" id="h7-1-4" class="d">-            mutableStateOf(null as Throwable?)
</a><a href="#h7-1-5" id="h7-1-5" class="d">-        }
</a><a href="#h7-1-6" id="h7-1-6" class="d">-
</a>         val settingsInterface = remember {
             val module = context.scriptManager.runtime.getModuleByName(script.name) ?: return@remember null
<a href="#h7-1-9" id="h7-1-9" class="d">-            runCatching {
</a><a href="#h7-1-10" id="h7-1-10" class="d">-                (module.getBinding(InterfaceManager::class))?.buildInterface(&quot;settings&quot;)
</a><a href="#h7-1-11" id="h7-1-11" class="d">-            }.onFailure {
</a><a href="#h7-1-12" id="h7-1-12" class="d">-                settingsError = it
</a><a href="#h7-1-13" id="h7-1-13" class="d">-            }.getOrNull()
</a><a href="#h7-1-14" id="h7-1-14" class="i">+            (module.getBinding(InterfaceManager::class))?.buildInterface(EnumScriptInterface.SETTINGS)
</a>         }
 
         if (settingsInterface == null) {
             Text(
<a href="#h7-1-19" id="h7-1-19" class="d">-                text = settingsError?.message ?: &quot;This module does not have any settings&quot;,
</a><a href="#h7-1-20" id="h7-1-20" class="i">+                text = &quot;This module does not have any settings&quot;,
</a>                 style = MaterialTheme.typography.bodySmall,
                 modifier = Modifier.padding(8.dp)
             )
<b>diff --git a/<a id="h8" href="../file/common/src/main/assets/lang/en_US.json.html">common/src/main/assets/lang/en_US.json</a> b/<a href="../file/common/src/main/assets/lang/en_US.json.html">common/src/main/assets/lang/en_US.json</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -703,6 +703,10 @@
</a>                         &quot;name&quot;: &quot;Auto Reload&quot;,
                         &quot;description&quot;: &quot;Automatically reloads scripts when they change&quot;
                     },
<a href="#h8-0-3" id="h8-0-3" class="i">+                    &quot;integrated_ui&quot;: {
</a><a href="#h8-0-4" id="h8-0-4" class="i">+                        &quot;name&quot;: &quot;Integrated UI&quot;,
</a><a href="#h8-0-5" id="h8-0-5" class="i">+                        &quot;description&quot;: &quot;Allows scripts to add custom UI components to Snapchat&quot;
</a><a href="#h8-0-6" id="h8-0-6" class="i">+                    },
</a>                     &quot;disable_log_anonymization&quot;: {
                         &quot;name&quot;: &quot;Disable Log Anonymization&quot;,
                         &quot;description&quot;: &quot;Disables the anonymization of logs&quot;
<b>diff --git a/<a id="h9" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Scripting.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Scripting.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Scripting.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Scripting.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -7,5 +7,6 @@ class Scripting : ConfigContainer() {
</a>     val developerMode = boolean(&quot;developer_mode&quot;, false) { requireRestart() }
     val moduleFolder = string(&quot;module_folder&quot;, &quot;modules&quot;) { addFlags(ConfigFlag.FOLDER); requireRestart()  }
     val autoReload = unique(&quot;auto_reload&quot;, &quot;snapchat_only&quot;, &quot;all&quot;)
<a href="#h9-0-3" id="h9-0-3" class="i">+    val integratedUI = boolean(&quot;integrated_ui&quot;, false) { requireRestart() }
</a>     val disableLogAnonymization = boolean(&quot;disable_log_anonymization&quot;, false) { requireRestart() }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h10" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/JSModule.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/JSModule.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/JSModule.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/JSModule.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -11,6 +11,7 @@ import me.rhunk.snapenhance.common.scripting.ktx.scriptable
</a> import me.rhunk.snapenhance.common.scripting.ktx.scriptableObject
 import me.rhunk.snapenhance.common.scripting.type.ModuleInfo
 import me.rhunk.snapenhance.common.scripting.type.Permissions
<a href="#h10-0-3" id="h10-0-3" class="i">+import me.rhunk.snapenhance.common.scripting.ui.InterfaceManager
</a> import org.mozilla.javascript.Function
 import org.mozilla.javascript.NativeJavaObject
 import org.mozilla.javascript.ScriptableObject
<a href="#h10-1" id="h10-1" class="h">@@ -53,6 +54,7 @@ class JSModule(
</a> 
             registerBindings(
                 JavaInterfaces(),
<a href="#h10-1-3" id="h10-1-3" class="i">+                InterfaceManager(),
</a>             )
 
             moduleObject.putFunction(&quot;setField&quot;) { args -&gt;
<b>diff --git a/<a id="h11" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/EnumScriptInterface.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/EnumScriptInterface.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/EnumScriptInterface.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/EnumScriptInterface.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,11 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+package me.rhunk.snapenhance.common.scripting.ui
</a><a href="#h11-0-1" id="h11-0-1" class="i">+
</a><a href="#h11-0-2" id="h11-0-2" class="i">+import me.rhunk.snapenhance.common.scripting.bindings.BindingSide
</a><a href="#h11-0-3" id="h11-0-3" class="i">+
</a><a href="#h11-0-4" id="h11-0-4" class="i">+enum class EnumScriptInterface(
</a><a href="#h11-0-5" id="h11-0-5" class="i">+    val key: String,
</a><a href="#h11-0-6" id="h11-0-6" class="i">+    val side: BindingSide
</a><a href="#h11-0-7" id="h11-0-7" class="i">+) {
</a><a href="#h11-0-8" id="h11-0-8" class="i">+    SETTINGS(&quot;settings&quot;, BindingSide.MANAGER),
</a><a href="#h11-0-9" id="h11-0-9" class="i">+    FRIEND_FEED_CONTEXT_MENU(&quot;friendFeedContextMenu&quot;, BindingSide.CORE),
</a><a href="#h11-0-10" id="h11-0-10" class="i">+}</a><a href="#h11-0-11" id="h11-0-11" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h12" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/InterfaceManager.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/InterfaceManager.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/InterfaceManager.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/InterfaceManager.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,116 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+package me.rhunk.snapenhance.common.scripting.ui
</a><a href="#h12-0-1" id="h12-0-1" class="i">+
</a><a href="#h12-0-2" id="h12-0-2" class="i">+import me.rhunk.snapenhance.common.scripting.bindings.AbstractBinding
</a><a href="#h12-0-3" id="h12-0-3" class="i">+import me.rhunk.snapenhance.common.scripting.bindings.BindingSide
</a><a href="#h12-0-4" id="h12-0-4" class="i">+import me.rhunk.snapenhance.common.scripting.ktx.contextScope
</a><a href="#h12-0-5" id="h12-0-5" class="i">+import me.rhunk.snapenhance.common.scripting.ktx.scriptableObject
</a><a href="#h12-0-6" id="h12-0-6" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.Node
</a><a href="#h12-0-7" id="h12-0-7" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.NodeType
</a><a href="#h12-0-8" id="h12-0-8" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.impl.ActionNode
</a><a href="#h12-0-9" id="h12-0-9" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.impl.ActionType
</a><a href="#h12-0-10" id="h12-0-10" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.impl.RowColumnNode
</a><a href="#h12-0-11" id="h12-0-11" class="i">+import org.mozilla.javascript.Function
</a><a href="#h12-0-12" id="h12-0-12" class="i">+import org.mozilla.javascript.annotations.JSFunction
</a><a href="#h12-0-13" id="h12-0-13" class="i">+
</a><a href="#h12-0-14" id="h12-0-14" class="i">+
</a><a href="#h12-0-15" id="h12-0-15" class="i">+class InterfaceBuilder {
</a><a href="#h12-0-16" id="h12-0-16" class="i">+    val nodes = mutableListOf&lt;Node&gt;()
</a><a href="#h12-0-17" id="h12-0-17" class="i">+    var onDisposeCallback: (() -&gt; Unit)? = null
</a><a href="#h12-0-18" id="h12-0-18" class="i">+
</a><a href="#h12-0-19" id="h12-0-19" class="i">+    private fun createNode(type: NodeType, block: Node.() -&gt; Unit): Node {
</a><a href="#h12-0-20" id="h12-0-20" class="i">+        return Node(type).apply(block).also { nodes.add(it) }
</a><a href="#h12-0-21" id="h12-0-21" class="i">+    }
</a><a href="#h12-0-22" id="h12-0-22" class="i">+
</a><a href="#h12-0-23" id="h12-0-23" class="i">+    fun onDispose(block: () -&gt; Unit) {
</a><a href="#h12-0-24" id="h12-0-24" class="i">+        nodes.add(ActionNode(ActionType.DISPOSE, callback = block))
</a><a href="#h12-0-25" id="h12-0-25" class="i">+    }
</a><a href="#h12-0-26" id="h12-0-26" class="i">+
</a><a href="#h12-0-27" id="h12-0-27" class="i">+    fun onLaunched(block: () -&gt; Unit) {
</a><a href="#h12-0-28" id="h12-0-28" class="i">+        onLaunched(Unit, block)
</a><a href="#h12-0-29" id="h12-0-29" class="i">+    }
</a><a href="#h12-0-30" id="h12-0-30" class="i">+
</a><a href="#h12-0-31" id="h12-0-31" class="i">+    fun onLaunched(key: Any, block: () -&gt; Unit) {
</a><a href="#h12-0-32" id="h12-0-32" class="i">+        nodes.add(ActionNode(ActionType.LAUNCHED, key, block))
</a><a href="#h12-0-33" id="h12-0-33" class="i">+    }
</a><a href="#h12-0-34" id="h12-0-34" class="i">+
</a><a href="#h12-0-35" id="h12-0-35" class="i">+    fun row(block: (InterfaceBuilder) -&gt; Unit) = RowColumnNode(NodeType.ROW).apply {
</a><a href="#h12-0-36" id="h12-0-36" class="i">+        children.addAll(InterfaceBuilder().apply(block).nodes)
</a><a href="#h12-0-37" id="h12-0-37" class="i">+    }.also { nodes.add(it) }
</a><a href="#h12-0-38" id="h12-0-38" class="i">+
</a><a href="#h12-0-39" id="h12-0-39" class="i">+    fun column(block: (InterfaceBuilder) -&gt; Unit) = RowColumnNode(NodeType.COLUMN).apply {
</a><a href="#h12-0-40" id="h12-0-40" class="i">+        children.addAll(InterfaceBuilder().apply(block).nodes)
</a><a href="#h12-0-41" id="h12-0-41" class="i">+    }.also { nodes.add(it) }
</a><a href="#h12-0-42" id="h12-0-42" class="i">+
</a><a href="#h12-0-43" id="h12-0-43" class="i">+    fun text(text: String) = createNode(NodeType.TEXT) {
</a><a href="#h12-0-44" id="h12-0-44" class="i">+        label(text)
</a><a href="#h12-0-45" id="h12-0-45" class="i">+    }
</a><a href="#h12-0-46" id="h12-0-46" class="i">+
</a><a href="#h12-0-47" id="h12-0-47" class="i">+    fun switch(state: Boolean?, callback: (Boolean) -&gt; Unit) = createNode(NodeType.SWITCH) {
</a><a href="#h12-0-48" id="h12-0-48" class="i">+        attributes[&quot;state&quot;] = state
</a><a href="#h12-0-49" id="h12-0-49" class="i">+        attributes[&quot;callback&quot;] = callback
</a><a href="#h12-0-50" id="h12-0-50" class="i">+    }
</a><a href="#h12-0-51" id="h12-0-51" class="i">+
</a><a href="#h12-0-52" id="h12-0-52" class="i">+    fun button(label: String, callback: () -&gt; Unit) = createNode(NodeType.BUTTON) {
</a><a href="#h12-0-53" id="h12-0-53" class="i">+        label(label)
</a><a href="#h12-0-54" id="h12-0-54" class="i">+        attributes[&quot;callback&quot;] = callback
</a><a href="#h12-0-55" id="h12-0-55" class="i">+    }
</a><a href="#h12-0-56" id="h12-0-56" class="i">+
</a><a href="#h12-0-57" id="h12-0-57" class="i">+    fun slider(min: Int, max: Int, step: Int, value: Int, callback: (Int) -&gt; Unit) = createNode(
</a><a href="#h12-0-58" id="h12-0-58" class="i">+        NodeType.SLIDER
</a><a href="#h12-0-59" id="h12-0-59" class="i">+    ) {
</a><a href="#h12-0-60" id="h12-0-60" class="i">+        attributes[&quot;value&quot;] = value
</a><a href="#h12-0-61" id="h12-0-61" class="i">+        attributes[&quot;min&quot;] = min
</a><a href="#h12-0-62" id="h12-0-62" class="i">+        attributes[&quot;max&quot;] = max
</a><a href="#h12-0-63" id="h12-0-63" class="i">+        attributes[&quot;step&quot;] = step
</a><a href="#h12-0-64" id="h12-0-64" class="i">+        attributes[&quot;callback&quot;] = callback
</a><a href="#h12-0-65" id="h12-0-65" class="i">+    }
</a><a href="#h12-0-66" id="h12-0-66" class="i">+
</a><a href="#h12-0-67" id="h12-0-67" class="i">+    fun list(label: String, items: List&lt;String&gt;, callback: (String) -&gt; Unit) = createNode(NodeType.LIST) {
</a><a href="#h12-0-68" id="h12-0-68" class="i">+        label(label)
</a><a href="#h12-0-69" id="h12-0-69" class="i">+        attributes[&quot;items&quot;] = items
</a><a href="#h12-0-70" id="h12-0-70" class="i">+        attributes[&quot;callback&quot;] = callback
</a><a href="#h12-0-71" id="h12-0-71" class="i">+    }
</a><a href="#h12-0-72" id="h12-0-72" class="i">+}
</a><a href="#h12-0-73" id="h12-0-73" class="i">+
</a><a href="#h12-0-74" id="h12-0-74" class="i">+
</a><a href="#h12-0-75" id="h12-0-75" class="i">+
</a><a href="#h12-0-76" id="h12-0-76" class="i">+class InterfaceManager : AbstractBinding(&quot;interface-manager&quot;, BindingSide.COMMON) {
</a><a href="#h12-0-77" id="h12-0-77" class="i">+    private val interfaces = mutableMapOf&lt;String, (args: Map&lt;String, Any?&gt;) -&gt; InterfaceBuilder?&gt;()
</a><a href="#h12-0-78" id="h12-0-78" class="i">+
</a><a href="#h12-0-79" id="h12-0-79" class="i">+    fun buildInterface(scriptInterface: EnumScriptInterface, args: Map&lt;String, Any?&gt; = emptyMap()): InterfaceBuilder? {
</a><a href="#h12-0-80" id="h12-0-80" class="i">+        return runCatching {
</a><a href="#h12-0-81" id="h12-0-81" class="i">+            interfaces[scriptInterface.key]?.invoke(args)
</a><a href="#h12-0-82" id="h12-0-82" class="i">+        }.onFailure {
</a><a href="#h12-0-83" id="h12-0-83" class="i">+            context.runtime.logger.error(&quot;Failed to build interface ${scriptInterface.key} for ${context.moduleInfo.name}&quot;, it)
</a><a href="#h12-0-84" id="h12-0-84" class="i">+        }.getOrNull()
</a><a href="#h12-0-85" id="h12-0-85" class="i">+    }
</a><a href="#h12-0-86" id="h12-0-86" class="i">+
</a><a href="#h12-0-87" id="h12-0-87" class="i">+    override fun onDispose() {
</a><a href="#h12-0-88" id="h12-0-88" class="i">+        interfaces.clear()
</a><a href="#h12-0-89" id="h12-0-89" class="i">+    }
</a><a href="#h12-0-90" id="h12-0-90" class="i">+
</a><a href="#h12-0-91" id="h12-0-91" class="i">+    fun hasInterface(scriptInterfaces: EnumScriptInterface): Boolean {
</a><a href="#h12-0-92" id="h12-0-92" class="i">+        return interfaces.containsKey(scriptInterfaces.key)
</a><a href="#h12-0-93" id="h12-0-93" class="i">+    }
</a><a href="#h12-0-94" id="h12-0-94" class="i">+
</a><a href="#h12-0-95" id="h12-0-95" class="i">+    @Suppress(&quot;unused&quot;)
</a><a href="#h12-0-96" id="h12-0-96" class="i">+    @JSFunction fun create(name: String, callback: Function) {
</a><a href="#h12-0-97" id="h12-0-97" class="i">+        interfaces[name] = { args -&gt;
</a><a href="#h12-0-98" id="h12-0-98" class="i">+            val interfaceBuilder = InterfaceBuilder()
</a><a href="#h12-0-99" id="h12-0-99" class="i">+            runCatching {
</a><a href="#h12-0-100" id="h12-0-100" class="i">+                contextScope {
</a><a href="#h12-0-101" id="h12-0-101" class="i">+                    callback.call(this, callback, callback, arrayOf(interfaceBuilder, scriptableObject {
</a><a href="#h12-0-102" id="h12-0-102" class="i">+                        args.forEach { (key, value) -&gt;
</a><a href="#h12-0-103" id="h12-0-103" class="i">+                            putConst(key,this, value)
</a><a href="#h12-0-104" id="h12-0-104" class="i">+                        }
</a><a href="#h12-0-105" id="h12-0-105" class="i">+                    }))
</a><a href="#h12-0-106" id="h12-0-106" class="i">+                }
</a><a href="#h12-0-107" id="h12-0-107" class="i">+                interfaceBuilder
</a><a href="#h12-0-108" id="h12-0-108" class="i">+            }.onFailure {
</a><a href="#h12-0-109" id="h12-0-109" class="i">+                context.runtime.logger.error(&quot;Failed to create interface $name for ${context.moduleInfo.name}&quot;, it)
</a><a href="#h12-0-110" id="h12-0-110" class="i">+            }.getOrNull()
</a><a href="#h12-0-111" id="h12-0-111" class="i">+        }
</a><a href="#h12-0-112" id="h12-0-112" class="i">+    }
</a><a href="#h12-0-113" id="h12-0-113" class="i">+
</a><a href="#h12-0-114" id="h12-0-114" class="i">+    override fun getObject() = this
</a><a href="#h12-0-115" id="h12-0-115" class="i">+}</a><a href="#h12-0-116" id="h12-0-116" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h13" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/ScriptInterface.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/ScriptInterface.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/ScriptInterface.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/ScriptInterface.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,181 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+package me.rhunk.snapenhance.common.scripting.ui
</a><a href="#h13-0-1" id="h13-0-1" class="i">+
</a><a href="#h13-0-2" id="h13-0-2" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h13-0-3" id="h13-0-3" class="i">+import androidx.compose.material3.OutlinedButton
</a><a href="#h13-0-4" id="h13-0-4" class="i">+import androidx.compose.material3.Slider
</a><a href="#h13-0-5" id="h13-0-5" class="i">+import androidx.compose.material3.Switch
</a><a href="#h13-0-6" id="h13-0-6" class="i">+import androidx.compose.material3.Text
</a><a href="#h13-0-7" id="h13-0-7" class="i">+import androidx.compose.runtime.*
</a><a href="#h13-0-8" id="h13-0-8" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h13-0-9" id="h13-0-9" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h13-0-10" id="h13-0-10" class="i">+import androidx.compose.ui.graphics.Color
</a><a href="#h13-0-11" id="h13-0-11" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h13-0-12" id="h13-0-12" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h13-0-13" id="h13-0-13" class="i">+import kotlinx.coroutines.launch
</a><a href="#h13-0-14" id="h13-0-14" class="i">+import me.rhunk.snapenhance.common.logger.AbstractLogger
</a><a href="#h13-0-15" id="h13-0-15" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.Node
</a><a href="#h13-0-16" id="h13-0-16" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.NodeType
</a><a href="#h13-0-17" id="h13-0-17" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.impl.ActionNode
</a><a href="#h13-0-18" id="h13-0-18" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.impl.ActionType
</a><a href="#h13-0-19" id="h13-0-19" class="i">+import kotlin.math.abs
</a><a href="#h13-0-20" id="h13-0-20" class="i">+
</a><a href="#h13-0-21" id="h13-0-21" class="i">+
</a><a href="#h13-0-22" id="h13-0-22" class="i">+@Composable
</a><a href="#h13-0-23" id="h13-0-23" class="i">+@Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h13-0-24" id="h13-0-24" class="i">+private fun DrawNode(node: Node) {
</a><a href="#h13-0-25" id="h13-0-25" class="i">+    val coroutineScope = rememberCoroutineScope()
</a><a href="#h13-0-26" id="h13-0-26" class="i">+    val cachedAttributes = remember { mutableStateMapOf(*node.attributes.toList().toTypedArray()) }
</a><a href="#h13-0-27" id="h13-0-27" class="i">+
</a><a href="#h13-0-28" id="h13-0-28" class="i">+    node.uiChangeDetection = { key, value -&gt;
</a><a href="#h13-0-29" id="h13-0-29" class="i">+        coroutineScope.launch {
</a><a href="#h13-0-30" id="h13-0-30" class="i">+            cachedAttributes[key] = value
</a><a href="#h13-0-31" id="h13-0-31" class="i">+        }
</a><a href="#h13-0-32" id="h13-0-32" class="i">+    }
</a><a href="#h13-0-33" id="h13-0-33" class="i">+
</a><a href="#h13-0-34" id="h13-0-34" class="i">+    DisposableEffect(Unit) {
</a><a href="#h13-0-35" id="h13-0-35" class="i">+        onDispose {
</a><a href="#h13-0-36" id="h13-0-36" class="i">+            node.uiChangeDetection = { _, _ -&gt; }
</a><a href="#h13-0-37" id="h13-0-37" class="i">+        }
</a><a href="#h13-0-38" id="h13-0-38" class="i">+    }
</a><a href="#h13-0-39" id="h13-0-39" class="i">+
</a><a href="#h13-0-40" id="h13-0-40" class="i">+    val arrangement = cachedAttributes[&quot;arrangement&quot;]
</a><a href="#h13-0-41" id="h13-0-41" class="i">+    val alignment = cachedAttributes[&quot;alignment&quot;]
</a><a href="#h13-0-42" id="h13-0-42" class="i">+    val spacing = cachedAttributes[&quot;spacing&quot;]?.toString()?.toInt()?.let { abs(it) }
</a><a href="#h13-0-43" id="h13-0-43" class="i">+
</a><a href="#h13-0-44" id="h13-0-44" class="i">+    val rowColumnModifier = Modifier
</a><a href="#h13-0-45" id="h13-0-45" class="i">+        .then(if (cachedAttributes[&quot;fillMaxWidth&quot;] as? Boolean == true) Modifier.fillMaxWidth() else Modifier)
</a><a href="#h13-0-46" id="h13-0-46" class="i">+        .then(if (cachedAttributes[&quot;fillMaxHeight&quot;] as? Boolean == true) Modifier.fillMaxHeight() else Modifier)
</a><a href="#h13-0-47" id="h13-0-47" class="i">+        .padding(
</a><a href="#h13-0-48" id="h13-0-48" class="i">+            (cachedAttributes[&quot;padding&quot;]
</a><a href="#h13-0-49" id="h13-0-49" class="i">+                ?.toString()
</a><a href="#h13-0-50" id="h13-0-50" class="i">+                ?.toInt()
</a><a href="#h13-0-51" id="h13-0-51" class="i">+                ?.let { abs(it) } ?: 2).dp)
</a><a href="#h13-0-52" id="h13-0-52" class="i">+
</a><a href="#h13-0-53" id="h13-0-53" class="i">+    fun runCallbackSafe(callback: () -&gt; Unit) {
</a><a href="#h13-0-54" id="h13-0-54" class="i">+        runCatching {
</a><a href="#h13-0-55" id="h13-0-55" class="i">+            callback()
</a><a href="#h13-0-56" id="h13-0-56" class="i">+        }.onFailure {
</a><a href="#h13-0-57" id="h13-0-57" class="i">+            AbstractLogger.directError(&quot;Error running callback&quot;, it)
</a><a href="#h13-0-58" id="h13-0-58" class="i">+        }
</a><a href="#h13-0-59" id="h13-0-59" class="i">+    }
</a><a href="#h13-0-60" id="h13-0-60" class="i">+
</a><a href="#h13-0-61" id="h13-0-61" class="i">+    @Composable
</a><a href="#h13-0-62" id="h13-0-62" class="i">+    fun NodeLabel() {
</a><a href="#h13-0-63" id="h13-0-63" class="i">+        Text(
</a><a href="#h13-0-64" id="h13-0-64" class="i">+            text = cachedAttributes[&quot;label&quot;] as String,
</a><a href="#h13-0-65" id="h13-0-65" class="i">+            fontSize = (cachedAttributes[&quot;fontSize&quot;]?.toString()?.toInt() ?: 14).sp,
</a><a href="#h13-0-66" id="h13-0-66" class="i">+            color = (cachedAttributes[&quot;color&quot;] as? Long)?.let { Color(it) } ?: Color.Unspecified
</a><a href="#h13-0-67" id="h13-0-67" class="i">+        )
</a><a href="#h13-0-68" id="h13-0-68" class="i">+    }
</a><a href="#h13-0-69" id="h13-0-69" class="i">+
</a><a href="#h13-0-70" id="h13-0-70" class="i">+    when (node.type) {
</a><a href="#h13-0-71" id="h13-0-71" class="i">+        NodeType.ACTION -&gt; {
</a><a href="#h13-0-72" id="h13-0-72" class="i">+            when ((node as ActionNode).actionType) {
</a><a href="#h13-0-73" id="h13-0-73" class="i">+                ActionType.LAUNCHED -&gt; {
</a><a href="#h13-0-74" id="h13-0-74" class="i">+                    LaunchedEffect(node.key) {
</a><a href="#h13-0-75" id="h13-0-75" class="i">+                        runCallbackSafe {
</a><a href="#h13-0-76" id="h13-0-76" class="i">+                            node.callback()
</a><a href="#h13-0-77" id="h13-0-77" class="i">+                        }
</a><a href="#h13-0-78" id="h13-0-78" class="i">+                    }
</a><a href="#h13-0-79" id="h13-0-79" class="i">+                }
</a><a href="#h13-0-80" id="h13-0-80" class="i">+                ActionType.DISPOSE -&gt; {
</a><a href="#h13-0-81" id="h13-0-81" class="i">+                    DisposableEffect(Unit) {
</a><a href="#h13-0-82" id="h13-0-82" class="i">+                        onDispose {
</a><a href="#h13-0-83" id="h13-0-83" class="i">+                            runCallbackSafe {
</a><a href="#h13-0-84" id="h13-0-84" class="i">+                                node.callback()
</a><a href="#h13-0-85" id="h13-0-85" class="i">+                            }
</a><a href="#h13-0-86" id="h13-0-86" class="i">+                        }
</a><a href="#h13-0-87" id="h13-0-87" class="i">+                    }
</a><a href="#h13-0-88" id="h13-0-88" class="i">+                }
</a><a href="#h13-0-89" id="h13-0-89" class="i">+            }
</a><a href="#h13-0-90" id="h13-0-90" class="i">+        }
</a><a href="#h13-0-91" id="h13-0-91" class="i">+        NodeType.COLUMN -&gt; {
</a><a href="#h13-0-92" id="h13-0-92" class="i">+            Column(
</a><a href="#h13-0-93" id="h13-0-93" class="i">+                verticalArrangement = arrangement as? Arrangement.Vertical ?: spacing?.let { Arrangement.spacedBy(it.dp) } ?: Arrangement.Top,
</a><a href="#h13-0-94" id="h13-0-94" class="i">+                horizontalAlignment = alignment as? Alignment.Horizontal ?: Alignment.Start,
</a><a href="#h13-0-95" id="h13-0-95" class="i">+                modifier = rowColumnModifier
</a><a href="#h13-0-96" id="h13-0-96" class="i">+            ) {
</a><a href="#h13-0-97" id="h13-0-97" class="i">+                node.children.forEach { child -&gt;
</a><a href="#h13-0-98" id="h13-0-98" class="i">+                    DrawNode(child)
</a><a href="#h13-0-99" id="h13-0-99" class="i">+                }
</a><a href="#h13-0-100" id="h13-0-100" class="i">+            }
</a><a href="#h13-0-101" id="h13-0-101" class="i">+        }
</a><a href="#h13-0-102" id="h13-0-102" class="i">+        NodeType.ROW -&gt; {
</a><a href="#h13-0-103" id="h13-0-103" class="i">+            Row(
</a><a href="#h13-0-104" id="h13-0-104" class="i">+                horizontalArrangement = arrangement as? Arrangement.Horizontal ?: spacing?.let { Arrangement.spacedBy(it.dp) } ?: Arrangement.SpaceBetween,
</a><a href="#h13-0-105" id="h13-0-105" class="i">+                verticalAlignment = alignment as? Alignment.Vertical ?: Alignment.CenterVertically,
</a><a href="#h13-0-106" id="h13-0-106" class="i">+                modifier = rowColumnModifier
</a><a href="#h13-0-107" id="h13-0-107" class="i">+            ) {
</a><a href="#h13-0-108" id="h13-0-108" class="i">+                node.children.forEach { child -&gt;
</a><a href="#h13-0-109" id="h13-0-109" class="i">+                    DrawNode(child)
</a><a href="#h13-0-110" id="h13-0-110" class="i">+                }
</a><a href="#h13-0-111" id="h13-0-111" class="i">+            }
</a><a href="#h13-0-112" id="h13-0-112" class="i">+        }
</a><a href="#h13-0-113" id="h13-0-113" class="i">+        NodeType.TEXT -&gt; NodeLabel()
</a><a href="#h13-0-114" id="h13-0-114" class="i">+        NodeType.SWITCH -&gt; {
</a><a href="#h13-0-115" id="h13-0-115" class="i">+            var switchState by remember {
</a><a href="#h13-0-116" id="h13-0-116" class="i">+                mutableStateOf(cachedAttributes[&quot;state&quot;] as Boolean)
</a><a href="#h13-0-117" id="h13-0-117" class="i">+            }
</a><a href="#h13-0-118" id="h13-0-118" class="i">+            Switch(
</a><a href="#h13-0-119" id="h13-0-119" class="i">+                checked = switchState,
</a><a href="#h13-0-120" id="h13-0-120" class="i">+                onCheckedChange = { state -&gt;
</a><a href="#h13-0-121" id="h13-0-121" class="i">+                    runCallbackSafe {
</a><a href="#h13-0-122" id="h13-0-122" class="i">+                        switchState = state
</a><a href="#h13-0-123" id="h13-0-123" class="i">+                        node.setAttribute(&quot;state&quot;, state)
</a><a href="#h13-0-124" id="h13-0-124" class="i">+                        (cachedAttributes[&quot;callback&quot;] as? (Boolean) -&gt; Unit)?.let { it(state) }
</a><a href="#h13-0-125" id="h13-0-125" class="i">+                    }
</a><a href="#h13-0-126" id="h13-0-126" class="i">+                }
</a><a href="#h13-0-127" id="h13-0-127" class="i">+            )
</a><a href="#h13-0-128" id="h13-0-128" class="i">+        }
</a><a href="#h13-0-129" id="h13-0-129" class="i">+        NodeType.SLIDER -&gt; {
</a><a href="#h13-0-130" id="h13-0-130" class="i">+            var sliderValue by remember {
</a><a href="#h13-0-131" id="h13-0-131" class="i">+                mutableFloatStateOf((cachedAttributes[&quot;value&quot;] as Int).toFloat())
</a><a href="#h13-0-132" id="h13-0-132" class="i">+            }
</a><a href="#h13-0-133" id="h13-0-133" class="i">+            Slider(
</a><a href="#h13-0-134" id="h13-0-134" class="i">+                value = sliderValue,
</a><a href="#h13-0-135" id="h13-0-135" class="i">+                onValueChange = { value -&gt;
</a><a href="#h13-0-136" id="h13-0-136" class="i">+                    runCallbackSafe {
</a><a href="#h13-0-137" id="h13-0-137" class="i">+                        sliderValue = value
</a><a href="#h13-0-138" id="h13-0-138" class="i">+                        node.setAttribute(&quot;value&quot;, value.toInt())
</a><a href="#h13-0-139" id="h13-0-139" class="i">+                        (cachedAttributes[&quot;callback&quot;] as? (Int) -&gt; Unit)?.let { it(value.toInt()) }
</a><a href="#h13-0-140" id="h13-0-140" class="i">+                    }
</a><a href="#h13-0-141" id="h13-0-141" class="i">+                },
</a><a href="#h13-0-142" id="h13-0-142" class="i">+                valueRange = (cachedAttributes[&quot;min&quot;] as Int).toFloat()..(cachedAttributes[&quot;max&quot;] as Int).toFloat(),
</a><a href="#h13-0-143" id="h13-0-143" class="i">+                steps = cachedAttributes[&quot;step&quot;] as Int,
</a><a href="#h13-0-144" id="h13-0-144" class="i">+            )
</a><a href="#h13-0-145" id="h13-0-145" class="i">+        }
</a><a href="#h13-0-146" id="h13-0-146" class="i">+        NodeType.BUTTON -&gt; {
</a><a href="#h13-0-147" id="h13-0-147" class="i">+            OutlinedButton(onClick = {
</a><a href="#h13-0-148" id="h13-0-148" class="i">+                runCallbackSafe {
</a><a href="#h13-0-149" id="h13-0-149" class="i">+                    (cachedAttributes[&quot;callback&quot;] as? () -&gt; Unit)?.let { it() }
</a><a href="#h13-0-150" id="h13-0-150" class="i">+                }
</a><a href="#h13-0-151" id="h13-0-151" class="i">+            }) {
</a><a href="#h13-0-152" id="h13-0-152" class="i">+                NodeLabel()
</a><a href="#h13-0-153" id="h13-0-153" class="i">+            }
</a><a href="#h13-0-154" id="h13-0-154" class="i">+        }
</a><a href="#h13-0-155" id="h13-0-155" class="i">+        else -&gt; {}
</a><a href="#h13-0-156" id="h13-0-156" class="i">+    }
</a><a href="#h13-0-157" id="h13-0-157" class="i">+}
</a><a href="#h13-0-158" id="h13-0-158" class="i">+
</a><a href="#h13-0-159" id="h13-0-159" class="i">+@Composable
</a><a href="#h13-0-160" id="h13-0-160" class="i">+fun ScriptInterface(interfaceBuilder: InterfaceBuilder) {
</a><a href="#h13-0-161" id="h13-0-161" class="i">+    Column(
</a><a href="#h13-0-162" id="h13-0-162" class="i">+        modifier = Modifier
</a><a href="#h13-0-163" id="h13-0-163" class="i">+            .fillMaxWidth()
</a><a href="#h13-0-164" id="h13-0-164" class="i">+            .padding(8.dp)
</a><a href="#h13-0-165" id="h13-0-165" class="i">+    ) {
</a><a href="#h13-0-166" id="h13-0-166" class="i">+        interfaceBuilder.nodes.forEach { node -&gt;
</a><a href="#h13-0-167" id="h13-0-167" class="i">+            DrawNode(node)
</a><a href="#h13-0-168" id="h13-0-168" class="i">+        }
</a><a href="#h13-0-169" id="h13-0-169" class="i">+
</a><a href="#h13-0-170" id="h13-0-170" class="i">+        DisposableEffect(Unit) {
</a><a href="#h13-0-171" id="h13-0-171" class="i">+            onDispose {
</a><a href="#h13-0-172" id="h13-0-172" class="i">+                runCatching {
</a><a href="#h13-0-173" id="h13-0-173" class="i">+                    interfaceBuilder.onDisposeCallback?.invoke()
</a><a href="#h13-0-174" id="h13-0-174" class="i">+                }.onFailure {
</a><a href="#h13-0-175" id="h13-0-175" class="i">+                    AbstractLogger.directError(&quot;Error running onDisposed callback&quot;, it)
</a><a href="#h13-0-176" id="h13-0-176" class="i">+                }
</a><a href="#h13-0-177" id="h13-0-177" class="i">+            }
</a><a href="#h13-0-178" id="h13-0-178" class="i">+        }
</a><a href="#h13-0-179" id="h13-0-179" class="i">+    }
</a><a href="#h13-0-180" id="h13-0-180" class="i">+}</a><a href="#h13-0-181" id="h13-0-181" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/Node.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/Node.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/Node.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/Node.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,52 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+package me.rhunk.snapenhance.common.scripting.ui.components
</a><a href="#h14-0-1" id="h14-0-1" class="i">+
</a><a href="#h14-0-2" id="h14-0-2" class="i">+open class Node(
</a><a href="#h14-0-3" id="h14-0-3" class="i">+    val type: NodeType,
</a><a href="#h14-0-4" id="h14-0-4" class="i">+) {
</a><a href="#h14-0-5" id="h14-0-5" class="i">+    lateinit var uiChangeDetection: (key: String, value: Any?) -&gt; Unit
</a><a href="#h14-0-6" id="h14-0-6" class="i">+
</a><a href="#h14-0-7" id="h14-0-7" class="i">+    val children = mutableListOf&lt;Node&gt;()
</a><a href="#h14-0-8" id="h14-0-8" class="i">+    val attributes = object: HashMap&lt;String, Any?&gt;() {
</a><a href="#h14-0-9" id="h14-0-9" class="i">+        override fun put(key: String, value: Any?): Any? {
</a><a href="#h14-0-10" id="h14-0-10" class="i">+            return super.put(key, value).also {
</a><a href="#h14-0-11" id="h14-0-11" class="i">+                if (::uiChangeDetection.isInitialized) {
</a><a href="#h14-0-12" id="h14-0-12" class="i">+                    uiChangeDetection(key, value)
</a><a href="#h14-0-13" id="h14-0-13" class="i">+                }
</a><a href="#h14-0-14" id="h14-0-14" class="i">+            }
</a><a href="#h14-0-15" id="h14-0-15" class="i">+        }
</a><a href="#h14-0-16" id="h14-0-16" class="i">+    }
</a><a href="#h14-0-17" id="h14-0-17" class="i">+
</a><a href="#h14-0-18" id="h14-0-18" class="i">+    fun setAttribute(key: String, value: Any?) {
</a><a href="#h14-0-19" id="h14-0-19" class="i">+        attributes[key] = value
</a><a href="#h14-0-20" id="h14-0-20" class="i">+    }
</a><a href="#h14-0-21" id="h14-0-21" class="i">+
</a><a href="#h14-0-22" id="h14-0-22" class="i">+    fun fillMaxWidth(): Node {
</a><a href="#h14-0-23" id="h14-0-23" class="i">+        attributes[&quot;fillMaxWidth&quot;] = true
</a><a href="#h14-0-24" id="h14-0-24" class="i">+        return this
</a><a href="#h14-0-25" id="h14-0-25" class="i">+    }
</a><a href="#h14-0-26" id="h14-0-26" class="i">+
</a><a href="#h14-0-27" id="h14-0-27" class="i">+    fun fillMaxHeight(): Node {
</a><a href="#h14-0-28" id="h14-0-28" class="i">+        attributes[&quot;fillMaxHeight&quot;] = true
</a><a href="#h14-0-29" id="h14-0-29" class="i">+        return this
</a><a href="#h14-0-30" id="h14-0-30" class="i">+    }
</a><a href="#h14-0-31" id="h14-0-31" class="i">+
</a><a href="#h14-0-32" id="h14-0-32" class="i">+    fun label(text: String): Node {
</a><a href="#h14-0-33" id="h14-0-33" class="i">+        attributes[&quot;label&quot;] = text
</a><a href="#h14-0-34" id="h14-0-34" class="i">+        return this
</a><a href="#h14-0-35" id="h14-0-35" class="i">+    }
</a><a href="#h14-0-36" id="h14-0-36" class="i">+
</a><a href="#h14-0-37" id="h14-0-37" class="i">+    fun padding(padding: Int): Node {
</a><a href="#h14-0-38" id="h14-0-38" class="i">+        attributes[&quot;padding&quot;] = padding
</a><a href="#h14-0-39" id="h14-0-39" class="i">+        return this
</a><a href="#h14-0-40" id="h14-0-40" class="i">+    }
</a><a href="#h14-0-41" id="h14-0-41" class="i">+
</a><a href="#h14-0-42" id="h14-0-42" class="i">+    fun fontSize(size: Int): Node {
</a><a href="#h14-0-43" id="h14-0-43" class="i">+        attributes[&quot;fontSize&quot;] = size
</a><a href="#h14-0-44" id="h14-0-44" class="i">+        return this
</a><a href="#h14-0-45" id="h14-0-45" class="i">+    }
</a><a href="#h14-0-46" id="h14-0-46" class="i">+
</a><a href="#h14-0-47" id="h14-0-47" class="i">+    fun color(color: Long): Node {
</a><a href="#h14-0-48" id="h14-0-48" class="i">+        attributes[&quot;color&quot;] = color
</a><a href="#h14-0-49" id="h14-0-49" class="i">+        return this
</a><a href="#h14-0-50" id="h14-0-50" class="i">+    }
</a><a href="#h14-0-51" id="h14-0-51" class="i">+}
</a><b>diff --git a/<a id="h15" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/NodeType.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/NodeType.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/NodeType.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/NodeType.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,12 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+package me.rhunk.snapenhance.common.scripting.ui.components
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+enum class NodeType {
</a><a href="#h15-0-3" id="h15-0-3" class="i">+    ROW,
</a><a href="#h15-0-4" id="h15-0-4" class="i">+    COLUMN,
</a><a href="#h15-0-5" id="h15-0-5" class="i">+    TEXT,
</a><a href="#h15-0-6" id="h15-0-6" class="i">+    SWITCH,
</a><a href="#h15-0-7" id="h15-0-7" class="i">+    BUTTON,
</a><a href="#h15-0-8" id="h15-0-8" class="i">+    SLIDER,
</a><a href="#h15-0-9" id="h15-0-9" class="i">+    LIST,
</a><a href="#h15-0-10" id="h15-0-10" class="i">+    ACTION
</a><a href="#h15-0-11" id="h15-0-11" class="i">+}</a><a href="#h15-0-12" id="h15-0-12" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/ActionNode.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/ActionNode.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/ActionNode.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/ActionNode.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -0,0 +1,15 @@
</a><a href="#h16-0-0" id="h16-0-0" class="i">+package me.rhunk.snapenhance.common.scripting.ui.components.impl
</a><a href="#h16-0-1" id="h16-0-1" class="i">+
</a><a href="#h16-0-2" id="h16-0-2" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.Node
</a><a href="#h16-0-3" id="h16-0-3" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.NodeType
</a><a href="#h16-0-4" id="h16-0-4" class="i">+
</a><a href="#h16-0-5" id="h16-0-5" class="i">+enum class ActionType {
</a><a href="#h16-0-6" id="h16-0-6" class="i">+    LAUNCHED,
</a><a href="#h16-0-7" id="h16-0-7" class="i">+    DISPOSE
</a><a href="#h16-0-8" id="h16-0-8" class="i">+}
</a><a href="#h16-0-9" id="h16-0-9" class="i">+
</a><a href="#h16-0-10" id="h16-0-10" class="i">+class ActionNode(
</a><a href="#h16-0-11" id="h16-0-11" class="i">+    val actionType: ActionType,
</a><a href="#h16-0-12" id="h16-0-12" class="i">+    val key: Any = Unit,
</a><a href="#h16-0-13" id="h16-0-13" class="i">+    val callback: () -&gt; Unit
</a><a href="#h16-0-14" id="h16-0-14" class="i">+): Node(NodeType.ACTION)</a><a href="#h16-0-15" id="h16-0-15" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h17" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/RowColumnNode.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/RowColumnNode.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/RowColumnNode.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/scripting/ui/components/impl/RowColumnNode.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -0,0 +1,47 @@
</a><a href="#h17-0-0" id="h17-0-0" class="i">+package me.rhunk.snapenhance.common.scripting.ui.components.impl
</a><a href="#h17-0-1" id="h17-0-1" class="i">+
</a><a href="#h17-0-2" id="h17-0-2" class="i">+import androidx.compose.foundation.layout.Arrangement
</a><a href="#h17-0-3" id="h17-0-3" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h17-0-4" id="h17-0-4" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.Node
</a><a href="#h17-0-5" id="h17-0-5" class="i">+import me.rhunk.snapenhance.common.scripting.ui.components.NodeType
</a><a href="#h17-0-6" id="h17-0-6" class="i">+
</a><a href="#h17-0-7" id="h17-0-7" class="i">+
</a><a href="#h17-0-8" id="h17-0-8" class="i">+class RowColumnNode(
</a><a href="#h17-0-9" id="h17-0-9" class="i">+    type: NodeType,
</a><a href="#h17-0-10" id="h17-0-10" class="i">+) : Node(type) {
</a><a href="#h17-0-11" id="h17-0-11" class="i">+    companion object {
</a><a href="#h17-0-12" id="h17-0-12" class="i">+        private val arrangements = mapOf(
</a><a href="#h17-0-13" id="h17-0-13" class="i">+            &quot;start&quot; to Arrangement.Start,
</a><a href="#h17-0-14" id="h17-0-14" class="i">+            &quot;end&quot; to Arrangement.End,
</a><a href="#h17-0-15" id="h17-0-15" class="i">+            &quot;top&quot; to Arrangement.Top,
</a><a href="#h17-0-16" id="h17-0-16" class="i">+            &quot;bottom&quot; to Arrangement.Bottom,
</a><a href="#h17-0-17" id="h17-0-17" class="i">+            &quot;center&quot; to Arrangement.Center,
</a><a href="#h17-0-18" id="h17-0-18" class="i">+            &quot;spaceBetween&quot; to Arrangement.SpaceBetween,
</a><a href="#h17-0-19" id="h17-0-19" class="i">+            &quot;spaceAround&quot; to Arrangement.SpaceAround,
</a><a href="#h17-0-20" id="h17-0-20" class="i">+            &quot;spaceEvenly&quot; to Arrangement.SpaceEvenly,
</a><a href="#h17-0-21" id="h17-0-21" class="i">+        )
</a><a href="#h17-0-22" id="h17-0-22" class="i">+        private val alignments = mapOf(
</a><a href="#h17-0-23" id="h17-0-23" class="i">+            &quot;start&quot; to Alignment.Start,
</a><a href="#h17-0-24" id="h17-0-24" class="i">+            &quot;end&quot; to Alignment.End,
</a><a href="#h17-0-25" id="h17-0-25" class="i">+            &quot;top&quot; to Alignment.Top,
</a><a href="#h17-0-26" id="h17-0-26" class="i">+            &quot;bottom&quot; to Alignment.Bottom,
</a><a href="#h17-0-27" id="h17-0-27" class="i">+            &quot;centerVertically&quot; to Alignment.CenterVertically,
</a><a href="#h17-0-28" id="h17-0-28" class="i">+            &quot;centerHorizontally&quot; to Alignment.CenterHorizontally,
</a><a href="#h17-0-29" id="h17-0-29" class="i">+        )
</a><a href="#h17-0-30" id="h17-0-30" class="i">+    }
</a><a href="#h17-0-31" id="h17-0-31" class="i">+
</a><a href="#h17-0-32" id="h17-0-32" class="i">+    fun arrangement(arrangement: String): RowColumnNode {
</a><a href="#h17-0-33" id="h17-0-33" class="i">+        attributes[&quot;arrangement&quot;] = arrangements[arrangement] ?: throw IllegalArgumentException(&quot;Invalid arrangement&quot;)
</a><a href="#h17-0-34" id="h17-0-34" class="i">+        return this
</a><a href="#h17-0-35" id="h17-0-35" class="i">+    }
</a><a href="#h17-0-36" id="h17-0-36" class="i">+
</a><a href="#h17-0-37" id="h17-0-37" class="i">+    fun alignment(alignment: String): RowColumnNode {
</a><a href="#h17-0-38" id="h17-0-38" class="i">+        attributes[&quot;alignment&quot;] = alignments[alignment] ?: throw IllegalArgumentException(&quot;Invalid alignment&quot;)
</a><a href="#h17-0-39" id="h17-0-39" class="i">+        return this
</a><a href="#h17-0-40" id="h17-0-40" class="i">+    }
</a><a href="#h17-0-41" id="h17-0-41" class="i">+
</a><a href="#h17-0-42" id="h17-0-42" class="i">+    fun spacedBy(spacing: Int): RowColumnNode {
</a><a href="#h17-0-43" id="h17-0-43" class="i">+        attributes[&quot;spacing&quot;] = spacing
</a><a href="#h17-0-44" id="h17-0-44" class="i">+        return this
</a><a href="#h17-0-45" id="h17-0-45" class="i">+    }
</a><a href="#h17-0-46" id="h17-0-46" class="i">+}</a><a href="#h17-0-47" id="h17-0-47" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -25,7 +25,7 @@ import me.rhunk.snapenhance.core.features.impl.tweaks.UnsaveableMessages
</a> import me.rhunk.snapenhance.core.features.impl.ui.*
 import me.rhunk.snapenhance.core.logger.CoreLogger
 import me.rhunk.snapenhance.core.manager.Manager
<a href="#h18-0-3" id="h18-0-3" class="d">-import me.rhunk.snapenhance.core.ui.menu.impl.MenuViewInjector
</a><a href="#h18-0-4" id="h18-0-4" class="i">+import me.rhunk.snapenhance.core.ui.menu.MenuViewInjector
</a> import kotlin.reflect.KClass
 import kotlin.system.measureTimeMillis
 
<b>diff --git a/<a id="h19" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/MenuViewInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/MenuViewInjector.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/MenuViewInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/MenuViewInjector.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,159 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+package me.rhunk.snapenhance.core.ui.menu
</a><a href="#h19-0-1" id="h19-0-1" class="i">+
</a><a href="#h19-0-2" id="h19-0-2" class="i">+import android.annotation.SuppressLint
</a><a href="#h19-0-3" id="h19-0-3" class="i">+import android.view.Gravity
</a><a href="#h19-0-4" id="h19-0-4" class="i">+import android.view.View
</a><a href="#h19-0-5" id="h19-0-5" class="i">+import android.view.ViewGroup
</a><a href="#h19-0-6" id="h19-0-6" class="i">+import android.widget.FrameLayout
</a><a href="#h19-0-7" id="h19-0-7" class="i">+import android.widget.LinearLayout
</a><a href="#h19-0-8" id="h19-0-8" class="i">+import android.widget.ScrollView
</a><a href="#h19-0-9" id="h19-0-9" class="i">+import me.rhunk.snapenhance.core.event.events.impl.AddViewEvent
</a><a href="#h19-0-10" id="h19-0-10" class="i">+import me.rhunk.snapenhance.core.features.Feature
</a><a href="#h19-0-11" id="h19-0-11" class="i">+import me.rhunk.snapenhance.core.features.FeatureLoadParams
</a><a href="#h19-0-12" id="h19-0-12" class="i">+import me.rhunk.snapenhance.core.features.impl.messaging.Messaging
</a><a href="#h19-0-13" id="h19-0-13" class="i">+import me.rhunk.snapenhance.core.ui.ViewTagState
</a><a href="#h19-0-14" id="h19-0-14" class="i">+import me.rhunk.snapenhance.core.ui.menu.impl.*
</a><a href="#h19-0-15" id="h19-0-15" class="i">+import me.rhunk.snapenhance.core.util.ktx.getIdentifier
</a><a href="#h19-0-16" id="h19-0-16" class="i">+import java.lang.reflect.Modifier
</a><a href="#h19-0-17" id="h19-0-17" class="i">+import kotlin.reflect.KClass
</a><a href="#h19-0-18" id="h19-0-18" class="i">+
</a><a href="#h19-0-19" id="h19-0-19" class="i">+@SuppressLint(&quot;DiscouragedApi&quot;)
</a><a href="#h19-0-20" id="h19-0-20" class="i">+class MenuViewInjector : Feature(&quot;MenuViewInjector&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h19-0-21" id="h19-0-21" class="i">+    private val viewTagState = ViewTagState()
</a><a href="#h19-0-22" id="h19-0-22" class="i">+
</a><a href="#h19-0-23" id="h19-0-23" class="i">+    private val menuMap = mutableMapOf&lt;KClass&lt;*&gt;, AbstractMenu&gt;()
</a><a href="#h19-0-24" id="h19-0-24" class="i">+    private val newChatString by lazy {
</a><a href="#h19-0-25" id="h19-0-25" class="i">+        context.resources.getString(context.resources.getIdentifier(&quot;new_chat&quot;, &quot;string&quot;))
</a><a href="#h19-0-26" id="h19-0-26" class="i">+    }
</a><a href="#h19-0-27" id="h19-0-27" class="i">+
</a><a href="#h19-0-28" id="h19-0-28" class="i">+    @SuppressLint(&quot;ResourceType&quot;)
</a><a href="#h19-0-29" id="h19-0-29" class="i">+    override fun asyncOnActivityCreate() {
</a><a href="#h19-0-30" id="h19-0-30" class="i">+        arrayOf(
</a><a href="#h19-0-31" id="h19-0-31" class="i">+            OperaContextActionMenu(),
</a><a href="#h19-0-32" id="h19-0-32" class="i">+            OperaDownloadIconMenu(),
</a><a href="#h19-0-33" id="h19-0-33" class="i">+            SettingsGearInjector(),
</a><a href="#h19-0-34" id="h19-0-34" class="i">+            FriendFeedInfoMenu(),
</a><a href="#h19-0-35" id="h19-0-35" class="i">+            ChatActionMenu(),
</a><a href="#h19-0-36" id="h19-0-36" class="i">+            SettingsMenu()
</a><a href="#h19-0-37" id="h19-0-37" class="i">+        ).forEach {
</a><a href="#h19-0-38" id="h19-0-38" class="i">+            menuMap[it::class] = it.also {
</a><a href="#h19-0-39" id="h19-0-39" class="i">+                it.context = context; it.init()
</a><a href="#h19-0-40" id="h19-0-40" class="i">+            }
</a><a href="#h19-0-41" id="h19-0-41" class="i">+        }
</a><a href="#h19-0-42" id="h19-0-42" class="i">+
</a><a href="#h19-0-43" id="h19-0-43" class="i">+        val messaging = context.feature(Messaging::class)
</a><a href="#h19-0-44" id="h19-0-44" class="i">+
</a><a href="#h19-0-45" id="h19-0-45" class="i">+        val actionSheetItemsContainerLayoutId = context.resources.getIdentifier(&quot;action_sheet_items_container&quot;, &quot;id&quot;)
</a><a href="#h19-0-46" id="h19-0-46" class="i">+        val actionSheetContainer = context.resources.getIdentifier(&quot;action_sheet_container&quot;, &quot;id&quot;)
</a><a href="#h19-0-47" id="h19-0-47" class="i">+        val actionMenu = context.resources.getIdentifier(&quot;action_menu&quot;, &quot;id&quot;)
</a><a href="#h19-0-48" id="h19-0-48" class="i">+        val componentsHolder = context.resources.getIdentifier(&quot;components_holder&quot;, &quot;id&quot;)
</a><a href="#h19-0-49" id="h19-0-49" class="i">+        val feedNewChat = context.resources.getIdentifier(&quot;feed_new_chat&quot;, &quot;id&quot;)
</a><a href="#h19-0-50" id="h19-0-50" class="i">+        val contextMenuButtonIconView = context.resources.getIdentifier(&quot;context_menu_button_icon_view&quot;, &quot;id&quot;)
</a><a href="#h19-0-51" id="h19-0-51" class="i">+
</a><a href="#h19-0-52" id="h19-0-52" class="i">+        context.event.subscribe(AddViewEvent::class) { event -&gt;
</a><a href="#h19-0-53" id="h19-0-53" class="i">+            val originalAddView: (View) -&gt; Unit = {
</a><a href="#h19-0-54" id="h19-0-54" class="i">+                event.adapter.invokeOriginal(arrayOf(it, -1,
</a><a href="#h19-0-55" id="h19-0-55" class="i">+                    FrameLayout.LayoutParams(
</a><a href="#h19-0-56" id="h19-0-56" class="i">+                        ViewGroup.LayoutParams.MATCH_PARENT,
</a><a href="#h19-0-57" id="h19-0-57" class="i">+                        ViewGroup.LayoutParams.MATCH_PARENT
</a><a href="#h19-0-58" id="h19-0-58" class="i">+                    ))
</a><a href="#h19-0-59" id="h19-0-59" class="i">+                )
</a><a href="#h19-0-60" id="h19-0-60" class="i">+            }
</a><a href="#h19-0-61" id="h19-0-61" class="i">+
</a><a href="#h19-0-62" id="h19-0-62" class="i">+            val viewGroup: ViewGroup = event.parent
</a><a href="#h19-0-63" id="h19-0-63" class="i">+            val childView: View = event.view
</a><a href="#h19-0-64" id="h19-0-64" class="i">+            menuMap[OperaContextActionMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h19-0-65" id="h19-0-65" class="i">+
</a><a href="#h19-0-66" id="h19-0-66" class="i">+            if (childView.id == contextMenuButtonIconView) {
</a><a href="#h19-0-67" id="h19-0-67" class="i">+                menuMap[OperaDownloadIconMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h19-0-68" id="h19-0-68" class="i">+            }
</a><a href="#h19-0-69" id="h19-0-69" class="i">+
</a><a href="#h19-0-70" id="h19-0-70" class="i">+            if (event.parent.id == componentsHolder &amp;&amp; childView.id == feedNewChat) {
</a><a href="#h19-0-71" id="h19-0-71" class="i">+                menuMap[SettingsGearInjector::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h19-0-72" id="h19-0-72" class="i">+                return@subscribe
</a><a href="#h19-0-73" id="h19-0-73" class="i">+            }
</a><a href="#h19-0-74" id="h19-0-74" class="i">+
</a><a href="#h19-0-75" id="h19-0-75" class="i">+            //download in chat snaps and notes from the chat action menu
</a><a href="#h19-0-76" id="h19-0-76" class="i">+            if (viewGroup.javaClass.name.endsWith(&quot;ActionMenuChatItemContainer&quot;)) {
</a><a href="#h19-0-77" id="h19-0-77" class="i">+                if (viewGroup.parent == null || viewGroup.parent.parent == null) return@subscribe
</a><a href="#h19-0-78" id="h19-0-78" class="i">+                menuMap[ChatActionMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h19-0-79" id="h19-0-79" class="i">+                return@subscribe
</a><a href="#h19-0-80" id="h19-0-80" class="i">+            }
</a><a href="#h19-0-81" id="h19-0-81" class="i">+
</a><a href="#h19-0-82" id="h19-0-82" class="i">+            //TODO: inject in group chat menus
</a><a href="#h19-0-83" id="h19-0-83" class="i">+            if (viewGroup.id == actionSheetContainer &amp;&amp; childView.id == actionMenu &amp;&amp; messaging.lastFetchGroupConversationUUID != null) {
</a><a href="#h19-0-84" id="h19-0-84" class="i">+                val injectedLayout = LinearLayout(childView.context).apply {
</a><a href="#h19-0-85" id="h19-0-85" class="i">+                    orientation = LinearLayout.VERTICAL
</a><a href="#h19-0-86" id="h19-0-86" class="i">+                    gravity = Gravity.BOTTOM
</a><a href="#h19-0-87" id="h19-0-87" class="i">+                    layoutParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT)
</a><a href="#h19-0-88" id="h19-0-88" class="i">+                    addView(childView)
</a><a href="#h19-0-89" id="h19-0-89" class="i">+                    addOnAttachStateChangeListener(object: View.OnAttachStateChangeListener {
</a><a href="#h19-0-90" id="h19-0-90" class="i">+                        override fun onViewAttachedToWindow(v: View) {}
</a><a href="#h19-0-91" id="h19-0-91" class="i">+                        override fun onViewDetachedFromWindow(v: View) {
</a><a href="#h19-0-92" id="h19-0-92" class="i">+                            messaging.lastFetchGroupConversationUUID = null
</a><a href="#h19-0-93" id="h19-0-93" class="i">+                        }
</a><a href="#h19-0-94" id="h19-0-94" class="i">+                    })
</a><a href="#h19-0-95" id="h19-0-95" class="i">+                }
</a><a href="#h19-0-96" id="h19-0-96" class="i">+
</a><a href="#h19-0-97" id="h19-0-97" class="i">+                context.runOnUiThread {
</a><a href="#h19-0-98" id="h19-0-98" class="i">+                    injectedLayout.addView(ScrollView(injectedLayout.context).apply {
</a><a href="#h19-0-99" id="h19-0-99" class="i">+                        layoutParams = LinearLayout.LayoutParams(
</a><a href="#h19-0-100" id="h19-0-100" class="i">+                            ViewGroup.LayoutParams.MATCH_PARENT,
</a><a href="#h19-0-101" id="h19-0-101" class="i">+                            ViewGroup.LayoutParams.WRAP_CONTENT
</a><a href="#h19-0-102" id="h19-0-102" class="i">+                        ).apply {
</a><a href="#h19-0-103" id="h19-0-103" class="i">+                            weight = 1f;
</a><a href="#h19-0-104" id="h19-0-104" class="i">+                            setMargins(0, 100, 0, 0)
</a><a href="#h19-0-105" id="h19-0-105" class="i">+                        }
</a><a href="#h19-0-106" id="h19-0-106" class="i">+
</a><a href="#h19-0-107" id="h19-0-107" class="i">+                        addView(LinearLayout(context).apply {
</a><a href="#h19-0-108" id="h19-0-108" class="i">+                            orientation = LinearLayout.VERTICAL
</a><a href="#h19-0-109" id="h19-0-109" class="i">+                            menuMap[FriendFeedInfoMenu::class]?.inject(event.parent, injectedLayout) { view -&gt;
</a><a href="#h19-0-110" id="h19-0-110" class="i">+                                view.layoutParams = LinearLayout.LayoutParams(
</a><a href="#h19-0-111" id="h19-0-111" class="i">+                                    ViewGroup.LayoutParams.MATCH_PARENT,
</a><a href="#h19-0-112" id="h19-0-112" class="i">+                                    ViewGroup.LayoutParams.WRAP_CONTENT
</a><a href="#h19-0-113" id="h19-0-113" class="i">+                                ).apply {
</a><a href="#h19-0-114" id="h19-0-114" class="i">+                                    setMargins(0, 5, 0, 5)
</a><a href="#h19-0-115" id="h19-0-115" class="i">+                                }
</a><a href="#h19-0-116" id="h19-0-116" class="i">+                                addView(view)
</a><a href="#h19-0-117" id="h19-0-117" class="i">+                            }
</a><a href="#h19-0-118" id="h19-0-118" class="i">+                        })
</a><a href="#h19-0-119" id="h19-0-119" class="i">+                    }, 0)
</a><a href="#h19-0-120" id="h19-0-120" class="i">+                }
</a><a href="#h19-0-121" id="h19-0-121" class="i">+
</a><a href="#h19-0-122" id="h19-0-122" class="i">+                event.view = injectedLayout
</a><a href="#h19-0-123" id="h19-0-123" class="i">+            }
</a><a href="#h19-0-124" id="h19-0-124" class="i">+
</a><a href="#h19-0-125" id="h19-0-125" class="i">+            if (viewGroup is LinearLayout &amp;&amp; viewGroup.id == actionSheetItemsContainerLayoutId) {
</a><a href="#h19-0-126" id="h19-0-126" class="i">+                val itemStringInterface by lazy {
</a><a href="#h19-0-127" id="h19-0-127" class="i">+                    childView.javaClass.declaredFields.filter {
</a><a href="#h19-0-128" id="h19-0-128" class="i">+                        !it.type.isPrimitive &amp;&amp; Modifier.isAbstract(it.type.modifiers)
</a><a href="#h19-0-129" id="h19-0-129" class="i">+                    }.map {
</a><a href="#h19-0-130" id="h19-0-130" class="i">+                        runCatching {
</a><a href="#h19-0-131" id="h19-0-131" class="i">+                            it.isAccessible = true
</a><a href="#h19-0-132" id="h19-0-132" class="i">+                            it[childView]
</a><a href="#h19-0-133" id="h19-0-133" class="i">+                        }.getOrNull()
</a><a href="#h19-0-134" id="h19-0-134" class="i">+                    }.firstOrNull()
</a><a href="#h19-0-135" id="h19-0-135" class="i">+                }
</a><a href="#h19-0-136" id="h19-0-136" class="i">+
</a><a href="#h19-0-137" id="h19-0-137" class="i">+                //the 3 dot button shows a menu which contains the first item as a Plain object
</a><a href="#h19-0-138" id="h19-0-138" class="i">+                if (viewGroup.getChildCount() == 0 &amp;&amp; itemStringInterface != null &amp;&amp; itemStringInterface.toString().startsWith(&quot;Plain(primaryText=$newChatString&quot;)) {
</a><a href="#h19-0-139" id="h19-0-139" class="i">+                    menuMap[SettingsMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h19-0-140" id="h19-0-140" class="i">+                    viewGroup.addOnAttachStateChangeListener(object: View.OnAttachStateChangeListener {
</a><a href="#h19-0-141" id="h19-0-141" class="i">+                        override fun onViewAttachedToWindow(v: View) {}
</a><a href="#h19-0-142" id="h19-0-142" class="i">+                        override fun onViewDetachedFromWindow(v: View) {
</a><a href="#h19-0-143" id="h19-0-143" class="i">+                            viewTagState.removeState(viewGroup)
</a><a href="#h19-0-144" id="h19-0-144" class="i">+                        }
</a><a href="#h19-0-145" id="h19-0-145" class="i">+                    })
</a><a href="#h19-0-146" id="h19-0-146" class="i">+                    viewTagState[viewGroup]
</a><a href="#h19-0-147" id="h19-0-147" class="i">+                    return@subscribe
</a><a href="#h19-0-148" id="h19-0-148" class="i">+                }
</a><a href="#h19-0-149" id="h19-0-149" class="i">+                if (messaging.lastFetchConversationUUID == null || messaging.lastFetchConversationUserUUID == null) return@subscribe
</a><a href="#h19-0-150" id="h19-0-150" class="i">+
</a><a href="#h19-0-151" id="h19-0-151" class="i">+                //filter by the slot index
</a><a href="#h19-0-152" id="h19-0-152" class="i">+                if (viewGroup.getChildCount() != context.config.userInterface.friendFeedMenuPosition.get()) return@subscribe
</a><a href="#h19-0-153" id="h19-0-153" class="i">+                if (viewTagState[viewGroup]) return@subscribe
</a><a href="#h19-0-154" id="h19-0-154" class="i">+                menuMap[FriendFeedInfoMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h19-0-155" id="h19-0-155" class="i">+            }
</a><a href="#h19-0-156" id="h19-0-156" class="i">+        }
</a><a href="#h19-0-157" id="h19-0-157" class="i">+    }
</a><a href="#h19-0-158" id="h19-0-158" class="i">+}</a><a href="#h19-0-159" id="h19-0-159" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -9,8 +9,10 @@ import android.view.View
</a> import android.view.ViewGroup
 import android.widget.Button
 import android.widget.CompoundButton
<a href="#h20-0-3" id="h20-0-3" class="i">+import android.widget.LinearLayout
</a> import android.widget.ProgressBar
 import android.widget.Switch
<a href="#h20-0-6" id="h20-0-6" class="i">+import androidx.compose.runtime.remember
</a> import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.Job
 import kotlinx.coroutines.delay
<a href="#h20-1" id="h20-1" class="h">@@ -21,6 +23,10 @@ import me.rhunk.snapenhance.common.data.MessageUpdate
</a> import me.rhunk.snapenhance.common.database.impl.ConversationMessage
 import me.rhunk.snapenhance.common.database.impl.FriendInfo
 import me.rhunk.snapenhance.common.database.impl.UserConversationLink
<a href="#h20-1-3" id="h20-1-3" class="i">+import me.rhunk.snapenhance.common.scripting.ui.EnumScriptInterface
</a><a href="#h20-1-4" id="h20-1-4" class="i">+import me.rhunk.snapenhance.common.scripting.ui.InterfaceManager
</a><a href="#h20-1-5" id="h20-1-5" class="i">+import me.rhunk.snapenhance.common.scripting.ui.ScriptInterface
</a><a href="#h20-1-6" id="h20-1-6" class="i">+import me.rhunk.snapenhance.common.ui.createComposeView
</a> import me.rhunk.snapenhance.common.util.protobuf.ProtoReader
 import me.rhunk.snapenhance.common.util.snap.BitmojiSelfie
 import me.rhunk.snapenhance.core.features.impl.messaging.Messaging
<a href="#h20-2" id="h20-2" class="h">@@ -326,5 +332,33 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>                 }
             })
         }
<a href="#h20-2-3" id="h20-2-3" class="i">+
</a><a href="#h20-2-4" id="h20-2-4" class="i">+        if (context.config.scripting.integratedUI.get()) {
</a><a href="#h20-2-5" id="h20-2-5" class="i">+            context.scriptRuntime.eachModule {
</a><a href="#h20-2-6" id="h20-2-6" class="i">+                val interfaceManager = getBinding(InterfaceManager::class)
</a><a href="#h20-2-7" id="h20-2-7" class="i">+                    ?.takeIf {
</a><a href="#h20-2-8" id="h20-2-8" class="i">+                        it.hasInterface(EnumScriptInterface.FRIEND_FEED_CONTEXT_MENU)
</a><a href="#h20-2-9" id="h20-2-9" class="i">+                    } ?: return@eachModule
</a><a href="#h20-2-10" id="h20-2-10" class="i">+
</a><a href="#h20-2-11" id="h20-2-11" class="i">+                viewConsumer(LinearLayout(view.context).apply {
</a><a href="#h20-2-12" id="h20-2-12" class="i">+                    layoutParams = ViewGroup.LayoutParams(
</a><a href="#h20-2-13" id="h20-2-13" class="i">+                        ViewGroup.LayoutParams.MATCH_PARENT,
</a><a href="#h20-2-14" id="h20-2-14" class="i">+                        ViewGroup.LayoutParams.WRAP_CONTENT
</a><a href="#h20-2-15" id="h20-2-15" class="i">+                    )
</a><a href="#h20-2-16" id="h20-2-16" class="i">+
</a><a href="#h20-2-17" id="h20-2-17" class="i">+                    applyTheme(view.width, hasRadius = true)
</a><a href="#h20-2-18" id="h20-2-18" class="i">+
</a><a href="#h20-2-19" id="h20-2-19" class="i">+                    orientation = LinearLayout.VERTICAL
</a><a href="#h20-2-20" id="h20-2-20" class="i">+                    addView(createComposeView(view.context) {
</a><a href="#h20-2-21" id="h20-2-21" class="i">+                        ScriptInterface(interfaceBuilder = remember {
</a><a href="#h20-2-22" id="h20-2-22" class="i">+                            interfaceManager.buildInterface(EnumScriptInterface.FRIEND_FEED_CONTEXT_MENU, mapOf(
</a><a href="#h20-2-23" id="h20-2-23" class="i">+                                &quot;conversationId&quot; to conversationId,
</a><a href="#h20-2-24" id="h20-2-24" class="i">+                                &quot;userId&quot; to targetUser
</a><a href="#h20-2-25" id="h20-2-25" class="i">+                            ))
</a><a href="#h20-2-26" id="h20-2-26" class="i">+                        } ?: return@createComposeView)
</a><a href="#h20-2-27" id="h20-2-27" class="i">+                    })
</a><a href="#h20-2-28" id="h20-2-28" class="i">+                })
</a><a href="#h20-2-29" id="h20-2-29" class="i">+            }
</a><a href="#h20-2-30" id="h20-2-30" class="i">+        }
</a>     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h21" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/MenuViewInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/MenuViewInjector.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/MenuViewInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ui/menu/impl/MenuViewInjector.kt</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -1,151 +0,0 @@
</a><a href="#h21-0-0" id="h21-0-0" class="d">-package me.rhunk.snapenhance.core.ui.menu.impl
</a><a href="#h21-0-1" id="h21-0-1" class="d">-
</a><a href="#h21-0-2" id="h21-0-2" class="d">-import android.annotation.SuppressLint
</a><a href="#h21-0-3" id="h21-0-3" class="d">-import android.view.Gravity
</a><a href="#h21-0-4" id="h21-0-4" class="d">-import android.view.View
</a><a href="#h21-0-5" id="h21-0-5" class="d">-import android.view.ViewGroup
</a><a href="#h21-0-6" id="h21-0-6" class="d">-import android.widget.FrameLayout
</a><a href="#h21-0-7" id="h21-0-7" class="d">-import android.widget.LinearLayout
</a><a href="#h21-0-8" id="h21-0-8" class="d">-import me.rhunk.snapenhance.core.event.events.impl.AddViewEvent
</a><a href="#h21-0-9" id="h21-0-9" class="d">-import me.rhunk.snapenhance.core.features.Feature
</a><a href="#h21-0-10" id="h21-0-10" class="d">-import me.rhunk.snapenhance.core.features.FeatureLoadParams
</a><a href="#h21-0-11" id="h21-0-11" class="d">-import me.rhunk.snapenhance.core.features.impl.messaging.Messaging
</a><a href="#h21-0-12" id="h21-0-12" class="d">-import me.rhunk.snapenhance.core.ui.ViewTagState
</a><a href="#h21-0-13" id="h21-0-13" class="d">-import me.rhunk.snapenhance.core.ui.menu.AbstractMenu
</a><a href="#h21-0-14" id="h21-0-14" class="d">-import me.rhunk.snapenhance.core.util.ktx.getIdentifier
</a><a href="#h21-0-15" id="h21-0-15" class="d">-import java.lang.reflect.Modifier
</a><a href="#h21-0-16" id="h21-0-16" class="d">-import kotlin.reflect.KClass
</a><a href="#h21-0-17" id="h21-0-17" class="d">-
</a><a href="#h21-0-18" id="h21-0-18" class="d">-@SuppressLint(&quot;DiscouragedApi&quot;)
</a><a href="#h21-0-19" id="h21-0-19" class="d">-class MenuViewInjector : Feature(&quot;MenuViewInjector&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h21-0-20" id="h21-0-20" class="d">-    private val viewTagState = ViewTagState()
</a><a href="#h21-0-21" id="h21-0-21" class="d">-
</a><a href="#h21-0-22" id="h21-0-22" class="d">-    private val menuMap = mutableMapOf&lt;KClass&lt;*&gt;, AbstractMenu&gt;()
</a><a href="#h21-0-23" id="h21-0-23" class="d">-    private val newChatString by lazy {
</a><a href="#h21-0-24" id="h21-0-24" class="d">-        context.resources.getString(context.resources.getIdentifier(&quot;new_chat&quot;, &quot;string&quot;))
</a><a href="#h21-0-25" id="h21-0-25" class="d">-    }
</a><a href="#h21-0-26" id="h21-0-26" class="d">-
</a><a href="#h21-0-27" id="h21-0-27" class="d">-    @SuppressLint(&quot;ResourceType&quot;)
</a><a href="#h21-0-28" id="h21-0-28" class="d">-    override fun asyncOnActivityCreate() {
</a><a href="#h21-0-29" id="h21-0-29" class="d">-        menuMap[OperaContextActionMenu::class] = OperaContextActionMenu()
</a><a href="#h21-0-30" id="h21-0-30" class="d">-        menuMap[OperaDownloadIconMenu::class] = OperaDownloadIconMenu()
</a><a href="#h21-0-31" id="h21-0-31" class="d">-        menuMap[SettingsGearInjector::class] = SettingsGearInjector()
</a><a href="#h21-0-32" id="h21-0-32" class="d">-        menuMap[FriendFeedInfoMenu::class] = FriendFeedInfoMenu()
</a><a href="#h21-0-33" id="h21-0-33" class="d">-        menuMap[ChatActionMenu::class] = ChatActionMenu()
</a><a href="#h21-0-34" id="h21-0-34" class="d">-        menuMap[SettingsMenu::class] = SettingsMenu()
</a><a href="#h21-0-35" id="h21-0-35" class="d">-
</a><a href="#h21-0-36" id="h21-0-36" class="d">-        menuMap.values.forEach { it.context = context; it.init() }
</a><a href="#h21-0-37" id="h21-0-37" class="d">-
</a><a href="#h21-0-38" id="h21-0-38" class="d">-        val messaging = context.feature(Messaging::class)
</a><a href="#h21-0-39" id="h21-0-39" class="d">-
</a><a href="#h21-0-40" id="h21-0-40" class="d">-        val actionSheetItemsContainerLayoutId = context.resources.getIdentifier(&quot;action_sheet_items_container&quot;, &quot;id&quot;)
</a><a href="#h21-0-41" id="h21-0-41" class="d">-        val actionSheetContainer = context.resources.getIdentifier(&quot;action_sheet_container&quot;, &quot;id&quot;)
</a><a href="#h21-0-42" id="h21-0-42" class="d">-        val actionMenu = context.resources.getIdentifier(&quot;action_menu&quot;, &quot;id&quot;)
</a><a href="#h21-0-43" id="h21-0-43" class="d">-        val componentsHolder = context.resources.getIdentifier(&quot;components_holder&quot;, &quot;id&quot;)
</a><a href="#h21-0-44" id="h21-0-44" class="d">-        val feedNewChat = context.resources.getIdentifier(&quot;feed_new_chat&quot;, &quot;id&quot;)
</a><a href="#h21-0-45" id="h21-0-45" class="d">-        val contextMenuButtonIconView = context.resources.getIdentifier(&quot;context_menu_button_icon_view&quot;, &quot;id&quot;)
</a><a href="#h21-0-46" id="h21-0-46" class="d">-
</a><a href="#h21-0-47" id="h21-0-47" class="d">-        context.event.subscribe(AddViewEvent::class) { event -&gt;
</a><a href="#h21-0-48" id="h21-0-48" class="d">-            val originalAddView: (View) -&gt; Unit = {
</a><a href="#h21-0-49" id="h21-0-49" class="d">-                event.adapter.invokeOriginal(arrayOf(it, -1,
</a><a href="#h21-0-50" id="h21-0-50" class="d">-                    FrameLayout.LayoutParams(
</a><a href="#h21-0-51" id="h21-0-51" class="d">-                        ViewGroup.LayoutParams.MATCH_PARENT,
</a><a href="#h21-0-52" id="h21-0-52" class="d">-                        ViewGroup.LayoutParams.MATCH_PARENT
</a><a href="#h21-0-53" id="h21-0-53" class="d">-                    ))
</a><a href="#h21-0-54" id="h21-0-54" class="d">-                )
</a><a href="#h21-0-55" id="h21-0-55" class="d">-            }
</a><a href="#h21-0-56" id="h21-0-56" class="d">-
</a><a href="#h21-0-57" id="h21-0-57" class="d">-            val viewGroup: ViewGroup = event.parent
</a><a href="#h21-0-58" id="h21-0-58" class="d">-            val childView: View = event.view
</a><a href="#h21-0-59" id="h21-0-59" class="d">-            menuMap[OperaContextActionMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h21-0-60" id="h21-0-60" class="d">-
</a><a href="#h21-0-61" id="h21-0-61" class="d">-            if (childView.id == contextMenuButtonIconView) {
</a><a href="#h21-0-62" id="h21-0-62" class="d">-                menuMap[OperaDownloadIconMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h21-0-63" id="h21-0-63" class="d">-            }
</a><a href="#h21-0-64" id="h21-0-64" class="d">-
</a><a href="#h21-0-65" id="h21-0-65" class="d">-            if (event.parent.id == componentsHolder &amp;&amp; childView.id == feedNewChat) {
</a><a href="#h21-0-66" id="h21-0-66" class="d">-                menuMap[SettingsGearInjector::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h21-0-67" id="h21-0-67" class="d">-                return@subscribe
</a><a href="#h21-0-68" id="h21-0-68" class="d">-            }
</a><a href="#h21-0-69" id="h21-0-69" class="d">-
</a><a href="#h21-0-70" id="h21-0-70" class="d">-            //download in chat snaps and notes from the chat action menu
</a><a href="#h21-0-71" id="h21-0-71" class="d">-            if (viewGroup.javaClass.name.endsWith(&quot;ActionMenuChatItemContainer&quot;)) {
</a><a href="#h21-0-72" id="h21-0-72" class="d">-                if (viewGroup.parent == null || viewGroup.parent.parent == null) return@subscribe
</a><a href="#h21-0-73" id="h21-0-73" class="d">-                menuMap[ChatActionMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h21-0-74" id="h21-0-74" class="d">-                return@subscribe
</a><a href="#h21-0-75" id="h21-0-75" class="d">-            }
</a><a href="#h21-0-76" id="h21-0-76" class="d">-
</a><a href="#h21-0-77" id="h21-0-77" class="d">-            //TODO: inject in group chat menus
</a><a href="#h21-0-78" id="h21-0-78" class="d">-            if (viewGroup.id == actionSheetContainer &amp;&amp; childView.id == actionMenu &amp;&amp; messaging.lastFetchGroupConversationUUID != null) {
</a><a href="#h21-0-79" id="h21-0-79" class="d">-                val injectedLayout = LinearLayout(childView.context).apply {
</a><a href="#h21-0-80" id="h21-0-80" class="d">-                    orientation = LinearLayout.VERTICAL
</a><a href="#h21-0-81" id="h21-0-81" class="d">-                    gravity = Gravity.BOTTOM
</a><a href="#h21-0-82" id="h21-0-82" class="d">-                    layoutParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT)
</a><a href="#h21-0-83" id="h21-0-83" class="d">-                    addView(childView)
</a><a href="#h21-0-84" id="h21-0-84" class="d">-                    addOnAttachStateChangeListener(object: View.OnAttachStateChangeListener {
</a><a href="#h21-0-85" id="h21-0-85" class="d">-                        override fun onViewAttachedToWindow(v: View) {}
</a><a href="#h21-0-86" id="h21-0-86" class="d">-                        override fun onViewDetachedFromWindow(v: View) {
</a><a href="#h21-0-87" id="h21-0-87" class="d">-                            messaging.lastFetchGroupConversationUUID = null
</a><a href="#h21-0-88" id="h21-0-88" class="d">-                        }
</a><a href="#h21-0-89" id="h21-0-89" class="d">-                    })
</a><a href="#h21-0-90" id="h21-0-90" class="d">-                }
</a><a href="#h21-0-91" id="h21-0-91" class="d">-
</a><a href="#h21-0-92" id="h21-0-92" class="d">-                val viewList = mutableListOf&lt;View&gt;()
</a><a href="#h21-0-93" id="h21-0-93" class="d">-                context.runOnUiThread {
</a><a href="#h21-0-94" id="h21-0-94" class="d">-                    menuMap[FriendFeedInfoMenu::class]?.inject(event.parent, injectedLayout) { view -&gt;
</a><a href="#h21-0-95" id="h21-0-95" class="d">-                        view.layoutParams = LinearLayout.LayoutParams(
</a><a href="#h21-0-96" id="h21-0-96" class="d">-                            ViewGroup.LayoutParams.MATCH_PARENT,
</a><a href="#h21-0-97" id="h21-0-97" class="d">-                            ViewGroup.LayoutParams.WRAP_CONTENT
</a><a href="#h21-0-98" id="h21-0-98" class="d">-                        ).apply {
</a><a href="#h21-0-99" id="h21-0-99" class="d">-                            setMargins(0, 5, 0, 5)
</a><a href="#h21-0-100" id="h21-0-100" class="d">-                        }
</a><a href="#h21-0-101" id="h21-0-101" class="d">-                        viewList.add(view)
</a><a href="#h21-0-102" id="h21-0-102" class="d">-                    }
</a><a href="#h21-0-103" id="h21-0-103" class="d">-
</a><a href="#h21-0-104" id="h21-0-104" class="d">-                    viewList.add(View(injectedLayout.context).apply {
</a><a href="#h21-0-105" id="h21-0-105" class="d">-                        layoutParams = LinearLayout.LayoutParams(
</a><a href="#h21-0-106" id="h21-0-106" class="d">-                            ViewGroup.LayoutParams.MATCH_PARENT,
</a><a href="#h21-0-107" id="h21-0-107" class="d">-                            30
</a><a href="#h21-0-108" id="h21-0-108" class="d">-                        )
</a><a href="#h21-0-109" id="h21-0-109" class="d">-                    })
</a><a href="#h21-0-110" id="h21-0-110" class="d">-
</a><a href="#h21-0-111" id="h21-0-111" class="d">-                    viewList.reversed().forEach { injectedLayout.addView(it, 0) }
</a><a href="#h21-0-112" id="h21-0-112" class="d">-                }
</a><a href="#h21-0-113" id="h21-0-113" class="d">-
</a><a href="#h21-0-114" id="h21-0-114" class="d">-                event.view = injectedLayout
</a><a href="#h21-0-115" id="h21-0-115" class="d">-            }
</a><a href="#h21-0-116" id="h21-0-116" class="d">-
</a><a href="#h21-0-117" id="h21-0-117" class="d">-            if (viewGroup is LinearLayout &amp;&amp; viewGroup.id == actionSheetItemsContainerLayoutId) {
</a><a href="#h21-0-118" id="h21-0-118" class="d">-                val itemStringInterface by lazy {
</a><a href="#h21-0-119" id="h21-0-119" class="d">-                    childView.javaClass.declaredFields.filter {
</a><a href="#h21-0-120" id="h21-0-120" class="d">-                        !it.type.isPrimitive &amp;&amp; Modifier.isAbstract(it.type.modifiers)
</a><a href="#h21-0-121" id="h21-0-121" class="d">-                    }.map {
</a><a href="#h21-0-122" id="h21-0-122" class="d">-                        runCatching {
</a><a href="#h21-0-123" id="h21-0-123" class="d">-                            it.isAccessible = true
</a><a href="#h21-0-124" id="h21-0-124" class="d">-                            it[childView]
</a><a href="#h21-0-125" id="h21-0-125" class="d">-                        }.getOrNull()
</a><a href="#h21-0-126" id="h21-0-126" class="d">-                    }.firstOrNull()
</a><a href="#h21-0-127" id="h21-0-127" class="d">-                }
</a><a href="#h21-0-128" id="h21-0-128" class="d">-
</a><a href="#h21-0-129" id="h21-0-129" class="d">-                //the 3 dot button shows a menu which contains the first item as a Plain object
</a><a href="#h21-0-130" id="h21-0-130" class="d">-                if (viewGroup.getChildCount() == 0 &amp;&amp; itemStringInterface != null &amp;&amp; itemStringInterface.toString().startsWith(&quot;Plain(primaryText=$newChatString&quot;)) {
</a><a href="#h21-0-131" id="h21-0-131" class="d">-                    menuMap[SettingsMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h21-0-132" id="h21-0-132" class="d">-                    viewGroup.addOnAttachStateChangeListener(object: View.OnAttachStateChangeListener {
</a><a href="#h21-0-133" id="h21-0-133" class="d">-                        override fun onViewAttachedToWindow(v: View) {}
</a><a href="#h21-0-134" id="h21-0-134" class="d">-                        override fun onViewDetachedFromWindow(v: View) {
</a><a href="#h21-0-135" id="h21-0-135" class="d">-                            viewTagState.removeState(viewGroup)
</a><a href="#h21-0-136" id="h21-0-136" class="d">-                        }
</a><a href="#h21-0-137" id="h21-0-137" class="d">-                    })
</a><a href="#h21-0-138" id="h21-0-138" class="d">-                    viewTagState[viewGroup]
</a><a href="#h21-0-139" id="h21-0-139" class="d">-                    return@subscribe
</a><a href="#h21-0-140" id="h21-0-140" class="d">-                }
</a><a href="#h21-0-141" id="h21-0-141" class="d">-                if (messaging.lastFetchConversationUUID == null || messaging.lastFetchConversationUserUUID == null) return@subscribe
</a><a href="#h21-0-142" id="h21-0-142" class="d">-
</a><a href="#h21-0-143" id="h21-0-143" class="d">-                //filter by the slot index
</a><a href="#h21-0-144" id="h21-0-144" class="d">-                if (viewGroup.getChildCount() != context.config.userInterface.friendFeedMenuPosition.get()) return@subscribe
</a><a href="#h21-0-145" id="h21-0-145" class="d">-                if (viewTagState[viewGroup]) return@subscribe
</a><a href="#h21-0-146" id="h21-0-146" class="d">-                menuMap[FriendFeedInfoMenu::class]!!.inject(viewGroup, childView, originalAddView)
</a><a href="#h21-0-147" id="h21-0-147" class="d">-            }
</a><a href="#h21-0-148" id="h21-0-148" class="d">-        }
</a><a href="#h21-0-149" id="h21-0-149" class="d">-    }
</a><a href="#h21-0-150" id="h21-0-150" class="d">-}</a><a href="#h21-0-151" id="h21-0-151" class="d">-
\ No newline at end of file
</a></pre>
</div>
</body>
</html>
