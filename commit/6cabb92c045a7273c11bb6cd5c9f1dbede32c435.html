<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: scope tab base logic - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/6cabb92c045a7273c11bb6cd5c9f1dbede32c435.html">6cabb92c045a7273c11bb6cd5c9f1dbede32c435</a>
<b>parent</b> <a href="../commit/2db332c3cd767eb9ba1b27768f522417b8a95bd3.html">2db332c3cd767eb9ba1b27768f522417b8a95bd3</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sat, 19 Aug 2023 20:09:35 +0200

feat: scope tab base logic

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a></td><td> | </td><td class="num">91</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Navigation.kt</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++++++++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a></td><td> | </td><td class="num">84</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++</span><span class="d">--------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt</a></td><td> | </td><td class="num">5</td><td><span class="i"></span><span class="d">-----</span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeTab.kt</a></td><td> | </td><td class="num">73</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a></td><td> | </td><td class="num">105</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></td><td> | </td><td class="num">70</td><td><span class="i">++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++</span><span class="d">------</span></td></tr>
</table></pre><pre>10 files changed, 332 insertions(+), 142 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -12,7 +12,7 @@ import me.rhunk.snapenhance.bridge.wrapper.LocaleWrapper
</a> import me.rhunk.snapenhance.bridge.wrapper.MessageLoggerWrapper
 import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
 import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
<a href="#h0-0-3" id="h0-0-3" class="d">-import me.rhunk.snapenhance.core.messaging.RuleScope
</a><a href="#h0-0-4" id="h0-0-4" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingScope
</a> import me.rhunk.snapenhance.database.objects.FriendInfo
 import me.rhunk.snapenhance.download.DownloadProcessor
 import me.rhunk.snapenhance.util.SerializableDataObject
<a href="#h0-1" id="h0-1" class="h">@@ -112,7 +112,7 @@ class BridgeService : Service() {
</a>         }
 
         override fun getRules(objectType: String, uuid: String): MutableList&lt;String&gt; {
<a href="#h0-1-3" id="h0-1-3" class="d">-            remoteSideContext.modDatabase.getRulesFromId(RuleScope.valueOf(objectType), uuid)
</a><a href="#h0-1-4" id="h0-1-4" class="i">+            remoteSideContext.modDatabase.getRulesFromId(MessagingScope.valueOf(objectType), uuid)
</a>                 .let { rules -&gt;
                     return rules.map { it.toJson() }.toMutableList()
                 }
<a href="#h0-2" id="h0-2" class="h">@@ -122,14 +122,14 @@ class BridgeService : Service() {
</a>             Logger.debug(&quot;Syncing remote&quot;)
             syncCallback = callback
             measureTimeMillis {
<a href="#h0-2-3" id="h0-2-3" class="d">-                remoteSideContext.modDatabase.getFriendsIds().forEach { friendId -&gt;
</a><a href="#h0-2-4" id="h0-2-4" class="i">+                remoteSideContext.modDatabase.getFriends().map { it.userId } .forEach { friendId -&gt;
</a>                     runCatching {
                         triggerFriendSync(friendId)
                     }.onFailure {
                         Logger.error(&quot;Failed to sync friend $friendId&quot;, it)
                     }
                 }
<a href="#h0-2-11" id="h0-2-11" class="d">-                remoteSideContext.modDatabase.getGroupsIds().forEach { groupId -&gt;
</a><a href="#h0-2-12" id="h0-2-12" class="i">+                remoteSideContext.modDatabase.getGroups().map { it.conversationId }.forEach { groupId -&gt;
</a>                     runCatching {
                         triggerGroupSync(groupId)
                     }.onFailure {
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -8,7 +8,7 @@ import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
</a> import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
 import me.rhunk.snapenhance.core.messaging.MessagingRule
 import me.rhunk.snapenhance.core.messaging.Mode
<a href="#h1-0-3" id="h1-0-3" class="d">-import me.rhunk.snapenhance.core.messaging.RuleScope
</a><a href="#h1-0-4" id="h1-0-4" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingScope
</a> import me.rhunk.snapenhance.database.objects.FriendInfo
 import me.rhunk.snapenhance.util.SQLiteDatabaseHelper
 import me.rhunk.snapenhance.util.ktx.getInteger
<a href="#h1-1" id="h1-1" class="h">@@ -33,14 +33,16 @@ class ModDatabase(
</a>         database = context.androidContext.openOrCreateDatabase(&quot;main.db&quot;, 0, null)
         SQLiteDatabaseHelper.createTablesFromSchema(database, mapOf(
             &quot;friends&quot; to listOf(
<a href="#h1-1-3" id="h1-1-3" class="d">-                &quot;userId VARCHAR PRIMARY KEY&quot;,
</a><a href="#h1-1-4" id="h1-1-4" class="i">+                &quot;id INTEGER PRIMARY KEY AUTOINCREMENT&quot;,
</a><a href="#h1-1-5" id="h1-1-5" class="i">+                &quot;userId VARCHAR UNIQUE&quot;,
</a>                 &quot;displayName VARCHAR&quot;,
                 &quot;mutableUsername VARCHAR&quot;,
                 &quot;bitmojiId VARCHAR&quot;,
                 &quot;selfieId VARCHAR&quot;
             ),
             &quot;groups&quot; to listOf(
<a href="#h1-1-12" id="h1-1-12" class="d">-                &quot;conversationId VARCHAR PRIMARY KEY&quot;,
</a><a href="#h1-1-13" id="h1-1-13" class="i">+                &quot;id INTEGER PRIMARY KEY AUTOINCREMENT&quot;,
</a><a href="#h1-1-14" id="h1-1-14" class="i">+                &quot;conversationId VARCHAR UNIQUE&quot;,
</a>                 &quot;name VARCHAR&quot;,
                 &quot;participantsCount INTEGER&quot;
             ),
<a href="#h1-2" id="h1-2" class="h">@@ -73,26 +75,6 @@ class ModDatabase(
</a>         ))
     }
 
<a href="#h1-2-3" id="h1-2-3" class="d">-    fun getFriendsIds(): List&lt;String&gt; {
</a><a href="#h1-2-4" id="h1-2-4" class="d">-        return database.rawQuery(&quot;SELECT userId FROM friends&quot;, null).use { cursor -&gt;
</a><a href="#h1-2-5" id="h1-2-5" class="d">-            val ids = mutableListOf&lt;String&gt;()
</a><a href="#h1-2-6" id="h1-2-6" class="d">-            while (cursor.moveToNext()) {
</a><a href="#h1-2-7" id="h1-2-7" class="d">-                ids.add(cursor.getString(0))
</a><a href="#h1-2-8" id="h1-2-8" class="d">-            }
</a><a href="#h1-2-9" id="h1-2-9" class="d">-            ids
</a><a href="#h1-2-10" id="h1-2-10" class="d">-        }
</a><a href="#h1-2-11" id="h1-2-11" class="d">-    }
</a><a href="#h1-2-12" id="h1-2-12" class="d">-
</a><a href="#h1-2-13" id="h1-2-13" class="d">-    fun getGroupsIds(): List&lt;String&gt; {
</a><a href="#h1-2-14" id="h1-2-14" class="d">-        return database.rawQuery(&quot;SELECT conversationId FROM groups&quot;, null).use { cursor -&gt;
</a><a href="#h1-2-15" id="h1-2-15" class="d">-            val ids = mutableListOf&lt;String&gt;()
</a><a href="#h1-2-16" id="h1-2-16" class="d">-            while (cursor.moveToNext()) {
</a><a href="#h1-2-17" id="h1-2-17" class="d">-                ids.add(cursor.getString(0))
</a><a href="#h1-2-18" id="h1-2-18" class="d">-            }
</a><a href="#h1-2-19" id="h1-2-19" class="d">-            ids
</a><a href="#h1-2-20" id="h1-2-20" class="d">-        }
</a><a href="#h1-2-21" id="h1-2-21" class="d">-    }
</a><a href="#h1-2-22" id="h1-2-22" class="d">-
</a>     fun getGroups(): List&lt;MessagingGroupInfo&gt; {
         return database.rawQuery(&quot;SELECT * FROM groups&quot;, null).use { cursor -&gt;
             val groups = mutableListOf&lt;MessagingGroupInfo&gt;()
<a href="#h1-3" id="h1-3" class="h">@@ -107,8 +89,8 @@ class ModDatabase(
</a>         }
     }
 
<a href="#h1-3-3" id="h1-3-3" class="d">-    fun getFriends(): List&lt;MessagingFriendInfo&gt; {
</a><a href="#h1-3-4" id="h1-3-4" class="d">-        return database.rawQuery(&quot;SELECT * FROM friends&quot;, null).use { cursor -&gt;
</a><a href="#h1-3-5" id="h1-3-5" class="i">+    fun getFriends(descOrder: Boolean = false): List&lt;MessagingFriendInfo&gt; {
</a><a href="#h1-3-6" id="h1-3-6" class="i">+        return database.rawQuery(&quot;SELECT * FROM friends ORDER BY id ${if (descOrder) &quot;DESC&quot; else &quot;ASC&quot;}&quot;, null).use { cursor -&gt;
</a>             val friends = mutableListOf&lt;MessagingFriendInfo&gt;()
             while (cursor.moveToNext()) {
                 runCatching {
<a href="#h1-4" id="h1-4" class="h">@@ -131,7 +113,7 @@ class ModDatabase(
</a>     fun syncGroupInfo(conversationInfo: MessagingGroupInfo) {
         executeAsync {
             try {
<a href="#h1-4-3" id="h1-4-3" class="d">-                database.execSQL(&quot;INSERT OR REPLACE INTO groups VALUES (?, ?, ?)&quot;, arrayOf(
</a><a href="#h1-4-4" id="h1-4-4" class="i">+                database.execSQL(&quot;INSERT OR REPLACE INTO groups (conversationId, name, participantsCount) VALUES (?, ?, ?)&quot;, arrayOf(
</a>                     conversationInfo.conversationId,
                     conversationInfo.name,
                     conversationInfo.participantsCount
<a href="#h1-5" id="h1-5" class="h">@@ -145,13 +127,16 @@ class ModDatabase(
</a>     fun syncFriend(friend: FriendInfo) {
         executeAsync {
             try {
<a href="#h1-5-3" id="h1-5-3" class="d">-                database.execSQL(&quot;INSERT OR REPLACE INTO friends VALUES (?, ?, ?, ?, ?)&quot;, arrayOf(
</a><a href="#h1-5-4" id="h1-5-4" class="d">-                    friend.userId,
</a><a href="#h1-5-5" id="h1-5-5" class="d">-                    friend.displayName,
</a><a href="#h1-5-6" id="h1-5-6" class="d">-                    friend.usernameForSorting!!,
</a><a href="#h1-5-7" id="h1-5-7" class="d">-                    friend.bitmojiAvatarId,
</a><a href="#h1-5-8" id="h1-5-8" class="d">-                    friend.bitmojiSelfieId
</a><a href="#h1-5-9" id="h1-5-9" class="d">-                ))
</a><a href="#h1-5-10" id="h1-5-10" class="i">+                database.execSQL(
</a><a href="#h1-5-11" id="h1-5-11" class="i">+                    &quot;INSERT OR REPLACE INTO friends (userId, displayName, mutableUsername, bitmojiId, selfieId) VALUES (?, ?, ?, ?, ?)&quot;,
</a><a href="#h1-5-12" id="h1-5-12" class="i">+                    arrayOf(
</a><a href="#h1-5-13" id="h1-5-13" class="i">+                        friend.userId,
</a><a href="#h1-5-14" id="h1-5-14" class="i">+                        friend.displayName,
</a><a href="#h1-5-15" id="h1-5-15" class="i">+                        friend.usernameForSorting!!,
</a><a href="#h1-5-16" id="h1-5-16" class="i">+                        friend.bitmojiAvatarId,
</a><a href="#h1-5-17" id="h1-5-17" class="i">+                        friend.bitmojiSelfieId
</a><a href="#h1-5-18" id="h1-5-18" class="i">+                    )
</a><a href="#h1-5-19" id="h1-5-19" class="i">+                )
</a>                 //sync streaks
                 if (friend.streakLength &gt; 0) {
                     database.execSQL(&quot;INSERT OR REPLACE INTO streaks (userId, expirationTimestamp, count) VALUES (?, ?, ?)&quot;, arrayOf(
<a href="#h1-6" id="h1-6" class="h">@@ -168,13 +153,13 @@ class ModDatabase(
</a>         }
     }
 
<a href="#h1-6-3" id="h1-6-3" class="d">-    fun getRulesFromId(type: RuleScope, targetUuid: String): List&lt;MessagingRule&gt; {
</a><a href="#h1-6-4" id="h1-6-4" class="i">+    fun getRulesFromId(type: MessagingScope, targetUuid: String): List&lt;MessagingRule&gt; {
</a>         return database.rawQuery(&quot;SELECT * FROM rules WHERE objectType = ? AND targetUuid = ?&quot;, arrayOf(type.name, targetUuid)).use { cursor -&gt;
             val rules = mutableListOf&lt;MessagingRule&gt;()
             while (cursor.moveToNext()) {
                 rules.add(MessagingRule(
                     id = cursor.getInteger(&quot;id&quot;),
<a href="#h1-6-10" id="h1-6-10" class="d">-                    ruleScope = RuleScope.valueOf(cursor.getStringOrNull(&quot;scope&quot;)!!),
</a><a href="#h1-6-11" id="h1-6-11" class="i">+                    messagingScope = MessagingScope.valueOf(cursor.getStringOrNull(&quot;scope&quot;)!!),
</a>                     targetUuid = cursor.getStringOrNull(&quot;targetUuid&quot;)!!,
                     enabled = cursor.getInteger(&quot;enabled&quot;) == 1,
                     mode = Mode.valueOf(cursor.getStringOrNull(&quot;mode&quot;)!!),
<a href="#h1-7" id="h1-7" class="h">@@ -185,6 +170,42 @@ class ModDatabase(
</a>         }
     }
 
<a href="#h1-7-3" id="h1-7-3" class="i">+    fun getFriendInfo(userId: String): MessagingFriendInfo? {
</a><a href="#h1-7-4" id="h1-7-4" class="i">+        return database.rawQuery(&quot;SELECT * FROM friends WHERE userId = ?&quot;, arrayOf(userId)).use { cursor -&gt;
</a><a href="#h1-7-5" id="h1-7-5" class="i">+            if (!cursor.moveToFirst()) return@use null
</a><a href="#h1-7-6" id="h1-7-6" class="i">+            MessagingFriendInfo(
</a><a href="#h1-7-7" id="h1-7-7" class="i">+                userId = cursor.getStringOrNull(&quot;userId&quot;)!!,
</a><a href="#h1-7-8" id="h1-7-8" class="i">+                displayName = cursor.getStringOrNull(&quot;displayName&quot;),
</a><a href="#h1-7-9" id="h1-7-9" class="i">+                mutableUsername = cursor.getStringOrNull(&quot;mutableUsername&quot;)!!,
</a><a href="#h1-7-10" id="h1-7-10" class="i">+                bitmojiId = cursor.getStringOrNull(&quot;bitmojiId&quot;),
</a><a href="#h1-7-11" id="h1-7-11" class="i">+                selfieId = cursor.getStringOrNull(&quot;selfieId&quot;)
</a><a href="#h1-7-12" id="h1-7-12" class="i">+            )
</a><a href="#h1-7-13" id="h1-7-13" class="i">+        }
</a><a href="#h1-7-14" id="h1-7-14" class="i">+    }
</a><a href="#h1-7-15" id="h1-7-15" class="i">+
</a><a href="#h1-7-16" id="h1-7-16" class="i">+    fun deleteFriend(userId: String) {
</a><a href="#h1-7-17" id="h1-7-17" class="i">+        executeAsync {
</a><a href="#h1-7-18" id="h1-7-18" class="i">+            database.execSQL(&quot;DELETE FROM friends WHERE userId = ?&quot;, arrayOf(userId))
</a><a href="#h1-7-19" id="h1-7-19" class="i">+        }
</a><a href="#h1-7-20" id="h1-7-20" class="i">+    }
</a><a href="#h1-7-21" id="h1-7-21" class="i">+
</a><a href="#h1-7-22" id="h1-7-22" class="i">+    fun deleteGroup(conversationId: String) {
</a><a href="#h1-7-23" id="h1-7-23" class="i">+        executeAsync {
</a><a href="#h1-7-24" id="h1-7-24" class="i">+            database.execSQL(&quot;DELETE FROM groups WHERE conversationId = ?&quot;, arrayOf(conversationId))
</a><a href="#h1-7-25" id="h1-7-25" class="i">+        }
</a><a href="#h1-7-26" id="h1-7-26" class="i">+    }
</a><a href="#h1-7-27" id="h1-7-27" class="i">+
</a><a href="#h1-7-28" id="h1-7-28" class="i">+    fun getGroupInfo(conversationId: String): MessagingGroupInfo? {
</a><a href="#h1-7-29" id="h1-7-29" class="i">+        return database.rawQuery(&quot;SELECT * FROM groups WHERE conversationId = ?&quot;, arrayOf(conversationId)).use { cursor -&gt;
</a><a href="#h1-7-30" id="h1-7-30" class="i">+            if (!cursor.moveToFirst()) return@use null
</a><a href="#h1-7-31" id="h1-7-31" class="i">+            MessagingGroupInfo(
</a><a href="#h1-7-32" id="h1-7-32" class="i">+                conversationId = cursor.getStringOrNull(&quot;conversationId&quot;)!!,
</a><a href="#h1-7-33" id="h1-7-33" class="i">+                name = cursor.getStringOrNull(&quot;name&quot;)!!,
</a><a href="#h1-7-34" id="h1-7-34" class="i">+                participantsCount = cursor.getInteger(&quot;participantsCount&quot;)
</a><a href="#h1-7-35" id="h1-7-35" class="i">+            )
</a><a href="#h1-7-36" id="h1-7-36" class="i">+        }
</a><a href="#h1-7-37" id="h1-7-37" class="i">+    }
</a><a href="#h1-7-38" id="h1-7-38" class="i">+
</a>     fun getFriendStreaks(userId: String): FriendStreaks? {
         return database.rawQuery(&quot;SELECT * FROM streaks WHERE userId = ?&quot;, arrayOf(userId)).use { cursor -&gt;
             if (!cursor.moveToFirst()) return@use null
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Navigation.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Navigation.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Navigation.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Navigation.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,8 +1,12 @@
</a> package me.rhunk.snapenhance.ui.manager
 
<a href="#h2-0-2" id="h2-0-2" class="i">+import androidx.compose.animation.core.animateFloatAsState
</a><a href="#h2-0-3" id="h2-0-3" class="i">+import androidx.compose.foundation.layout.Box
</a> import androidx.compose.foundation.layout.PaddingValues
 import androidx.compose.foundation.layout.fillMaxHeight
<a href="#h2-0-6" id="h2-0-6" class="i">+import androidx.compose.foundation.layout.height
</a> import androidx.compose.foundation.layout.padding
<a href="#h2-0-8" id="h2-0-8" class="i">+import androidx.compose.foundation.layout.width
</a> import androidx.compose.foundation.layout.wrapContentWidth
 import androidx.compose.material.icons.Icons
 import androidx.compose.material.icons.filled.ArrowBack
<a href="#h2-1" id="h2-1" class="h">@@ -16,7 +20,10 @@ import androidx.compose.material3.TopAppBar
</a> import androidx.compose.runtime.Composable
 import androidx.compose.runtime.getValue
 import androidx.compose.ui.Modifier
<a href="#h2-1-3" id="h2-1-3" class="i">+import androidx.compose.ui.graphics.graphicsLayer
</a> import androidx.compose.ui.text.style.TextAlign
<a href="#h2-1-5" id="h2-1-5" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h2-1-6" id="h2-1-6" class="i">+import androidx.compose.ui.unit.lerp
</a> import androidx.compose.ui.unit.sp
 import androidx.navigation.NavDestination
 import androidx.navigation.NavDestination.Companion.hierarchy
<a href="#h2-2" id="h2-2" class="h">@@ -63,8 +70,19 @@ class Navigation(
</a>         TopAppBar(title = {
             Text(text = currentSection.sectionTopBarName())
         }, navigationIcon =  {
<a href="#h2-2-3" id="h2-2-3" class="d">-            if (currentSection.canGoBack()) {
</a><a href="#h2-2-4" id="h2-2-4" class="d">-                IconButton(onClick = { navHostController.popBackStack() }) {
</a><a href="#h2-2-5" id="h2-2-5" class="i">+            val backButtonAnimation by animateFloatAsState(if (currentSection.canGoBack()) 1f else 0f,
</a><a href="#h2-2-6" id="h2-2-6" class="i">+                label = &quot;backButtonAnimation&quot;
</a><a href="#h2-2-7" id="h2-2-7" class="i">+            )
</a><a href="#h2-2-8" id="h2-2-8" class="i">+
</a><a href="#h2-2-9" id="h2-2-9" class="i">+            Box(
</a><a href="#h2-2-10" id="h2-2-10" class="i">+                modifier = Modifier
</a><a href="#h2-2-11" id="h2-2-11" class="i">+                    .graphicsLayer { alpha = backButtonAnimation }
</a><a href="#h2-2-12" id="h2-2-12" class="i">+                    .width(lerp(0.dp, 48.dp, backButtonAnimation))
</a><a href="#h2-2-13" id="h2-2-13" class="i">+                    .height(48.dp)
</a><a href="#h2-2-14" id="h2-2-14" class="i">+            ) {
</a><a href="#h2-2-15" id="h2-2-15" class="i">+                IconButton(
</a><a href="#h2-2-16" id="h2-2-16" class="i">+                    onClick = { navHostController.popBackStack() }
</a><a href="#h2-2-17" id="h2-2-17" class="i">+                ) {
</a>                     Icon(Icons.Filled.ArrowBack, contentDescription = null)
                 }
             }
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -42,7 +42,9 @@ class AddFriendDialog(
</a>     @Composable
     private fun ListCardEntry(name: String, modifier: Modifier = Modifier) {
         Card(
<a href="#h3-0-3" id="h3-0-3" class="d">-            modifier = Modifier.padding(5.dp).then(modifier),
</a><a href="#h3-0-4" id="h3-0-4" class="i">+            modifier = Modifier
</a><a href="#h3-0-5" id="h3-0-5" class="i">+                .padding(5.dp)
</a><a href="#h3-0-6" id="h3-0-6" class="i">+                .then(modifier),
</a>         ) {
             Text(text = name, modifier = Modifier.padding(10.dp))
         }
<a href="#h3-1" id="h3-1" class="h">@@ -86,47 +88,49 @@ class AddFriendDialog(
</a>             timeoutJob?.cancel()
             dismiss()
         }) {
<a href="#h3-1-3" id="h3-1-3" class="d">-            if (hasFetchError) {
</a><a href="#h3-1-4" id="h3-1-4" class="d">-                Text(text = &quot;Failed to load friends and groups. Make sure Snapchat is installed and logged in.&quot;)
</a><a href="#h3-1-5" id="h3-1-5" class="d">-                return@Dialog
</a><a href="#h3-1-6" id="h3-1-6" class="d">-            }
</a><a href="#h3-1-7" id="h3-1-7" class="d">-            if (cachedGroups == null || cachedFriends == null) {
</a><a href="#h3-1-8" id="h3-1-8" class="d">-                CircularProgressIndicator(
</a><a href="#h3-1-9" id="h3-1-9" class="d">-                    modifier = Modifier
</a><a href="#h3-1-10" id="h3-1-10" class="d">-                        .padding()
</a><a href="#h3-1-11" id="h3-1-11" class="d">-                        .size(30.dp),
</a><a href="#h3-1-12" id="h3-1-12" class="d">-                    strokeWidth = 3.dp,
</a><a href="#h3-1-13" id="h3-1-13" class="d">-                    color = MaterialTheme.colorScheme.onPrimary
</a><a href="#h3-1-14" id="h3-1-14" class="d">-                )
</a><a href="#h3-1-15" id="h3-1-15" class="d">-                return@Dialog
</a><a href="#h3-1-16" id="h3-1-16" class="d">-            }
</a><a href="#h3-1-17" id="h3-1-17" class="d">-
</a><a href="#h3-1-18" id="h3-1-18" class="d">-            LazyColumn(
</a><a href="#h3-1-19" id="h3-1-19" class="d">-                modifier = Modifier.fillMaxSize()
</a><a href="#h3-1-20" id="h3-1-20" class="d">-            ) {
</a><a href="#h3-1-21" id="h3-1-21" class="d">-                item {
</a><a href="#h3-1-22" id="h3-1-22" class="d">-                    Text(text = &quot;Groups&quot;, fontSize = 20.sp)
</a><a href="#h3-1-23" id="h3-1-23" class="d">-                    Spacer(modifier = Modifier.padding(5.dp))
</a><a href="#h3-1-24" id="h3-1-24" class="i">+            Card {
</a><a href="#h3-1-25" id="h3-1-25" class="i">+                if (hasFetchError) {
</a><a href="#h3-1-26" id="h3-1-26" class="i">+                    Text(text = &quot;Failed to load friends and groups. Make sure Snapchat is installed and logged in.&quot;)
</a><a href="#h3-1-27" id="h3-1-27" class="i">+                    return@Card
</a>                 }
<a href="#h3-1-29" id="h3-1-29" class="d">-                items(cachedGroups!!.size) {
</a><a href="#h3-1-30" id="h3-1-30" class="d">-                    ListCardEntry(name = cachedGroups!![it].name, modifier = Modifier.clickable {
</a><a href="#h3-1-31" id="h3-1-31" class="d">-                        context.bridgeService.triggerGroupSync(cachedGroups!![it].conversationId)
</a><a href="#h3-1-32" id="h3-1-32" class="d">-                        context.modDatabase.executeAsync {
</a><a href="#h3-1-33" id="h3-1-33" class="d">-                            section.onResumed()
</a><a href="#h3-1-34" id="h3-1-34" class="d">-                        }
</a><a href="#h3-1-35" id="h3-1-35" class="d">-                    })
</a><a href="#h3-1-36" id="h3-1-36" class="i">+                if (cachedGroups == null || cachedFriends == null) {
</a><a href="#h3-1-37" id="h3-1-37" class="i">+                    CircularProgressIndicator(
</a><a href="#h3-1-38" id="h3-1-38" class="i">+                        modifier = Modifier
</a><a href="#h3-1-39" id="h3-1-39" class="i">+                            .padding()
</a><a href="#h3-1-40" id="h3-1-40" class="i">+                            .size(30.dp),
</a><a href="#h3-1-41" id="h3-1-41" class="i">+                        strokeWidth = 3.dp,
</a><a href="#h3-1-42" id="h3-1-42" class="i">+                        color = MaterialTheme.colorScheme.onPrimary
</a><a href="#h3-1-43" id="h3-1-43" class="i">+                    )
</a><a href="#h3-1-44" id="h3-1-44" class="i">+                    return@Card
</a>                 }
<a href="#h3-1-46" id="h3-1-46" class="d">-                item {
</a><a href="#h3-1-47" id="h3-1-47" class="d">-                    Text(text = &quot;Friends&quot;, fontSize = 20.sp)
</a><a href="#h3-1-48" id="h3-1-48" class="d">-                    Spacer(modifier = Modifier.padding(5.dp))
</a><a href="#h3-1-49" id="h3-1-49" class="d">-                }
</a><a href="#h3-1-50" id="h3-1-50" class="d">-                items(cachedFriends!!.size) {
</a><a href="#h3-1-51" id="h3-1-51" class="d">-                    ListCardEntry(name = cachedFriends!![it].displayName ?: cachedFriends!![it].mutableUsername, modifier = Modifier.clickable {
</a><a href="#h3-1-52" id="h3-1-52" class="d">-                        context.bridgeService.triggerFriendSync(cachedFriends!![it].userId)
</a><a href="#h3-1-53" id="h3-1-53" class="d">-                        context.modDatabase.executeAsync {
</a><a href="#h3-1-54" id="h3-1-54" class="d">-                            section.onResumed()
</a><a href="#h3-1-55" id="h3-1-55" class="d">-                        }
</a><a href="#h3-1-56" id="h3-1-56" class="d">-                    })
</a><a href="#h3-1-57" id="h3-1-57" class="i">+
</a><a href="#h3-1-58" id="h3-1-58" class="i">+                LazyColumn(
</a><a href="#h3-1-59" id="h3-1-59" class="i">+                    modifier = Modifier.fillMaxSize()
</a><a href="#h3-1-60" id="h3-1-60" class="i">+                ) {
</a><a href="#h3-1-61" id="h3-1-61" class="i">+                    item {
</a><a href="#h3-1-62" id="h3-1-62" class="i">+                        Text(text = &quot;Groups&quot;, fontSize = 20.sp)
</a><a href="#h3-1-63" id="h3-1-63" class="i">+                        Spacer(modifier = Modifier.padding(5.dp))
</a><a href="#h3-1-64" id="h3-1-64" class="i">+                    }
</a><a href="#h3-1-65" id="h3-1-65" class="i">+                    items(cachedGroups!!.size) {
</a><a href="#h3-1-66" id="h3-1-66" class="i">+                        ListCardEntry(name = cachedGroups!![it].name, modifier = Modifier.clickable {
</a><a href="#h3-1-67" id="h3-1-67" class="i">+                            context.bridgeService.triggerGroupSync(cachedGroups!![it].conversationId)
</a><a href="#h3-1-68" id="h3-1-68" class="i">+                            context.modDatabase.executeAsync {
</a><a href="#h3-1-69" id="h3-1-69" class="i">+                                section.onResumed()
</a><a href="#h3-1-70" id="h3-1-70" class="i">+                            }
</a><a href="#h3-1-71" id="h3-1-71" class="i">+                        })
</a><a href="#h3-1-72" id="h3-1-72" class="i">+                    }
</a><a href="#h3-1-73" id="h3-1-73" class="i">+                    item {
</a><a href="#h3-1-74" id="h3-1-74" class="i">+                        Text(text = &quot;Friends&quot;, fontSize = 20.sp)
</a><a href="#h3-1-75" id="h3-1-75" class="i">+                        Spacer(modifier = Modifier.padding(5.dp))
</a><a href="#h3-1-76" id="h3-1-76" class="i">+                    }
</a><a href="#h3-1-77" id="h3-1-77" class="i">+                    items(cachedFriends!!.size) {
</a><a href="#h3-1-78" id="h3-1-78" class="i">+                        ListCardEntry(name = cachedFriends!![it].displayName ?: cachedFriends!![it].mutableUsername, modifier = Modifier.clickable {
</a><a href="#h3-1-79" id="h3-1-79" class="i">+                            context.bridgeService.triggerFriendSync(cachedFriends!![it].userId)
</a><a href="#h3-1-80" id="h3-1-80" class="i">+                            context.modDatabase.executeAsync {
</a><a href="#h3-1-81" id="h3-1-81" class="i">+                                section.onResumed()
</a><a href="#h3-1-82" id="h3-1-82" class="i">+                            }
</a><a href="#h3-1-83" id="h3-1-83" class="i">+                        })
</a><a href="#h3-1-84" id="h3-1-84" class="i">+                    }
</a>                 }
             }
         }
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,4 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.sections.social
</a><a href="#h4-0-1" id="h4-0-1" class="d">-
</a><a href="#h4-0-2" id="h4-0-2" class="d">-class FriendTab {
</a><a href="#h4-0-3" id="h4-0-3" class="d">-}</a><a href="#h4-0-4" id="h4-0-4" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeTab.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeTab.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeTab.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeTab.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,72 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.sections.social
</a><a href="#h5-0-1" id="h5-0-1" class="i">+
</a><a href="#h5-0-2" id="h5-0-2" class="i">+import androidx.compose.foundation.layout.Column
</a><a href="#h5-0-3" id="h5-0-3" class="i">+import androidx.compose.foundation.layout.Spacer
</a><a href="#h5-0-4" id="h5-0-4" class="i">+import androidx.compose.foundation.layout.height
</a><a href="#h5-0-5" id="h5-0-5" class="i">+import androidx.compose.material3.OutlinedButton
</a><a href="#h5-0-6" id="h5-0-6" class="i">+import androidx.compose.material3.Text
</a><a href="#h5-0-7" id="h5-0-7" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h5-0-8" id="h5-0-8" class="i">+import androidx.compose.runtime.remember
</a><a href="#h5-0-9" id="h5-0-9" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h5-0-10" id="h5-0-10" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h5-0-11" id="h5-0-11" class="i">+import androidx.navigation.NavController
</a><a href="#h5-0-12" id="h5-0-12" class="i">+import me.rhunk.snapenhance.RemoteSideContext
</a><a href="#h5-0-13" id="h5-0-13" class="i">+
</a><a href="#h5-0-14" id="h5-0-14" class="i">+class ScopeTab(
</a><a href="#h5-0-15" id="h5-0-15" class="i">+    private val context: RemoteSideContext,
</a><a href="#h5-0-16" id="h5-0-16" class="i">+    private val section: SocialSection,
</a><a href="#h5-0-17" id="h5-0-17" class="i">+    private val navController: NavController,
</a><a href="#h5-0-18" id="h5-0-18" class="i">+    private val id: String
</a><a href="#h5-0-19" id="h5-0-19" class="i">+) {
</a><a href="#h5-0-20" id="h5-0-20" class="i">+    @Composable
</a><a href="#h5-0-21" id="h5-0-21" class="i">+    fun Friend() {
</a><a href="#h5-0-22" id="h5-0-22" class="i">+        //fetch the friend from the database
</a><a href="#h5-0-23" id="h5-0-23" class="i">+        val friend = remember { context.modDatabase.getFriendInfo(id) } ?: run {
</a><a href="#h5-0-24" id="h5-0-24" class="i">+            Text(text = &quot;Friend not found&quot;)
</a><a href="#h5-0-25" id="h5-0-25" class="i">+            return
</a><a href="#h5-0-26" id="h5-0-26" class="i">+        }
</a><a href="#h5-0-27" id="h5-0-27" class="i">+        Column {
</a><a href="#h5-0-28" id="h5-0-28" class="i">+            Text(text = friend.displayName ?: &quot;No display name&quot;, maxLines = 1)
</a><a href="#h5-0-29" id="h5-0-29" class="i">+            Text(text = &quot;bitmojiId: ${friend.bitmojiId ?: &quot;No bitmojiId&quot;}&quot;, maxLines = 1)
</a><a href="#h5-0-30" id="h5-0-30" class="i">+            Text(text = &quot;selfieId: ${friend.selfieId ?: &quot;No selfieId&quot;}&quot;, maxLines = 1)
</a><a href="#h5-0-31" id="h5-0-31" class="i">+
</a><a href="#h5-0-32" id="h5-0-32" class="i">+            Spacer(modifier = Modifier.height(16.dp))
</a><a href="#h5-0-33" id="h5-0-33" class="i">+
</a><a href="#h5-0-34" id="h5-0-34" class="i">+            OutlinedButton(onClick = {
</a><a href="#h5-0-35" id="h5-0-35" class="i">+                context.modDatabase.deleteFriend(id)
</a><a href="#h5-0-36" id="h5-0-36" class="i">+                section.onResumed()
</a><a href="#h5-0-37" id="h5-0-37" class="i">+                navController.popBackStack()
</a><a href="#h5-0-38" id="h5-0-38" class="i">+            }) {
</a><a href="#h5-0-39" id="h5-0-39" class="i">+                Text(text = &quot;Delete friend&quot;)
</a><a href="#h5-0-40" id="h5-0-40" class="i">+            }
</a><a href="#h5-0-41" id="h5-0-41" class="i">+        }
</a><a href="#h5-0-42" id="h5-0-42" class="i">+
</a><a href="#h5-0-43" id="h5-0-43" class="i">+    }
</a><a href="#h5-0-44" id="h5-0-44" class="i">+
</a><a href="#h5-0-45" id="h5-0-45" class="i">+
</a><a href="#h5-0-46" id="h5-0-46" class="i">+    @Composable
</a><a href="#h5-0-47" id="h5-0-47" class="i">+    fun Group() {
</a><a href="#h5-0-48" id="h5-0-48" class="i">+        //fetch the group from the database
</a><a href="#h5-0-49" id="h5-0-49" class="i">+        val group = remember { context.modDatabase.getGroupInfo(id) } ?: run {
</a><a href="#h5-0-50" id="h5-0-50" class="i">+            Text(text = &quot;Group not found&quot;)
</a><a href="#h5-0-51" id="h5-0-51" class="i">+            return
</a><a href="#h5-0-52" id="h5-0-52" class="i">+        }
</a><a href="#h5-0-53" id="h5-0-53" class="i">+
</a><a href="#h5-0-54" id="h5-0-54" class="i">+        Column {
</a><a href="#h5-0-55" id="h5-0-55" class="i">+            Text(text = group.name, maxLines = 1)
</a><a href="#h5-0-56" id="h5-0-56" class="i">+            Text(text = &quot;participantsCount: ${group.participantsCount}&quot;, maxLines = 1)
</a><a href="#h5-0-57" id="h5-0-57" class="i">+
</a><a href="#h5-0-58" id="h5-0-58" class="i">+            Spacer(modifier = Modifier.height(16.dp))
</a><a href="#h5-0-59" id="h5-0-59" class="i">+
</a><a href="#h5-0-60" id="h5-0-60" class="i">+
</a><a href="#h5-0-61" id="h5-0-61" class="i">+            OutlinedButton(onClick = {
</a><a href="#h5-0-62" id="h5-0-62" class="i">+                context.modDatabase.deleteGroup(id)
</a><a href="#h5-0-63" id="h5-0-63" class="i">+                section.onResumed()
</a><a href="#h5-0-64" id="h5-0-64" class="i">+                navController.popBackStack()
</a><a href="#h5-0-65" id="h5-0-65" class="i">+            }) {
</a><a href="#h5-0-66" id="h5-0-66" class="i">+                Text(text = &quot;Delete group&quot;)
</a><a href="#h5-0-67" id="h5-0-67" class="i">+            }
</a><a href="#h5-0-68" id="h5-0-68" class="i">+        }
</a><a href="#h5-0-69" id="h5-0-69" class="i">+
</a><a href="#h5-0-70" id="h5-0-70" class="i">+    }
</a><a href="#h5-0-71" id="h5-0-71" class="i">+}</a><a href="#h5-0-72" id="h5-0-72" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,14 +1,22 @@
</a> package me.rhunk.snapenhance.ui.manager.sections.social
 
 import androidx.compose.foundation.ExperimentalFoundationApi
<a href="#h6-0-3" id="h6-0-3" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h6-0-4" id="h6-0-4" class="i">+import androidx.compose.foundation.gestures.Orientation
</a><a href="#h6-0-5" id="h6-0-5" class="i">+import androidx.compose.foundation.gestures.scrollable
</a> import androidx.compose.foundation.layout.Column
 import androidx.compose.foundation.layout.fillMaxSize
<a href="#h6-0-8" id="h6-0-8" class="i">+import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h6-0-9" id="h6-0-9" class="i">+import androidx.compose.foundation.layout.height
</a> import androidx.compose.foundation.layout.padding
<a href="#h6-0-11" id="h6-0-11" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a> import androidx.compose.foundation.pager.HorizontalPager
 import androidx.compose.foundation.pager.rememberPagerState
<a href="#h6-0-14" id="h6-0-14" class="i">+import androidx.compose.foundation.rememberScrollState
</a> import androidx.compose.foundation.shape.RoundedCornerShape
 import androidx.compose.material.icons.Icons
 import androidx.compose.material.icons.rounded.Add
<a href="#h6-0-18" id="h6-0-18" class="i">+import androidx.compose.material3.Card
</a> import androidx.compose.material3.FloatingActionButton
 import androidx.compose.material3.Icon
 import androidx.compose.material3.MaterialTheme
<a href="#h6-1" id="h6-1" class="h">@@ -18,6 +26,7 @@ import androidx.compose.material3.TabRow
</a> import androidx.compose.material3.TabRowDefaults
 import androidx.compose.material3.Text
 import androidx.compose.runtime.Composable
<a href="#h6-1-3" id="h6-1-3" class="i">+import androidx.compose.runtime.LaunchedEffect
</a> import androidx.compose.runtime.getValue
 import androidx.compose.runtime.mutableStateOf
 import androidx.compose.runtime.remember
<a href="#h6-2" id="h6-2" class="h">@@ -26,6 +35,9 @@ import androidx.compose.runtime.setValue
</a> import androidx.compose.ui.Modifier
 import androidx.compose.ui.text.style.TextOverflow
 import androidx.compose.ui.unit.dp
<a href="#h6-2-3" id="h6-2-3" class="i">+import androidx.navigation.NavGraphBuilder
</a><a href="#h6-2-4" id="h6-2-4" class="i">+import androidx.navigation.compose.composable
</a><a href="#h6-2-5" id="h6-2-5" class="i">+import androidx.navigation.navigation
</a> import kotlinx.coroutines.launch
 import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
 import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
<a href="#h6-3" id="h6-3" class="h">@@ -36,15 +48,48 @@ class SocialSection : Section() {
</a>     private lateinit var friendList: List&lt;MessagingFriendInfo&gt;
     private lateinit var groupList: List&lt;MessagingGroupInfo&gt;
 
<a href="#h6-3-3" id="h6-3-3" class="i">+    companion object {
</a><a href="#h6-3-4" id="h6-3-4" class="i">+        const val MAIN_ROUTE = &quot;social_route&quot;
</a><a href="#h6-3-5" id="h6-3-5" class="i">+        const val FRIEND_INFO_ROUTE = &quot;friend_info/{id}&quot;
</a><a href="#h6-3-6" id="h6-3-6" class="i">+        const val GROUP_INFO_ROUTE = &quot;group_info/{id}&quot;
</a><a href="#h6-3-7" id="h6-3-7" class="i">+    }
</a><a href="#h6-3-8" id="h6-3-8" class="i">+
</a><a href="#h6-3-9" id="h6-3-9" class="i">+    private var currentScopeTab: ScopeTab? = null
</a><a href="#h6-3-10" id="h6-3-10" class="i">+
</a>     private val addFriendDialog by lazy {
         AddFriendDialog(context, this)
     }
 
<a href="#h6-3-15" id="h6-3-15" class="i">+    //FIXME: don&#39;t reload the entire list when a friend is added/deleted
</a>     override fun onResumed() {
<a href="#h6-3-17" id="h6-3-17" class="d">-        friendList = context.modDatabase.getFriends()
</a><a href="#h6-3-18" id="h6-3-18" class="i">+        friendList = context.modDatabase.getFriends(descOrder = true)
</a>         groupList = context.modDatabase.getGroups()
     }
 
<a href="#h6-3-22" id="h6-3-22" class="i">+    override fun canGoBack() = navController.currentBackStackEntry?.destination?.route != MAIN_ROUTE
</a><a href="#h6-3-23" id="h6-3-23" class="i">+
</a><a href="#h6-3-24" id="h6-3-24" class="i">+    override fun build(navGraphBuilder: NavGraphBuilder) {
</a><a href="#h6-3-25" id="h6-3-25" class="i">+        fun switchTab(id: String) = ScopeTab(context, this, navController, id).also { tab -&gt;
</a><a href="#h6-3-26" id="h6-3-26" class="i">+            currentScopeTab = tab
</a><a href="#h6-3-27" id="h6-3-27" class="i">+        }
</a><a href="#h6-3-28" id="h6-3-28" class="i">+
</a><a href="#h6-3-29" id="h6-3-29" class="i">+        navGraphBuilder.navigation(route = enumSection.route, startDestination = MAIN_ROUTE) {
</a><a href="#h6-3-30" id="h6-3-30" class="i">+            composable(MAIN_ROUTE) {
</a><a href="#h6-3-31" id="h6-3-31" class="i">+                Content()
</a><a href="#h6-3-32" id="h6-3-32" class="i">+            }
</a><a href="#h6-3-33" id="h6-3-33" class="i">+
</a><a href="#h6-3-34" id="h6-3-34" class="i">+            composable(FRIEND_INFO_ROUTE) {
</a><a href="#h6-3-35" id="h6-3-35" class="i">+                val id = it.arguments?.getString(&quot;id&quot;) ?: return@composable
</a><a href="#h6-3-36" id="h6-3-36" class="i">+                remember { switchTab(id) }.Friend()
</a><a href="#h6-3-37" id="h6-3-37" class="i">+            }
</a><a href="#h6-3-38" id="h6-3-38" class="i">+
</a><a href="#h6-3-39" id="h6-3-39" class="i">+            composable(GROUP_INFO_ROUTE) {
</a><a href="#h6-3-40" id="h6-3-40" class="i">+                val id = it.arguments?.getString(&quot;id&quot;) ?: return@composable
</a><a href="#h6-3-41" id="h6-3-41" class="i">+                remember { switchTab(id) }.Group()
</a><a href="#h6-3-42" id="h6-3-42" class="i">+            }
</a><a href="#h6-3-43" id="h6-3-43" class="i">+        }
</a><a href="#h6-3-44" id="h6-3-44" class="i">+    }
</a><a href="#h6-3-45" id="h6-3-45" class="i">+
</a> 
     @OptIn(ExperimentalFoundationApi::class)
     @Composable
<a href="#h6-4" id="h6-4" class="h">@@ -100,23 +145,55 @@ class SocialSection : Section() {
</a>                     }
                 }
 
<a href="#h6-4-3" id="h6-4-3" class="i">+
</a>                 HorizontalPager(modifier = Modifier.padding(paddingValues), state = pagerState) { page -&gt;
<a href="#h6-4-5" id="h6-4-5" class="d">-                    Column(
</a><a href="#h6-4-6" id="h6-4-6" class="d">-                        modifier = Modifier.fillMaxSize(),
</a><a href="#h6-4-7" id="h6-4-7" class="d">-                    ) {
</a><a href="#h6-4-8" id="h6-4-8" class="d">-                        when (page) {
</a><a href="#h6-4-9" id="h6-4-9" class="d">-                            0 -&gt; {
</a><a href="#h6-4-10" id="h6-4-10" class="d">-                                Text(text = &quot;Friends&quot;)
</a><a href="#h6-4-11" id="h6-4-11" class="d">-                                Column {
</a><a href="#h6-4-12" id="h6-4-12" class="d">-                                    friendList.forEach {
</a><a href="#h6-4-13" id="h6-4-13" class="d">-                                        Text(text = it.displayName ?: it.mutableUsername)
</a><a href="#h6-4-14" id="h6-4-14" class="i">+                    when (page) {
</a><a href="#h6-4-15" id="h6-4-15" class="i">+                        0 -&gt; {
</a><a href="#h6-4-16" id="h6-4-16" class="i">+                            LazyColumn(
</a><a href="#h6-4-17" id="h6-4-17" class="i">+                                modifier = Modifier
</a><a href="#h6-4-18" id="h6-4-18" class="i">+                                    .padding(10.dp)
</a><a href="#h6-4-19" id="h6-4-19" class="i">+                                    .fillMaxWidth()
</a><a href="#h6-4-20" id="h6-4-20" class="i">+                            ) {
</a><a href="#h6-4-21" id="h6-4-21" class="i">+                                if (friendList.isEmpty()) {
</a><a href="#h6-4-22" id="h6-4-22" class="i">+                                    item {
</a><a href="#h6-4-23" id="h6-4-23" class="i">+                                        Text(text = &quot;No friends found&quot;)
</a><a href="#h6-4-24" id="h6-4-24" class="i">+                                    }
</a><a href="#h6-4-25" id="h6-4-25" class="i">+                                }
</a><a href="#h6-4-26" id="h6-4-26" class="i">+                                items(friendList.size) { index -&gt;
</a><a href="#h6-4-27" id="h6-4-27" class="i">+                                    val friend = friendList[index]
</a><a href="#h6-4-28" id="h6-4-28" class="i">+                                    Card(
</a><a href="#h6-4-29" id="h6-4-29" class="i">+                                        modifier = Modifier
</a><a href="#h6-4-30" id="h6-4-30" class="i">+                                            .padding(10.dp)
</a><a href="#h6-4-31" id="h6-4-31" class="i">+                                            .fillMaxWidth()
</a><a href="#h6-4-32" id="h6-4-32" class="i">+                                            .height(100.dp)
</a><a href="#h6-4-33" id="h6-4-33" class="i">+                                            .clickable {
</a><a href="#h6-4-34" id="h6-4-34" class="i">+                                                navController.navigate(
</a><a href="#h6-4-35" id="h6-4-35" class="i">+                                                    FRIEND_INFO_ROUTE.replace(
</a><a href="#h6-4-36" id="h6-4-36" class="i">+                                                        &quot;{id}&quot;,
</a><a href="#h6-4-37" id="h6-4-37" class="i">+                                                        friend.userId
</a><a href="#h6-4-38" id="h6-4-38" class="i">+                                                    )
</a><a href="#h6-4-39" id="h6-4-39" class="i">+                                                )
</a><a href="#h6-4-40" id="h6-4-40" class="i">+                                            },
</a><a href="#h6-4-41" id="h6-4-41" class="i">+                                    ) {
</a><a href="#h6-4-42" id="h6-4-42" class="i">+                                        Text(text = friend.displayName ?: friend.mutableUsername)
</a>                                     }
                                 }
                             }
<a href="#h6-4-46" id="h6-4-46" class="d">-                            1 -&gt; {
</a><a href="#h6-4-47" id="h6-4-47" class="d">-                                Text(text = &quot;Groups&quot;)
</a><a href="#h6-4-48" id="h6-4-48" class="d">-                                Column {
</a><a href="#h6-4-49" id="h6-4-49" class="d">-                                    groupList.forEach {
</a><a href="#h6-4-50" id="h6-4-50" class="i">+                        }
</a><a href="#h6-4-51" id="h6-4-51" class="i">+                        1 -&gt; {
</a><a href="#h6-4-52" id="h6-4-52" class="i">+                            Column(
</a><a href="#h6-4-53" id="h6-4-53" class="i">+                                modifier = Modifier
</a><a href="#h6-4-54" id="h6-4-54" class="i">+                                    .padding(10.dp)
</a><a href="#h6-4-55" id="h6-4-55" class="i">+                                    .fillMaxSize()
</a><a href="#h6-4-56" id="h6-4-56" class="i">+                                    .scrollable(rememberScrollState(), Orientation.Vertical)
</a><a href="#h6-4-57" id="h6-4-57" class="i">+                            ) {
</a><a href="#h6-4-58" id="h6-4-58" class="i">+                                groupList.forEach {
</a><a href="#h6-4-59" id="h6-4-59" class="i">+                                    Card(
</a><a href="#h6-4-60" id="h6-4-60" class="i">+                                        modifier = Modifier
</a><a href="#h6-4-61" id="h6-4-61" class="i">+                                            .padding(10.dp)
</a><a href="#h6-4-62" id="h6-4-62" class="i">+                                            .fillMaxWidth()
</a><a href="#h6-4-63" id="h6-4-63" class="i">+                                            .height(100.dp),
</a><a href="#h6-4-64" id="h6-4-64" class="i">+                                    ) {
</a>                                         Text(text = it.name)
                                     }
                                 }
<b>diff --git a/<a id="h7" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -130,49 +130,51 @@ class SnapEnhance {
</a>     private fun syncRemote() {
         val database = appContext.database
 
<a href="#h7-0-3" id="h7-0-3" class="d">-        appContext.bridgeClient.sync(object : SyncCallback.Stub() {
</a><a href="#h7-0-4" id="h7-0-4" class="d">-            override fun syncFriend(uuid: String): String? {
</a><a href="#h7-0-5" id="h7-0-5" class="d">-                return database.getFriendInfo(uuid)?.toJson()
</a><a href="#h7-0-6" id="h7-0-6" class="d">-            }
</a><a href="#h7-0-7" id="h7-0-7" class="i">+        appContext.executeAsync {
</a><a href="#h7-0-8" id="h7-0-8" class="i">+            appContext.bridgeClient.sync(object : SyncCallback.Stub() {
</a><a href="#h7-0-9" id="h7-0-9" class="i">+                override fun syncFriend(uuid: String): String? {
</a><a href="#h7-0-10" id="h7-0-10" class="i">+                    return database.getFriendInfo(uuid)?.toJson()
</a><a href="#h7-0-11" id="h7-0-11" class="i">+                }
</a><a href="#h7-0-12" id="h7-0-12" class="i">+
</a><a href="#h7-0-13" id="h7-0-13" class="i">+                override fun syncGroup(uuid: String): String? {
</a><a href="#h7-0-14" id="h7-0-14" class="i">+                    return database.getFeedEntryByConversationId(uuid)?.let {
</a><a href="#h7-0-15" id="h7-0-15" class="i">+                        MessagingGroupInfo(
</a><a href="#h7-0-16" id="h7-0-16" class="i">+                            it.key!!,
</a><a href="#h7-0-17" id="h7-0-17" class="i">+                            it.feedDisplayName!!,
</a><a href="#h7-0-18" id="h7-0-18" class="i">+                            it.participantsSize
</a><a href="#h7-0-19" id="h7-0-19" class="i">+                        ).toJson()
</a><a href="#h7-0-20" id="h7-0-20" class="i">+                    }
</a><a href="#h7-0-21" id="h7-0-21" class="i">+                }
</a><a href="#h7-0-22" id="h7-0-22" class="i">+            })
</a><a href="#h7-0-23" id="h7-0-23" class="i">+
</a><a href="#h7-0-24" id="h7-0-24" class="i">+            appContext.event.subscribe(SnapWidgetBroadcastReceiveEvent::class) { event -&gt;
</a><a href="#h7-0-25" id="h7-0-25" class="i">+                if (event.action != BridgeClient.BRIDGE_SYNC_ACTION) return@subscribe
</a><a href="#h7-0-26" id="h7-0-26" class="i">+                event.canceled = true
</a><a href="#h7-0-27" id="h7-0-27" class="i">+                val feedEntries = appContext.database.getFeedEntries(Int.MAX_VALUE)
</a> 
<a href="#h7-0-29" id="h7-0-29" class="d">-            override fun syncGroup(uuid: String): String? {
</a><a href="#h7-0-30" id="h7-0-30" class="d">-                return database.getFeedEntryByConversationId(uuid)?.let {
</a><a href="#h7-0-31" id="h7-0-31" class="i">+                val groups = feedEntries.filter { it.friendUserId == null }.map {
</a>                     MessagingGroupInfo(
                         it.key!!,
                         it.feedDisplayName!!,
                         it.participantsSize
<a href="#h7-0-36" id="h7-0-36" class="d">-                    ).toJson()
</a><a href="#h7-0-37" id="h7-0-37" class="i">+                    )
</a>                 }
<a href="#h7-0-39" id="h7-0-39" class="d">-            }
</a><a href="#h7-0-40" id="h7-0-40" class="d">-        })
</a><a href="#h7-0-41" id="h7-0-41" class="d">-
</a><a href="#h7-0-42" id="h7-0-42" class="d">-        appContext.event.subscribe(SnapWidgetBroadcastReceiveEvent::class) { event -&gt;
</a><a href="#h7-0-43" id="h7-0-43" class="d">-            if (event.action != BridgeClient.BRIDGE_SYNC_ACTION) return@subscribe
</a><a href="#h7-0-44" id="h7-0-44" class="d">-            event.canceled = true
</a><a href="#h7-0-45" id="h7-0-45" class="d">-            val feedEntries = appContext.database.getFeedEntries(Int.MAX_VALUE)
</a><a href="#h7-0-46" id="h7-0-46" class="d">-
</a><a href="#h7-0-47" id="h7-0-47" class="d">-            val groups = feedEntries.filter { it.friendUserId == null }.map {
</a><a href="#h7-0-48" id="h7-0-48" class="d">-                MessagingGroupInfo(
</a><a href="#h7-0-49" id="h7-0-49" class="d">-                    it.key!!,
</a><a href="#h7-0-50" id="h7-0-50" class="d">-                    it.feedDisplayName!!,
</a><a href="#h7-0-51" id="h7-0-51" class="d">-                    it.participantsSize
</a><a href="#h7-0-52" id="h7-0-52" class="d">-                )
</a><a href="#h7-0-53" id="h7-0-53" class="d">-            }
</a> 
<a href="#h7-0-55" id="h7-0-55" class="d">-            val friends = feedEntries.filter { it.friendUserId != null }.map {
</a><a href="#h7-0-56" id="h7-0-56" class="d">-                MessagingFriendInfo(
</a><a href="#h7-0-57" id="h7-0-57" class="d">-                    it.friendUserId!!,
</a><a href="#h7-0-58" id="h7-0-58" class="d">-                    it.friendDisplayName,
</a><a href="#h7-0-59" id="h7-0-59" class="d">-                    it.friendDisplayUsername!!.split(&quot;|&quot;)[1],
</a><a href="#h7-0-60" id="h7-0-60" class="d">-                    it.bitmojiAvatarId,
</a><a href="#h7-0-61" id="h7-0-61" class="d">-                    it.bitmojiSelfieId
</a><a href="#h7-0-62" id="h7-0-62" class="i">+                val friends = feedEntries.filter { it.friendUserId != null }.map {
</a><a href="#h7-0-63" id="h7-0-63" class="i">+                    MessagingFriendInfo(
</a><a href="#h7-0-64" id="h7-0-64" class="i">+                        it.friendUserId!!,
</a><a href="#h7-0-65" id="h7-0-65" class="i">+                        it.friendDisplayName,
</a><a href="#h7-0-66" id="h7-0-66" class="i">+                        it.friendDisplayUsername!!.split(&quot;|&quot;)[1],
</a><a href="#h7-0-67" id="h7-0-67" class="i">+                        it.bitmojiAvatarId,
</a><a href="#h7-0-68" id="h7-0-68" class="i">+                        it.bitmojiSelfieId
</a><a href="#h7-0-69" id="h7-0-69" class="i">+                    )
</a><a href="#h7-0-70" id="h7-0-70" class="i">+                }
</a><a href="#h7-0-71" id="h7-0-71" class="i">+
</a><a href="#h7-0-72" id="h7-0-72" class="i">+                appContext.bridgeClient.passGroupsAndFriends(
</a><a href="#h7-0-73" id="h7-0-73" class="i">+                    groups.map { it.toJson() },
</a><a href="#h7-0-74" id="h7-0-74" class="i">+                    friends.map { it.toJson() }
</a>                 )
             }
<a href="#h7-0-77" id="h7-0-77" class="d">-
</a><a href="#h7-0-78" id="h7-0-78" class="d">-            appContext.bridgeClient.passGroupsAndFriends(
</a><a href="#h7-0-79" id="h7-0-79" class="d">-                groups.map { it.toJson() },
</a><a href="#h7-0-80" id="h7-0-80" class="d">-                friends.map { it.toJson() }
</a><a href="#h7-0-81" id="h7-0-81" class="d">-            )
</a>         }
     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h8" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -16,7 +16,7 @@ import me.rhunk.snapenhance.bridge.types.BridgeFileType
</a> import me.rhunk.snapenhance.bridge.types.FileActionType
 import me.rhunk.snapenhance.core.BuildConfig
 import me.rhunk.snapenhance.core.messaging.MessagingRule
<a href="#h8-0-3" id="h8-0-3" class="d">-import me.rhunk.snapenhance.core.messaging.RuleScope
</a><a href="#h8-0-4" id="h8-0-4" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingScope
</a> import me.rhunk.snapenhance.data.LocalePair
 import me.rhunk.snapenhance.util.SerializableDataObject
 import java.util.concurrent.CompletableFuture
<a href="#h8-1" id="h8-1" class="h">@@ -136,7 +136,7 @@ class BridgeClient(
</a> 
     fun passGroupsAndFriends(groups: List&lt;String&gt;, friends: List&lt;String&gt;) = service.passGroupsAndFriends(groups, friends)
 
<a href="#h8-1-3" id="h8-1-3" class="d">-    fun getRulesFromId(type: RuleScope, targetUuid: String): List&lt;MessagingRule&gt; {
</a><a href="#h8-1-4" id="h8-1-4" class="i">+    fun getRulesFromId(type: MessagingScope, targetUuid: String): List&lt;MessagingRule&gt; {
</a>         return service.getRules(type.name, targetUuid).map {
             SerializableDataObject.fromJson(it, MessagingRule::class.java)
         }.toList()
<b>diff --git a/<a id="h9" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -8,18 +8,18 @@ enum class Mode {
</a>     WHITELIST
 }
 
<a href="#h9-0-3" id="h9-0-3" class="d">-enum class RuleScope {
</a><a href="#h9-0-4" id="h9-0-4" class="i">+enum class MessagingScope {
</a>     FRIEND,
     GROUP
 }
 
 enum class ConversationFeature(
     val value: String,
<a href="#h9-0-11" id="h9-0-11" class="d">-    val ruleScope: RuleScope,
</a><a href="#h9-0-12" id="h9-0-12" class="i">+    val messagingScope: MessagingScope,
</a> ) {
<a href="#h9-0-14" id="h9-0-14" class="d">-    DOWNLOAD(&quot;download&quot;, RuleScope.FRIEND),
</a><a href="#h9-0-15" id="h9-0-15" class="d">-    STEALTH(&quot;stealth&quot;, RuleScope.GROUP),
</a><a href="#h9-0-16" id="h9-0-16" class="d">-    AUTO_SAVE(&quot;auto_save&quot;, RuleScope.GROUP);
</a><a href="#h9-0-17" id="h9-0-17" class="i">+    DOWNLOAD(&quot;download&quot;, MessagingScope.FRIEND),
</a><a href="#h9-0-18" id="h9-0-18" class="i">+    STEALTH(&quot;stealth&quot;, MessagingScope.GROUP),
</a><a href="#h9-0-19" id="h9-0-19" class="i">+    AUTO_SAVE(&quot;auto_save&quot;, MessagingScope.GROUP);
</a> }
 
 data class FriendStreaks(
<a href="#h9-1" id="h9-1" class="h">@@ -47,7 +47,7 @@ data class MessagingFriendInfo(
</a> 
 data class MessagingRule(
     val id: Int,
<a href="#h9-1-3" id="h9-1-3" class="d">-    val ruleScope: RuleScope,
</a><a href="#h9-1-4" id="h9-1-4" class="i">+    val messagingScope: MessagingScope,
</a>     val targetUuid: String,
     val enabled: Boolean,
     val mode: Mode?,
</pre>
</div>
</body>
</html>
