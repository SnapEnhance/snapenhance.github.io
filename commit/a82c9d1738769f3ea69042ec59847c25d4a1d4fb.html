<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: patch manager - LSPatch v0.5.1-390 - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/a82c9d1738769f3ea69042ec59847c25d4a1d4fb.html">a82c9d1738769f3ea69042ec59847c25d4a1d4fb</a>
<b>parent</b> <a href="../commit/5ac93fee3d332ebb82792968c9a6e96bc8c36f5f.html">5ac93fee3d332ebb82792968c9a6e96bc8c36f5f</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sat, 21 Oct 2023 21:44:47 +0200

feat: patch manager
- LSPatch v0.5.1-390

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">gradle/libs.versions.toml</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h1">manager/.gitignore</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">manager/build.gradle.kts</a></td><td> | </td><td class="num">84</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">manager/libs/ManifestEditor-1.0.2.jar</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">manager/libs/apkzlib.jar</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">manager/proguard-rules.pro</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">manager/src/main/AndroidManifest.xml</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">manager/src/main/assets/lspatch/dexes/loader.dex</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">manager/src/main/assets/lspatch/dexes/metaloader.dex</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">manager/src/main/assets/lspatch/keystore.jks</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">manager/src/main/assets/lspatch/so/arm64-v8a/liblspatch.so</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">manager/src/main/assets/lspatch/so/armeabi-v7a/liblspatch.so</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">manager/src/main/assets/lspatch/version.txt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">manager/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a></td><td> | </td><td class="num">110</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/LSPatch.kt</a></td><td> | </td><td class="num">176</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/Constants.kt</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h16">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/PatchConfig.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h17">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/util/ApkSignatureHelper.kt</a></td><td> | </td><td class="num">147</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">settings.gradle.kts</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
</table></pre><pre>19 files changed, 581 insertions(+), 2 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a> b/<a href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,5 +1,7 @@
</a> [versions]
 agp = &quot;8.1.2&quot;
<a href="#h0-0-2" id="h0-0-2" class="i">+apksig = &quot;8.0.2&quot;
</a><a href="#h0-0-3" id="h0-0-3" class="i">+guava = &quot;32.1.3-jre&quot;
</a> kotlin = &quot;1.9.0&quot;
 kotlinx-coroutines-android = &quot;1.7.3&quot;
 
<a href="#h0-1" id="h0-1" class="h">@@ -33,6 +35,7 @@ androidx-material-ripple = { module = &quot;androidx.compose.material:material-ripple
</a> androidx-navigation-compose = { module = &quot;androidx.navigation:navigation-compose&quot;, version.ref = &quot;navigation-compose&quot; }
 androidx-ui-tooling = { module = &quot;androidx.compose.ui:ui-tooling&quot;, version.ref = &quot;ui-tooling-preview&quot; }
 androidx-ui-tooling-preview = { module = &quot;androidx.compose.ui:ui-tooling-preview&quot;, version.ref = &quot;ui-tooling-preview&quot; }
<a href="#h0-1-3" id="h0-1-3" class="i">+apksig = { module = &quot;com.android.tools.build:apksig&quot;, version.ref = &quot;apksig&quot; }
</a> bcprov-jdk18on = { module = &quot;org.bouncycastle:bcprov-jdk18on&quot;, version.ref = &quot;bcprov-jdk18on&quot; }
 coil-compose = { module = &quot;io.coil-kt:coil-compose&quot;, version.ref = &quot;coil-compose&quot; }
 coil-video = { module = &quot;io.coil-kt:coil-video&quot;, version.ref = &quot;coil-compose&quot; }
<a href="#h0-2" id="h0-2" class="h">@@ -40,6 +43,7 @@ coroutines = { group = &quot;org.jetbrains.kotlinx&quot;, name = &quot;kotlinx-coroutines-andro
</a> dexlib2 = { group = &quot;org.smali&quot;, name = &quot;dexlib2&quot;, version.ref = &quot;dexlib2&quot; }
 ffmpeg-kit = { group = &quot;com.arthenica&quot;, name = &quot;ffmpeg-kit-full-gpl&quot;, version.ref = &quot;ffmpeg-kit&quot; }
 gson = { group = &quot;com.google.code.gson&quot;, name = &quot;gson&quot;, version.ref = &quot;gson&quot; }
<a href="#h0-2-3" id="h0-2-3" class="i">+guava = { module = &quot;com.google.guava:guava&quot;, version.ref = &quot;guava&quot; }
</a> junit = { module = &quot;junit:junit&quot;, version.ref = &quot;junit&quot; }
 okhttp = { group = &quot;com.squareup.okhttp3&quot;, name = &quot;okhttp&quot;, version.ref = &quot;okhttp&quot; }
 osmdroid-android = { group = &quot;org.osmdroid&quot;, name = &quot;osmdroid-android&quot;, version.ref = &quot;osmdroid-android&quot; }
<b>diff --git a/<a id="h1" href="../file/manager/.gitignore.html">manager/.gitignore</a> b/<a href="../file/manager/.gitignore.html">manager/.gitignore</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -0,0 +1 @@
</a><a href="#h1-0-0" id="h1-0-0" class="i">+/build</a><a href="#h1-0-1" id="h1-0-1" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h2" href="../file/manager/build.gradle.kts.html">manager/build.gradle.kts</a> b/<a href="../file/manager/build.gradle.kts.html">manager/build.gradle.kts</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,83 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+import com.android.build.gradle.internal.api.BaseVariantOutputImpl
</a><a href="#h2-0-1" id="h2-0-1" class="i">+
</a><a href="#h2-0-2" id="h2-0-2" class="i">+plugins {
</a><a href="#h2-0-3" id="h2-0-3" class="i">+    alias(libs.plugins.androidApplication)
</a><a href="#h2-0-4" id="h2-0-4" class="i">+    alias(libs.plugins.kotlinAndroid)
</a><a href="#h2-0-5" id="h2-0-5" class="i">+}
</a><a href="#h2-0-6" id="h2-0-6" class="i">+
</a><a href="#h2-0-7" id="h2-0-7" class="i">+android {
</a><a href="#h2-0-8" id="h2-0-8" class="i">+    namespace = rootProject.ext[&quot;applicationId&quot;].toString() + &quot;.manager&quot;
</a><a href="#h2-0-9" id="h2-0-9" class="i">+    compileSdk = 34
</a><a href="#h2-0-10" id="h2-0-10" class="i">+
</a><a href="#h2-0-11" id="h2-0-11" class="i">+    androidResources {
</a><a href="#h2-0-12" id="h2-0-12" class="i">+        noCompress += &quot;.so&quot;
</a><a href="#h2-0-13" id="h2-0-13" class="i">+    }
</a><a href="#h2-0-14" id="h2-0-14" class="i">+
</a><a href="#h2-0-15" id="h2-0-15" class="i">+    buildFeatures {
</a><a href="#h2-0-16" id="h2-0-16" class="i">+        compose = true
</a><a href="#h2-0-17" id="h2-0-17" class="i">+        buildConfig = true
</a><a href="#h2-0-18" id="h2-0-18" class="i">+    }
</a><a href="#h2-0-19" id="h2-0-19" class="i">+
</a><a href="#h2-0-20" id="h2-0-20" class="i">+    defaultConfig {
</a><a href="#h2-0-21" id="h2-0-21" class="i">+        buildConfigField(&quot;String&quot;, &quot;APPLICATION_ID&quot;, &quot;\&quot;${rootProject.ext[&quot;applicationId&quot;]}\&quot;&quot;)
</a><a href="#h2-0-22" id="h2-0-22" class="i">+    }
</a><a href="#h2-0-23" id="h2-0-23" class="i">+
</a><a href="#h2-0-24" id="h2-0-24" class="i">+    composeOptions {
</a><a href="#h2-0-25" id="h2-0-25" class="i">+        kotlinCompilerExtensionVersion = &quot;1.5.2&quot;
</a><a href="#h2-0-26" id="h2-0-26" class="i">+    }
</a><a href="#h2-0-27" id="h2-0-27" class="i">+
</a><a href="#h2-0-28" id="h2-0-28" class="i">+    defaultConfig {
</a><a href="#h2-0-29" id="h2-0-29" class="i">+        applicationId = rootProject.ext[&quot;applicationId&quot;].toString() + &quot;.manager&quot;
</a><a href="#h2-0-30" id="h2-0-30" class="i">+        versionCode = 1
</a><a href="#h2-0-31" id="h2-0-31" class="i">+        versionName = &quot;1.0.0&quot;
</a><a href="#h2-0-32" id="h2-0-32" class="i">+        minSdk = 28
</a><a href="#h2-0-33" id="h2-0-33" class="i">+        targetSdk = 34
</a><a href="#h2-0-34" id="h2-0-34" class="i">+        multiDexEnabled = true
</a><a href="#h2-0-35" id="h2-0-35" class="i">+    }
</a><a href="#h2-0-36" id="h2-0-36" class="i">+
</a><a href="#h2-0-37" id="h2-0-37" class="i">+    buildTypes {
</a><a href="#h2-0-38" id="h2-0-38" class="i">+        release {
</a><a href="#h2-0-39" id="h2-0-39" class="i">+            isMinifyEnabled = true
</a><a href="#h2-0-40" id="h2-0-40" class="i">+            proguardFiles += file(&quot;proguard-rules.pro&quot;)
</a><a href="#h2-0-41" id="h2-0-41" class="i">+        }
</a><a href="#h2-0-42" id="h2-0-42" class="i">+        debug {
</a><a href="#h2-0-43" id="h2-0-43" class="i">+            isMinifyEnabled = false
</a><a href="#h2-0-44" id="h2-0-44" class="i">+        }
</a><a href="#h2-0-45" id="h2-0-45" class="i">+    }
</a><a href="#h2-0-46" id="h2-0-46" class="i">+
</a><a href="#h2-0-47" id="h2-0-47" class="i">+    applicationVariants.all {
</a><a href="#h2-0-48" id="h2-0-48" class="i">+        outputs.map { it as BaseVariantOutputImpl }.forEach { outputVariant -&gt;
</a><a href="#h2-0-49" id="h2-0-49" class="i">+            outputVariant.outputFileName = &quot;manager.apk&quot;
</a><a href="#h2-0-50" id="h2-0-50" class="i">+        }
</a><a href="#h2-0-51" id="h2-0-51" class="i">+    }
</a><a href="#h2-0-52" id="h2-0-52" class="i">+
</a><a href="#h2-0-53" id="h2-0-53" class="i">+    compileOptions {
</a><a href="#h2-0-54" id="h2-0-54" class="i">+        sourceCompatibility = JavaVersion.VERSION_1_8
</a><a href="#h2-0-55" id="h2-0-55" class="i">+        targetCompatibility = JavaVersion.VERSION_1_8
</a><a href="#h2-0-56" id="h2-0-56" class="i">+    }
</a><a href="#h2-0-57" id="h2-0-57" class="i">+
</a><a href="#h2-0-58" id="h2-0-58" class="i">+    kotlinOptions {
</a><a href="#h2-0-59" id="h2-0-59" class="i">+        jvmTarget = &quot;1.8&quot;
</a><a href="#h2-0-60" id="h2-0-60" class="i">+    }
</a><a href="#h2-0-61" id="h2-0-61" class="i">+}
</a><a href="#h2-0-62" id="h2-0-62" class="i">+
</a><a href="#h2-0-63" id="h2-0-63" class="i">+configurations {
</a><a href="#h2-0-64" id="h2-0-64" class="i">+    all {
</a><a href="#h2-0-65" id="h2-0-65" class="i">+        resolutionStrategy {
</a><a href="#h2-0-66" id="h2-0-66" class="i">+            exclude(group = &quot;com.google.guava&quot;, module = &quot;listenablefuture&quot;)
</a><a href="#h2-0-67" id="h2-0-67" class="i">+        }
</a><a href="#h2-0-68" id="h2-0-68" class="i">+    }
</a><a href="#h2-0-69" id="h2-0-69" class="i">+}
</a><a href="#h2-0-70" id="h2-0-70" class="i">+
</a><a href="#h2-0-71" id="h2-0-71" class="i">+dependencies {
</a><a href="#h2-0-72" id="h2-0-72" class="i">+    implementation(fileTree(mapOf(&quot;dir&quot; to &quot;libs&quot;, &quot;include&quot; to listOf(&quot;*.jar&quot;))))
</a><a href="#h2-0-73" id="h2-0-73" class="i">+    implementation(libs.guava)
</a><a href="#h2-0-74" id="h2-0-74" class="i">+    implementation(libs.apksig)
</a><a href="#h2-0-75" id="h2-0-75" class="i">+    implementation(libs.gson)
</a><a href="#h2-0-76" id="h2-0-76" class="i">+    implementation(libs.androidx.material3)
</a><a href="#h2-0-77" id="h2-0-77" class="i">+    implementation(libs.androidx.activity.ktx)
</a><a href="#h2-0-78" id="h2-0-78" class="i">+    implementation(libs.androidx.navigation.compose)
</a><a href="#h2-0-79" id="h2-0-79" class="i">+    implementation(libs.androidx.material.icons.core)
</a><a href="#h2-0-80" id="h2-0-80" class="i">+    implementation(libs.androidx.material.ripple)
</a><a href="#h2-0-81" id="h2-0-81" class="i">+    implementation(libs.androidx.material.icons.extended)
</a><a href="#h2-0-82" id="h2-0-82" class="i">+}</a><a href="#h2-0-83" id="h2-0-83" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/manager/libs/ManifestEditor-1.0.2.jar.html">manager/libs/ManifestEditor-1.0.2.jar</a> b/<a href="../file/manager/libs/ManifestEditor-1.0.2.jar.html">manager/libs/ManifestEditor-1.0.2.jar</a></b>
Binary files differ.
<b>diff --git a/<a id="h4" href="../file/manager/libs/apkzlib.jar.html">manager/libs/apkzlib.jar</a> b/<a href="../file/manager/libs/apkzlib.jar.html">manager/libs/apkzlib.jar</a></b>
Binary files differ.
<b>diff --git a/<a id="h5" href="../file/manager/proguard-rules.pro.html">manager/proguard-rules.pro</a> b/<a href="../file/manager/proguard-rules.pro.html">manager/proguard-rules.pro</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,2 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+-dontwarn com.google.errorprone.annotations.**
</a><a href="#h5-0-1" id="h5-0-1" class="i">+-dontwarn com.google.auto.value.**</a><a href="#h5-0-2" id="h5-0-2" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h6" href="../file/manager/src/main/AndroidManifest.xml.html">manager/src/main/AndroidManifest.xml</a> b/<a href="../file/manager/src/main/AndroidManifest.xml.html">manager/src/main/AndroidManifest.xml</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
</a><a href="#h6-0-1" id="h6-0-1" class="i">+&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
</a><a href="#h6-0-2" id="h6-0-2" class="i">+    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;
</a><a href="#h6-0-3" id="h6-0-3" class="i">+
</a><a href="#h6-0-4" id="h6-0-4" class="i">+    &lt;uses-permission android:name=&quot;android.permission.QUERY_ALL_PACKAGES&quot;
</a><a href="#h6-0-5" id="h6-0-5" class="i">+        tools:ignore=&quot;QueryAllPackagesPermission&quot; /&gt;
</a><a href="#h6-0-6" id="h6-0-6" class="i">+    &lt;uses-permission android:name=&quot;android.permission.REQUEST_INSTALL_PACKAGES&quot; /&gt;
</a><a href="#h6-0-7" id="h6-0-7" class="i">+    &lt;uses-permission android:name=&quot;android.permission.REQUEST_DELETE_PACKAGES&quot; /&gt;
</a><a href="#h6-0-8" id="h6-0-8" class="i">+
</a><a href="#h6-0-9" id="h6-0-9" class="i">+    &lt;application
</a><a href="#h6-0-10" id="h6-0-10" class="i">+        android:label=&quot;SE Manager&quot;
</a><a href="#h6-0-11" id="h6-0-11" class="i">+        android:icon=&quot;@android:drawable/ic_input_add&quot;&gt;
</a><a href="#h6-0-12" id="h6-0-12" class="i">+        &lt;activity android:name=&quot;.MainActivity&quot; android:exported=&quot;true&quot;&gt;
</a><a href="#h6-0-13" id="h6-0-13" class="i">+            &lt;intent-filter&gt;
</a><a href="#h6-0-14" id="h6-0-14" class="i">+                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
</a><a href="#h6-0-15" id="h6-0-15" class="i">+                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
</a><a href="#h6-0-16" id="h6-0-16" class="i">+            &lt;/intent-filter&gt;
</a><a href="#h6-0-17" id="h6-0-17" class="i">+        &lt;/activity&gt;
</a><a href="#h6-0-18" id="h6-0-18" class="i">+    &lt;/application&gt;
</a><a href="#h6-0-19" id="h6-0-19" class="i">+&lt;/manifest&gt;</a><a href="#h6-0-20" id="h6-0-20" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/manager/src/main/assets/lspatch/dexes/loader.dex.html">manager/src/main/assets/lspatch/dexes/loader.dex</a> b/<a href="../file/manager/src/main/assets/lspatch/dexes/loader.dex.html">manager/src/main/assets/lspatch/dexes/loader.dex</a></b>
Binary files differ.
<b>diff --git a/<a id="h8" href="../file/manager/src/main/assets/lspatch/dexes/metaloader.dex.html">manager/src/main/assets/lspatch/dexes/metaloader.dex</a> b/<a href="../file/manager/src/main/assets/lspatch/dexes/metaloader.dex.html">manager/src/main/assets/lspatch/dexes/metaloader.dex</a></b>
Binary files differ.
<b>diff --git a/<a id="h9" href="../file/manager/src/main/assets/lspatch/keystore.jks.html">manager/src/main/assets/lspatch/keystore.jks</a> b/<a href="../file/manager/src/main/assets/lspatch/keystore.jks.html">manager/src/main/assets/lspatch/keystore.jks</a></b>
Binary files differ.
<b>diff --git a/<a id="h10" href="../file/manager/src/main/assets/lspatch/so/arm64-v8a/liblspatch.so.html">manager/src/main/assets/lspatch/so/arm64-v8a/liblspatch.so</a> b/<a href="../file/manager/src/main/assets/lspatch/so/arm64-v8a/liblspatch.so.html">manager/src/main/assets/lspatch/so/arm64-v8a/liblspatch.so</a></b>
Binary files differ.
<b>diff --git a/<a id="h11" href="../file/manager/src/main/assets/lspatch/so/armeabi-v7a/liblspatch.so.html">manager/src/main/assets/lspatch/so/armeabi-v7a/liblspatch.so</a> b/<a href="../file/manager/src/main/assets/lspatch/so/armeabi-v7a/liblspatch.so.html">manager/src/main/assets/lspatch/so/armeabi-v7a/liblspatch.so</a></b>
Binary files differ.
<b>diff --git a/<a id="h12" href="../file/manager/src/main/assets/lspatch/version.txt.html">manager/src/main/assets/lspatch/version.txt</a> b/<a href="../file/manager/src/main/assets/lspatch/version.txt.html">manager/src/main/assets/lspatch/version.txt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+0.5.1</a><a href="#h12-0-1" id="h12-0-1" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h13" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,109 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+package me.rhunk.snapenhance.manager
</a><a href="#h13-0-1" id="h13-0-1" class="i">+
</a><a href="#h13-0-2" id="h13-0-2" class="i">+import android.os.Build
</a><a href="#h13-0-3" id="h13-0-3" class="i">+import android.os.Bundle
</a><a href="#h13-0-4" id="h13-0-4" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h13-0-5" id="h13-0-5" class="i">+import androidx.activity.compose.setContent
</a><a href="#h13-0-6" id="h13-0-6" class="i">+import androidx.compose.foundation.border
</a><a href="#h13-0-7" id="h13-0-7" class="i">+import androidx.compose.foundation.isSystemInDarkTheme
</a><a href="#h13-0-8" id="h13-0-8" class="i">+import androidx.compose.foundation.layout.Arrangement
</a><a href="#h13-0-9" id="h13-0-9" class="i">+import androidx.compose.foundation.layout.Column
</a><a href="#h13-0-10" id="h13-0-10" class="i">+import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h13-0-11" id="h13-0-11" class="i">+import androidx.compose.foundation.layout.height
</a><a href="#h13-0-12" id="h13-0-12" class="i">+import androidx.compose.foundation.layout.padding
</a><a href="#h13-0-13" id="h13-0-13" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h13-0-14" id="h13-0-14" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h13-0-15" id="h13-0-15" class="i">+import androidx.compose.foundation.lazy.rememberLazyListState
</a><a href="#h13-0-16" id="h13-0-16" class="i">+import androidx.compose.material3.Button
</a><a href="#h13-0-17" id="h13-0-17" class="i">+import androidx.compose.material3.MaterialTheme
</a><a href="#h13-0-18" id="h13-0-18" class="i">+import androidx.compose.material3.Text
</a><a href="#h13-0-19" id="h13-0-19" class="i">+import androidx.compose.material3.dynamicDarkColorScheme
</a><a href="#h13-0-20" id="h13-0-20" class="i">+import androidx.compose.material3.dynamicLightColorScheme
</a><a href="#h13-0-21" id="h13-0-21" class="i">+import androidx.compose.runtime.LaunchedEffect
</a><a href="#h13-0-22" id="h13-0-22" class="i">+import androidx.compose.runtime.mutableStateListOf
</a><a href="#h13-0-23" id="h13-0-23" class="i">+import androidx.compose.runtime.remember
</a><a href="#h13-0-24" id="h13-0-24" class="i">+import androidx.compose.runtime.rememberCoroutineScope
</a><a href="#h13-0-25" id="h13-0-25" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h13-0-26" id="h13-0-26" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h13-0-27" id="h13-0-27" class="i">+import androidx.compose.ui.graphics.Color
</a><a href="#h13-0-28" id="h13-0-28" class="i">+import androidx.compose.ui.platform.LocalContext
</a><a href="#h13-0-29" id="h13-0-29" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h13-0-30" id="h13-0-30" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h13-0-31" id="h13-0-31" class="i">+import kotlinx.coroutines.launch
</a><a href="#h13-0-32" id="h13-0-32" class="i">+import me.rhunk.snapenhance.manager.lspatch.LSPatch
</a><a href="#h13-0-33" id="h13-0-33" class="i">+import java.io.File
</a><a href="#h13-0-34" id="h13-0-34" class="i">+import java.io.PrintWriter
</a><a href="#h13-0-35" id="h13-0-35" class="i">+import java.io.StringWriter
</a><a href="#h13-0-36" id="h13-0-36" class="i">+
</a><a href="#h13-0-37" id="h13-0-37" class="i">+class MainActivity : ComponentActivity() {
</a><a href="#h13-0-38" id="h13-0-38" class="i">+    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h13-0-39" id="h13-0-39" class="i">+        super.onCreate(savedInstanceState)
</a><a href="#h13-0-40" id="h13-0-40" class="i">+
</a><a href="#h13-0-41" id="h13-0-41" class="i">+        setContent {
</a><a href="#h13-0-42" id="h13-0-42" class="i">+            val coroutineScope = rememberCoroutineScope()
</a><a href="#h13-0-43" id="h13-0-43" class="i">+            MaterialTheme(
</a><a href="#h13-0-44" id="h13-0-44" class="i">+                colorScheme = if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {
</a><a href="#h13-0-45" id="h13-0-45" class="i">+                    if (isSystemInDarkTheme()) dynamicDarkColorScheme(LocalContext.current)
</a><a href="#h13-0-46" id="h13-0-46" class="i">+                    else dynamicLightColorScheme(LocalContext.current)
</a><a href="#h13-0-47" id="h13-0-47" class="i">+                } else MaterialTheme.colorScheme
</a><a href="#h13-0-48" id="h13-0-48" class="i">+            ) {
</a><a href="#h13-0-49" id="h13-0-49" class="i">+                val context = LocalContext.current
</a><a href="#h13-0-50" id="h13-0-50" class="i">+                val logs = remember { mutableStateListOf&lt;String&gt;() }
</a><a href="#h13-0-51" id="h13-0-51" class="i">+                fun printLog(data: Any) {
</a><a href="#h13-0-52" id="h13-0-52" class="i">+                    when (data) {
</a><a href="#h13-0-53" id="h13-0-53" class="i">+                        is Throwable -&gt; {
</a><a href="#h13-0-54" id="h13-0-54" class="i">+                            logs += data.message.toString()
</a><a href="#h13-0-55" id="h13-0-55" class="i">+                            logs += StringWriter().apply {
</a><a href="#h13-0-56" id="h13-0-56" class="i">+                                data.printStackTrace(PrintWriter(this))
</a><a href="#h13-0-57" id="h13-0-57" class="i">+                            }.toString()
</a><a href="#h13-0-58" id="h13-0-58" class="i">+                        }
</a><a href="#h13-0-59" id="h13-0-59" class="i">+                        else -&gt; logs += data.toString()
</a><a href="#h13-0-60" id="h13-0-60" class="i">+                    }
</a><a href="#h13-0-61" id="h13-0-61" class="i">+                }
</a><a href="#h13-0-62" id="h13-0-62" class="i">+
</a><a href="#h13-0-63" id="h13-0-63" class="i">+                val scrollState = rememberLazyListState(0)
</a><a href="#h13-0-64" id="h13-0-64" class="i">+
</a><a href="#h13-0-65" id="h13-0-65" class="i">+                Column(
</a><a href="#h13-0-66" id="h13-0-66" class="i">+                    horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h13-0-67" id="h13-0-67" class="i">+                    verticalArrangement = Arrangement.spacedBy(20.dp),
</a><a href="#h13-0-68" id="h13-0-68" class="i">+                    modifier = Modifier.padding(10.dp)
</a><a href="#h13-0-69" id="h13-0-69" class="i">+                ) {
</a><a href="#h13-0-70" id="h13-0-70" class="i">+                    Text(text = &quot;SE Manager&quot;)
</a><a href="#h13-0-71" id="h13-0-71" class="i">+
</a><a href="#h13-0-72" id="h13-0-72" class="i">+                    Button(onClick = {
</a><a href="#h13-0-73" id="h13-0-73" class="i">+                        coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h13-0-74" id="h13-0-74" class="i">+                            runCatching {
</a><a href="#h13-0-75" id="h13-0-75" class="i">+                                val lspatch = LSPatch(
</a><a href="#h13-0-76" id="h13-0-76" class="i">+                                    context,
</a><a href="#h13-0-77" id="h13-0-77" class="i">+                                    mapOf(
</a><a href="#h13-0-78" id="h13-0-78" class="i">+                                        BuildConfig.APPLICATION_ID to File(context.packageManager.getPackageInfo(BuildConfig.APPLICATION_ID, 0).applicationInfo.sourceDir)
</a><a href="#h13-0-79" id="h13-0-79" class="i">+                                    )
</a><a href="#h13-0-80" id="h13-0-80" class="i">+                                ) { printLog(it) }
</a><a href="#h13-0-81" id="h13-0-81" class="i">+                                lspatch.patch(
</a><a href="#h13-0-82" id="h13-0-82" class="i">+                                    File(context.packageManager.getPackageInfo(&quot;com.snapchat.android&quot;, 0).applicationInfo.sourceDir),
</a><a href="#h13-0-83" id="h13-0-83" class="i">+                                    File(context.filesDir, &quot;patched.apk&quot;)
</a><a href="#h13-0-84" id="h13-0-84" class="i">+                                )
</a><a href="#h13-0-85" id="h13-0-85" class="i">+                            }.onFailure { printLog(it) }
</a><a href="#h13-0-86" id="h13-0-86" class="i">+                        }
</a><a href="#h13-0-87" id="h13-0-87" class="i">+                    }) {
</a><a href="#h13-0-88" id="h13-0-88" class="i">+                        Text(text = &quot;Test patch apk&quot;)
</a><a href="#h13-0-89" id="h13-0-89" class="i">+                    }
</a><a href="#h13-0-90" id="h13-0-90" class="i">+
</a><a href="#h13-0-91" id="h13-0-91" class="i">+                    LazyColumn(
</a><a href="#h13-0-92" id="h13-0-92" class="i">+                        state = scrollState,
</a><a href="#h13-0-93" id="h13-0-93" class="i">+                        modifier = Modifier.fillMaxWidth().padding(5.dp).height(500.dp).border(1.dp, color = Color.Black),
</a><a href="#h13-0-94" id="h13-0-94" class="i">+                        content = {
</a><a href="#h13-0-95" id="h13-0-95" class="i">+                            items(logs) {
</a><a href="#h13-0-96" id="h13-0-96" class="i">+                                Text(text = it, modifier = Modifier.padding(2.dp))
</a><a href="#h13-0-97" id="h13-0-97" class="i">+                            }
</a><a href="#h13-0-98" id="h13-0-98" class="i">+                        }
</a><a href="#h13-0-99" id="h13-0-99" class="i">+                    )
</a><a href="#h13-0-100" id="h13-0-100" class="i">+
</a><a href="#h13-0-101" id="h13-0-101" class="i">+                    LaunchedEffect(logs.size) {
</a><a href="#h13-0-102" id="h13-0-102" class="i">+                        scrollState.scrollToItem((logs.size - 1).coerceAtLeast(0))
</a><a href="#h13-0-103" id="h13-0-103" class="i">+                    }
</a><a href="#h13-0-104" id="h13-0-104" class="i">+                }
</a><a href="#h13-0-105" id="h13-0-105" class="i">+            }
</a><a href="#h13-0-106" id="h13-0-106" class="i">+        }
</a><a href="#h13-0-107" id="h13-0-107" class="i">+    }
</a><a href="#h13-0-108" id="h13-0-108" class="i">+}</a><a href="#h13-0-109" id="h13-0-109" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/LSPatch.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/LSPatch.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/LSPatch.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/LSPatch.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,175 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+package me.rhunk.snapenhance.manager.lspatch
</a><a href="#h14-0-1" id="h14-0-1" class="i">+
</a><a href="#h14-0-2" id="h14-0-2" class="i">+import android.content.Context
</a><a href="#h14-0-3" id="h14-0-3" class="i">+import com.android.tools.build.apkzlib.sign.SigningExtension
</a><a href="#h14-0-4" id="h14-0-4" class="i">+import com.android.tools.build.apkzlib.sign.SigningOptions
</a><a href="#h14-0-5" id="h14-0-5" class="i">+import com.android.tools.build.apkzlib.zip.AlignmentRules
</a><a href="#h14-0-6" id="h14-0-6" class="i">+import com.android.tools.build.apkzlib.zip.ZFile
</a><a href="#h14-0-7" id="h14-0-7" class="i">+import com.android.tools.build.apkzlib.zip.ZFileOptions
</a><a href="#h14-0-8" id="h14-0-8" class="i">+import com.google.gson.Gson
</a><a href="#h14-0-9" id="h14-0-9" class="i">+import com.wind.meditor.core.ManifestEditor
</a><a href="#h14-0-10" id="h14-0-10" class="i">+import com.wind.meditor.property.AttributeItem
</a><a href="#h14-0-11" id="h14-0-11" class="i">+import com.wind.meditor.property.ModificationProperty
</a><a href="#h14-0-12" id="h14-0-12" class="i">+import me.rhunk.snapenhance.manager.lspatch.config.Constants.ORIGINAL_APK_ASSET_PATH
</a><a href="#h14-0-13" id="h14-0-13" class="i">+import me.rhunk.snapenhance.manager.lspatch.config.Constants.PROXY_APP_COMPONENT_FACTORY
</a><a href="#h14-0-14" id="h14-0-14" class="i">+import me.rhunk.snapenhance.manager.lspatch.config.PatchConfig
</a><a href="#h14-0-15" id="h14-0-15" class="i">+import me.rhunk.snapenhance.manager.lspatch.util.ApkSignatureHelper
</a><a href="#h14-0-16" id="h14-0-16" class="i">+import java.io.ByteArrayInputStream
</a><a href="#h14-0-17" id="h14-0-17" class="i">+import java.io.ByteArrayOutputStream
</a><a href="#h14-0-18" id="h14-0-18" class="i">+import java.io.File
</a><a href="#h14-0-19" id="h14-0-19" class="i">+import java.security.KeyStore
</a><a href="#h14-0-20" id="h14-0-20" class="i">+import java.security.cert.X509Certificate
</a><a href="#h14-0-21" id="h14-0-21" class="i">+import java.util.zip.ZipFile
</a><a href="#h14-0-22" id="h14-0-22" class="i">+import kotlin.io.encoding.Base64
</a><a href="#h14-0-23" id="h14-0-23" class="i">+import kotlin.io.encoding.ExperimentalEncodingApi
</a><a href="#h14-0-24" id="h14-0-24" class="i">+
</a><a href="#h14-0-25" id="h14-0-25" class="i">+
</a><a href="#h14-0-26" id="h14-0-26" class="i">+//https://github.com/LSPosed/LSPatch/blob/master/patch/src/main/java/org/lsposed/patch/LSPatch.java
</a><a href="#h14-0-27" id="h14-0-27" class="i">+class LSPatch(
</a><a href="#h14-0-28" id="h14-0-28" class="i">+    private val context: Context,
</a><a href="#h14-0-29" id="h14-0-29" class="i">+    private val modules: Map&lt;String, File&gt;, //packageName -&gt; file
</a><a href="#h14-0-30" id="h14-0-30" class="i">+    private val printLog: (Any) -&gt; Unit
</a><a href="#h14-0-31" id="h14-0-31" class="i">+) {
</a><a href="#h14-0-32" id="h14-0-32" class="i">+    companion object {
</a><a href="#h14-0-33" id="h14-0-33" class="i">+        private val Z_FILE_OPTIONS = ZFileOptions().setAlignmentRule(
</a><a href="#h14-0-34" id="h14-0-34" class="i">+            AlignmentRules.compose(
</a><a href="#h14-0-35" id="h14-0-35" class="i">+                AlignmentRules.constantForSuffix(&quot;.so&quot;, 4096),
</a><a href="#h14-0-36" id="h14-0-36" class="i">+                AlignmentRules.constantForSuffix(ORIGINAL_APK_ASSET_PATH, 4096)
</a><a href="#h14-0-37" id="h14-0-37" class="i">+            )
</a><a href="#h14-0-38" id="h14-0-38" class="i">+        )
</a><a href="#h14-0-39" id="h14-0-39" class="i">+    }
</a><a href="#h14-0-40" id="h14-0-40" class="i">+
</a><a href="#h14-0-41" id="h14-0-41" class="i">+    private fun patchManifest(data: ByteArray, lspatchMetadata: String): ByteArray {
</a><a href="#h14-0-42" id="h14-0-42" class="i">+        val property = ModificationProperty()
</a><a href="#h14-0-43" id="h14-0-43" class="i">+
</a><a href="#h14-0-44" id="h14-0-44" class="i">+        property.addApplicationAttribute(AttributeItem(&quot;appComponentFactory&quot;, PROXY_APP_COMPONENT_FACTORY))
</a><a href="#h14-0-45" id="h14-0-45" class="i">+        property.addMetaData(ModificationProperty.MetaData(&quot;lspatch&quot;, lspatchMetadata))
</a><a href="#h14-0-46" id="h14-0-46" class="i">+
</a><a href="#h14-0-47" id="h14-0-47" class="i">+        return ByteArrayOutputStream().apply {
</a><a href="#h14-0-48" id="h14-0-48" class="i">+            ManifestEditor(ByteArrayInputStream(data), this, property).processManifest()
</a><a href="#h14-0-49" id="h14-0-49" class="i">+            flush()
</a><a href="#h14-0-50" id="h14-0-50" class="i">+            close()
</a><a href="#h14-0-51" id="h14-0-51" class="i">+        }.toByteArray()
</a><a href="#h14-0-52" id="h14-0-52" class="i">+    }
</a><a href="#h14-0-53" id="h14-0-53" class="i">+
</a><a href="#h14-0-54" id="h14-0-54" class="i">+    @Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h14-0-55" id="h14-0-55" class="i">+    @OptIn(ExperimentalEncodingApi::class)
</a><a href="#h14-0-56" id="h14-0-56" class="i">+    private fun patchApk(inputApkFile: File, outputFile: File) {
</a><a href="#h14-0-57" id="h14-0-57" class="i">+        printLog(&quot;Patching ${inputApkFile.absolutePath} to ${outputFile.absolutePath}&quot;)
</a><a href="#h14-0-58" id="h14-0-58" class="i">+        val dstZFile = ZFile.openReadWrite(outputFile, Z_FILE_OPTIONS)
</a><a href="#h14-0-59" id="h14-0-59" class="i">+        val sourceApkFile = dstZFile.addNestedZip({ ORIGINAL_APK_ASSET_PATH }, inputApkFile, false)
</a><a href="#h14-0-60" id="h14-0-60" class="i">+
</a><a href="#h14-0-61" id="h14-0-61" class="i">+        val patchConfig = PatchConfig(
</a><a href="#h14-0-62" id="h14-0-62" class="i">+            useManager = false,
</a><a href="#h14-0-63" id="h14-0-63" class="i">+            debuggable = false,
</a><a href="#h14-0-64" id="h14-0-64" class="i">+            overrideVersionCode = false,
</a><a href="#h14-0-65" id="h14-0-65" class="i">+            sigBypassLevel = 2,
</a><a href="#h14-0-66" id="h14-0-66" class="i">+            originalSignature = ApkSignatureHelper.getApkSignInfo(inputApkFile.absolutePath),
</a><a href="#h14-0-67" id="h14-0-67" class="i">+            appComponentFactory = &quot;androidx.core.app.CoreComponentFactory&quot;
</a><a href="#h14-0-68" id="h14-0-68" class="i">+        ).let { Gson().toJson(it) }
</a><a href="#h14-0-69" id="h14-0-69" class="i">+
</a><a href="#h14-0-70" id="h14-0-70" class="i">+        // sign apk
</a><a href="#h14-0-71" id="h14-0-71" class="i">+        runCatching {
</a><a href="#h14-0-72" id="h14-0-72" class="i">+            val keyStore = KeyStore.getInstance(KeyStore.getDefaultType())
</a><a href="#h14-0-73" id="h14-0-73" class="i">+            keyStore.load(context.assets.open(&quot;lspatch/keystore.jks&quot;), &quot;android&quot;.toCharArray())
</a><a href="#h14-0-74" id="h14-0-74" class="i">+            val key = keyStore.getEntry(&quot;androiddebugkey&quot;, KeyStore.PasswordProtection(&quot;android&quot;.toCharArray())) as KeyStore.PrivateKeyEntry
</a><a href="#h14-0-75" id="h14-0-75" class="i">+            SigningExtension(
</a><a href="#h14-0-76" id="h14-0-76" class="i">+                SigningOptions.builder().apply {
</a><a href="#h14-0-77" id="h14-0-77" class="i">+                    setMinSdkVersion(28)
</a><a href="#h14-0-78" id="h14-0-78" class="i">+                    setV2SigningEnabled(true)
</a><a href="#h14-0-79" id="h14-0-79" class="i">+                    setCertificates(*(key.certificateChain as Array&lt;X509Certificate&gt;))
</a><a href="#h14-0-80" id="h14-0-80" class="i">+                    setKey(key.privateKey)
</a><a href="#h14-0-81" id="h14-0-81" class="i">+                }.build()
</a><a href="#h14-0-82" id="h14-0-82" class="i">+            ).apply {
</a><a href="#h14-0-83" id="h14-0-83" class="i">+                register(dstZFile)
</a><a href="#h14-0-84" id="h14-0-84" class="i">+            }
</a><a href="#h14-0-85" id="h14-0-85" class="i">+        }.onFailure {
</a><a href="#h14-0-86" id="h14-0-86" class="i">+            throw Exception(&quot;Failed to sign apk&quot;, it)
</a><a href="#h14-0-87" id="h14-0-87" class="i">+        }
</a><a href="#h14-0-88" id="h14-0-88" class="i">+
</a><a href="#h14-0-89" id="h14-0-89" class="i">+        printLog(&quot;Patching manifest&quot;)
</a><a href="#h14-0-90" id="h14-0-90" class="i">+
</a><a href="#h14-0-91" id="h14-0-91" class="i">+        val originalManifestEntry = sourceApkFile.get(&quot;AndroidManifest.xml&quot;) ?: throw Exception(&quot;No original manifest found&quot;)
</a><a href="#h14-0-92" id="h14-0-92" class="i">+        originalManifestEntry.open().use { inputStream -&gt;
</a><a href="#h14-0-93" id="h14-0-93" class="i">+            val patchedManifestData = patchManifest(inputStream.readBytes(), Base64.encode(patchConfig.toByteArray()))
</a><a href="#h14-0-94" id="h14-0-94" class="i">+            dstZFile.add(&quot;AndroidManifest.xml&quot;, patchedManifestData.inputStream())
</a><a href="#h14-0-95" id="h14-0-95" class="i">+        }
</a><a href="#h14-0-96" id="h14-0-96" class="i">+
</a><a href="#h14-0-97" id="h14-0-97" class="i">+        //add config
</a><a href="#h14-0-98" id="h14-0-98" class="i">+        printLog(&quot;Adding config&quot;)
</a><a href="#h14-0-99" id="h14-0-99" class="i">+        dstZFile.add(&quot;assets/lspatch/config.json&quot;, ByteArrayInputStream(patchConfig.toByteArray()))
</a><a href="#h14-0-100" id="h14-0-100" class="i">+
</a><a href="#h14-0-101" id="h14-0-101" class="i">+
</a><a href="#h14-0-102" id="h14-0-102" class="i">+        // add loader dex
</a><a href="#h14-0-103" id="h14-0-103" class="i">+        printLog(&quot;Adding dex files&quot;)
</a><a href="#h14-0-104" id="h14-0-104" class="i">+        dstZFile.add(&quot;classes.dex&quot;, context.assets.open(&quot;lspatch/dexes/metaloader.dex&quot;))
</a><a href="#h14-0-105" id="h14-0-105" class="i">+        dstZFile.add(&quot;assets/lspatch/loader.dex&quot;, context.assets.open(&quot;lspatch/dexes/loader.dex&quot;))
</a><a href="#h14-0-106" id="h14-0-106" class="i">+
</a><a href="#h14-0-107" id="h14-0-107" class="i">+        //add natives
</a><a href="#h14-0-108" id="h14-0-108" class="i">+        printLog(&quot;Adding natives&quot;)
</a><a href="#h14-0-109" id="h14-0-109" class="i">+        context.assets.list(&quot;lspatch/so&quot;)?.forEach { native -&gt;
</a><a href="#h14-0-110" id="h14-0-110" class="i">+            dstZFile.add(&quot;assets/lspatch/so/$native/liblspatch.so&quot;, context.assets.open(&quot;lspatch/so/$native/liblspatch.so&quot;), false)
</a><a href="#h14-0-111" id="h14-0-111" class="i">+        }
</a><a href="#h14-0-112" id="h14-0-112" class="i">+
</a><a href="#h14-0-113" id="h14-0-113" class="i">+
</a><a href="#h14-0-114" id="h14-0-114" class="i">+        //embed modules
</a><a href="#h14-0-115" id="h14-0-115" class="i">+        printLog(&quot;embedding modules&quot;)
</a><a href="#h14-0-116" id="h14-0-116" class="i">+        modules.forEach { (packageName, module) -&gt;
</a><a href="#h14-0-117" id="h14-0-117" class="i">+            dstZFile.add(&quot;assets/lspatch/modules/$packageName.apk&quot;, module.inputStream())
</a><a href="#h14-0-118" id="h14-0-118" class="i">+        }
</a><a href="#h14-0-119" id="h14-0-119" class="i">+
</a><a href="#h14-0-120" id="h14-0-120" class="i">+
</a><a href="#h14-0-121" id="h14-0-121" class="i">+        // link apk entries
</a><a href="#h14-0-122" id="h14-0-122" class="i">+        printLog(&quot;Linking apk entries&quot;)
</a><a href="#h14-0-123" id="h14-0-123" class="i">+
</a><a href="#h14-0-124" id="h14-0-124" class="i">+        for (entry in sourceApkFile.entries()) {
</a><a href="#h14-0-125" id="h14-0-125" class="i">+            val name = entry.centralDirectoryHeader.name
</a><a href="#h14-0-126" id="h14-0-126" class="i">+            if (name.startsWith(&quot;classes&quot;) &amp;&amp; name.endsWith(&quot;.dex&quot;)) continue
</a><a href="#h14-0-127" id="h14-0-127" class="i">+            if (dstZFile[name] != null) continue
</a><a href="#h14-0-128" id="h14-0-128" class="i">+            if (name == &quot;AndroidManifest.xml&quot;) continue
</a><a href="#h14-0-129" id="h14-0-129" class="i">+            if (name.startsWith(&quot;META-INF&quot;) &amp;&amp; (name.endsWith(&quot;.SF&quot;) || name.endsWith(&quot;.MF&quot;) || name.endsWith(
</a><a href="#h14-0-130" id="h14-0-130" class="i">+                    &quot;.RSA&quot;
</a><a href="#h14-0-131" id="h14-0-131" class="i">+                ))
</a><a href="#h14-0-132" id="h14-0-132" class="i">+            ) continue
</a><a href="#h14-0-133" id="h14-0-133" class="i">+            sourceApkFile.addFileLink(name, name)
</a><a href="#h14-0-134" id="h14-0-134" class="i">+        }
</a><a href="#h14-0-135" id="h14-0-135" class="i">+
</a><a href="#h14-0-136" id="h14-0-136" class="i">+        dstZFile.realign()
</a><a href="#h14-0-137" id="h14-0-137" class="i">+        dstZFile.close()
</a><a href="#h14-0-138" id="h14-0-138" class="i">+        printLog(&quot;Done&quot;)
</a><a href="#h14-0-139" id="h14-0-139" class="i">+    }
</a><a href="#h14-0-140" id="h14-0-140" class="i">+
</a><a href="#h14-0-141" id="h14-0-141" class="i">+    fun patch(input: File, outputFile: File) {
</a><a href="#h14-0-142" id="h14-0-142" class="i">+        //check if input apk is already patched
</a><a href="#h14-0-143" id="h14-0-143" class="i">+        var isAlreadyPatched = false
</a><a href="#h14-0-144" id="h14-0-144" class="i">+        var inputFile = input
</a><a href="#h14-0-145" id="h14-0-145" class="i">+
</a><a href="#h14-0-146" id="h14-0-146" class="i">+        // extract origin
</a><a href="#h14-0-147" id="h14-0-147" class="i">+        printLog(&quot;Extracting origin apk&quot;)
</a><a href="#h14-0-148" id="h14-0-148" class="i">+        ZipFile(input).use { zipFile -&gt;
</a><a href="#h14-0-149" id="h14-0-149" class="i">+            zipFile.getEntry(&quot;assets/lspatch/origin.apk&quot;)?.apply {
</a><a href="#h14-0-150" id="h14-0-150" class="i">+                inputFile = File.createTempFile(&quot;origin&quot;, &quot;.apk&quot;)
</a><a href="#h14-0-151" id="h14-0-151" class="i">+                inputFile.outputStream().use {
</a><a href="#h14-0-152" id="h14-0-152" class="i">+                    zipFile.getInputStream(this).copyTo(it)
</a><a href="#h14-0-153" id="h14-0-153" class="i">+                }
</a><a href="#h14-0-154" id="h14-0-154" class="i">+                isAlreadyPatched = true
</a><a href="#h14-0-155" id="h14-0-155" class="i">+            }
</a><a href="#h14-0-156" id="h14-0-156" class="i">+        }
</a><a href="#h14-0-157" id="h14-0-157" class="i">+
</a><a href="#h14-0-158" id="h14-0-158" class="i">+        if (outputFile.exists()) outputFile.delete()
</a><a href="#h14-0-159" id="h14-0-159" class="i">+
</a><a href="#h14-0-160" id="h14-0-160" class="i">+        printLog(&quot;Patching apk&quot;)
</a><a href="#h14-0-161" id="h14-0-161" class="i">+        runCatching {
</a><a href="#h14-0-162" id="h14-0-162" class="i">+            patchApk(inputFile, outputFile)
</a><a href="#h14-0-163" id="h14-0-163" class="i">+        }.onFailure {
</a><a href="#h14-0-164" id="h14-0-164" class="i">+            if (isAlreadyPatched) {
</a><a href="#h14-0-165" id="h14-0-165" class="i">+                inputFile.delete()
</a><a href="#h14-0-166" id="h14-0-166" class="i">+            }
</a><a href="#h14-0-167" id="h14-0-167" class="i">+            outputFile.delete()
</a><a href="#h14-0-168" id="h14-0-168" class="i">+            printLog(&quot;Failed to patch&quot;)
</a><a href="#h14-0-169" id="h14-0-169" class="i">+            printLog(it)
</a><a href="#h14-0-170" id="h14-0-170" class="i">+        }.onSuccess {
</a><a href="#h14-0-171" id="h14-0-171" class="i">+            outputFile.delete()
</a><a href="#h14-0-172" id="h14-0-172" class="i">+        }
</a><a href="#h14-0-173" id="h14-0-173" class="i">+    }
</a><a href="#h14-0-174" id="h14-0-174" class="i">+}</a><a href="#h14-0-175" id="h14-0-175" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/Constants.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/Constants.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/Constants.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/Constants.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,8 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+package me.rhunk.snapenhance.manager.lspatch.config
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+//https://github.com/LSPosed/LSPatch/blob/master/share/java/src/main/java/org/lsposed/lspatch/share/Constants.java
</a><a href="#h15-0-3" id="h15-0-3" class="i">+object Constants {
</a><a href="#h15-0-4" id="h15-0-4" class="i">+    const val ORIGINAL_APK_ASSET_PATH = &quot;assets/lspatch/origin.apk&quot;
</a><a href="#h15-0-5" id="h15-0-5" class="i">+    const val PROXY_APP_COMPONENT_FACTORY =
</a><a href="#h15-0-6" id="h15-0-6" class="i">+        &quot;org.lsposed.lspatch.metaloader.LSPAppComponentFactoryStub&quot;
</a><a href="#h15-0-7" id="h15-0-7" class="i">+}</a><a href="#h15-0-8" id="h15-0-8" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/PatchConfig.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/PatchConfig.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/PatchConfig.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/config/PatchConfig.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -0,0 +1,19 @@
</a><a href="#h16-0-0" id="h16-0-0" class="i">+package me.rhunk.snapenhance.manager.lspatch.config
</a><a href="#h16-0-1" id="h16-0-1" class="i">+
</a><a href="#h16-0-2" id="h16-0-2" class="i">+data class PatchConfig(
</a><a href="#h16-0-3" id="h16-0-3" class="i">+    val useManager: Boolean = false,
</a><a href="#h16-0-4" id="h16-0-4" class="i">+    val debuggable: Boolean = false,
</a><a href="#h16-0-5" id="h16-0-5" class="i">+    val overrideVersionCode: Boolean = false,
</a><a href="#h16-0-6" id="h16-0-6" class="i">+    val sigBypassLevel: Int = 0,
</a><a href="#h16-0-7" id="h16-0-7" class="i">+    val originalSignature: String? = null,
</a><a href="#h16-0-8" id="h16-0-8" class="i">+    val appComponentFactory: String? = null,
</a><a href="#h16-0-9" id="h16-0-9" class="i">+    val lspConfig: LSPConfig? = LSPConfig()
</a><a href="#h16-0-10" id="h16-0-10" class="i">+) {
</a><a href="#h16-0-11" id="h16-0-11" class="i">+    data class LSPConfig(
</a><a href="#h16-0-12" id="h16-0-12" class="i">+        var API_CODE: Int = 93,
</a><a href="#h16-0-13" id="h16-0-13" class="i">+        var VERSION_CODE: Int = 360,
</a><a href="#h16-0-14" id="h16-0-14" class="i">+        var VERSION_NAME: String = &quot;0.5.1&quot;,
</a><a href="#h16-0-15" id="h16-0-15" class="i">+        var CORE_VERSION_CODE: Int = 6649,
</a><a href="#h16-0-16" id="h16-0-16" class="i">+        var CORE_VERSION_NAME: String = &quot;1.8.5&quot;,
</a><a href="#h16-0-17" id="h16-0-17" class="i">+    )
</a><a href="#h16-0-18" id="h16-0-18" class="i">+}</a><a href="#h16-0-19" id="h16-0-19" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h17" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/util/ApkSignatureHelper.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/util/ApkSignatureHelper.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/util/ApkSignatureHelper.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/lspatch/util/ApkSignatureHelper.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -0,0 +1,146 @@
</a><a href="#h17-0-0" id="h17-0-0" class="i">+package me.rhunk.snapenhance.manager.lspatch.util;
</a><a href="#h17-0-1" id="h17-0-1" class="i">+
</a><a href="#h17-0-2" id="h17-0-2" class="i">+import java.io.IOException
</a><a href="#h17-0-3" id="h17-0-3" class="i">+import java.io.RandomAccessFile
</a><a href="#h17-0-4" id="h17-0-4" class="i">+import java.io.UnsupportedEncodingException
</a><a href="#h17-0-5" id="h17-0-5" class="i">+import java.nio.ByteBuffer
</a><a href="#h17-0-6" id="h17-0-6" class="i">+import java.nio.ByteOrder
</a><a href="#h17-0-7" id="h17-0-7" class="i">+import java.security.cert.Certificate
</a><a href="#h17-0-8" id="h17-0-8" class="i">+import java.util.Enumeration
</a><a href="#h17-0-9" id="h17-0-9" class="i">+import java.util.jar.JarEntry
</a><a href="#h17-0-10" id="h17-0-10" class="i">+import java.util.jar.JarFile
</a><a href="#h17-0-11" id="h17-0-11" class="i">+
</a><a href="#h17-0-12" id="h17-0-12" class="i">+
</a><a href="#h17-0-13" id="h17-0-13" class="i">+//https://github.com/LSPosed/LSPatch/blob/master/patch/src/main/java/org/lsposed/patch/util/ApkSignatureHelper.java
</a><a href="#h17-0-14" id="h17-0-14" class="i">+object ApkSignatureHelper {
</a><a href="#h17-0-15" id="h17-0-15" class="i">+    private val APK_V2_MAGIC = charArrayOf(&#39;A&#39;, &#39;P&#39;, &#39;K&#39;, &#39; &#39;, &#39;S&#39;, &#39;i&#39;, &#39;g&#39;, &#39; &#39;,
</a><a href="#h17-0-16" id="h17-0-16" class="i">+        &#39;B&#39;, &#39;l&#39;, &#39;o&#39;, &#39;c&#39;, &#39;k&#39;, &#39; &#39;, &#39;4&#39;, &#39;2&#39;)
</a><a href="#h17-0-17" id="h17-0-17" class="i">+
</a><a href="#h17-0-18" id="h17-0-18" class="i">+    private fun toChars(mSignature: ByteArray): CharArray {
</a><a href="#h17-0-19" id="h17-0-19" class="i">+        val N = mSignature.size
</a><a href="#h17-0-20" id="h17-0-20" class="i">+        val N2 = N * 2
</a><a href="#h17-0-21" id="h17-0-21" class="i">+        val text = CharArray(N2)
</a><a href="#h17-0-22" id="h17-0-22" class="i">+        for (j in 0 until N) {
</a><a href="#h17-0-23" id="h17-0-23" class="i">+            val v = mSignature[j]
</a><a href="#h17-0-24" id="h17-0-24" class="i">+            var d = v.toInt() shr 4 and 0xf
</a><a href="#h17-0-25" id="h17-0-25" class="i">+            text[j * 2] = (if (d &gt;= 10) &#39;a&#39;.code + d - 10 else &#39;0&#39;.code + d).toChar()
</a><a href="#h17-0-26" id="h17-0-26" class="i">+            d = v.toInt() and 0xf
</a><a href="#h17-0-27" id="h17-0-27" class="i">+            text[j * 2 + 1] = (if (d &gt;= 10) &#39;a&#39;.code + d - 10 else &#39;0&#39;.code + d).toChar()
</a><a href="#h17-0-28" id="h17-0-28" class="i">+        }
</a><a href="#h17-0-29" id="h17-0-29" class="i">+        return text
</a><a href="#h17-0-30" id="h17-0-30" class="i">+    }
</a><a href="#h17-0-31" id="h17-0-31" class="i">+
</a><a href="#h17-0-32" id="h17-0-32" class="i">+    private fun loadCertificates(
</a><a href="#h17-0-33" id="h17-0-33" class="i">+        jarFile: JarFile,
</a><a href="#h17-0-34" id="h17-0-34" class="i">+        je: JarEntry?,
</a><a href="#h17-0-35" id="h17-0-35" class="i">+        readBuffer: ByteArray
</a><a href="#h17-0-36" id="h17-0-36" class="i">+    ): Array&lt;Certificate?&gt;? {
</a><a href="#h17-0-37" id="h17-0-37" class="i">+        try {
</a><a href="#h17-0-38" id="h17-0-38" class="i">+            val `is` = jarFile.getInputStream(je)
</a><a href="#h17-0-39" id="h17-0-39" class="i">+            while (`is`.read(readBuffer, 0, readBuffer.size) != -1) {
</a><a href="#h17-0-40" id="h17-0-40" class="i">+            }
</a><a href="#h17-0-41" id="h17-0-41" class="i">+            `is`.close()
</a><a href="#h17-0-42" id="h17-0-42" class="i">+            return je?.certificates as Array&lt;Certificate?&gt;?
</a><a href="#h17-0-43" id="h17-0-43" class="i">+        } catch (e: Exception) {
</a><a href="#h17-0-44" id="h17-0-44" class="i">+        }
</a><a href="#h17-0-45" id="h17-0-45" class="i">+        return null
</a><a href="#h17-0-46" id="h17-0-46" class="i">+    }
</a><a href="#h17-0-47" id="h17-0-47" class="i">+
</a><a href="#h17-0-48" id="h17-0-48" class="i">+    fun getApkSignInfo(apkFilePath: String): String? {
</a><a href="#h17-0-49" id="h17-0-49" class="i">+        return try {
</a><a href="#h17-0-50" id="h17-0-50" class="i">+            getApkSignV2(apkFilePath)
</a><a href="#h17-0-51" id="h17-0-51" class="i">+        } catch (e: Exception) {
</a><a href="#h17-0-52" id="h17-0-52" class="i">+            getApkSignV1(apkFilePath)
</a><a href="#h17-0-53" id="h17-0-53" class="i">+        }
</a><a href="#h17-0-54" id="h17-0-54" class="i">+    }
</a><a href="#h17-0-55" id="h17-0-55" class="i">+
</a><a href="#h17-0-56" id="h17-0-56" class="i">+    fun getApkSignV1(apkFilePath: String?): String? {
</a><a href="#h17-0-57" id="h17-0-57" class="i">+        val readBuffer = ByteArray(8192)
</a><a href="#h17-0-58" id="h17-0-58" class="i">+        var certs: Array&lt;Certificate?&gt;? = null
</a><a href="#h17-0-59" id="h17-0-59" class="i">+        try {
</a><a href="#h17-0-60" id="h17-0-60" class="i">+            val jarFile = JarFile(apkFilePath)
</a><a href="#h17-0-61" id="h17-0-61" class="i">+            val entries: Enumeration&lt;*&gt; = jarFile.entries()
</a><a href="#h17-0-62" id="h17-0-62" class="i">+            while (entries.hasMoreElements()) {
</a><a href="#h17-0-63" id="h17-0-63" class="i">+                val je = entries.nextElement() as JarEntry
</a><a href="#h17-0-64" id="h17-0-64" class="i">+                if (je.isDirectory) {
</a><a href="#h17-0-65" id="h17-0-65" class="i">+                    continue
</a><a href="#h17-0-66" id="h17-0-66" class="i">+                }
</a><a href="#h17-0-67" id="h17-0-67" class="i">+                if (je.name.startsWith(&quot;META-INF/&quot;)) {
</a><a href="#h17-0-68" id="h17-0-68" class="i">+                    continue
</a><a href="#h17-0-69" id="h17-0-69" class="i">+                }
</a><a href="#h17-0-70" id="h17-0-70" class="i">+                val localCerts = loadCertificates(jarFile, je, readBuffer)
</a><a href="#h17-0-71" id="h17-0-71" class="i">+                if (certs == null) {
</a><a href="#h17-0-72" id="h17-0-72" class="i">+                    certs = localCerts
</a><a href="#h17-0-73" id="h17-0-73" class="i">+                } else {
</a><a href="#h17-0-74" id="h17-0-74" class="i">+                    for (i in certs.indices) {
</a><a href="#h17-0-75" id="h17-0-75" class="i">+                        var found = false
</a><a href="#h17-0-76" id="h17-0-76" class="i">+                        for (j in localCerts!!.indices) {
</a><a href="#h17-0-77" id="h17-0-77" class="i">+                            if (certs[i] != null &amp;&amp; certs[i] == localCerts[j]) {
</a><a href="#h17-0-78" id="h17-0-78" class="i">+                                found = true
</a><a href="#h17-0-79" id="h17-0-79" class="i">+                                break
</a><a href="#h17-0-80" id="h17-0-80" class="i">+                            }
</a><a href="#h17-0-81" id="h17-0-81" class="i">+                        }
</a><a href="#h17-0-82" id="h17-0-82" class="i">+                        if (!found || certs.size != localCerts.size) {
</a><a href="#h17-0-83" id="h17-0-83" class="i">+                            jarFile.close()
</a><a href="#h17-0-84" id="h17-0-84" class="i">+                            return null
</a><a href="#h17-0-85" id="h17-0-85" class="i">+                        }
</a><a href="#h17-0-86" id="h17-0-86" class="i">+                    }
</a><a href="#h17-0-87" id="h17-0-87" class="i">+                }
</a><a href="#h17-0-88" id="h17-0-88" class="i">+            }
</a><a href="#h17-0-89" id="h17-0-89" class="i">+            jarFile.close()
</a><a href="#h17-0-90" id="h17-0-90" class="i">+            return if (certs != null) String(toChars(certs[0]!!.encoded)) else null
</a><a href="#h17-0-91" id="h17-0-91" class="i">+        } catch (ignored: Throwable) {
</a><a href="#h17-0-92" id="h17-0-92" class="i">+        }
</a><a href="#h17-0-93" id="h17-0-93" class="i">+        return null
</a><a href="#h17-0-94" id="h17-0-94" class="i">+    }
</a><a href="#h17-0-95" id="h17-0-95" class="i">+
</a><a href="#h17-0-96" id="h17-0-96" class="i">+    @Throws(IOException::class)
</a><a href="#h17-0-97" id="h17-0-97" class="i">+    private fun getApkSignV2(apkFilePath: String): String {
</a><a href="#h17-0-98" id="h17-0-98" class="i">+        RandomAccessFile(apkFilePath, &quot;r&quot;).use { apk -&gt;
</a><a href="#h17-0-99" id="h17-0-99" class="i">+            val buffer = ByteBuffer.allocate(0x10)
</a><a href="#h17-0-100" id="h17-0-100" class="i">+            buffer.order(ByteOrder.LITTLE_ENDIAN)
</a><a href="#h17-0-101" id="h17-0-101" class="i">+            apk.seek(apk.length() - 0x6)
</a><a href="#h17-0-102" id="h17-0-102" class="i">+            apk.readFully(buffer.array(), 0x0, 0x6)
</a><a href="#h17-0-103" id="h17-0-103" class="i">+            val offset = buffer.getInt()
</a><a href="#h17-0-104" id="h17-0-104" class="i">+            if (buffer.getShort().toInt() != 0) {
</a><a href="#h17-0-105" id="h17-0-105" class="i">+                throw UnsupportedEncodingException(&quot;no zip&quot;)
</a><a href="#h17-0-106" id="h17-0-106" class="i">+            }
</a><a href="#h17-0-107" id="h17-0-107" class="i">+            apk.seek((offset - 0x10).toLong())
</a><a href="#h17-0-108" id="h17-0-108" class="i">+            apk.readFully(buffer.array(), 0x0, 0x10)
</a><a href="#h17-0-109" id="h17-0-109" class="i">+            if (!buffer.array().contentEquals(APK_V2_MAGIC.map { it.code.toByte() }.toByteArray())) {
</a><a href="#h17-0-110" id="h17-0-110" class="i">+                throw UnsupportedEncodingException(&quot;no apk v2&quot;)
</a><a href="#h17-0-111" id="h17-0-111" class="i">+            }
</a><a href="#h17-0-112" id="h17-0-112" class="i">+
</a><a href="#h17-0-113" id="h17-0-113" class="i">+            // Read and compare size fields
</a><a href="#h17-0-114" id="h17-0-114" class="i">+            apk.seek((offset - 0x18).toLong())
</a><a href="#h17-0-115" id="h17-0-115" class="i">+            apk.readFully(buffer.array(), 0x0, 0x8)
</a><a href="#h17-0-116" id="h17-0-116" class="i">+            buffer.rewind()
</a><a href="#h17-0-117" id="h17-0-117" class="i">+            var size = buffer.getLong().toInt()
</a><a href="#h17-0-118" id="h17-0-118" class="i">+            val block = ByteBuffer.allocate(size + 0x8)
</a><a href="#h17-0-119" id="h17-0-119" class="i">+            block.order(ByteOrder.LITTLE_ENDIAN)
</a><a href="#h17-0-120" id="h17-0-120" class="i">+            apk.seek((offset - block.capacity()).toLong())
</a><a href="#h17-0-121" id="h17-0-121" class="i">+            apk.readFully(block.array(), 0x0, block.capacity())
</a><a href="#h17-0-122" id="h17-0-122" class="i">+            if (size.toLong() != block.getLong()) {
</a><a href="#h17-0-123" id="h17-0-123" class="i">+                throw UnsupportedEncodingException(&quot;no apk v2&quot;)
</a><a href="#h17-0-124" id="h17-0-124" class="i">+            }
</a><a href="#h17-0-125" id="h17-0-125" class="i">+            while (block.remaining() &gt; 24) {
</a><a href="#h17-0-126" id="h17-0-126" class="i">+                size = block.getLong().toInt()
</a><a href="#h17-0-127" id="h17-0-127" class="i">+                if (block.getInt() == 0x7109871a) {
</a><a href="#h17-0-128" id="h17-0-128" class="i">+                    // signer-sequence length, signer length, signed data length
</a><a href="#h17-0-129" id="h17-0-129" class="i">+                    block.position(block.position() + 12)
</a><a href="#h17-0-130" id="h17-0-130" class="i">+                    size = block.getInt() // digests-sequence length
</a><a href="#h17-0-131" id="h17-0-131" class="i">+
</a><a href="#h17-0-132" id="h17-0-132" class="i">+                    // digests, certificates length
</a><a href="#h17-0-133" id="h17-0-133" class="i">+                    block.position(block.position() + size + 0x4)
</a><a href="#h17-0-134" id="h17-0-134" class="i">+                    size = block.getInt() // certificate length
</a><a href="#h17-0-135" id="h17-0-135" class="i">+                    break
</a><a href="#h17-0-136" id="h17-0-136" class="i">+                } else {
</a><a href="#h17-0-137" id="h17-0-137" class="i">+                    block.position(block.position() + size - 0x4)
</a><a href="#h17-0-138" id="h17-0-138" class="i">+                }
</a><a href="#h17-0-139" id="h17-0-139" class="i">+            }
</a><a href="#h17-0-140" id="h17-0-140" class="i">+            val certificate = ByteArray(size)
</a><a href="#h17-0-141" id="h17-0-141" class="i">+            block[certificate]
</a><a href="#h17-0-142" id="h17-0-142" class="i">+            return String(toChars(certificate))
</a><a href="#h17-0-143" id="h17-0-143" class="i">+        }
</a><a href="#h17-0-144" id="h17-0-144" class="i">+    }
</a><a href="#h17-0-145" id="h17-0-145" class="i">+}</a><a href="#h17-0-146" id="h17-0-146" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/settings.gradle.kts.html">settings.gradle.kts</a> b/<a href="../file/settings.gradle.kts.html">settings.gradle.kts</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -21,4 +21,5 @@ include(&quot;:common&quot;)
</a> include(&quot;:core&quot;)
 include(&quot;:app&quot;)
 include(&quot;:mapper&quot;)
<a href="#h18-0-3" id="h18-0-3" class="d">-include(&quot;:native&quot;)</a><a href="#h18-0-4" id="h18-0-4" class="d">-
\ No newline at end of file
</a><a href="#h18-0-5" id="h18-0-5" class="i">+include(&quot;:native&quot;)
</a><a href="#h18-0-6" id="h18-0-6" class="i">+include(&quot;:manager&quot;)</a><a href="#h18-0-7" id="h18-0-7" class="i">+
\ No newline at end of file
</a></pre>
</div>
</body>
</html>
