<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: rust native - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/28d1ea2a431d3b776218621d93f3d686b24f9134.html">28d1ea2a431d3b776218621d93f3d686b24f9134</a>
<b>parent</b> <a href="../commit/17ddfa5b9c95804616fabd14062e40ae7885971a.html">17ddfa5b9c95804616fabd14062e40ae7885971a</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Fri, 26 Jul 2024 01:54:43 +0200

feat: rust native

Signed-off-by: rhunk &lt;101876869+rhunk@users.noreply.github.com&gt;

<b>Diffstat:</b>
<table><tr><td class="D">D</td><td><a href="#h0">.gitmodules</a></td><td> | </td><td class="num">3</td><td><span class="i"></span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">build.gradle.kts</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">common/build.gradle.kts</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/MappingsWrapper.kt</a></td><td> | </td><td class="num">7</td><td><span class="i">++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">gradle/libs.versions.toml</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">native/.gitignore</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">native/build.gradle.kts</a></td><td> | </td><td class="num">65</td><td><span class="i">+++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h9">native/jni/CMakeLists.txt</a></td><td> | </td><td class="num">27</td><td><span class="i"></span><span class="d">---------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h10">native/jni/external/dobby</a></td><td> | </td><td class="num">1</td><td><span class="i"></span><span class="d">-</span></td></tr>
<tr><td class="D">D</td><td><a href="#h11">native/jni/src/common.h</a></td><td> | </td><td class="num">25</td><td><span class="i"></span><span class="d">-------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h12">native/jni/src/dobby_helper.h</a></td><td> | </td><td class="num">14</td><td><span class="i"></span><span class="d">--------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h13">native/jni/src/hooks/composer_hook.h</a></td><td> | </td><td class="num">190</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h14">native/jni/src/hooks/custom_emoji_font.h</a></td><td> | </td><td class="num">21</td><td><span class="i"></span><span class="d">---------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h15">native/jni/src/hooks/duplex_hook.h</a></td><td> | </td><td class="num">27</td><td><span class="i"></span><span class="d">---------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h16">native/jni/src/hooks/fstat_hook.h</a></td><td> | </td><td class="num">28</td><td><span class="i"></span><span class="d">----------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h17">native/jni/src/hooks/linker_hook.h</a></td><td> | </td><td class="num">55</td><td><span class="i"></span><span class="d">-------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h18">native/jni/src/hooks/sqlite_mutex.h</a></td><td> | </td><td class="num">47</td><td><span class="i"></span><span class="d">-----------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h19">native/jni/src/hooks/unary_call.h</a></td><td> | </td><td class="num">88</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h20">native/jni/src/library.cpp</a></td><td> | </td><td class="num">115</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h21">native/jni/src/logger.h</a></td><td> | </td><td class="num">9</td><td><span class="i"></span><span class="d">---------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h22">native/jni/src/util.h</a></td><td> | </td><td class="num">84</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h23">native/rust/Cargo.lock</a></td><td> | </td><td class="num">724</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h24">native/rust/Cargo.toml</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h25">native/rust/build.rs</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h26">native/rust/src/common.rs</a></td><td> | </td><td class="num">50</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h27">native/rust/src/config.rs</a></td><td> | </td><td class="num">55</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h28">native/rust/src/hook.rs</a></td><td> | </td><td class="num">50</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h29">native/rust/src/lib.rs</a></td><td> | </td><td class="num">146</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h30">native/rust/src/mapped_lib.rs</a></td><td> | </td><td class="num">49</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h31">native/rust/src/modules/composer_hook.rs</a></td><td> | </td><td class="num">184</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h32">native/rust/src/modules/custom_font_hook.rs</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h33">native/rust/src/modules/duplex_hook.rs</a></td><td> | </td><td class="num">42</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h34">native/rust/src/modules/fstat_hook.rs</a></td><td> | </td><td class="num">38</td><td><span class="i">++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h35">native/rust/src/modules/linker_hook.rs</a></td><td> | </td><td class="num">60</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h36">native/rust/src/modules/mod.rs</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h37">native/rust/src/modules/sqlite_hook.rs</a></td><td> | </td><td class="num">82</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h38">native/rust/src/modules/unary_call_hook.rs</a></td><td> | </td><td class="num">124</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h39">native/rust/src/sig.rs</a></td><td> | </td><td class="num">100</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h40">native/rust/src/util.rs</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h41">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">+++</span><span class="d">-----</span></td></tr>
</table></pre><pre>42 files changed, 1813 insertions(+), 774 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/.gitmodules.html">.gitmodules</a> b/<a href="../file/.gitmodules.html">.gitmodules</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,3 +0,0 @@
</a><a href="#h0-0-0" id="h0-0-0" class="d">-[submodule &quot;dobby&quot;]
</a><a href="#h0-0-1" id="h0-0-1" class="d">-	path = native/jni/external/dobby
</a><a href="#h0-0-2" id="h0-0-2" class="d">-	url = https://github.com/jmpews/Dobby
</a><b>diff --git a/<a id="h1" href="../file/build.gradle.kts.html">build.gradle.kts</a> b/<a href="../file/build.gradle.kts.html">build.gradle.kts</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -4,6 +4,7 @@ plugins {
</a>     alias(libs.plugins.androidLibrary) apply false
     alias(libs.plugins.kotlinAndroid) apply false
     alias(libs.plugins.compose.compiler) apply false
<a href="#h1-0-3" id="h1-0-3" class="i">+    alias(libs.plugins.rust.android) apply false
</a> }
 
 var versionName = &quot;2.1.0&quot;
<a href="#h1-1" id="h1-1" class="h">@@ -12,7 +13,7 @@ var versionCode = 210
</a> rootProject.ext.set(&quot;appVersionName&quot;, versionName)
 rootProject.ext.set(&quot;appVersionCode&quot;, versionCode)
 rootProject.ext.set(&quot;applicationId&quot;, &quot;me.rhunk.snapenhance&quot;)
<a href="#h1-1-3" id="h1-1-3" class="d">-rootProject.ext.set(&quot;buildHash&quot;, properties[&quot;debug_build_hash&quot;] ?: java.security.SecureRandom().nextLong(1000000000, 99999999999).toString(16))
</a><a href="#h1-1-4" id="h1-1-4" class="i">+rootProject.ext.set(&quot;buildHash&quot;, properties[&quot;debug_build_hash&quot;] ?: java.security.SecureRandom().nextLong(Long.MAX_VALUE / 1000L, Long.MAX_VALUE).toString(16))
</a> 
 tasks.register(&quot;getVersion&quot;) {
     doLast {
<b>diff --git a/<a id="h2" href="../file/common/build.gradle.kts.html">common/build.gradle.kts</a> b/<a href="../file/common/build.gradle.kts.html">common/build.gradle.kts</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -23,7 +23,7 @@ android {
</a>         buildConfigField(&quot;int&quot;, &quot;VERSION_CODE&quot;, &quot;${rootProject.ext[&quot;appVersionCode&quot;]}&quot;)
         buildConfigField(&quot;String&quot;, &quot;APPLICATION_ID&quot;, &quot;\&quot;${rootProject.ext[&quot;applicationId&quot;]}\&quot;&quot;)
         buildConfigField(&quot;long&quot;, &quot;BUILD_TIMESTAMP&quot;, &quot;${System.currentTimeMillis()}L&quot;)
<a href="#h2-0-3" id="h2-0-3" class="d">-        buildConfigField(&quot;String&quot;, &quot;BUILD_HASH&quot;, &quot;\&quot;${rootProject.ext[&quot;buildHash&quot;]}\&quot;&quot;)
</a><a href="#h2-0-4" id="h2-0-4" class="i">+        buildConfigField(&quot;String&quot;, &quot;BUILD_HASH&quot;, &quot;\&quot;${rootProject.ext[&quot;buildHash&quot;]}\&quot;.toString()&quot;)
</a>         val gitHash = ByteArrayOutputStream()
         exec {
             commandLine(&quot;git&quot;, &quot;rev-parse&quot;, &quot;HEAD&quot;)
<b>diff --git a/<a id="h3" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -33,6 +33,7 @@ enum class InternalFileHandleType(
</a>     MAPPINGS(&quot;mappings&quot;, &quot;mappings.json&quot;),
     MESSAGE_LOGGER(&quot;message_logger&quot;, &quot;message_logger.db&quot;, isDatabase = true),
     PINNED_BEST_FRIEND(&quot;pinned_best_friend&quot;, &quot;pinned_best_friend.txt&quot;),
<a href="#h3-0-3" id="h3-0-3" class="i">+    NATIVE_SIG_CACHE(&quot;native_sig_cache&quot;, &quot;native_sig_cache.txt&quot;),
</a>     SIF(&quot;sif&quot;, &quot;libsif.so&quot;);
 
     fun resolve(context: Context): File = if (isDatabase) {
<b>diff --git a/<a id="h4" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/MappingsWrapper.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/MappingsWrapper.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/MappingsWrapper.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/MappingsWrapper.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -6,6 +6,7 @@ import kotlinx.coroutines.runBlocking
</a> import me.rhunk.snapenhance.bridge.storage.FileHandleManager
 import me.rhunk.snapenhance.common.BuildConfig
 import me.rhunk.snapenhance.common.Constants
<a href="#h4-0-3" id="h4-0-3" class="i">+import me.rhunk.snapenhance.common.bridge.FileHandleScope
</a> import me.rhunk.snapenhance.common.bridge.InternalFileHandleType
 import me.rhunk.snapenhance.common.bridge.InternalFileWrapper
 import me.rhunk.snapenhance.common.logger.AbstractLogger
<a href="#h4-1" id="h4-1" class="h">@@ -15,7 +16,7 @@ import me.rhunk.snapenhance.mapper.ClassMapper
</a> import kotlin.reflect.KClass
 
 class MappingsWrapper(
<a href="#h4-1-3" id="h4-1-3" class="d">-    fileHandleManager: LazyBridgeValue&lt;FileHandleManager&gt;
</a><a href="#h4-1-4" id="h4-1-4" class="i">+    private val fileHandleManager: LazyBridgeValue&lt;FileHandleManager&gt;
</a> ): InternalFileWrapper(fileHandleManager, InternalFileHandleType.MAPPINGS, defaultValue = &quot;{}&quot;) {
     private lateinit var context: Context
     private var mappingUniqueHash: Long = 0
<a href="#h4-2" id="h4-2" class="h">@@ -68,6 +69,10 @@ class MappingsWrapper(
</a> 
     fun refresh() {
         mappingUniqueHash = getUniqueBuildId()
<a href="#h4-2-3" id="h4-2-3" class="i">+
</a><a href="#h4-2-4" id="h4-2-4" class="i">+        // reset native signature cache
</a><a href="#h4-2-5" id="h4-2-5" class="i">+        fileHandleManager.value.getFileHandle(FileHandleScope.INTERNAL.key, InternalFileHandleType.NATIVE_SIG_CACHE.key).delete()
</a><a href="#h4-2-6" id="h4-2-6" class="i">+
</a>         val classMapper = ClassMapper(*mappers.values.toTypedArray())
 
         runCatching {
<b>diff --git a/<a id="h5" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -193,6 +193,16 @@ class SnapEnhance {
</a>     }
 
     private fun initNative() {
<a href="#h5-0-3" id="h5-0-3" class="i">+        val nativeSigCacheFileHandle = appContext.fileHandlerManager.getFileHandle(FileHandleScope.INTERNAL.key, InternalFileHandleType.NATIVE_SIG_CACHE.key).toWrapper()
</a><a href="#h5-0-4" id="h5-0-4" class="i">+
</a><a href="#h5-0-5" id="h5-0-5" class="i">+        val oldSignatureCache = nativeSigCacheFileHandle.readBytes()
</a><a href="#h5-0-6" id="h5-0-6" class="i">+            .takeIf {
</a><a href="#h5-0-7" id="h5-0-7" class="i">+                it.isNotEmpty()
</a><a href="#h5-0-8" id="h5-0-8" class="i">+            }?.toString(Charsets.UTF_8)?.also {
</a><a href="#h5-0-9" id="h5-0-9" class="i">+                appContext.native.signatureCache = it
</a><a href="#h5-0-10" id="h5-0-10" class="i">+                appContext.log.verbose(&quot;old signature cache $it&quot;)
</a><a href="#h5-0-11" id="h5-0-11" class="i">+            }
</a><a href="#h5-0-12" id="h5-0-12" class="i">+
</a>         val lateInit = appContext.native.initOnce {
             nativeUnaryCallCallback = { request -&gt;
                 appContext.event.post(NativeUnaryCallEvent(request.uri, request.buffer)) {
<a href="#h5-1" id="h5-1" class="h">@@ -201,6 +211,14 @@ class SnapEnhance {
</a>                 }
             }
             appContext.reloadNativeConfig()
<a href="#h5-1-3" id="h5-1-3" class="i">+        }.let { init -&gt;
</a><a href="#h5-1-4" id="h5-1-4" class="i">+            {
</a><a href="#h5-1-5" id="h5-1-5" class="i">+                init()
</a><a href="#h5-1-6" id="h5-1-6" class="i">+                appContext.native.signatureCache.takeIf { it != oldSignatureCache }?.let {
</a><a href="#h5-1-7" id="h5-1-7" class="i">+                    appContext.log.verbose(&quot;new signature cache $it&quot;)
</a><a href="#h5-1-8" id="h5-1-8" class="i">+                    nativeSigCacheFileHandle.writeBytes(it.toByteArray(Charsets.UTF_8))
</a><a href="#h5-1-9" id="h5-1-9" class="i">+                }
</a><a href="#h5-1-10" id="h5-1-10" class="i">+            }
</a>         }
 
         if (appContext.bridgeClient.getDebugProp(&quot;disable_sif&quot;, &quot;false&quot;) != &quot;true&quot;) {
<b>diff --git a/<a id="h6" href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a> b/<a href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -23,6 +23,7 @@ material3 = &quot;1.2.1&quot;
</a> okhttp = &quot;5.0.0-alpha.14&quot;
 rhino = &quot;1.7.15&quot;
 rhino-android = &quot;1.6.0&quot;
<a href="#h6-0-3" id="h6-0-3" class="i">+rust-android = &quot;0.9.4&quot;
</a> 
 [libraries]
 androidx-compose-bom = { group = &quot;androidx.compose&quot;, name = &quot;compose-bom&quot;, version.ref = &quot;compose-bom&quot; }
<a href="#h6-1" id="h6-1" class="h">@@ -59,5 +60,6 @@ androidApplication = { id = &quot;com.android.application&quot;, version.ref = &quot;agp&quot; }
</a> androidLibrary = { id = &quot;com.android.library&quot;, version.ref = &quot;agp&quot; }
 kotlinAndroid = { id = &quot;org.jetbrains.kotlin.android&quot;, version.ref = &quot;kotlin&quot; }
 compose-compiler = { id = &quot;org.jetbrains.kotlin.plugin.compose&quot;, version.ref = &quot;compose-compiler&quot; }
<a href="#h6-1-3" id="h6-1-3" class="i">+rust-android = { id = &quot;org.mozilla.rust-android-gradle.rust-android&quot;, version.ref = &quot;rust-android&quot; }
</a> 
 [bundles] 
\ No newline at end of file
<b>diff --git a/<a id="h7" href="../file/native/.gitignore.html">native/.gitignore</a> b/<a href="../file/native/.gitignore.html">native/.gitignore</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,2 +1,3 @@
</a> /build
<a href="#h7-0-1" id="h7-0-1" class="d">-/.cxx</a><a href="#h7-0-2" id="h7-0-2" class="d">-
\ No newline at end of file
</a><a href="#h7-0-3" id="h7-0-3" class="i">+/.cxx
</a><a href="#h7-0-4" id="h7-0-4" class="i">+/rust/target</a><a href="#h7-0-5" id="h7-0-5" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h8" href="../file/native/build.gradle.kts.html">native/build.gradle.kts</a> b/<a href="../file/native/build.gradle.kts.html">native/build.gradle.kts</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,4 +1,5 @@
</a> plugins {
<a href="#h8-0-1" id="h8-0-1" class="i">+    alias(libs.plugins.rust.android)
</a>     alias(libs.plugins.androidLibrary)
     alias(libs.plugins.kotlinAndroid)
 }
<a href="#h8-1" id="h8-1" class="h">@@ -8,43 +9,16 @@ val nativeName = rootProject.ext.get(&quot;buildHash&quot;)
</a> android {
     namespace = rootProject.ext[&quot;applicationId&quot;].toString() + &quot;.nativelib&quot;
     compileSdk = 34
<a href="#h8-1-3" id="h8-1-3" class="d">-    buildToolsVersion = &quot;34.0.0&quot;
</a><a href="#h8-1-4" id="h8-1-4" class="d">-    ndkVersion = &quot;26.3.11579264&quot;
</a> 
     buildFeatures {
         buildConfig = true
     }
 
     defaultConfig {
<a href="#h8-1-11" id="h8-1-11" class="d">-        buildConfigField(&quot;String&quot;, &quot;NATIVE_NAME&quot;, &quot;\&quot;$nativeName\&quot;&quot;)
</a><a href="#h8-1-12" id="h8-1-12" class="d">-        packaging {
</a><a href="#h8-1-13" id="h8-1-13" class="d">-            jniLibs {
</a><a href="#h8-1-14" id="h8-1-14" class="d">-                excludes += &quot;**/libdobby.so&quot;
</a><a href="#h8-1-15" id="h8-1-15" class="d">-            }
</a><a href="#h8-1-16" id="h8-1-16" class="d">-        }
</a><a href="#h8-1-17" id="h8-1-17" class="d">-        externalNativeBuild {
</a><a href="#h8-1-18" id="h8-1-18" class="d">-            cmake {
</a><a href="#h8-1-19" id="h8-1-19" class="d">-                arguments += listOf(
</a><a href="#h8-1-20" id="h8-1-20" class="d">-                    &quot;-DOBFUSCATED_NAME=$nativeName&quot;,
</a><a href="#h8-1-21" id="h8-1-21" class="d">-                    &quot;-DBUILD_PACKAGE=${rootProject.ext[&quot;applicationId&quot;]}&quot;,
</a><a href="#h8-1-22" id="h8-1-22" class="d">-                    &quot;-DBUILD_NAMESPACE=${namespace!!.replace(&quot;.&quot;, &quot;/&quot;)}&quot;
</a><a href="#h8-1-23" id="h8-1-23" class="d">-                )
</a><a href="#h8-1-24" id="h8-1-24" class="d">-            }
</a><a href="#h8-1-25" id="h8-1-25" class="d">-            ndk {
</a><a href="#h8-1-26" id="h8-1-26" class="d">-                //noinspection ChromeOsAbiSupport
</a><a href="#h8-1-27" id="h8-1-27" class="d">-                abiFilters += properties[&quot;debug_abi_filters&quot;]?.toString()?.split(&quot;,&quot;)
</a><a href="#h8-1-28" id="h8-1-28" class="d">-                    ?: listOf(&quot;arm64-v8a&quot;, &quot;armeabi-v7a&quot;)
</a><a href="#h8-1-29" id="h8-1-29" class="d">-            }
</a><a href="#h8-1-30" id="h8-1-30" class="d">-        }
</a><a href="#h8-1-31" id="h8-1-31" class="i">+        buildConfigField(&quot;String&quot;, &quot;NATIVE_NAME&quot;, &quot;\&quot;$nativeName\&quot;.toString()&quot;)
</a>         minSdk = 28
     }
 
<a href="#h8-1-35" id="h8-1-35" class="d">-    externalNativeBuild {
</a><a href="#h8-1-36" id="h8-1-36" class="d">-        cmake {
</a><a href="#h8-1-37" id="h8-1-37" class="d">-            path(&quot;jni/CMakeLists.txt&quot;)
</a><a href="#h8-1-38" id="h8-1-38" class="d">-            version = &quot;3.22.1&quot;
</a><a href="#h8-1-39" id="h8-1-39" class="d">-        }
</a><a href="#h8-1-40" id="h8-1-40" class="d">-    }
</a>     compileOptions {
         sourceCompatibility = JavaVersion.VERSION_17
         targetCompatibility = JavaVersion.VERSION_17
<a href="#h8-2" id="h8-2" class="h">@@ -53,4 +27,36 @@ android {
</a>     kotlinOptions {
         jvmTarget = &quot;17&quot;
     }
<a href="#h8-2-3" id="h8-2-3" class="d">-}</a><a href="#h8-2-4" id="h8-2-4" class="d">-
\ No newline at end of file
</a><a href="#h8-2-5" id="h8-2-5" class="i">+}
</a><a href="#h8-2-6" id="h8-2-6" class="i">+
</a><a href="#h8-2-7" id="h8-2-7" class="i">+cargo {
</a><a href="#h8-2-8" id="h8-2-8" class="i">+    module = &quot;rust&quot;
</a><a href="#h8-2-9" id="h8-2-9" class="i">+    libname = nativeName.toString()
</a><a href="#h8-2-10" id="h8-2-10" class="i">+    targetIncludes = arrayOf(&quot;libsnapenhance.so&quot;)
</a><a href="#h8-2-11" id="h8-2-11" class="i">+    targets = listOf(&quot;arm64&quot;, &quot;arm&quot;)
</a><a href="#h8-2-12" id="h8-2-12" class="i">+}
</a><a href="#h8-2-13" id="h8-2-13" class="i">+
</a><a href="#h8-2-14" id="h8-2-14" class="i">+fun getNativeFiles() = File(projectDir, &quot;build/rustJniLibs/android&quot;).listFiles()?.flatMap { abiFolder -&gt;
</a><a href="#h8-2-15" id="h8-2-15" class="i">+    abiFolder.takeIf { it.isDirectory }?.listFiles()?.toList() ?: emptyList()
</a><a href="#h8-2-16" id="h8-2-16" class="i">+}
</a><a href="#h8-2-17" id="h8-2-17" class="i">+
</a><a href="#h8-2-18" id="h8-2-18" class="i">+tasks.register(&quot;cleanNatives&quot;) {
</a><a href="#h8-2-19" id="h8-2-19" class="i">+    doLast {
</a><a href="#h8-2-20" id="h8-2-20" class="i">+        println(&quot;Cleaning native files&quot;)
</a><a href="#h8-2-21" id="h8-2-21" class="i">+        getNativeFiles()?.forEach { file -&gt;
</a><a href="#h8-2-22" id="h8-2-22" class="i">+            file.deleteRecursively()
</a><a href="#h8-2-23" id="h8-2-23" class="i">+        }
</a><a href="#h8-2-24" id="h8-2-24" class="i">+    }
</a><a href="#h8-2-25" id="h8-2-25" class="i">+}
</a><a href="#h8-2-26" id="h8-2-26" class="i">+
</a><a href="#h8-2-27" id="h8-2-27" class="i">+tasks.named(&quot;preBuild&quot;).configure {
</a><a href="#h8-2-28" id="h8-2-28" class="i">+    dependsOn(&quot;cleanNatives&quot;, &quot;cargoBuild&quot;)
</a><a href="#h8-2-29" id="h8-2-29" class="i">+    doLast {
</a><a href="#h8-2-30" id="h8-2-30" class="i">+        getNativeFiles()?.forEach { file -&gt;
</a><a href="#h8-2-31" id="h8-2-31" class="i">+            if (file.name.endsWith(&quot;.so&quot;)) {
</a><a href="#h8-2-32" id="h8-2-32" class="i">+                println(&quot;Renaming ${file.absolutePath}&quot;)
</a><a href="#h8-2-33" id="h8-2-33" class="i">+                file.renameTo(File(file.parent, &quot;lib$nativeName.so&quot;))
</a><a href="#h8-2-34" id="h8-2-34" class="i">+            }
</a><a href="#h8-2-35" id="h8-2-35" class="i">+        }
</a><a href="#h8-2-36" id="h8-2-36" class="i">+    }
</a><a href="#h8-2-37" id="h8-2-37" class="i">+}
</a><b>diff --git a/<a id="h9" href="../file/native/jni/CMakeLists.txt.html">native/jni/CMakeLists.txt</a> b/<a href="../file/native/jni/CMakeLists.txt.html">native/jni/CMakeLists.txt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,26 +0,0 @@
</a><a href="#h9-0-0" id="h9-0-0" class="d">-cmake_minimum_required(VERSION 3.22.1)
</a><a href="#h9-0-1" id="h9-0-1" class="d">-
</a><a href="#h9-0-2" id="h9-0-2" class="d">-find_program(CCACHE_FOUND ccache)
</a><a href="#h9-0-3" id="h9-0-3" class="d">-if(CCACHE_FOUND)
</a><a href="#h9-0-4" id="h9-0-4" class="d">-    set_property(GLOBAL PROPERTY RULE_LAUNCH_COMPILE ccache)
</a><a href="#h9-0-5" id="h9-0-5" class="d">-    set_property(GLOBAL PROPERTY RULE_LAUNCH_LINK ccache)
</a><a href="#h9-0-6" id="h9-0-6" class="d">-endif(CCACHE_FOUND)
</a><a href="#h9-0-7" id="h9-0-7" class="d">-
</a><a href="#h9-0-8" id="h9-0-8" class="d">-project(&quot;nativelib&quot;)
</a><a href="#h9-0-9" id="h9-0-9" class="d">-
</a><a href="#h9-0-10" id="h9-0-10" class="d">-set(DOBBY_GENERATE_SHARED OFF)
</a><a href="#h9-0-11" id="h9-0-11" class="d">-add_subdirectory(external/dobby)
</a><a href="#h9-0-12" id="h9-0-12" class="d">-
</a><a href="#h9-0-13" id="h9-0-13" class="d">-add_library(${CMAKE_PROJECT_NAME} SHARED
</a><a href="#h9-0-14" id="h9-0-14" class="d">-        src/library.cpp
</a><a href="#h9-0-15" id="h9-0-15" class="d">-    )
</a><a href="#h9-0-16" id="h9-0-16" class="d">-
</a><a href="#h9-0-17" id="h9-0-17" class="d">-add_compile_definitions(BUILD_NAMESPACE=&quot;${BUILD_NAMESPACE}&quot;)
</a><a href="#h9-0-18" id="h9-0-18" class="d">-add_compile_definitions(BUILD_PACKAGE=&quot;${BUILD_PACKAGE}&quot;)
</a><a href="#h9-0-19" id="h9-0-19" class="d">-target_link_libraries(${CMAKE_PROJECT_NAME}
</a><a href="#h9-0-20" id="h9-0-20" class="d">-        android
</a><a href="#h9-0-21" id="h9-0-21" class="d">-        log
</a><a href="#h9-0-22" id="h9-0-22" class="d">-        dobby_static
</a><a href="#h9-0-23" id="h9-0-23" class="d">-        )
</a><a href="#h9-0-24" id="h9-0-24" class="d">-
</a><a href="#h9-0-25" id="h9-0-25" class="d">-set_target_properties(${CMAKE_PROJECT_NAME} PROPERTIES OUTPUT_NAME ${OBFUSCATED_NAME})</a><a href="#h9-0-26" id="h9-0-26" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/native/jni/external/dobby.html">native/jni/external/dobby</a> b/<a href="../file/native/jni/external/dobby.html">native/jni/external/dobby</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1 +0,0 @@
</a><a href="#h10-0-0" id="h10-0-0" class="d">-Subproject commit b0176de574104726bb68dff3b77ee666300fc338
</a><b>diff --git a/<a id="h11" href="../file/native/jni/src/common.h.html">native/jni/src/common.h</a> b/<a href="../file/native/jni/src/common.h.html">native/jni/src/common.h</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,25 +0,0 @@
</a><a href="#h11-0-0" id="h11-0-0" class="d">-#pragma once
</a><a href="#h11-0-1" id="h11-0-1" class="d">-
</a><a href="#h11-0-2" id="h11-0-2" class="d">-#include &lt;stdint.h&gt;
</a><a href="#h11-0-3" id="h11-0-3" class="d">-#include &quot;util.h&quot;
</a><a href="#h11-0-4" id="h11-0-4" class="d">-
</a><a href="#h11-0-5" id="h11-0-5" class="d">-#ifdef __aarch64__
</a><a href="#h11-0-6" id="h11-0-6" class="d">-#define ARM64 true
</a><a href="#h11-0-7" id="h11-0-7" class="d">-#else
</a><a href="#h11-0-8" id="h11-0-8" class="d">-#define ARM64 false
</a><a href="#h11-0-9" id="h11-0-9" class="d">-#endif
</a><a href="#h11-0-10" id="h11-0-10" class="d">-
</a><a href="#h11-0-11" id="h11-0-11" class="d">-typedef struct {
</a><a href="#h11-0-12" id="h11-0-12" class="d">-    bool disable_bitmoji;
</a><a href="#h11-0-13" id="h11-0-13" class="d">-    bool disable_metrics;
</a><a href="#h11-0-14" id="h11-0-14" class="d">-    bool composer_hooks;
</a><a href="#h11-0-15" id="h11-0-15" class="d">-    char custom_emoji_font_path[256];
</a><a href="#h11-0-16" id="h11-0-16" class="d">-} native_config_t;
</a><a href="#h11-0-17" id="h11-0-17" class="d">-
</a><a href="#h11-0-18" id="h11-0-18" class="d">-namespace common {
</a><a href="#h11-0-19" id="h11-0-19" class="d">-    static JavaVM *java_vm;
</a><a href="#h11-0-20" id="h11-0-20" class="d">-    static jobject native_lib_object;
</a><a href="#h11-0-21" id="h11-0-21" class="d">-
</a><a href="#h11-0-22" id="h11-0-22" class="d">-    static util::module_info_t client_module;
</a><a href="#h11-0-23" id="h11-0-23" class="d">-    static native_config_t *native_config = new native_config_t;
</a><a href="#h11-0-24" id="h11-0-24" class="d">-}
</a><b>diff --git a/<a id="h12" href="../file/native/jni/src/dobby_helper.h.html">native/jni/src/dobby_helper.h</a> b/<a href="../file/native/jni/src/dobby_helper.h.html">native/jni/src/dobby_helper.h</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,13 +0,0 @@
</a><a href="#h12-0-0" id="h12-0-0" class="d">-#pragma once
</a><a href="#h12-0-1" id="h12-0-1" class="d">-
</a><a href="#h12-0-2" id="h12-0-2" class="d">-#include &lt;pthread.h&gt;
</a><a href="#h12-0-3" id="h12-0-3" class="d">-#include &lt;dobby.h&gt;
</a><a href="#h12-0-4" id="h12-0-4" class="d">-
</a><a href="#h12-0-5" id="h12-0-5" class="d">-
</a><a href="#h12-0-6" id="h12-0-6" class="d">-static pthread_mutex_t hook_mutex = PTHREAD_MUTEX_INITIALIZER;
</a><a href="#h12-0-7" id="h12-0-7" class="d">-
</a><a href="#h12-0-8" id="h12-0-8" class="d">-static void inline SafeHook(void *addr, void *hook, void **original) {
</a><a href="#h12-0-9" id="h12-0-9" class="d">-    pthread_mutex_lock(&amp;hook_mutex);
</a><a href="#h12-0-10" id="h12-0-10" class="d">-    DobbyHook(addr, hook, original);
</a><a href="#h12-0-11" id="h12-0-11" class="d">-    pthread_mutex_unlock(&amp;hook_mutex);
</a><a href="#h12-0-12" id="h12-0-12" class="d">-}</a><a href="#h12-0-13" id="h12-0-13" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h13" href="../file/native/jni/src/hooks/composer_hook.h.html">native/jni/src/hooks/composer_hook.h</a> b/<a href="../file/native/jni/src/hooks/composer_hook.h.html">native/jni/src/hooks/composer_hook.h</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,189 +0,0 @@
</a><a href="#h13-0-0" id="h13-0-0" class="d">-#pragma once
</a><a href="#h13-0-1" id="h13-0-1" class="d">-#include &lt;stdio.h&gt;
</a><a href="#h13-0-2" id="h13-0-2" class="d">-
</a><a href="#h13-0-3" id="h13-0-3" class="d">-namespace ComposerHook {
</a><a href="#h13-0-4" id="h13-0-4" class="d">-    enum {
</a><a href="#h13-0-5" id="h13-0-5" class="d">-        JS_TAG_FIRST       = -11,
</a><a href="#h13-0-6" id="h13-0-6" class="d">-        JS_TAG_BIG_DECIMAL = -11,
</a><a href="#h13-0-7" id="h13-0-7" class="d">-        JS_TAG_BIG_INT     = -10,
</a><a href="#h13-0-8" id="h13-0-8" class="d">-        JS_TAG_BIG_FLOAT   = -9,
</a><a href="#h13-0-9" id="h13-0-9" class="d">-        JS_TAG_SYMBOL      = -8,
</a><a href="#h13-0-10" id="h13-0-10" class="d">-        JS_TAG_STRING      = -7,
</a><a href="#h13-0-11" id="h13-0-11" class="d">-        JS_TAG_MODULE      = -3,
</a><a href="#h13-0-12" id="h13-0-12" class="d">-        JS_TAG_FUNCTION_BYTECODE = -2,
</a><a href="#h13-0-13" id="h13-0-13" class="d">-        JS_TAG_OBJECT      = -1,
</a><a href="#h13-0-14" id="h13-0-14" class="d">-
</a><a href="#h13-0-15" id="h13-0-15" class="d">-        JS_TAG_INT         = 0,
</a><a href="#h13-0-16" id="h13-0-16" class="d">-        JS_TAG_BOOL        = 1,
</a><a href="#h13-0-17" id="h13-0-17" class="d">-        JS_TAG_NULL        = 2,
</a><a href="#h13-0-18" id="h13-0-18" class="d">-        JS_TAG_UNDEFINED   = 3,
</a><a href="#h13-0-19" id="h13-0-19" class="d">-        JS_TAG_UNINITIALIZED = 4,
</a><a href="#h13-0-20" id="h13-0-20" class="d">-        JS_TAG_CATCH_OFFSET = 5,
</a><a href="#h13-0-21" id="h13-0-21" class="d">-        JS_TAG_EXCEPTION   = 6,
</a><a href="#h13-0-22" id="h13-0-22" class="d">-        JS_TAG_FLOAT64     = 7,
</a><a href="#h13-0-23" id="h13-0-23" class="d">-    };
</a><a href="#h13-0-24" id="h13-0-24" class="d">-
</a><a href="#h13-0-25" id="h13-0-25" class="d">-    typedef struct JSRefCountHeader {
</a><a href="#h13-0-26" id="h13-0-26" class="d">-        int ref_count;
</a><a href="#h13-0-27" id="h13-0-27" class="d">-    } JSRefCountHeader;
</a><a href="#h13-0-28" id="h13-0-28" class="d">-
</a><a href="#h13-0-29" id="h13-0-29" class="d">-    struct JSString {
</a><a href="#h13-0-30" id="h13-0-30" class="d">-        JSRefCountHeader header;
</a><a href="#h13-0-31" id="h13-0-31" class="d">-        uint32_t len : 31;
</a><a href="#h13-0-32" id="h13-0-32" class="d">-        uint8_t is_wide_char : 1;
</a><a href="#h13-0-33" id="h13-0-33" class="d">-        uint32_t hash : 30;
</a><a href="#h13-0-34" id="h13-0-34" class="d">-        uint8_t atom_type : 2;
</a><a href="#h13-0-35" id="h13-0-35" class="d">-        uint32_t hash_next;
</a><a href="#h13-0-36" id="h13-0-36" class="d">-
</a><a href="#h13-0-37" id="h13-0-37" class="d">-        union {
</a><a href="#h13-0-38" id="h13-0-38" class="d">-            uint8_t str8[0];
</a><a href="#h13-0-39" id="h13-0-39" class="d">-            uint16_t str16[0];
</a><a href="#h13-0-40" id="h13-0-40" class="d">-        } u;
</a><a href="#h13-0-41" id="h13-0-41" class="d">-    };
</a><a href="#h13-0-42" id="h13-0-42" class="d">-
</a><a href="#h13-0-43" id="h13-0-43" class="d">-    typedef union JSValueUnion {
</a><a href="#h13-0-44" id="h13-0-44" class="d">-        int32_t int32;
</a><a href="#h13-0-45" id="h13-0-45" class="d">-        double float64;
</a><a href="#h13-0-46" id="h13-0-46" class="d">-        void *ptr;
</a><a href="#h13-0-47" id="h13-0-47" class="d">-    } JSValueUnion;
</a><a href="#h13-0-48" id="h13-0-48" class="d">-
</a><a href="#h13-0-49" id="h13-0-49" class="d">-    typedef struct JSValue {
</a><a href="#h13-0-50" id="h13-0-50" class="d">-        JSValueUnion u;
</a><a href="#h13-0-51" id="h13-0-51" class="d">-        int64_t tag;
</a><a href="#h13-0-52" id="h13-0-52" class="d">-    } JSValue;
</a><a href="#h13-0-53" id="h13-0-53" class="d">-
</a><a href="#h13-0-54" id="h13-0-54" class="d">-    typedef struct list_head {
</a><a href="#h13-0-55" id="h13-0-55" class="d">-        struct list_head *next, *prev;
</a><a href="#h13-0-56" id="h13-0-56" class="d">-    } list_head;
</a><a href="#h13-0-57" id="h13-0-57" class="d">-
</a><a href="#h13-0-58" id="h13-0-58" class="d">-    struct JSGCObjectHeader {
</a><a href="#h13-0-59" id="h13-0-59" class="d">-        int ref_count;
</a><a href="#h13-0-60" id="h13-0-60" class="d">-        uint8_t gc_obj_type : 4;
</a><a href="#h13-0-61" id="h13-0-61" class="d">-        uint8_t mark : 4;
</a><a href="#h13-0-62" id="h13-0-62" class="d">-        uint8_t dummy1;
</a><a href="#h13-0-63" id="h13-0-63" class="d">-        uint16_t dummy2;
</a><a href="#h13-0-64" id="h13-0-64" class="d">-        struct list_head link;
</a><a href="#h13-0-65" id="h13-0-65" class="d">-    };
</a><a href="#h13-0-66" id="h13-0-66" class="d">-
</a><a href="#h13-0-67" id="h13-0-67" class="d">-    struct JSContext {
</a><a href="#h13-0-68" id="h13-0-68" class="d">-        JSGCObjectHeader header;
</a><a href="#h13-0-69" id="h13-0-69" class="d">-        void *rt;
</a><a href="#h13-0-70" id="h13-0-70" class="d">-        struct list_head link;
</a><a href="#h13-0-71" id="h13-0-71" class="d">-
</a><a href="#h13-0-72" id="h13-0-72" class="d">-        uint16_t binary_object_count;
</a><a href="#h13-0-73" id="h13-0-73" class="d">-        int binary_object_size;
</a><a href="#h13-0-74" id="h13-0-74" class="d">-
</a><a href="#h13-0-75" id="h13-0-75" class="d">-        JSValue *array_shape;
</a><a href="#h13-0-76" id="h13-0-76" class="d">-        JSValue *class_proto;
</a><a href="#h13-0-77" id="h13-0-77" class="d">-        JSValue function_proto;
</a><a href="#h13-0-78" id="h13-0-78" class="d">-        JSValue function_ctor;
</a><a href="#h13-0-79" id="h13-0-79" class="d">-        JSValue array_ctor;
</a><a href="#h13-0-80" id="h13-0-80" class="d">-        JSValue regexp_ctor;
</a><a href="#h13-0-81" id="h13-0-81" class="d">-        JSValue promise_ctor;
</a><a href="#h13-0-82" id="h13-0-82" class="d">-        JSValue native_error_proto[8];
</a><a href="#h13-0-83" id="h13-0-83" class="d">-        JSValue iterator_proto;
</a><a href="#h13-0-84" id="h13-0-84" class="d">-        JSValue async_iterator_proto;
</a><a href="#h13-0-85" id="h13-0-85" class="d">-        JSValue array_proto_values;
</a><a href="#h13-0-86" id="h13-0-86" class="d">-        JSValue throw_type_error;
</a><a href="#h13-0-87" id="h13-0-87" class="d">-        JSValue eval_obj;
</a><a href="#h13-0-88" id="h13-0-88" class="d">-
</a><a href="#h13-0-89" id="h13-0-89" class="d">-        JSValue global_obj;
</a><a href="#h13-0-90" id="h13-0-90" class="d">-        JSValue global_var_obj;
</a><a href="#h13-0-91" id="h13-0-91" class="d">-    };
</a><a href="#h13-0-92" id="h13-0-92" class="d">-
</a><a href="#h13-0-93" id="h13-0-93" class="d">-    static void* global_instance;
</a><a href="#h13-0-94" id="h13-0-94" class="d">-    static JSContext *global_ctx;
</a><a href="#h13-0-95" id="h13-0-95" class="d">-    static std::string* composer_loader;
</a><a href="#h13-0-96" id="h13-0-96" class="d">-
</a><a href="#h13-0-97" id="h13-0-97" class="d">-    HOOK_DEF(JSValue, js_eval, void* instance, JSContext *ctx, void* this_obj, char *input, uintptr_t input_len, const char *filename, unsigned int flags, unsigned int scope_idx) {
</a><a href="#h13-0-98" id="h13-0-98" class="d">-        if (global_instance == nullptr || global_ctx == nullptr) {
</a><a href="#h13-0-99" id="h13-0-99" class="d">-            global_instance = instance;
</a><a href="#h13-0-100" id="h13-0-100" class="d">-            global_ctx = ctx;
</a><a href="#h13-0-101" id="h13-0-101" class="d">-
</a><a href="#h13-0-102" id="h13-0-102" class="d">-            if (composer_loader != nullptr) {
</a><a href="#h13-0-103" id="h13-0-103" class="d">-                LOGD(&quot;Injecting composer loader&quot;);
</a><a href="#h13-0-104" id="h13-0-104" class="d">-                composer_loader-&gt;resize(composer_loader-&gt;size() + input_len);
</a><a href="#h13-0-105" id="h13-0-105" class="d">-                memcpy((void*) (composer_loader-&gt;c_str() + composer_loader-&gt;size() - input_len), input, input_len);
</a><a href="#h13-0-106" id="h13-0-106" class="d">-
</a><a href="#h13-0-107" id="h13-0-107" class="d">-                input = (char*) composer_loader-&gt;c_str();
</a><a href="#h13-0-108" id="h13-0-108" class="d">-                input_len = composer_loader-&gt;size();
</a><a href="#h13-0-109" id="h13-0-109" class="d">-            }
</a><a href="#h13-0-110" id="h13-0-110" class="d">-        } else {
</a><a href="#h13-0-111" id="h13-0-111" class="d">-            if (composer_loader != nullptr) {
</a><a href="#h13-0-112" id="h13-0-112" class="d">-                delete composer_loader;
</a><a href="#h13-0-113" id="h13-0-113" class="d">-                composer_loader = nullptr;
</a><a href="#h13-0-114" id="h13-0-114" class="d">-            }
</a><a href="#h13-0-115" id="h13-0-115" class="d">-        }
</a><a href="#h13-0-116" id="h13-0-116" class="d">-        return js_eval_original(instance, ctx, this_obj, input, input_len, filename, flags, scope_idx);
</a><a href="#h13-0-117" id="h13-0-117" class="d">-    }
</a><a href="#h13-0-118" id="h13-0-118" class="d">-
</a><a href="#h13-0-119" id="h13-0-119" class="d">-    void setComposerLoader(JNIEnv *env, jobject, jstring code) {
</a><a href="#h13-0-120" id="h13-0-120" class="d">-        global_instance = nullptr;
</a><a href="#h13-0-121" id="h13-0-121" class="d">-        global_ctx = nullptr;
</a><a href="#h13-0-122" id="h13-0-122" class="d">-        auto code_str = env-&gt;GetStringUTFChars(code, nullptr);
</a><a href="#h13-0-123" id="h13-0-123" class="d">-        if (composer_loader != nullptr) delete composer_loader;
</a><a href="#h13-0-124" id="h13-0-124" class="d">-        composer_loader = new std::string(code_str, env-&gt;GetStringUTFLength(code));
</a><a href="#h13-0-125" id="h13-0-125" class="d">-        env-&gt;ReleaseStringUTFChars(code, code_str);
</a><a href="#h13-0-126" id="h13-0-126" class="d">-    }
</a><a href="#h13-0-127" id="h13-0-127" class="d">-
</a><a href="#h13-0-128" id="h13-0-128" class="d">-    jstring composerEval(JNIEnv *env, jobject, jstring script) {
</a><a href="#h13-0-129" id="h13-0-129" class="d">-        if (!ARM64) return env-&gt;NewStringUTF(&quot;Architecture not supported&quot;);
</a><a href="#h13-0-130" id="h13-0-130" class="d">-        if (global_instance == 0 || global_ctx == nullptr) {
</a><a href="#h13-0-131" id="h13-0-131" class="d">-            return env-&gt;NewStringUTF(&quot;Composer not ready&quot;);
</a><a href="#h13-0-132" id="h13-0-132" class="d">-        }
</a><a href="#h13-0-133" id="h13-0-133" class="d">-
</a><a href="#h13-0-134" id="h13-0-134" class="d">-        auto script_str = env-&gt;GetStringUTFChars(script, nullptr);
</a><a href="#h13-0-135" id="h13-0-135" class="d">-        auto length = env-&gt;GetStringUTFLength(script);
</a><a href="#h13-0-136" id="h13-0-136" class="d">-        auto jsvalue = js_eval_original(global_instance, global_ctx, (void*) &amp;global_ctx-&gt;global_obj, (char *) script_str, length, &quot;&lt;eval&gt;&quot;, 0, 0);
</a><a href="#h13-0-137" id="h13-0-137" class="d">-        env-&gt;ReleaseStringUTFChars(script, script_str);
</a><a href="#h13-0-138" id="h13-0-138" class="d">-
</a><a href="#h13-0-139" id="h13-0-139" class="d">-        if (jsvalue.tag == JS_TAG_STRING) {
</a><a href="#h13-0-140" id="h13-0-140" class="d">-            auto str = (JSString *) jsvalue.u.ptr;
</a><a href="#h13-0-141" id="h13-0-141" class="d">-            return env-&gt;NewStringUTF((const char *) str-&gt;u.str8);
</a><a href="#h13-0-142" id="h13-0-142" class="d">-        }
</a><a href="#h13-0-143" id="h13-0-143" class="d">-
</a><a href="#h13-0-144" id="h13-0-144" class="d">-        std::string result;
</a><a href="#h13-0-145" id="h13-0-145" class="d">-        switch (jsvalue.tag) {
</a><a href="#h13-0-146" id="h13-0-146" class="d">-            case JS_TAG_INT:
</a><a href="#h13-0-147" id="h13-0-147" class="d">-                result = std::to_string(jsvalue.u.int32);
</a><a href="#h13-0-148" id="h13-0-148" class="d">-                break;
</a><a href="#h13-0-149" id="h13-0-149" class="d">-            case JS_TAG_BOOL:
</a><a href="#h13-0-150" id="h13-0-150" class="d">-                result = jsvalue.u.int32 ? &quot;true&quot; : &quot;false&quot;;
</a><a href="#h13-0-151" id="h13-0-151" class="d">-                break;
</a><a href="#h13-0-152" id="h13-0-152" class="d">-            case JS_TAG_NULL:
</a><a href="#h13-0-153" id="h13-0-153" class="d">-                result = &quot;null&quot;;
</a><a href="#h13-0-154" id="h13-0-154" class="d">-                break;
</a><a href="#h13-0-155" id="h13-0-155" class="d">-            case JS_TAG_UNDEFINED:
</a><a href="#h13-0-156" id="h13-0-156" class="d">-                result = &quot;undefined&quot;;
</a><a href="#h13-0-157" id="h13-0-157" class="d">-                break;
</a><a href="#h13-0-158" id="h13-0-158" class="d">-            case JS_TAG_OBJECT:
</a><a href="#h13-0-159" id="h13-0-159" class="d">-                result = &quot;[object Object]&quot;;
</a><a href="#h13-0-160" id="h13-0-160" class="d">-                break;
</a><a href="#h13-0-161" id="h13-0-161" class="d">-            case JS_TAG_EXCEPTION:
</a><a href="#h13-0-162" id="h13-0-162" class="d">-                result = &quot;Failed to evaluate script&quot;;
</a><a href="#h13-0-163" id="h13-0-163" class="d">-                break;
</a><a href="#h13-0-164" id="h13-0-164" class="d">-            case JS_TAG_FLOAT64:
</a><a href="#h13-0-165" id="h13-0-165" class="d">-                result = std::to_string(jsvalue.u.float64);
</a><a href="#h13-0-166" id="h13-0-166" class="d">-                break;
</a><a href="#h13-0-167" id="h13-0-167" class="d">-            default:
</a><a href="#h13-0-168" id="h13-0-168" class="d">-                result = &quot;[unknown tag &quot; + std::to_string(jsvalue.tag) + &quot;]&quot;;
</a><a href="#h13-0-169" id="h13-0-169" class="d">-                break;
</a><a href="#h13-0-170" id="h13-0-170" class="d">-        }
</a><a href="#h13-0-171" id="h13-0-171" class="d">-
</a><a href="#h13-0-172" id="h13-0-172" class="d">-        return env-&gt;NewStringUTF(result.c_str());
</a><a href="#h13-0-173" id="h13-0-173" class="d">-    }
</a><a href="#h13-0-174" id="h13-0-174" class="d">-
</a><a href="#h13-0-175" id="h13-0-175" class="d">-    void init() {
</a><a href="#h13-0-176" id="h13-0-176" class="d">-        auto js_eval_ptr = util::find_signature(
</a><a href="#h13-0-177" id="h13-0-177" class="d">-            common::client_module.base,
</a><a href="#h13-0-178" id="h13-0-178" class="d">-            common::client_module.size,
</a><a href="#h13-0-179" id="h13-0-179" class="d">-            ARM64 ? &quot;00 E4 00 6F 29 00 80 52 76 00 04 8B&quot; : &quot;A1 B0 07 92 81 46&quot;,
</a><a href="#h13-0-180" id="h13-0-180" class="d">-            ARM64 ? -0x28 : -0x7
</a><a href="#h13-0-181" id="h13-0-181" class="d">-        );
</a><a href="#h13-0-182" id="h13-0-182" class="d">-        if (js_eval_ptr == 0) {
</a><a href="#h13-0-183" id="h13-0-183" class="d">-            LOGE(&quot;js_eval_ptr signature not found&quot;);
</a><a href="#h13-0-184" id="h13-0-184" class="d">-            return;
</a><a href="#h13-0-185" id="h13-0-185" class="d">-        }
</a><a href="#h13-0-186" id="h13-0-186" class="d">-        SafeHook((void*) js_eval_ptr, (void *) js_eval, (void **) &amp;js_eval_original);
</a><a href="#h13-0-187" id="h13-0-187" class="d">-    }
</a><a href="#h13-0-188" id="h13-0-188" class="d">-}</a><a href="#h13-0-189" id="h13-0-189" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/native/jni/src/hooks/custom_emoji_font.h.html">native/jni/src/hooks/custom_emoji_font.h</a> b/<a href="../file/native/jni/src/hooks/custom_emoji_font.h.html">native/jni/src/hooks/custom_emoji_font.h</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,20 +0,0 @@
</a><a href="#h14-0-0" id="h14-0-0" class="d">-#pragma once
</a><a href="#h14-0-1" id="h14-0-1" class="d">-
</a><a href="#h14-0-2" id="h14-0-2" class="d">-#include &lt;sys/stat.h&gt;
</a><a href="#h14-0-3" id="h14-0-3" class="d">-
</a><a href="#h14-0-4" id="h14-0-4" class="d">-namespace CustomEmojiFont {
</a><a href="#h14-0-5" id="h14-0-5" class="d">-    HOOK_DEF(int, open_hook, const char *pathname, int flags, mode_t mode) {
</a><a href="#h14-0-6" id="h14-0-6" class="d">-        auto custom_path = common::native_config-&gt;custom_emoji_font_path;
</a><a href="#h14-0-7" id="h14-0-7" class="d">-        if (strstr(pathname, &quot;/system/fonts/NotoColorEmoji.ttf&quot;) != 0 &amp;&amp; custom_path[0] != 0) {
</a><a href="#h14-0-8" id="h14-0-8" class="d">-            struct stat buffer;
</a><a href="#h14-0-9" id="h14-0-9" class="d">-            if (stat(custom_path, &amp;buffer) == 0) {
</a><a href="#h14-0-10" id="h14-0-10" class="d">-                pathname = custom_path;
</a><a href="#h14-0-11" id="h14-0-11" class="d">-            }
</a><a href="#h14-0-12" id="h14-0-12" class="d">-        }
</a><a href="#h14-0-13" id="h14-0-13" class="d">-        return open_hook_original(pathname, flags, mode);
</a><a href="#h14-0-14" id="h14-0-14" class="d">-    }
</a><a href="#h14-0-15" id="h14-0-15" class="d">-
</a><a href="#h14-0-16" id="h14-0-16" class="d">-    void init() {
</a><a href="#h14-0-17" id="h14-0-17" class="d">-        SafeHook((void *) DobbySymbolResolver(&quot;libc.so&quot;, &quot;open&quot;), (void *)open_hook, (void **)&amp;open_hook_original);
</a><a href="#h14-0-18" id="h14-0-18" class="d">-    }
</a><a href="#h14-0-19" id="h14-0-19" class="d">-}</a><a href="#h14-0-20" id="h14-0-20" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/native/jni/src/hooks/duplex_hook.h.html">native/jni/src/hooks/duplex_hook.h</a> b/<a href="../file/native/jni/src/hooks/duplex_hook.h.html">native/jni/src/hooks/duplex_hook.h</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -1,26 +0,0 @@
</a><a href="#h15-0-0" id="h15-0-0" class="d">-#pragma once
</a><a href="#h15-0-1" id="h15-0-1" class="d">-
</a><a href="#h15-0-2" id="h15-0-2" class="d">-
</a><a href="#h15-0-3" id="h15-0-3" class="d">-namespace DuplexHook {
</a><a href="#h15-0-4" id="h15-0-4" class="d">-    HOOK_DEF(jboolean, IsSameObject, JNIEnv * env, jobject obj1, jobject obj2) {
</a><a href="#h15-0-5" id="h15-0-5" class="d">-        if (obj1 == nullptr || obj2 == nullptr) return IsSameObject_original(env, obj1, obj2);
</a><a href="#h15-0-6" id="h15-0-6" class="d">-
</a><a href="#h15-0-7" id="h15-0-7" class="d">-        auto clazz = env-&gt;FindClass(&quot;java/lang/Class&quot;);
</a><a href="#h15-0-8" id="h15-0-8" class="d">-        if (!env-&gt;IsInstanceOf(obj1, clazz)) return IsSameObject_original(env, obj1, obj2);
</a><a href="#h15-0-9" id="h15-0-9" class="d">-
</a><a href="#h15-0-10" id="h15-0-10" class="d">-        jstring obj1ClassName = (jstring) env-&gt;CallObjectMethod(obj1, env-&gt;GetMethodID(clazz, &quot;getName&quot;, &quot;()Ljava/lang/String;&quot;));
</a><a href="#h15-0-11" id="h15-0-11" class="d">-        const char* obj1ClassNameStr = env-&gt;GetStringUTFChars(obj1ClassName, nullptr);
</a><a href="#h15-0-12" id="h15-0-12" class="d">-
</a><a href="#h15-0-13" id="h15-0-13" class="d">-        if (strstr(obj1ClassNameStr, &quot;com.snapchat.client.duplex.MessageHandler&quot;) != 0) {
</a><a href="#h15-0-14" id="h15-0-14" class="d">-            env-&gt;ReleaseStringUTFChars(obj1ClassName, obj1ClassNameStr);
</a><a href="#h15-0-15" id="h15-0-15" class="d">-            return JNI_FALSE;
</a><a href="#h15-0-16" id="h15-0-16" class="d">-        }
</a><a href="#h15-0-17" id="h15-0-17" class="d">-
</a><a href="#h15-0-18" id="h15-0-18" class="d">-        env-&gt;ReleaseStringUTFChars(obj1ClassName, obj1ClassNameStr);
</a><a href="#h15-0-19" id="h15-0-19" class="d">-        return IsSameObject_original(env, obj1, obj2);
</a><a href="#h15-0-20" id="h15-0-20" class="d">-    }
</a><a href="#h15-0-21" id="h15-0-21" class="d">-
</a><a href="#h15-0-22" id="h15-0-22" class="d">-    void init(JNIEnv* env) {
</a><a href="#h15-0-23" id="h15-0-23" class="d">-        SafeHook((void *)env-&gt;functions-&gt;IsSameObject, (void *)IsSameObject, (void **)&amp;IsSameObject_original);
</a><a href="#h15-0-24" id="h15-0-24" class="d">-    }
</a><a href="#h15-0-25" id="h15-0-25" class="d">-}</a><a href="#h15-0-26" id="h15-0-26" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/native/jni/src/hooks/fstat_hook.h.html">native/jni/src/hooks/fstat_hook.h</a> b/<a href="../file/native/jni/src/hooks/fstat_hook.h.html">native/jni/src/hooks/fstat_hook.h</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -1,27 +0,0 @@
</a><a href="#h16-0-0" id="h16-0-0" class="d">-#pragma once
</a><a href="#h16-0-1" id="h16-0-1" class="d">-
</a><a href="#h16-0-2" id="h16-0-2" class="d">-namespace FstatHook {
</a><a href="#h16-0-3" id="h16-0-3" class="d">-    HOOK_DEF(int, fstat_hook, int fd, struct stat *buf) {
</a><a href="#h16-0-4" id="h16-0-4" class="d">-        char name[256];
</a><a href="#h16-0-5" id="h16-0-5" class="d">-        memset(name, 0, sizeof(name));
</a><a href="#h16-0-6" id="h16-0-6" class="d">-        snprintf(name, sizeof(name), &quot;/proc/self/fd/%d&quot;, fd);
</a><a href="#h16-0-7" id="h16-0-7" class="d">-        readlink(name, name, sizeof(name));
</a><a href="#h16-0-8" id="h16-0-8" class="d">-
</a><a href="#h16-0-9" id="h16-0-9" class="d">-        std::string fileName(name);
</a><a href="#h16-0-10" id="h16-0-10" class="d">-
</a><a href="#h16-0-11" id="h16-0-11" class="d">-        if (common::native_config-&gt;disable_metrics &amp;&amp; fileName.find(&quot;files/blizzardv2/queues&quot;) != std::string::npos) {
</a><a href="#h16-0-12" id="h16-0-12" class="d">-            unlink(name);
</a><a href="#h16-0-13" id="h16-0-13" class="d">-            return -1;
</a><a href="#h16-0-14" id="h16-0-14" class="d">-        }
</a><a href="#h16-0-15" id="h16-0-15" class="d">-
</a><a href="#h16-0-16" id="h16-0-16" class="d">-        if (common::native_config-&gt;disable_bitmoji &amp;&amp; fileName.find(&quot;com.snap.file_manager_4_SCContent&quot;) != std::string::npos) {
</a><a href="#h16-0-17" id="h16-0-17" class="d">-            return -1;
</a><a href="#h16-0-18" id="h16-0-18" class="d">-        }
</a><a href="#h16-0-19" id="h16-0-19" class="d">-
</a><a href="#h16-0-20" id="h16-0-20" class="d">-        return fstat_hook_original(fd, buf);
</a><a href="#h16-0-21" id="h16-0-21" class="d">-    }
</a><a href="#h16-0-22" id="h16-0-22" class="d">-
</a><a href="#h16-0-23" id="h16-0-23" class="d">-    void init() {
</a><a href="#h16-0-24" id="h16-0-24" class="d">-        SafeHook((void *)DobbySymbolResolver(&quot;libc.so&quot;, &quot;fstat&quot;), (void *)fstat_hook, (void **)&amp;fstat_hook_original);
</a><a href="#h16-0-25" id="h16-0-25" class="d">-    }
</a><a href="#h16-0-26" id="h16-0-26" class="d">-}</a><a href="#h16-0-27" id="h16-0-27" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h17" href="../file/native/jni/src/hooks/linker_hook.h.html">native/jni/src/hooks/linker_hook.h</a> b/<a href="../file/native/jni/src/hooks/linker_hook.h.html">native/jni/src/hooks/linker_hook.h</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -1,54 +0,0 @@
</a><a href="#h17-0-0" id="h17-0-0" class="d">-#pragma once
</a><a href="#h17-0-1" id="h17-0-1" class="d">-
</a><a href="#h17-0-2" id="h17-0-2" class="d">-#include &lt;map&gt;
</a><a href="#h17-0-3" id="h17-0-3" class="d">-
</a><a href="#h17-0-4" id="h17-0-4" class="d">-namespace LinkerHook {
</a><a href="#h17-0-5" id="h17-0-5" class="d">-    static auto linker_openat_hooks = std::map&lt;std::string, std::pair&lt;uintptr_t, size_t&gt;&gt;();
</a><a href="#h17-0-6" id="h17-0-6" class="d">-
</a><a href="#h17-0-7" id="h17-0-7" class="d">-    void JNICALL addLinkerSharedLibrary(JNIEnv *env, jobject, jstring path, jbyteArray content) {
</a><a href="#h17-0-8" id="h17-0-8" class="d">-        const char *path_str = env-&gt;GetStringUTFChars(path, nullptr);
</a><a href="#h17-0-9" id="h17-0-9" class="d">-        jsize content_len = env-&gt;GetArrayLength(content);
</a><a href="#h17-0-10" id="h17-0-10" class="d">-        jbyte *content_ptr = env-&gt;GetByteArrayElements(content, nullptr);
</a><a href="#h17-0-11" id="h17-0-11" class="d">-
</a><a href="#h17-0-12" id="h17-0-12" class="d">-        auto allocated_content = (jbyte *) malloc(content_len);
</a><a href="#h17-0-13" id="h17-0-13" class="d">-        memcpy(allocated_content, content_ptr, content_len);
</a><a href="#h17-0-14" id="h17-0-14" class="d">-        linker_openat_hooks[path_str] = std::make_pair((uintptr_t) allocated_content, content_len);
</a><a href="#h17-0-15" id="h17-0-15" class="d">-
</a><a href="#h17-0-16" id="h17-0-16" class="d">-        LOGD(&quot;added linker hook for %s, size=%d&quot;, path_str, content_len);
</a><a href="#h17-0-17" id="h17-0-17" class="d">-
</a><a href="#h17-0-18" id="h17-0-18" class="d">-        env-&gt;ReleaseStringUTFChars(path, path_str);
</a><a href="#h17-0-19" id="h17-0-19" class="d">-        env-&gt;ReleaseByteArrayElements(content, content_ptr, JNI_ABORT);
</a><a href="#h17-0-20" id="h17-0-20" class="d">-    }
</a><a href="#h17-0-21" id="h17-0-21" class="d">-
</a><a href="#h17-0-22" id="h17-0-22" class="d">-    HOOK_DEF(int, linker_openat, int dirfd, const char *pathname, int flags, mode_t mode) {
</a><a href="#h17-0-23" id="h17-0-23" class="d">-        for (const auto &amp;item: linker_openat_hooks) {
</a><a href="#h17-0-24" id="h17-0-24" class="d">-            if (strstr(pathname, item.first.c_str())) {
</a><a href="#h17-0-25" id="h17-0-25" class="d">-                LOGD(&quot;found openat hook for %s&quot;, pathname);
</a><a href="#h17-0-26" id="h17-0-26" class="d">-                static auto memfd_create = (int (*)(const char *, unsigned int)) DobbySymbolResolver(&quot;libc.so&quot;, &quot;memfd_create&quot;);
</a><a href="#h17-0-27" id="h17-0-27" class="d">-                auto fd = memfd_create(&quot;me.rhunk.snapenhance&quot;, 0);
</a><a href="#h17-0-28" id="h17-0-28" class="d">-                LOGD(&quot;memfd created: %d&quot;, fd);
</a><a href="#h17-0-29" id="h17-0-29" class="d">-
</a><a href="#h17-0-30" id="h17-0-30" class="d">-                if (fd == -1) {
</a><a href="#h17-0-31" id="h17-0-31" class="d">-                    LOGE(&quot;memfd_create failed: %d&quot;, errno);
</a><a href="#h17-0-32" id="h17-0-32" class="d">-                    return -1;
</a><a href="#h17-0-33" id="h17-0-33" class="d">-                }
</a><a href="#h17-0-34" id="h17-0-34" class="d">-                if (write(fd, (void *) item.second.first, item.second.second) == -1) {
</a><a href="#h17-0-35" id="h17-0-35" class="d">-                    LOGE(&quot;write failed: %d&quot;, errno);
</a><a href="#h17-0-36" id="h17-0-36" class="d">-                    return -1;
</a><a href="#h17-0-37" id="h17-0-37" class="d">-                }
</a><a href="#h17-0-38" id="h17-0-38" class="d">-                lseek(fd, 0, SEEK_SET);
</a><a href="#h17-0-39" id="h17-0-39" class="d">-
</a><a href="#h17-0-40" id="h17-0-40" class="d">-                free((void *) item.second.first);
</a><a href="#h17-0-41" id="h17-0-41" class="d">-                linker_openat_hooks.erase(item.first);
</a><a href="#h17-0-42" id="h17-0-42" class="d">-
</a><a href="#h17-0-43" id="h17-0-43" class="d">-                LOGD(&quot;memfd written&quot;);
</a><a href="#h17-0-44" id="h17-0-44" class="d">-                return fd;
</a><a href="#h17-0-45" id="h17-0-45" class="d">-            }
</a><a href="#h17-0-46" id="h17-0-46" class="d">-        }
</a><a href="#h17-0-47" id="h17-0-47" class="d">-        return linker_openat_original(dirfd, pathname, flags, mode);
</a><a href="#h17-0-48" id="h17-0-48" class="d">-    }
</a><a href="#h17-0-49" id="h17-0-49" class="d">-
</a><a href="#h17-0-50" id="h17-0-50" class="d">-    void init() {
</a><a href="#h17-0-51" id="h17-0-51" class="d">-        DobbyHook((void *) DobbySymbolResolver(ARM64 ? &quot;linker64&quot; : &quot;linker&quot;, &quot;__dl___openat&quot;), (void *) linker_openat, (void **) &amp;linker_openat_original);
</a><a href="#h17-0-52" id="h17-0-52" class="d">-    }
</a><a href="#h17-0-53" id="h17-0-53" class="d">-}</a><a href="#h17-0-54" id="h17-0-54" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/native/jni/src/hooks/sqlite_mutex.h.html">native/jni/src/hooks/sqlite_mutex.h</a> b/<a href="../file/native/jni/src/hooks/sqlite_mutex.h.html">native/jni/src/hooks/sqlite_mutex.h</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -1,46 +0,0 @@
</a><a href="#h18-0-0" id="h18-0-0" class="d">-#pragma once
</a><a href="#h18-0-1" id="h18-0-1" class="d">-
</a><a href="#h18-0-2" id="h18-0-2" class="d">-#include &lt;map&gt;
</a><a href="#h18-0-3" id="h18-0-3" class="d">-
</a><a href="#h18-0-4" id="h18-0-4" class="d">-namespace SqliteMutexHook {
</a><a href="#h18-0-5" id="h18-0-5" class="d">-    typedef struct {
</a><a href="#h18-0-6" id="h18-0-6" class="d">-        pthread_mutex_t mutex;
</a><a href="#h18-0-7" id="h18-0-7" class="d">-    } sqlite3_mutex;
</a><a href="#h18-0-8" id="h18-0-8" class="d">-
</a><a href="#h18-0-9" id="h18-0-9" class="d">-    typedef struct {
</a><a href="#h18-0-10" id="h18-0-10" class="d">-        void* pVfs;
</a><a href="#h18-0-11" id="h18-0-11" class="d">-        void* pVdbe;
</a><a href="#h18-0-12" id="h18-0-12" class="d">-        void* pDfltColl;
</a><a href="#h18-0-13" id="h18-0-13" class="d">-        sqlite3_mutex* mutex;
</a><a href="#h18-0-14" id="h18-0-14" class="d">-    } sqlite3;
</a><a href="#h18-0-15" id="h18-0-15" class="d">-
</a><a href="#h18-0-16" id="h18-0-16" class="d">-    static std::map&lt;std::string, sqlite3_mutex *&gt; mutex_map = {};
</a><a href="#h18-0-17" id="h18-0-17" class="d">-
</a><a href="#h18-0-18" id="h18-0-18" class="d">-    HOOK_DEF(int, sqlite3_open_hook, const char *filename, sqlite3 **ppDb, unsigned int flags, const char *zVfs) {
</a><a href="#h18-0-19" id="h18-0-19" class="d">-        auto result = sqlite3_open_hook_original(filename, ppDb, flags, zVfs);
</a><a href="#h18-0-20" id="h18-0-20" class="d">-        if (result == 0) {
</a><a href="#h18-0-21" id="h18-0-21" class="d">-            auto mutex = (*ppDb)-&gt;mutex;
</a><a href="#h18-0-22" id="h18-0-22" class="d">-            if (mutex == nullptr) return result;
</a><a href="#h18-0-23" id="h18-0-23" class="d">-
</a><a href="#h18-0-24" id="h18-0-24" class="d">-            auto last_slash = strrchr(filename, &#39;/&#39;) + 1;
</a><a href="#h18-0-25" id="h18-0-25" class="d">-            if (last_slash &gt; filename) {
</a><a href="#h18-0-26" id="h18-0-26" class="d">-                LOGD(&quot;sqlite3_open_hook: %s&quot;, last_slash);
</a><a href="#h18-0-27" id="h18-0-27" class="d">-                mutex_map[last_slash] = mutex;
</a><a href="#h18-0-28" id="h18-0-28" class="d">-            }
</a><a href="#h18-0-29" id="h18-0-29" class="d">-        }
</a><a href="#h18-0-30" id="h18-0-30" class="d">-        return result;
</a><a href="#h18-0-31" id="h18-0-31" class="d">-    }
</a><a href="#h18-0-32" id="h18-0-32" class="d">-
</a><a href="#h18-0-33" id="h18-0-33" class="d">-    void init() {
</a><a href="#h18-0-34" id="h18-0-34" class="d">-        auto open_database_sig = util::find_signature(
</a><a href="#h18-0-35" id="h18-0-35" class="d">-                common::client_module.base, common::client_module.size,
</a><a href="#h18-0-36" id="h18-0-36" class="d">-                ARM64 ? &quot;FF FF 00 A9 3F 00 00 F9&quot; : &quot;9A 46 90 46 78 44 89 46 05 68&quot;,
</a><a href="#h18-0-37" id="h18-0-37" class="d">-                ARM64 ? -0x3C : -0xd
</a><a href="#h18-0-38" id="h18-0-38" class="d">-        );
</a><a href="#h18-0-39" id="h18-0-39" class="d">-        if (open_database_sig == 0) {
</a><a href="#h18-0-40" id="h18-0-40" class="d">-            LOGE(&quot;sqlite3 openDatabase sig not found&quot;);
</a><a href="#h18-0-41" id="h18-0-41" class="d">-            return;
</a><a href="#h18-0-42" id="h18-0-42" class="d">-        }
</a><a href="#h18-0-43" id="h18-0-43" class="d">-        SafeHook((void *) open_database_sig, (void *) sqlite3_open_hook, (void **) &amp;sqlite3_open_hook_original);
</a><a href="#h18-0-44" id="h18-0-44" class="d">-    }
</a><a href="#h18-0-45" id="h18-0-45" class="d">-}</a><a href="#h18-0-46" id="h18-0-46" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h19" href="../file/native/jni/src/hooks/unary_call.h.html">native/jni/src/hooks/unary_call.h</a> b/<a href="../file/native/jni/src/hooks/unary_call.h.html">native/jni/src/hooks/unary_call.h</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -1,87 +0,0 @@
</a><a href="#h19-0-0" id="h19-0-0" class="d">-#pragma once
</a><a href="#h19-0-1" id="h19-0-1" class="d">-
</a><a href="#h19-0-2" id="h19-0-2" class="d">-#include &quot;../common.h&quot;
</a><a href="#h19-0-3" id="h19-0-3" class="d">-#include &quot;../util.h&quot;
</a><a href="#h19-0-4" id="h19-0-4" class="d">-
</a><a href="#h19-0-5" id="h19-0-5" class="d">-namespace UnaryCallHook {
</a><a href="#h19-0-6" id="h19-0-6" class="d">-    namespace grpc {
</a><a href="#h19-0-7" id="h19-0-7" class="d">-        typedef struct {
</a><a href="#h19-0-8" id="h19-0-8" class="d">-            void* ref_counter;
</a><a href="#h19-0-9" id="h19-0-9" class="d">-            size_t length;
</a><a href="#h19-0-10" id="h19-0-10" class="d">-            uint8_t* data;
</a><a href="#h19-0-11" id="h19-0-11" class="d">-        } ref_counted_slice_byte_buffer;
</a><a href="#h19-0-12" id="h19-0-12" class="d">-
</a><a href="#h19-0-13" id="h19-0-13" class="d">-        typedef struct {
</a><a href="#h19-0-14" id="h19-0-14" class="d">-            void* reserved;
</a><a href="#h19-0-15" id="h19-0-15" class="d">-            void* type;
</a><a href="#h19-0-16" id="h19-0-16" class="d">-            void* compression;
</a><a href="#h19-0-17" id="h19-0-17" class="d">-            ref_counted_slice_byte_buffer *slice_buffer;
</a><a href="#h19-0-18" id="h19-0-18" class="d">-        } grpc_byte_buffer;
</a><a href="#h19-0-19" id="h19-0-19" class="d">-    }
</a><a href="#h19-0-20" id="h19-0-20" class="d">-
</a><a href="#h19-0-21" id="h19-0-21" class="d">-    static jmethodID native_lib_on_unary_call_method;
</a><a href="#h19-0-22" id="h19-0-22" class="d">-
</a><a href="#h19-0-23" id="h19-0-23" class="d">-    HOOK_DEF(void *, unaryCall_hook, void *unk1, const char *uri, grpc::grpc_byte_buffer **buffer_ptr, void *unk4, void *unk5, void *unk6) {
</a><a href="#h19-0-24" id="h19-0-24" class="d">-        // request without reference counter can be hooked using xposed ig
</a><a href="#h19-0-25" id="h19-0-25" class="d">-        auto slice_buffer = (*buffer_ptr)-&gt;slice_buffer;
</a><a href="#h19-0-26" id="h19-0-26" class="d">-        if (slice_buffer-&gt;ref_counter == 0) {
</a><a href="#h19-0-27" id="h19-0-27" class="d">-            return unaryCall_hook_original(unk1, uri, buffer_ptr, unk4, unk5, unk6);
</a><a href="#h19-0-28" id="h19-0-28" class="d">-        }
</a><a href="#h19-0-29" id="h19-0-29" class="d">-
</a><a href="#h19-0-30" id="h19-0-30" class="d">-        JNIEnv *env = nullptr;
</a><a href="#h19-0-31" id="h19-0-31" class="d">-        common::java_vm-&gt;GetEnv((void **)&amp;env, JNI_VERSION_1_6);
</a><a href="#h19-0-32" id="h19-0-32" class="d">-
</a><a href="#h19-0-33" id="h19-0-33" class="d">-        auto jni_buffer_array = env-&gt;NewByteArray(slice_buffer-&gt;length);
</a><a href="#h19-0-34" id="h19-0-34" class="d">-        env-&gt;SetByteArrayRegion(jni_buffer_array, 0, slice_buffer-&gt;length, (jbyte *)slice_buffer-&gt;data);
</a><a href="#h19-0-35" id="h19-0-35" class="d">-
</a><a href="#h19-0-36" id="h19-0-36" class="d">-        auto native_request_data_object = env-&gt;CallObjectMethod(common::native_lib_object, native_lib_on_unary_call_method, env-&gt;NewStringUTF(uri), jni_buffer_array);
</a><a href="#h19-0-37" id="h19-0-37" class="d">-
</a><a href="#h19-0-38" id="h19-0-38" class="d">-        if (native_request_data_object != nullptr) {
</a><a href="#h19-0-39" id="h19-0-39" class="d">-            auto native_request_data_class = env-&gt;GetObjectClass(native_request_data_object);
</a><a href="#h19-0-40" id="h19-0-40" class="d">-            auto is_canceled = env-&gt;GetBooleanField(native_request_data_object, env-&gt;GetFieldID(native_request_data_class, &quot;canceled&quot;, &quot;Z&quot;));
</a><a href="#h19-0-41" id="h19-0-41" class="d">-
</a><a href="#h19-0-42" id="h19-0-42" class="d">-            if (is_canceled) {
</a><a href="#h19-0-43" id="h19-0-43" class="d">-                LOGD(&quot;canceled request for %s&quot;, uri);
</a><a href="#h19-0-44" id="h19-0-44" class="d">-                return nullptr;
</a><a href="#h19-0-45" id="h19-0-45" class="d">-            }
</a><a href="#h19-0-46" id="h19-0-46" class="d">-
</a><a href="#h19-0-47" id="h19-0-47" class="d">-            auto new_buffer = (jbyteArray)env-&gt;GetObjectField(native_request_data_object, env-&gt;GetFieldID(native_request_data_class, &quot;buffer&quot;, &quot;[B&quot;));
</a><a href="#h19-0-48" id="h19-0-48" class="d">-            auto new_buffer_length = env-&gt;GetArrayLength(new_buffer);
</a><a href="#h19-0-49" id="h19-0-49" class="d">-            auto new_buffer_data = env-&gt;GetByteArrayElements(new_buffer, nullptr);
</a><a href="#h19-0-50" id="h19-0-50" class="d">-
</a><a href="#h19-0-51" id="h19-0-51" class="d">-            //we need to allocate a new ref_counter struct and copy the old ref_counter and the new_buffer to it
</a><a href="#h19-0-52" id="h19-0-52" class="d">-            const static auto ref_counter_struct_size = (uintptr_t)slice_buffer-&gt;data - (uintptr_t)slice_buffer-&gt;ref_counter;
</a><a href="#h19-0-53" id="h19-0-53" class="d">-
</a><a href="#h19-0-54" id="h19-0-54" class="d">-            auto new_ref_counter = malloc(ref_counter_struct_size + new_buffer_length);
</a><a href="#h19-0-55" id="h19-0-55" class="d">-            //copy the old ref_counter and the native_request_data_object
</a><a href="#h19-0-56" id="h19-0-56" class="d">-            memcpy(new_ref_counter, slice_buffer-&gt;ref_counter, ref_counter_struct_size);
</a><a href="#h19-0-57" id="h19-0-57" class="d">-            memcpy((void *)((uintptr_t)new_ref_counter + ref_counter_struct_size), new_buffer_data, new_buffer_length);
</a><a href="#h19-0-58" id="h19-0-58" class="d">-
</a><a href="#h19-0-59" id="h19-0-59" class="d">-            //free the old ref_counter
</a><a href="#h19-0-60" id="h19-0-60" class="d">-            free(slice_buffer-&gt;ref_counter);
</a><a href="#h19-0-61" id="h19-0-61" class="d">-
</a><a href="#h19-0-62" id="h19-0-62" class="d">-            //update the slice_buffer
</a><a href="#h19-0-63" id="h19-0-63" class="d">-            slice_buffer-&gt;ref_counter = new_ref_counter;
</a><a href="#h19-0-64" id="h19-0-64" class="d">-            slice_buffer-&gt;length = new_buffer_length;
</a><a href="#h19-0-65" id="h19-0-65" class="d">-            slice_buffer-&gt;data = (uint8_t *)((uintptr_t)new_ref_counter + ref_counter_struct_size);
</a><a href="#h19-0-66" id="h19-0-66" class="d">-        }
</a><a href="#h19-0-67" id="h19-0-67" class="d">-
</a><a href="#h19-0-68" id="h19-0-68" class="d">-        return unaryCall_hook_original(unk1, uri, buffer_ptr, unk4, unk5, unk6);
</a><a href="#h19-0-69" id="h19-0-69" class="d">-    }
</a><a href="#h19-0-70" id="h19-0-70" class="d">-
</a><a href="#h19-0-71" id="h19-0-71" class="d">-    void init(JNIEnv *env) {
</a><a href="#h19-0-72" id="h19-0-72" class="d">-        auto unaryCall_func = util::find_signature(
</a><a href="#h19-0-73" id="h19-0-73" class="d">-                common::client_module.base, common::client_module.size,
</a><a href="#h19-0-74" id="h19-0-74" class="d">-                ARM64 ? &quot;A8 03 1F F8 C2 00 00 94&quot; : &quot;0A 90 00 F0 3F F9&quot;,
</a><a href="#h19-0-75" id="h19-0-75" class="d">-                ARM64 ? -0x48 : -0x37
</a><a href="#h19-0-76" id="h19-0-76" class="d">-        );
</a><a href="#h19-0-77" id="h19-0-77" class="d">-
</a><a href="#h19-0-78" id="h19-0-78" class="d">-        native_lib_on_unary_call_method = env-&gt;GetMethodID(env-&gt;GetObjectClass(common::native_lib_object), &quot;onNativeUnaryCall&quot;, &quot;(Ljava/lang/String;[B)L&quot; BUILD_NAMESPACE &quot;/NativeRequestData;&quot;);
</a><a href="#h19-0-79" id="h19-0-79" class="d">-
</a><a href="#h19-0-80" id="h19-0-80" class="d">-        if (unaryCall_func != 0) {
</a><a href="#h19-0-81" id="h19-0-81" class="d">-            SafeHook((void *)unaryCall_func, (void *)unaryCall_hook, (void **)&amp;unaryCall_hook_original);
</a><a href="#h19-0-82" id="h19-0-82" class="d">-        } else {
</a><a href="#h19-0-83" id="h19-0-83" class="d">-            LOGE(&quot;Can&#39;t find unaryCall signature&quot;);
</a><a href="#h19-0-84" id="h19-0-84" class="d">-        }
</a><a href="#h19-0-85" id="h19-0-85" class="d">-    }
</a><a href="#h19-0-86" id="h19-0-86" class="d">-}</a><a href="#h19-0-87" id="h19-0-87" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/native/jni/src/library.cpp.html">native/jni/src/library.cpp</a> b/<a href="../file/native/jni/src/library.cpp.html">native/jni/src/library.cpp</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -1,115 +0,0 @@
</a><a href="#h20-0-0" id="h20-0-0" class="d">-#include &lt;jni.h&gt;
</a><a href="#h20-0-1" id="h20-0-1" class="d">-#include &lt;string&gt;
</a><a href="#h20-0-2" id="h20-0-2" class="d">-#include &lt;dobby.h&gt;
</a><a href="#h20-0-3" id="h20-0-3" class="d">-#include &lt;vector&gt;
</a><a href="#h20-0-4" id="h20-0-4" class="d">-#include &lt;thread&gt;
</a><a href="#h20-0-5" id="h20-0-5" class="d">-
</a><a href="#h20-0-6" id="h20-0-6" class="d">-#include &quot;logger.h&quot;
</a><a href="#h20-0-7" id="h20-0-7" class="d">-#include &quot;common.h&quot;
</a><a href="#h20-0-8" id="h20-0-8" class="d">-#include &quot;dobby_helper.h&quot;
</a><a href="#h20-0-9" id="h20-0-9" class="d">-#include &quot;hooks/linker_hook.h&quot;
</a><a href="#h20-0-10" id="h20-0-10" class="d">-#include &quot;hooks/unary_call.h&quot;
</a><a href="#h20-0-11" id="h20-0-11" class="d">-#include &quot;hooks/fstat_hook.h&quot;
</a><a href="#h20-0-12" id="h20-0-12" class="d">-#include &quot;hooks/sqlite_mutex.h&quot;
</a><a href="#h20-0-13" id="h20-0-13" class="d">-#include &quot;hooks/duplex_hook.h&quot;
</a><a href="#h20-0-14" id="h20-0-14" class="d">-#include &quot;hooks/composer_hook.h&quot;
</a><a href="#h20-0-15" id="h20-0-15" class="d">-#include &quot;hooks/custom_emoji_font.h&quot;
</a><a href="#h20-0-16" id="h20-0-16" class="d">-
</a><a href="#h20-0-17" id="h20-0-17" class="d">-bool JNICALL init(JNIEnv *env, jobject clazz) {
</a><a href="#h20-0-18" id="h20-0-18" class="d">-    LOGD(&quot;Initializing native&quot;);
</a><a href="#h20-0-19" id="h20-0-19" class="d">-    using namespace common;
</a><a href="#h20-0-20" id="h20-0-20" class="d">-
</a><a href="#h20-0-21" id="h20-0-21" class="d">-    native_lib_object = env-&gt;NewGlobalRef(clazz);
</a><a href="#h20-0-22" id="h20-0-22" class="d">-    client_module = util::get_module(&quot;libclient.so&quot;);
</a><a href="#h20-0-23" id="h20-0-23" class="d">-
</a><a href="#h20-0-24" id="h20-0-24" class="d">-    if (client_module.base == 0) {
</a><a href="#h20-0-25" id="h20-0-25" class="d">-        LOGD(&quot;libclient.so not found, trying split_config&quot;);
</a><a href="#h20-0-26" id="h20-0-26" class="d">-        client_module = util::get_module((&quot;split_config.&quot; + std::string(ARM64 ? &quot;arm64_v8a&quot; : &quot;armeabi-v7a&quot;) + &quot;.apk&quot;).c_str());
</a><a href="#h20-0-27" id="h20-0-27" class="d">-        if (client_module.base == 0) {
</a><a href="#h20-0-28" id="h20-0-28" class="d">-            LOGE(&quot;can&#39;t find split_config!&quot;);
</a><a href="#h20-0-29" id="h20-0-29" class="d">-            return false;
</a><a href="#h20-0-30" id="h20-0-30" class="d">-        }
</a><a href="#h20-0-31" id="h20-0-31" class="d">-    }
</a><a href="#h20-0-32" id="h20-0-32" class="d">-
</a><a href="#h20-0-33" id="h20-0-33" class="d">-    LOGD(&quot;client_module offset=0x%lx, size=0x%zx&quot;, client_module.base, client_module.size);
</a><a href="#h20-0-34" id="h20-0-34" class="d">-
</a><a href="#h20-0-35" id="h20-0-35" class="d">-    auto threads = std::vector&lt;std::thread&gt;();
</a><a href="#h20-0-36" id="h20-0-36" class="d">-
</a><a href="#h20-0-37" id="h20-0-37" class="d">-    #define RUN(body) threads.push_back(std::thread([&amp;] { body; }))
</a><a href="#h20-0-38" id="h20-0-38" class="d">-
</a><a href="#h20-0-39" id="h20-0-39" class="d">-    RUN(UnaryCallHook::init(env));
</a><a href="#h20-0-40" id="h20-0-40" class="d">-    RUN(FstatHook::init());
</a><a href="#h20-0-41" id="h20-0-41" class="d">-    RUN(SqliteMutexHook::init());
</a><a href="#h20-0-42" id="h20-0-42" class="d">-    RUN(DuplexHook::init(env));
</a><a href="#h20-0-43" id="h20-0-43" class="d">-    if (common::native_config-&gt;custom_emoji_font_path[0] != 0) {
</a><a href="#h20-0-44" id="h20-0-44" class="d">-        RUN(CustomEmojiFont::init());
</a><a href="#h20-0-45" id="h20-0-45" class="d">-    }
</a><a href="#h20-0-46" id="h20-0-46" class="d">-    if (common::native_config-&gt;composer_hooks) {
</a><a href="#h20-0-47" id="h20-0-47" class="d">-        RUN(ComposerHook::init());
</a><a href="#h20-0-48" id="h20-0-48" class="d">-    }
</a><a href="#h20-0-49" id="h20-0-49" class="d">-
</a><a href="#h20-0-50" id="h20-0-50" class="d">-    for (auto &amp;thread : threads) {
</a><a href="#h20-0-51" id="h20-0-51" class="d">-        thread.join();
</a><a href="#h20-0-52" id="h20-0-52" class="d">-    }
</a><a href="#h20-0-53" id="h20-0-53" class="d">-
</a><a href="#h20-0-54" id="h20-0-54" class="d">-    LOGD(&quot;Native initialized&quot;);
</a><a href="#h20-0-55" id="h20-0-55" class="d">-    return true;
</a><a href="#h20-0-56" id="h20-0-56" class="d">-}
</a><a href="#h20-0-57" id="h20-0-57" class="d">-
</a><a href="#h20-0-58" id="h20-0-58" class="d">-void JNICALL load_config(JNIEnv *env, jobject, jobject config_object) {
</a><a href="#h20-0-59" id="h20-0-59" class="d">-    auto native_config_clazz = env-&gt;GetObjectClass(config_object);
</a><a href="#h20-0-60" id="h20-0-60" class="d">-#define GET_CONFIG_BOOL(name) env-&gt;GetBooleanField(config_object, env-&gt;GetFieldID(native_config_clazz, name, &quot;Z&quot;))
</a><a href="#h20-0-61" id="h20-0-61" class="d">-    auto native_config = common::native_config;
</a><a href="#h20-0-62" id="h20-0-62" class="d">-
</a><a href="#h20-0-63" id="h20-0-63" class="d">-    native_config-&gt;disable_bitmoji = GET_CONFIG_BOOL(&quot;disableBitmoji&quot;);
</a><a href="#h20-0-64" id="h20-0-64" class="d">-    native_config-&gt;disable_metrics = GET_CONFIG_BOOL(&quot;disableMetrics&quot;);
</a><a href="#h20-0-65" id="h20-0-65" class="d">-    native_config-&gt;composer_hooks = GET_CONFIG_BOOL(&quot;composerHooks&quot;);
</a><a href="#h20-0-66" id="h20-0-66" class="d">-
</a><a href="#h20-0-67" id="h20-0-67" class="d">-    memset(native_config-&gt;custom_emoji_font_path, 0, sizeof(native_config-&gt;custom_emoji_font_path));
</a><a href="#h20-0-68" id="h20-0-68" class="d">-    auto custom_emoji_font_path = env-&gt;GetObjectField(config_object, env-&gt;GetFieldID(native_config_clazz, &quot;customEmojiFontPath&quot;, &quot;Ljava/lang/String;&quot;));
</a><a href="#h20-0-69" id="h20-0-69" class="d">-    if (custom_emoji_font_path != nullptr) {
</a><a href="#h20-0-70" id="h20-0-70" class="d">-        auto custom_emoji_font_path_str = env-&gt;GetStringUTFChars((jstring) custom_emoji_font_path, nullptr);
</a><a href="#h20-0-71" id="h20-0-71" class="d">-        strncpy(native_config-&gt;custom_emoji_font_path, custom_emoji_font_path_str, sizeof(native_config-&gt;custom_emoji_font_path));
</a><a href="#h20-0-72" id="h20-0-72" class="d">-        env-&gt;ReleaseStringUTFChars((jstring) custom_emoji_font_path, custom_emoji_font_path_str);
</a><a href="#h20-0-73" id="h20-0-73" class="d">-    }
</a><a href="#h20-0-74" id="h20-0-74" class="d">-}
</a><a href="#h20-0-75" id="h20-0-75" class="d">-
</a><a href="#h20-0-76" id="h20-0-76" class="d">-void JNICALL lock_database(JNIEnv *env, jobject, jstring database_name, jobject runnable) {
</a><a href="#h20-0-77" id="h20-0-77" class="d">-    auto database_name_str = env-&gt;GetStringUTFChars(database_name, nullptr);
</a><a href="#h20-0-78" id="h20-0-78" class="d">-    auto mutex = SqliteMutexHook::mutex_map[database_name_str];
</a><a href="#h20-0-79" id="h20-0-79" class="d">-    env-&gt;ReleaseStringUTFChars(database_name, database_name_str);
</a><a href="#h20-0-80" id="h20-0-80" class="d">-
</a><a href="#h20-0-81" id="h20-0-81" class="d">-    if (mutex != nullptr) {
</a><a href="#h20-0-82" id="h20-0-82" class="d">-        auto lock_result = pthread_mutex_lock(&amp;mutex-&gt;mutex);
</a><a href="#h20-0-83" id="h20-0-83" class="d">-        if (lock_result != 0) {
</a><a href="#h20-0-84" id="h20-0-84" class="d">-            LOGE(&quot;pthread_mutex_lock failed: %d&quot;, lock_result);
</a><a href="#h20-0-85" id="h20-0-85" class="d">-            return;
</a><a href="#h20-0-86" id="h20-0-86" class="d">-        }
</a><a href="#h20-0-87" id="h20-0-87" class="d">-    }
</a><a href="#h20-0-88" id="h20-0-88" class="d">-
</a><a href="#h20-0-89" id="h20-0-89" class="d">-    env-&gt;CallVoidMethod(runnable, env-&gt;GetMethodID(env-&gt;GetObjectClass(runnable), &quot;run&quot;, &quot;()V&quot;));
</a><a href="#h20-0-90" id="h20-0-90" class="d">-
</a><a href="#h20-0-91" id="h20-0-91" class="d">-    if (mutex != nullptr) {
</a><a href="#h20-0-92" id="h20-0-92" class="d">-        pthread_mutex_unlock(&amp;mutex-&gt;mutex);
</a><a href="#h20-0-93" id="h20-0-93" class="d">-    }
</a><a href="#h20-0-94" id="h20-0-94" class="d">-}
</a><a href="#h20-0-95" id="h20-0-95" class="d">-
</a><a href="#h20-0-96" id="h20-0-96" class="d">-
</a><a href="#h20-0-97" id="h20-0-97" class="d">-extern &quot;C&quot; JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void *_) {
</a><a href="#h20-0-98" id="h20-0-98" class="d">-    common::java_vm = vm;
</a><a href="#h20-0-99" id="h20-0-99" class="d">-    JNIEnv *env = nullptr;
</a><a href="#h20-0-100" id="h20-0-100" class="d">-    vm-&gt;GetEnv((void **)&amp;env, JNI_VERSION_1_6);
</a><a href="#h20-0-101" id="h20-0-101" class="d">-
</a><a href="#h20-0-102" id="h20-0-102" class="d">-    auto methods = std::vector&lt;JNINativeMethod&gt;();
</a><a href="#h20-0-103" id="h20-0-103" class="d">-    methods.push_back({&quot;init&quot;, &quot;()Z&quot;, (void *)init});
</a><a href="#h20-0-104" id="h20-0-104" class="d">-    methods.push_back({&quot;loadConfig&quot;, &quot;(L&quot; BUILD_NAMESPACE &quot;/NativeConfig;)V&quot;, (void *)load_config});
</a><a href="#h20-0-105" id="h20-0-105" class="d">-    methods.push_back({&quot;lockDatabase&quot;, &quot;(Ljava/lang/String;Ljava/lang/Runnable;)V&quot;, (void *)lock_database});
</a><a href="#h20-0-106" id="h20-0-106" class="d">-    methods.push_back({&quot;setComposerLoader&quot;, &quot;(Ljava/lang/String;)V&quot;, (void *) ComposerHook::setComposerLoader});
</a><a href="#h20-0-107" id="h20-0-107" class="d">-    methods.push_back({&quot;composerEval&quot;, &quot;(Ljava/lang/String;)Ljava/lang/String;&quot;,(void *) ComposerHook::composerEval});
</a><a href="#h20-0-108" id="h20-0-108" class="d">-    methods.push_back({&quot;addLinkerSharedLibrary&quot;, &quot;(Ljava/lang/String;[B)V&quot;, (void *) LinkerHook::addLinkerSharedLibrary});
</a><a href="#h20-0-109" id="h20-0-109" class="d">-
</a><a href="#h20-0-110" id="h20-0-110" class="d">-    LinkerHook::init();
</a><a href="#h20-0-111" id="h20-0-111" class="d">-
</a><a href="#h20-0-112" id="h20-0-112" class="d">-    env-&gt;RegisterNatives(env-&gt;FindClass(std::string(BUILD_NAMESPACE &quot;/NativeLib&quot;).c_str()), methods.data(), methods.size());
</a><a href="#h20-0-113" id="h20-0-113" class="d">-    return JNI_VERSION_1_6;
</a><a href="#h20-0-114" id="h20-0-114" class="d">-}
</a><b>diff --git a/<a id="h21" href="../file/native/jni/src/logger.h.html">native/jni/src/logger.h</a> b/<a href="../file/native/jni/src/logger.h.html">native/jni/src/logger.h</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -1,9 +0,0 @@
</a><a href="#h21-0-0" id="h21-0-0" class="d">-#pragma once
</a><a href="#h21-0-1" id="h21-0-1" class="d">-
</a><a href="#h21-0-2" id="h21-0-2" class="d">-#include &lt;android/log.h&gt;
</a><a href="#h21-0-3" id="h21-0-3" class="d">-
</a><a href="#h21-0-4" id="h21-0-4" class="d">-#define LOG_TAG &quot;SnapEnhanceNative&quot;
</a><a href="#h21-0-5" id="h21-0-5" class="d">-
</a><a href="#h21-0-6" id="h21-0-6" class="d">-#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG, LOG_TAG, __VA_ARGS__)
</a><a href="#h21-0-7" id="h21-0-7" class="d">-#define LOGE(...) __android_log_print(ANDROID_LOG_ERROR,  LOG_TAG, __VA_ARGS__)
</a><a href="#h21-0-8" id="h21-0-8" class="d">-
</a><b>diff --git a/<a id="h22" href="../file/native/jni/src/util.h.html">native/jni/src/util.h</a> b/<a href="../file/native/jni/src/util.h.html">native/jni/src/util.h</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -1,83 +0,0 @@
</a><a href="#h22-0-0" id="h22-0-0" class="d">-#pragma once
</a><a href="#h22-0-1" id="h22-0-1" class="d">-
</a><a href="#h22-0-2" id="h22-0-2" class="d">-#include &lt;unistd.h&gt;
</a><a href="#h22-0-3" id="h22-0-3" class="d">-#include &lt;sys/mman.h&gt;
</a><a href="#h22-0-4" id="h22-0-4" class="d">-
</a><a href="#h22-0-5" id="h22-0-5" class="d">-#define HOOK_DEF(ret, func, ...) ret (*func##_original)(__VA_ARGS__); ret func(__VA_ARGS__)
</a><a href="#h22-0-6" id="h22-0-6" class="d">-
</a><a href="#h22-0-7" id="h22-0-7" class="d">-namespace util {
</a><a href="#h22-0-8" id="h22-0-8" class="d">-    typedef struct {
</a><a href="#h22-0-9" id="h22-0-9" class="d">-        uintptr_t base;
</a><a href="#h22-0-10" id="h22-0-10" class="d">-        size_t size;
</a><a href="#h22-0-11" id="h22-0-11" class="d">-    } module_info_t;
</a><a href="#h22-0-12" id="h22-0-12" class="d">-
</a><a href="#h22-0-13" id="h22-0-13" class="d">-    static module_info_t get_module(const char *libname) {
</a><a href="#h22-0-14" id="h22-0-14" class="d">-        char buff[256];
</a><a href="#h22-0-15" id="h22-0-15" class="d">-        int len_libname = strlen(libname);
</a><a href="#h22-0-16" id="h22-0-16" class="d">-        uintptr_t start_offset = 0;
</a><a href="#h22-0-17" id="h22-0-17" class="d">-        uintptr_t end_offset = 0;
</a><a href="#h22-0-18" id="h22-0-18" class="d">-
</a><a href="#h22-0-19" id="h22-0-19" class="d">-        auto file = fopen(&quot;/proc/self/smaps&quot;, &quot;rt&quot;);
</a><a href="#h22-0-20" id="h22-0-20" class="d">-        if (file == NULL)
</a><a href="#h22-0-21" id="h22-0-21" class="d">-            return {0, 0};
</a><a href="#h22-0-22" id="h22-0-22" class="d">-
</a><a href="#h22-0-23" id="h22-0-23" class="d">-        while (fgets(buff, sizeof buff, file) != NULL) {
</a><a href="#h22-0-24" id="h22-0-24" class="d">-            int len = strlen(buff);
</a><a href="#h22-0-25" id="h22-0-25" class="d">-            if (len &gt; 0 &amp;&amp; buff[len - 1] == &#39;\n&#39;) {
</a><a href="#h22-0-26" id="h22-0-26" class="d">-                buff[--len] = &#39;\0&#39;;
</a><a href="#h22-0-27" id="h22-0-27" class="d">-            }
</a><a href="#h22-0-28" id="h22-0-28" class="d">-            if (len &lt;= len_libname || memcmp(buff + len - len_libname, libname, len_libname)) {
</a><a href="#h22-0-29" id="h22-0-29" class="d">-                continue;
</a><a href="#h22-0-30" id="h22-0-30" class="d">-            }
</a><a href="#h22-0-31" id="h22-0-31" class="d">-            size_t start, end, offset;
</a><a href="#h22-0-32" id="h22-0-32" class="d">-            char flags[4];
</a><a href="#h22-0-33" id="h22-0-33" class="d">-            if (sscanf(buff, &quot;%zx-%zx %c%c%c%c %zx&quot;, &amp;start, &amp;end,
</a><a href="#h22-0-34" id="h22-0-34" class="d">-                       &amp;flags[0], &amp;flags[1], &amp;flags[2], &amp;flags[3], &amp;offset) != 7) {
</a><a href="#h22-0-35" id="h22-0-35" class="d">-                continue;
</a><a href="#h22-0-36" id="h22-0-36" class="d">-            }
</a><a href="#h22-0-37" id="h22-0-37" class="d">-
</a><a href="#h22-0-38" id="h22-0-38" class="d">-            if (flags[0] != &#39;r&#39; || flags[2] != &#39;x&#39;) {
</a><a href="#h22-0-39" id="h22-0-39" class="d">-                continue;
</a><a href="#h22-0-40" id="h22-0-40" class="d">-            }
</a><a href="#h22-0-41" id="h22-0-41" class="d">-
</a><a href="#h22-0-42" id="h22-0-42" class="d">-            if (start_offset == 0) {
</a><a href="#h22-0-43" id="h22-0-43" class="d">-                start_offset = start;
</a><a href="#h22-0-44" id="h22-0-44" class="d">-            }
</a><a href="#h22-0-45" id="h22-0-45" class="d">-            end_offset = end;
</a><a href="#h22-0-46" id="h22-0-46" class="d">-        }
</a><a href="#h22-0-47" id="h22-0-47" class="d">-        fclose(file);
</a><a href="#h22-0-48" id="h22-0-48" class="d">-        if (start_offset == 0) {
</a><a href="#h22-0-49" id="h22-0-49" class="d">-            return {0, 0};
</a><a href="#h22-0-50" id="h22-0-50" class="d">-        }
</a><a href="#h22-0-51" id="h22-0-51" class="d">-        return { start_offset, end_offset - start_offset };
</a><a href="#h22-0-52" id="h22-0-52" class="d">-    }
</a><a href="#h22-0-53" id="h22-0-53" class="d">-
</a><a href="#h22-0-54" id="h22-0-54" class="d">-    static uintptr_t find_signature(uintptr_t module_base, uintptr_t size, const std::string &amp;pattern, int offset = 0) {
</a><a href="#h22-0-55" id="h22-0-55" class="d">-        std::vector&lt;char&gt; bytes;
</a><a href="#h22-0-56" id="h22-0-56" class="d">-        std::vector&lt;char&gt; mask;
</a><a href="#h22-0-57" id="h22-0-57" class="d">-        for (size_t i = 0; i &lt; pattern.size(); i += 3) {
</a><a href="#h22-0-58" id="h22-0-58" class="d">-            if (pattern[i] == &#39;?&#39;) {
</a><a href="#h22-0-59" id="h22-0-59" class="d">-                bytes.push_back(0);
</a><a href="#h22-0-60" id="h22-0-60" class="d">-                mask.push_back(&#39;?&#39;);
</a><a href="#h22-0-61" id="h22-0-61" class="d">-            } else {
</a><a href="#h22-0-62" id="h22-0-62" class="d">-                bytes.push_back(std::stoi(pattern.substr(i, 2), nullptr, 16));
</a><a href="#h22-0-63" id="h22-0-63" class="d">-                mask.push_back(&#39;x&#39;);
</a><a href="#h22-0-64" id="h22-0-64" class="d">-            }
</a><a href="#h22-0-65" id="h22-0-65" class="d">-        }
</a><a href="#h22-0-66" id="h22-0-66" class="d">-
</a><a href="#h22-0-67" id="h22-0-67" class="d">-        for (size_t i = 0; i &lt; size; i++) {
</a><a href="#h22-0-68" id="h22-0-68" class="d">-            bool found = true;
</a><a href="#h22-0-69" id="h22-0-69" class="d">-            for (size_t j = 0; j &lt; bytes.size(); j++) {
</a><a href="#h22-0-70" id="h22-0-70" class="d">-                if (mask[j] == &#39;?&#39; || bytes[j] == *(char *) (module_base + i + j)) {
</a><a href="#h22-0-71" id="h22-0-71" class="d">-                    continue;
</a><a href="#h22-0-72" id="h22-0-72" class="d">-                }
</a><a href="#h22-0-73" id="h22-0-73" class="d">-                found = false;
</a><a href="#h22-0-74" id="h22-0-74" class="d">-                break;
</a><a href="#h22-0-75" id="h22-0-75" class="d">-            }
</a><a href="#h22-0-76" id="h22-0-76" class="d">-            if (found) {
</a><a href="#h22-0-77" id="h22-0-77" class="d">-                return module_base + i + offset;
</a><a href="#h22-0-78" id="h22-0-78" class="d">-            }
</a><a href="#h22-0-79" id="h22-0-79" class="d">-        }
</a><a href="#h22-0-80" id="h22-0-80" class="d">-        return 0;
</a><a href="#h22-0-81" id="h22-0-81" class="d">-    }
</a><a href="#h22-0-82" id="h22-0-82" class="d">-}</a><a href="#h22-0-83" id="h22-0-83" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h23" href="../file/native/rust/Cargo.lock.html">native/rust/Cargo.lock</a> b/<a href="../file/native/rust/Cargo.lock.html">native/rust/Cargo.lock</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -0,0 +1,724 @@
</a><a href="#h23-0-0" id="h23-0-0" class="i">+# This file is automatically @generated by Cargo.
</a><a href="#h23-0-1" id="h23-0-1" class="i">+# It is not intended for manual editing.
</a><a href="#h23-0-2" id="h23-0-2" class="i">+version = 3
</a><a href="#h23-0-3" id="h23-0-3" class="i">+
</a><a href="#h23-0-4" id="h23-0-4" class="i">+[[package]]
</a><a href="#h23-0-5" id="h23-0-5" class="i">+name = &quot;adler&quot;
</a><a href="#h23-0-6" id="h23-0-6" class="i">+version = &quot;1.0.2&quot;
</a><a href="#h23-0-7" id="h23-0-7" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-8" id="h23-0-8" class="i">+checksum = &quot;f26201604c87b1e01bd3d98f8d5d9a8fcbb815e8cedb41ffccbeb4bf593a35fe&quot;
</a><a href="#h23-0-9" id="h23-0-9" class="i">+
</a><a href="#h23-0-10" id="h23-0-10" class="i">+[[package]]
</a><a href="#h23-0-11" id="h23-0-11" class="i">+name = &quot;aho-corasick&quot;
</a><a href="#h23-0-12" id="h23-0-12" class="i">+version = &quot;1.1.3&quot;
</a><a href="#h23-0-13" id="h23-0-13" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-14" id="h23-0-14" class="i">+checksum = &quot;8e60d3430d3a69478ad0993f19238d2df97c507009a52b3c10addcd7f6bcb916&quot;
</a><a href="#h23-0-15" id="h23-0-15" class="i">+dependencies = [
</a><a href="#h23-0-16" id="h23-0-16" class="i">+ &quot;memchr&quot;,
</a><a href="#h23-0-17" id="h23-0-17" class="i">+]
</a><a href="#h23-0-18" id="h23-0-18" class="i">+
</a><a href="#h23-0-19" id="h23-0-19" class="i">+[[package]]
</a><a href="#h23-0-20" id="h23-0-20" class="i">+name = &quot;android-tzdata&quot;
</a><a href="#h23-0-21" id="h23-0-21" class="i">+version = &quot;0.1.1&quot;
</a><a href="#h23-0-22" id="h23-0-22" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-23" id="h23-0-23" class="i">+checksum = &quot;e999941b234f3131b00bc13c22d06e8c5ff726d1b6318ac7eb276997bbb4fef0&quot;
</a><a href="#h23-0-24" id="h23-0-24" class="i">+
</a><a href="#h23-0-25" id="h23-0-25" class="i">+[[package]]
</a><a href="#h23-0-26" id="h23-0-26" class="i">+name = &quot;android_log-sys&quot;
</a><a href="#h23-0-27" id="h23-0-27" class="i">+version = &quot;0.3.1&quot;
</a><a href="#h23-0-28" id="h23-0-28" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-29" id="h23-0-29" class="i">+checksum = &quot;5ecc8056bf6ab9892dcd53216c83d1597487d7dacac16c8df6b877d127df9937&quot;
</a><a href="#h23-0-30" id="h23-0-30" class="i">+
</a><a href="#h23-0-31" id="h23-0-31" class="i">+[[package]]
</a><a href="#h23-0-32" id="h23-0-32" class="i">+name = &quot;android_logger&quot;
</a><a href="#h23-0-33" id="h23-0-33" class="i">+version = &quot;0.14.1&quot;
</a><a href="#h23-0-34" id="h23-0-34" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-35" id="h23-0-35" class="i">+checksum = &quot;05b07e8e73d720a1f2e4b6014766e6039fd2e96a4fa44e2a78d0e1fa2ff49826&quot;
</a><a href="#h23-0-36" id="h23-0-36" class="i">+dependencies = [
</a><a href="#h23-0-37" id="h23-0-37" class="i">+ &quot;android_log-sys&quot;,
</a><a href="#h23-0-38" id="h23-0-38" class="i">+ &quot;env_filter&quot;,
</a><a href="#h23-0-39" id="h23-0-39" class="i">+ &quot;log&quot;,
</a><a href="#h23-0-40" id="h23-0-40" class="i">+]
</a><a href="#h23-0-41" id="h23-0-41" class="i">+
</a><a href="#h23-0-42" id="h23-0-42" class="i">+[[package]]
</a><a href="#h23-0-43" id="h23-0-43" class="i">+name = &quot;android_system_properties&quot;
</a><a href="#h23-0-44" id="h23-0-44" class="i">+version = &quot;0.1.5&quot;
</a><a href="#h23-0-45" id="h23-0-45" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-46" id="h23-0-46" class="i">+checksum = &quot;819e7219dbd41043ac279b19830f2efc897156490d7fd6ea916720117ee66311&quot;
</a><a href="#h23-0-47" id="h23-0-47" class="i">+dependencies = [
</a><a href="#h23-0-48" id="h23-0-48" class="i">+ &quot;libc&quot;,
</a><a href="#h23-0-49" id="h23-0-49" class="i">+]
</a><a href="#h23-0-50" id="h23-0-50" class="i">+
</a><a href="#h23-0-51" id="h23-0-51" class="i">+[[package]]
</a><a href="#h23-0-52" id="h23-0-52" class="i">+name = &quot;autocfg&quot;
</a><a href="#h23-0-53" id="h23-0-53" class="i">+version = &quot;1.3.0&quot;
</a><a href="#h23-0-54" id="h23-0-54" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-55" id="h23-0-55" class="i">+checksum = &quot;0c4b4d0bd25bd0b74681c0ad21497610ce1b7c91b1022cd21c80c6fbdd9476b0&quot;
</a><a href="#h23-0-56" id="h23-0-56" class="i">+
</a><a href="#h23-0-57" id="h23-0-57" class="i">+[[package]]
</a><a href="#h23-0-58" id="h23-0-58" class="i">+name = &quot;bitflags&quot;
</a><a href="#h23-0-59" id="h23-0-59" class="i">+version = &quot;2.6.0&quot;
</a><a href="#h23-0-60" id="h23-0-60" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-61" id="h23-0-61" class="i">+checksum = &quot;b048fb63fd8b5923fc5aa7b340d8e156aec7ec02f0c78fa8a6ddc2613f6f71de&quot;
</a><a href="#h23-0-62" id="h23-0-62" class="i">+
</a><a href="#h23-0-63" id="h23-0-63" class="i">+[[package]]
</a><a href="#h23-0-64" id="h23-0-64" class="i">+name = &quot;bumpalo&quot;
</a><a href="#h23-0-65" id="h23-0-65" class="i">+version = &quot;3.16.0&quot;
</a><a href="#h23-0-66" id="h23-0-66" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-67" id="h23-0-67" class="i">+checksum = &quot;79296716171880943b8470b5f8d03aa55eb2e645a4874bdbb28adb49162e012c&quot;
</a><a href="#h23-0-68" id="h23-0-68" class="i">+
</a><a href="#h23-0-69" id="h23-0-69" class="i">+[[package]]
</a><a href="#h23-0-70" id="h23-0-70" class="i">+name = &quot;bytes&quot;
</a><a href="#h23-0-71" id="h23-0-71" class="i">+version = &quot;1.6.1&quot;
</a><a href="#h23-0-72" id="h23-0-72" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-73" id="h23-0-73" class="i">+checksum = &quot;a12916984aab3fa6e39d655a33e09c0071eb36d6ab3aea5c2d78551f1df6d952&quot;
</a><a href="#h23-0-74" id="h23-0-74" class="i">+
</a><a href="#h23-0-75" id="h23-0-75" class="i">+[[package]]
</a><a href="#h23-0-76" id="h23-0-76" class="i">+name = &quot;cc&quot;
</a><a href="#h23-0-77" id="h23-0-77" class="i">+version = &quot;1.1.6&quot;
</a><a href="#h23-0-78" id="h23-0-78" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-79" id="h23-0-79" class="i">+checksum = &quot;2aba8f4e9906c7ce3c73463f62a7f0c65183ada1a2d47e397cc8810827f9694f&quot;
</a><a href="#h23-0-80" id="h23-0-80" class="i">+
</a><a href="#h23-0-81" id="h23-0-81" class="i">+[[package]]
</a><a href="#h23-0-82" id="h23-0-82" class="i">+name = &quot;cesu8&quot;
</a><a href="#h23-0-83" id="h23-0-83" class="i">+version = &quot;1.1.0&quot;
</a><a href="#h23-0-84" id="h23-0-84" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-85" id="h23-0-85" class="i">+checksum = &quot;6d43a04d8753f35258c91f8ec639f792891f748a1edbd759cf1dcea3382ad83c&quot;
</a><a href="#h23-0-86" id="h23-0-86" class="i">+
</a><a href="#h23-0-87" id="h23-0-87" class="i">+[[package]]
</a><a href="#h23-0-88" id="h23-0-88" class="i">+name = &quot;cfg-if&quot;
</a><a href="#h23-0-89" id="h23-0-89" class="i">+version = &quot;1.0.0&quot;
</a><a href="#h23-0-90" id="h23-0-90" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-91" id="h23-0-91" class="i">+checksum = &quot;baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd&quot;
</a><a href="#h23-0-92" id="h23-0-92" class="i">+
</a><a href="#h23-0-93" id="h23-0-93" class="i">+[[package]]
</a><a href="#h23-0-94" id="h23-0-94" class="i">+name = &quot;cfg_aliases&quot;
</a><a href="#h23-0-95" id="h23-0-95" class="i">+version = &quot;0.2.1&quot;
</a><a href="#h23-0-96" id="h23-0-96" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-97" id="h23-0-97" class="i">+checksum = &quot;613afe47fcd5fac7ccf1db93babcb082c5994d996f20b8b159f2ad1658eb5724&quot;
</a><a href="#h23-0-98" id="h23-0-98" class="i">+
</a><a href="#h23-0-99" id="h23-0-99" class="i">+[[package]]
</a><a href="#h23-0-100" id="h23-0-100" class="i">+name = &quot;chrono&quot;
</a><a href="#h23-0-101" id="h23-0-101" class="i">+version = &quot;0.4.38&quot;
</a><a href="#h23-0-102" id="h23-0-102" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-103" id="h23-0-103" class="i">+checksum = &quot;a21f936df1771bf62b77f047b726c4625ff2e8aa607c01ec06e5a05bd8463401&quot;
</a><a href="#h23-0-104" id="h23-0-104" class="i">+dependencies = [
</a><a href="#h23-0-105" id="h23-0-105" class="i">+ &quot;android-tzdata&quot;,
</a><a href="#h23-0-106" id="h23-0-106" class="i">+ &quot;iana-time-zone&quot;,
</a><a href="#h23-0-107" id="h23-0-107" class="i">+ &quot;num-traits&quot;,
</a><a href="#h23-0-108" id="h23-0-108" class="i">+ &quot;windows-targets 0.52.6&quot;,
</a><a href="#h23-0-109" id="h23-0-109" class="i">+]
</a><a href="#h23-0-110" id="h23-0-110" class="i">+
</a><a href="#h23-0-111" id="h23-0-111" class="i">+[[package]]
</a><a href="#h23-0-112" id="h23-0-112" class="i">+name = &quot;combine&quot;
</a><a href="#h23-0-113" id="h23-0-113" class="i">+version = &quot;4.6.7&quot;
</a><a href="#h23-0-114" id="h23-0-114" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-115" id="h23-0-115" class="i">+checksum = &quot;ba5a308b75df32fe02788e748662718f03fde005016435c444eea572398219fd&quot;
</a><a href="#h23-0-116" id="h23-0-116" class="i">+dependencies = [
</a><a href="#h23-0-117" id="h23-0-117" class="i">+ &quot;bytes&quot;,
</a><a href="#h23-0-118" id="h23-0-118" class="i">+ &quot;memchr&quot;,
</a><a href="#h23-0-119" id="h23-0-119" class="i">+]
</a><a href="#h23-0-120" id="h23-0-120" class="i">+
</a><a href="#h23-0-121" id="h23-0-121" class="i">+[[package]]
</a><a href="#h23-0-122" id="h23-0-122" class="i">+name = &quot;core-foundation-sys&quot;
</a><a href="#h23-0-123" id="h23-0-123" class="i">+version = &quot;0.8.6&quot;
</a><a href="#h23-0-124" id="h23-0-124" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-125" id="h23-0-125" class="i">+checksum = &quot;06ea2b9bc92be3c2baa9334a323ebca2d6f074ff852cd1d7b11064035cd3868f&quot;
</a><a href="#h23-0-126" id="h23-0-126" class="i">+
</a><a href="#h23-0-127" id="h23-0-127" class="i">+[[package]]
</a><a href="#h23-0-128" id="h23-0-128" class="i">+name = &quot;crc32fast&quot;
</a><a href="#h23-0-129" id="h23-0-129" class="i">+version = &quot;1.4.2&quot;
</a><a href="#h23-0-130" id="h23-0-130" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-131" id="h23-0-131" class="i">+checksum = &quot;a97769d94ddab943e4510d138150169a2758b5ef3eb191a9ee688de3e23ef7b3&quot;
</a><a href="#h23-0-132" id="h23-0-132" class="i">+dependencies = [
</a><a href="#h23-0-133" id="h23-0-133" class="i">+ &quot;cfg-if&quot;,
</a><a href="#h23-0-134" id="h23-0-134" class="i">+]
</a><a href="#h23-0-135" id="h23-0-135" class="i">+
</a><a href="#h23-0-136" id="h23-0-136" class="i">+[[package]]
</a><a href="#h23-0-137" id="h23-0-137" class="i">+name = &quot;dobby-rs&quot;
</a><a href="#h23-0-138" id="h23-0-138" class="i">+version = &quot;0.1.0&quot;
</a><a href="#h23-0-139" id="h23-0-139" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-140" id="h23-0-140" class="i">+checksum = &quot;a0b8fbf3688f3584f3f87ec7024032d81da6e8b868a1d23d8a6c0a399e7c9935&quot;
</a><a href="#h23-0-141" id="h23-0-141" class="i">+dependencies = [
</a><a href="#h23-0-142" id="h23-0-142" class="i">+ &quot;dobby-sys&quot;,
</a><a href="#h23-0-143" id="h23-0-143" class="i">+ &quot;thiserror&quot;,
</a><a href="#h23-0-144" id="h23-0-144" class="i">+]
</a><a href="#h23-0-145" id="h23-0-145" class="i">+
</a><a href="#h23-0-146" id="h23-0-146" class="i">+[[package]]
</a><a href="#h23-0-147" id="h23-0-147" class="i">+name = &quot;dobby-sys&quot;
</a><a href="#h23-0-148" id="h23-0-148" class="i">+version = &quot;0.1.0&quot;
</a><a href="#h23-0-149" id="h23-0-149" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-150" id="h23-0-150" class="i">+checksum = &quot;4cdffdeaa52be950db80677f22f549050675f226b77e97fdbe10bb2dd846ac7b&quot;
</a><a href="#h23-0-151" id="h23-0-151" class="i">+
</a><a href="#h23-0-152" id="h23-0-152" class="i">+[[package]]
</a><a href="#h23-0-153" id="h23-0-153" class="i">+name = &quot;env_filter&quot;
</a><a href="#h23-0-154" id="h23-0-154" class="i">+version = &quot;0.1.1&quot;
</a><a href="#h23-0-155" id="h23-0-155" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-156" id="h23-0-156" class="i">+checksum = &quot;c6dc8c8ff84895b051f07a0e65f975cf225131742531338752abfb324e4449ff&quot;
</a><a href="#h23-0-157" id="h23-0-157" class="i">+dependencies = [
</a><a href="#h23-0-158" id="h23-0-158" class="i">+ &quot;log&quot;,
</a><a href="#h23-0-159" id="h23-0-159" class="i">+ &quot;regex&quot;,
</a><a href="#h23-0-160" id="h23-0-160" class="i">+]
</a><a href="#h23-0-161" id="h23-0-161" class="i">+
</a><a href="#h23-0-162" id="h23-0-162" class="i">+[[package]]
</a><a href="#h23-0-163" id="h23-0-163" class="i">+name = &quot;errno&quot;
</a><a href="#h23-0-164" id="h23-0-164" class="i">+version = &quot;0.3.9&quot;
</a><a href="#h23-0-165" id="h23-0-165" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-166" id="h23-0-166" class="i">+checksum = &quot;534c5cf6194dfab3db3242765c03bbe257cf92f22b38f6bc0c58d59108a820ba&quot;
</a><a href="#h23-0-167" id="h23-0-167" class="i">+dependencies = [
</a><a href="#h23-0-168" id="h23-0-168" class="i">+ &quot;libc&quot;,
</a><a href="#h23-0-169" id="h23-0-169" class="i">+ &quot;windows-sys 0.52.0&quot;,
</a><a href="#h23-0-170" id="h23-0-170" class="i">+]
</a><a href="#h23-0-171" id="h23-0-171" class="i">+
</a><a href="#h23-0-172" id="h23-0-172" class="i">+[[package]]
</a><a href="#h23-0-173" id="h23-0-173" class="i">+name = &quot;flate2&quot;
</a><a href="#h23-0-174" id="h23-0-174" class="i">+version = &quot;1.0.30&quot;
</a><a href="#h23-0-175" id="h23-0-175" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-176" id="h23-0-176" class="i">+checksum = &quot;5f54427cfd1c7829e2a139fcefea601bf088ebca651d2bf53ebc600eac295dae&quot;
</a><a href="#h23-0-177" id="h23-0-177" class="i">+dependencies = [
</a><a href="#h23-0-178" id="h23-0-178" class="i">+ &quot;crc32fast&quot;,
</a><a href="#h23-0-179" id="h23-0-179" class="i">+ &quot;miniz_oxide&quot;,
</a><a href="#h23-0-180" id="h23-0-180" class="i">+]
</a><a href="#h23-0-181" id="h23-0-181" class="i">+
</a><a href="#h23-0-182" id="h23-0-182" class="i">+[[package]]
</a><a href="#h23-0-183" id="h23-0-183" class="i">+name = &quot;hex&quot;
</a><a href="#h23-0-184" id="h23-0-184" class="i">+version = &quot;0.4.3&quot;
</a><a href="#h23-0-185" id="h23-0-185" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-186" id="h23-0-186" class="i">+checksum = &quot;7f24254aa9a54b5c858eaee2f5bccdb46aaf0e486a595ed5fd8f86ba55232a70&quot;
</a><a href="#h23-0-187" id="h23-0-187" class="i">+
</a><a href="#h23-0-188" id="h23-0-188" class="i">+[[package]]
</a><a href="#h23-0-189" id="h23-0-189" class="i">+name = &quot;iana-time-zone&quot;
</a><a href="#h23-0-190" id="h23-0-190" class="i">+version = &quot;0.1.60&quot;
</a><a href="#h23-0-191" id="h23-0-191" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-192" id="h23-0-192" class="i">+checksum = &quot;e7ffbb5a1b541ea2561f8c41c087286cc091e21e556a4f09a8f6cbf17b69b141&quot;
</a><a href="#h23-0-193" id="h23-0-193" class="i">+dependencies = [
</a><a href="#h23-0-194" id="h23-0-194" class="i">+ &quot;android_system_properties&quot;,
</a><a href="#h23-0-195" id="h23-0-195" class="i">+ &quot;core-foundation-sys&quot;,
</a><a href="#h23-0-196" id="h23-0-196" class="i">+ &quot;iana-time-zone-haiku&quot;,
</a><a href="#h23-0-197" id="h23-0-197" class="i">+ &quot;js-sys&quot;,
</a><a href="#h23-0-198" id="h23-0-198" class="i">+ &quot;wasm-bindgen&quot;,
</a><a href="#h23-0-199" id="h23-0-199" class="i">+ &quot;windows-core&quot;,
</a><a href="#h23-0-200" id="h23-0-200" class="i">+]
</a><a href="#h23-0-201" id="h23-0-201" class="i">+
</a><a href="#h23-0-202" id="h23-0-202" class="i">+[[package]]
</a><a href="#h23-0-203" id="h23-0-203" class="i">+name = &quot;iana-time-zone-haiku&quot;
</a><a href="#h23-0-204" id="h23-0-204" class="i">+version = &quot;0.1.2&quot;
</a><a href="#h23-0-205" id="h23-0-205" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-206" id="h23-0-206" class="i">+checksum = &quot;f31827a206f56af32e590ba56d5d2d085f558508192593743f16b2306495269f&quot;
</a><a href="#h23-0-207" id="h23-0-207" class="i">+dependencies = [
</a><a href="#h23-0-208" id="h23-0-208" class="i">+ &quot;cc&quot;,
</a><a href="#h23-0-209" id="h23-0-209" class="i">+]
</a><a href="#h23-0-210" id="h23-0-210" class="i">+
</a><a href="#h23-0-211" id="h23-0-211" class="i">+[[package]]
</a><a href="#h23-0-212" id="h23-0-212" class="i">+name = &quot;itoa&quot;
</a><a href="#h23-0-213" id="h23-0-213" class="i">+version = &quot;1.0.11&quot;
</a><a href="#h23-0-214" id="h23-0-214" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-215" id="h23-0-215" class="i">+checksum = &quot;49f1f14873335454500d59611f1cf4a4b0f786f9ac11f4312a78e4cf2566695b&quot;
</a><a href="#h23-0-216" id="h23-0-216" class="i">+
</a><a href="#h23-0-217" id="h23-0-217" class="i">+[[package]]
</a><a href="#h23-0-218" id="h23-0-218" class="i">+name = &quot;jni&quot;
</a><a href="#h23-0-219" id="h23-0-219" class="i">+version = &quot;0.21.1&quot;
</a><a href="#h23-0-220" id="h23-0-220" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-221" id="h23-0-221" class="i">+checksum = &quot;1a87aa2bb7d2af34197c04845522473242e1aa17c12f4935d5856491a7fb8c97&quot;
</a><a href="#h23-0-222" id="h23-0-222" class="i">+dependencies = [
</a><a href="#h23-0-223" id="h23-0-223" class="i">+ &quot;cesu8&quot;,
</a><a href="#h23-0-224" id="h23-0-224" class="i">+ &quot;cfg-if&quot;,
</a><a href="#h23-0-225" id="h23-0-225" class="i">+ &quot;combine&quot;,
</a><a href="#h23-0-226" id="h23-0-226" class="i">+ &quot;jni-sys&quot;,
</a><a href="#h23-0-227" id="h23-0-227" class="i">+ &quot;log&quot;,
</a><a href="#h23-0-228" id="h23-0-228" class="i">+ &quot;thiserror&quot;,
</a><a href="#h23-0-229" id="h23-0-229" class="i">+ &quot;walkdir&quot;,
</a><a href="#h23-0-230" id="h23-0-230" class="i">+ &quot;windows-sys 0.45.0&quot;,
</a><a href="#h23-0-231" id="h23-0-231" class="i">+]
</a><a href="#h23-0-232" id="h23-0-232" class="i">+
</a><a href="#h23-0-233" id="h23-0-233" class="i">+[[package]]
</a><a href="#h23-0-234" id="h23-0-234" class="i">+name = &quot;jni-sys&quot;
</a><a href="#h23-0-235" id="h23-0-235" class="i">+version = &quot;0.3.0&quot;
</a><a href="#h23-0-236" id="h23-0-236" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-237" id="h23-0-237" class="i">+checksum = &quot;8eaf4bc02d17cbdd7ff4c7438cafcdf7fb9a4613313ad11b4f8fefe7d3fa0130&quot;
</a><a href="#h23-0-238" id="h23-0-238" class="i">+
</a><a href="#h23-0-239" id="h23-0-239" class="i">+[[package]]
</a><a href="#h23-0-240" id="h23-0-240" class="i">+name = &quot;js-sys&quot;
</a><a href="#h23-0-241" id="h23-0-241" class="i">+version = &quot;0.3.69&quot;
</a><a href="#h23-0-242" id="h23-0-242" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-243" id="h23-0-243" class="i">+checksum = &quot;29c15563dc2726973df627357ce0c9ddddbea194836909d655df6a75d2cf296d&quot;
</a><a href="#h23-0-244" id="h23-0-244" class="i">+dependencies = [
</a><a href="#h23-0-245" id="h23-0-245" class="i">+ &quot;wasm-bindgen&quot;,
</a><a href="#h23-0-246" id="h23-0-246" class="i">+]
</a><a href="#h23-0-247" id="h23-0-247" class="i">+
</a><a href="#h23-0-248" id="h23-0-248" class="i">+[[package]]
</a><a href="#h23-0-249" id="h23-0-249" class="i">+name = &quot;lazy_static&quot;
</a><a href="#h23-0-250" id="h23-0-250" class="i">+version = &quot;1.5.0&quot;
</a><a href="#h23-0-251" id="h23-0-251" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-252" id="h23-0-252" class="i">+checksum = &quot;bbd2bcb4c963f2ddae06a2efc7e9f3591312473c50c6685e1f298068316e66fe&quot;
</a><a href="#h23-0-253" id="h23-0-253" class="i">+
</a><a href="#h23-0-254" id="h23-0-254" class="i">+[[package]]
</a><a href="#h23-0-255" id="h23-0-255" class="i">+name = &quot;libc&quot;
</a><a href="#h23-0-256" id="h23-0-256" class="i">+version = &quot;0.2.155&quot;
</a><a href="#h23-0-257" id="h23-0-257" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-258" id="h23-0-258" class="i">+checksum = &quot;97b3888a4aecf77e811145cadf6eef5901f4782c53886191b2f693f24761847c&quot;
</a><a href="#h23-0-259" id="h23-0-259" class="i">+
</a><a href="#h23-0-260" id="h23-0-260" class="i">+[[package]]
</a><a href="#h23-0-261" id="h23-0-261" class="i">+name = &quot;linux-raw-sys&quot;
</a><a href="#h23-0-262" id="h23-0-262" class="i">+version = &quot;0.4.14&quot;
</a><a href="#h23-0-263" id="h23-0-263" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-264" id="h23-0-264" class="i">+checksum = &quot;78b3ae25bc7c8c38cec158d1f2757ee79e9b3740fbc7ccf0e59e4b08d793fa89&quot;
</a><a href="#h23-0-265" id="h23-0-265" class="i">+
</a><a href="#h23-0-266" id="h23-0-266" class="i">+[[package]]
</a><a href="#h23-0-267" id="h23-0-267" class="i">+name = &quot;log&quot;
</a><a href="#h23-0-268" id="h23-0-268" class="i">+version = &quot;0.4.22&quot;
</a><a href="#h23-0-269" id="h23-0-269" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-270" id="h23-0-270" class="i">+checksum = &quot;a7a70ba024b9dc04c27ea2f0c0548feb474ec5c54bba33a7f72f873a39d07b24&quot;
</a><a href="#h23-0-271" id="h23-0-271" class="i">+
</a><a href="#h23-0-272" id="h23-0-272" class="i">+[[package]]
</a><a href="#h23-0-273" id="h23-0-273" class="i">+name = &quot;memchr&quot;
</a><a href="#h23-0-274" id="h23-0-274" class="i">+version = &quot;2.7.4&quot;
</a><a href="#h23-0-275" id="h23-0-275" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-276" id="h23-0-276" class="i">+checksum = &quot;78ca9ab1a0babb1e7d5695e3530886289c18cf2f87ec19a575a0abdce112e3a3&quot;
</a><a href="#h23-0-277" id="h23-0-277" class="i">+
</a><a href="#h23-0-278" id="h23-0-278" class="i">+[[package]]
</a><a href="#h23-0-279" id="h23-0-279" class="i">+name = &quot;miniz_oxide&quot;
</a><a href="#h23-0-280" id="h23-0-280" class="i">+version = &quot;0.7.4&quot;
</a><a href="#h23-0-281" id="h23-0-281" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-282" id="h23-0-282" class="i">+checksum = &quot;b8a240ddb74feaf34a79a7add65a741f3167852fba007066dcac1ca548d89c08&quot;
</a><a href="#h23-0-283" id="h23-0-283" class="i">+dependencies = [
</a><a href="#h23-0-284" id="h23-0-284" class="i">+ &quot;adler&quot;,
</a><a href="#h23-0-285" id="h23-0-285" class="i">+]
</a><a href="#h23-0-286" id="h23-0-286" class="i">+
</a><a href="#h23-0-287" id="h23-0-287" class="i">+[[package]]
</a><a href="#h23-0-288" id="h23-0-288" class="i">+name = &quot;nix&quot;
</a><a href="#h23-0-289" id="h23-0-289" class="i">+version = &quot;0.29.0&quot;
</a><a href="#h23-0-290" id="h23-0-290" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-291" id="h23-0-291" class="i">+checksum = &quot;71e2746dc3a24dd78b3cfcb7be93368c6de9963d30f43a6a73998a9cf4b17b46&quot;
</a><a href="#h23-0-292" id="h23-0-292" class="i">+dependencies = [
</a><a href="#h23-0-293" id="h23-0-293" class="i">+ &quot;bitflags&quot;,
</a><a href="#h23-0-294" id="h23-0-294" class="i">+ &quot;cfg-if&quot;,
</a><a href="#h23-0-295" id="h23-0-295" class="i">+ &quot;cfg_aliases&quot;,
</a><a href="#h23-0-296" id="h23-0-296" class="i">+ &quot;libc&quot;,
</a><a href="#h23-0-297" id="h23-0-297" class="i">+]
</a><a href="#h23-0-298" id="h23-0-298" class="i">+
</a><a href="#h23-0-299" id="h23-0-299" class="i">+[[package]]
</a><a href="#h23-0-300" id="h23-0-300" class="i">+name = &quot;num-traits&quot;
</a><a href="#h23-0-301" id="h23-0-301" class="i">+version = &quot;0.2.19&quot;
</a><a href="#h23-0-302" id="h23-0-302" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-303" id="h23-0-303" class="i">+checksum = &quot;071dfc062690e90b734c0b2273ce72ad0ffa95f0c74596bc250dcfd960262841&quot;
</a><a href="#h23-0-304" id="h23-0-304" class="i">+dependencies = [
</a><a href="#h23-0-305" id="h23-0-305" class="i">+ &quot;autocfg&quot;,
</a><a href="#h23-0-306" id="h23-0-306" class="i">+]
</a><a href="#h23-0-307" id="h23-0-307" class="i">+
</a><a href="#h23-0-308" id="h23-0-308" class="i">+[[package]]
</a><a href="#h23-0-309" id="h23-0-309" class="i">+name = &quot;once_cell&quot;
</a><a href="#h23-0-310" id="h23-0-310" class="i">+version = &quot;1.19.0&quot;
</a><a href="#h23-0-311" id="h23-0-311" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-312" id="h23-0-312" class="i">+checksum = &quot;3fdb12b2476b595f9358c5161aa467c2438859caa136dec86c26fdd2efe17b92&quot;
</a><a href="#h23-0-313" id="h23-0-313" class="i">+
</a><a href="#h23-0-314" id="h23-0-314" class="i">+[[package]]
</a><a href="#h23-0-315" id="h23-0-315" class="i">+name = &quot;paste&quot;
</a><a href="#h23-0-316" id="h23-0-316" class="i">+version = &quot;1.0.15&quot;
</a><a href="#h23-0-317" id="h23-0-317" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-318" id="h23-0-318" class="i">+checksum = &quot;57c0d7b74b563b49d38dae00a0c37d4d6de9b432382b2892f0574ddcae73fd0a&quot;
</a><a href="#h23-0-319" id="h23-0-319" class="i">+
</a><a href="#h23-0-320" id="h23-0-320" class="i">+[[package]]
</a><a href="#h23-0-321" id="h23-0-321" class="i">+name = &quot;proc-macro2&quot;
</a><a href="#h23-0-322" id="h23-0-322" class="i">+version = &quot;1.0.86&quot;
</a><a href="#h23-0-323" id="h23-0-323" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-324" id="h23-0-324" class="i">+checksum = &quot;5e719e8df665df0d1c8fbfd238015744736151d4445ec0836b8e628aae103b77&quot;
</a><a href="#h23-0-325" id="h23-0-325" class="i">+dependencies = [
</a><a href="#h23-0-326" id="h23-0-326" class="i">+ &quot;unicode-ident&quot;,
</a><a href="#h23-0-327" id="h23-0-327" class="i">+]
</a><a href="#h23-0-328" id="h23-0-328" class="i">+
</a><a href="#h23-0-329" id="h23-0-329" class="i">+[[package]]
</a><a href="#h23-0-330" id="h23-0-330" class="i">+name = &quot;procfs&quot;
</a><a href="#h23-0-331" id="h23-0-331" class="i">+version = &quot;0.16.0&quot;
</a><a href="#h23-0-332" id="h23-0-332" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-333" id="h23-0-333" class="i">+checksum = &quot;731e0d9356b0c25f16f33b5be79b1c57b562f141ebfcdb0ad8ac2c13a24293b4&quot;
</a><a href="#h23-0-334" id="h23-0-334" class="i">+dependencies = [
</a><a href="#h23-0-335" id="h23-0-335" class="i">+ &quot;bitflags&quot;,
</a><a href="#h23-0-336" id="h23-0-336" class="i">+ &quot;chrono&quot;,
</a><a href="#h23-0-337" id="h23-0-337" class="i">+ &quot;flate2&quot;,
</a><a href="#h23-0-338" id="h23-0-338" class="i">+ &quot;hex&quot;,
</a><a href="#h23-0-339" id="h23-0-339" class="i">+ &quot;lazy_static&quot;,
</a><a href="#h23-0-340" id="h23-0-340" class="i">+ &quot;procfs-core&quot;,
</a><a href="#h23-0-341" id="h23-0-341" class="i">+ &quot;rustix&quot;,
</a><a href="#h23-0-342" id="h23-0-342" class="i">+]
</a><a href="#h23-0-343" id="h23-0-343" class="i">+
</a><a href="#h23-0-344" id="h23-0-344" class="i">+[[package]]
</a><a href="#h23-0-345" id="h23-0-345" class="i">+name = &quot;procfs-core&quot;
</a><a href="#h23-0-346" id="h23-0-346" class="i">+version = &quot;0.16.0&quot;
</a><a href="#h23-0-347" id="h23-0-347" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-348" id="h23-0-348" class="i">+checksum = &quot;2d3554923a69f4ce04c4a754260c338f505ce22642d3830e049a399fc2059a29&quot;
</a><a href="#h23-0-349" id="h23-0-349" class="i">+dependencies = [
</a><a href="#h23-0-350" id="h23-0-350" class="i">+ &quot;bitflags&quot;,
</a><a href="#h23-0-351" id="h23-0-351" class="i">+ &quot;chrono&quot;,
</a><a href="#h23-0-352" id="h23-0-352" class="i">+ &quot;hex&quot;,
</a><a href="#h23-0-353" id="h23-0-353" class="i">+]
</a><a href="#h23-0-354" id="h23-0-354" class="i">+
</a><a href="#h23-0-355" id="h23-0-355" class="i">+[[package]]
</a><a href="#h23-0-356" id="h23-0-356" class="i">+name = &quot;quote&quot;
</a><a href="#h23-0-357" id="h23-0-357" class="i">+version = &quot;1.0.36&quot;
</a><a href="#h23-0-358" id="h23-0-358" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-359" id="h23-0-359" class="i">+checksum = &quot;0fa76aaf39101c457836aec0ce2316dbdc3ab723cdda1c6bd4e6ad4208acaca7&quot;
</a><a href="#h23-0-360" id="h23-0-360" class="i">+dependencies = [
</a><a href="#h23-0-361" id="h23-0-361" class="i">+ &quot;proc-macro2&quot;,
</a><a href="#h23-0-362" id="h23-0-362" class="i">+]
</a><a href="#h23-0-363" id="h23-0-363" class="i">+
</a><a href="#h23-0-364" id="h23-0-364" class="i">+[[package]]
</a><a href="#h23-0-365" id="h23-0-365" class="i">+name = &quot;regex&quot;
</a><a href="#h23-0-366" id="h23-0-366" class="i">+version = &quot;1.10.5&quot;
</a><a href="#h23-0-367" id="h23-0-367" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-368" id="h23-0-368" class="i">+checksum = &quot;b91213439dad192326a0d7c6ee3955910425f441d7038e0d6933b0aec5c4517f&quot;
</a><a href="#h23-0-369" id="h23-0-369" class="i">+dependencies = [
</a><a href="#h23-0-370" id="h23-0-370" class="i">+ &quot;aho-corasick&quot;,
</a><a href="#h23-0-371" id="h23-0-371" class="i">+ &quot;memchr&quot;,
</a><a href="#h23-0-372" id="h23-0-372" class="i">+ &quot;regex-automata&quot;,
</a><a href="#h23-0-373" id="h23-0-373" class="i">+ &quot;regex-syntax&quot;,
</a><a href="#h23-0-374" id="h23-0-374" class="i">+]
</a><a href="#h23-0-375" id="h23-0-375" class="i">+
</a><a href="#h23-0-376" id="h23-0-376" class="i">+[[package]]
</a><a href="#h23-0-377" id="h23-0-377" class="i">+name = &quot;regex-automata&quot;
</a><a href="#h23-0-378" id="h23-0-378" class="i">+version = &quot;0.4.7&quot;
</a><a href="#h23-0-379" id="h23-0-379" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-380" id="h23-0-380" class="i">+checksum = &quot;38caf58cc5ef2fed281f89292ef23f6365465ed9a41b7a7754eb4e26496c92df&quot;
</a><a href="#h23-0-381" id="h23-0-381" class="i">+dependencies = [
</a><a href="#h23-0-382" id="h23-0-382" class="i">+ &quot;aho-corasick&quot;,
</a><a href="#h23-0-383" id="h23-0-383" class="i">+ &quot;memchr&quot;,
</a><a href="#h23-0-384" id="h23-0-384" class="i">+ &quot;regex-syntax&quot;,
</a><a href="#h23-0-385" id="h23-0-385" class="i">+]
</a><a href="#h23-0-386" id="h23-0-386" class="i">+
</a><a href="#h23-0-387" id="h23-0-387" class="i">+[[package]]
</a><a href="#h23-0-388" id="h23-0-388" class="i">+name = &quot;regex-syntax&quot;
</a><a href="#h23-0-389" id="h23-0-389" class="i">+version = &quot;0.8.4&quot;
</a><a href="#h23-0-390" id="h23-0-390" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-391" id="h23-0-391" class="i">+checksum = &quot;7a66a03ae7c801facd77a29370b4faec201768915ac14a721ba36f20bc9c209b&quot;
</a><a href="#h23-0-392" id="h23-0-392" class="i">+
</a><a href="#h23-0-393" id="h23-0-393" class="i">+[[package]]
</a><a href="#h23-0-394" id="h23-0-394" class="i">+name = &quot;rustix&quot;
</a><a href="#h23-0-395" id="h23-0-395" class="i">+version = &quot;0.38.34&quot;
</a><a href="#h23-0-396" id="h23-0-396" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-397" id="h23-0-397" class="i">+checksum = &quot;70dc5ec042f7a43c4a73241207cecc9873a06d45debb38b329f8541d85c2730f&quot;
</a><a href="#h23-0-398" id="h23-0-398" class="i">+dependencies = [
</a><a href="#h23-0-399" id="h23-0-399" class="i">+ &quot;bitflags&quot;,
</a><a href="#h23-0-400" id="h23-0-400" class="i">+ &quot;errno&quot;,
</a><a href="#h23-0-401" id="h23-0-401" class="i">+ &quot;libc&quot;,
</a><a href="#h23-0-402" id="h23-0-402" class="i">+ &quot;linux-raw-sys&quot;,
</a><a href="#h23-0-403" id="h23-0-403" class="i">+ &quot;windows-sys 0.52.0&quot;,
</a><a href="#h23-0-404" id="h23-0-404" class="i">+]
</a><a href="#h23-0-405" id="h23-0-405" class="i">+
</a><a href="#h23-0-406" id="h23-0-406" class="i">+[[package]]
</a><a href="#h23-0-407" id="h23-0-407" class="i">+name = &quot;ryu&quot;
</a><a href="#h23-0-408" id="h23-0-408" class="i">+version = &quot;1.0.18&quot;
</a><a href="#h23-0-409" id="h23-0-409" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-410" id="h23-0-410" class="i">+checksum = &quot;f3cb5ba0dc43242ce17de99c180e96db90b235b8a9fdc9543c96d2209116bd9f&quot;
</a><a href="#h23-0-411" id="h23-0-411" class="i">+
</a><a href="#h23-0-412" id="h23-0-412" class="i">+[[package]]
</a><a href="#h23-0-413" id="h23-0-413" class="i">+name = &quot;same-file&quot;
</a><a href="#h23-0-414" id="h23-0-414" class="i">+version = &quot;1.0.6&quot;
</a><a href="#h23-0-415" id="h23-0-415" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-416" id="h23-0-416" class="i">+checksum = &quot;93fc1dc3aaa9bfed95e02e6eadabb4baf7e3078b0bd1b4d7b6b0b68378900502&quot;
</a><a href="#h23-0-417" id="h23-0-417" class="i">+dependencies = [
</a><a href="#h23-0-418" id="h23-0-418" class="i">+ &quot;winapi-util&quot;,
</a><a href="#h23-0-419" id="h23-0-419" class="i">+]
</a><a href="#h23-0-420" id="h23-0-420" class="i">+
</a><a href="#h23-0-421" id="h23-0-421" class="i">+[[package]]
</a><a href="#h23-0-422" id="h23-0-422" class="i">+name = &quot;serde&quot;
</a><a href="#h23-0-423" id="h23-0-423" class="i">+version = &quot;1.0.204&quot;
</a><a href="#h23-0-424" id="h23-0-424" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-425" id="h23-0-425" class="i">+checksum = &quot;bc76f558e0cbb2a839d37354c575f1dc3fdc6546b5be373ba43d95f231bf7c12&quot;
</a><a href="#h23-0-426" id="h23-0-426" class="i">+dependencies = [
</a><a href="#h23-0-427" id="h23-0-427" class="i">+ &quot;serde_derive&quot;,
</a><a href="#h23-0-428" id="h23-0-428" class="i">+]
</a><a href="#h23-0-429" id="h23-0-429" class="i">+
</a><a href="#h23-0-430" id="h23-0-430" class="i">+[[package]]
</a><a href="#h23-0-431" id="h23-0-431" class="i">+name = &quot;serde_derive&quot;
</a><a href="#h23-0-432" id="h23-0-432" class="i">+version = &quot;1.0.204&quot;
</a><a href="#h23-0-433" id="h23-0-433" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-434" id="h23-0-434" class="i">+checksum = &quot;e0cd7e117be63d3c3678776753929474f3b04a43a080c744d6b0ae2a8c28e222&quot;
</a><a href="#h23-0-435" id="h23-0-435" class="i">+dependencies = [
</a><a href="#h23-0-436" id="h23-0-436" class="i">+ &quot;proc-macro2&quot;,
</a><a href="#h23-0-437" id="h23-0-437" class="i">+ &quot;quote&quot;,
</a><a href="#h23-0-438" id="h23-0-438" class="i">+ &quot;syn&quot;,
</a><a href="#h23-0-439" id="h23-0-439" class="i">+]
</a><a href="#h23-0-440" id="h23-0-440" class="i">+
</a><a href="#h23-0-441" id="h23-0-441" class="i">+[[package]]
</a><a href="#h23-0-442" id="h23-0-442" class="i">+name = &quot;serde_json&quot;
</a><a href="#h23-0-443" id="h23-0-443" class="i">+version = &quot;1.0.120&quot;
</a><a href="#h23-0-444" id="h23-0-444" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-445" id="h23-0-445" class="i">+checksum = &quot;4e0d21c9a8cae1235ad58a00c11cb40d4b1e5c784f1ef2c537876ed6ffd8b7c5&quot;
</a><a href="#h23-0-446" id="h23-0-446" class="i">+dependencies = [
</a><a href="#h23-0-447" id="h23-0-447" class="i">+ &quot;itoa&quot;,
</a><a href="#h23-0-448" id="h23-0-448" class="i">+ &quot;ryu&quot;,
</a><a href="#h23-0-449" id="h23-0-449" class="i">+ &quot;serde&quot;,
</a><a href="#h23-0-450" id="h23-0-450" class="i">+]
</a><a href="#h23-0-451" id="h23-0-451" class="i">+
</a><a href="#h23-0-452" id="h23-0-452" class="i">+[[package]]
</a><a href="#h23-0-453" id="h23-0-453" class="i">+name = &quot;snapenhance&quot;
</a><a href="#h23-0-454" id="h23-0-454" class="i">+version = &quot;0.1.0&quot;
</a><a href="#h23-0-455" id="h23-0-455" class="i">+dependencies = [
</a><a href="#h23-0-456" id="h23-0-456" class="i">+ &quot;android_logger&quot;,
</a><a href="#h23-0-457" id="h23-0-457" class="i">+ &quot;dobby-rs&quot;,
</a><a href="#h23-0-458" id="h23-0-458" class="i">+ &quot;jni&quot;,
</a><a href="#h23-0-459" id="h23-0-459" class="i">+ &quot;log&quot;,
</a><a href="#h23-0-460" id="h23-0-460" class="i">+ &quot;nix&quot;,
</a><a href="#h23-0-461" id="h23-0-461" class="i">+ &quot;once_cell&quot;,
</a><a href="#h23-0-462" id="h23-0-462" class="i">+ &quot;paste&quot;,
</a><a href="#h23-0-463" id="h23-0-463" class="i">+ &quot;procfs&quot;,
</a><a href="#h23-0-464" id="h23-0-464" class="i">+ &quot;serde_json&quot;,
</a><a href="#h23-0-465" id="h23-0-465" class="i">+]
</a><a href="#h23-0-466" id="h23-0-466" class="i">+
</a><a href="#h23-0-467" id="h23-0-467" class="i">+[[package]]
</a><a href="#h23-0-468" id="h23-0-468" class="i">+name = &quot;syn&quot;
</a><a href="#h23-0-469" id="h23-0-469" class="i">+version = &quot;2.0.72&quot;
</a><a href="#h23-0-470" id="h23-0-470" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-471" id="h23-0-471" class="i">+checksum = &quot;dc4b9b9bf2add8093d3f2c0204471e951b2285580335de42f9d2534f3ae7a8af&quot;
</a><a href="#h23-0-472" id="h23-0-472" class="i">+dependencies = [
</a><a href="#h23-0-473" id="h23-0-473" class="i">+ &quot;proc-macro2&quot;,
</a><a href="#h23-0-474" id="h23-0-474" class="i">+ &quot;quote&quot;,
</a><a href="#h23-0-475" id="h23-0-475" class="i">+ &quot;unicode-ident&quot;,
</a><a href="#h23-0-476" id="h23-0-476" class="i">+]
</a><a href="#h23-0-477" id="h23-0-477" class="i">+
</a><a href="#h23-0-478" id="h23-0-478" class="i">+[[package]]
</a><a href="#h23-0-479" id="h23-0-479" class="i">+name = &quot;thiserror&quot;
</a><a href="#h23-0-480" id="h23-0-480" class="i">+version = &quot;1.0.63&quot;
</a><a href="#h23-0-481" id="h23-0-481" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-482" id="h23-0-482" class="i">+checksum = &quot;c0342370b38b6a11b6cc11d6a805569958d54cfa061a29969c3b5ce2ea405724&quot;
</a><a href="#h23-0-483" id="h23-0-483" class="i">+dependencies = [
</a><a href="#h23-0-484" id="h23-0-484" class="i">+ &quot;thiserror-impl&quot;,
</a><a href="#h23-0-485" id="h23-0-485" class="i">+]
</a><a href="#h23-0-486" id="h23-0-486" class="i">+
</a><a href="#h23-0-487" id="h23-0-487" class="i">+[[package]]
</a><a href="#h23-0-488" id="h23-0-488" class="i">+name = &quot;thiserror-impl&quot;
</a><a href="#h23-0-489" id="h23-0-489" class="i">+version = &quot;1.0.63&quot;
</a><a href="#h23-0-490" id="h23-0-490" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-491" id="h23-0-491" class="i">+checksum = &quot;a4558b58466b9ad7ca0f102865eccc95938dca1a74a856f2b57b6629050da261&quot;
</a><a href="#h23-0-492" id="h23-0-492" class="i">+dependencies = [
</a><a href="#h23-0-493" id="h23-0-493" class="i">+ &quot;proc-macro2&quot;,
</a><a href="#h23-0-494" id="h23-0-494" class="i">+ &quot;quote&quot;,
</a><a href="#h23-0-495" id="h23-0-495" class="i">+ &quot;syn&quot;,
</a><a href="#h23-0-496" id="h23-0-496" class="i">+]
</a><a href="#h23-0-497" id="h23-0-497" class="i">+
</a><a href="#h23-0-498" id="h23-0-498" class="i">+[[package]]
</a><a href="#h23-0-499" id="h23-0-499" class="i">+name = &quot;unicode-ident&quot;
</a><a href="#h23-0-500" id="h23-0-500" class="i">+version = &quot;1.0.12&quot;
</a><a href="#h23-0-501" id="h23-0-501" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-502" id="h23-0-502" class="i">+checksum = &quot;3354b9ac3fae1ff6755cb6db53683adb661634f67557942dea4facebec0fee4b&quot;
</a><a href="#h23-0-503" id="h23-0-503" class="i">+
</a><a href="#h23-0-504" id="h23-0-504" class="i">+[[package]]
</a><a href="#h23-0-505" id="h23-0-505" class="i">+name = &quot;walkdir&quot;
</a><a href="#h23-0-506" id="h23-0-506" class="i">+version = &quot;2.5.0&quot;
</a><a href="#h23-0-507" id="h23-0-507" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-508" id="h23-0-508" class="i">+checksum = &quot;29790946404f91d9c5d06f9874efddea1dc06c5efe94541a7d6863108e3a5e4b&quot;
</a><a href="#h23-0-509" id="h23-0-509" class="i">+dependencies = [
</a><a href="#h23-0-510" id="h23-0-510" class="i">+ &quot;same-file&quot;,
</a><a href="#h23-0-511" id="h23-0-511" class="i">+ &quot;winapi-util&quot;,
</a><a href="#h23-0-512" id="h23-0-512" class="i">+]
</a><a href="#h23-0-513" id="h23-0-513" class="i">+
</a><a href="#h23-0-514" id="h23-0-514" class="i">+[[package]]
</a><a href="#h23-0-515" id="h23-0-515" class="i">+name = &quot;wasm-bindgen&quot;
</a><a href="#h23-0-516" id="h23-0-516" class="i">+version = &quot;0.2.92&quot;
</a><a href="#h23-0-517" id="h23-0-517" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-518" id="h23-0-518" class="i">+checksum = &quot;4be2531df63900aeb2bca0daaaddec08491ee64ceecbee5076636a3b026795a8&quot;
</a><a href="#h23-0-519" id="h23-0-519" class="i">+dependencies = [
</a><a href="#h23-0-520" id="h23-0-520" class="i">+ &quot;cfg-if&quot;,
</a><a href="#h23-0-521" id="h23-0-521" class="i">+ &quot;wasm-bindgen-macro&quot;,
</a><a href="#h23-0-522" id="h23-0-522" class="i">+]
</a><a href="#h23-0-523" id="h23-0-523" class="i">+
</a><a href="#h23-0-524" id="h23-0-524" class="i">+[[package]]
</a><a href="#h23-0-525" id="h23-0-525" class="i">+name = &quot;wasm-bindgen-backend&quot;
</a><a href="#h23-0-526" id="h23-0-526" class="i">+version = &quot;0.2.92&quot;
</a><a href="#h23-0-527" id="h23-0-527" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-528" id="h23-0-528" class="i">+checksum = &quot;614d787b966d3989fa7bb98a654e369c762374fd3213d212cfc0251257e747da&quot;
</a><a href="#h23-0-529" id="h23-0-529" class="i">+dependencies = [
</a><a href="#h23-0-530" id="h23-0-530" class="i">+ &quot;bumpalo&quot;,
</a><a href="#h23-0-531" id="h23-0-531" class="i">+ &quot;log&quot;,
</a><a href="#h23-0-532" id="h23-0-532" class="i">+ &quot;once_cell&quot;,
</a><a href="#h23-0-533" id="h23-0-533" class="i">+ &quot;proc-macro2&quot;,
</a><a href="#h23-0-534" id="h23-0-534" class="i">+ &quot;quote&quot;,
</a><a href="#h23-0-535" id="h23-0-535" class="i">+ &quot;syn&quot;,
</a><a href="#h23-0-536" id="h23-0-536" class="i">+ &quot;wasm-bindgen-shared&quot;,
</a><a href="#h23-0-537" id="h23-0-537" class="i">+]
</a><a href="#h23-0-538" id="h23-0-538" class="i">+
</a><a href="#h23-0-539" id="h23-0-539" class="i">+[[package]]
</a><a href="#h23-0-540" id="h23-0-540" class="i">+name = &quot;wasm-bindgen-macro&quot;
</a><a href="#h23-0-541" id="h23-0-541" class="i">+version = &quot;0.2.92&quot;
</a><a href="#h23-0-542" id="h23-0-542" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-543" id="h23-0-543" class="i">+checksum = &quot;a1f8823de937b71b9460c0c34e25f3da88250760bec0ebac694b49997550d726&quot;
</a><a href="#h23-0-544" id="h23-0-544" class="i">+dependencies = [
</a><a href="#h23-0-545" id="h23-0-545" class="i">+ &quot;quote&quot;,
</a><a href="#h23-0-546" id="h23-0-546" class="i">+ &quot;wasm-bindgen-macro-support&quot;,
</a><a href="#h23-0-547" id="h23-0-547" class="i">+]
</a><a href="#h23-0-548" id="h23-0-548" class="i">+
</a><a href="#h23-0-549" id="h23-0-549" class="i">+[[package]]
</a><a href="#h23-0-550" id="h23-0-550" class="i">+name = &quot;wasm-bindgen-macro-support&quot;
</a><a href="#h23-0-551" id="h23-0-551" class="i">+version = &quot;0.2.92&quot;
</a><a href="#h23-0-552" id="h23-0-552" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-553" id="h23-0-553" class="i">+checksum = &quot;e94f17b526d0a461a191c78ea52bbce64071ed5c04c9ffe424dcb38f74171bb7&quot;
</a><a href="#h23-0-554" id="h23-0-554" class="i">+dependencies = [
</a><a href="#h23-0-555" id="h23-0-555" class="i">+ &quot;proc-macro2&quot;,
</a><a href="#h23-0-556" id="h23-0-556" class="i">+ &quot;quote&quot;,
</a><a href="#h23-0-557" id="h23-0-557" class="i">+ &quot;syn&quot;,
</a><a href="#h23-0-558" id="h23-0-558" class="i">+ &quot;wasm-bindgen-backend&quot;,
</a><a href="#h23-0-559" id="h23-0-559" class="i">+ &quot;wasm-bindgen-shared&quot;,
</a><a href="#h23-0-560" id="h23-0-560" class="i">+]
</a><a href="#h23-0-561" id="h23-0-561" class="i">+
</a><a href="#h23-0-562" id="h23-0-562" class="i">+[[package]]
</a><a href="#h23-0-563" id="h23-0-563" class="i">+name = &quot;wasm-bindgen-shared&quot;
</a><a href="#h23-0-564" id="h23-0-564" class="i">+version = &quot;0.2.92&quot;
</a><a href="#h23-0-565" id="h23-0-565" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-566" id="h23-0-566" class="i">+checksum = &quot;af190c94f2773fdb3729c55b007a722abb5384da03bc0986df4c289bf5567e96&quot;
</a><a href="#h23-0-567" id="h23-0-567" class="i">+
</a><a href="#h23-0-568" id="h23-0-568" class="i">+[[package]]
</a><a href="#h23-0-569" id="h23-0-569" class="i">+name = &quot;winapi-util&quot;
</a><a href="#h23-0-570" id="h23-0-570" class="i">+version = &quot;0.1.8&quot;
</a><a href="#h23-0-571" id="h23-0-571" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-572" id="h23-0-572" class="i">+checksum = &quot;4d4cc384e1e73b93bafa6fb4f1df8c41695c8a91cf9c4c64358067d15a7b6c6b&quot;
</a><a href="#h23-0-573" id="h23-0-573" class="i">+dependencies = [
</a><a href="#h23-0-574" id="h23-0-574" class="i">+ &quot;windows-sys 0.52.0&quot;,
</a><a href="#h23-0-575" id="h23-0-575" class="i">+]
</a><a href="#h23-0-576" id="h23-0-576" class="i">+
</a><a href="#h23-0-577" id="h23-0-577" class="i">+[[package]]
</a><a href="#h23-0-578" id="h23-0-578" class="i">+name = &quot;windows-core&quot;
</a><a href="#h23-0-579" id="h23-0-579" class="i">+version = &quot;0.52.0&quot;
</a><a href="#h23-0-580" id="h23-0-580" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-581" id="h23-0-581" class="i">+checksum = &quot;33ab640c8d7e35bf8ba19b884ba838ceb4fba93a4e8c65a9059d08afcfc683d9&quot;
</a><a href="#h23-0-582" id="h23-0-582" class="i">+dependencies = [
</a><a href="#h23-0-583" id="h23-0-583" class="i">+ &quot;windows-targets 0.52.6&quot;,
</a><a href="#h23-0-584" id="h23-0-584" class="i">+]
</a><a href="#h23-0-585" id="h23-0-585" class="i">+
</a><a href="#h23-0-586" id="h23-0-586" class="i">+[[package]]
</a><a href="#h23-0-587" id="h23-0-587" class="i">+name = &quot;windows-sys&quot;
</a><a href="#h23-0-588" id="h23-0-588" class="i">+version = &quot;0.45.0&quot;
</a><a href="#h23-0-589" id="h23-0-589" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-590" id="h23-0-590" class="i">+checksum = &quot;75283be5efb2831d37ea142365f009c02ec203cd29a3ebecbc093d52315b66d0&quot;
</a><a href="#h23-0-591" id="h23-0-591" class="i">+dependencies = [
</a><a href="#h23-0-592" id="h23-0-592" class="i">+ &quot;windows-targets 0.42.2&quot;,
</a><a href="#h23-0-593" id="h23-0-593" class="i">+]
</a><a href="#h23-0-594" id="h23-0-594" class="i">+
</a><a href="#h23-0-595" id="h23-0-595" class="i">+[[package]]
</a><a href="#h23-0-596" id="h23-0-596" class="i">+name = &quot;windows-sys&quot;
</a><a href="#h23-0-597" id="h23-0-597" class="i">+version = &quot;0.52.0&quot;
</a><a href="#h23-0-598" id="h23-0-598" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-599" id="h23-0-599" class="i">+checksum = &quot;282be5f36a8ce781fad8c8ae18fa3f9beff57ec1b52cb3de0789201425d9a33d&quot;
</a><a href="#h23-0-600" id="h23-0-600" class="i">+dependencies = [
</a><a href="#h23-0-601" id="h23-0-601" class="i">+ &quot;windows-targets 0.52.6&quot;,
</a><a href="#h23-0-602" id="h23-0-602" class="i">+]
</a><a href="#h23-0-603" id="h23-0-603" class="i">+
</a><a href="#h23-0-604" id="h23-0-604" class="i">+[[package]]
</a><a href="#h23-0-605" id="h23-0-605" class="i">+name = &quot;windows-targets&quot;
</a><a href="#h23-0-606" id="h23-0-606" class="i">+version = &quot;0.42.2&quot;
</a><a href="#h23-0-607" id="h23-0-607" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-608" id="h23-0-608" class="i">+checksum = &quot;8e5180c00cd44c9b1c88adb3693291f1cd93605ded80c250a75d472756b4d071&quot;
</a><a href="#h23-0-609" id="h23-0-609" class="i">+dependencies = [
</a><a href="#h23-0-610" id="h23-0-610" class="i">+ &quot;windows_aarch64_gnullvm 0.42.2&quot;,
</a><a href="#h23-0-611" id="h23-0-611" class="i">+ &quot;windows_aarch64_msvc 0.42.2&quot;,
</a><a href="#h23-0-612" id="h23-0-612" class="i">+ &quot;windows_i686_gnu 0.42.2&quot;,
</a><a href="#h23-0-613" id="h23-0-613" class="i">+ &quot;windows_i686_msvc 0.42.2&quot;,
</a><a href="#h23-0-614" id="h23-0-614" class="i">+ &quot;windows_x86_64_gnu 0.42.2&quot;,
</a><a href="#h23-0-615" id="h23-0-615" class="i">+ &quot;windows_x86_64_gnullvm 0.42.2&quot;,
</a><a href="#h23-0-616" id="h23-0-616" class="i">+ &quot;windows_x86_64_msvc 0.42.2&quot;,
</a><a href="#h23-0-617" id="h23-0-617" class="i">+]
</a><a href="#h23-0-618" id="h23-0-618" class="i">+
</a><a href="#h23-0-619" id="h23-0-619" class="i">+[[package]]
</a><a href="#h23-0-620" id="h23-0-620" class="i">+name = &quot;windows-targets&quot;
</a><a href="#h23-0-621" id="h23-0-621" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-622" id="h23-0-622" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-623" id="h23-0-623" class="i">+checksum = &quot;9b724f72796e036ab90c1021d4780d4d3d648aca59e491e6b98e725b84e99973&quot;
</a><a href="#h23-0-624" id="h23-0-624" class="i">+dependencies = [
</a><a href="#h23-0-625" id="h23-0-625" class="i">+ &quot;windows_aarch64_gnullvm 0.52.6&quot;,
</a><a href="#h23-0-626" id="h23-0-626" class="i">+ &quot;windows_aarch64_msvc 0.52.6&quot;,
</a><a href="#h23-0-627" id="h23-0-627" class="i">+ &quot;windows_i686_gnu 0.52.6&quot;,
</a><a href="#h23-0-628" id="h23-0-628" class="i">+ &quot;windows_i686_gnullvm&quot;,
</a><a href="#h23-0-629" id="h23-0-629" class="i">+ &quot;windows_i686_msvc 0.52.6&quot;,
</a><a href="#h23-0-630" id="h23-0-630" class="i">+ &quot;windows_x86_64_gnu 0.52.6&quot;,
</a><a href="#h23-0-631" id="h23-0-631" class="i">+ &quot;windows_x86_64_gnullvm 0.52.6&quot;,
</a><a href="#h23-0-632" id="h23-0-632" class="i">+ &quot;windows_x86_64_msvc 0.52.6&quot;,
</a><a href="#h23-0-633" id="h23-0-633" class="i">+]
</a><a href="#h23-0-634" id="h23-0-634" class="i">+
</a><a href="#h23-0-635" id="h23-0-635" class="i">+[[package]]
</a><a href="#h23-0-636" id="h23-0-636" class="i">+name = &quot;windows_aarch64_gnullvm&quot;
</a><a href="#h23-0-637" id="h23-0-637" class="i">+version = &quot;0.42.2&quot;
</a><a href="#h23-0-638" id="h23-0-638" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-639" id="h23-0-639" class="i">+checksum = &quot;597a5118570b68bc08d8d59125332c54f1ba9d9adeedeef5b99b02ba2b0698f8&quot;
</a><a href="#h23-0-640" id="h23-0-640" class="i">+
</a><a href="#h23-0-641" id="h23-0-641" class="i">+[[package]]
</a><a href="#h23-0-642" id="h23-0-642" class="i">+name = &quot;windows_aarch64_gnullvm&quot;
</a><a href="#h23-0-643" id="h23-0-643" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-644" id="h23-0-644" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-645" id="h23-0-645" class="i">+checksum = &quot;32a4622180e7a0ec044bb555404c800bc9fd9ec262ec147edd5989ccd0c02cd3&quot;
</a><a href="#h23-0-646" id="h23-0-646" class="i">+
</a><a href="#h23-0-647" id="h23-0-647" class="i">+[[package]]
</a><a href="#h23-0-648" id="h23-0-648" class="i">+name = &quot;windows_aarch64_msvc&quot;
</a><a href="#h23-0-649" id="h23-0-649" class="i">+version = &quot;0.42.2&quot;
</a><a href="#h23-0-650" id="h23-0-650" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-651" id="h23-0-651" class="i">+checksum = &quot;e08e8864a60f06ef0d0ff4ba04124db8b0fb3be5776a5cd47641e942e58c4d43&quot;
</a><a href="#h23-0-652" id="h23-0-652" class="i">+
</a><a href="#h23-0-653" id="h23-0-653" class="i">+[[package]]
</a><a href="#h23-0-654" id="h23-0-654" class="i">+name = &quot;windows_aarch64_msvc&quot;
</a><a href="#h23-0-655" id="h23-0-655" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-656" id="h23-0-656" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-657" id="h23-0-657" class="i">+checksum = &quot;09ec2a7bb152e2252b53fa7803150007879548bc709c039df7627cabbd05d469&quot;
</a><a href="#h23-0-658" id="h23-0-658" class="i">+
</a><a href="#h23-0-659" id="h23-0-659" class="i">+[[package]]
</a><a href="#h23-0-660" id="h23-0-660" class="i">+name = &quot;windows_i686_gnu&quot;
</a><a href="#h23-0-661" id="h23-0-661" class="i">+version = &quot;0.42.2&quot;
</a><a href="#h23-0-662" id="h23-0-662" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-663" id="h23-0-663" class="i">+checksum = &quot;c61d927d8da41da96a81f029489353e68739737d3beca43145c8afec9a31a84f&quot;
</a><a href="#h23-0-664" id="h23-0-664" class="i">+
</a><a href="#h23-0-665" id="h23-0-665" class="i">+[[package]]
</a><a href="#h23-0-666" id="h23-0-666" class="i">+name = &quot;windows_i686_gnu&quot;
</a><a href="#h23-0-667" id="h23-0-667" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-668" id="h23-0-668" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-669" id="h23-0-669" class="i">+checksum = &quot;8e9b5ad5ab802e97eb8e295ac6720e509ee4c243f69d781394014ebfe8bbfa0b&quot;
</a><a href="#h23-0-670" id="h23-0-670" class="i">+
</a><a href="#h23-0-671" id="h23-0-671" class="i">+[[package]]
</a><a href="#h23-0-672" id="h23-0-672" class="i">+name = &quot;windows_i686_gnullvm&quot;
</a><a href="#h23-0-673" id="h23-0-673" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-674" id="h23-0-674" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-675" id="h23-0-675" class="i">+checksum = &quot;0eee52d38c090b3caa76c563b86c3a4bd71ef1a819287c19d586d7334ae8ed66&quot;
</a><a href="#h23-0-676" id="h23-0-676" class="i">+
</a><a href="#h23-0-677" id="h23-0-677" class="i">+[[package]]
</a><a href="#h23-0-678" id="h23-0-678" class="i">+name = &quot;windows_i686_msvc&quot;
</a><a href="#h23-0-679" id="h23-0-679" class="i">+version = &quot;0.42.2&quot;
</a><a href="#h23-0-680" id="h23-0-680" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-681" id="h23-0-681" class="i">+checksum = &quot;44d840b6ec649f480a41c8d80f9c65108b92d89345dd94027bfe06ac444d1060&quot;
</a><a href="#h23-0-682" id="h23-0-682" class="i">+
</a><a href="#h23-0-683" id="h23-0-683" class="i">+[[package]]
</a><a href="#h23-0-684" id="h23-0-684" class="i">+name = &quot;windows_i686_msvc&quot;
</a><a href="#h23-0-685" id="h23-0-685" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-686" id="h23-0-686" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-687" id="h23-0-687" class="i">+checksum = &quot;240948bc05c5e7c6dabba28bf89d89ffce3e303022809e73deaefe4f6ec56c66&quot;
</a><a href="#h23-0-688" id="h23-0-688" class="i">+
</a><a href="#h23-0-689" id="h23-0-689" class="i">+[[package]]
</a><a href="#h23-0-690" id="h23-0-690" class="i">+name = &quot;windows_x86_64_gnu&quot;
</a><a href="#h23-0-691" id="h23-0-691" class="i">+version = &quot;0.42.2&quot;
</a><a href="#h23-0-692" id="h23-0-692" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-693" id="h23-0-693" class="i">+checksum = &quot;8de912b8b8feb55c064867cf047dda097f92d51efad5b491dfb98f6bbb70cb36&quot;
</a><a href="#h23-0-694" id="h23-0-694" class="i">+
</a><a href="#h23-0-695" id="h23-0-695" class="i">+[[package]]
</a><a href="#h23-0-696" id="h23-0-696" class="i">+name = &quot;windows_x86_64_gnu&quot;
</a><a href="#h23-0-697" id="h23-0-697" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-698" id="h23-0-698" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-699" id="h23-0-699" class="i">+checksum = &quot;147a5c80aabfbf0c7d901cb5895d1de30ef2907eb21fbbab29ca94c5b08b1a78&quot;
</a><a href="#h23-0-700" id="h23-0-700" class="i">+
</a><a href="#h23-0-701" id="h23-0-701" class="i">+[[package]]
</a><a href="#h23-0-702" id="h23-0-702" class="i">+name = &quot;windows_x86_64_gnullvm&quot;
</a><a href="#h23-0-703" id="h23-0-703" class="i">+version = &quot;0.42.2&quot;
</a><a href="#h23-0-704" id="h23-0-704" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-705" id="h23-0-705" class="i">+checksum = &quot;26d41b46a36d453748aedef1486d5c7a85db22e56aff34643984ea85514e94a3&quot;
</a><a href="#h23-0-706" id="h23-0-706" class="i">+
</a><a href="#h23-0-707" id="h23-0-707" class="i">+[[package]]
</a><a href="#h23-0-708" id="h23-0-708" class="i">+name = &quot;windows_x86_64_gnullvm&quot;
</a><a href="#h23-0-709" id="h23-0-709" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-710" id="h23-0-710" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-711" id="h23-0-711" class="i">+checksum = &quot;24d5b23dc417412679681396f2b49f3de8c1473deb516bd34410872eff51ed0d&quot;
</a><a href="#h23-0-712" id="h23-0-712" class="i">+
</a><a href="#h23-0-713" id="h23-0-713" class="i">+[[package]]
</a><a href="#h23-0-714" id="h23-0-714" class="i">+name = &quot;windows_x86_64_msvc&quot;
</a><a href="#h23-0-715" id="h23-0-715" class="i">+version = &quot;0.42.2&quot;
</a><a href="#h23-0-716" id="h23-0-716" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-717" id="h23-0-717" class="i">+checksum = &quot;9aec5da331524158c6d1a4ac0ab1541149c0b9505fde06423b02f5ef0106b9f0&quot;
</a><a href="#h23-0-718" id="h23-0-718" class="i">+
</a><a href="#h23-0-719" id="h23-0-719" class="i">+[[package]]
</a><a href="#h23-0-720" id="h23-0-720" class="i">+name = &quot;windows_x86_64_msvc&quot;
</a><a href="#h23-0-721" id="h23-0-721" class="i">+version = &quot;0.52.6&quot;
</a><a href="#h23-0-722" id="h23-0-722" class="i">+source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
</a><a href="#h23-0-723" id="h23-0-723" class="i">+checksum = &quot;589f6da84c646204747d1270a2a5661ea66ed1cced2631d546fdfb155959f9ec&quot;
</a><b>diff --git a/<a id="h24" href="../file/native/rust/Cargo.toml.html">native/rust/Cargo.toml</a> b/<a href="../file/native/rust/Cargo.toml.html">native/rust/Cargo.toml</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -0,0 +1,19 @@
</a><a href="#h24-0-0" id="h24-0-0" class="i">+[package]
</a><a href="#h24-0-1" id="h24-0-1" class="i">+name = &quot;snapenhance&quot;
</a><a href="#h24-0-2" id="h24-0-2" class="i">+version = &quot;0.1.0&quot;
</a><a href="#h24-0-3" id="h24-0-3" class="i">+authors = [&quot;rhunk&quot;]
</a><a href="#h24-0-4" id="h24-0-4" class="i">+edition = &quot;2021&quot;
</a><a href="#h24-0-5" id="h24-0-5" class="i">+
</a><a href="#h24-0-6" id="h24-0-6" class="i">+[lib]
</a><a href="#h24-0-7" id="h24-0-7" class="i">+crate-type = [&quot;cdylib&quot;]
</a><a href="#h24-0-8" id="h24-0-8" class="i">+
</a><a href="#h24-0-9" id="h24-0-9" class="i">+[dependencies]
</a><a href="#h24-0-10" id="h24-0-10" class="i">+android_logger = &quot;0.14.1&quot;
</a><a href="#h24-0-11" id="h24-0-11" class="i">+dobby-rs = &quot;0.1.0&quot;
</a><a href="#h24-0-12" id="h24-0-12" class="i">+jni = &quot;0.21.1&quot;
</a><a href="#h24-0-13" id="h24-0-13" class="i">+log = &quot;0.4.22&quot;
</a><a href="#h24-0-14" id="h24-0-14" class="i">+nix = { version = &quot;0.29.0&quot;, features = [&quot;fs&quot;] }
</a><a href="#h24-0-15" id="h24-0-15" class="i">+once_cell = &quot;1.19.0&quot;
</a><a href="#h24-0-16" id="h24-0-16" class="i">+paste = &quot;1.0.15&quot;
</a><a href="#h24-0-17" id="h24-0-17" class="i">+procfs = &quot;0.16.0&quot;
</a><a href="#h24-0-18" id="h24-0-18" class="i">+serde_json = &quot;1.0.120&quot;
</a><b>diff --git a/<a id="h25" href="../file/native/rust/build.rs.html">native/rust/build.rs</a> b/<a href="../file/native/rust/build.rs.html">native/rust/build.rs</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -0,0 +1,3 @@
</a><a href="#h25-0-0" id="h25-0-0" class="i">+fn main() {
</a><a href="#h25-0-1" id="h25-0-1" class="i">+    println!(&quot;cargo:rustc-link-lib=static=c++&quot;);
</a><a href="#h25-0-2" id="h25-0-2" class="i">+}</a><a href="#h25-0-3" id="h25-0-3" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h26" href="../file/native/rust/src/common.rs.html">native/rust/src/common.rs</a> b/<a href="../file/native/rust/src/common.rs.html">native/rust/src/common.rs</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -0,0 +1,49 @@
</a><a href="#h26-0-0" id="h26-0-0" class="i">+use jni::{objects::GlobalRef, JavaVM};
</a><a href="#h26-0-1" id="h26-0-1" class="i">+use once_cell::sync::{Lazy, OnceCell};
</a><a href="#h26-0-2" id="h26-0-2" class="i">+
</a><a href="#h26-0-3" id="h26-0-3" class="i">+use crate::mapped_lib::MappedLib;
</a><a href="#h26-0-4" id="h26-0-4" class="i">+
</a><a href="#h26-0-5" id="h26-0-5" class="i">+static NATIVE_LIB_INSTANCE: OnceCell&lt;GlobalRef&gt; = OnceCell::new();
</a><a href="#h26-0-6" id="h26-0-6" class="i">+static JAVA_VM: OnceCell&lt;usize&gt; = OnceCell::new();
</a><a href="#h26-0-7" id="h26-0-7" class="i">+
</a><a href="#h26-0-8" id="h26-0-8" class="i">+pub static CLIENT_MODULE: Lazy&lt;MappedLib&gt; = Lazy::new(|| {
</a><a href="#h26-0-9" id="h26-0-9" class="i">+    let mut client_module = MappedLib::new(&quot;libclient.so&quot;.into());
</a><a href="#h26-0-10" id="h26-0-10" class="i">+
</a><a href="#h26-0-11" id="h26-0-11" class="i">+    if let Err(error) = client_module.search() {
</a><a href="#h26-0-12" id="h26-0-12" class="i">+        warn!(&quot;Unable to find libclient.so: {}&quot;, error);
</a><a href="#h26-0-13" id="h26-0-13" class="i">+
</a><a href="#h26-0-14" id="h26-0-14" class="i">+        client_module = MappedLib::new(&quot;split_config.arm&quot;.into());
</a><a href="#h26-0-15" id="h26-0-15" class="i">+
</a><a href="#h26-0-16" id="h26-0-16" class="i">+        if let Err(error) = client_module.search() {
</a><a href="#h26-0-17" id="h26-0-17" class="i">+            panic!(&quot;Unable to find split_config.arm: {}&quot;, error);
</a><a href="#h26-0-18" id="h26-0-18" class="i">+        }
</a><a href="#h26-0-19" id="h26-0-19" class="i">+    }
</a><a href="#h26-0-20" id="h26-0-20" class="i">+
</a><a href="#h26-0-21" id="h26-0-21" class="i">+    client_module
</a><a href="#h26-0-22" id="h26-0-22" class="i">+});
</a><a href="#h26-0-23" id="h26-0-23" class="i">+
</a><a href="#h26-0-24" id="h26-0-24" class="i">+
</a><a href="#h26-0-25" id="h26-0-25" class="i">+pub fn set_native_lib_instance(instance: GlobalRef) {
</a><a href="#h26-0-26" id="h26-0-26" class="i">+    NATIVE_LIB_INSTANCE.set(instance).expect(&quot;NativeLib instance already set&quot;);
</a><a href="#h26-0-27" id="h26-0-27" class="i">+}
</a><a href="#h26-0-28" id="h26-0-28" class="i">+
</a><a href="#h26-0-29" id="h26-0-29" class="i">+pub fn native_lib_instance() -&gt; GlobalRef {
</a><a href="#h26-0-30" id="h26-0-30" class="i">+    NATIVE_LIB_INSTANCE.get().expect(&quot;NativeLib instance not set&quot;).clone()
</a><a href="#h26-0-31" id="h26-0-31" class="i">+}
</a><a href="#h26-0-32" id="h26-0-32" class="i">+
</a><a href="#h26-0-33" id="h26-0-33" class="i">+pub fn set_java_vm(vm: *mut jni::sys::JavaVM) {
</a><a href="#h26-0-34" id="h26-0-34" class="i">+    JAVA_VM.set(vm as usize).expect(&quot;JavaVM already set&quot;);
</a><a href="#h26-0-35" id="h26-0-35" class="i">+}
</a><a href="#h26-0-36" id="h26-0-36" class="i">+
</a><a href="#h26-0-37" id="h26-0-37" class="i">+pub fn java_vm() -&gt; JavaVM {
</a><a href="#h26-0-38" id="h26-0-38" class="i">+    unsafe {
</a><a href="#h26-0-39" id="h26-0-39" class="i">+        JavaVM::from_raw(*JAVA_VM.get().expect(&quot;JavaVM not set&quot;) as *mut jni::sys::JavaVM).expect(&quot;Failed to get JavaVM&quot;)
</a><a href="#h26-0-40" id="h26-0-40" class="i">+    }
</a><a href="#h26-0-41" id="h26-0-41" class="i">+}
</a><a href="#h26-0-42" id="h26-0-42" class="i">+
</a><a href="#h26-0-43" id="h26-0-43" class="i">+pub fn attach_jni_env(block: impl FnOnce(&amp;mut jni::JNIEnv)) {
</a><a href="#h26-0-44" id="h26-0-44" class="i">+    let jvm = java_vm();
</a><a href="#h26-0-45" id="h26-0-45" class="i">+    let mut env: jni::AttachGuard = jvm.attach_current_thread().expect(&quot;Failed to attach to current thread&quot;);
</a><a href="#h26-0-46" id="h26-0-46" class="i">+
</a><a href="#h26-0-47" id="h26-0-47" class="i">+    block(&amp;mut env);
</a><a href="#h26-0-48" id="h26-0-48" class="i">+}</a><a href="#h26-0-49" id="h26-0-49" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h27" href="../file/native/rust/src/config.rs.html">native/rust/src/config.rs</a> b/<a href="../file/native/rust/src/config.rs.html">native/rust/src/config.rs</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -0,0 +1,54 @@
</a><a href="#h27-0-0" id="h27-0-0" class="i">+use std::{error::Error, sync::Mutex};
</a><a href="#h27-0-1" id="h27-0-1" class="i">+use jni::{objects::JObject, JNIEnv};
</a><a href="#h27-0-2" id="h27-0-2" class="i">+use crate::util::get_jni_string;
</a><a href="#h27-0-3" id="h27-0-3" class="i">+
</a><a href="#h27-0-4" id="h27-0-4" class="i">+static NATIVE_CONFIG: Mutex&lt;Option&lt;NativeConfig&gt;&gt; = Mutex::new(None);
</a><a href="#h27-0-5" id="h27-0-5" class="i">+
</a><a href="#h27-0-6" id="h27-0-6" class="i">+pub fn native_config() -&gt; NativeConfig {
</a><a href="#h27-0-7" id="h27-0-7" class="i">+    NATIVE_CONFIG.lock().unwrap().as_ref().expect(&quot;NativeConfig not loaded&quot;).clone()
</a><a href="#h27-0-8" id="h27-0-8" class="i">+}
</a><a href="#h27-0-9" id="h27-0-9" class="i">+
</a><a href="#h27-0-10" id="h27-0-10" class="i">+#[derive(Debug, Clone)]
</a><a href="#h27-0-11" id="h27-0-11" class="i">+pub(crate) struct NativeConfig {
</a><a href="#h27-0-12" id="h27-0-12" class="i">+    pub disable_bitmoji: bool,
</a><a href="#h27-0-13" id="h27-0-13" class="i">+    pub disable_metrics: bool,
</a><a href="#h27-0-14" id="h27-0-14" class="i">+    pub composer_hooks: bool,
</a><a href="#h27-0-15" id="h27-0-15" class="i">+    pub custom_emoji_font_path: Option&lt;String&gt;,
</a><a href="#h27-0-16" id="h27-0-16" class="i">+}
</a><a href="#h27-0-17" id="h27-0-17" class="i">+
</a><a href="#h27-0-18" id="h27-0-18" class="i">+impl NativeConfig {
</a><a href="#h27-0-19" id="h27-0-19" class="i">+    fn new(env: &amp;mut JNIEnv, obj: JObject) -&gt; Result&lt;Self, Box&lt;dyn Error&gt;&gt; {
</a><a href="#h27-0-20" id="h27-0-20" class="i">+        macro_rules! get_boolean {
</a><a href="#h27-0-21" id="h27-0-21" class="i">+            ($field:expr) =&gt; {
</a><a href="#h27-0-22" id="h27-0-22" class="i">+                env.get_field(&amp;obj, $field, &quot;Z&quot;)?.z()?
</a><a href="#h27-0-23" id="h27-0-23" class="i">+            };
</a><a href="#h27-0-24" id="h27-0-24" class="i">+        }
</a><a href="#h27-0-25" id="h27-0-25" class="i">+
</a><a href="#h27-0-26" id="h27-0-26" class="i">+        macro_rules! get_string {
</a><a href="#h27-0-27" id="h27-0-27" class="i">+            ($field:expr) =&gt; {
</a><a href="#h27-0-28" id="h27-0-28" class="i">+                match env.get_field(&amp;obj, $field, &quot;Ljava/lang/String;&quot;)?.l()? {
</a><a href="#h27-0-29" id="h27-0-29" class="i">+                    jstring =&gt; if !jstring.is_null() {
</a><a href="#h27-0-30" id="h27-0-30" class="i">+                        Some(get_jni_string(env, jstring.into())?)
</a><a href="#h27-0-31" id="h27-0-31" class="i">+                    } else {
</a><a href="#h27-0-32" id="h27-0-32" class="i">+                        None
</a><a href="#h27-0-33" id="h27-0-33" class="i">+                    },
</a><a href="#h27-0-34" id="h27-0-34" class="i">+                }
</a><a href="#h27-0-35" id="h27-0-35" class="i">+            };
</a><a href="#h27-0-36" id="h27-0-36" class="i">+        }
</a><a href="#h27-0-37" id="h27-0-37" class="i">+
</a><a href="#h27-0-38" id="h27-0-38" class="i">+        Ok(Self {
</a><a href="#h27-0-39" id="h27-0-39" class="i">+            disable_bitmoji: get_boolean!(&quot;disableBitmoji&quot;),
</a><a href="#h27-0-40" id="h27-0-40" class="i">+            disable_metrics: get_boolean!(&quot;disableMetrics&quot;),
</a><a href="#h27-0-41" id="h27-0-41" class="i">+            composer_hooks: get_boolean!(&quot;composerHooks&quot;),
</a><a href="#h27-0-42" id="h27-0-42" class="i">+            custom_emoji_font_path: get_string!(&quot;customEmojiFontPath&quot;),
</a><a href="#h27-0-43" id="h27-0-43" class="i">+        })
</a><a href="#h27-0-44" id="h27-0-44" class="i">+    }
</a><a href="#h27-0-45" id="h27-0-45" class="i">+}
</a><a href="#h27-0-46" id="h27-0-46" class="i">+
</a><a href="#h27-0-47" id="h27-0-47" class="i">+pub fn load_config(mut env: JNIEnv, _class: JObject, obj: JObject)  {
</a><a href="#h27-0-48" id="h27-0-48" class="i">+    NATIVE_CONFIG.lock().unwrap().replace(
</a><a href="#h27-0-49" id="h27-0-49" class="i">+        NativeConfig::new(&amp;mut env, obj).expect(&quot;Failed to load NativeConfig&quot;)
</a><a href="#h27-0-50" id="h27-0-50" class="i">+    );
</a><a href="#h27-0-51" id="h27-0-51" class="i">+    
</a><a href="#h27-0-52" id="h27-0-52" class="i">+    info!(&quot;Config loaded {:?}&quot;, native_config());
</a><a href="#h27-0-53" id="h27-0-53" class="i">+}</a><a href="#h27-0-54" id="h27-0-54" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h28" href="../file/native/rust/src/hook.rs.html">native/rust/src/hook.rs</a> b/<a href="../file/native/rust/src/hook.rs.html">native/rust/src/hook.rs</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -0,0 +1,50 @@
</a><a href="#h28-0-0" id="h28-0-0" class="i">+use std::sync::Mutex;
</a><a href="#h28-0-1" id="h28-0-1" class="i">+
</a><a href="#h28-0-2" id="h28-0-2" class="i">+pub static MUTEX: Mutex&lt;()&gt; = Mutex::new(());
</a><a href="#h28-0-3" id="h28-0-3" class="i">+
</a><a href="#h28-0-4" id="h28-0-4" class="i">+#[macro_export]
</a><a href="#h28-0-5" id="h28-0-5" class="i">+macro_rules! def_hook {
</a><a href="#h28-0-6" id="h28-0-6" class="i">+    ($func:ident, $ret:ty, | $($arg:ident : $arg_type:ty),* | $body:block) =&gt; {
</a><a href="#h28-0-7" id="h28-0-7" class="i">+        paste::item! {
</a><a href="#h28-0-8" id="h28-0-8" class="i">+            #[allow(non_upper_case_globals)]
</a><a href="#h28-0-9" id="h28-0-9" class="i">+            static mut [&lt;$func _original&gt;]: std::option::Option&lt;extern &quot;C&quot; fn($($arg_type),*) -&gt; $ret&gt; = None;
</a><a href="#h28-0-10" id="h28-0-10" class="i">+
</a><a href="#h28-0-11" id="h28-0-11" class="i">+            fn $func($($arg: $arg_type),*) -&gt; $ret {
</a><a href="#h28-0-12" id="h28-0-12" class="i">+                {
</a><a href="#h28-0-13" id="h28-0-13" class="i">+                    #[allow(unused_unsafe)]
</a><a href="#h28-0-14" id="h28-0-14" class="i">+                    unsafe {
</a><a href="#h28-0-15" id="h28-0-15" class="i">+                        $body
</a><a href="#h28-0-16" id="h28-0-16" class="i">+                    }
</a><a href="#h28-0-17" id="h28-0-17" class="i">+                }
</a><a href="#h28-0-18" id="h28-0-18" class="i">+            }
</a><a href="#h28-0-19" id="h28-0-19" class="i">+        }
</a><a href="#h28-0-20" id="h28-0-20" class="i">+    };
</a><a href="#h28-0-21" id="h28-0-21" class="i">+}
</a><a href="#h28-0-22" id="h28-0-22" class="i">+
</a><a href="#h28-0-23" id="h28-0-23" class="i">+#[macro_export]
</a><a href="#h28-0-24" id="h28-0-24" class="i">+macro_rules! dobby_hook {
</a><a href="#h28-0-25" id="h28-0-25" class="i">+    ($sym:expr, $hook:expr) =&gt; {
</a><a href="#h28-0-26" id="h28-0-26" class="i">+        paste::item! {
</a><a href="#h28-0-27" id="h28-0-27" class="i">+            unsafe {
</a><a href="#h28-0-28" id="h28-0-28" class="i">+                if let Ok(_) = crate::hook::MUTEX.lock() {
</a><a href="#h28-0-29" id="h28-0-29" class="i">+                    if let Some(ptr) = dobby_rs::hook($sym, $hook as *mut std::ffi::c_void).ok().map(|x| x as *mut std::ffi::c_void) {
</a><a href="#h28-0-30" id="h28-0-30" class="i">+                        [&lt;$hook _original&gt;] = std::mem::transmute(ptr);
</a><a href="#h28-0-31" id="h28-0-31" class="i">+                    }
</a><a href="#h28-0-32" id="h28-0-32" class="i">+                }
</a><a href="#h28-0-33" id="h28-0-33" class="i">+            }
</a><a href="#h28-0-34" id="h28-0-34" class="i">+        }
</a><a href="#h28-0-35" id="h28-0-35" class="i">+    };
</a><a href="#h28-0-36" id="h28-0-36" class="i">+}
</a><a href="#h28-0-37" id="h28-0-37" class="i">+
</a><a href="#h28-0-38" id="h28-0-38" class="i">+#[macro_export]
</a><a href="#h28-0-39" id="h28-0-39" class="i">+macro_rules! dobby_hook_sym {
</a><a href="#h28-0-40" id="h28-0-40" class="i">+    ($lib:expr, $sym:expr, $hook:expr) =&gt; {
</a><a href="#h28-0-41" id="h28-0-41" class="i">+        if let Some(hook_symbol) = dobby_rs::resolve_symbol($lib, $sym) {
</a><a href="#h28-0-42" id="h28-0-42" class="i">+            crate::dobby_hook!(hook_symbol, $hook);
</a><a href="#h28-0-43" id="h28-0-43" class="i">+            debug!(&quot;hooked symbol: {}&quot;, $sym);
</a><a href="#h28-0-44" id="h28-0-44" class="i">+        } else {
</a><a href="#h28-0-45" id="h28-0-45" class="i">+            panic!(&quot;Failed to resolve symbol: {}&quot;, $sym);
</a><a href="#h28-0-46" id="h28-0-46" class="i">+        }
</a><a href="#h28-0-47" id="h28-0-47" class="i">+    };
</a><a href="#h28-0-48" id="h28-0-48" class="i">+}
</a><a href="#h28-0-49" id="h28-0-49" class="i">+
</a><b>diff --git a/<a id="h29" href="../file/native/rust/src/lib.rs.html">native/rust/src/lib.rs</a> b/<a href="../file/native/rust/src/lib.rs.html">native/rust/src/lib.rs</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -0,0 +1,146 @@
</a><a href="#h29-0-0" id="h29-0-0" class="i">+#[macro_use]
</a><a href="#h29-0-1" id="h29-0-1" class="i">+extern crate log;
</a><a href="#h29-0-2" id="h29-0-2" class="i">+
</a><a href="#h29-0-3" id="h29-0-3" class="i">+mod common;
</a><a href="#h29-0-4" id="h29-0-4" class="i">+
</a><a href="#h29-0-5" id="h29-0-5" class="i">+mod hook;
</a><a href="#h29-0-6" id="h29-0-6" class="i">+mod util;
</a><a href="#h29-0-7" id="h29-0-7" class="i">+mod mapped_lib;
</a><a href="#h29-0-8" id="h29-0-8" class="i">+mod config;
</a><a href="#h29-0-9" id="h29-0-9" class="i">+mod sig;
</a><a href="#h29-0-10" id="h29-0-10" class="i">+
</a><a href="#h29-0-11" id="h29-0-11" class="i">+mod modules;
</a><a href="#h29-0-12" id="h29-0-12" class="i">+
</a><a href="#h29-0-13" id="h29-0-13" class="i">+use android_logger::Config;
</a><a href="#h29-0-14" id="h29-0-14" class="i">+use log::LevelFilter;
</a><a href="#h29-0-15" id="h29-0-15" class="i">+use modules::{composer_hook, duplex_hook, fstat_hook, linker_hook, sqlite_hook, unary_call_hook};
</a><a href="#h29-0-16" id="h29-0-16" class="i">+
</a><a href="#h29-0-17" id="h29-0-17" class="i">+use jni::objects::{JObject, JString};
</a><a href="#h29-0-18" id="h29-0-18" class="i">+use jni::sys::{jint, jstring, JNI_VERSION_1_6};
</a><a href="#h29-0-19" id="h29-0-19" class="i">+use jni::{JNIEnv, JavaVM, NativeMethod};
</a><a href="#h29-0-20" id="h29-0-20" class="i">+use util::get_jni_string;
</a><a href="#h29-0-21" id="h29-0-21" class="i">+
</a><a href="#h29-0-22" id="h29-0-22" class="i">+use std::ffi::c_void;
</a><a href="#h29-0-23" id="h29-0-23" class="i">+use std::thread::JoinHandle;
</a><a href="#h29-0-24" id="h29-0-24" class="i">+
</a><a href="#h29-0-25" id="h29-0-25" class="i">+fn pre_init() {
</a><a href="#h29-0-26" id="h29-0-26" class="i">+    linker_hook::init();
</a><a href="#h29-0-27" id="h29-0-27" class="i">+}
</a><a href="#h29-0-28" id="h29-0-28" class="i">+
</a><a href="#h29-0-29" id="h29-0-29" class="i">+fn init(mut env: JNIEnv, _class: JObject, signature_cache: JString) -&gt; jstring {
</a><a href="#h29-0-30" id="h29-0-30" class="i">+    debug!(&quot;Initializing native lib&quot;);
</a><a href="#h29-0-31" id="h29-0-31" class="i">+
</a><a href="#h29-0-32" id="h29-0-32" class="i">+    let start_time = std::time::Instant::now();
</a><a href="#h29-0-33" id="h29-0-33" class="i">+
</a><a href="#h29-0-34" id="h29-0-34" class="i">+    // load signature cache
</a><a href="#h29-0-35" id="h29-0-35" class="i">+    
</a><a href="#h29-0-36" id="h29-0-36" class="i">+    if !signature_cache.is_null() {
</a><a href="#h29-0-37" id="h29-0-37" class="i">+        let sig_cache_str = get_jni_string(&amp;mut env, signature_cache).expect(&quot;Failed to convert mappings to string&quot;);
</a><a href="#h29-0-38" id="h29-0-38" class="i">+        
</a><a href="#h29-0-39" id="h29-0-39" class="i">+        if let Ok(signature_cache) = serde_json::from_str(sig_cache_str.as_str()) {
</a><a href="#h29-0-40" id="h29-0-40" class="i">+            sig::add_signatures(signature_cache);
</a><a href="#h29-0-41" id="h29-0-41" class="i">+        } else {
</a><a href="#h29-0-42" id="h29-0-42" class="i">+            error!(&quot;Failed to load signature cache&quot;);
</a><a href="#h29-0-43" id="h29-0-43" class="i">+        }
</a><a href="#h29-0-44" id="h29-0-44" class="i">+    }
</a><a href="#h29-0-45" id="h29-0-45" class="i">+
</a><a href="#h29-0-46" id="h29-0-46" class="i">+    common::set_native_lib_instance(env.new_global_ref(_class).ok().expect(&quot;Failed to create global ref&quot;));
</a><a href="#h29-0-47" id="h29-0-47" class="i">+
</a><a href="#h29-0-48" id="h29-0-48" class="i">+    let _ = common::CLIENT_MODULE;
</a><a href="#h29-0-49" id="h29-0-49" class="i">+
</a><a href="#h29-0-50" id="h29-0-50" class="i">+    // initialize modules asynchronously
</a><a href="#h29-0-51" id="h29-0-51" class="i">+
</a><a href="#h29-0-52" id="h29-0-52" class="i">+    let mut threads: Vec&lt;JoinHandle&lt;()&gt;&gt; = Vec::new();
</a><a href="#h29-0-53" id="h29-0-53" class="i">+
</a><a href="#h29-0-54" id="h29-0-54" class="i">+    macro_rules! async_init {
</a><a href="#h29-0-55" id="h29-0-55" class="i">+        ($($f:expr),*) =&gt; {
</a><a href="#h29-0-56" id="h29-0-56" class="i">+            $(
</a><a href="#h29-0-57" id="h29-0-57" class="i">+                threads.push(std::thread::spawn(move || {
</a><a href="#h29-0-58" id="h29-0-58" class="i">+                    $f;
</a><a href="#h29-0-59" id="h29-0-59" class="i">+                }));
</a><a href="#h29-0-60" id="h29-0-60" class="i">+            )*
</a><a href="#h29-0-61" id="h29-0-61" class="i">+        };
</a><a href="#h29-0-62" id="h29-0-62" class="i">+    }
</a><a href="#h29-0-63" id="h29-0-63" class="i">+
</a><a href="#h29-0-64" id="h29-0-64" class="i">+    async_init!(
</a><a href="#h29-0-65" id="h29-0-65" class="i">+        duplex_hook::init(),
</a><a href="#h29-0-66" id="h29-0-66" class="i">+        unary_call_hook::init(),
</a><a href="#h29-0-67" id="h29-0-67" class="i">+        composer_hook::init(),
</a><a href="#h29-0-68" id="h29-0-68" class="i">+        fstat_hook::init(),
</a><a href="#h29-0-69" id="h29-0-69" class="i">+        sqlite_hook::init()
</a><a href="#h29-0-70" id="h29-0-70" class="i">+    );
</a><a href="#h29-0-71" id="h29-0-71" class="i">+    
</a><a href="#h29-0-72" id="h29-0-72" class="i">+    threads.into_iter().for_each(|t| t.join().unwrap());
</a><a href="#h29-0-73" id="h29-0-73" class="i">+
</a><a href="#h29-0-74" id="h29-0-74" class="i">+    info!(&quot;native init took {:?}&quot;, start_time.elapsed());
</a><a href="#h29-0-75" id="h29-0-75" class="i">+
</a><a href="#h29-0-76" id="h29-0-76" class="i">+    // send back the signature cache
</a><a href="#h29-0-77" id="h29-0-77" class="i">+    if let Ok(signature_cache) = serde_json::to_string(&amp;sig::get_signatures()) {
</a><a href="#h29-0-78" id="h29-0-78" class="i">+        env.new_string(signature_cache).ok().expect(&quot;Failed to create new string&quot;).into_raw()
</a><a href="#h29-0-79" id="h29-0-79" class="i">+    } else {
</a><a href="#h29-0-80" id="h29-0-80" class="i">+        std::ptr::null_mut()
</a><a href="#h29-0-81" id="h29-0-81" class="i">+    }
</a><a href="#h29-0-82" id="h29-0-82" class="i">+}
</a><a href="#h29-0-83" id="h29-0-83" class="i">+
</a><a href="#h29-0-84" id="h29-0-84" class="i">+
</a><a href="#h29-0-85" id="h29-0-85" class="i">+#[allow(non_snake_case)]
</a><a href="#h29-0-86" id="h29-0-86" class="i">+#[no_mangle]
</a><a href="#h29-0-87" id="h29-0-87" class="i">+pub extern &quot;system&quot; fn JNI_OnLoad(_vm: JavaVM, _: *mut c_void) -&gt; jint {
</a><a href="#h29-0-88" id="h29-0-88" class="i">+    android_logger::init_once(
</a><a href="#h29-0-89" id="h29-0-89" class="i">+        Config::default()
</a><a href="#h29-0-90" id="h29-0-90" class="i">+        .with_max_level(LevelFilter::Debug)
</a><a href="#h29-0-91" id="h29-0-91" class="i">+        .with_tag(&quot;SnapEnhanceNative&quot;)
</a><a href="#h29-0-92" id="h29-0-92" class="i">+    );
</a><a href="#h29-0-93" id="h29-0-93" class="i">+    
</a><a href="#h29-0-94" id="h29-0-94" class="i">+    info!(&quot;JNI_OnLoad called&quot;);
</a><a href="#h29-0-95" id="h29-0-95" class="i">+
</a><a href="#h29-0-96" id="h29-0-96" class="i">+    std::panic::set_hook(Box::new(|panic_info| {
</a><a href="#h29-0-97" id="h29-0-97" class="i">+        error!(&quot;{:?}&quot;, panic_info);
</a><a href="#h29-0-98" id="h29-0-98" class="i">+    }));
</a><a href="#h29-0-99" id="h29-0-99" class="i">+
</a><a href="#h29-0-100" id="h29-0-100" class="i">+    common::set_java_vm(_vm.get_java_vm_pointer());
</a><a href="#h29-0-101" id="h29-0-101" class="i">+
</a><a href="#h29-0-102" id="h29-0-102" class="i">+    let mut env = _vm.get_env().expect(&quot;Failed to get JNIEnv&quot;);
</a><a href="#h29-0-103" id="h29-0-103" class="i">+
</a><a href="#h29-0-104" id="h29-0-104" class="i">+    let native_lib_class = env.find_class(&quot;me/rhunk/snapenhance/nativelib/NativeLib&quot;).expect(&quot;NativeLib class not found&quot;);
</a><a href="#h29-0-105" id="h29-0-105" class="i">+
</a><a href="#h29-0-106" id="h29-0-106" class="i">+    env.register_native_methods(
</a><a href="#h29-0-107" id="h29-0-107" class="i">+        native_lib_class,
</a><a href="#h29-0-108" id="h29-0-108" class="i">+        &amp;[
</a><a href="#h29-0-109" id="h29-0-109" class="i">+            NativeMethod {
</a><a href="#h29-0-110" id="h29-0-110" class="i">+                name: &quot;init&quot;.into(),
</a><a href="#h29-0-111" id="h29-0-111" class="i">+                sig: &quot;(Ljava/lang/String;)Ljava/lang/String;&quot;.into(),
</a><a href="#h29-0-112" id="h29-0-112" class="i">+                fn_ptr: init as *mut c_void,
</a><a href="#h29-0-113" id="h29-0-113" class="i">+            },
</a><a href="#h29-0-114" id="h29-0-114" class="i">+            NativeMethod {
</a><a href="#h29-0-115" id="h29-0-115" class="i">+                name: &quot;loadConfig&quot;.into(),
</a><a href="#h29-0-116" id="h29-0-116" class="i">+                sig: &quot;(Lme/rhunk/snapenhance/nativelib/NativeConfig;)V&quot;.into(),
</a><a href="#h29-0-117" id="h29-0-117" class="i">+                fn_ptr: config::load_config as *mut c_void,
</a><a href="#h29-0-118" id="h29-0-118" class="i">+            },
</a><a href="#h29-0-119" id="h29-0-119" class="i">+            NativeMethod {
</a><a href="#h29-0-120" id="h29-0-120" class="i">+                name: &quot;addLinkerSharedLibrary&quot;.into(),
</a><a href="#h29-0-121" id="h29-0-121" class="i">+                sig: &quot;(Ljava/lang/String;[B)V&quot;.into(),
</a><a href="#h29-0-122" id="h29-0-122" class="i">+                fn_ptr: linker_hook::add_linker_shared_library as *mut c_void,
</a><a href="#h29-0-123" id="h29-0-123" class="i">+            },
</a><a href="#h29-0-124" id="h29-0-124" class="i">+            NativeMethod {
</a><a href="#h29-0-125" id="h29-0-125" class="i">+                name: &quot;lockDatabase&quot;.into(),
</a><a href="#h29-0-126" id="h29-0-126" class="i">+                sig: &quot;(Ljava/lang/String;Ljava/lang/Runnable;)V&quot;.into(),
</a><a href="#h29-0-127" id="h29-0-127" class="i">+                fn_ptr: sqlite_hook::lock_database as *mut c_void,
</a><a href="#h29-0-128" id="h29-0-128" class="i">+            },
</a><a href="#h29-0-129" id="h29-0-129" class="i">+            NativeMethod {
</a><a href="#h29-0-130" id="h29-0-130" class="i">+                name: &quot;setComposerLoader&quot;.into(),
</a><a href="#h29-0-131" id="h29-0-131" class="i">+                sig: &quot;(Ljava/lang/String;)V&quot;.into(),
</a><a href="#h29-0-132" id="h29-0-132" class="i">+                fn_ptr: composer_hook::set_composer_loader as *mut c_void,
</a><a href="#h29-0-133" id="h29-0-133" class="i">+            },
</a><a href="#h29-0-134" id="h29-0-134" class="i">+            NativeMethod {
</a><a href="#h29-0-135" id="h29-0-135" class="i">+                name: &quot;composerEval&quot;.into(),
</a><a href="#h29-0-136" id="h29-0-136" class="i">+                sig: &quot;(Ljava/lang/String;)Ljava/lang/String;&quot;.into(),
</a><a href="#h29-0-137" id="h29-0-137" class="i">+                fn_ptr: composer_hook::composer_eval as *mut c_void,
</a><a href="#h29-0-138" id="h29-0-138" class="i">+            }
</a><a href="#h29-0-139" id="h29-0-139" class="i">+        ]
</a><a href="#h29-0-140" id="h29-0-140" class="i">+    ).expect(&quot;Failed to register native methods&quot;);
</a><a href="#h29-0-141" id="h29-0-141" class="i">+
</a><a href="#h29-0-142" id="h29-0-142" class="i">+    pre_init();
</a><a href="#h29-0-143" id="h29-0-143" class="i">+
</a><a href="#h29-0-144" id="h29-0-144" class="i">+    JNI_VERSION_1_6
</a><a href="#h29-0-145" id="h29-0-145" class="i">+}
</a><b>diff --git a/<a id="h30" href="../file/native/rust/src/mapped_lib.rs.html">native/rust/src/mapped_lib.rs</a> b/<a href="../file/native/rust/src/mapped_lib.rs.html">native/rust/src/mapped_lib.rs</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -0,0 +1,49 @@
</a><a href="#h30-0-0" id="h30-0-0" class="i">+use std::error::Error;
</a><a href="#h30-0-1" id="h30-0-1" class="i">+
</a><a href="#h30-0-2" id="h30-0-2" class="i">+use procfs::process::{MMPermissions, MMapPath};
</a><a href="#h30-0-3" id="h30-0-3" class="i">+
</a><a href="#h30-0-4" id="h30-0-4" class="i">+#[derive(Debug)]
</a><a href="#h30-0-5" id="h30-0-5" class="i">+pub(crate) struct MappedRegion {
</a><a href="#h30-0-6" id="h30-0-6" class="i">+    pub start: u64,
</a><a href="#h30-0-7" id="h30-0-7" class="i">+    pub end: u64,
</a><a href="#h30-0-8" id="h30-0-8" class="i">+    pub perms: MMPermissions,
</a><a href="#h30-0-9" id="h30-0-9" class="i">+}
</a><a href="#h30-0-10" id="h30-0-10" class="i">+
</a><a href="#h30-0-11" id="h30-0-11" class="i">+#[derive(Debug)]
</a><a href="#h30-0-12" id="h30-0-12" class="i">+pub(crate) struct MappedLib {
</a><a href="#h30-0-13" id="h30-0-13" class="i">+    name: String,
</a><a href="#h30-0-14" id="h30-0-14" class="i">+    pub regions: Vec&lt;MappedRegion&gt;,
</a><a href="#h30-0-15" id="h30-0-15" class="i">+}
</a><a href="#h30-0-16" id="h30-0-16" class="i">+
</a><a href="#h30-0-17" id="h30-0-17" class="i">+impl MappedLib {
</a><a href="#h30-0-18" id="h30-0-18" class="i">+    pub fn new(name: String) -&gt; Self {
</a><a href="#h30-0-19" id="h30-0-19" class="i">+        Self {
</a><a href="#h30-0-20" id="h30-0-20" class="i">+            name,
</a><a href="#h30-0-21" id="h30-0-21" class="i">+            regions: Vec::new(),
</a><a href="#h30-0-22" id="h30-0-22" class="i">+        }
</a><a href="#h30-0-23" id="h30-0-23" class="i">+    }
</a><a href="#h30-0-24" id="h30-0-24" class="i">+
</a><a href="#h30-0-25" id="h30-0-25" class="i">+    pub fn search(&amp;mut self) -&gt; Result&lt;&amp;Self, Box&lt;dyn Error&gt;&gt; {
</a><a href="#h30-0-26" id="h30-0-26" class="i">+        procfs::process::Process::myself()?.maps()?.iter().for_each(|map| {
</a><a href="#h30-0-27" id="h30-0-27" class="i">+            let pathname = &amp;map.pathname;
</a><a href="#h30-0-28" id="h30-0-28" class="i">+
</a><a href="#h30-0-29" id="h30-0-29" class="i">+            if let MMapPath::Path(path_buffer) = pathname {
</a><a href="#h30-0-30" id="h30-0-30" class="i">+                let path = path_buffer.to_string_lossy();
</a><a href="#h30-0-31" id="h30-0-31" class="i">+
</a><a href="#h30-0-32" id="h30-0-32" class="i">+                if path.contains(&amp;self.name) {
</a><a href="#h30-0-33" id="h30-0-33" class="i">+                    self.regions.push(MappedRegion {
</a><a href="#h30-0-34" id="h30-0-34" class="i">+                        start: map.address.0,
</a><a href="#h30-0-35" id="h30-0-35" class="i">+                        end: map.address.1,
</a><a href="#h30-0-36" id="h30-0-36" class="i">+                        perms: map.perms,
</a><a href="#h30-0-37" id="h30-0-37" class="i">+                    });
</a><a href="#h30-0-38" id="h30-0-38" class="i">+                }
</a><a href="#h30-0-39" id="h30-0-39" class="i">+            }
</a><a href="#h30-0-40" id="h30-0-40" class="i">+        });
</a><a href="#h30-0-41" id="h30-0-41" class="i">+
</a><a href="#h30-0-42" id="h30-0-42" class="i">+        if self.regions.is_empty() {
</a><a href="#h30-0-43" id="h30-0-43" class="i">+            return Err(format!(&quot;No regions found for {}&quot;, self.name).into());
</a><a href="#h30-0-44" id="h30-0-44" class="i">+        }
</a><a href="#h30-0-45" id="h30-0-45" class="i">+
</a><a href="#h30-0-46" id="h30-0-46" class="i">+        Ok(self)
</a><a href="#h30-0-47" id="h30-0-47" class="i">+    }
</a><a href="#h30-0-48" id="h30-0-48" class="i">+}
</a><b>diff --git a/<a id="h31" href="../file/native/rust/src/modules/composer_hook.rs.html">native/rust/src/modules/composer_hook.rs</a> b/<a href="../file/native/rust/src/modules/composer_hook.rs.html">native/rust/src/modules/composer_hook.rs</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -0,0 +1,184 @@
</a><a href="#h31-0-0" id="h31-0-0" class="i">+#![allow(dead_code, unused_mut)] 
</a><a href="#h31-0-1" id="h31-0-1" class="i">+
</a><a href="#h31-0-2" id="h31-0-2" class="i">+use std::{cell::Cell, ffi::{c_void, CStr}, sync::Mutex};
</a><a href="#h31-0-3" id="h31-0-3" class="i">+use jni::{objects::JString, sys::jobject, JNIEnv};
</a><a href="#h31-0-4" id="h31-0-4" class="i">+use crate::{common, config, def_hook, dobby_hook, sig, util::get_jni_string};
</a><a href="#h31-0-5" id="h31-0-5" class="i">+
</a><a href="#h31-0-6" id="h31-0-6" class="i">+const JS_TAG_BIG_DECIMAL: i64 = -11;
</a><a href="#h31-0-7" id="h31-0-7" class="i">+const JS_TAG_BIG_INT: i64 = -10;
</a><a href="#h31-0-8" id="h31-0-8" class="i">+const JS_TAG_BIG_FLOAT: i64 = -9;
</a><a href="#h31-0-9" id="h31-0-9" class="i">+const JS_TAG_SYMBOL: i64 = -8;
</a><a href="#h31-0-10" id="h31-0-10" class="i">+const JS_TAG_STRING: i64 = -7;
</a><a href="#h31-0-11" id="h31-0-11" class="i">+const JS_TAG_MODULE: i64 = -3;
</a><a href="#h31-0-12" id="h31-0-12" class="i">+const JS_TAG_FUNCTION_BYTECODE: i64 = -2;
</a><a href="#h31-0-13" id="h31-0-13" class="i">+const JS_TAG_OBJECT: i64 = -1;
</a><a href="#h31-0-14" id="h31-0-14" class="i">+const JS_TAG_INT: i64 = 0;
</a><a href="#h31-0-15" id="h31-0-15" class="i">+const JS_TAG_BOOL: i64 = 1;
</a><a href="#h31-0-16" id="h31-0-16" class="i">+const JS_TAG_NULL: i64 = 2;
</a><a href="#h31-0-17" id="h31-0-17" class="i">+const JS_TAG_UNDEFINED: i64 = 3;
</a><a href="#h31-0-18" id="h31-0-18" class="i">+const JS_TAG_UNINITIALIZED: i64 = 4;
</a><a href="#h31-0-19" id="h31-0-19" class="i">+const JS_TAG_CATCH_OFFSET: i64 = 5;
</a><a href="#h31-0-20" id="h31-0-20" class="i">+const JS_TAG_EXCEPTION: i64 = 6;
</a><a href="#h31-0-21" id="h31-0-21" class="i">+const JS_TAG_FLOAT64: i64 = 7;
</a><a href="#h31-0-22" id="h31-0-22" class="i">+
</a><a href="#h31-0-23" id="h31-0-23" class="i">+#[repr(C)]
</a><a href="#h31-0-24" id="h31-0-24" class="i">+struct JsString {
</a><a href="#h31-0-25" id="h31-0-25" class="i">+    /*
</a><a href="#h31-0-26" id="h31-0-26" class="i">+    original structure : 
</a><a href="#h31-0-27" id="h31-0-27" class="i">+    struct JSString {
</a><a href="#h31-0-28" id="h31-0-28" class="i">+        struct JSRefCountHeader {
</a><a href="#h31-0-29" id="h31-0-29" class="i">+            int ref_count;
</a><a href="#h31-0-30" id="h31-0-30" class="i">+        };
</a><a href="#h31-0-31" id="h31-0-31" class="i">+        uint32_t len : 31;
</a><a href="#h31-0-32" id="h31-0-32" class="i">+        uint8_t is_wide_char : 1;
</a><a href="#h31-0-33" id="h31-0-33" class="i">+        uint32_t hash : 30;
</a><a href="#h31-0-34" id="h31-0-34" class="i">+        uint8_t atom_type : 2;
</a><a href="#h31-0-35" id="h31-0-35" class="i">+        uint32_t hash_next;
</a><a href="#h31-0-36" id="h31-0-36" class="i">+
</a><a href="#h31-0-37" id="h31-0-37" class="i">+        union {
</a><a href="#h31-0-38" id="h31-0-38" class="i">+            uint8_t str8[0];
</a><a href="#h31-0-39" id="h31-0-39" class="i">+            uint16_t str16[0];
</a><a href="#h31-0-40" id="h31-0-40" class="i">+        } u;
</a><a href="#h31-0-41" id="h31-0-41" class="i">+    };
</a><a href="#h31-0-42" id="h31-0-42" class="i">+    */
</a><a href="#h31-0-43" id="h31-0-43" class="i">+    pad: [u32; 4],
</a><a href="#h31-0-44" id="h31-0-44" class="i">+    str8: [u8; 0],
</a><a href="#h31-0-45" id="h31-0-45" class="i">+    str16: [u16; 0],
</a><a href="#h31-0-46" id="h31-0-46" class="i">+}
</a><a href="#h31-0-47" id="h31-0-47" class="i">+
</a><a href="#h31-0-48" id="h31-0-48" class="i">+#[repr(C)]
</a><a href="#h31-0-49" id="h31-0-49" class="i">+#[derive(Copy, Clone)]
</a><a href="#h31-0-50" id="h31-0-50" class="i">+union JsValueUnion {
</a><a href="#h31-0-51" id="h31-0-51" class="i">+    int32: i32,
</a><a href="#h31-0-52" id="h31-0-52" class="i">+    float64: f64,
</a><a href="#h31-0-53" id="h31-0-53" class="i">+    ptr: *mut c_void,
</a><a href="#h31-0-54" id="h31-0-54" class="i">+}
</a><a href="#h31-0-55" id="h31-0-55" class="i">+
</a><a href="#h31-0-56" id="h31-0-56" class="i">+#[repr(C)]
</a><a href="#h31-0-57" id="h31-0-57" class="i">+#[derive(Copy, Clone)]
</a><a href="#h31-0-58" id="h31-0-58" class="i">+struct JsValue {
</a><a href="#h31-0-59" id="h31-0-59" class="i">+    u: JsValueUnion,
</a><a href="#h31-0-60" id="h31-0-60" class="i">+    tag: i64,
</a><a href="#h31-0-61" id="h31-0-61" class="i">+}
</a><a href="#h31-0-62" id="h31-0-62" class="i">+
</a><a href="#h31-0-63" id="h31-0-63" class="i">+static mut GLOBAL_INSTANCE: Option&lt;*mut c_void&gt; = None;
</a><a href="#h31-0-64" id="h31-0-64" class="i">+static mut GLOBAL_CTX: Option&lt;*mut c_void&gt; = None;
</a><a href="#h31-0-65" id="h31-0-65" class="i">+static COMPOSER_LOADER_DATA: Mutex&lt;Cell&lt;Option&lt;Box&lt;String&gt;&gt;&gt;&gt; = Mutex::new(Cell::new(None));
</a><a href="#h31-0-66" id="h31-0-66" class="i">+
</a><a href="#h31-0-67" id="h31-0-67" class="i">+static mut JS_EVAL_ORIGINAL2: Option&lt;unsafe extern &quot;C&quot; fn(*mut c_void, *mut c_void, *mut c_void, *mut u8, usize, *const u8, u32) -&gt; JsValue&gt; = None;
</a><a href="#h31-0-68" id="h31-0-68" class="i">+
</a><a href="#h31-0-69" id="h31-0-69" class="i">+def_hook!(
</a><a href="#h31-0-70" id="h31-0-70" class="i">+    js_eval,
</a><a href="#h31-0-71" id="h31-0-71" class="i">+    *mut c_void,
</a><a href="#h31-0-72" id="h31-0-72" class="i">+    |arg0: *mut c_void, arg1: *mut c_void, arg2: *mut c_void, arg3: *const u8, arg4: *const u8, arg5: *const u8, arg6: *mut c_void, arg7: u32| {
</a><a href="#h31-0-73" id="h31-0-73" class="i">+        let mut arg3 = arg3;
</a><a href="#h31-0-74" id="h31-0-74" class="i">+        let mut arg4 = arg4;
</a><a href="#h31-0-75" id="h31-0-75" class="i">+        let mut arg5 = arg5;
</a><a href="#h31-0-76" id="h31-0-76" class="i">+
</a><a href="#h31-0-77" id="h31-0-77" class="i">+        if GLOBAL_INSTANCE.is_none() || GLOBAL_CTX.is_none() {
</a><a href="#h31-0-78" id="h31-0-78" class="i">+            GLOBAL_INSTANCE = Some(arg0);
</a><a href="#h31-0-79" id="h31-0-79" class="i">+            GLOBAL_CTX = Some(arg1);
</a><a href="#h31-0-80" id="h31-0-80" class="i">+
</a><a href="#h31-0-81" id="h31-0-81" class="i">+            let mut loader_data = COMPOSER_LOADER_DATA.lock().unwrap();
</a><a href="#h31-0-82" id="h31-0-82" class="i">+            let mut loader_data = loader_data.get_mut();
</a><a href="#h31-0-83" id="h31-0-83" class="i">+
</a><a href="#h31-0-84" id="h31-0-84" class="i">+            let loader_data = loader_data.as_mut().unwrap();
</a><a href="#h31-0-85" id="h31-0-85" class="i">+            loader_data.push_str(&quot;\n&quot;);
</a><a href="#h31-0-86" id="h31-0-86" class="i">+            #[cfg(target_arch = &quot;aarch64&quot;)]
</a><a href="#h31-0-87" id="h31-0-87" class="i">+            {
</a><a href="#h31-0-88" id="h31-0-88" class="i">+                loader_data.push_str(CStr::from_ptr(arg3).to_str().unwrap());
</a><a href="#h31-0-89" id="h31-0-89" class="i">+                arg3 = loader_data.as_mut_ptr();
</a><a href="#h31-0-90" id="h31-0-90" class="i">+                arg4 = loader_data.len() as *const u8;
</a><a href="#h31-0-91" id="h31-0-91" class="i">+            }
</a><a href="#h31-0-92" id="h31-0-92" class="i">+
</a><a href="#h31-0-93" id="h31-0-93" class="i">+            // On arm the original JS_Eval function is inlined so the arguments are shifted
</a><a href="#h31-0-94" id="h31-0-94" class="i">+            #[cfg(target_arch = &quot;arm&quot;)]
</a><a href="#h31-0-95" id="h31-0-95" class="i">+            {
</a><a href="#h31-0-96" id="h31-0-96" class="i">+                loader_data.push_str(CStr::from_ptr(arg4).to_str().unwrap());
</a><a href="#h31-0-97" id="h31-0-97" class="i">+                arg4 = loader_data.as_mut_ptr();
</a><a href="#h31-0-98" id="h31-0-98" class="i">+                arg5 = loader_data.len() as *const u8;
</a><a href="#h31-0-99" id="h31-0-99" class="i">+            }
</a><a href="#h31-0-100" id="h31-0-100" class="i">+
</a><a href="#h31-0-101" id="h31-0-101" class="i">+            debug!(&quot;injected composer loader!&quot;);
</a><a href="#h31-0-102" id="h31-0-102" class="i">+        } else {
</a><a href="#h31-0-103" id="h31-0-103" class="i">+            COMPOSER_LOADER_DATA.lock().unwrap().take();
</a><a href="#h31-0-104" id="h31-0-104" class="i">+        }
</a><a href="#h31-0-105" id="h31-0-105" class="i">+
</a><a href="#h31-0-106" id="h31-0-106" class="i">+        js_eval_original.unwrap()(arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7)
</a><a href="#h31-0-107" id="h31-0-107" class="i">+    }
</a><a href="#h31-0-108" id="h31-0-108" class="i">+);
</a><a href="#h31-0-109" id="h31-0-109" class="i">+
</a><a href="#h31-0-110" id="h31-0-110" class="i">+pub fn set_composer_loader(mut env: JNIEnv, _: *mut c_void, code: JString) {
</a><a href="#h31-0-111" id="h31-0-111" class="i">+    let new_code = get_jni_string(&amp;mut env, code).expect(&quot;Failed to get code&quot;);
</a><a href="#h31-0-112" id="h31-0-112" class="i">+   
</a><a href="#h31-0-113" id="h31-0-113" class="i">+    COMPOSER_LOADER_DATA.lock().unwrap().replace(Some(Box::new(new_code)));
</a><a href="#h31-0-114" id="h31-0-114" class="i">+}
</a><a href="#h31-0-115" id="h31-0-115" class="i">+
</a><a href="#h31-0-116" id="h31-0-116" class="i">+#[allow(unreachable_code, unused_variables)]
</a><a href="#h31-0-117" id="h31-0-117" class="i">+pub unsafe fn composer_eval(env: JNIEnv, _: *mut c_void, script: JString) -&gt; jobject {
</a><a href="#h31-0-118" id="h31-0-118" class="i">+    #[cfg(not(target_arch = &quot;aarch64&quot;))]
</a><a href="#h31-0-119" id="h31-0-119" class="i">+    {
</a><a href="#h31-0-120" id="h31-0-120" class="i">+        return env.new_string(&quot;Architecture not supported&quot;).unwrap().into_raw();
</a><a href="#h31-0-121" id="h31-0-121" class="i">+    }
</a><a href="#h31-0-122" id="h31-0-122" class="i">+
</a><a href="#h31-0-123" id="h31-0-123" class="i">+    let mut env = env;
</a><a href="#h31-0-124" id="h31-0-124" class="i">+
</a><a href="#h31-0-125" id="h31-0-125" class="i">+    let script_str = get_jni_string(&amp;mut env, script).expect(&quot;Failed to get script&quot;);
</a><a href="#h31-0-126" id="h31-0-126" class="i">+    let script_length = script_str.len();
</a><a href="#h31-0-127" id="h31-0-127" class="i">+
</a><a href="#h31-0-128" id="h31-0-128" class="i">+    let js_value = JS_EVAL_ORIGINAL2.expect(&quot;No js eval found&quot;)(
</a><a href="#h31-0-129" id="h31-0-129" class="i">+        GLOBAL_INSTANCE.expect(&quot;No global instance found&quot;), 
</a><a href="#h31-0-130" id="h31-0-130" class="i">+        GLOBAL_CTX.expect(&quot;No global context found&quot;),
</a><a href="#h31-0-131" id="h31-0-131" class="i">+        std::ptr::null_mut(),
</a><a href="#h31-0-132" id="h31-0-132" class="i">+        (script_str + &quot;\0&quot;).as_ptr() as *mut u8, 
</a><a href="#h31-0-133" id="h31-0-133" class="i">+        script_length, 
</a><a href="#h31-0-134" id="h31-0-134" class="i">+        &quot;&lt;eval&gt;\0&quot;.as_ptr(), 
</a><a href="#h31-0-135" id="h31-0-135" class="i">+        0
</a><a href="#h31-0-136" id="h31-0-136" class="i">+    );
</a><a href="#h31-0-137" id="h31-0-137" class="i">+
</a><a href="#h31-0-138" id="h31-0-138" class="i">+    let result: String =  if js_value.tag == JS_TAG_STRING {
</a><a href="#h31-0-139" id="h31-0-139" class="i">+        let string = js_value.u.ptr as *mut JsString;
</a><a href="#h31-0-140" id="h31-0-140" class="i">+        CStr::from_ptr((*string).str8.as_ptr() as *const u8).to_str().unwrap().into()
</a><a href="#h31-0-141" id="h31-0-141" class="i">+    } else if js_value.tag == JS_TAG_INT {
</a><a href="#h31-0-142" id="h31-0-142" class="i">+        js_value.u.int32.to_string()
</a><a href="#h31-0-143" id="h31-0-143" class="i">+    } else if js_value.tag == JS_TAG_BOOL {
</a><a href="#h31-0-144" id="h31-0-144" class="i">+        if js_value.u.int32 == 1 { &quot;true&quot; } else { &quot;false&quot; }.into()
</a><a href="#h31-0-145" id="h31-0-145" class="i">+    } else if js_value.tag == JS_TAG_NULL {
</a><a href="#h31-0-146" id="h31-0-146" class="i">+        &quot;null&quot;.into()
</a><a href="#h31-0-147" id="h31-0-147" class="i">+    } else if js_value.tag == JS_TAG_UNDEFINED {
</a><a href="#h31-0-148" id="h31-0-148" class="i">+        &quot;undefined&quot;.into()
</a><a href="#h31-0-149" id="h31-0-149" class="i">+    } else if js_value.tag == JS_TAG_OBJECT {
</a><a href="#h31-0-150" id="h31-0-150" class="i">+        &quot;[object]&quot;.into()
</a><a href="#h31-0-151" id="h31-0-151" class="i">+    } else if js_value.tag == JS_TAG_FLOAT64 {
</a><a href="#h31-0-152" id="h31-0-152" class="i">+        js_value.u.float64.to_string()
</a><a href="#h31-0-153" id="h31-0-153" class="i">+    } else if js_value.tag == JS_TAG_EXCEPTION {
</a><a href="#h31-0-154" id="h31-0-154" class="i">+        &quot;Failed to evaluate script&quot;.into()
</a><a href="#h31-0-155" id="h31-0-155" class="i">+    } else {
</a><a href="#h31-0-156" id="h31-0-156" class="i">+        &quot;[unknown tag &quot;.to_owned() + &amp;js_value.tag.to_string() + &quot;]&quot;.into()
</a><a href="#h31-0-157" id="h31-0-157" class="i">+    };
</a><a href="#h31-0-158" id="h31-0-158" class="i">+    
</a><a href="#h31-0-159" id="h31-0-159" class="i">+    env.new_string(result).unwrap().into_raw()
</a><a href="#h31-0-160" id="h31-0-160" class="i">+}
</a><a href="#h31-0-161" id="h31-0-161" class="i">+
</a><a href="#h31-0-162" id="h31-0-162" class="i">+pub fn init() {
</a><a href="#h31-0-163" id="h31-0-163" class="i">+    if !config::native_config().composer_hooks {
</a><a href="#h31-0-164" id="h31-0-164" class="i">+        return
</a><a href="#h31-0-165" id="h31-0-165" class="i">+    }
</a><a href="#h31-0-166" id="h31-0-166" class="i">+    
</a><a href="#h31-0-167" id="h31-0-167" class="i">+    if let Some(signature) = sig::find_signature(
</a><a href="#h31-0-168" id="h31-0-168" class="i">+        &amp;common::CLIENT_MODULE,
</a><a href="#h31-0-169" id="h31-0-169" class="i">+        &quot;00 E4 00 6F 29 00 80 52 76 00 04 8B&quot;, -0x28,
</a><a href="#h31-0-170" id="h31-0-170" class="i">+        &quot;A1 B0 07 92 81 46&quot;, -0x7
</a><a href="#h31-0-171" id="h31-0-171" class="i">+    ) {
</a><a href="#h31-0-172" id="h31-0-172" class="i">+        dobby_hook!(signature as *mut c_void, js_eval);
</a><a href="#h31-0-173" id="h31-0-173" class="i">+        
</a><a href="#h31-0-174" id="h31-0-174" class="i">+        unsafe { 
</a><a href="#h31-0-175" id="h31-0-175" class="i">+            JS_EVAL_ORIGINAL2 = Some(std::mem::transmute(js_eval_original.unwrap()));
</a><a href="#h31-0-176" id="h31-0-176" class="i">+        }
</a><a href="#h31-0-177" id="h31-0-177" class="i">+
</a><a href="#h31-0-178" id="h31-0-178" class="i">+        debug!(&quot;js_eval {:#x}&quot;, signature);
</a><a href="#h31-0-179" id="h31-0-179" class="i">+    } else {
</a><a href="#h31-0-180" id="h31-0-180" class="i">+        warn!(&quot;Unable to find js_eval signature&quot;);
</a><a href="#h31-0-181" id="h31-0-181" class="i">+    }
</a><a href="#h31-0-182" id="h31-0-182" class="i">+}
</a><a href="#h31-0-183" id="h31-0-183" class="i">+
</a><b>diff --git a/<a id="h32" href="../file/native/rust/src/modules/custom_font_hook.rs.html">native/rust/src/modules/custom_font_hook.rs</a> b/<a href="../file/native/rust/src/modules/custom_font_hook.rs.html">native/rust/src/modules/custom_font_hook.rs</a></b>
<b>diff --git a/<a id="h33" href="../file/native/rust/src/modules/duplex_hook.rs.html">native/rust/src/modules/duplex_hook.rs</a> b/<a href="../file/native/rust/src/modules/duplex_hook.rs.html">native/rust/src/modules/duplex_hook.rs</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -0,0 +1,41 @@
</a><a href="#h33-0-0" id="h33-0-0" class="i">+use std::ffi::c_void;
</a><a href="#h33-0-1" id="h33-0-1" class="i">+
</a><a href="#h33-0-2" id="h33-0-2" class="i">+use jni::{objects::JObject, sys::jboolean, JNIEnv};
</a><a href="#h33-0-3" id="h33-0-3" class="i">+
</a><a href="#h33-0-4" id="h33-0-4" class="i">+use crate::{common, def_hook, dobby_hook, util::get_jni_string};
</a><a href="#h33-0-5" id="h33-0-5" class="i">+
</a><a href="#h33-0-6" id="h33-0-6" class="i">+
</a><a href="#h33-0-7" id="h33-0-7" class="i">+def_hook!(
</a><a href="#h33-0-8" id="h33-0-8" class="i">+    is_same_object,
</a><a href="#h33-0-9" id="h33-0-9" class="i">+    jboolean,
</a><a href="#h33-0-10" id="h33-0-10" class="i">+    |env: JNIEnv, obj1: JObject, obj2: JObject| {
</a><a href="#h33-0-11" id="h33-0-11" class="i">+        let mut env = env;
</a><a href="#h33-0-12" id="h33-0-12" class="i">+
</a><a href="#h33-0-13" id="h33-0-13" class="i">+        if obj1.is_null() || obj2.is_null() {
</a><a href="#h33-0-14" id="h33-0-14" class="i">+            return is_same_object_original.unwrap()(env, obj1, obj2);
</a><a href="#h33-0-15" id="h33-0-15" class="i">+        }
</a><a href="#h33-0-16" id="h33-0-16" class="i">+
</a><a href="#h33-0-17" id="h33-0-17" class="i">+        let class = env.find_class(&quot;java/lang/Class&quot;).unwrap();
</a><a href="#h33-0-18" id="h33-0-18" class="i">+
</a><a href="#h33-0-19" id="h33-0-19" class="i">+        if !env.is_instance_of(&amp;obj1, class).unwrap() {
</a><a href="#h33-0-20" id="h33-0-20" class="i">+            return is_same_object_original.unwrap()(env, obj1, obj2);
</a><a href="#h33-0-21" id="h33-0-21" class="i">+        }
</a><a href="#h33-0-22" id="h33-0-22" class="i">+        
</a><a href="#h33-0-23" id="h33-0-23" class="i">+        let obj1_class_name = env.call_method(&amp;obj1, &quot;getName&quot;, &quot;()Ljava/lang/String;&quot;, &amp;[]).unwrap().l().unwrap().into();
</a><a href="#h33-0-24" id="h33-0-24" class="i">+        let class_name = get_jni_string(&amp;mut env, obj1_class_name).expect(&quot;Failed to get class name&quot;);
</a><a href="#h33-0-25" id="h33-0-25" class="i">+
</a><a href="#h33-0-26" id="h33-0-26" class="i">+        if class_name.contains(&quot;com.snapchat.client.duplex.MessageHandler&quot;) {
</a><a href="#h33-0-27" id="h33-0-27" class="i">+            debug!(&quot;is_same_object hook: MessageHandler&quot;);
</a><a href="#h33-0-28" id="h33-0-28" class="i">+            return 0;
</a><a href="#h33-0-29" id="h33-0-29" class="i">+        }
</a><a href="#h33-0-30" id="h33-0-30" class="i">+
</a><a href="#h33-0-31" id="h33-0-31" class="i">+        is_same_object_original.unwrap()(env, obj1, obj2)
</a><a href="#h33-0-32" id="h33-0-32" class="i">+    }
</a><a href="#h33-0-33" id="h33-0-33" class="i">+);
</a><a href="#h33-0-34" id="h33-0-34" class="i">+
</a><a href="#h33-0-35" id="h33-0-35" class="i">+
</a><a href="#h33-0-36" id="h33-0-36" class="i">+pub fn init() {
</a><a href="#h33-0-37" id="h33-0-37" class="i">+    common::attach_jni_env(|env| {
</a><a href="#h33-0-38" id="h33-0-38" class="i">+        dobby_hook!((**env.get_native_interface()).IsSameObject.unwrap() as *mut c_void, is_same_object);
</a><a href="#h33-0-39" id="h33-0-39" class="i">+    });
</a><a href="#h33-0-40" id="h33-0-40" class="i">+}</a><a href="#h33-0-41" id="h33-0-41" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h34" href="../file/native/rust/src/modules/fstat_hook.rs.html">native/rust/src/modules/fstat_hook.rs</a> b/<a href="../file/native/rust/src/modules/fstat_hook.rs.html">native/rust/src/modules/fstat_hook.rs</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -0,0 +1,37 @@
</a><a href="#h34-0-0" id="h34-0-0" class="i">+
</a><a href="#h34-0-1" id="h34-0-1" class="i">+use std::fs;
</a><a href="#h34-0-2" id="h34-0-2" class="i">+
</a><a href="#h34-0-3" id="h34-0-3" class="i">+use nix::libc;
</a><a href="#h34-0-4" id="h34-0-4" class="i">+
</a><a href="#h34-0-5" id="h34-0-5" class="i">+use crate::{config::{self, native_config}, def_hook, dobby_hook_sym};
</a><a href="#h34-0-6" id="h34-0-6" class="i">+
</a><a href="#h34-0-7" id="h34-0-7" class="i">+def_hook!(
</a><a href="#h34-0-8" id="h34-0-8" class="i">+    fstat_hook,
</a><a href="#h34-0-9" id="h34-0-9" class="i">+    i32, 
</a><a href="#h34-0-10" id="h34-0-10" class="i">+    |fd: i32, statbuf: *mut libc::stat| {
</a><a href="#h34-0-11" id="h34-0-11" class="i">+        if let Ok(link) = fs::read_link(&quot;/proc/self/fd/&quot;.to_owned() + &amp;fd.to_string()) {
</a><a href="#h34-0-12" id="h34-0-12" class="i">+            if let Some(filename) = link.file_name().map(|t| t.to_string_lossy()) {
</a><a href="#h34-0-13" id="h34-0-13" class="i">+                let config = native_config();
</a><a href="#h34-0-14" id="h34-0-14" class="i">+                if config.disable_metrics &amp;&amp; filename.contains(&quot;files/blizzardv2/queues&quot;) {
</a><a href="#h34-0-15" id="h34-0-15" class="i">+                    if libc::unlink((filename.to_owned() + &quot;\0&quot;).as_ptr()) == -1 {
</a><a href="#h34-0-16" id="h34-0-16" class="i">+                        warn!(&quot;Failed to unlink {}&quot;, filename);
</a><a href="#h34-0-17" id="h34-0-17" class="i">+                    }
</a><a href="#h34-0-18" id="h34-0-18" class="i">+                    return -1;
</a><a href="#h34-0-19" id="h34-0-19" class="i">+                }
</a><a href="#h34-0-20" id="h34-0-20" class="i">+    
</a><a href="#h34-0-21" id="h34-0-21" class="i">+                if config.disable_bitmoji &amp;&amp; filename.contains(&quot;com.snap.file_manager_4_SCContent&quot;) {
</a><a href="#h34-0-22" id="h34-0-22" class="i">+                    return -1;
</a><a href="#h34-0-23" id="h34-0-23" class="i">+                }
</a><a href="#h34-0-24" id="h34-0-24" class="i">+            }
</a><a href="#h34-0-25" id="h34-0-25" class="i">+        }
</a><a href="#h34-0-26" id="h34-0-26" class="i">+
</a><a href="#h34-0-27" id="h34-0-27" class="i">+        fstat_hook_original.unwrap()(fd, statbuf)
</a><a href="#h34-0-28" id="h34-0-28" class="i">+    }
</a><a href="#h34-0-29" id="h34-0-29" class="i">+);
</a><a href="#h34-0-30" id="h34-0-30" class="i">+
</a><a href="#h34-0-31" id="h34-0-31" class="i">+pub fn init() {
</a><a href="#h34-0-32" id="h34-0-32" class="i">+    let config = config::native_config();
</a><a href="#h34-0-33" id="h34-0-33" class="i">+    if config.disable_metrics || config.disable_bitmoji {
</a><a href="#h34-0-34" id="h34-0-34" class="i">+        dobby_hook_sym!(&quot;libc.so&quot;, &quot;fstat&quot;, fstat_hook);
</a><a href="#h34-0-35" id="h34-0-35" class="i">+    }
</a><a href="#h34-0-36" id="h34-0-36" class="i">+}</a><a href="#h34-0-37" id="h34-0-37" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h35" href="../file/native/rust/src/modules/linker_hook.rs.html">native/rust/src/modules/linker_hook.rs</a> b/<a href="../file/native/rust/src/modules/linker_hook.rs.html">native/rust/src/modules/linker_hook.rs</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -0,0 +1,60 @@
</a><a href="#h35-0-0" id="h35-0-0" class="i">+use std::{collections::HashMap, ffi::{c_void, CStr}, sync::Mutex};
</a><a href="#h35-0-1" id="h35-0-1" class="i">+
</a><a href="#h35-0-2" id="h35-0-2" class="i">+use jni::{objects::{JByteArray, JString}, JNIEnv};
</a><a href="#h35-0-3" id="h35-0-3" class="i">+use nix::libc;
</a><a href="#h35-0-4" id="h35-0-4" class="i">+use once_cell::sync::Lazy;
</a><a href="#h35-0-5" id="h35-0-5" class="i">+
</a><a href="#h35-0-6" id="h35-0-6" class="i">+use crate::{def_hook, dobby_hook_sym};
</a><a href="#h35-0-7" id="h35-0-7" class="i">+
</a><a href="#h35-0-8" id="h35-0-8" class="i">+static SHARED_LIBRARIES: Lazy&lt;Mutex&lt;HashMap&lt;String, Box&lt;Vec&lt;i8&gt;&gt;&gt;&gt;&gt; = Lazy::new(|| Mutex::new(HashMap::new()));
</a><a href="#h35-0-9" id="h35-0-9" class="i">+
</a><a href="#h35-0-10" id="h35-0-10" class="i">+def_hook!(
</a><a href="#h35-0-11" id="h35-0-11" class="i">+    linker_openat,
</a><a href="#h35-0-12" id="h35-0-12" class="i">+    i32,
</a><a href="#h35-0-13" id="h35-0-13" class="i">+    |dir_fd: i32, pathname: *mut u8, flags: i32, mode: i32| {
</a><a href="#h35-0-14" id="h35-0-14" class="i">+        let pathname_str = CStr::from_ptr(pathname).to_str().unwrap().to_string();
</a><a href="#h35-0-15" id="h35-0-15" class="i">+
</a><a href="#h35-0-16" id="h35-0-16" class="i">+        if let Some(content) = SHARED_LIBRARIES.lock().unwrap().remove(&amp;pathname_str) {
</a><a href="#h35-0-17" id="h35-0-17" class="i">+            let memfd = libc::syscall(libc::SYS_memfd_create, &quot;me.rhunk.snapenhance\0&quot;.as_ptr(), 0) as i32;
</a><a href="#h35-0-18" id="h35-0-18" class="i">+            let content = content.into_boxed_slice();
</a><a href="#h35-0-19" id="h35-0-19" class="i">+            
</a><a href="#h35-0-20" id="h35-0-20" class="i">+            if libc::write(memfd, content.as_ptr() as *const c_void, content.len() as libc::size_t) == -1 {
</a><a href="#h35-0-21" id="h35-0-21" class="i">+                panic!(&quot;failed to write to memfd&quot;);
</a><a href="#h35-0-22" id="h35-0-22" class="i">+            }
</a><a href="#h35-0-23" id="h35-0-23" class="i">+
</a><a href="#h35-0-24" id="h35-0-24" class="i">+            if libc::lseek(memfd, 0, libc::SEEK_SET) == -1 {
</a><a href="#h35-0-25" id="h35-0-25" class="i">+                panic!(&quot;failed to seek memfd&quot;);
</a><a href="#h35-0-26" id="h35-0-26" class="i">+            }
</a><a href="#h35-0-27" id="h35-0-27" class="i">+
</a><a href="#h35-0-28" id="h35-0-28" class="i">+            std::mem::forget(content);
</a><a href="#h35-0-29" id="h35-0-29" class="i">+
</a><a href="#h35-0-30" id="h35-0-30" class="i">+            info!(&quot;opened shared library: {}&quot;, pathname_str);
</a><a href="#h35-0-31" id="h35-0-31" class="i">+            return memfd;
</a><a href="#h35-0-32" id="h35-0-32" class="i">+        }
</a><a href="#h35-0-33" id="h35-0-33" class="i">+
</a><a href="#h35-0-34" id="h35-0-34" class="i">+        linker_openat_original.unwrap()(dir_fd, pathname, flags, mode)
</a><a href="#h35-0-35" id="h35-0-35" class="i">+    }
</a><a href="#h35-0-36" id="h35-0-36" class="i">+);
</a><a href="#h35-0-37" id="h35-0-37" class="i">+
</a><a href="#h35-0-38" id="h35-0-38" class="i">+pub fn add_linker_shared_library(mut env: JNIEnv, _: *mut c_void, path: JString, content: JByteArray) {
</a><a href="#h35-0-39" id="h35-0-39" class="i">+    let path = env.get_string(&amp;path).unwrap().to_str().unwrap().to_string();
</a><a href="#h35-0-40" id="h35-0-40" class="i">+    let content_length = env.get_array_length(&amp;content).expect(&quot;Failed to get array length&quot;);
</a><a href="#h35-0-41" id="h35-0-41" class="i">+    let mut content_buffer = Box::new(vec![0i8; content_length as usize]);
</a><a href="#h35-0-42" id="h35-0-42" class="i">+    
</a><a href="#h35-0-43" id="h35-0-43" class="i">+    env.get_byte_array_region(content, 0, content_buffer.as_mut_slice()).expect(&quot;Failed to get byte array region&quot;);
</a><a href="#h35-0-44" id="h35-0-44" class="i">+    
</a><a href="#h35-0-45" id="h35-0-45" class="i">+    debug!(&quot;added shared library: {}&quot;, path);
</a><a href="#h35-0-46" id="h35-0-46" class="i">+
</a><a href="#h35-0-47" id="h35-0-47" class="i">+    SHARED_LIBRARIES.lock().unwrap().insert(path, content_buffer);
</a><a href="#h35-0-48" id="h35-0-48" class="i">+}
</a><a href="#h35-0-49" id="h35-0-49" class="i">+
</a><a href="#h35-0-50" id="h35-0-50" class="i">+pub fn init() {
</a><a href="#h35-0-51" id="h35-0-51" class="i">+    #[cfg(target_arch = &quot;aarch64&quot;)]
</a><a href="#h35-0-52" id="h35-0-52" class="i">+    {
</a><a href="#h35-0-53" id="h35-0-53" class="i">+        dobby_hook_sym!(&quot;linker64&quot;, &quot;__dl___openat&quot;, linker_openat);
</a><a href="#h35-0-54" id="h35-0-54" class="i">+    }
</a><a href="#h35-0-55" id="h35-0-55" class="i">+    #[cfg(target_arch = &quot;arm&quot;)]
</a><a href="#h35-0-56" id="h35-0-56" class="i">+    {
</a><a href="#h35-0-57" id="h35-0-57" class="i">+        dobby_hook_sym!(&quot;linker&quot;, &quot;__dl___openat&quot;, linker_openat);
</a><a href="#h35-0-58" id="h35-0-58" class="i">+    }
</a><a href="#h35-0-59" id="h35-0-59" class="i">+}
</a><b>diff --git a/<a id="h36" href="../file/native/rust/src/modules/mod.rs.html">native/rust/src/modules/mod.rs</a> b/<a href="../file/native/rust/src/modules/mod.rs.html">native/rust/src/modules/mod.rs</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -0,0 +1,6 @@
</a><a href="#h36-0-0" id="h36-0-0" class="i">+pub mod linker_hook;
</a><a href="#h36-0-1" id="h36-0-1" class="i">+pub mod duplex_hook;
</a><a href="#h36-0-2" id="h36-0-2" class="i">+pub mod sqlite_hook;
</a><a href="#h36-0-3" id="h36-0-3" class="i">+pub mod fstat_hook;
</a><a href="#h36-0-4" id="h36-0-4" class="i">+pub mod unary_call_hook;
</a><a href="#h36-0-5" id="h36-0-5" class="i">+pub mod composer_hook;</a><a href="#h36-0-6" id="h36-0-6" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h37" href="../file/native/rust/src/modules/sqlite_hook.rs.html">native/rust/src/modules/sqlite_hook.rs</a> b/<a href="../file/native/rust/src/modules/sqlite_hook.rs.html">native/rust/src/modules/sqlite_hook.rs</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -0,0 +1,81 @@
</a><a href="#h37-0-0" id="h37-0-0" class="i">+use std::{collections::HashMap, ffi::{c_void, CStr}, mem::size_of, ptr::addr_of_mut, sync::Mutex};
</a><a href="#h37-0-1" id="h37-0-1" class="i">+
</a><a href="#h37-0-2" id="h37-0-2" class="i">+use jni::{objects::{JObject, JString}, JNIEnv};
</a><a href="#h37-0-3" id="h37-0-3" class="i">+use nix::libc::{self, pthread_mutex_t};
</a><a href="#h37-0-4" id="h37-0-4" class="i">+use once_cell::sync::Lazy;
</a><a href="#h37-0-5" id="h37-0-5" class="i">+
</a><a href="#h37-0-6" id="h37-0-6" class="i">+use crate::{common, def_hook, dobby_hook, sig, util::get_jni_string};
</a><a href="#h37-0-7" id="h37-0-7" class="i">+
</a><a href="#h37-0-8" id="h37-0-8" class="i">+
</a><a href="#h37-0-9" id="h37-0-9" class="i">+#[repr(C)]
</a><a href="#h37-0-10" id="h37-0-10" class="i">+#[derive(Clone, Copy, Debug)]
</a><a href="#h37-0-11" id="h37-0-11" class="i">+struct Sqlite3Mutex {
</a><a href="#h37-0-12" id="h37-0-12" class="i">+    mutex: pthread_mutex_t
</a><a href="#h37-0-13" id="h37-0-13" class="i">+}
</a><a href="#h37-0-14" id="h37-0-14" class="i">+
</a><a href="#h37-0-15" id="h37-0-15" class="i">+#[repr(C)]
</a><a href="#h37-0-16" id="h37-0-16" class="i">+struct Sqlite3 {
</a><a href="#h37-0-17" id="h37-0-17" class="i">+    pad: [u8; 3 * size_of::&lt;usize&gt;()],
</a><a href="#h37-0-18" id="h37-0-18" class="i">+    mutex: *mut Sqlite3Mutex
</a><a href="#h37-0-19" id="h37-0-19" class="i">+}
</a><a href="#h37-0-20" id="h37-0-20" class="i">+
</a><a href="#h37-0-21" id="h37-0-21" class="i">+static SQLITE3_MUTEX_MAP: Lazy&lt;Mutex&lt;HashMap&lt;String, pthread_mutex_t&gt;&gt;&gt; = Lazy::new(|| Mutex::new(HashMap::new()));
</a><a href="#h37-0-22" id="h37-0-22" class="i">+
</a><a href="#h37-0-23" id="h37-0-23" class="i">+def_hook!(
</a><a href="#h37-0-24" id="h37-0-24" class="i">+    sqlite3_open,
</a><a href="#h37-0-25" id="h37-0-25" class="i">+    i32,
</a><a href="#h37-0-26" id="h37-0-26" class="i">+    |filename: *const u8, pp_db: *mut *mut Sqlite3, flags: u32, z_vfs: *const i8| {
</a><a href="#h37-0-27" id="h37-0-27" class="i">+        let result = sqlite3_open_original.unwrap()(filename, pp_db, flags, z_vfs);
</a><a href="#h37-0-28" id="h37-0-28" class="i">+
</a><a href="#h37-0-29" id="h37-0-29" class="i">+        if result == 0 {
</a><a href="#h37-0-30" id="h37-0-30" class="i">+            let sqlite3_mutex = (**pp_db).mutex;
</a><a href="#h37-0-31" id="h37-0-31" class="i">+
</a><a href="#h37-0-32" id="h37-0-32" class="i">+            if sqlite3_mutex != std::ptr::null_mut() {
</a><a href="#h37-0-33" id="h37-0-33" class="i">+                let filename = CStr::from_ptr(filename).to_string_lossy().to_string().split(&quot;/&quot;).last().expect(&quot;Failed to get filename&quot;).to_string();
</a><a href="#h37-0-34" id="h37-0-34" class="i">+                debug!(&quot;sqlite3_open hook {:?}&quot;, filename);
</a><a href="#h37-0-35" id="h37-0-35" class="i">+
</a><a href="#h37-0-36" id="h37-0-36" class="i">+                SQLITE3_MUTEX_MAP.lock().unwrap().insert(
</a><a href="#h37-0-37" id="h37-0-37" class="i">+                    filename,
</a><a href="#h37-0-38" id="h37-0-38" class="i">+                    (*sqlite3_mutex).mutex
</a><a href="#h37-0-39" id="h37-0-39" class="i">+                );
</a><a href="#h37-0-40" id="h37-0-40" class="i">+            }
</a><a href="#h37-0-41" id="h37-0-41" class="i">+        }
</a><a href="#h37-0-42" id="h37-0-42" class="i">+
</a><a href="#h37-0-43" id="h37-0-43" class="i">+        result
</a><a href="#h37-0-44" id="h37-0-44" class="i">+    }  
</a><a href="#h37-0-45" id="h37-0-45" class="i">+);
</a><a href="#h37-0-46" id="h37-0-46" class="i">+
</a><a href="#h37-0-47" id="h37-0-47" class="i">+
</a><a href="#h37-0-48" id="h37-0-48" class="i">+pub fn lock_database(mut env: JNIEnv, _: *mut c_void, filename: JString, runnable: JObject) {
</a><a href="#h37-0-49" id="h37-0-49" class="i">+    let database_filename = get_jni_string(&amp;mut env, filename).expect(&quot;Failed to get database filename&quot;);
</a><a href="#h37-0-50" id="h37-0-50" class="i">+    let mutex = SQLITE3_MUTEX_MAP.lock().unwrap().get(&amp;database_filename).map(|mutex| *mutex);
</a><a href="#h37-0-51" id="h37-0-51" class="i">+
</a><a href="#h37-0-52" id="h37-0-52" class="i">+    if let Some(mut mutex) = mutex {
</a><a href="#h37-0-53" id="h37-0-53" class="i">+        if unsafe { libc::pthread_mutex_lock(addr_of_mut!(mutex)) } != 0 {
</a><a href="#h37-0-54" id="h37-0-54" class="i">+            error!(&quot;pthread_mutex_lock failed&quot;);
</a><a href="#h37-0-55" id="h37-0-55" class="i">+            return;
</a><a href="#h37-0-56" id="h37-0-56" class="i">+        }
</a><a href="#h37-0-57" id="h37-0-57" class="i">+
</a><a href="#h37-0-58" id="h37-0-58" class="i">+        env.call_method(runnable, &quot;run&quot;, &quot;()V&quot;, &amp;[]).expect(&quot;Failed to call run method&quot;);
</a><a href="#h37-0-59" id="h37-0-59" class="i">+
</a><a href="#h37-0-60" id="h37-0-60" class="i">+        if unsafe { libc::pthread_mutex_unlock(addr_of_mut!(mutex)) } != 0 {
</a><a href="#h37-0-61" id="h37-0-61" class="i">+            error!(&quot;pthread_mutex_unlock failed&quot;);
</a><a href="#h37-0-62" id="h37-0-62" class="i">+        }
</a><a href="#h37-0-63" id="h37-0-63" class="i">+    } else {
</a><a href="#h37-0-64" id="h37-0-64" class="i">+        warn!(&quot;No mutex found for database: {}&quot;, database_filename);
</a><a href="#h37-0-65" id="h37-0-65" class="i">+    }
</a><a href="#h37-0-66" id="h37-0-66" class="i">+}
</a><a href="#h37-0-67" id="h37-0-67" class="i">+
</a><a href="#h37-0-68" id="h37-0-68" class="i">+
</a><a href="#h37-0-69" id="h37-0-69" class="i">+pub fn init() {
</a><a href="#h37-0-70" id="h37-0-70" class="i">+    if let Some(signature) = sig::find_signature(
</a><a href="#h37-0-71" id="h37-0-71" class="i">+        &amp;common::CLIENT_MODULE, 
</a><a href="#h37-0-72" id="h37-0-72" class="i">+        &quot;FF FF 00 A9 3F 00 00 F9&quot;, -0x3C,
</a><a href="#h37-0-73" id="h37-0-73" class="i">+        &quot;9A 46 90 46 78 44 89 46 05 68&quot;,-0xd
</a><a href="#h37-0-74" id="h37-0-74" class="i">+    ) {
</a><a href="#h37-0-75" id="h37-0-75" class="i">+        debug!(&quot;Found sqlite3_open signature: {:#x}&quot;, signature);
</a><a href="#h37-0-76" id="h37-0-76" class="i">+        dobby_hook!(signature as *mut c_void, sqlite3_open);
</a><a href="#h37-0-77" id="h37-0-77" class="i">+    } else {
</a><a href="#h37-0-78" id="h37-0-78" class="i">+        warn!(&quot;Failed to find sqlite3_open signature&quot;);
</a><a href="#h37-0-79" id="h37-0-79" class="i">+    }
</a><a href="#h37-0-80" id="h37-0-80" class="i">+}</a><a href="#h37-0-81" id="h37-0-81" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h38" href="../file/native/rust/src/modules/unary_call_hook.rs.html">native/rust/src/modules/unary_call_hook.rs</a> b/<a href="../file/native/rust/src/modules/unary_call_hook.rs.html">native/rust/src/modules/unary_call_hook.rs</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -0,0 +1,123 @@
</a><a href="#h38-0-0" id="h38-0-0" class="i">+use std::ffi::{c_void, CStr};
</a><a href="#h38-0-1" id="h38-0-1" class="i">+
</a><a href="#h38-0-2" id="h38-0-2" class="i">+use jni::{objects::{JByteArray, JMethodID, JValue}, signature::ReturnType};
</a><a href="#h38-0-3" id="h38-0-3" class="i">+use nix::libc;
</a><a href="#h38-0-4" id="h38-0-4" class="i">+use once_cell::sync::OnceCell;
</a><a href="#h38-0-5" id="h38-0-5" class="i">+
</a><a href="#h38-0-6" id="h38-0-6" class="i">+use crate::{common::{self}, def_hook, dobby_hook, sig};
</a><a href="#h38-0-7" id="h38-0-7" class="i">+
</a><a href="#h38-0-8" id="h38-0-8" class="i">+#[repr(C)]
</a><a href="#h38-0-9" id="h38-0-9" class="i">+#[derive(Copy, Clone)]
</a><a href="#h38-0-10" id="h38-0-10" class="i">+struct RefCountedSliceByteBuffer {
</a><a href="#h38-0-11" id="h38-0-11" class="i">+    ref_counter: *mut c_void,
</a><a href="#h38-0-12" id="h38-0-12" class="i">+    length: usize,
</a><a href="#h38-0-13" id="h38-0-13" class="i">+    data: *mut u8
</a><a href="#h38-0-14" id="h38-0-14" class="i">+}
</a><a href="#h38-0-15" id="h38-0-15" class="i">+
</a><a href="#h38-0-16" id="h38-0-16" class="i">+#[repr(C)]
</a><a href="#h38-0-17" id="h38-0-17" class="i">+struct GrpcByteBuffer {
</a><a href="#h38-0-18" id="h38-0-18" class="i">+    reserved: *mut c_void,
</a><a href="#h38-0-19" id="h38-0-19" class="i">+    type_: *mut c_void,
</a><a href="#h38-0-20" id="h38-0-20" class="i">+    compression: *mut c_void,
</a><a href="#h38-0-21" id="h38-0-21" class="i">+    slice_buffer: *mut RefCountedSliceByteBuffer
</a><a href="#h38-0-22" id="h38-0-22" class="i">+}
</a><a href="#h38-0-23" id="h38-0-23" class="i">+
</a><a href="#h38-0-24" id="h38-0-24" class="i">+static NATIVE_LIB_ON_UNARY_CALL_METHOD: OnceCell&lt;JMethodID&gt; = OnceCell::new();
</a><a href="#h38-0-25" id="h38-0-25" class="i">+
</a><a href="#h38-0-26" id="h38-0-26" class="i">+def_hook!(
</a><a href="#h38-0-27" id="h38-0-27" class="i">+    unary_call,
</a><a href="#h38-0-28" id="h38-0-28" class="i">+    *mut c_void,
</a><a href="#h38-0-29" id="h38-0-29" class="i">+    |unk1: *mut c_void, uri: *const u8, grpc_byte_buffer: *mut *mut GrpcByteBuffer, unk4: *mut c_void, unk5: *mut c_void, unk6: *mut c_void| {
</a><a href="#h38-0-30" id="h38-0-30" class="i">+        macro_rules! call_original {
</a><a href="#h38-0-31" id="h38-0-31" class="i">+            () =&gt; {
</a><a href="#h38-0-32" id="h38-0-32" class="i">+                unary_call_original.unwrap()(unk1, uri, grpc_byte_buffer, unk4, unk5, unk6)
</a><a href="#h38-0-33" id="h38-0-33" class="i">+            };
</a><a href="#h38-0-34" id="h38-0-34" class="i">+        }
</a><a href="#h38-0-35" id="h38-0-35" class="i">+
</a><a href="#h38-0-36" id="h38-0-36" class="i">+        // make a local copy of the slice buffer
</a><a href="#h38-0-37" id="h38-0-37" class="i">+        let mut slice_buffer = *(**grpc_byte_buffer).slice_buffer;
</a><a href="#h38-0-38" id="h38-0-38" class="i">+
</a><a href="#h38-0-39" id="h38-0-39" class="i">+        if slice_buffer.ref_counter.is_null() {
</a><a href="#h38-0-40" id="h38-0-40" class="i">+            return call_original!();
</a><a href="#h38-0-41" id="h38-0-41" class="i">+        }
</a><a href="#h38-0-42" id="h38-0-42" class="i">+
</a><a href="#h38-0-43" id="h38-0-43" class="i">+        let java_vm = common::java_vm();
</a><a href="#h38-0-44" id="h38-0-44" class="i">+        let mut env = java_vm.get_env().expect(&quot;Failed to get JNIEnv&quot;);
</a><a href="#h38-0-45" id="h38-0-45" class="i">+
</a><a href="#h38-0-46" id="h38-0-46" class="i">+        let slice_buffer_length = slice_buffer.length as usize;
</a><a href="#h38-0-47" id="h38-0-47" class="i">+        let jni_buffer = env.new_byte_array(slice_buffer_length as i32).expect(&quot;Failed to create new byte array&quot;);
</a><a href="#h38-0-48" id="h38-0-48" class="i">+        env.set_byte_array_region(&amp;jni_buffer, 0, std::slice::from_raw_parts(slice_buffer.data as *const i8, slice_buffer_length)).expect(&quot;Failed to set byte array region&quot;);
</a><a href="#h38-0-49" id="h38-0-49" class="i">+
</a><a href="#h38-0-50" id="h38-0-50" class="i">+        let uri_str = CStr::from_ptr(uri).to_str().unwrap();
</a><a href="#h38-0-51" id="h38-0-51" class="i">+
</a><a href="#h38-0-52" id="h38-0-52" class="i">+        let native_request_data_object = env.call_method_unchecked(
</a><a href="#h38-0-53" id="h38-0-53" class="i">+            common::native_lib_instance(),
</a><a href="#h38-0-54" id="h38-0-54" class="i">+            NATIVE_LIB_ON_UNARY_CALL_METHOD.get().unwrap(),
</a><a href="#h38-0-55" id="h38-0-55" class="i">+            ReturnType::Object,
</a><a href="#h38-0-56" id="h38-0-56" class="i">+            &amp;[
</a><a href="#h38-0-57" id="h38-0-57" class="i">+                JValue::from(&amp;env.new_string(uri_str).unwrap()).as_jni(),
</a><a href="#h38-0-58" id="h38-0-58" class="i">+                JValue::from(&amp;jni_buffer).as_jni()
</a><a href="#h38-0-59" id="h38-0-59" class="i">+            ]
</a><a href="#h38-0-60" id="h38-0-60" class="i">+        ).expect(&quot;Failed to call onNativeUnaryCall method&quot;).l().unwrap();
</a><a href="#h38-0-61" id="h38-0-61" class="i">+
</a><a href="#h38-0-62" id="h38-0-62" class="i">+        if native_request_data_object.is_null() {
</a><a href="#h38-0-63" id="h38-0-63" class="i">+            return call_original!();
</a><a href="#h38-0-64" id="h38-0-64" class="i">+        }
</a><a href="#h38-0-65" id="h38-0-65" class="i">+
</a><a href="#h38-0-66" id="h38-0-66" class="i">+        let is_canceled = env.get_field(&amp;native_request_data_object, &quot;canceled&quot;, &quot;Z&quot;).expect(&quot;Failed to get canceled field&quot;).z().unwrap();
</a><a href="#h38-0-67" id="h38-0-67" class="i">+
</a><a href="#h38-0-68" id="h38-0-68" class="i">+        if is_canceled {
</a><a href="#h38-0-69" id="h38-0-69" class="i">+            info!(&quot;canceled request for {}&quot;, uri_str);
</a><a href="#h38-0-70" id="h38-0-70" class="i">+            return std::ptr::null_mut();
</a><a href="#h38-0-71" id="h38-0-71" class="i">+        }
</a><a href="#h38-0-72" id="h38-0-72" class="i">+
</a><a href="#h38-0-73" id="h38-0-73" class="i">+        let new_buffer: JByteArray = env.get_field(&amp;native_request_data_object, &quot;buffer&quot;, &quot;[B&quot;).expect(&quot;Failed to get buffer field&quot;).l().unwrap().into();
</a><a href="#h38-0-74" id="h38-0-74" class="i">+        let new_buffer_length = env.get_array_length(&amp;new_buffer).expect(&quot;Failed to get array length&quot;) as usize;
</a><a href="#h38-0-75" id="h38-0-75" class="i">+
</a><a href="#h38-0-76" id="h38-0-76" class="i">+        let mut new_buffer_data = Box::new(vec![0i8; new_buffer_length]);
</a><a href="#h38-0-77" id="h38-0-77" class="i">+        env.get_byte_array_region(&amp;new_buffer, 0, new_buffer_data.as_mut_slice()).expect(&quot;Failed to get byte array region&quot;);
</a><a href="#h38-0-78" id="h38-0-78" class="i">+
</a><a href="#h38-0-79" id="h38-0-79" class="i">+        let ref_counter_struct_size = (slice_buffer.data as usize) - (slice_buffer.ref_counter as usize);
</a><a href="#h38-0-80" id="h38-0-80" class="i">+
</a><a href="#h38-0-81" id="h38-0-81" class="i">+        //we need to allocate a new ref_counter struct and copy the old ref_counter and the new_buffer to it
</a><a href="#h38-0-82" id="h38-0-82" class="i">+        let new_ref = {
</a><a href="#h38-0-83" id="h38-0-83" class="i">+            let new_ref = libc::malloc(ref_counter_struct_size + new_buffer_length) as *mut c_void;
</a><a href="#h38-0-84" id="h38-0-84" class="i">+            libc::memcpy(new_ref, slice_buffer.ref_counter, ref_counter_struct_size);
</a><a href="#h38-0-85" id="h38-0-85" class="i">+            libc::memcpy(new_ref.offset(ref_counter_struct_size as isize), new_buffer_data.as_ptr() as *const c_void, new_buffer_length);
</a><a href="#h38-0-86" id="h38-0-86" class="i">+            libc::free(slice_buffer.ref_counter);
</a><a href="#h38-0-87" id="h38-0-87" class="i">+            new_ref
</a><a href="#h38-0-88" id="h38-0-88" class="i">+        };
</a><a href="#h38-0-89" id="h38-0-89" class="i">+
</a><a href="#h38-0-90" id="h38-0-90" class="i">+        slice_buffer.ref_counter = new_ref;
</a><a href="#h38-0-91" id="h38-0-91" class="i">+        slice_buffer.length = new_buffer_length;
</a><a href="#h38-0-92" id="h38-0-92" class="i">+        slice_buffer.data = new_ref.offset(ref_counter_struct_size as isize) as *mut u8;
</a><a href="#h38-0-93" id="h38-0-93" class="i">+
</a><a href="#h38-0-94" id="h38-0-94" class="i">+        // update the grpc byte buffer
</a><a href="#h38-0-95" id="h38-0-95" class="i">+        *(**grpc_byte_buffer).slice_buffer = slice_buffer;
</a><a href="#h38-0-96" id="h38-0-96" class="i">+
</a><a href="#h38-0-97" id="h38-0-97" class="i">+        debug!(&quot;unary_call {}&quot;, uri_str);
</a><a href="#h38-0-98" id="h38-0-98" class="i">+
</a><a href="#h38-0-99" id="h38-0-99" class="i">+        call_original!()
</a><a href="#h38-0-100" id="h38-0-100" class="i">+    }
</a><a href="#h38-0-101" id="h38-0-101" class="i">+);
</a><a href="#h38-0-102" id="h38-0-102" class="i">+
</a><a href="#h38-0-103" id="h38-0-103" class="i">+pub fn init() {
</a><a href="#h38-0-104" id="h38-0-104" class="i">+    if let Some(signature) = sig::find_signature(
</a><a href="#h38-0-105" id="h38-0-105" class="i">+        &amp;common::CLIENT_MODULE, 
</a><a href="#h38-0-106" id="h38-0-106" class="i">+        &quot;A8 03 1F F8 C2 00 00 94&quot;, -0x48,
</a><a href="#h38-0-107" id="h38-0-107" class="i">+        &quot;0A 90 00 F0 3F F9&quot;, -0x37
</a><a href="#h38-0-108" id="h38-0-108" class="i">+    ) {
</a><a href="#h38-0-109" id="h38-0-109" class="i">+        dobby_hook!(signature as *mut c_void, unary_call);
</a><a href="#h38-0-110" id="h38-0-110" class="i">+        common::attach_jni_env(|env| {
</a><a href="#h38-0-111" id="h38-0-111" class="i">+            NATIVE_LIB_ON_UNARY_CALL_METHOD.set(
</a><a href="#h38-0-112" id="h38-0-112" class="i">+                env.get_method_id(
</a><a href="#h38-0-113" id="h38-0-113" class="i">+                    env.get_object_class(common::native_lib_instance()).unwrap(),
</a><a href="#h38-0-114" id="h38-0-114" class="i">+                        &quot;onNativeUnaryCall&quot;, 
</a><a href="#h38-0-115" id="h38-0-115" class="i">+                        &quot;(Ljava/lang/String;[B)Lme/rhunk/snapenhance/nativelib/NativeRequestData;&quot;
</a><a href="#h38-0-116" id="h38-0-116" class="i">+                ).expect(&quot;Failed to get onNativeUnaryCall method id&quot;)
</a><a href="#h38-0-117" id="h38-0-117" class="i">+            ).expect(&quot;unary call method already set&quot;);
</a><a href="#h38-0-118" id="h38-0-118" class="i">+        });
</a><a href="#h38-0-119" id="h38-0-119" class="i">+    } else {
</a><a href="#h38-0-120" id="h38-0-120" class="i">+        error!(&quot;Can&#39;t find unaryCall signature&quot;);
</a><a href="#h38-0-121" id="h38-0-121" class="i">+    }
</a><a href="#h38-0-122" id="h38-0-122" class="i">+}</a><a href="#h38-0-123" id="h38-0-123" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h39" href="../file/native/rust/src/sig.rs.html">native/rust/src/sig.rs</a> b/<a href="../file/native/rust/src/sig.rs.html">native/rust/src/sig.rs</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -0,0 +1,99 @@
</a><a href="#h39-0-0" id="h39-0-0" class="i">+use std::sync::Mutex;
</a><a href="#h39-0-1" id="h39-0-1" class="i">+
</a><a href="#h39-0-2" id="h39-0-2" class="i">+use procfs::process::MMPermissions;
</a><a href="#h39-0-3" id="h39-0-3" class="i">+
</a><a href="#h39-0-4" id="h39-0-4" class="i">+use crate::mapped_lib::MappedLib;
</a><a href="#h39-0-5" id="h39-0-5" class="i">+
</a><a href="#h39-0-6" id="h39-0-6" class="i">+
</a><a href="#h39-0-7" id="h39-0-7" class="i">+static SIGNATURE_CACHE: Mutex&lt;Vec&lt;(String, Vec&lt;usize&gt;)&gt;&gt; = Mutex::new(Vec::new());
</a><a href="#h39-0-8" id="h39-0-8" class="i">+
</a><a href="#h39-0-9" id="h39-0-9" class="i">+pub fn add_signatures(signatures: Vec&lt;(String, Vec&lt;usize&gt;)&gt;) {
</a><a href="#h39-0-10" id="h39-0-10" class="i">+    SIGNATURE_CACHE.lock().unwrap().extend(signatures);
</a><a href="#h39-0-11" id="h39-0-11" class="i">+}
</a><a href="#h39-0-12" id="h39-0-12" class="i">+
</a><a href="#h39-0-13" id="h39-0-13" class="i">+pub fn get_signatures() -&gt; Vec&lt;(String, Vec&lt;usize&gt;)&gt; {
</a><a href="#h39-0-14" id="h39-0-14" class="i">+    SIGNATURE_CACHE.lock().unwrap().clone()
</a><a href="#h39-0-15" id="h39-0-15" class="i">+}
</a><a href="#h39-0-16" id="h39-0-16" class="i">+
</a><a href="#h39-0-17" id="h39-0-17" class="i">+pub fn find_signatures(module_base: usize, size: usize, pattern: &amp;str, once: bool) -&gt; Vec&lt;usize&gt; {
</a><a href="#h39-0-18" id="h39-0-18" class="i">+    let mut results = Vec::new();
</a><a href="#h39-0-19" id="h39-0-19" class="i">+    let mut bytes = Vec::new();
</a><a href="#h39-0-20" id="h39-0-20" class="i">+    let mut mask = Vec::new();
</a><a href="#h39-0-21" id="h39-0-21" class="i">+    let mut i = 0;
</a><a href="#h39-0-22" id="h39-0-22" class="i">+
</a><a href="#h39-0-23" id="h39-0-23" class="i">+    if let Some(cache) = SIGNATURE_CACHE.lock().unwrap().iter().find(|(sig, _)| sig == pattern) {
</a><a href="#h39-0-24" id="h39-0-24" class="i">+        return cache.1.clone().into_iter().map(|offset| module_base + offset).collect();
</a><a href="#h39-0-25" id="h39-0-25" class="i">+    }
</a><a href="#h39-0-26" id="h39-0-26" class="i">+
</a><a href="#h39-0-27" id="h39-0-27" class="i">+    while i &lt; pattern.len() {
</a><a href="#h39-0-28" id="h39-0-28" class="i">+        if pattern.chars().nth(i).unwrap() == &#39;?&#39; {
</a><a href="#h39-0-29" id="h39-0-29" class="i">+            bytes.push(0);
</a><a href="#h39-0-30" id="h39-0-30" class="i">+            mask.push(&#39;?&#39;);
</a><a href="#h39-0-31" id="h39-0-31" class="i">+        } else {
</a><a href="#h39-0-32" id="h39-0-32" class="i">+            bytes.push(u8::from_str_radix(&amp;pattern[i..i+2], 16).unwrap());
</a><a href="#h39-0-33" id="h39-0-33" class="i">+            mask.push(&#39;x&#39;);
</a><a href="#h39-0-34" id="h39-0-34" class="i">+        }
</a><a href="#h39-0-35" id="h39-0-35" class="i">+        i += 3;
</a><a href="#h39-0-36" id="h39-0-36" class="i">+    }
</a><a href="#h39-0-37" id="h39-0-37" class="i">+
</a><a href="#h39-0-38" id="h39-0-38" class="i">+    let mut i = 0;
</a><a href="#h39-0-39" id="h39-0-39" class="i">+    while i &lt; size {
</a><a href="#h39-0-40" id="h39-0-40" class="i">+        let mut found = true;
</a><a href="#h39-0-41" id="h39-0-41" class="i">+        let mut j = 0;
</a><a href="#h39-0-42" id="h39-0-42" class="i">+
</a><a href="#h39-0-43" id="h39-0-43" class="i">+        while j &lt; bytes.len() {
</a><a href="#h39-0-44" id="h39-0-44" class="i">+            if mask[j] == &#39;?&#39; || bytes[j] == unsafe { *(module_base as *const u8).offset(i as isize + j as isize) } {
</a><a href="#h39-0-45" id="h39-0-45" class="i">+                j += 1;
</a><a href="#h39-0-46" id="h39-0-46" class="i">+                continue;
</a><a href="#h39-0-47" id="h39-0-47" class="i">+            }
</a><a href="#h39-0-48" id="h39-0-48" class="i">+            found = false;
</a><a href="#h39-0-49" id="h39-0-49" class="i">+            break;
</a><a href="#h39-0-50" id="h39-0-50" class="i">+        }
</a><a href="#h39-0-51" id="h39-0-51" class="i">+        if found {
</a><a href="#h39-0-52" id="h39-0-52" class="i">+            if once {
</a><a href="#h39-0-53" id="h39-0-53" class="i">+                SIGNATURE_CACHE.lock().unwrap().push((pattern.to_string(), vec![i]));
</a><a href="#h39-0-54" id="h39-0-54" class="i">+                return vec![module_base + i];
</a><a href="#h39-0-55" id="h39-0-55" class="i">+            }
</a><a href="#h39-0-56" id="h39-0-56" class="i">+            results.push(module_base + i);
</a><a href="#h39-0-57" id="h39-0-57" class="i">+        }
</a><a href="#h39-0-58" id="h39-0-58" class="i">+        i += 1;
</a><a href="#h39-0-59" id="h39-0-59" class="i">+    }
</a><a href="#h39-0-60" id="h39-0-60" class="i">+
</a><a href="#h39-0-61" id="h39-0-61" class="i">+    SIGNATURE_CACHE.lock().unwrap().push((pattern.to_string(), results.clone()));
</a><a href="#h39-0-62" id="h39-0-62" class="i">+    results
</a><a href="#h39-0-63" id="h39-0-63" class="i">+}
</a><a href="#h39-0-64" id="h39-0-64" class="i">+
</a><a href="#h39-0-65" id="h39-0-65" class="i">+pub fn find_signature_executable(mapped_lib: &amp;MappedLib, pattern: &amp;str) -&gt; Option&lt;usize&gt; {
</a><a href="#h39-0-66" id="h39-0-66" class="i">+    let executable_regions = mapped_lib.regions.iter().filter(|region| {
</a><a href="#h39-0-67" id="h39-0-67" class="i">+        region.perms.contains(MMPermissions::EXECUTE) &amp;&amp; region.perms.contains(MMPermissions::READ)
</a><a href="#h39-0-68" id="h39-0-68" class="i">+    }).collect::&lt;Vec&lt;_&gt;&gt;();
</a><a href="#h39-0-69" id="h39-0-69" class="i">+
</a><a href="#h39-0-70" id="h39-0-70" class="i">+    for region in executable_regions {
</a><a href="#h39-0-71" id="h39-0-71" class="i">+        let size = (region.end - region.start) as usize;
</a><a href="#h39-0-72" id="h39-0-72" class="i">+        let module_base = region.start as usize;
</a><a href="#h39-0-73" id="h39-0-73" class="i">+
</a><a href="#h39-0-74" id="h39-0-74" class="i">+        if size &gt; 0 {
</a><a href="#h39-0-75" id="h39-0-75" class="i">+            let results = find_signatures(module_base, size, pattern, true);
</a><a href="#h39-0-76" id="h39-0-76" class="i">+
</a><a href="#h39-0-77" id="h39-0-77" class="i">+            if results.is_empty() {
</a><a href="#h39-0-78" id="h39-0-78" class="i">+                warn!(&quot;Signature not found in region: {:#x} - {:#x}&quot;, region.start, region.end);
</a><a href="#h39-0-79" id="h39-0-79" class="i">+            } else {
</a><a href="#h39-0-80" id="h39-0-80" class="i">+                debug!(&quot;Found {} results in region: {:#x} - {:#x}&quot;, results.len(), region.start, region.end);
</a><a href="#h39-0-81" id="h39-0-81" class="i">+                return Some(results[0]);
</a><a href="#h39-0-82" id="h39-0-82" class="i">+            }
</a><a href="#h39-0-83" id="h39-0-83" class="i">+        }
</a><a href="#h39-0-84" id="h39-0-84" class="i">+    }
</a><a href="#h39-0-85" id="h39-0-85" class="i">+
</a><a href="#h39-0-86" id="h39-0-86" class="i">+    None
</a><a href="#h39-0-87" id="h39-0-87" class="i">+}
</a><a href="#h39-0-88" id="h39-0-88" class="i">+
</a><a href="#h39-0-89" id="h39-0-89" class="i">+pub fn find_signature(mapped_lib: &amp;MappedLib, _arm64_pattern: &amp;str, _arm64_offset: i64, _arm32_pattern: &amp;str, _arm32_offset: i64) -&gt; Option&lt;usize&gt; {
</a><a href="#h39-0-90" id="h39-0-90" class="i">+    #[cfg(target_arch = &quot;aarch64&quot;)]
</a><a href="#h39-0-91" id="h39-0-91" class="i">+    {
</a><a href="#h39-0-92" id="h39-0-92" class="i">+        return find_signature_executable(mapped_lib, _arm64_pattern).map(|address| (address as i64 + _arm64_offset) as usize);
</a><a href="#h39-0-93" id="h39-0-93" class="i">+    }
</a><a href="#h39-0-94" id="h39-0-94" class="i">+    #[cfg(target_arch = &quot;arm&quot;)]
</a><a href="#h39-0-95" id="h39-0-95" class="i">+    {
</a><a href="#h39-0-96" id="h39-0-96" class="i">+        return find_signature_executable(mapped_lib, _arm32_pattern).map(|address| (address as i64 + _arm32_offset) as usize);
</a><a href="#h39-0-97" id="h39-0-97" class="i">+    }
</a><a href="#h39-0-98" id="h39-0-98" class="i">+}</a><a href="#h39-0-99" id="h39-0-99" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h40" href="../file/native/rust/src/util.rs.html">native/rust/src/util.rs</a> b/<a href="../file/native/rust/src/util.rs.html">native/rust/src/util.rs</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -0,0 +1,8 @@
</a><a href="#h40-0-0" id="h40-0-0" class="i">+use std::error::Error;
</a><a href="#h40-0-1" id="h40-0-1" class="i">+
</a><a href="#h40-0-2" id="h40-0-2" class="i">+use jni::{objects::JString, JNIEnv};
</a><a href="#h40-0-3" id="h40-0-3" class="i">+
</a><a href="#h40-0-4" id="h40-0-4" class="i">+pub fn get_jni_string(env: &amp;mut JNIEnv, obj: JString) -&gt; Result&lt;String, Box&lt;dyn Error&gt;&gt; {
</a><a href="#h40-0-5" id="h40-0-5" class="i">+    let string = env.get_string(&amp;obj)?;
</a><a href="#h40-0-6" id="h40-0-6" class="i">+    Ok(string.to_str()?.to_string())
</a><a href="#h40-0-7" id="h40-0-7" class="i">+}
</a><b>diff --git a/<a id="h41" href="../file/native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt.html">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt</a> b/<a href="../file/native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt.html">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -5,9 +5,9 @@ import android.util.Log
</a> import kotlin.math.absoluteValue
 import kotlin.random.Random
 
<a href="#h41-0-3" id="h41-0-3" class="d">-@Suppress(&quot;KotlinJniMissingFunction&quot;)
</a> class NativeLib {
     var nativeUnaryCallCallback: (NativeRequestData) -&gt; Unit = {}
<a href="#h41-0-6" id="h41-0-6" class="i">+    var signatureCache: String? = null
</a> 
     companion object {
         var initialized = false
<a href="#h41-1" id="h41-1" class="h">@@ -21,9 +21,7 @@ class NativeLib {
</a>             initialized = true
             callback(this)
             return@runCatching {
<a href="#h41-1-3" id="h41-1-3" class="d">-                if (!init()) {
</a><a href="#h41-1-4" id="h41-1-4" class="d">-                    throw IllegalStateException(&quot;NativeLib init failed. Check logcat for more info&quot;)
</a><a href="#h41-1-5" id="h41-1-5" class="d">-                }
</a><a href="#h41-1-6" id="h41-1-6" class="i">+                signatureCache = init(signatureCache) ?: throw IllegalStateException(&quot;NativeLib init failed. Check logcat for more info&quot;)
</a>             }
         }.onFailure {
             initialized = false
<a href="#h41-2" id="h41-2" class="h">@@ -67,7 +65,7 @@ class NativeLib {
</a>         System.load(generatedPath)
     }
 
<a href="#h41-2-3" id="h41-2-3" class="d">-    private external fun init(): Boolean
</a><a href="#h41-2-4" id="h41-2-4" class="i">+    private external fun init(signatureCache: String?): String?
</a>     private external fun loadConfig(config: NativeConfig)
     private external fun lockDatabase(name: String, callback: Runnable)
     external fun setComposerLoader(code: String)
</pre>
</div>
</body>
</html>
