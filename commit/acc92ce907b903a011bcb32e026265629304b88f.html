<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>refactor: remove theming feature Deprecated after SC v13.7.0.42 - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/acc92ce907b903a011bcb32e026265629304b88f.html">acc92ce907b903a011bcb32e026265629304b88f</a>
<b>parent</b> <a href="../commit/ba848dfd9d3ddd0a7218312639d33a34efee73a7.html">ba848dfd9d3ddd0a7218312639d33a34efee73a7</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Fri,  6 Jun 2025 14:19:51 +0200

refactor: remove theming feature
Deprecated after SC v13.7.0.42

Signed-off-by: rhunk &lt;101876869+rhunk@users.noreply.github.com&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt</a></td><td> | </td><td class="num">7</td><td><span class="i"></span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt</a></td><td> | </td><td class="num">4</td><td><span class="i"></span><span class="d">----</span></td></tr>
<tr><td class="D">D</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt</a></td><td> | </td><td class="num">126</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a></td><td> | </td><td class="num">10</td><td><span class="i">+++</span><span class="d">-------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt</a></td><td> | </td><td class="num">394</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt</a></td><td> | </td><td class="num">278</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt</a></td><td> | </td><td class="num">463</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">common/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">61</td><td><span class="i"></span><span class="d">-------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a></td><td> | </td><td class="num">6</td><td><span class="i"></span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a></td><td> | </td><td class="num">1</td><td><span class="i"></span><span class="d">-</span></td></tr>
<tr><td class="D">D</td><td><a href="#h11">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt</a></td><td> | </td><td class="num">131</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
</table></pre><pre>12 files changed, 6 insertions(+), 1480 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -8,7 +8,6 @@ import me.rhunk.snapenhance.common.bridge.InternalFileHandleType
</a> import me.rhunk.snapenhance.common.bridge.wrapper.LocaleWrapper
 import me.rhunk.snapenhance.common.logger.AbstractLogger
 import me.rhunk.snapenhance.common.util.ktx.toParcelFileDescriptor
<a href="#h0-0-3" id="h0-0-3" class="d">-import me.rhunk.snapenhance.storage.getEnabledThemesContent
</a> import java.io.File
 import java.io.OutputStream
 
<a href="#h0-1" id="h0-1" class="h">@@ -115,12 +114,6 @@ class RemoteFileHandleManager(
</a>                     &quot;composer/${name.substringAfterLast(&quot;/&quot;)}&quot;
                 )
             }
<a href="#h0-1-3" id="h0-1-3" class="d">-            FileHandleScope.THEME -&gt; {
</a><a href="#h0-1-4" id="h0-1-4" class="d">-                return ByteArrayFileHandle(
</a><a href="#h0-1-5" id="h0-1-5" class="d">-                    context,
</a><a href="#h0-1-6" id="h0-1-6" class="d">-                    context.gson.toJson(context.database.getEnabledThemesContent()).toByteArray(Charsets.UTF_8)
</a><a href="#h0-1-7" id="h0-1-7" class="d">-                )
</a><a href="#h0-1-8" id="h0-1-8" class="d">-            }
</a>             else -&gt; return null
         }
     }
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -3,7 +3,6 @@ package me.rhunk.snapenhance.action
</a> import androidx.compose.material.icons.Icons
 import androidx.compose.material.icons.filled.FolderOpen
 import androidx.compose.material.icons.filled.History
<a href="#h1-0-3" id="h1-0-3" class="d">-import androidx.compose.material.icons.filled.Palette
</a> import androidx.compose.material.icons.filled.PersonSearch
 import androidx.compose.ui.graphics.vector.ImageVector
 import me.rhunk.snapenhance.ui.manager.Routes
<a href="#h1-1" id="h1-1" class="h">@@ -22,7 +21,4 @@ enum class EnumQuickActions(
</a>     LOGGER_HISTORY(&quot;logger_history&quot;, Icons.Default.History, {
         loggerHistory.navigateReset()
     }),
<a href="#h1-1-3" id="h1-1-3" class="d">-    THEMING(&quot;theming&quot;, Icons.Default.Palette, {
</a><a href="#h1-1-4" id="h1-1-4" class="d">-        theming.navigateReset()
</a><a href="#h1-1-5" id="h1-1-5" class="d">-    })
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,126 +0,0 @@
</a><a href="#h2-0-0" id="h2-0-0" class="d">-package me.rhunk.snapenhance.storage
</a><a href="#h2-0-1" id="h2-0-1" class="d">-
</a><a href="#h2-0-2" id="h2-0-2" class="d">-import android.content.ContentValues
</a><a href="#h2-0-3" id="h2-0-3" class="d">-import kotlinx.coroutines.asCoroutineDispatcher
</a><a href="#h2-0-4" id="h2-0-4" class="d">-import kotlinx.coroutines.runBlocking
</a><a href="#h2-0-5" id="h2-0-5" class="d">-import me.rhunk.snapenhance.common.data.DatabaseTheme
</a><a href="#h2-0-6" id="h2-0-6" class="d">-import me.rhunk.snapenhance.common.data.DatabaseThemeContent
</a><a href="#h2-0-7" id="h2-0-7" class="d">-import me.rhunk.snapenhance.common.util.ktx.getIntOrNull
</a><a href="#h2-0-8" id="h2-0-8" class="d">-import me.rhunk.snapenhance.common.util.ktx.getStringOrNull
</a><a href="#h2-0-9" id="h2-0-9" class="d">-
</a><a href="#h2-0-10" id="h2-0-10" class="d">-
</a><a href="#h2-0-11" id="h2-0-11" class="d">-fun AppDatabase.getThemeList(): List&lt;DatabaseTheme&gt; {
</a><a href="#h2-0-12" id="h2-0-12" class="d">-    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-13" id="h2-0-13" class="d">-        database.rawQuery(&quot;SELECT * FROM themes ORDER BY id DESC&quot;, null).use { cursor -&gt;
</a><a href="#h2-0-14" id="h2-0-14" class="d">-            val themes = mutableListOf&lt;DatabaseTheme&gt;()
</a><a href="#h2-0-15" id="h2-0-15" class="d">-            while (cursor.moveToNext()) {
</a><a href="#h2-0-16" id="h2-0-16" class="d">-                themes.add(
</a><a href="#h2-0-17" id="h2-0-17" class="d">-                    DatabaseTheme(
</a><a href="#h2-0-18" id="h2-0-18" class="d">-                        id = cursor.getIntOrNull(&quot;id&quot;) ?: continue,
</a><a href="#h2-0-19" id="h2-0-19" class="d">-                        enabled = cursor.getIntOrNull(&quot;enabled&quot;) == 1,
</a><a href="#h2-0-20" id="h2-0-20" class="d">-                        name = cursor.getStringOrNull(&quot;name&quot;) ?: continue,
</a><a href="#h2-0-21" id="h2-0-21" class="d">-                        description = cursor.getStringOrNull(&quot;description&quot;),
</a><a href="#h2-0-22" id="h2-0-22" class="d">-                        version = cursor.getStringOrNull(&quot;version&quot;),
</a><a href="#h2-0-23" id="h2-0-23" class="d">-                        author = cursor.getStringOrNull(&quot;author&quot;),
</a><a href="#h2-0-24" id="h2-0-24" class="d">-                        updateUrl = cursor.getStringOrNull(&quot;updateUrl&quot;)
</a><a href="#h2-0-25" id="h2-0-25" class="d">-                    )
</a><a href="#h2-0-26" id="h2-0-26" class="d">-                )
</a><a href="#h2-0-27" id="h2-0-27" class="d">-            }
</a><a href="#h2-0-28" id="h2-0-28" class="d">-            themes
</a><a href="#h2-0-29" id="h2-0-29" class="d">-        }
</a><a href="#h2-0-30" id="h2-0-30" class="d">-    }
</a><a href="#h2-0-31" id="h2-0-31" class="d">-}
</a><a href="#h2-0-32" id="h2-0-32" class="d">-
</a><a href="#h2-0-33" id="h2-0-33" class="d">-fun AppDatabase.getThemeInfo(id: Int): DatabaseTheme? {
</a><a href="#h2-0-34" id="h2-0-34" class="d">-    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-35" id="h2-0-35" class="d">-        database.rawQuery(&quot;SELECT * FROM themes WHERE id = ?&quot;, arrayOf(id.toString())).use { cursor -&gt;
</a><a href="#h2-0-36" id="h2-0-36" class="d">-            if (!cursor.moveToFirst()) return@use null
</a><a href="#h2-0-37" id="h2-0-37" class="d">-            DatabaseTheme(
</a><a href="#h2-0-38" id="h2-0-38" class="d">-                id = cursor.getIntOrNull(&quot;id&quot;) ?: return@use null,
</a><a href="#h2-0-39" id="h2-0-39" class="d">-                enabled = cursor.getIntOrNull(&quot;enabled&quot;) == 1,
</a><a href="#h2-0-40" id="h2-0-40" class="d">-                name = cursor.getStringOrNull(&quot;name&quot;) ?: return@use null,
</a><a href="#h2-0-41" id="h2-0-41" class="d">-                description = cursor.getStringOrNull(&quot;description&quot;),
</a><a href="#h2-0-42" id="h2-0-42" class="d">-                version = cursor.getStringOrNull(&quot;version&quot;),
</a><a href="#h2-0-43" id="h2-0-43" class="d">-                author = cursor.getStringOrNull(&quot;author&quot;),
</a><a href="#h2-0-44" id="h2-0-44" class="d">-                updateUrl = cursor.getStringOrNull(&quot;updateUrl&quot;)
</a><a href="#h2-0-45" id="h2-0-45" class="d">-            )
</a><a href="#h2-0-46" id="h2-0-46" class="d">-        }
</a><a href="#h2-0-47" id="h2-0-47" class="d">-    }
</a><a href="#h2-0-48" id="h2-0-48" class="d">-}
</a><a href="#h2-0-49" id="h2-0-49" class="d">-
</a><a href="#h2-0-50" id="h2-0-50" class="d">-fun AppDatabase.getThemeIdByUpdateUrl(updateUrl: String): Int? {
</a><a href="#h2-0-51" id="h2-0-51" class="d">-    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-52" id="h2-0-52" class="d">-        database.rawQuery(&quot;SELECT id FROM themes WHERE updateUrl = ?&quot;, arrayOf(updateUrl)).use { cursor -&gt;
</a><a href="#h2-0-53" id="h2-0-53" class="d">-            if (!cursor.moveToFirst()) return@use null
</a><a href="#h2-0-54" id="h2-0-54" class="d">-            cursor.getIntOrNull(&quot;id&quot;)
</a><a href="#h2-0-55" id="h2-0-55" class="d">-        }
</a><a href="#h2-0-56" id="h2-0-56" class="d">-    }
</a><a href="#h2-0-57" id="h2-0-57" class="d">-}
</a><a href="#h2-0-58" id="h2-0-58" class="d">-
</a><a href="#h2-0-59" id="h2-0-59" class="d">-fun AppDatabase.addOrUpdateTheme(theme: DatabaseTheme, themeId: Int? = null): Int {
</a><a href="#h2-0-60" id="h2-0-60" class="d">-    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-61" id="h2-0-61" class="d">-        val contentValues = ContentValues().apply {
</a><a href="#h2-0-62" id="h2-0-62" class="d">-            put(&quot;enabled&quot;, if (theme.enabled) 1 else 0)
</a><a href="#h2-0-63" id="h2-0-63" class="d">-            put(&quot;name&quot;, theme.name)
</a><a href="#h2-0-64" id="h2-0-64" class="d">-            put(&quot;description&quot;, theme.description)
</a><a href="#h2-0-65" id="h2-0-65" class="d">-            put(&quot;version&quot;, theme.version)
</a><a href="#h2-0-66" id="h2-0-66" class="d">-            put(&quot;author&quot;, theme.author)
</a><a href="#h2-0-67" id="h2-0-67" class="d">-            put(&quot;updateUrl&quot;, theme.updateUrl)
</a><a href="#h2-0-68" id="h2-0-68" class="d">-        }
</a><a href="#h2-0-69" id="h2-0-69" class="d">-        if (themeId != null) {
</a><a href="#h2-0-70" id="h2-0-70" class="d">-            database.update(&quot;themes&quot;, contentValues, &quot;id = ?&quot;, arrayOf(themeId.toString()))
</a><a href="#h2-0-71" id="h2-0-71" class="d">-            return@runBlocking themeId
</a><a href="#h2-0-72" id="h2-0-72" class="d">-        }
</a><a href="#h2-0-73" id="h2-0-73" class="d">-        database.insert(&quot;themes&quot;, null, contentValues).toInt()
</a><a href="#h2-0-74" id="h2-0-74" class="d">-    }
</a><a href="#h2-0-75" id="h2-0-75" class="d">-}
</a><a href="#h2-0-76" id="h2-0-76" class="d">-
</a><a href="#h2-0-77" id="h2-0-77" class="d">-fun AppDatabase.setThemeState(id: Int, enabled: Boolean) {
</a><a href="#h2-0-78" id="h2-0-78" class="d">-    runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-79" id="h2-0-79" class="d">-        database.update(&quot;themes&quot;, ContentValues().apply {
</a><a href="#h2-0-80" id="h2-0-80" class="d">-            put(&quot;enabled&quot;, if (enabled) 1 else 0)
</a><a href="#h2-0-81" id="h2-0-81" class="d">-        }, &quot;id = ?&quot;, arrayOf(id.toString()))
</a><a href="#h2-0-82" id="h2-0-82" class="d">-    }
</a><a href="#h2-0-83" id="h2-0-83" class="d">-}
</a><a href="#h2-0-84" id="h2-0-84" class="d">-
</a><a href="#h2-0-85" id="h2-0-85" class="d">-fun AppDatabase.deleteTheme(id: Int) {
</a><a href="#h2-0-86" id="h2-0-86" class="d">-    runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-87" id="h2-0-87" class="d">-        database.delete(&quot;themes&quot;, &quot;id = ?&quot;, arrayOf(id.toString()))
</a><a href="#h2-0-88" id="h2-0-88" class="d">-    }
</a><a href="#h2-0-89" id="h2-0-89" class="d">-}
</a><a href="#h2-0-90" id="h2-0-90" class="d">-
</a><a href="#h2-0-91" id="h2-0-91" class="d">-
</a><a href="#h2-0-92" id="h2-0-92" class="d">-fun AppDatabase.getThemeContent(id: Int): DatabaseThemeContent? {
</a><a href="#h2-0-93" id="h2-0-93" class="d">-    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-94" id="h2-0-94" class="d">-        database.rawQuery(&quot;SELECT content FROM themes WHERE id = ?&quot;, arrayOf(id.toString())).use { cursor -&gt;
</a><a href="#h2-0-95" id="h2-0-95" class="d">-            if (!cursor.moveToFirst()) return@use null
</a><a href="#h2-0-96" id="h2-0-96" class="d">-            runCatching {
</a><a href="#h2-0-97" id="h2-0-97" class="d">-                context.gson.fromJson(cursor.getStringOrNull(&quot;content&quot;), DatabaseThemeContent::class.java)
</a><a href="#h2-0-98" id="h2-0-98" class="d">-            }.getOrNull()
</a><a href="#h2-0-99" id="h2-0-99" class="d">-        }
</a><a href="#h2-0-100" id="h2-0-100" class="d">-    }
</a><a href="#h2-0-101" id="h2-0-101" class="d">-}
</a><a href="#h2-0-102" id="h2-0-102" class="d">-
</a><a href="#h2-0-103" id="h2-0-103" class="d">-
</a><a href="#h2-0-104" id="h2-0-104" class="d">-fun AppDatabase.getEnabledThemesContent(): List&lt;DatabaseThemeContent&gt; {
</a><a href="#h2-0-105" id="h2-0-105" class="d">-    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-106" id="h2-0-106" class="d">-        database.rawQuery(&quot;SELECT content FROM themes WHERE enabled = 1&quot;, null).use { cursor -&gt;
</a><a href="#h2-0-107" id="h2-0-107" class="d">-            val themes = mutableListOf&lt;DatabaseThemeContent&gt;()
</a><a href="#h2-0-108" id="h2-0-108" class="d">-            while (cursor.moveToNext()) {
</a><a href="#h2-0-109" id="h2-0-109" class="d">-                runCatching {
</a><a href="#h2-0-110" id="h2-0-110" class="d">-                    themes.add(context.gson.fromJson(cursor.getStringOrNull(&quot;content&quot;), DatabaseThemeContent::class.java))
</a><a href="#h2-0-111" id="h2-0-111" class="d">-                }
</a><a href="#h2-0-112" id="h2-0-112" class="d">-            }
</a><a href="#h2-0-113" id="h2-0-113" class="d">-            themes
</a><a href="#h2-0-114" id="h2-0-114" class="d">-        }
</a><a href="#h2-0-115" id="h2-0-115" class="d">-    }
</a><a href="#h2-0-116" id="h2-0-116" class="d">-}
</a><a href="#h2-0-117" id="h2-0-117" class="d">-
</a><a href="#h2-0-118" id="h2-0-118" class="d">-
</a><a href="#h2-0-119" id="h2-0-119" class="d">-fun AppDatabase.setThemeContent(id: Int, content: DatabaseThemeContent) {
</a><a href="#h2-0-120" id="h2-0-120" class="d">-    runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h2-0-121" id="h2-0-121" class="d">-        database.update(&quot;themes&quot;, ContentValues().apply {
</a><a href="#h2-0-122" id="h2-0-122" class="d">-            put(&quot;content&quot;, context.gson.toJson(content))
</a><a href="#h2-0-123" id="h2-0-123" class="d">-        }, &quot;id = ?&quot;, arrayOf(id.toString()))
</a><a href="#h2-0-124" id="h2-0-124" class="d">-    }
</a><a href="#h2-0-125" id="h2-0-125" class="d">-}
</a><b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -11,23 +11,21 @@ import androidx.navigation.NavDestination.Companion.hierarchy
</a> import androidx.navigation.NavGraph.Companion.findStartDestination
 import androidx.navigation.NavGraphBuilder
 import me.rhunk.snapenhance.RemoteSideContext
<a href="#h3-0-3" id="h3-0-3" class="d">-import me.rhunk.snapenhance.ui.manager.pages.location.BetterLocationRoot
</a> import me.rhunk.snapenhance.ui.manager.pages.FileImportsRoot
 import me.rhunk.snapenhance.ui.manager.pages.LoggerHistoryRoot
<a href="#h3-0-6" id="h3-0-6" class="i">+import me.rhunk.snapenhance.ui.manager.pages.ManageReposSection
</a> import me.rhunk.snapenhance.ui.manager.pages.TasksRootSection
 import me.rhunk.snapenhance.ui.manager.pages.features.FeaturesRootSection
<a href="#h3-0-9" id="h3-0-9" class="i">+import me.rhunk.snapenhance.ui.manager.pages.features.ManageRuleFeature
</a> import me.rhunk.snapenhance.ui.manager.pages.home.HomeLogs
 import me.rhunk.snapenhance.ui.manager.pages.home.HomeRootSection
 import me.rhunk.snapenhance.ui.manager.pages.home.HomeSettings
<a href="#h3-0-13" id="h3-0-13" class="i">+import me.rhunk.snapenhance.ui.manager.pages.location.BetterLocationRoot
</a> import me.rhunk.snapenhance.ui.manager.pages.scripting.ScriptingRootSection
 import me.rhunk.snapenhance.ui.manager.pages.social.LoggedStories
 import me.rhunk.snapenhance.ui.manager.pages.social.ManageScope
 import me.rhunk.snapenhance.ui.manager.pages.social.MessagingPreview
 import me.rhunk.snapenhance.ui.manager.pages.social.SocialRootSection
<a href="#h3-0-19" id="h3-0-19" class="d">-import me.rhunk.snapenhance.ui.manager.pages.theming.EditThemeSection
</a><a href="#h3-0-20" id="h3-0-20" class="d">-import me.rhunk.snapenhance.ui.manager.pages.ManageReposSection
</a><a href="#h3-0-21" id="h3-0-21" class="d">-import me.rhunk.snapenhance.ui.manager.pages.features.ManageRuleFeature
</a><a href="#h3-0-22" id="h3-0-22" class="d">-import me.rhunk.snapenhance.ui.manager.pages.theming.ThemingRoot
</a> import me.rhunk.snapenhance.ui.manager.pages.tracker.EditRule
 import me.rhunk.snapenhance.ui.manager.pages.tracker.FriendTrackerManagerRoot
 
<a href="#h3-1" id="h3-1" class="h">@@ -63,8 +61,6 @@ class Routes(
</a>     val editRule = route(RouteInfo(&quot;edit_rule/?rule_id={rule_id}&quot;), EditRule())
 
     val fileImports = route(RouteInfo(&quot;file_imports&quot;), FileImportsRoot()).parent(home)
<a href="#h3-1-3" id="h3-1-3" class="d">-    val theming = route(RouteInfo(&quot;theming&quot;), ThemingRoot()).parent(home)
</a><a href="#h3-1-4" id="h3-1-4" class="d">-    val editTheme = route(RouteInfo(&quot;edit_theme/?theme_id={theme_id}&quot;), EditThemeSection())
</a>     val manageRepos = route(RouteInfo(&quot;manage_repos&quot;), ManageReposSection())
 
     val social = route(RouteInfo(&quot;social&quot;, icon = Icons.Default.Group, primary = true), SocialRootSection())
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,393 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.pages.theming
</a><a href="#h4-0-1" id="h4-0-1" class="d">-
</a><a href="#h4-0-2" id="h4-0-2" class="d">-import androidx.compose.foundation.ExperimentalFoundationApi
</a><a href="#h4-0-3" id="h4-0-3" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h4-0-4" id="h4-0-4" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h4-0-5" id="h4-0-5" class="d">-import androidx.compose.foundation.lazy.items
</a><a href="#h4-0-6" id="h4-0-6" class="d">-import androidx.compose.foundation.lazy.rememberLazyListState
</a><a href="#h4-0-7" id="h4-0-7" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h4-0-8" id="h4-0-8" class="d">-import androidx.compose.material.icons.filled.*
</a><a href="#h4-0-9" id="h4-0-9" class="d">-import androidx.compose.material3.*
</a><a href="#h4-0-10" id="h4-0-10" class="d">-import androidx.compose.runtime.*
</a><a href="#h4-0-11" id="h4-0-11" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h4-0-12" id="h4-0-12" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h4-0-13" id="h4-0-13" class="d">-import androidx.compose.ui.focus.FocusRequester
</a><a href="#h4-0-14" id="h4-0-14" class="d">-import androidx.compose.ui.focus.focusRequester
</a><a href="#h4-0-15" id="h4-0-15" class="d">-import androidx.compose.ui.graphics.Color
</a><a href="#h4-0-16" id="h4-0-16" class="d">-import androidx.compose.ui.graphics.toArgb
</a><a href="#h4-0-17" id="h4-0-17" class="d">-import androidx.compose.ui.text.font.FontWeight
</a><a href="#h4-0-18" id="h4-0-18" class="d">-import androidx.compose.ui.text.style.TextAlign
</a><a href="#h4-0-19" id="h4-0-19" class="d">-import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h4-0-20" id="h4-0-20" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h4-0-21" id="h4-0-21" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h4-0-22" id="h4-0-22" class="d">-import androidx.navigation.NavBackStackEntry
</a><a href="#h4-0-23" id="h4-0-23" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h4-0-24" id="h4-0-24" class="d">-import kotlinx.coroutines.delay
</a><a href="#h4-0-25" id="h4-0-25" class="d">-import kotlinx.coroutines.launch
</a><a href="#h4-0-26" id="h4-0-26" class="d">-import kotlinx.coroutines.withContext
</a><a href="#h4-0-27" id="h4-0-27" class="d">-import me.rhunk.snapenhance.common.data.*
</a><a href="#h4-0-28" id="h4-0-28" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h4-0-29" id="h4-0-29" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h4-0-30" id="h4-0-30" class="d">-import me.rhunk.snapenhance.common.ui.transparentTextFieldColors
</a><a href="#h4-0-31" id="h4-0-31" class="d">-import me.rhunk.snapenhance.storage.*
</a><a href="#h4-0-32" id="h4-0-32" class="d">-import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h4-0-33" id="h4-0-33" class="d">-import me.rhunk.snapenhance.ui.util.AlertDialogs
</a><a href="#h4-0-34" id="h4-0-34" class="d">-import me.rhunk.snapenhance.ui.util.CircularAlphaTile
</a><a href="#h4-0-35" id="h4-0-35" class="d">-import me.rhunk.snapenhance.ui.util.Dialog
</a><a href="#h4-0-36" id="h4-0-36" class="d">-
</a><a href="#h4-0-37" id="h4-0-37" class="d">-class EditThemeSection: Routes.Route() {
</a><a href="#h4-0-38" id="h4-0-38" class="d">-    private var saveCallback by mutableStateOf&lt;(() -&gt; Unit)?&gt;(null)
</a><a href="#h4-0-39" id="h4-0-39" class="d">-    private var addEntryCallback by mutableStateOf&lt;(key: String, initialColor: Int) -&gt; Unit&gt;({ _, _ -&gt; })
</a><a href="#h4-0-40" id="h4-0-40" class="d">-    private var deleteCallback by mutableStateOf&lt;(() -&gt; Unit)?&gt;(null)
</a><a href="#h4-0-41" id="h4-0-41" class="d">-    private var themeColors = mutableStateListOf&lt;ThemeColorEntry&gt;()
</a><a href="#h4-0-42" id="h4-0-42" class="d">-
</a><a href="#h4-0-43" id="h4-0-43" class="d">-    private val alertDialogs by lazy {
</a><a href="#h4-0-44" id="h4-0-44" class="d">-        AlertDialogs(context.translation)
</a><a href="#h4-0-45" id="h4-0-45" class="d">-    }
</a><a href="#h4-0-46" id="h4-0-46" class="d">-
</a><a href="#h4-0-47" id="h4-0-47" class="d">-    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = {
</a><a href="#h4-0-48" id="h4-0-48" class="d">-        var deleteConfirmationDialog by remember { mutableStateOf(false) }
</a><a href="#h4-0-49" id="h4-0-49" class="d">-
</a><a href="#h4-0-50" id="h4-0-50" class="d">-        if (deleteConfirmationDialog) {
</a><a href="#h4-0-51" id="h4-0-51" class="d">-            Dialog(onDismissRequest = {
</a><a href="#h4-0-52" id="h4-0-52" class="d">-                deleteConfirmationDialog = false
</a><a href="#h4-0-53" id="h4-0-53" class="d">-            }) {
</a><a href="#h4-0-54" id="h4-0-54" class="d">-                alertDialogs.ConfirmDialog(
</a><a href="#h4-0-55" id="h4-0-55" class="d">-                    title = &quot;Delete Theme&quot;,
</a><a href="#h4-0-56" id="h4-0-56" class="d">-                    message = &quot;Are you sure you want to delete this theme?&quot;,
</a><a href="#h4-0-57" id="h4-0-57" class="d">-                    onConfirm = {
</a><a href="#h4-0-58" id="h4-0-58" class="d">-                        deleteCallback?.invoke()
</a><a href="#h4-0-59" id="h4-0-59" class="d">-                        deleteConfirmationDialog = false
</a><a href="#h4-0-60" id="h4-0-60" class="d">-                    },
</a><a href="#h4-0-61" id="h4-0-61" class="d">-                    onDismiss = {
</a><a href="#h4-0-62" id="h4-0-62" class="d">-                        deleteConfirmationDialog = false
</a><a href="#h4-0-63" id="h4-0-63" class="d">-                    }
</a><a href="#h4-0-64" id="h4-0-64" class="d">-                )
</a><a href="#h4-0-65" id="h4-0-65" class="d">-            }
</a><a href="#h4-0-66" id="h4-0-66" class="d">-        }
</a><a href="#h4-0-67" id="h4-0-67" class="d">-
</a><a href="#h4-0-68" id="h4-0-68" class="d">-        deleteCallback?.let {
</a><a href="#h4-0-69" id="h4-0-69" class="d">-            IconButton(onClick = {
</a><a href="#h4-0-70" id="h4-0-70" class="d">-                deleteConfirmationDialog = true
</a><a href="#h4-0-71" id="h4-0-71" class="d">-            }) {
</a><a href="#h4-0-72" id="h4-0-72" class="d">-                Icon(Icons.Default.Delete, contentDescription = null)
</a><a href="#h4-0-73" id="h4-0-73" class="d">-            }
</a><a href="#h4-0-74" id="h4-0-74" class="d">-        }
</a><a href="#h4-0-75" id="h4-0-75" class="d">-    }
</a><a href="#h4-0-76" id="h4-0-76" class="d">-
</a><a href="#h4-0-77" id="h4-0-77" class="d">-    @OptIn(ExperimentalFoundationApi::class)
</a><a href="#h4-0-78" id="h4-0-78" class="d">-    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h4-0-79" id="h4-0-79" class="d">-        Column(
</a><a href="#h4-0-80" id="h4-0-80" class="d">-            horizontalAlignment = Alignment.End,
</a><a href="#h4-0-81" id="h4-0-81" class="d">-            verticalArrangement = Arrangement.spacedBy(5.dp),
</a><a href="#h4-0-82" id="h4-0-82" class="d">-        ) {
</a><a href="#h4-0-83" id="h4-0-83" class="d">-            var addAttributeDialog by remember { mutableStateOf(false) }
</a><a href="#h4-0-84" id="h4-0-84" class="d">-            val attributesTranslation = remember { context.translation.getCategory(&quot;theming_attributes&quot;) }
</a><a href="#h4-0-85" id="h4-0-85" class="d">-
</a><a href="#h4-0-86" id="h4-0-86" class="d">-            if (addAttributeDialog) {
</a><a href="#h4-0-87" id="h4-0-87" class="d">-                AlertDialog(
</a><a href="#h4-0-88" id="h4-0-88" class="d">-                    title = { Text(&quot;Select an attribute to add&quot;) },
</a><a href="#h4-0-89" id="h4-0-89" class="d">-                    onDismissRequest = {
</a><a href="#h4-0-90" id="h4-0-90" class="d">-                        addAttributeDialog = false
</a><a href="#h4-0-91" id="h4-0-91" class="d">-                    },
</a><a href="#h4-0-92" id="h4-0-92" class="d">-                    confirmButton = {},
</a><a href="#h4-0-93" id="h4-0-93" class="d">-                    text = {
</a><a href="#h4-0-94" id="h4-0-94" class="d">-                        var filter by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h4-0-95" id="h4-0-95" class="d">-                        val attributes = rememberAsyncMutableStateList(defaultValue = listOf(), keys = arrayOf(filter)) {
</a><a href="#h4-0-96" id="h4-0-96" class="d">-                            AvailableThemingAttributes[ThemingAttributeType.COLOR]?.filter { key -&gt;
</a><a href="#h4-0-97" id="h4-0-97" class="d">-                                themeColors.none { it.key == key } &amp;&amp; (key.contains(filter, ignoreCase = true) || attributesTranslation.getOrNull(key)?.contains(filter, ignoreCase = true) == true)
</a><a href="#h4-0-98" id="h4-0-98" class="d">-                            } ?: emptyList()
</a><a href="#h4-0-99" id="h4-0-99" class="d">-                        }
</a><a href="#h4-0-100" id="h4-0-100" class="d">-
</a><a href="#h4-0-101" id="h4-0-101" class="d">-                        LazyColumn(
</a><a href="#h4-0-102" id="h4-0-102" class="d">-                            modifier = Modifier
</a><a href="#h4-0-103" id="h4-0-103" class="d">-                                .fillMaxHeight(0.7f)
</a><a href="#h4-0-104" id="h4-0-104" class="d">-                                .fillMaxWidth(),
</a><a href="#h4-0-105" id="h4-0-105" class="d">-                        ) {
</a><a href="#h4-0-106" id="h4-0-106" class="d">-                            stickyHeader {
</a><a href="#h4-0-107" id="h4-0-107" class="d">-                                TextField(
</a><a href="#h4-0-108" id="h4-0-108" class="d">-                                    modifier = Modifier.fillMaxWidth().padding(bottom = 5.dp),
</a><a href="#h4-0-109" id="h4-0-109" class="d">-                                    value = filter,
</a><a href="#h4-0-110" id="h4-0-110" class="d">-                                    onValueChange = { filter = it },
</a><a href="#h4-0-111" id="h4-0-111" class="d">-                                    label = { Text(&quot;Search&quot;) },
</a><a href="#h4-0-112" id="h4-0-112" class="d">-                                    colors = transparentTextFieldColors().copy(
</a><a href="#h4-0-113" id="h4-0-113" class="d">-                                        focusedContainerColor = MaterialTheme.colorScheme.surfaceBright,
</a><a href="#h4-0-114" id="h4-0-114" class="d">-                                        unfocusedContainerColor = MaterialTheme.colorScheme.surfaceBright
</a><a href="#h4-0-115" id="h4-0-115" class="d">-                                    )
</a><a href="#h4-0-116" id="h4-0-116" class="d">-                                )
</a><a href="#h4-0-117" id="h4-0-117" class="d">-                            }
</a><a href="#h4-0-118" id="h4-0-118" class="d">-                            item {
</a><a href="#h4-0-119" id="h4-0-119" class="d">-                                if (attributes.isEmpty()) {
</a><a href="#h4-0-120" id="h4-0-120" class="d">-                                    Text(&quot;No attributes&quot;)
</a><a href="#h4-0-121" id="h4-0-121" class="d">-                                }
</a><a href="#h4-0-122" id="h4-0-122" class="d">-                            }
</a><a href="#h4-0-123" id="h4-0-123" class="d">-                            items(attributes) { attribute -&gt;
</a><a href="#h4-0-124" id="h4-0-124" class="d">-                                Card(
</a><a href="#h4-0-125" id="h4-0-125" class="d">-                                    modifier = Modifier.padding(5.dp).fillMaxWidth(),
</a><a href="#h4-0-126" id="h4-0-126" class="d">-                                    onClick = {
</a><a href="#h4-0-127" id="h4-0-127" class="d">-                                        addEntryCallback(attribute, Color.White.toArgb())
</a><a href="#h4-0-128" id="h4-0-128" class="d">-                                        addAttributeDialog = false
</a><a href="#h4-0-129" id="h4-0-129" class="d">-                                    }
</a><a href="#h4-0-130" id="h4-0-130" class="d">-                                ) {
</a><a href="#h4-0-131" id="h4-0-131" class="d">-                                    val attributeTranslation = remember(attribute) {
</a><a href="#h4-0-132" id="h4-0-132" class="d">-                                        attributesTranslation.getOrNull(attribute)
</a><a href="#h4-0-133" id="h4-0-133" class="d">-                                    }
</a><a href="#h4-0-134" id="h4-0-134" class="d">-
</a><a href="#h4-0-135" id="h4-0-135" class="d">-                                    Column(
</a><a href="#h4-0-136" id="h4-0-136" class="d">-                                        modifier = Modifier.padding(8.dp)
</a><a href="#h4-0-137" id="h4-0-137" class="d">-                                    ) {
</a><a href="#h4-0-138" id="h4-0-138" class="d">-                                        Text(attributeTranslation ?: attribute, lineHeight = 15.sp)
</a><a href="#h4-0-139" id="h4-0-139" class="d">-                                        attributeTranslation?.let {
</a><a href="#h4-0-140" id="h4-0-140" class="d">-                                            Text(attribute, fontWeight = FontWeight.Light, fontSize = 10.sp, lineHeight = 15.sp)
</a><a href="#h4-0-141" id="h4-0-141" class="d">-                                        }
</a><a href="#h4-0-142" id="h4-0-142" class="d">-                                    }
</a><a href="#h4-0-143" id="h4-0-143" class="d">-                                }
</a><a href="#h4-0-144" id="h4-0-144" class="d">-                            }
</a><a href="#h4-0-145" id="h4-0-145" class="d">-                        }
</a><a href="#h4-0-146" id="h4-0-146" class="d">-                    }
</a><a href="#h4-0-147" id="h4-0-147" class="d">-                )
</a><a href="#h4-0-148" id="h4-0-148" class="d">-            }
</a><a href="#h4-0-149" id="h4-0-149" class="d">-
</a><a href="#h4-0-150" id="h4-0-150" class="d">-            FloatingActionButton(onClick = {
</a><a href="#h4-0-151" id="h4-0-151" class="d">-                addAttributeDialog = true
</a><a href="#h4-0-152" id="h4-0-152" class="d">-            }) {
</a><a href="#h4-0-153" id="h4-0-153" class="d">-                Icon(Icons.Default.Add, contentDescription = null)
</a><a href="#h4-0-154" id="h4-0-154" class="d">-            }
</a><a href="#h4-0-155" id="h4-0-155" class="d">-
</a><a href="#h4-0-156" id="h4-0-156" class="d">-            saveCallback?.let {
</a><a href="#h4-0-157" id="h4-0-157" class="d">-                FloatingActionButton(onClick = {
</a><a href="#h4-0-158" id="h4-0-158" class="d">-                    it()
</a><a href="#h4-0-159" id="h4-0-159" class="d">-                }) {
</a><a href="#h4-0-160" id="h4-0-160" class="d">-                    Icon(Icons.Default.Save, contentDescription = null)
</a><a href="#h4-0-161" id="h4-0-161" class="d">-                }
</a><a href="#h4-0-162" id="h4-0-162" class="d">-            }
</a><a href="#h4-0-163" id="h4-0-163" class="d">-        }
</a><a href="#h4-0-164" id="h4-0-164" class="d">-    }
</a><a href="#h4-0-165" id="h4-0-165" class="d">-
</a><a href="#h4-0-166" id="h4-0-166" class="d">-    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h4-0-167" id="h4-0-167" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h4-0-168" id="h4-0-168" class="d">-        val currentThemeId = remember { it.arguments?.getString(&quot;theme_id&quot;)?.toIntOrNull() }
</a><a href="#h4-0-169" id="h4-0-169" class="d">-
</a><a href="#h4-0-170" id="h4-0-170" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h4-0-171" id="h4-0-171" class="d">-            themeColors.clear()
</a><a href="#h4-0-172" id="h4-0-172" class="d">-        }
</a><a href="#h4-0-173" id="h4-0-173" class="d">-
</a><a href="#h4-0-174" id="h4-0-174" class="d">-        var themeName by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h4-0-175" id="h4-0-175" class="d">-        var themeDescription by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h4-0-176" id="h4-0-176" class="d">-        var themeVersion by remember { mutableStateOf(&quot;1.0.0&quot;) }
</a><a href="#h4-0-177" id="h4-0-177" class="d">-        var themeAuthor by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h4-0-178" id="h4-0-178" class="d">-        var themeUpdateUrl by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h4-0-179" id="h4-0-179" class="d">-
</a><a href="#h4-0-180" id="h4-0-180" class="d">-        val themeInfo by rememberAsyncMutableState(defaultValue = null) {
</a><a href="#h4-0-181" id="h4-0-181" class="d">-            currentThemeId?.let { themeId -&gt;
</a><a href="#h4-0-182" id="h4-0-182" class="d">-                context.database.getThemeInfo(themeId)?.also { theme -&gt;
</a><a href="#h4-0-183" id="h4-0-183" class="d">-                    themeName = theme.name
</a><a href="#h4-0-184" id="h4-0-184" class="d">-                    themeDescription = theme.description ?: &quot;&quot;
</a><a href="#h4-0-185" id="h4-0-185" class="d">-                    theme.version?.let { themeVersion = it }
</a><a href="#h4-0-186" id="h4-0-186" class="d">-                    themeAuthor = theme.author ?: &quot;&quot;
</a><a href="#h4-0-187" id="h4-0-187" class="d">-                    themeUpdateUrl = theme.updateUrl ?: &quot;&quot;
</a><a href="#h4-0-188" id="h4-0-188" class="d">-                }
</a><a href="#h4-0-189" id="h4-0-189" class="d">-            }
</a><a href="#h4-0-190" id="h4-0-190" class="d">-        }
</a><a href="#h4-0-191" id="h4-0-191" class="d">-
</a><a href="#h4-0-192" id="h4-0-192" class="d">-        val lazyListState = rememberLazyListState()
</a><a href="#h4-0-193" id="h4-0-193" class="d">-
</a><a href="#h4-0-194" id="h4-0-194" class="d">-        rememberAsyncMutableState(defaultValue = DatabaseThemeContent(), keys = arrayOf(themeInfo)) {
</a><a href="#h4-0-195" id="h4-0-195" class="d">-            currentThemeId?.let {
</a><a href="#h4-0-196" id="h4-0-196" class="d">-                context.database.getThemeContent(it)?.also { content -&gt;
</a><a href="#h4-0-197" id="h4-0-197" class="d">-                    themeColors.clear()
</a><a href="#h4-0-198" id="h4-0-198" class="d">-                    themeColors.addAll(content.colors)
</a><a href="#h4-0-199" id="h4-0-199" class="d">-                    withContext(Dispatchers.Main) {
</a><a href="#h4-0-200" id="h4-0-200" class="d">-                        lazyListState.scrollToItem(themeColors.size)
</a><a href="#h4-0-201" id="h4-0-201" class="d">-                    }
</a><a href="#h4-0-202" id="h4-0-202" class="d">-                }
</a><a href="#h4-0-203" id="h4-0-203" class="d">-            } ?: DatabaseThemeContent()
</a><a href="#h4-0-204" id="h4-0-204" class="d">-        }
</a><a href="#h4-0-205" id="h4-0-205" class="d">-
</a><a href="#h4-0-206" id="h4-0-206" class="d">-        if (themeName.isNotBlank()) {
</a><a href="#h4-0-207" id="h4-0-207" class="d">-            saveCallback = {
</a><a href="#h4-0-208" id="h4-0-208" class="d">-                coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h4-0-209" id="h4-0-209" class="d">-                    val theme = DatabaseTheme(
</a><a href="#h4-0-210" id="h4-0-210" class="d">-                        id = currentThemeId ?: -1,
</a><a href="#h4-0-211" id="h4-0-211" class="d">-                        enabled = themeInfo?.enabled ?: false,
</a><a href="#h4-0-212" id="h4-0-212" class="d">-                        name = themeName,
</a><a href="#h4-0-213" id="h4-0-213" class="d">-                        description = themeDescription,
</a><a href="#h4-0-214" id="h4-0-214" class="d">-                        version = themeVersion,
</a><a href="#h4-0-215" id="h4-0-215" class="d">-                        author = themeAuthor,
</a><a href="#h4-0-216" id="h4-0-216" class="d">-                        updateUrl = themeUpdateUrl
</a><a href="#h4-0-217" id="h4-0-217" class="d">-                    )
</a><a href="#h4-0-218" id="h4-0-218" class="d">-                    val themeId = context.database.addOrUpdateTheme(theme, currentThemeId)
</a><a href="#h4-0-219" id="h4-0-219" class="d">-                    context.database.setThemeContent(themeId, DatabaseThemeContent(
</a><a href="#h4-0-220" id="h4-0-220" class="d">-                        colors = themeColors
</a><a href="#h4-0-221" id="h4-0-221" class="d">-                    ))
</a><a href="#h4-0-222" id="h4-0-222" class="d">-                    withContext(Dispatchers.Main) {
</a><a href="#h4-0-223" id="h4-0-223" class="d">-                        routes.theming.navigateReload()
</a><a href="#h4-0-224" id="h4-0-224" class="d">-                    }
</a><a href="#h4-0-225" id="h4-0-225" class="d">-                }
</a><a href="#h4-0-226" id="h4-0-226" class="d">-            }
</a><a href="#h4-0-227" id="h4-0-227" class="d">-        } else {
</a><a href="#h4-0-228" id="h4-0-228" class="d">-            saveCallback = null
</a><a href="#h4-0-229" id="h4-0-229" class="d">-        }
</a><a href="#h4-0-230" id="h4-0-230" class="d">-
</a><a href="#h4-0-231" id="h4-0-231" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h4-0-232" id="h4-0-232" class="d">-            deleteCallback = null
</a><a href="#h4-0-233" id="h4-0-233" class="d">-            if (currentThemeId != null) {
</a><a href="#h4-0-234" id="h4-0-234" class="d">-                deleteCallback = {
</a><a href="#h4-0-235" id="h4-0-235" class="d">-                    coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h4-0-236" id="h4-0-236" class="d">-                        context.database.deleteTheme(currentThemeId)
</a><a href="#h4-0-237" id="h4-0-237" class="d">-                        withContext(Dispatchers.Main) {
</a><a href="#h4-0-238" id="h4-0-238" class="d">-                            routes.theming.navigateReload()
</a><a href="#h4-0-239" id="h4-0-239" class="d">-                        }
</a><a href="#h4-0-240" id="h4-0-240" class="d">-                    }
</a><a href="#h4-0-241" id="h4-0-241" class="d">-                }
</a><a href="#h4-0-242" id="h4-0-242" class="d">-            }
</a><a href="#h4-0-243" id="h4-0-243" class="d">-            addEntryCallback = { key, initialColor -&gt;
</a><a href="#h4-0-244" id="h4-0-244" class="d">-                coroutineScope.launch(Dispatchers.Main) {
</a><a href="#h4-0-245" id="h4-0-245" class="d">-                    themeColors.add(ThemeColorEntry(key, initialColor))
</a><a href="#h4-0-246" id="h4-0-246" class="d">-                    delay(100)
</a><a href="#h4-0-247" id="h4-0-247" class="d">-                    lazyListState.scrollToItem(themeColors.size)
</a><a href="#h4-0-248" id="h4-0-248" class="d">-                }
</a><a href="#h4-0-249" id="h4-0-249" class="d">-            }
</a><a href="#h4-0-250" id="h4-0-250" class="d">-        }
</a><a href="#h4-0-251" id="h4-0-251" class="d">-
</a><a href="#h4-0-252" id="h4-0-252" class="d">-        var moreOptionsExpanded by remember { mutableStateOf(false) }
</a><a href="#h4-0-253" id="h4-0-253" class="d">-
</a><a href="#h4-0-254" id="h4-0-254" class="d">-        Column(
</a><a href="#h4-0-255" id="h4-0-255" class="d">-            modifier = Modifier.fillMaxSize(),
</a><a href="#h4-0-256" id="h4-0-256" class="d">-            verticalArrangement = Arrangement.spacedBy(8.dp)
</a><a href="#h4-0-257" id="h4-0-257" class="d">-        ) {
</a><a href="#h4-0-258" id="h4-0-258" class="d">-            Row(
</a><a href="#h4-0-259" id="h4-0-259" class="d">-                verticalAlignment = Alignment.CenterVertically,
</a><a href="#h4-0-260" id="h4-0-260" class="d">-            ) {
</a><a href="#h4-0-261" id="h4-0-261" class="d">-                val focusRequester = remember { FocusRequester() }
</a><a href="#h4-0-262" id="h4-0-262" class="d">-
</a><a href="#h4-0-263" id="h4-0-263" class="d">-                TextField(
</a><a href="#h4-0-264" id="h4-0-264" class="d">-                    modifier = Modifier.weight(1f).focusRequester(focusRequester),
</a><a href="#h4-0-265" id="h4-0-265" class="d">-                    value = themeName,
</a><a href="#h4-0-266" id="h4-0-266" class="d">-                    onValueChange = { themeName = it },
</a><a href="#h4-0-267" id="h4-0-267" class="d">-                    label = { Text(&quot;Theme Name&quot;) },
</a><a href="#h4-0-268" id="h4-0-268" class="d">-                    colors = transparentTextFieldColors(),
</a><a href="#h4-0-269" id="h4-0-269" class="d">-                    singleLine = true,
</a><a href="#h4-0-270" id="h4-0-270" class="d">-                )
</a><a href="#h4-0-271" id="h4-0-271" class="d">-                LaunchedEffect(Unit) {
</a><a href="#h4-0-272" id="h4-0-272" class="d">-                    if (currentThemeId == null) {
</a><a href="#h4-0-273" id="h4-0-273" class="d">-                        delay(200)
</a><a href="#h4-0-274" id="h4-0-274" class="d">-                        focusRequester.requestFocus()
</a><a href="#h4-0-275" id="h4-0-275" class="d">-                    }
</a><a href="#h4-0-276" id="h4-0-276" class="d">-                }
</a><a href="#h4-0-277" id="h4-0-277" class="d">-                IconButton(
</a><a href="#h4-0-278" id="h4-0-278" class="d">-                    modifier = Modifier.padding(4.dp),
</a><a href="#h4-0-279" id="h4-0-279" class="d">-                    onClick = {
</a><a href="#h4-0-280" id="h4-0-280" class="d">-                        moreOptionsExpanded = !moreOptionsExpanded
</a><a href="#h4-0-281" id="h4-0-281" class="d">-                    }
</a><a href="#h4-0-282" id="h4-0-282" class="d">-                ) {
</a><a href="#h4-0-283" id="h4-0-283" class="d">-                    Icon(if (moreOptionsExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown, contentDescription = null)
</a><a href="#h4-0-284" id="h4-0-284" class="d">-                }
</a><a href="#h4-0-285" id="h4-0-285" class="d">-            }
</a><a href="#h4-0-286" id="h4-0-286" class="d">-
</a><a href="#h4-0-287" id="h4-0-287" class="d">-            if (moreOptionsExpanded) {
</a><a href="#h4-0-288" id="h4-0-288" class="d">-                TextField(
</a><a href="#h4-0-289" id="h4-0-289" class="d">-                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h4-0-290" id="h4-0-290" class="d">-                    maxLines = 3,
</a><a href="#h4-0-291" id="h4-0-291" class="d">-                    value = themeDescription,
</a><a href="#h4-0-292" id="h4-0-292" class="d">-                    onValueChange = { themeDescription = it },
</a><a href="#h4-0-293" id="h4-0-293" class="d">-                    label = { Text(&quot;Description&quot;) },
</a><a href="#h4-0-294" id="h4-0-294" class="d">-                    colors = transparentTextFieldColors()
</a><a href="#h4-0-295" id="h4-0-295" class="d">-                )
</a><a href="#h4-0-296" id="h4-0-296" class="d">-                TextField(
</a><a href="#h4-0-297" id="h4-0-297" class="d">-                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h4-0-298" id="h4-0-298" class="d">-                    singleLine = true,
</a><a href="#h4-0-299" id="h4-0-299" class="d">-                    value = themeVersion,
</a><a href="#h4-0-300" id="h4-0-300" class="d">-                    onValueChange = { themeVersion = it },
</a><a href="#h4-0-301" id="h4-0-301" class="d">-                    label = { Text(&quot;Version&quot;) },
</a><a href="#h4-0-302" id="h4-0-302" class="d">-                    colors = transparentTextFieldColors()
</a><a href="#h4-0-303" id="h4-0-303" class="d">-                )
</a><a href="#h4-0-304" id="h4-0-304" class="d">-                TextField(
</a><a href="#h4-0-305" id="h4-0-305" class="d">-                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h4-0-306" id="h4-0-306" class="d">-                    singleLine = true,
</a><a href="#h4-0-307" id="h4-0-307" class="d">-                    value = themeAuthor,
</a><a href="#h4-0-308" id="h4-0-308" class="d">-                    onValueChange = { themeAuthor = it },
</a><a href="#h4-0-309" id="h4-0-309" class="d">-                    label = { Text(&quot;Author&quot;) },
</a><a href="#h4-0-310" id="h4-0-310" class="d">-                    colors = transparentTextFieldColors()
</a><a href="#h4-0-311" id="h4-0-311" class="d">-                )
</a><a href="#h4-0-312" id="h4-0-312" class="d">-                TextField(
</a><a href="#h4-0-313" id="h4-0-313" class="d">-                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h4-0-314" id="h4-0-314" class="d">-                    singleLine = true,
</a><a href="#h4-0-315" id="h4-0-315" class="d">-                    value = themeUpdateUrl,
</a><a href="#h4-0-316" id="h4-0-316" class="d">-                    onValueChange = { themeUpdateUrl = it },
</a><a href="#h4-0-317" id="h4-0-317" class="d">-                    label = { Text(&quot;Update URL&quot;) },
</a><a href="#h4-0-318" id="h4-0-318" class="d">-                    colors = transparentTextFieldColors()
</a><a href="#h4-0-319" id="h4-0-319" class="d">-                )
</a><a href="#h4-0-320" id="h4-0-320" class="d">-            }
</a><a href="#h4-0-321" id="h4-0-321" class="d">-
</a><a href="#h4-0-322" id="h4-0-322" class="d">-            LazyColumn(
</a><a href="#h4-0-323" id="h4-0-323" class="d">-                modifier = Modifier.fillMaxWidth(),
</a><a href="#h4-0-324" id="h4-0-324" class="d">-                state = lazyListState,
</a><a href="#h4-0-325" id="h4-0-325" class="d">-                contentPadding = PaddingValues(10.dp),
</a><a href="#h4-0-326" id="h4-0-326" class="d">-                verticalArrangement = Arrangement.spacedBy(4.dp),
</a><a href="#h4-0-327" id="h4-0-327" class="d">-                reverseLayout = true,
</a><a href="#h4-0-328" id="h4-0-328" class="d">-            ) {
</a><a href="#h4-0-329" id="h4-0-329" class="d">-                item {
</a><a href="#h4-0-330" id="h4-0-330" class="d">-                    Spacer(modifier = Modifier.height(150.dp))
</a><a href="#h4-0-331" id="h4-0-331" class="d">-                }
</a><a href="#h4-0-332" id="h4-0-332" class="d">-                items(themeColors) { colorEntry -&gt;
</a><a href="#h4-0-333" id="h4-0-333" class="d">-                    var showEditColorDialog by remember { mutableStateOf(false) }
</a><a href="#h4-0-334" id="h4-0-334" class="d">-                    var currentColor by remember { mutableIntStateOf(colorEntry.value) }
</a><a href="#h4-0-335" id="h4-0-335" class="d">-
</a><a href="#h4-0-336" id="h4-0-336" class="d">-                    ElevatedCard(
</a><a href="#h4-0-337" id="h4-0-337" class="d">-                        modifier = Modifier
</a><a href="#h4-0-338" id="h4-0-338" class="d">-                            .fillMaxWidth(),
</a><a href="#h4-0-339" id="h4-0-339" class="d">-                        onClick = {
</a><a href="#h4-0-340" id="h4-0-340" class="d">-                            showEditColorDialog = true
</a><a href="#h4-0-341" id="h4-0-341" class="d">-                        }
</a><a href="#h4-0-342" id="h4-0-342" class="d">-                    ) {
</a><a href="#h4-0-343" id="h4-0-343" class="d">-                        Row(
</a><a href="#h4-0-344" id="h4-0-344" class="d">-                            modifier = Modifier
</a><a href="#h4-0-345" id="h4-0-345" class="d">-                                .padding(4.dp)
</a><a href="#h4-0-346" id="h4-0-346" class="d">-                                .fillMaxWidth(),
</a><a href="#h4-0-347" id="h4-0-347" class="d">-                            verticalAlignment = Alignment.CenterVertically
</a><a href="#h4-0-348" id="h4-0-348" class="d">-                        ) {
</a><a href="#h4-0-349" id="h4-0-349" class="d">-                            Icon(Icons.Default.Colorize, contentDescription = null, modifier = Modifier.padding(8.dp))
</a><a href="#h4-0-350" id="h4-0-350" class="d">-                            Column(
</a><a href="#h4-0-351" id="h4-0-351" class="d">-                                modifier = Modifier.weight(1f)
</a><a href="#h4-0-352" id="h4-0-352" class="d">-                            ) {
</a><a href="#h4-0-353" id="h4-0-353" class="d">-                                val translation = remember(colorEntry.key) { context.translation.getOrNull(&quot;theming_attributes.${colorEntry.key}&quot;) }
</a><a href="#h4-0-354" id="h4-0-354" class="d">-                                Text(text = translation ?: colorEntry.key, overflow = TextOverflow.Ellipsis, maxLines = 1, lineHeight = 15.sp)
</a><a href="#h4-0-355" id="h4-0-355" class="d">-                                translation?.let {
</a><a href="#h4-0-356" id="h4-0-356" class="d">-                                    Text(text = colorEntry.key, fontSize = 10.sp, fontWeight = FontWeight.Light, overflow = TextOverflow.Ellipsis, maxLines = 1, lineHeight = 15.sp)
</a><a href="#h4-0-357" id="h4-0-357" class="d">-                                }
</a><a href="#h4-0-358" id="h4-0-358" class="d">-                            }
</a><a href="#h4-0-359" id="h4-0-359" class="d">-                            CircularAlphaTile(selectedColor = Color(currentColor))
</a><a href="#h4-0-360" id="h4-0-360" class="d">-                        }
</a><a href="#h4-0-361" id="h4-0-361" class="d">-                    }
</a><a href="#h4-0-362" id="h4-0-362" class="d">-
</a><a href="#h4-0-363" id="h4-0-363" class="d">-                    if (showEditColorDialog) {
</a><a href="#h4-0-364" id="h4-0-364" class="d">-                        Dialog(onDismissRequest = { showEditColorDialog = false }) {
</a><a href="#h4-0-365" id="h4-0-365" class="d">-                            alertDialogs.ColorPickerDialog(
</a><a href="#h4-0-366" id="h4-0-366" class="d">-                                initialColor = Color(currentColor),
</a><a href="#h4-0-367" id="h4-0-367" class="d">-                                setProperty = {
</a><a href="#h4-0-368" id="h4-0-368" class="d">-                                    if (it == null) {
</a><a href="#h4-0-369" id="h4-0-369" class="d">-                                        themeColors.remove(colorEntry)
</a><a href="#h4-0-370" id="h4-0-370" class="d">-                                        return@ColorPickerDialog
</a><a href="#h4-0-371" id="h4-0-371" class="d">-                                    }
</a><a href="#h4-0-372" id="h4-0-372" class="d">-                                    currentColor = it.toArgb()
</a><a href="#h4-0-373" id="h4-0-373" class="d">-                                    colorEntry.value = currentColor
</a><a href="#h4-0-374" id="h4-0-374" class="d">-                                },
</a><a href="#h4-0-375" id="h4-0-375" class="d">-                                dismiss = {
</a><a href="#h4-0-376" id="h4-0-376" class="d">-                                    showEditColorDialog = false
</a><a href="#h4-0-377" id="h4-0-377" class="d">-                                }
</a><a href="#h4-0-378" id="h4-0-378" class="d">-                            )
</a><a href="#h4-0-379" id="h4-0-379" class="d">-                        }
</a><a href="#h4-0-380" id="h4-0-380" class="d">-                    }
</a><a href="#h4-0-381" id="h4-0-381" class="d">-                }
</a><a href="#h4-0-382" id="h4-0-382" class="d">-                item {
</a><a href="#h4-0-383" id="h4-0-383" class="d">-                    if (themeColors.isEmpty()) {
</a><a href="#h4-0-384" id="h4-0-384" class="d">-                        Text(&quot;No colors added yet&quot;, modifier = Modifier
</a><a href="#h4-0-385" id="h4-0-385" class="d">-                            .fillMaxWidth()
</a><a href="#h4-0-386" id="h4-0-386" class="d">-                            .padding(8.dp), fontWeight = FontWeight.Light, textAlign = TextAlign.Center)
</a><a href="#h4-0-387" id="h4-0-387" class="d">-                    }
</a><a href="#h4-0-388" id="h4-0-388" class="d">-                }
</a><a href="#h4-0-389" id="h4-0-389" class="d">-            }
</a><a href="#h4-0-390" id="h4-0-390" class="d">-        }
</a><a href="#h4-0-391" id="h4-0-391" class="d">-    }
</a><a href="#h4-0-392" id="h4-0-392" class="d">-}</a><a href="#h4-0-393" id="h4-0-393" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,277 +0,0 @@
</a><a href="#h5-0-0" id="h5-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.pages.theming
</a><a href="#h5-0-1" id="h5-0-1" class="d">-
</a><a href="#h5-0-2" id="h5-0-2" class="d">-import android.net.Uri
</a><a href="#h5-0-3" id="h5-0-3" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h5-0-4" id="h5-0-4" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h5-0-5" id="h5-0-5" class="d">-import androidx.compose.foundation.lazy.items
</a><a href="#h5-0-6" id="h5-0-6" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h5-0-7" id="h5-0-7" class="d">-import androidx.compose.material.icons.filled.Palette
</a><a href="#h5-0-8" id="h5-0-8" class="d">-import androidx.compose.material3.*
</a><a href="#h5-0-9" id="h5-0-9" class="d">-import androidx.compose.runtime.*
</a><a href="#h5-0-10" id="h5-0-10" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h5-0-11" id="h5-0-11" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h5-0-12" id="h5-0-12" class="d">-import androidx.compose.ui.text.font.FontWeight
</a><a href="#h5-0-13" id="h5-0-13" class="d">-import androidx.compose.ui.text.style.TextAlign
</a><a href="#h5-0-14" id="h5-0-14" class="d">-import androidx.compose.ui.text.style.TextDecoration
</a><a href="#h5-0-15" id="h5-0-15" class="d">-import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h5-0-16" id="h5-0-16" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h5-0-17" id="h5-0-17" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h5-0-18" id="h5-0-18" class="d">-import androidx.core.net.toUri
</a><a href="#h5-0-19" id="h5-0-19" class="d">-import kotlinx.coroutines.*
</a><a href="#h5-0-20" id="h5-0-20" class="d">-import me.rhunk.snapenhance.common.data.RepositoryIndex
</a><a href="#h5-0-21" id="h5-0-21" class="d">-import me.rhunk.snapenhance.common.ui.AsyncUpdateDispatcher
</a><a href="#h5-0-22" id="h5-0-22" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h5-0-23" id="h5-0-23" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h5-0-24" id="h5-0-24" class="d">-import me.rhunk.snapenhance.storage.getThemeList
</a><a href="#h5-0-25" id="h5-0-25" class="d">-import me.rhunk.snapenhance.storage.getRepositories
</a><a href="#h5-0-26" id="h5-0-26" class="d">-import me.rhunk.snapenhance.storage.getThemeIdByUpdateUrl
</a><a href="#h5-0-27" id="h5-0-27" class="d">-import me.rhunk.snapenhance.ui.util.pullrefresh.PullRefreshIndicator
</a><a href="#h5-0-28" id="h5-0-28" class="d">-import me.rhunk.snapenhance.ui.util.pullrefresh.pullRefresh
</a><a href="#h5-0-29" id="h5-0-29" class="d">-import me.rhunk.snapenhance.ui.util.pullrefresh.rememberPullRefreshState
</a><a href="#h5-0-30" id="h5-0-30" class="d">-import okhttp3.Request
</a><a href="#h5-0-31" id="h5-0-31" class="d">-
</a><a href="#h5-0-32" id="h5-0-32" class="d">-
</a><a href="#h5-0-33" id="h5-0-33" class="d">-private val cachedRepoIndexes = mutableStateMapOf&lt;String, RepositoryIndex&gt;()
</a><a href="#h5-0-34" id="h5-0-34" class="d">-private val cacheReloadDispatcher = AsyncUpdateDispatcher()
</a><a href="#h5-0-35" id="h5-0-35" class="d">-
</a><a href="#h5-0-36" id="h5-0-36" class="d">-@Composable
</a><a href="#h5-0-37" id="h5-0-37" class="d">-fun ThemeCatalog(root: ThemingRoot) {
</a><a href="#h5-0-38" id="h5-0-38" class="d">-    val context = remember { root.context }
</a><a href="#h5-0-39" id="h5-0-39" class="d">-    val coroutineScope = rememberCoroutineScope { Dispatchers.IO }
</a><a href="#h5-0-40" id="h5-0-40" class="d">-
</a><a href="#h5-0-41" id="h5-0-41" class="d">-    fun fetchRepoIndexes(): Map&lt;String, RepositoryIndex&gt; {
</a><a href="#h5-0-42" id="h5-0-42" class="d">-        val indexes = mutableMapOf&lt;String, RepositoryIndex&gt;()
</a><a href="#h5-0-43" id="h5-0-43" class="d">-
</a><a href="#h5-0-44" id="h5-0-44" class="d">-        context.database.getRepositories().forEach { rootUri -&gt;
</a><a href="#h5-0-45" id="h5-0-45" class="d">-            val indexUri = rootUri.toUri().buildUpon().appendPath(&quot;index.json&quot;).build()
</a><a href="#h5-0-46" id="h5-0-46" class="d">-
</a><a href="#h5-0-47" id="h5-0-47" class="d">-            runCatching {
</a><a href="#h5-0-48" id="h5-0-48" class="d">-                root.okHttpClient.newCall(
</a><a href="#h5-0-49" id="h5-0-49" class="d">-                    Request.Builder().url(indexUri.toString()).build()
</a><a href="#h5-0-50" id="h5-0-50" class="d">-                ).execute().use { response -&gt;
</a><a href="#h5-0-51" id="h5-0-51" class="d">-                    if (!response.isSuccessful) {
</a><a href="#h5-0-52" id="h5-0-52" class="d">-                        context.log.error(&quot;Failed to fetch theme index from $indexUri: ${response.code}&quot;)
</a><a href="#h5-0-53" id="h5-0-53" class="d">-                        context.shortToast(&quot;Failed to fetch index of $indexUri&quot;)
</a><a href="#h5-0-54" id="h5-0-54" class="d">-                        return@forEach
</a><a href="#h5-0-55" id="h5-0-55" class="d">-                    }
</a><a href="#h5-0-56" id="h5-0-56" class="d">-
</a><a href="#h5-0-57" id="h5-0-57" class="d">-                    runCatching {
</a><a href="#h5-0-58" id="h5-0-58" class="d">-                        indexes[rootUri] = context.gson.fromJson(response.body.charStream(), RepositoryIndex::class.java)
</a><a href="#h5-0-59" id="h5-0-59" class="d">-                    }.onFailure {
</a><a href="#h5-0-60" id="h5-0-60" class="d">-                        context.log.error(&quot;Failed to parse theme index from $indexUri&quot;, it)
</a><a href="#h5-0-61" id="h5-0-61" class="d">-                        context.shortToast(&quot;Failed to parse index of $indexUri&quot;)
</a><a href="#h5-0-62" id="h5-0-62" class="d">-                    }
</a><a href="#h5-0-63" id="h5-0-63" class="d">-                }
</a><a href="#h5-0-64" id="h5-0-64" class="d">-            }.onFailure {
</a><a href="#h5-0-65" id="h5-0-65" class="d">-                context.log.error(&quot;Failed to fetch theme index from $indexUri&quot;, it)
</a><a href="#h5-0-66" id="h5-0-66" class="d">-                context.shortToast(&quot;Failed to fetch index of $indexUri&quot;)
</a><a href="#h5-0-67" id="h5-0-67" class="d">-            }
</a><a href="#h5-0-68" id="h5-0-68" class="d">-        }
</a><a href="#h5-0-69" id="h5-0-69" class="d">-
</a><a href="#h5-0-70" id="h5-0-70" class="d">-        return indexes
</a><a href="#h5-0-71" id="h5-0-71" class="d">-    }
</a><a href="#h5-0-72" id="h5-0-72" class="d">-
</a><a href="#h5-0-73" id="h5-0-73" class="d">-    suspend fun installTheme(themeUri: Uri) {
</a><a href="#h5-0-74" id="h5-0-74" class="d">-        root.okHttpClient.newCall(
</a><a href="#h5-0-75" id="h5-0-75" class="d">-            Request.Builder().url(themeUri.toString()).build()
</a><a href="#h5-0-76" id="h5-0-76" class="d">-        ).execute().use { response -&gt;
</a><a href="#h5-0-77" id="h5-0-77" class="d">-            if (!response.isSuccessful) {
</a><a href="#h5-0-78" id="h5-0-78" class="d">-                context.log.error(&quot;Failed to fetch theme from $themeUri: ${response.code}&quot;)
</a><a href="#h5-0-79" id="h5-0-79" class="d">-                context.shortToast(&quot;Failed to fetch theme from $themeUri&quot;)
</a><a href="#h5-0-80" id="h5-0-80" class="d">-                return
</a><a href="#h5-0-81" id="h5-0-81" class="d">-            }
</a><a href="#h5-0-82" id="h5-0-82" class="d">-
</a><a href="#h5-0-83" id="h5-0-83" class="d">-            val themeContent = response.body.bytes().toString(Charsets.UTF_8)
</a><a href="#h5-0-84" id="h5-0-84" class="d">-            root.importTheme(themeContent, themeUri.toString())
</a><a href="#h5-0-85" id="h5-0-85" class="d">-        }
</a><a href="#h5-0-86" id="h5-0-86" class="d">-    }
</a><a href="#h5-0-87" id="h5-0-87" class="d">-
</a><a href="#h5-0-88" id="h5-0-88" class="d">-    var isRefreshing by remember { mutableStateOf(false) }
</a><a href="#h5-0-89" id="h5-0-89" class="d">-
</a><a href="#h5-0-90" id="h5-0-90" class="d">-    suspend fun refreshCachedIndexes() {
</a><a href="#h5-0-91" id="h5-0-91" class="d">-        isRefreshing = true
</a><a href="#h5-0-92" id="h5-0-92" class="d">-        coroutineScope {
</a><a href="#h5-0-93" id="h5-0-93" class="d">-            launch(Dispatchers.IO) {
</a><a href="#h5-0-94" id="h5-0-94" class="d">-                fetchRepoIndexes().let {
</a><a href="#h5-0-95" id="h5-0-95" class="d">-                    context.log.verbose(&quot;Fetched ${it.size} theme indexes&quot;)
</a><a href="#h5-0-96" id="h5-0-96" class="d">-                    it.forEach { (t, u) -&gt;
</a><a href="#h5-0-97" id="h5-0-97" class="d">-                        context.log.verbose(&quot;Fetched theme index from $t with ${u.themes.size} themes&quot;)
</a><a href="#h5-0-98" id="h5-0-98" class="d">-                    }
</a><a href="#h5-0-99" id="h5-0-99" class="d">-                    synchronized(cachedRepoIndexes) {
</a><a href="#h5-0-100" id="h5-0-100" class="d">-                        cachedRepoIndexes.clear()
</a><a href="#h5-0-101" id="h5-0-101" class="d">-                        cachedRepoIndexes += it
</a><a href="#h5-0-102" id="h5-0-102" class="d">-                    }
</a><a href="#h5-0-103" id="h5-0-103" class="d">-                    cacheReloadDispatcher.dispatch()
</a><a href="#h5-0-104" id="h5-0-104" class="d">-                    delay(600)
</a><a href="#h5-0-105" id="h5-0-105" class="d">-                    isRefreshing = false
</a><a href="#h5-0-106" id="h5-0-106" class="d">-                }
</a><a href="#h5-0-107" id="h5-0-107" class="d">-            }
</a><a href="#h5-0-108" id="h5-0-108" class="d">-        }
</a><a href="#h5-0-109" id="h5-0-109" class="d">-    }
</a><a href="#h5-0-110" id="h5-0-110" class="d">-
</a><a href="#h5-0-111" id="h5-0-111" class="d">-    val installedThemes = rememberAsyncMutableStateList(defaultValue = listOf(), updateDispatcher = root.localReloadDispatcher, keys = arrayOf(cachedRepoIndexes)) {
</a><a href="#h5-0-112" id="h5-0-112" class="d">-        context.database.getThemeList()
</a><a href="#h5-0-113" id="h5-0-113" class="d">-    }
</a><a href="#h5-0-114" id="h5-0-114" class="d">-
</a><a href="#h5-0-115" id="h5-0-115" class="d">-    val remoteThemes by rememberAsyncMutableState(defaultValue = listOf(), updateDispatcher = cacheReloadDispatcher, keys = arrayOf(root.searchFilter.value)) {
</a><a href="#h5-0-116" id="h5-0-116" class="d">-        cachedRepoIndexes.entries.flatMap {
</a><a href="#h5-0-117" id="h5-0-117" class="d">-            it.value.themes.map { theme -&gt; it.key to theme }
</a><a href="#h5-0-118" id="h5-0-118" class="d">-        }.let {
</a><a href="#h5-0-119" id="h5-0-119" class="d">-            val filter = root.searchFilter.value
</a><a href="#h5-0-120" id="h5-0-120" class="d">-            if (filter.isNotBlank()) {
</a><a href="#h5-0-121" id="h5-0-121" class="d">-                it.filter { (_, theme) -&gt;
</a><a href="#h5-0-122" id="h5-0-122" class="d">-                    theme.name.contains(filter, ignoreCase = true) || theme.description?.contains(filter, ignoreCase = true) == true
</a><a href="#h5-0-123" id="h5-0-123" class="d">-                }
</a><a href="#h5-0-124" id="h5-0-124" class="d">-            } else it
</a><a href="#h5-0-125" id="h5-0-125" class="d">-        }
</a><a href="#h5-0-126" id="h5-0-126" class="d">-    }
</a><a href="#h5-0-127" id="h5-0-127" class="d">-
</a><a href="#h5-0-128" id="h5-0-128" class="d">-    LaunchedEffect(Unit) {
</a><a href="#h5-0-129" id="h5-0-129" class="d">-        if (cachedRepoIndexes.isNotEmpty()) return@LaunchedEffect
</a><a href="#h5-0-130" id="h5-0-130" class="d">-        isRefreshing = true
</a><a href="#h5-0-131" id="h5-0-131" class="d">-        coroutineScope.launch {
</a><a href="#h5-0-132" id="h5-0-132" class="d">-            refreshCachedIndexes()
</a><a href="#h5-0-133" id="h5-0-133" class="d">-        }
</a><a href="#h5-0-134" id="h5-0-134" class="d">-    }
</a><a href="#h5-0-135" id="h5-0-135" class="d">-
</a><a href="#h5-0-136" id="h5-0-136" class="d">-    val pullRefreshState = rememberPullRefreshState(isRefreshing, onRefresh = {
</a><a href="#h5-0-137" id="h5-0-137" class="d">-        coroutineScope.launch {
</a><a href="#h5-0-138" id="h5-0-138" class="d">-            refreshCachedIndexes()
</a><a href="#h5-0-139" id="h5-0-139" class="d">-        }
</a><a href="#h5-0-140" id="h5-0-140" class="d">-    })
</a><a href="#h5-0-141" id="h5-0-141" class="d">-
</a><a href="#h5-0-142" id="h5-0-142" class="d">-    Box(
</a><a href="#h5-0-143" id="h5-0-143" class="d">-        modifier = Modifier.fillMaxSize()
</a><a href="#h5-0-144" id="h5-0-144" class="d">-    ) {
</a><a href="#h5-0-145" id="h5-0-145" class="d">-        LazyColumn(
</a><a href="#h5-0-146" id="h5-0-146" class="d">-            modifier = Modifier
</a><a href="#h5-0-147" id="h5-0-147" class="d">-                .fillMaxSize()
</a><a href="#h5-0-148" id="h5-0-148" class="d">-                .pullRefresh(pullRefreshState),
</a><a href="#h5-0-149" id="h5-0-149" class="d">-            contentPadding = PaddingValues(8.dp),
</a><a href="#h5-0-150" id="h5-0-150" class="d">-            verticalArrangement = Arrangement.spacedBy(8.dp),
</a><a href="#h5-0-151" id="h5-0-151" class="d">-        ) {
</a><a href="#h5-0-152" id="h5-0-152" class="d">-            item {
</a><a href="#h5-0-153" id="h5-0-153" class="d">-                if (remoteThemes.isEmpty()) {
</a><a href="#h5-0-154" id="h5-0-154" class="d">-                    Text(
</a><a href="#h5-0-155" id="h5-0-155" class="d">-                        text = &quot;No themes available&quot;,
</a><a href="#h5-0-156" id="h5-0-156" class="d">-                        modifier = Modifier
</a><a href="#h5-0-157" id="h5-0-157" class="d">-                            .padding(16.dp)
</a><a href="#h5-0-158" id="h5-0-158" class="d">-                            .fillMaxWidth(),
</a><a href="#h5-0-159" id="h5-0-159" class="d">-                        textAlign = TextAlign.Center,
</a><a href="#h5-0-160" id="h5-0-160" class="d">-                        fontSize = 15.sp,
</a><a href="#h5-0-161" id="h5-0-161" class="d">-                        fontWeight = FontWeight.Light
</a><a href="#h5-0-162" id="h5-0-162" class="d">-                    )
</a><a href="#h5-0-163" id="h5-0-163" class="d">-                }
</a><a href="#h5-0-164" id="h5-0-164" class="d">-            }
</a><a href="#h5-0-165" id="h5-0-165" class="d">-            items(remoteThemes, key = { it.first + it.second.hashCode() }) { (_, themeManifest) -&gt;
</a><a href="#h5-0-166" id="h5-0-166" class="d">-                val themeUri = remember {
</a><a href="#h5-0-167" id="h5-0-167" class="d">-                    cachedRepoIndexes.entries.find { it.value.themes.contains(themeManifest) }?.key?.toUri()?.buildUpon()?.appendPath(themeManifest.filepath)?.build()
</a><a href="#h5-0-168" id="h5-0-168" class="d">-                }
</a><a href="#h5-0-169" id="h5-0-169" class="d">-
</a><a href="#h5-0-170" id="h5-0-170" class="d">-                val hasUpdate by rememberAsyncMutableState(defaultValue = false, keys = arrayOf(themeManifest)) {
</a><a href="#h5-0-171" id="h5-0-171" class="d">-                    installedThemes.takeIf { themeUri != null }?.find { it.updateUrl == themeUri.toString() }?.let { installedTheme -&gt;
</a><a href="#h5-0-172" id="h5-0-172" class="d">-                        installedTheme.version != themeManifest.version
</a><a href="#h5-0-173" id="h5-0-173" class="d">-                    } ?: false
</a><a href="#h5-0-174" id="h5-0-174" class="d">-                }
</a><a href="#h5-0-175" id="h5-0-175" class="d">-
</a><a href="#h5-0-176" id="h5-0-176" class="d">-                var isInstalling by rememberAsyncMutableState(defaultValue = false, keys = arrayOf(themeManifest)) {
</a><a href="#h5-0-177" id="h5-0-177" class="d">-                    false
</a><a href="#h5-0-178" id="h5-0-178" class="d">-                }
</a><a href="#h5-0-179" id="h5-0-179" class="d">-
</a><a href="#h5-0-180" id="h5-0-180" class="d">-                var isInstalled by rememberAsyncMutableState(defaultValue = true, keys = arrayOf(themeManifest)) {
</a><a href="#h5-0-181" id="h5-0-181" class="d">-                    context.database.getThemeIdByUpdateUrl(themeUri.toString()) != null
</a><a href="#h5-0-182" id="h5-0-182" class="d">-                }
</a><a href="#h5-0-183" id="h5-0-183" class="d">-
</a><a href="#h5-0-184" id="h5-0-184" class="d">-                ElevatedCard(onClick = {
</a><a href="#h5-0-185" id="h5-0-185" class="d">-                    //TODO: Show theme details
</a><a href="#h5-0-186" id="h5-0-186" class="d">-                }) {
</a><a href="#h5-0-187" id="h5-0-187" class="d">-                    Row(
</a><a href="#h5-0-188" id="h5-0-188" class="d">-                        modifier = Modifier
</a><a href="#h5-0-189" id="h5-0-189" class="d">-                            .fillMaxWidth()
</a><a href="#h5-0-190" id="h5-0-190" class="d">-                            .padding(8.dp),
</a><a href="#h5-0-191" id="h5-0-191" class="d">-                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h5-0-192" id="h5-0-192" class="d">-                    ) {
</a><a href="#h5-0-193" id="h5-0-193" class="d">-                        Icon(Icons.Default.Palette, contentDescription = null, modifier = Modifier.padding(16.dp))
</a><a href="#h5-0-194" id="h5-0-194" class="d">-                        Column(
</a><a href="#h5-0-195" id="h5-0-195" class="d">-                            modifier = Modifier.weight(1f),
</a><a href="#h5-0-196" id="h5-0-196" class="d">-                        ) {
</a><a href="#h5-0-197" id="h5-0-197" class="d">-                            Text(
</a><a href="#h5-0-198" id="h5-0-198" class="d">-                                text = themeManifest.name,
</a><a href="#h5-0-199" id="h5-0-199" class="d">-                                maxLines = 1,
</a><a href="#h5-0-200" id="h5-0-200" class="d">-                                fontSize = 16.sp,
</a><a href="#h5-0-201" id="h5-0-201" class="d">-                                lineHeight = 10.sp,
</a><a href="#h5-0-202" id="h5-0-202" class="d">-                                overflow = TextOverflow.Ellipsis,
</a><a href="#h5-0-203" id="h5-0-203" class="d">-                                fontWeight = FontWeight.Bold,
</a><a href="#h5-0-204" id="h5-0-204" class="d">-                            )
</a><a href="#h5-0-205" id="h5-0-205" class="d">-                            themeManifest.author?.let {
</a><a href="#h5-0-206" id="h5-0-206" class="d">-                                Text(
</a><a href="#h5-0-207" id="h5-0-207" class="d">-                                    text = &quot;by $it&quot;,
</a><a href="#h5-0-208" id="h5-0-208" class="d">-                                    maxLines = 1,
</a><a href="#h5-0-209" id="h5-0-209" class="d">-                                    fontSize = 10.sp,
</a><a href="#h5-0-210" id="h5-0-210" class="d">-                                    lineHeight = 16.sp,
</a><a href="#h5-0-211" id="h5-0-211" class="d">-                                    textDecoration = TextDecoration.Underline,
</a><a href="#h5-0-212" id="h5-0-212" class="d">-                                    fontWeight = FontWeight.Light,
</a><a href="#h5-0-213" id="h5-0-213" class="d">-                                    overflow = TextOverflow.Visible,
</a><a href="#h5-0-214" id="h5-0-214" class="d">-                                )
</a><a href="#h5-0-215" id="h5-0-215" class="d">-                            }
</a><a href="#h5-0-216" id="h5-0-216" class="d">-                            themeManifest.description?.let {
</a><a href="#h5-0-217" id="h5-0-217" class="d">-                                Text(
</a><a href="#h5-0-218" id="h5-0-218" class="d">-                                    text = it,
</a><a href="#h5-0-219" id="h5-0-219" class="d">-                                    fontSize = 12.sp,
</a><a href="#h5-0-220" id="h5-0-220" class="d">-                                    maxLines = 3,
</a><a href="#h5-0-221" id="h5-0-221" class="d">-                                    lineHeight = 16.sp,
</a><a href="#h5-0-222" id="h5-0-222" class="d">-                                    overflow = TextOverflow.Ellipsis,
</a><a href="#h5-0-223" id="h5-0-223" class="d">-                                )
</a><a href="#h5-0-224" id="h5-0-224" class="d">-                            }
</a><a href="#h5-0-225" id="h5-0-225" class="d">-                            if (hasUpdate) {
</a><a href="#h5-0-226" id="h5-0-226" class="d">-                                Text(
</a><a href="#h5-0-227" id="h5-0-227" class="d">-                                    text = &quot;Version ${themeManifest.version} available&quot;,
</a><a href="#h5-0-228" id="h5-0-228" class="d">-                                    fontWeight = FontWeight.Bold
</a><a href="#h5-0-229" id="h5-0-229" class="d">-                                )
</a><a href="#h5-0-230" id="h5-0-230" class="d">-                            }
</a><a href="#h5-0-231" id="h5-0-231" class="d">-                        }
</a><a href="#h5-0-232" id="h5-0-232" class="d">-                        Row(
</a><a href="#h5-0-233" id="h5-0-233" class="d">-                            verticalAlignment = Alignment.CenterVertically
</a><a href="#h5-0-234" id="h5-0-234" class="d">-                        ) {
</a><a href="#h5-0-235" id="h5-0-235" class="d">-                            if (isInstalling) {
</a><a href="#h5-0-236" id="h5-0-236" class="d">-                                CircularProgressIndicator(modifier = Modifier.size(24.dp), strokeWidth = 2.dp)
</a><a href="#h5-0-237" id="h5-0-237" class="d">-                            } else {
</a><a href="#h5-0-238" id="h5-0-238" class="d">-                                Button(
</a><a href="#h5-0-239" id="h5-0-239" class="d">-                                    enabled = !isInstalled || hasUpdate,
</a><a href="#h5-0-240" id="h5-0-240" class="d">-                                    onClick = {
</a><a href="#h5-0-241" id="h5-0-241" class="d">-                                        isInstalling = true
</a><a href="#h5-0-242" id="h5-0-242" class="d">-                                        context.coroutineScope.launch {
</a><a href="#h5-0-243" id="h5-0-243" class="d">-                                            runCatching {
</a><a href="#h5-0-244" id="h5-0-244" class="d">-                                                installTheme(themeUri ?: throw IllegalStateException(&quot;Failed to get theme URI&quot;))
</a><a href="#h5-0-245" id="h5-0-245" class="d">-                                                isInstalled = true
</a><a href="#h5-0-246" id="h5-0-246" class="d">-                                            }.onFailure {
</a><a href="#h5-0-247" id="h5-0-247" class="d">-                                                context.log.error(&quot;Failed to install theme ${themeManifest.name}&quot;, it)
</a><a href="#h5-0-248" id="h5-0-248" class="d">-                                                context.shortToast(&quot;Failed to install theme ${themeManifest.name}. ${it.message}&quot;)
</a><a href="#h5-0-249" id="h5-0-249" class="d">-                                            }
</a><a href="#h5-0-250" id="h5-0-250" class="d">-                                            isInstalling = false
</a><a href="#h5-0-251" id="h5-0-251" class="d">-                                        }
</a><a href="#h5-0-252" id="h5-0-252" class="d">-                                    }
</a><a href="#h5-0-253" id="h5-0-253" class="d">-                                ) {
</a><a href="#h5-0-254" id="h5-0-254" class="d">-                                    if (hasUpdate) {
</a><a href="#h5-0-255" id="h5-0-255" class="d">-                                        Text(&quot;Update&quot;)
</a><a href="#h5-0-256" id="h5-0-256" class="d">-                                    } else {
</a><a href="#h5-0-257" id="h5-0-257" class="d">-                                        Text(if (isInstalled) &quot;Installed&quot; else &quot;Install&quot;)
</a><a href="#h5-0-258" id="h5-0-258" class="d">-                                    }
</a><a href="#h5-0-259" id="h5-0-259" class="d">-                                }
</a><a href="#h5-0-260" id="h5-0-260" class="d">-                            }
</a><a href="#h5-0-261" id="h5-0-261" class="d">-                        }
</a><a href="#h5-0-262" id="h5-0-262" class="d">-                    }
</a><a href="#h5-0-263" id="h5-0-263" class="d">-                }
</a><a href="#h5-0-264" id="h5-0-264" class="d">-            }
</a><a href="#h5-0-265" id="h5-0-265" class="d">-            item {
</a><a href="#h5-0-266" id="h5-0-266" class="d">-                Spacer(modifier = Modifier.height(80.dp))
</a><a href="#h5-0-267" id="h5-0-267" class="d">-            }
</a><a href="#h5-0-268" id="h5-0-268" class="d">-        }
</a><a href="#h5-0-269" id="h5-0-269" class="d">-
</a><a href="#h5-0-270" id="h5-0-270" class="d">-        PullRefreshIndicator(
</a><a href="#h5-0-271" id="h5-0-271" class="d">-            refreshing = isRefreshing,
</a><a href="#h5-0-272" id="h5-0-272" class="d">-            state = pullRefreshState,
</a><a href="#h5-0-273" id="h5-0-273" class="d">-            modifier = Modifier.align(Alignment.TopCenter)
</a><a href="#h5-0-274" id="h5-0-274" class="d">-        )
</a><a href="#h5-0-275" id="h5-0-275" class="d">-    }
</a><a href="#h5-0-276" id="h5-0-276" class="d">-}</a><a href="#h5-0-277" id="h5-0-277" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,462 +0,0 @@
</a><a href="#h6-0-0" id="h6-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.pages.theming
</a><a href="#h6-0-1" id="h6-0-1" class="d">-
</a><a href="#h6-0-2" id="h6-0-2" class="d">-import androidx.compose.foundation.ExperimentalFoundationApi
</a><a href="#h6-0-3" id="h6-0-3" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h6-0-4" id="h6-0-4" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h6-0-5" id="h6-0-5" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h6-0-6" id="h6-0-6" class="d">-import androidx.compose.foundation.lazy.items
</a><a href="#h6-0-7" id="h6-0-7" class="d">-import androidx.compose.foundation.pager.HorizontalPager
</a><a href="#h6-0-8" id="h6-0-8" class="d">-import androidx.compose.foundation.pager.rememberPagerState
</a><a href="#h6-0-9" id="h6-0-9" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h6-0-10" id="h6-0-10" class="d">-import androidx.compose.material.icons.filled.*
</a><a href="#h6-0-11" id="h6-0-11" class="d">-import androidx.compose.material3.*
</a><a href="#h6-0-12" id="h6-0-12" class="d">-import androidx.compose.runtime.*
</a><a href="#h6-0-13" id="h6-0-13" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h6-0-14" id="h6-0-14" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h6-0-15" id="h6-0-15" class="d">-import androidx.compose.ui.focus.FocusRequester
</a><a href="#h6-0-16" id="h6-0-16" class="d">-import androidx.compose.ui.focus.focusRequester
</a><a href="#h6-0-17" id="h6-0-17" class="d">-import androidx.compose.ui.layout.onGloballyPositioned
</a><a href="#h6-0-18" id="h6-0-18" class="d">-import androidx.compose.ui.text.font.FontWeight
</a><a href="#h6-0-19" id="h6-0-19" class="d">-import androidx.compose.ui.text.style.TextAlign
</a><a href="#h6-0-20" id="h6-0-20" class="d">-import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h6-0-21" id="h6-0-21" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h6-0-22" id="h6-0-22" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h6-0-23" id="h6-0-23" class="d">-import androidx.core.net.toUri
</a><a href="#h6-0-24" id="h6-0-24" class="d">-import androidx.navigation.NavBackStackEntry
</a><a href="#h6-0-25" id="h6-0-25" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h6-0-26" id="h6-0-26" class="d">-import kotlinx.coroutines.launch
</a><a href="#h6-0-27" id="h6-0-27" class="d">-import kotlinx.coroutines.withContext
</a><a href="#h6-0-28" id="h6-0-28" class="d">-import me.rhunk.snapenhance.common.data.DatabaseTheme
</a><a href="#h6-0-29" id="h6-0-29" class="d">-import me.rhunk.snapenhance.common.data.DatabaseThemeContent
</a><a href="#h6-0-30" id="h6-0-30" class="d">-import me.rhunk.snapenhance.common.data.ExportedTheme
</a><a href="#h6-0-31" id="h6-0-31" class="d">-import me.rhunk.snapenhance.common.ui.AsyncUpdateDispatcher
</a><a href="#h6-0-32" id="h6-0-32" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h6-0-33" id="h6-0-33" class="d">-import me.rhunk.snapenhance.common.ui.transparentTextFieldColors
</a><a href="#h6-0-34" id="h6-0-34" class="d">-import me.rhunk.snapenhance.common.util.ktx.getUrlFromClipboard
</a><a href="#h6-0-35" id="h6-0-35" class="d">-import me.rhunk.snapenhance.storage.*
</a><a href="#h6-0-36" id="h6-0-36" class="d">-import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h6-0-37" id="h6-0-37" class="d">-import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
</a><a href="#h6-0-38" id="h6-0-38" class="d">-import me.rhunk.snapenhance.ui.util.openFile
</a><a href="#h6-0-39" id="h6-0-39" class="d">-import me.rhunk.snapenhance.ui.util.pagerTabIndicatorOffset
</a><a href="#h6-0-40" id="h6-0-40" class="d">-import me.rhunk.snapenhance.ui.util.saveFile
</a><a href="#h6-0-41" id="h6-0-41" class="d">-import okhttp3.OkHttpClient
</a><a href="#h6-0-42" id="h6-0-42" class="d">-
</a><a href="#h6-0-43" id="h6-0-43" class="d">-class ThemingRoot: Routes.Route() {
</a><a href="#h6-0-44" id="h6-0-44" class="d">-    val localReloadDispatcher = AsyncUpdateDispatcher()
</a><a href="#h6-0-45" id="h6-0-45" class="d">-    private lateinit var activityLauncherHelper: ActivityLauncherHelper
</a><a href="#h6-0-46" id="h6-0-46" class="d">-
</a><a href="#h6-0-47" id="h6-0-47" class="d">-    private var currentPage by mutableIntStateOf(0)
</a><a href="#h6-0-48" id="h6-0-48" class="d">-    val okHttpClient by lazy { OkHttpClient() }
</a><a href="#h6-0-49" id="h6-0-49" class="d">-    val searchFilter = mutableStateOf(&quot;&quot;)
</a><a href="#h6-0-50" id="h6-0-50" class="d">-
</a><a href="#h6-0-51" id="h6-0-51" class="d">-
</a><a href="#h6-0-52" id="h6-0-52" class="d">-    private fun exportTheme(theme: DatabaseTheme) {
</a><a href="#h6-0-53" id="h6-0-53" class="d">-        context.coroutineScope.launch {
</a><a href="#h6-0-54" id="h6-0-54" class="d">-            val exportedTheme = theme.toExportedTheme(context.database.getThemeContent(theme.id) ?: DatabaseThemeContent())
</a><a href="#h6-0-55" id="h6-0-55" class="d">-
</a><a href="#h6-0-56" id="h6-0-56" class="d">-            activityLauncherHelper.saveFile(theme.name.replace(&quot; &quot;, &quot;_&quot;).lowercase() + &quot;.json&quot;) { uri -&gt;
</a><a href="#h6-0-57" id="h6-0-57" class="d">-                runCatching {
</a><a href="#h6-0-58" id="h6-0-58" class="d">-                    context.androidContext.contentResolver.openOutputStream(uri.toUri())?.use { outputStream -&gt;
</a><a href="#h6-0-59" id="h6-0-59" class="d">-                        outputStream.write(context.gson.toJson(exportedTheme).toByteArray())
</a><a href="#h6-0-60" id="h6-0-60" class="d">-                        outputStream.flush()
</a><a href="#h6-0-61" id="h6-0-61" class="d">-                    }
</a><a href="#h6-0-62" id="h6-0-62" class="d">-                    context.shortToast(&quot;Theme exported successfully&quot;)
</a><a href="#h6-0-63" id="h6-0-63" class="d">-                }.onFailure {
</a><a href="#h6-0-64" id="h6-0-64" class="d">-                    context.log.error(&quot;Failed to save theme&quot;, it)
</a><a href="#h6-0-65" id="h6-0-65" class="d">-                    context.longToast(&quot;Failed to export theme! Check logs for more details&quot;)
</a><a href="#h6-0-66" id="h6-0-66" class="d">-                }
</a><a href="#h6-0-67" id="h6-0-67" class="d">-            }
</a><a href="#h6-0-68" id="h6-0-68" class="d">-        }
</a><a href="#h6-0-69" id="h6-0-69" class="d">-    }
</a><a href="#h6-0-70" id="h6-0-70" class="d">-
</a><a href="#h6-0-71" id="h6-0-71" class="d">-    private fun duplicateTheme(theme: DatabaseTheme) {
</a><a href="#h6-0-72" id="h6-0-72" class="d">-        context.coroutineScope.launch {
</a><a href="#h6-0-73" id="h6-0-73" class="d">-            val themeId = context.database.addOrUpdateTheme(theme.copy(
</a><a href="#h6-0-74" id="h6-0-74" class="d">-                updateUrl = null
</a><a href="#h6-0-75" id="h6-0-75" class="d">-            ))
</a><a href="#h6-0-76" id="h6-0-76" class="d">-            context.database.setThemeContent(themeId, context.database.getThemeContent(theme.id) ?: DatabaseThemeContent())
</a><a href="#h6-0-77" id="h6-0-77" class="d">-            context.shortToast(&quot;Theme duplicated successfully&quot;)
</a><a href="#h6-0-78" id="h6-0-78" class="d">-            withContext(Dispatchers.Main) {
</a><a href="#h6-0-79" id="h6-0-79" class="d">-                localReloadDispatcher.dispatch()
</a><a href="#h6-0-80" id="h6-0-80" class="d">-            }
</a><a href="#h6-0-81" id="h6-0-81" class="d">-        }
</a><a href="#h6-0-82" id="h6-0-82" class="d">-    }
</a><a href="#h6-0-83" id="h6-0-83" class="d">-
</a><a href="#h6-0-84" id="h6-0-84" class="d">-    suspend fun importTheme(content: String, updateUrl: String? = null) {
</a><a href="#h6-0-85" id="h6-0-85" class="d">-        val theme = context.gson.fromJson(content, ExportedTheme::class.java)
</a><a href="#h6-0-86" id="h6-0-86" class="d">-        val existingTheme = updateUrl?.let {
</a><a href="#h6-0-87" id="h6-0-87" class="d">-            context.database.getThemeIdByUpdateUrl(it)
</a><a href="#h6-0-88" id="h6-0-88" class="d">-        }?.let {
</a><a href="#h6-0-89" id="h6-0-89" class="d">-            context.database.getThemeInfo(it)
</a><a href="#h6-0-90" id="h6-0-90" class="d">-        }
</a><a href="#h6-0-91" id="h6-0-91" class="d">-        val databaseTheme = theme.toDatabaseTheme(
</a><a href="#h6-0-92" id="h6-0-92" class="d">-            updateUrl = updateUrl,
</a><a href="#h6-0-93" id="h6-0-93" class="d">-            enabled = existingTheme?.enabled ?: false
</a><a href="#h6-0-94" id="h6-0-94" class="d">-        )
</a><a href="#h6-0-95" id="h6-0-95" class="d">-
</a><a href="#h6-0-96" id="h6-0-96" class="d">-        val themeId = context.database.addOrUpdateTheme(
</a><a href="#h6-0-97" id="h6-0-97" class="d">-            themeId = existingTheme?.id,
</a><a href="#h6-0-98" id="h6-0-98" class="d">-            theme = databaseTheme
</a><a href="#h6-0-99" id="h6-0-99" class="d">-        )
</a><a href="#h6-0-100" id="h6-0-100" class="d">-
</a><a href="#h6-0-101" id="h6-0-101" class="d">-        context.database.setThemeContent(themeId, theme.content)
</a><a href="#h6-0-102" id="h6-0-102" class="d">-        context.shortToast(&quot;Theme imported successfully&quot;)
</a><a href="#h6-0-103" id="h6-0-103" class="d">-        withContext(Dispatchers.Main) {
</a><a href="#h6-0-104" id="h6-0-104" class="d">-            localReloadDispatcher.dispatch()
</a><a href="#h6-0-105" id="h6-0-105" class="d">-        }
</a><a href="#h6-0-106" id="h6-0-106" class="d">-    }
</a><a href="#h6-0-107" id="h6-0-107" class="d">-
</a><a href="#h6-0-108" id="h6-0-108" class="d">-    private fun importTheme() {
</a><a href="#h6-0-109" id="h6-0-109" class="d">-        activityLauncherHelper.openFile { uri -&gt;
</a><a href="#h6-0-110" id="h6-0-110" class="d">-            context.coroutineScope.launch {
</a><a href="#h6-0-111" id="h6-0-111" class="d">-                runCatching {
</a><a href="#h6-0-112" id="h6-0-112" class="d">-                    val themeJson = context.androidContext.contentResolver.openInputStream(uri.toUri())?.bufferedReader().use {
</a><a href="#h6-0-113" id="h6-0-113" class="d">-                        it?.readText()
</a><a href="#h6-0-114" id="h6-0-114" class="d">-                    } ?: throw Exception(&quot;Failed to read file&quot;)
</a><a href="#h6-0-115" id="h6-0-115" class="d">-
</a><a href="#h6-0-116" id="h6-0-116" class="d">-                    importTheme(themeJson)
</a><a href="#h6-0-117" id="h6-0-117" class="d">-                }.onFailure {
</a><a href="#h6-0-118" id="h6-0-118" class="d">-                    context.log.error(&quot;Failed to import theme&quot;, it)
</a><a href="#h6-0-119" id="h6-0-119" class="d">-                    context.longToast(&quot;Failed to import theme! Check logs for more details&quot;)
</a><a href="#h6-0-120" id="h6-0-120" class="d">-                }
</a><a href="#h6-0-121" id="h6-0-121" class="d">-            }
</a><a href="#h6-0-122" id="h6-0-122" class="d">-        }
</a><a href="#h6-0-123" id="h6-0-123" class="d">-    }
</a><a href="#h6-0-124" id="h6-0-124" class="d">-
</a><a href="#h6-0-125" id="h6-0-125" class="d">-    private suspend fun importFromURL(url: String) {
</a><a href="#h6-0-126" id="h6-0-126" class="d">-        val result = okHttpClient.newCall(
</a><a href="#h6-0-127" id="h6-0-127" class="d">-            okhttp3.Request.Builder()
</a><a href="#h6-0-128" id="h6-0-128" class="d">-                .url(url)
</a><a href="#h6-0-129" id="h6-0-129" class="d">-                .build()
</a><a href="#h6-0-130" id="h6-0-130" class="d">-        ).execute()
</a><a href="#h6-0-131" id="h6-0-131" class="d">-
</a><a href="#h6-0-132" id="h6-0-132" class="d">-        if (!result.isSuccessful) {
</a><a href="#h6-0-133" id="h6-0-133" class="d">-            throw Exception(&quot;Failed to fetch theme from URL ${result.message}&quot;)
</a><a href="#h6-0-134" id="h6-0-134" class="d">-        }
</a><a href="#h6-0-135" id="h6-0-135" class="d">-
</a><a href="#h6-0-136" id="h6-0-136" class="d">-        importTheme(result.body.string(), url)
</a><a href="#h6-0-137" id="h6-0-137" class="d">-    }
</a><a href="#h6-0-138" id="h6-0-138" class="d">-
</a><a href="#h6-0-139" id="h6-0-139" class="d">-    override val init: () -&gt; Unit = {
</a><a href="#h6-0-140" id="h6-0-140" class="d">-        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h6-0-141" id="h6-0-141" class="d">-    }
</a><a href="#h6-0-142" id="h6-0-142" class="d">-
</a><a href="#h6-0-143" id="h6-0-143" class="d">-    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = {
</a><a href="#h6-0-144" id="h6-0-144" class="d">-        var showSearchBar by remember { mutableStateOf(false) }
</a><a href="#h6-0-145" id="h6-0-145" class="d">-        val focusRequester = remember { FocusRequester() }
</a><a href="#h6-0-146" id="h6-0-146" class="d">-
</a><a href="#h6-0-147" id="h6-0-147" class="d">-        Row(
</a><a href="#h6-0-148" id="h6-0-148" class="d">-            verticalAlignment = Alignment.CenterVertically
</a><a href="#h6-0-149" id="h6-0-149" class="d">-        ) {
</a><a href="#h6-0-150" id="h6-0-150" class="d">-            if (showSearchBar) {
</a><a href="#h6-0-151" id="h6-0-151" class="d">-                OutlinedTextField(
</a><a href="#h6-0-152" id="h6-0-152" class="d">-                    value = searchFilter.value,
</a><a href="#h6-0-153" id="h6-0-153" class="d">-                    onValueChange = { searchFilter.value = it },
</a><a href="#h6-0-154" id="h6-0-154" class="d">-                    placeholder = { Text(&quot;Search&quot;) },
</a><a href="#h6-0-155" id="h6-0-155" class="d">-                    modifier = Modifier
</a><a href="#h6-0-156" id="h6-0-156" class="d">-                        .weight(1f)
</a><a href="#h6-0-157" id="h6-0-157" class="d">-                        .focusRequester(focusRequester)
</a><a href="#h6-0-158" id="h6-0-158" class="d">-                        .onGloballyPositioned {
</a><a href="#h6-0-159" id="h6-0-159" class="d">-                            focusRequester.requestFocus()
</a><a href="#h6-0-160" id="h6-0-160" class="d">-                        },
</a><a href="#h6-0-161" id="h6-0-161" class="d">-                    colors = transparentTextFieldColors()
</a><a href="#h6-0-162" id="h6-0-162" class="d">-                )
</a><a href="#h6-0-163" id="h6-0-163" class="d">-                DisposableEffect(Unit) {
</a><a href="#h6-0-164" id="h6-0-164" class="d">-                    onDispose {
</a><a href="#h6-0-165" id="h6-0-165" class="d">-                        searchFilter.value = &quot;&quot;
</a><a href="#h6-0-166" id="h6-0-166" class="d">-                    }
</a><a href="#h6-0-167" id="h6-0-167" class="d">-                }
</a><a href="#h6-0-168" id="h6-0-168" class="d">-            }
</a><a href="#h6-0-169" id="h6-0-169" class="d">-            IconButton(onClick = {
</a><a href="#h6-0-170" id="h6-0-170" class="d">-                showSearchBar = !showSearchBar
</a><a href="#h6-0-171" id="h6-0-171" class="d">-            }) {
</a><a href="#h6-0-172" id="h6-0-172" class="d">-                Icon(if (showSearchBar) Icons.Default.Close else Icons.Default.Search, contentDescription = null)
</a><a href="#h6-0-173" id="h6-0-173" class="d">-            }
</a><a href="#h6-0-174" id="h6-0-174" class="d">-        }
</a><a href="#h6-0-175" id="h6-0-175" class="d">-    }
</a><a href="#h6-0-176" id="h6-0-176" class="d">-
</a><a href="#h6-0-177" id="h6-0-177" class="d">-    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h6-0-178" id="h6-0-178" class="d">-        var showImportFromUrlDialog by remember { mutableStateOf(false) }
</a><a href="#h6-0-179" id="h6-0-179" class="d">-
</a><a href="#h6-0-180" id="h6-0-180" class="d">-        if (showImportFromUrlDialog) {
</a><a href="#h6-0-181" id="h6-0-181" class="d">-            var url by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h6-0-182" id="h6-0-182" class="d">-            var loading by remember { mutableStateOf(false) }
</a><a href="#h6-0-183" id="h6-0-183" class="d">-
</a><a href="#h6-0-184" id="h6-0-184" class="d">-            AlertDialog(
</a><a href="#h6-0-185" id="h6-0-185" class="d">-                onDismissRequest = { showImportFromUrlDialog = false },
</a><a href="#h6-0-186" id="h6-0-186" class="d">-                title = { Text(&quot;Import theme from URL&quot;) },
</a><a href="#h6-0-187" id="h6-0-187" class="d">-                text = {
</a><a href="#h6-0-188" id="h6-0-188" class="d">-                    val focusRequester = remember { FocusRequester() }
</a><a href="#h6-0-189" id="h6-0-189" class="d">-                    TextField(
</a><a href="#h6-0-190" id="h6-0-190" class="d">-                        value = url,
</a><a href="#h6-0-191" id="h6-0-191" class="d">-                        onValueChange = { url = it },
</a><a href="#h6-0-192" id="h6-0-192" class="d">-                        label = { Text(&quot;URL&quot;) },
</a><a href="#h6-0-193" id="h6-0-193" class="d">-                        modifier = Modifier
</a><a href="#h6-0-194" id="h6-0-194" class="d">-                            .fillMaxWidth()
</a><a href="#h6-0-195" id="h6-0-195" class="d">-                            .focusRequester(focusRequester)
</a><a href="#h6-0-196" id="h6-0-196" class="d">-                            .onGloballyPositioned {
</a><a href="#h6-0-197" id="h6-0-197" class="d">-                                focusRequester.requestFocus()
</a><a href="#h6-0-198" id="h6-0-198" class="d">-                            }
</a><a href="#h6-0-199" id="h6-0-199" class="d">-                    )
</a><a href="#h6-0-200" id="h6-0-200" class="d">-                    LaunchedEffect(Unit) {
</a><a href="#h6-0-201" id="h6-0-201" class="d">-                        context.androidContext.getUrlFromClipboard()?.let {
</a><a href="#h6-0-202" id="h6-0-202" class="d">-                            url = it
</a><a href="#h6-0-203" id="h6-0-203" class="d">-                        }
</a><a href="#h6-0-204" id="h6-0-204" class="d">-                    }
</a><a href="#h6-0-205" id="h6-0-205" class="d">-                },
</a><a href="#h6-0-206" id="h6-0-206" class="d">-                confirmButton = {
</a><a href="#h6-0-207" id="h6-0-207" class="d">-                    Button(
</a><a href="#h6-0-208" id="h6-0-208" class="d">-                        enabled = url.isNotBlank() &amp;&amp; !loading,
</a><a href="#h6-0-209" id="h6-0-209" class="d">-                        onClick = {
</a><a href="#h6-0-210" id="h6-0-210" class="d">-                            loading = true
</a><a href="#h6-0-211" id="h6-0-211" class="d">-                            context.coroutineScope.launch {
</a><a href="#h6-0-212" id="h6-0-212" class="d">-                                runCatching {
</a><a href="#h6-0-213" id="h6-0-213" class="d">-                                    importFromURL(url)
</a><a href="#h6-0-214" id="h6-0-214" class="d">-                                    withContext(Dispatchers.Main) {
</a><a href="#h6-0-215" id="h6-0-215" class="d">-                                        showImportFromUrlDialog = false
</a><a href="#h6-0-216" id="h6-0-216" class="d">-                                    }
</a><a href="#h6-0-217" id="h6-0-217" class="d">-                                }.onFailure {
</a><a href="#h6-0-218" id="h6-0-218" class="d">-                                    context.log.error(&quot;Failed to import theme&quot;, it)
</a><a href="#h6-0-219" id="h6-0-219" class="d">-                                    context.longToast(&quot;Failed to import theme! ${it.message}&quot;)
</a><a href="#h6-0-220" id="h6-0-220" class="d">-                                }
</a><a href="#h6-0-221" id="h6-0-221" class="d">-                                withContext(Dispatchers.Main) {
</a><a href="#h6-0-222" id="h6-0-222" class="d">-                                    loading = false
</a><a href="#h6-0-223" id="h6-0-223" class="d">-                                }
</a><a href="#h6-0-224" id="h6-0-224" class="d">-                            }
</a><a href="#h6-0-225" id="h6-0-225" class="d">-                        },
</a><a href="#h6-0-226" id="h6-0-226" class="d">-                        modifier = Modifier.fillMaxWidth()
</a><a href="#h6-0-227" id="h6-0-227" class="d">-                    ) {
</a><a href="#h6-0-228" id="h6-0-228" class="d">-                        Text(&quot;Import&quot;)
</a><a href="#h6-0-229" id="h6-0-229" class="d">-                    }
</a><a href="#h6-0-230" id="h6-0-230" class="d">-                }
</a><a href="#h6-0-231" id="h6-0-231" class="d">-            )
</a><a href="#h6-0-232" id="h6-0-232" class="d">-        }
</a><a href="#h6-0-233" id="h6-0-233" class="d">-        Column(
</a><a href="#h6-0-234" id="h6-0-234" class="d">-            horizontalAlignment = Alignment.End
</a><a href="#h6-0-235" id="h6-0-235" class="d">-        ) {
</a><a href="#h6-0-236" id="h6-0-236" class="d">-            when (currentPage) {
</a><a href="#h6-0-237" id="h6-0-237" class="d">-                0 -&gt; {
</a><a href="#h6-0-238" id="h6-0-238" class="d">-                    ExtendedFloatingActionButton(
</a><a href="#h6-0-239" id="h6-0-239" class="d">-                        onClick = {
</a><a href="#h6-0-240" id="h6-0-240" class="d">-                            routes.editTheme.navigate()
</a><a href="#h6-0-241" id="h6-0-241" class="d">-                        },
</a><a href="#h6-0-242" id="h6-0-242" class="d">-                        icon = {
</a><a href="#h6-0-243" id="h6-0-243" class="d">-                            Icon(Icons.Default.Add, contentDescription = null)
</a><a href="#h6-0-244" id="h6-0-244" class="d">-                        },
</a><a href="#h6-0-245" id="h6-0-245" class="d">-                        text = {
</a><a href="#h6-0-246" id="h6-0-246" class="d">-                            Text(&quot;New theme&quot;)
</a><a href="#h6-0-247" id="h6-0-247" class="d">-                        }
</a><a href="#h6-0-248" id="h6-0-248" class="d">-                    )
</a><a href="#h6-0-249" id="h6-0-249" class="d">-                    Spacer(modifier = Modifier.height(8.dp))
</a><a href="#h6-0-250" id="h6-0-250" class="d">-                    ExtendedFloatingActionButton(
</a><a href="#h6-0-251" id="h6-0-251" class="d">-                        onClick = {
</a><a href="#h6-0-252" id="h6-0-252" class="d">-                            importTheme()
</a><a href="#h6-0-253" id="h6-0-253" class="d">-                        },
</a><a href="#h6-0-254" id="h6-0-254" class="d">-                        icon = {
</a><a href="#h6-0-255" id="h6-0-255" class="d">-                            Icon(Icons.Default.Upload, contentDescription = null)
</a><a href="#h6-0-256" id="h6-0-256" class="d">-                        },
</a><a href="#h6-0-257" id="h6-0-257" class="d">-                        text = {
</a><a href="#h6-0-258" id="h6-0-258" class="d">-                            Text(&quot;Import from file&quot;)
</a><a href="#h6-0-259" id="h6-0-259" class="d">-                        }
</a><a href="#h6-0-260" id="h6-0-260" class="d">-                    )
</a><a href="#h6-0-261" id="h6-0-261" class="d">-                    Spacer(modifier = Modifier.height(8.dp))
</a><a href="#h6-0-262" id="h6-0-262" class="d">-                    ExtendedFloatingActionButton(
</a><a href="#h6-0-263" id="h6-0-263" class="d">-                        onClick = { showImportFromUrlDialog = true },
</a><a href="#h6-0-264" id="h6-0-264" class="d">-                        icon = {
</a><a href="#h6-0-265" id="h6-0-265" class="d">-                            Icon(Icons.Default.Link, contentDescription = null)
</a><a href="#h6-0-266" id="h6-0-266" class="d">-                        },
</a><a href="#h6-0-267" id="h6-0-267" class="d">-                        text = {
</a><a href="#h6-0-268" id="h6-0-268" class="d">-                            Text(&quot;Import from URL&quot;)
</a><a href="#h6-0-269" id="h6-0-269" class="d">-                        }
</a><a href="#h6-0-270" id="h6-0-270" class="d">-                    )
</a><a href="#h6-0-271" id="h6-0-271" class="d">-                }
</a><a href="#h6-0-272" id="h6-0-272" class="d">-                1 -&gt; {
</a><a href="#h6-0-273" id="h6-0-273" class="d">-                    ExtendedFloatingActionButton(
</a><a href="#h6-0-274" id="h6-0-274" class="d">-                        onClick = {
</a><a href="#h6-0-275" id="h6-0-275" class="d">-                            routes.manageRepos.navigate()
</a><a href="#h6-0-276" id="h6-0-276" class="d">-                        },
</a><a href="#h6-0-277" id="h6-0-277" class="d">-                        icon = {
</a><a href="#h6-0-278" id="h6-0-278" class="d">-                            Icon(Icons.Default.Public, contentDescription = null)
</a><a href="#h6-0-279" id="h6-0-279" class="d">-                        },
</a><a href="#h6-0-280" id="h6-0-280" class="d">-                        text = {
</a><a href="#h6-0-281" id="h6-0-281" class="d">-                            Text(&quot;Manage repositories&quot;)
</a><a href="#h6-0-282" id="h6-0-282" class="d">-                        }
</a><a href="#h6-0-283" id="h6-0-283" class="d">-                    )
</a><a href="#h6-0-284" id="h6-0-284" class="d">-                }
</a><a href="#h6-0-285" id="h6-0-285" class="d">-            }
</a><a href="#h6-0-286" id="h6-0-286" class="d">-        }
</a><a href="#h6-0-287" id="h6-0-287" class="d">-    }
</a><a href="#h6-0-288" id="h6-0-288" class="d">-
</a><a href="#h6-0-289" id="h6-0-289" class="d">-    @Composable
</a><a href="#h6-0-290" id="h6-0-290" class="d">-    private fun InstalledThemes() {
</a><a href="#h6-0-291" id="h6-0-291" class="d">-        val themes = rememberAsyncMutableStateList(defaultValue = listOf(), updateDispatcher = localReloadDispatcher, keys = arrayOf(searchFilter.value)) {
</a><a href="#h6-0-292" id="h6-0-292" class="d">-            context.database.getThemeList().let {
</a><a href="#h6-0-293" id="h6-0-293" class="d">-                val filter = searchFilter.value
</a><a href="#h6-0-294" id="h6-0-294" class="d">-                if (filter.isNotBlank()) {
</a><a href="#h6-0-295" id="h6-0-295" class="d">-                    it.filter { theme -&gt;
</a><a href="#h6-0-296" id="h6-0-296" class="d">-                        theme.name.contains(filter, ignoreCase = true) ||
</a><a href="#h6-0-297" id="h6-0-297" class="d">-                        theme.author?.contains(filter, ignoreCase = true) == true ||
</a><a href="#h6-0-298" id="h6-0-298" class="d">-                        theme.description?.contains(filter, ignoreCase = true) == true
</a><a href="#h6-0-299" id="h6-0-299" class="d">-                    }
</a><a href="#h6-0-300" id="h6-0-300" class="d">-                } else it
</a><a href="#h6-0-301" id="h6-0-301" class="d">-            }
</a><a href="#h6-0-302" id="h6-0-302" class="d">-        }
</a><a href="#h6-0-303" id="h6-0-303" class="d">-
</a><a href="#h6-0-304" id="h6-0-304" class="d">-        LazyColumn(
</a><a href="#h6-0-305" id="h6-0-305" class="d">-            modifier = Modifier
</a><a href="#h6-0-306" id="h6-0-306" class="d">-                .fillMaxSize(),
</a><a href="#h6-0-307" id="h6-0-307" class="d">-            contentPadding = PaddingValues(8.dp),
</a><a href="#h6-0-308" id="h6-0-308" class="d">-            verticalArrangement = Arrangement.spacedBy(8.dp)
</a><a href="#h6-0-309" id="h6-0-309" class="d">-        ) {
</a><a href="#h6-0-310" id="h6-0-310" class="d">-            item {
</a><a href="#h6-0-311" id="h6-0-311" class="d">-                if (themes.isEmpty()) {
</a><a href="#h6-0-312" id="h6-0-312" class="d">-                    Text(
</a><a href="#h6-0-313" id="h6-0-313" class="d">-                        text = translation[&quot;no_themes_hint&quot;],
</a><a href="#h6-0-314" id="h6-0-314" class="d">-                        modifier = Modifier
</a><a href="#h6-0-315" id="h6-0-315" class="d">-                            .padding(16.dp)
</a><a href="#h6-0-316" id="h6-0-316" class="d">-                            .fillMaxWidth(),
</a><a href="#h6-0-317" id="h6-0-317" class="d">-                        textAlign = TextAlign.Center,
</a><a href="#h6-0-318" id="h6-0-318" class="d">-                        fontSize = 15.sp,
</a><a href="#h6-0-319" id="h6-0-319" class="d">-                        fontWeight = FontWeight.Light
</a><a href="#h6-0-320" id="h6-0-320" class="d">-                    )
</a><a href="#h6-0-321" id="h6-0-321" class="d">-                }
</a><a href="#h6-0-322" id="h6-0-322" class="d">-            }
</a><a href="#h6-0-323" id="h6-0-323" class="d">-            items(themes, key = { it.id }) { theme -&gt;
</a><a href="#h6-0-324" id="h6-0-324" class="d">-                var showSettings by remember(theme) { mutableStateOf(false) }
</a><a href="#h6-0-325" id="h6-0-325" class="d">-
</a><a href="#h6-0-326" id="h6-0-326" class="d">-                ElevatedCard(
</a><a href="#h6-0-327" id="h6-0-327" class="d">-                    modifier = Modifier
</a><a href="#h6-0-328" id="h6-0-328" class="d">-                        .fillMaxWidth(),
</a><a href="#h6-0-329" id="h6-0-329" class="d">-                    onClick = {
</a><a href="#h6-0-330" id="h6-0-330" class="d">-                        routes.editTheme.navigate {
</a><a href="#h6-0-331" id="h6-0-331" class="d">-                            this[&quot;theme_id&quot;] = theme.id.toString()
</a><a href="#h6-0-332" id="h6-0-332" class="d">-                        }
</a><a href="#h6-0-333" id="h6-0-333" class="d">-                    }
</a><a href="#h6-0-334" id="h6-0-334" class="d">-                ) {
</a><a href="#h6-0-335" id="h6-0-335" class="d">-                    Row(
</a><a href="#h6-0-336" id="h6-0-336" class="d">-                        modifier = Modifier
</a><a href="#h6-0-337" id="h6-0-337" class="d">-                            .padding(8.dp)
</a><a href="#h6-0-338" id="h6-0-338" class="d">-                            .fillMaxWidth(),
</a><a href="#h6-0-339" id="h6-0-339" class="d">-                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h6-0-340" id="h6-0-340" class="d">-                    ) {
</a><a href="#h6-0-341" id="h6-0-341" class="d">-                        Icon(
</a><a href="#h6-0-342" id="h6-0-342" class="d">-                            Icons.Default.Palette, contentDescription = null, modifier = Modifier.padding(5.dp))
</a><a href="#h6-0-343" id="h6-0-343" class="d">-                        Column(
</a><a href="#h6-0-344" id="h6-0-344" class="d">-                            modifier = Modifier
</a><a href="#h6-0-345" id="h6-0-345" class="d">-                                .weight(1f)
</a><a href="#h6-0-346" id="h6-0-346" class="d">-                                .padding(8.dp),
</a><a href="#h6-0-347" id="h6-0-347" class="d">-                        ) {
</a><a href="#h6-0-348" id="h6-0-348" class="d">-                            Text(text = theme.name, fontWeight = FontWeight.Bold, fontSize = 18.sp, lineHeight = 20.sp)
</a><a href="#h6-0-349" id="h6-0-349" class="d">-                            theme.author?.takeIf { it.isNotBlank() }?.let {
</a><a href="#h6-0-350" id="h6-0-350" class="d">-                                Text(text = &quot;by $it&quot;, lineHeight = 15.sp, fontWeight = FontWeight.Light, fontSize = 12.sp)
</a><a href="#h6-0-351" id="h6-0-351" class="d">-                            }
</a><a href="#h6-0-352" id="h6-0-352" class="d">-                        }
</a><a href="#h6-0-353" id="h6-0-353" class="d">-
</a><a href="#h6-0-354" id="h6-0-354" class="d">-                        Row(
</a><a href="#h6-0-355" id="h6-0-355" class="d">-                            horizontalArrangement = Arrangement.spacedBy(5.dp),
</a><a href="#h6-0-356" id="h6-0-356" class="d">-                        ) {
</a><a href="#h6-0-357" id="h6-0-357" class="d">-                            var state by remember { mutableStateOf(theme.enabled) }
</a><a href="#h6-0-358" id="h6-0-358" class="d">-
</a><a href="#h6-0-359" id="h6-0-359" class="d">-                            IconButton(onClick = {
</a><a href="#h6-0-360" id="h6-0-360" class="d">-                                showSettings = true
</a><a href="#h6-0-361" id="h6-0-361" class="d">-                            }) {
</a><a href="#h6-0-362" id="h6-0-362" class="d">-                                Icon(Icons.Default.Settings, contentDescription = null)
</a><a href="#h6-0-363" id="h6-0-363" class="d">-                            }
</a><a href="#h6-0-364" id="h6-0-364" class="d">-
</a><a href="#h6-0-365" id="h6-0-365" class="d">-                            Switch(checked = state, onCheckedChange = {
</a><a href="#h6-0-366" id="h6-0-366" class="d">-                                state = it
</a><a href="#h6-0-367" id="h6-0-367" class="d">-                                context.database.setThemeState(theme.id, it)
</a><a href="#h6-0-368" id="h6-0-368" class="d">-                            })
</a><a href="#h6-0-369" id="h6-0-369" class="d">-                        }
</a><a href="#h6-0-370" id="h6-0-370" class="d">-                    }
</a><a href="#h6-0-371" id="h6-0-371" class="d">-                }
</a><a href="#h6-0-372" id="h6-0-372" class="d">-
</a><a href="#h6-0-373" id="h6-0-373" class="d">-                if (showSettings) {
</a><a href="#h6-0-374" id="h6-0-374" class="d">-                    val actionsRow = remember {
</a><a href="#h6-0-375" id="h6-0-375" class="d">-                        mapOf(
</a><a href="#h6-0-376" id="h6-0-376" class="d">-                            (&quot;Duplicate&quot; to Icons.Default.ContentCopy) to { duplicateTheme(theme) },
</a><a href="#h6-0-377" id="h6-0-377" class="d">-                            (&quot;Export&quot; to Icons.Default.Download) to { exportTheme(theme) }
</a><a href="#h6-0-378" id="h6-0-378" class="d">-                        )
</a><a href="#h6-0-379" id="h6-0-379" class="d">-                    }
</a><a href="#h6-0-380" id="h6-0-380" class="d">-                    AlertDialog(
</a><a href="#h6-0-381" id="h6-0-381" class="d">-                        onDismissRequest = { showSettings = false },
</a><a href="#h6-0-382" id="h6-0-382" class="d">-                        title = { Text(&quot;Theme settings&quot;) },
</a><a href="#h6-0-383" id="h6-0-383" class="d">-                        text = {
</a><a href="#h6-0-384" id="h6-0-384" class="d">-                            Column(
</a><a href="#h6-0-385" id="h6-0-385" class="d">-                                modifier = Modifier.fillMaxWidth(),
</a><a href="#h6-0-386" id="h6-0-386" class="d">-                            ) {
</a><a href="#h6-0-387" id="h6-0-387" class="d">-                                actionsRow.forEach { entry -&gt;
</a><a href="#h6-0-388" id="h6-0-388" class="d">-                                    Row(
</a><a href="#h6-0-389" id="h6-0-389" class="d">-                                        modifier = Modifier
</a><a href="#h6-0-390" id="h6-0-390" class="d">-                                            .fillMaxWidth()
</a><a href="#h6-0-391" id="h6-0-391" class="d">-                                            .clickable {
</a><a href="#h6-0-392" id="h6-0-392" class="d">-                                                showSettings = false
</a><a href="#h6-0-393" id="h6-0-393" class="d">-                                                entry.value()
</a><a href="#h6-0-394" id="h6-0-394" class="d">-                                            },
</a><a href="#h6-0-395" id="h6-0-395" class="d">-                                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h6-0-396" id="h6-0-396" class="d">-                                    ) {
</a><a href="#h6-0-397" id="h6-0-397" class="d">-                                        Icon(entry.key.second, contentDescription = null, modifier = Modifier.padding(16.dp))
</a><a href="#h6-0-398" id="h6-0-398" class="d">-                                        Spacer(modifier = Modifier.width(5.dp))
</a><a href="#h6-0-399" id="h6-0-399" class="d">-                                        Text(entry.key.first)
</a><a href="#h6-0-400" id="h6-0-400" class="d">-                                    }
</a><a href="#h6-0-401" id="h6-0-401" class="d">-                                }
</a><a href="#h6-0-402" id="h6-0-402" class="d">-                            }
</a><a href="#h6-0-403" id="h6-0-403" class="d">-                        },
</a><a href="#h6-0-404" id="h6-0-404" class="d">-                        confirmButton = {}
</a><a href="#h6-0-405" id="h6-0-405" class="d">-                    )
</a><a href="#h6-0-406" id="h6-0-406" class="d">-                }
</a><a href="#h6-0-407" id="h6-0-407" class="d">-            }
</a><a href="#h6-0-408" id="h6-0-408" class="d">-            item {
</a><a href="#h6-0-409" id="h6-0-409" class="d">-                Spacer(modifier = Modifier.height(200.dp))
</a><a href="#h6-0-410" id="h6-0-410" class="d">-            }
</a><a href="#h6-0-411" id="h6-0-411" class="d">-        }
</a><a href="#h6-0-412" id="h6-0-412" class="d">-    }
</a><a href="#h6-0-413" id="h6-0-413" class="d">-
</a><a href="#h6-0-414" id="h6-0-414" class="d">-
</a><a href="#h6-0-415" id="h6-0-415" class="d">-    @OptIn(ExperimentalFoundationApi::class)
</a><a href="#h6-0-416" id="h6-0-416" class="d">-    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h6-0-417" id="h6-0-417" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h6-0-418" id="h6-0-418" class="d">-        val titles = remember { listOf(&quot;Installed Themes&quot;, &quot;Catalog&quot;) }
</a><a href="#h6-0-419" id="h6-0-419" class="d">-        val pagerState = rememberPagerState { titles.size }
</a><a href="#h6-0-420" id="h6-0-420" class="d">-        currentPage = pagerState.currentPage
</a><a href="#h6-0-421" id="h6-0-421" class="d">-
</a><a href="#h6-0-422" id="h6-0-422" class="d">-        Column {
</a><a href="#h6-0-423" id="h6-0-423" class="d">-            TabRow(selectedTabIndex = pagerState.currentPage, indicator = { tabPositions -&gt;
</a><a href="#h6-0-424" id="h6-0-424" class="d">-                TabRowDefaults.SecondaryIndicator(
</a><a href="#h6-0-425" id="h6-0-425" class="d">-                    Modifier.pagerTabIndicatorOffset(
</a><a href="#h6-0-426" id="h6-0-426" class="d">-                        pagerState = pagerState,
</a><a href="#h6-0-427" id="h6-0-427" class="d">-                        tabPositions = tabPositions
</a><a href="#h6-0-428" id="h6-0-428" class="d">-                    )
</a><a href="#h6-0-429" id="h6-0-429" class="d">-                )
</a><a href="#h6-0-430" id="h6-0-430" class="d">-            }) {
</a><a href="#h6-0-431" id="h6-0-431" class="d">-                titles.forEachIndexed { index, title -&gt;
</a><a href="#h6-0-432" id="h6-0-432" class="d">-                    Tab(
</a><a href="#h6-0-433" id="h6-0-433" class="d">-                        selected = pagerState.currentPage == index,
</a><a href="#h6-0-434" id="h6-0-434" class="d">-                        onClick = {
</a><a href="#h6-0-435" id="h6-0-435" class="d">-                            coroutineScope.launch {
</a><a href="#h6-0-436" id="h6-0-436" class="d">-                                pagerState.animateScrollToPage(index)
</a><a href="#h6-0-437" id="h6-0-437" class="d">-                            }
</a><a href="#h6-0-438" id="h6-0-438" class="d">-                        },
</a><a href="#h6-0-439" id="h6-0-439" class="d">-                        text = {
</a><a href="#h6-0-440" id="h6-0-440" class="d">-                            Text(
</a><a href="#h6-0-441" id="h6-0-441" class="d">-                                text = title,
</a><a href="#h6-0-442" id="h6-0-442" class="d">-                                maxLines = 2,
</a><a href="#h6-0-443" id="h6-0-443" class="d">-                                overflow = TextOverflow.Ellipsis
</a><a href="#h6-0-444" id="h6-0-444" class="d">-                            )
</a><a href="#h6-0-445" id="h6-0-445" class="d">-                        }
</a><a href="#h6-0-446" id="h6-0-446" class="d">-                    )
</a><a href="#h6-0-447" id="h6-0-447" class="d">-                }
</a><a href="#h6-0-448" id="h6-0-448" class="d">-            }
</a><a href="#h6-0-449" id="h6-0-449" class="d">-
</a><a href="#h6-0-450" id="h6-0-450" class="d">-            HorizontalPager(
</a><a href="#h6-0-451" id="h6-0-451" class="d">-                modifier = Modifier.weight(1f),
</a><a href="#h6-0-452" id="h6-0-452" class="d">-                state = pagerState
</a><a href="#h6-0-453" id="h6-0-453" class="d">-            ) { page -&gt;
</a><a href="#h6-0-454" id="h6-0-454" class="d">-                when (page) {
</a><a href="#h6-0-455" id="h6-0-455" class="d">-                    0 -&gt; InstalledThemes()
</a><a href="#h6-0-456" id="h6-0-456" class="d">-                    1 -&gt; ThemeCatalog(this@ThemingRoot)
</a><a href="#h6-0-457" id="h6-0-457" class="d">-                }
</a><a href="#h6-0-458" id="h6-0-458" class="d">-            }
</a><a href="#h6-0-459" id="h6-0-459" class="d">-        }
</a><a href="#h6-0-460" id="h6-0-460" class="d">-    }
</a><a href="#h6-0-461" id="h6-0-461" class="d">-}</a><a href="#h6-0-462" id="h6-0-462" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/common/src/main/assets/lang/en_US.json.html">common/src/main/assets/lang/en_US.json</a> b/<a href="../file/common/src/main/assets/lang/en_US.json.html">common/src/main/assets/lang/en_US.json</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -37,8 +37,6 @@
</a>             &quot;friend_tracker&quot;: &quot;Friend Tracker&quot;,
             &quot;edit_rule&quot;: &quot;Edit Rule&quot;,
             &quot;file_imports&quot;: &quot;File Imports&quot;,
<a href="#h7-0-3" id="h7-0-3" class="d">-            &quot;theming&quot;: &quot;Theming&quot;,
</a><a href="#h7-0-4" id="h7-0-4" class="d">-            &quot;edit_theme&quot;: &quot;Edit Theme&quot;,
</a>             &quot;manage_repos&quot;: &quot;Manage Repositories&quot;,
             &quot;social&quot;: &quot;Social&quot;,
             &quot;manage_scope&quot;: &quot;Manage Scope&quot;,
<a href="#h7-1" id="h7-1" class="h">@@ -189,9 +187,6 @@
</a>                 &quot;search_bar&quot;: &quot;Search&quot;,
                 &quot;no_friends_map&quot;: &quot;No friends on the map&quot;,
                 &quot;no_friends_found&quot;: &quot;No friends found&quot;
<a href="#h7-1-3" id="h7-1-3" class="d">-            },
</a><a href="#h7-1-4" id="h7-1-4" class="d">-            &quot;theming&quot;: {
</a><a href="#h7-1-5" id="h7-1-5" class="d">-                &quot;no_themes_hint&quot;: &quot;No themes found&quot;
</a>             }
         },
         &quot;dialogs&quot;: {
<a href="#h7-2" id="h7-2" class="h">@@ -336,10 +331,6 @@
</a>         &quot;logger_history&quot;: {
             &quot;name&quot;: &quot;Logger History&quot;,
             &quot;description&quot;: &quot;View the history of logged messages&quot;
<a href="#h7-2-3" id="h7-2-3" class="d">-        },
</a><a href="#h7-2-4" id="h7-2-4" class="d">-        &quot;theming&quot;: {
</a><a href="#h7-2-5" id="h7-2-5" class="d">-            &quot;name&quot;: &quot;Theming&quot;,
</a><a href="#h7-2-6" id="h7-2-6" class="d">-            &quot;description&quot;: &quot;Customize the look and feel of Snapchat&quot;
</a>         }
     },
 
<a href="#h7-3" id="h7-3" class="h">@@ -454,10 +445,6 @@
</a>                         &quot;name&quot;: &quot;Enable App Appearance Settings&quot;,
                         &quot;description&quot;: &quot;Enables the hidden App Appearance Setting\nMay not be required on newer Snapchat versions&quot;
                     },
<a href="#h7-3-3" id="h7-3-3" class="d">-                    &quot;custom_theme&quot;: {
</a><a href="#h7-3-4" id="h7-3-4" class="d">-                        &quot;name&quot;: &quot;Custom Theme&quot;,
</a><a href="#h7-3-5" id="h7-3-5" class="d">-                        &quot;description&quot;: &quot;Customize Snapchat&#39;s Colors\nNote: if you choose a dark theme (like Amoled), you may need to enable the dark mode in Snapchat settings for better results&quot;
</a><a href="#h7-3-6" id="h7-3-6" class="d">-                    },
</a>                     &quot;friend_feed_message_preview&quot;: {
                         &quot;name&quot;: &quot;Friend Feed Message Preview&quot;,
                         &quot;description&quot;: &quot;Shows a preview of the last messages in the Friend Feed&quot;,
<a href="#h7-4" id="h7-4" class="h">@@ -1212,12 +1199,6 @@
</a>                 &quot;always_light&quot;: &quot;Always Light&quot;,
                 &quot;always_dark&quot;: &quot;Always Dark&quot;
             },
<a href="#h7-4-3" id="h7-4-3" class="d">-            &quot;custom_theme&quot;: {
</a><a href="#h7-4-4" id="h7-4-4" class="d">-                &quot;amoled_dark_mode&quot;: &quot;Amoled Dark Mode&quot;,
</a><a href="#h7-4-5" id="h7-4-5" class="d">-                &quot;custom&quot;: &quot;Custom Themes (Use the Quick Actions to manage themes)&quot;,
</a><a href="#h7-4-6" id="h7-4-6" class="d">-                &quot;material_you_light&quot;: &quot;Material You Light (Android 12+)&quot;,
</a><a href="#h7-4-7" id="h7-4-7" class="d">-                &quot;material_you_dark&quot;: &quot;Material You Dark (Android 12+)&quot;
</a><a href="#h7-4-8" id="h7-4-8" class="d">-            },
</a>             &quot;friend_feed_menu_buttons&quot;: {
                 &quot;auto_download&quot;: &quot;\u2B07\uFE0F Auto Download&quot;,
                 &quot;auto_save&quot;: &quot;\uD83D\uDCAC Auto Save Messages&quot;,
<a href="#h7-5" id="h7-5" class="h">@@ -1708,48 +1689,6 @@
</a>         &quot;date_range_input_invalid_range_input&quot;: &quot;Invalid date range&quot;
     },
 
<a href="#h7-5-3" id="h7-5-3" class="d">-    &quot;theming_attributes&quot;: {
</a><a href="#h7-5-4" id="h7-5-4" class="d">-        &quot;sigColorTextPrimary&quot;: &quot;Main Text Color&quot;,
</a><a href="#h7-5-5" id="h7-5-5" class="d">-        &quot;sigColorChatChat&quot;: &quot;Main Friend Feed Text Color&quot;,
</a><a href="#h7-5-6" id="h7-5-6" class="d">-        &quot;sigColorBackgroundSurface&quot;: &quot;Background Surface Color&quot;,
</a><a href="#h7-5-7" id="h7-5-7" class="d">-        &quot;sigColorChatPendingSending&quot;: &quot;Secondary Friend Feed Text Color&quot;,
</a><a href="#h7-5-8" id="h7-5-8" class="d">-        &quot;sigColorChatSnapWithSound&quot;: &quot;Snaps With Sound Text Color&quot;,
</a><a href="#h7-5-9" id="h7-5-9" class="d">-        &quot;sigColorChatSnapWithoutSound&quot;: &quot;Snaps Without Sound Text Color&quot;,
</a><a href="#h7-5-10" id="h7-5-10" class="d">-        &quot;actionSheetDescriptionTextColor&quot;: &quot;Action Menu Description Text Color&quot;,
</a><a href="#h7-5-11" id="h7-5-11" class="d">-        &quot;sigColorBackgroundMain&quot;: &quot;Background Color&quot;,
</a><a href="#h7-5-12" id="h7-5-12" class="d">-        &quot;listBackgroundDrawable&quot;: &quot;Conversation list Background&quot;,
</a><a href="#h7-5-13" id="h7-5-13" class="d">-        &quot;sigColorChatConversationsLine&quot;: &quot;Conversations Line Color&quot;,
</a><a href="#h7-5-14" id="h7-5-14" class="d">-        &quot;actionSheetBackgroundDrawable&quot;: &quot;Action Menu Background Color&quot;,
</a><a href="#h7-5-15" id="h7-5-15" class="d">-        &quot;actionSheetRoundedBackgroundDrawable&quot;: &quot;Action Menu Round Background Color&quot;,
</a><a href="#h7-5-16" id="h7-5-16" class="d">-        &quot;sigColorIconPrimary&quot;: &quot;Action Menu Icon Color&quot;,
</a><a href="#h7-5-17" id="h7-5-17" class="d">-        &quot;sigExceptionColorCameraGridLines&quot;: &quot;Camera Gridlines Color&quot;,
</a><a href="#h7-5-18" id="h7-5-18" class="d">-        &quot;listDivider&quot;: &quot;List Divider Color&quot;,
</a><a href="#h7-5-19" id="h7-5-19" class="d">-        &quot;sigColorIconSecondary&quot;: &quot;Secondary Icon Color&quot;,
</a><a href="#h7-5-20" id="h7-5-20" class="d">-        &quot;itemShapeFillColor&quot;: &quot;Item Shape Fill Color&quot;,
</a><a href="#h7-5-21" id="h7-5-21" class="d">-        &quot;ringColor&quot;: &quot;Ring Color&quot;,
</a><a href="#h7-5-22" id="h7-5-22" class="d">-        &quot;ringStartColor&quot;: &quot;Ring Start Color&quot;,
</a><a href="#h7-5-23" id="h7-5-23" class="d">-        &quot;sigColorLayoutPlaceholder&quot;: &quot;Layout Placeholder Color&quot;,
</a><a href="#h7-5-24" id="h7-5-24" class="d">-        &quot;scButtonColor&quot;: &quot;Snapchat Button Color&quot;,
</a><a href="#h7-5-25" id="h7-5-25" class="d">-        &quot;recipientPillBackgroundDrawable&quot;: &quot;Recipient Pill Background&quot;,
</a><a href="#h7-5-26" id="h7-5-26" class="d">-        &quot;boxBackgroundColor&quot;: &quot;Box Background Color&quot;,
</a><a href="#h7-5-27" id="h7-5-27" class="d">-        &quot;editTextColor&quot;: &quot;Edit Text Color&quot;,
</a><a href="#h7-5-28" id="h7-5-28" class="d">-        &quot;chipBackgroundColor&quot;: &quot;Chip Background Color&quot;,
</a><a href="#h7-5-29" id="h7-5-29" class="d">-        &quot;recipientInputStyle&quot;: &quot;Recipient Input Style&quot;,
</a><a href="#h7-5-30" id="h7-5-30" class="d">-        &quot;rangeFillColor&quot;: &quot;Range Fill Color&quot;,
</a><a href="#h7-5-31" id="h7-5-31" class="d">-        &quot;pstsIndicatorColor&quot;: &quot;PSTS Indicator Color&quot;,
</a><a href="#h7-5-32" id="h7-5-32" class="d">-        &quot;pstsTabBackground&quot;: &quot;PSTS Tab Background&quot;,
</a><a href="#h7-5-33" id="h7-5-33" class="d">-        &quot;pstsDividerColor&quot;: &quot;PSTS Divider Color&quot;,
</a><a href="#h7-5-34" id="h7-5-34" class="d">-        &quot;tabTextColor&quot;: &quot;Tab Text Color&quot;,
</a><a href="#h7-5-35" id="h7-5-35" class="d">-        &quot;statusBarForeground&quot;: &quot;Status Bar Foreground Color&quot;,
</a><a href="#h7-5-36" id="h7-5-36" class="d">-        &quot;statusBarBackground&quot;: &quot;Status Bar Background Color&quot;,
</a><a href="#h7-5-37" id="h7-5-37" class="d">-        &quot;strokeColor&quot;: &quot;Stroke Color&quot;,
</a><a href="#h7-5-38" id="h7-5-38" class="d">-        &quot;storyReplayViewRingColor&quot;: &quot;Story Replay View Ring Color&quot;,
</a><a href="#h7-5-39" id="h7-5-39" class="d">-        &quot;sigColorButtonPrimary&quot;: &quot;Primary Button Color&quot;,
</a><a href="#h7-5-40" id="h7-5-40" class="d">-        &quot;sigColorBaseAppYellow&quot;: &quot;Base App Yellow Color&quot;,
</a><a href="#h7-5-41" id="h7-5-41" class="d">-        &quot;sigColorBackgroundSurfaceTranslucent&quot;: &quot;Translucent Background Surface Color&quot;,
</a><a href="#h7-5-42" id="h7-5-42" class="d">-        &quot;sigColorStoryRingFriendsFeedStoryRing&quot;: &quot;Story Ring Friends Feed Story Ring Color&quot;,
</a><a href="#h7-5-43" id="h7-5-43" class="d">-        &quot;sigColorStoryRingDiscoverTabThumbnailStoryRing&quot;: &quot;Story Ring Discover Tab Thumbnail Story Ring Color&quot;
</a><a href="#h7-5-44" id="h7-5-44" class="d">-    },
</a>     &quot;send_override_dialog&quot;: {
         &quot;title&quot;: &quot;Send media as {type}&quot;,
         &quot;duration&quot;: &quot;Duration: {duration}&quot;,
<b>diff --git a/<a id="h8" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -5,6 +5,8 @@ import android.os.ParcelFileDescriptor
</a> import android.os.ParcelFileDescriptor.AutoCloseInputStream
 import android.os.ParcelFileDescriptor.AutoCloseOutputStream
 import me.rhunk.snapenhance.bridge.storage.FileHandle
<a href="#h8-0-3" id="h8-0-3" class="i">+import me.rhunk.snapenhance.common.bridge.FileHandleScope.entries
</a><a href="#h8-0-4" id="h8-0-4" class="i">+import me.rhunk.snapenhance.common.bridge.InternalFileHandleType.entries
</a> import me.rhunk.snapenhance.common.util.LazyBridgeValue
 import me.rhunk.snapenhance.common.util.lazyBridge
 import java.io.File
<a href="#h8-1" id="h8-1" class="h">@@ -16,8 +18,7 @@ enum class FileHandleScope(
</a>     INTERNAL(&quot;internal&quot;),
     LOCALE(&quot;locale&quot;),
     USER_IMPORT(&quot;user_import&quot;),
<a href="#h8-1-3" id="h8-1-3" class="d">-    COMPOSER(&quot;composer&quot;),
</a><a href="#h8-1-4" id="h8-1-4" class="d">-    THEME(&quot;theme&quot;);
</a><a href="#h8-1-5" id="h8-1-5" class="i">+    COMPOSER(&quot;composer&quot;);
</a> 
     companion object {
         fun fromValue(name: String): FileHandleScope? = entries.find { it.key == name }
<b>diff --git a/<a id="h9" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -27,12 +27,6 @@ class UserInterfaceTweaks : ConfigContainer() {
</a>         set(mutableListOf(&quot;conversation_info&quot;, MessagingRuleType.STEALTH.key))
     }
     val autoCloseFriendFeedMenu = boolean(&quot;auto_close_friend_feed_menu&quot;)
<a href="#h9-0-3" id="h9-0-3" class="d">-    val customTheme = unique(&quot;custom_theme&quot;,
</a><a href="#h9-0-4" id="h9-0-4" class="d">-        &quot;amoled_dark_mode&quot;,
</a><a href="#h9-0-5" id="h9-0-5" class="d">-        &quot;material_you_light&quot;,
</a><a href="#h9-0-6" id="h9-0-6" class="d">-        &quot;material_you_dark&quot;,
</a><a href="#h9-0-7" id="h9-0-7" class="d">-        &quot;custom&quot;,
</a><a href="#h9-0-8" id="h9-0-8" class="d">-    ) { addNotices(FeatureNotice.UNSTABLE); requireRestart(); versionCheck = RES_OBF_VERSION_CHECK.copy(isDisabled = true) }
</a>     val friendFeedMessagePreview = container(&quot;friend_feed_message_preview&quot;, FriendFeedMessagePreview()) { requireRestart() }
     val snapPreview = boolean(&quot;snap_preview&quot;) { addNotices(FeatureNotice.UNSTABLE); requireRestart() }
     val bootstrapOverride = container(&quot;bootstrap_override&quot;, BootstrapOverride()) { requireRestart() }
<b>diff --git a/<a id="h10" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -127,7 +127,6 @@ class FeatureManager(
</a>             AccountSwitcher(),
             RemoveGroupsLockedStatus(),
             BypassMessageActionRestrictions(),
<a href="#h10-0-3" id="h10-0-3" class="d">-            CustomTheming(),
</a>             BetterLocation(),
             MediaFilePicker(),
             HideActiveMusic(),
<b>diff --git a/<a id="h11" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,130 +0,0 @@
</a><a href="#h11-0-0" id="h11-0-0" class="d">-package me.rhunk.snapenhance.core.features.impl.ui
</a><a href="#h11-0-1" id="h11-0-1" class="d">-
</a><a href="#h11-0-2" id="h11-0-2" class="d">-import android.content.res.TypedArray
</a><a href="#h11-0-3" id="h11-0-3" class="d">-import android.os.Build
</a><a href="#h11-0-4" id="h11-0-4" class="d">-import android.os.ParcelFileDescriptor
</a><a href="#h11-0-5" id="h11-0-5" class="d">-import android.os.ParcelFileDescriptor.AutoCloseInputStream
</a><a href="#h11-0-6" id="h11-0-6" class="d">-import android.util.TypedValue
</a><a href="#h11-0-7" id="h11-0-7" class="d">-import androidx.compose.material3.dynamicDarkColorScheme
</a><a href="#h11-0-8" id="h11-0-8" class="d">-import androidx.compose.ui.graphics.toArgb
</a><a href="#h11-0-9" id="h11-0-9" class="d">-import com.google.gson.reflect.TypeToken
</a><a href="#h11-0-10" id="h11-0-10" class="d">-import me.rhunk.snapenhance.common.bridge.FileHandleScope
</a><a href="#h11-0-11" id="h11-0-11" class="d">-import me.rhunk.snapenhance.common.data.DatabaseThemeContent
</a><a href="#h11-0-12" id="h11-0-12" class="d">-import me.rhunk.snapenhance.core.features.Feature
</a><a href="#h11-0-13" id="h11-0-13" class="d">-import me.rhunk.snapenhance.core.util.hook.HookStage
</a><a href="#h11-0-14" id="h11-0-14" class="d">-import me.rhunk.snapenhance.core.util.hook.hook
</a><a href="#h11-0-15" id="h11-0-15" class="d">-import me.rhunk.snapenhance.core.util.ktx.getIdentifier
</a><a href="#h11-0-16" id="h11-0-16" class="d">-import me.rhunk.snapenhance.core.util.ktx.getObjectField
</a><a href="#h11-0-17" id="h11-0-17" class="d">-
</a><a href="#h11-0-18" id="h11-0-18" class="d">-class CustomTheming: Feature(&quot;Custom Theming&quot;) {
</a><a href="#h11-0-19" id="h11-0-19" class="d">-    private fun getAttribute(name: String): Int {
</a><a href="#h11-0-20" id="h11-0-20" class="d">-        return context.resources.getIdentifier(name, &quot;attr&quot;)
</a><a href="#h11-0-21" id="h11-0-21" class="d">-    }
</a><a href="#h11-0-22" id="h11-0-22" class="d">-
</a><a href="#h11-0-23" id="h11-0-23" class="d">-    private fun parseAttributeList(vararg attributes: Pair&lt;String, Number&gt;): Map&lt;Int, Int&gt; {
</a><a href="#h11-0-24" id="h11-0-24" class="d">-        return attributes.toMap().mapKeys {
</a><a href="#h11-0-25" id="h11-0-25" class="d">-            getAttribute(it.key)
</a><a href="#h11-0-26" id="h11-0-26" class="d">-        }.filterKeys { it != 0 }.mapValues {
</a><a href="#h11-0-27" id="h11-0-27" class="d">-            it.value.toInt()
</a><a href="#h11-0-28" id="h11-0-28" class="d">-        }
</a><a href="#h11-0-29" id="h11-0-29" class="d">-    }
</a><a href="#h11-0-30" id="h11-0-30" class="d">-
</a><a href="#h11-0-31" id="h11-0-31" class="d">-    override fun init() {
</a><a href="#h11-0-32" id="h11-0-32" class="d">-        val customThemeName = context.config.userInterface.customTheme.getNullable() ?: return
</a><a href="#h11-0-33" id="h11-0-33" class="d">-        var currentTheme = mapOf&lt;Int, Int&gt;() // resource id -&gt; color
</a><a href="#h11-0-34" id="h11-0-34" class="d">-
</a><a href="#h11-0-35" id="h11-0-35" class="d">-        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {
</a><a href="#h11-0-36" id="h11-0-36" class="d">-            val colorScheme = dynamicDarkColorScheme(context.androidContext)
</a><a href="#h11-0-37" id="h11-0-37" class="d">-            val light = customThemeName == &quot;material_you_light&quot;
</a><a href="#h11-0-38" id="h11-0-38" class="d">-            val surfaceVariant = (if (light) colorScheme.surfaceVariant else colorScheme.onSurfaceVariant).toArgb()
</a><a href="#h11-0-39" id="h11-0-39" class="d">-            val background = (if (light) colorScheme.onBackground else colorScheme.background).toArgb()
</a><a href="#h11-0-40" id="h11-0-40" class="d">-
</a><a href="#h11-0-41" id="h11-0-41" class="d">-            currentTheme = parseAttributeList(
</a><a href="#h11-0-42" id="h11-0-42" class="d">-                &quot;sigColorTextPrimary&quot; to surfaceVariant,
</a><a href="#h11-0-43" id="h11-0-43" class="d">-                &quot;sigColorChatChat&quot; to surfaceVariant,
</a><a href="#h11-0-44" id="h11-0-44" class="d">-                &quot;sigColorChatPendingSending&quot; to surfaceVariant,
</a><a href="#h11-0-45" id="h11-0-45" class="d">-                &quot;sigColorChatSnapWithSound&quot; to surfaceVariant,
</a><a href="#h11-0-46" id="h11-0-46" class="d">-                &quot;sigColorChatSnapWithoutSound&quot; to surfaceVariant,
</a><a href="#h11-0-47" id="h11-0-47" class="d">-                &quot;sigColorBackgroundMain&quot; to background,
</a><a href="#h11-0-48" id="h11-0-48" class="d">-                &quot;sigColorBackgroundSurface&quot; to background,
</a><a href="#h11-0-49" id="h11-0-49" class="d">-                &quot;listDivider&quot; to colorScheme.onPrimary.copy(alpha = 0.12f).toArgb(),
</a><a href="#h11-0-50" id="h11-0-50" class="d">-                &quot;actionSheetBackgroundDrawable&quot; to background,
</a><a href="#h11-0-51" id="h11-0-51" class="d">-                &quot;actionSheetRoundedBackgroundDrawable&quot; to background,
</a><a href="#h11-0-52" id="h11-0-52" class="d">-                &quot;sigExceptionColorCameraGridLines&quot; to background,
</a><a href="#h11-0-53" id="h11-0-53" class="d">-            )
</a><a href="#h11-0-54" id="h11-0-54" class="d">-        }
</a><a href="#h11-0-55" id="h11-0-55" class="d">-
</a><a href="#h11-0-56" id="h11-0-56" class="d">-        if (customThemeName == &quot;amoled_dark_mode&quot;) {
</a><a href="#h11-0-57" id="h11-0-57" class="d">-            currentTheme = parseAttributeList(
</a><a href="#h11-0-58" id="h11-0-58" class="d">-                &quot;sigColorTextPrimary&quot; to 0xFFFFFFFF,
</a><a href="#h11-0-59" id="h11-0-59" class="d">-                &quot;sigColorChatChat&quot; to 0xFFFFFFFF,
</a><a href="#h11-0-60" id="h11-0-60" class="d">-                &quot;sigColorChatPendingSending&quot; to 0xFFFFFFFF,
</a><a href="#h11-0-61" id="h11-0-61" class="d">-                &quot;sigColorChatSnapWithSound&quot; to 0xFFFFFFFF,
</a><a href="#h11-0-62" id="h11-0-62" class="d">-                &quot;sigColorChatSnapWithoutSound&quot; to 0xFFFFFFFF,
</a><a href="#h11-0-63" id="h11-0-63" class="d">-                &quot;sigColorBackgroundMain&quot; to 0xFF000000,
</a><a href="#h11-0-64" id="h11-0-64" class="d">-                &quot;sigColorBackgroundSurface&quot; to 0xFF000000,
</a><a href="#h11-0-65" id="h11-0-65" class="d">-                &quot;listDivider&quot; to 0xFF000000,
</a><a href="#h11-0-66" id="h11-0-66" class="d">-                &quot;actionSheetBackgroundDrawable&quot; to 0xFF000000,
</a><a href="#h11-0-67" id="h11-0-67" class="d">-                &quot;actionSheetRoundedBackgroundDrawable&quot; to 0xFF000000,
</a><a href="#h11-0-68" id="h11-0-68" class="d">-                &quot;sigExceptionColorCameraGridLines&quot; to 0xFF000000,
</a><a href="#h11-0-69" id="h11-0-69" class="d">-            )
</a><a href="#h11-0-70" id="h11-0-70" class="d">-        }
</a><a href="#h11-0-71" id="h11-0-71" class="d">-
</a><a href="#h11-0-72" id="h11-0-72" class="d">-        if (customThemeName == &quot;custom&quot;) {
</a><a href="#h11-0-73" id="h11-0-73" class="d">-            val availableThemes = context.fileHandlerManager.getFileHandle(FileHandleScope.THEME.key, &quot;&quot;)?.open(ParcelFileDescriptor.MODE_READ_ONLY)?.use { pfd -&gt;
</a><a href="#h11-0-74" id="h11-0-74" class="d">-                AutoCloseInputStream(pfd).use { it.readBytes() }
</a><a href="#h11-0-75" id="h11-0-75" class="d">-            }?.let {
</a><a href="#h11-0-76" id="h11-0-76" class="d">-                context.gson.fromJson(it.toString(Charsets.UTF_8), object: TypeToken&lt;List&lt;DatabaseThemeContent&gt;&gt;() {})
</a><a href="#h11-0-77" id="h11-0-77" class="d">-            } ?: run {
</a><a href="#h11-0-78" id="h11-0-78" class="d">-                context.log.verbose(&quot;no custom themes found&quot;)
</a><a href="#h11-0-79" id="h11-0-79" class="d">-                return
</a><a href="#h11-0-80" id="h11-0-80" class="d">-            }
</a><a href="#h11-0-81" id="h11-0-81" class="d">-
</a><a href="#h11-0-82" id="h11-0-82" class="d">-            val customThemeColors = mutableMapOf&lt;Int, Int&gt;()
</a><a href="#h11-0-83" id="h11-0-83" class="d">-
</a><a href="#h11-0-84" id="h11-0-84" class="d">-            context.log.verbose(&quot;loading ${availableThemes.size} custom themes&quot;)
</a><a href="#h11-0-85" id="h11-0-85" class="d">-
</a><a href="#h11-0-86" id="h11-0-86" class="d">-            availableThemes.forEach { themeContent -&gt;
</a><a href="#h11-0-87" id="h11-0-87" class="d">-                themeContent.colors.forEach colors@{ colorEntry -&gt;
</a><a href="#h11-0-88" id="h11-0-88" class="d">-                    customThemeColors[getAttribute(colorEntry.key).takeIf { it != 0 }.also {
</a><a href="#h11-0-89" id="h11-0-89" class="d">-                        if (it == null) {
</a><a href="#h11-0-90" id="h11-0-90" class="d">-                            context.log.warn(&quot;unknown color attribute: ${colorEntry.key}&quot;)
</a><a href="#h11-0-91" id="h11-0-91" class="d">-                        }
</a><a href="#h11-0-92" id="h11-0-92" class="d">-                    } ?: return@colors] = colorEntry.value
</a><a href="#h11-0-93" id="h11-0-93" class="d">-                }
</a><a href="#h11-0-94" id="h11-0-94" class="d">-            }
</a><a href="#h11-0-95" id="h11-0-95" class="d">-
</a><a href="#h11-0-96" id="h11-0-96" class="d">-            currentTheme = customThemeColors
</a><a href="#h11-0-97" id="h11-0-97" class="d">-
</a><a href="#h11-0-98" id="h11-0-98" class="d">-            context.log.verbose(&quot;loaded ${customThemeColors.size} custom theme colors&quot;)
</a><a href="#h11-0-99" id="h11-0-99" class="d">-        }
</a><a href="#h11-0-100" id="h11-0-100" class="d">-
</a><a href="#h11-0-101" id="h11-0-101" class="d">-        onNextActivityCreate {
</a><a href="#h11-0-102" id="h11-0-102" class="d">-            if (currentTheme.isEmpty()) return@onNextActivityCreate
</a><a href="#h11-0-103" id="h11-0-103" class="d">-
</a><a href="#h11-0-104" id="h11-0-104" class="d">-            context.androidContext.theme.javaClass.getMethod(&quot;obtainStyledAttributes&quot;, IntArray::class.java).hook(
</a><a href="#h11-0-105" id="h11-0-105" class="d">-                HookStage.AFTER) { param -&gt;
</a><a href="#h11-0-106" id="h11-0-106" class="d">-                val array = param.arg&lt;IntArray&gt;(0)
</a><a href="#h11-0-107" id="h11-0-107" class="d">-                val customColor = (currentTheme[array[0]] as? Number)?.toInt() ?: return@hook
</a><a href="#h11-0-108" id="h11-0-108" class="d">-
</a><a href="#h11-0-109" id="h11-0-109" class="d">-                val result = param.getResult() as TypedArray
</a><a href="#h11-0-110" id="h11-0-110" class="d">-                val typedArrayData = result.getObjectField(&quot;mData&quot;) as IntArray
</a><a href="#h11-0-111" id="h11-0-111" class="d">-
</a><a href="#h11-0-112" id="h11-0-112" class="d">-                when (val attributeType = result.getType(0)) {
</a><a href="#h11-0-113" id="h11-0-113" class="d">-                    TypedValue.TYPE_INT_COLOR_ARGB8, TypedValue.TYPE_INT_COLOR_RGB8, TypedValue.TYPE_INT_COLOR_ARGB4, TypedValue.TYPE_INT_COLOR_RGB4 -&gt; {
</a><a href="#h11-0-114" id="h11-0-114" class="d">-                        typedArrayData[1] = customColor // index + STYLE_DATA
</a><a href="#h11-0-115" id="h11-0-115" class="d">-                    }
</a><a href="#h11-0-116" id="h11-0-116" class="d">-                    TypedValue.TYPE_STRING -&gt; {
</a><a href="#h11-0-117" id="h11-0-117" class="d">-                        val stringValue = result.getString(0)
</a><a href="#h11-0-118" id="h11-0-118" class="d">-                        if (stringValue?.endsWith(&quot;.xml&quot;) == true) {
</a><a href="#h11-0-119" id="h11-0-119" class="d">-                            typedArrayData[0] = TypedValue.TYPE_INT_COLOR_ARGB4 // STYLE_TYPE
</a><a href="#h11-0-120" id="h11-0-120" class="d">-                            typedArrayData[1] = customColor // STYLE_DATA
</a><a href="#h11-0-121" id="h11-0-121" class="d">-                            typedArrayData[5] = 0; // STYLE_DENSITY
</a><a href="#h11-0-122" id="h11-0-122" class="d">-                        }
</a><a href="#h11-0-123" id="h11-0-123" class="d">-                    }
</a><a href="#h11-0-124" id="h11-0-124" class="d">-                    else -&gt; context.log.warn(&quot;unknown attribute type: ${attributeType.toString(16)}&quot;)
</a><a href="#h11-0-125" id="h11-0-125" class="d">-                }
</a><a href="#h11-0-126" id="h11-0-126" class="d">-            }
</a><a href="#h11-0-127" id="h11-0-127" class="d">-        }
</a><a href="#h11-0-128" id="h11-0-128" class="d">-    }
</a><a href="#h11-0-129" id="h11-0-129" class="d">-}</a><a href="#h11-0-130" id="h11-0-130" class="d">-
\ No newline at end of file
</a></pre>
</div>
</body>
</html>
