<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: streaks reminder - add streak indicator in social - fix dialogs - fix container global state - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/3eb8c8f015380da1b9f5319ba869f082f7925970.html">3eb8c8f015380da1b9f5319ba869f082f7925970</a>
<b>parent</b> <a href="../commit/7703d3f007dc661624de1c2c6786d51132add223.html">7703d3f007dc661624de1c2c6786d51132add223</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Thu, 24 Aug 2023 02:15:06 +0200

feat: streaks reminder
- add streak indicator in social
- fix dialogs
- fix container global state

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/AndroidManifest.xml</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></td><td> | </td><td class="num">23</td><td><span class="i">++++++++++++++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/SharedContextHolder.kt</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+++++</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt</a></td><td> | </td><td class="num">102</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/MainActivity.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">+++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a></td><td> | </td><td class="num">25</td><td><span class="i">+++++++++++++++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a></td><td> | </td><td class="num">32</td><td><span class="i">++++++++++++++++++</span><span class="d">--------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeContent.kt</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a></td><td> | </td><td class="num">33</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a></td><td> | </td><td class="num">28</td><td><span class="i">++++++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ComposeImageHelper.kt</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++</span><span class="d">--</span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">app/src/main/res/drawable/streak_icon.xml</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">core/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h17">core/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a></td><td> | </td><td class="num">12</td><td><span class="i"></span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h19">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h21">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="A">A</td><td><a href="#h23">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/StreaksReminderConfig.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a></td><td> | </td><td class="num">11</td><td><span class="i">++++++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h26">core/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h28">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">++++</span><span class="d">-</span></td></tr>
</table></pre><pre>29 files changed, 308 insertions(+), 91 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/AndroidManifest.xml.html">app/src/main/AndroidManifest.xml</a> b/<a href="../file/app/src/main/AndroidManifest.xml.html">app/src/main/AndroidManifest.xml</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -2,6 +2,7 @@
</a> &lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
     xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;
 
<a href="#h0-0-3" id="h0-0-3" class="i">+    &lt;uses-permission android:name=&quot;android.permission.POST_NOTIFICATIONS&quot; /&gt;
</a>     &lt;uses-permission android:name=&quot;android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS&quot; /&gt;
 
     &lt;uses-permission android:name=&quot;android.permission.DOWNLOAD_WITHOUT_NOTIFICATION&quot; /&gt;
<a href="#h0-1" id="h0-1" class="h">@@ -61,6 +62,8 @@
</a>             android:theme=&quot;@android:style/Theme.NoDisplay&quot;
             android:excludeFromRecents=&quot;true&quot;
             android:exported=&quot;true&quot; /&gt;
<a href="#h0-1-3" id="h0-1-3" class="i">+
</a><a href="#h0-1-4" id="h0-1-4" class="i">+        &lt;receiver android:name=&quot;.messaging.StreaksReminder&quot; /&gt;
</a>     &lt;/application&gt;
 
 &lt;/manifest&gt; 
\ No newline at end of file
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -9,6 +9,7 @@ import androidx.activity.ComponentActivity
</a> import androidx.documentfile.provider.DocumentFile
 import coil.ImageLoader
 import coil.decode.VideoFrameDecoder
<a href="#h1-0-3" id="h1-0-3" class="i">+import coil.disk.DiskCache
</a> import coil.memory.MemoryCache
 import kotlinx.coroutines.Dispatchers
 import me.rhunk.snapenhance.bridge.BridgeService
<a href="#h1-1" id="h1-1" class="h">@@ -17,6 +18,7 @@ import me.rhunk.snapenhance.bridge.wrapper.MappingsWrapper
</a> import me.rhunk.snapenhance.core.config.ModConfig
 import me.rhunk.snapenhance.download.DownloadTaskManager
 import me.rhunk.snapenhance.messaging.ModDatabase
<a href="#h1-1-3" id="h1-1-3" class="i">+import me.rhunk.snapenhance.messaging.StreaksReminder
</a> import me.rhunk.snapenhance.ui.manager.data.InstallationSummary
 import me.rhunk.snapenhance.ui.manager.data.ModMappingsInfo
 import me.rhunk.snapenhance.ui.manager.data.SnapchatAppInfo
<a href="#h1-2" id="h1-2" class="h">@@ -39,6 +41,7 @@ class RemoteSideContext(
</a>     val mappings = MappingsWrapper()
     val downloadTaskManager = DownloadTaskManager()
     val modDatabase = ModDatabase(this)
<a href="#h1-2-3" id="h1-2-3" class="i">+    val streaksReminder = StreaksReminder(this)
</a> 
     //used to load bitmoji selfies and download previews
     val imageLoader by lazy {
<a href="#h1-3" id="h1-3" class="h">@@ -48,24 +51,30 @@ class RemoteSideContext(
</a>                 MemoryCache.Builder(androidContext)
                     .maxSizePercent(0.25)
                     .build()
<a href="#h1-3-3" id="h1-3-3" class="d">-            }.components { add(VideoFrameDecoder.Factory()) }.build()
</a><a href="#h1-3-4" id="h1-3-4" class="d">-    }
</a><a href="#h1-3-5" id="h1-3-5" class="d">-
</a><a href="#h1-3-6" id="h1-3-6" class="d">-    init {
</a><a href="#h1-3-7" id="h1-3-7" class="d">-        reload()
</a><a href="#h1-3-8" id="h1-3-8" class="i">+            }
</a><a href="#h1-3-9" id="h1-3-9" class="i">+            .diskCache {
</a><a href="#h1-3-10" id="h1-3-10" class="i">+                DiskCache.Builder()
</a><a href="#h1-3-11" id="h1-3-11" class="i">+                    .directory(androidContext.cacheDir.resolve(&quot;coil-disk-cache&quot;))
</a><a href="#h1-3-12" id="h1-3-12" class="i">+                    .maxSizeBytes(1024 * 1024 * 100) // 100MB
</a><a href="#h1-3-13" id="h1-3-13" class="i">+                    .build()
</a><a href="#h1-3-14" id="h1-3-14" class="i">+            }
</a><a href="#h1-3-15" id="h1-3-15" class="i">+            .components { add(VideoFrameDecoder.Factory()) }.build()
</a>     }
 
     fun reload() {
         runCatching {
             config.loadFromContext(androidContext)
<a href="#h1-3-21" id="h1-3-21" class="d">-            translation.userLocale = config.locale
</a><a href="#h1-3-22" id="h1-3-22" class="d">-            translation.loadFromContext(androidContext)
</a><a href="#h1-3-23" id="h1-3-23" class="i">+            translation.apply {
</a><a href="#h1-3-24" id="h1-3-24" class="i">+                userLocale = config.locale
</a><a href="#h1-3-25" id="h1-3-25" class="i">+                loadFromContext(androidContext)
</a><a href="#h1-3-26" id="h1-3-26" class="i">+            }
</a>             mappings.apply {
                 loadFromContext(androidContext)
                 init(androidContext)
             }
             downloadTaskManager.init(androidContext)
             modDatabase.init()
<a href="#h1-3-33" id="h1-3-33" class="i">+            streaksReminder.init()
</a>         }.onFailure {
             Logger.error(&quot;Failed to load RemoteSideContext&quot;, it)
         }
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/SharedContextHolder.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/SharedContextHolder.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/SharedContextHolder.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/SharedContextHolder.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -9,6 +9,7 @@ object SharedContextHolder {
</a>     fun remote(context: Context): RemoteSideContext {
         if (!::_remoteSideContext.isInitialized || _remoteSideContext.get() == null) {
             _remoteSideContext = WeakReference(RemoteSideContext(context))
<a href="#h2-0-3" id="h2-0-3" class="i">+            _remoteSideContext.get()?.reload()
</a>         }
 
         return _remoteSideContext.get()!!
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -26,7 +26,9 @@ class BridgeService : Service() {
</a>         remoteSideContext = SharedContextHolder.remote(this).apply {
             if (checkForRequirements()) return null
         }
<a href="#h3-0-3" id="h3-0-3" class="d">-        remoteSideContext.bridgeService = this
</a><a href="#h3-0-4" id="h3-0-4" class="i">+        remoteSideContext.apply {
</a><a href="#h3-0-5" id="h3-0-5" class="i">+            bridgeService = this@BridgeService
</a><a href="#h3-0-6" id="h3-0-6" class="i">+        }
</a>         messageLoggerWrapper = MessageLoggerWrapper(getDatabasePath(BridgeFileType.MESSAGE_LOGGER_DATABASE.fileName)).also { it.init() }
         return BridgeBinder()
     }
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+package me.rhunk.snapenhance.bridge
</a><a href="#h4-0-1" id="h4-0-1" class="i">+
</a><a href="#h4-0-2" id="h4-0-2" class="i">+import android.app.Activity
</a><a href="#h4-0-3" id="h4-0-3" class="i">+import android.content.Intent
</a><a href="#h4-0-4" id="h4-0-4" class="i">+import android.os.Bundle
</a><a href="#h4-0-5" id="h4-0-5" class="i">+import me.rhunk.snapenhance.SharedContextHolder
</a><a href="#h4-0-6" id="h4-0-6" class="i">+
</a><a href="#h4-0-7" id="h4-0-7" class="i">+class ForceStartActivity : Activity() {
</a><a href="#h4-0-8" id="h4-0-8" class="i">+    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h4-0-9" id="h4-0-9" class="i">+        super.onCreate(savedInstanceState)
</a><a href="#h4-0-10" id="h4-0-10" class="i">+        if (intent.getBooleanExtra(&quot;streaks_notification_action&quot;, false)) {
</a><a href="#h4-0-11" id="h4-0-11" class="i">+            packageManager.getLaunchIntentForPackage(&quot;com.snapchat.android&quot;)?.apply {
</a><a href="#h4-0-12" id="h4-0-12" class="i">+                addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
</a><a href="#h4-0-13" id="h4-0-13" class="i">+                startActivity(this)
</a><a href="#h4-0-14" id="h4-0-14" class="i">+            }
</a><a href="#h4-0-15" id="h4-0-15" class="i">+            SharedContextHolder.remote(this).streaksReminder.dismissAllNotifications()
</a><a href="#h4-0-16" id="h4-0-16" class="i">+        }
</a><a href="#h4-0-17" id="h4-0-17" class="i">+        finish()
</a><a href="#h4-0-18" id="h4-0-18" class="i">+    }
</a><a href="#h4-0-19" id="h4-0-19" class="i">+}</a><a href="#h4-0-20" id="h4-0-20" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -140,8 +140,11 @@ class ModDatabase(
</a>                 )
                 //sync streaks
                 if (friend.streakLength &gt; 0) {
<a href="#h5-0-3" id="h5-0-3" class="d">-                    database.execSQL(&quot;INSERT OR REPLACE INTO streaks (userId, expirationTimestamp, length) VALUES (?, ?, ?)&quot;, arrayOf(
</a><a href="#h5-0-4" id="h5-0-4" class="i">+                    val streaks = getFriendStreaks(friend.userId!!)
</a><a href="#h5-0-5" id="h5-0-5" class="i">+
</a><a href="#h5-0-6" id="h5-0-6" class="i">+                    database.execSQL(&quot;INSERT OR REPLACE INTO streaks (userId, notify, expirationTimestamp, length) VALUES (?, ?, ?, ?)&quot;, arrayOf(
</a>                         friend.userId,
<a href="#h5-0-8" id="h5-0-8" class="i">+                        streaks?.notify ?: false,
</a>                         friend.streakExpirationTimestamp,
                         friend.streakLength
                     ))
<a href="#h5-1" id="h5-1" class="h">@@ -198,6 +201,7 @@ class ModDatabase(
</a>     fun deleteFriend(userId: String) {
         executeAsync {
             database.execSQL(&quot;DELETE FROM friends WHERE userId = ?&quot;, arrayOf(userId))
<a href="#h5-1-3" id="h5-1-3" class="i">+            database.execSQL(&quot;DELETE FROM streaks WHERE userId = ?&quot;, arrayOf(userId))
</a>         }
     }
 
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,101 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+package me.rhunk.snapenhance.messaging
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+import android.app.AlarmManager
</a><a href="#h6-0-3" id="h6-0-3" class="i">+import android.app.NotificationChannel
</a><a href="#h6-0-4" id="h6-0-4" class="i">+import android.app.NotificationManager
</a><a href="#h6-0-5" id="h6-0-5" class="i">+import android.app.PendingIntent
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import android.content.BroadcastReceiver
</a><a href="#h6-0-7" id="h6-0-7" class="i">+import android.content.Context
</a><a href="#h6-0-8" id="h6-0-8" class="i">+import android.content.Intent
</a><a href="#h6-0-9" id="h6-0-9" class="i">+import androidx.core.app.NotificationCompat
</a><a href="#h6-0-10" id="h6-0-10" class="i">+import androidx.core.graphics.drawable.toBitmap
</a><a href="#h6-0-11" id="h6-0-11" class="i">+import kotlinx.coroutines.CoroutineScope
</a><a href="#h6-0-12" id="h6-0-12" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h6-0-13" id="h6-0-13" class="i">+import kotlinx.coroutines.launch
</a><a href="#h6-0-14" id="h6-0-14" class="i">+import me.rhunk.snapenhance.R
</a><a href="#h6-0-15" id="h6-0-15" class="i">+import me.rhunk.snapenhance.RemoteSideContext
</a><a href="#h6-0-16" id="h6-0-16" class="i">+import me.rhunk.snapenhance.SharedContextHolder
</a><a href="#h6-0-17" id="h6-0-17" class="i">+import me.rhunk.snapenhance.bridge.ForceStartActivity
</a><a href="#h6-0-18" id="h6-0-18" class="i">+import me.rhunk.snapenhance.ui.util.ImageRequestHelper
</a><a href="#h6-0-19" id="h6-0-19" class="i">+import me.rhunk.snapenhance.util.snap.BitmojiSelfie
</a><a href="#h6-0-20" id="h6-0-20" class="i">+
</a><a href="#h6-0-21" id="h6-0-21" class="i">+class StreaksReminder(
</a><a href="#h6-0-22" id="h6-0-22" class="i">+    private val remoteSideContext: RemoteSideContext? = null
</a><a href="#h6-0-23" id="h6-0-23" class="i">+): BroadcastReceiver() {
</a><a href="#h6-0-24" id="h6-0-24" class="i">+    companion object {
</a><a href="#h6-0-25" id="h6-0-25" class="i">+        private const val NOTIFICATION_CHANNEL_ID = &quot;streaks&quot;
</a><a href="#h6-0-26" id="h6-0-26" class="i">+    }
</a><a href="#h6-0-27" id="h6-0-27" class="i">+
</a><a href="#h6-0-28" id="h6-0-28" class="i">+    private val coroutineScope = CoroutineScope(Dispatchers.IO)
</a><a href="#h6-0-29" id="h6-0-29" class="i">+
</a><a href="#h6-0-30" id="h6-0-30" class="i">+    private fun getNotificationManager(context: Context) = context.getSystemService(NotificationManager::class.java).apply {
</a><a href="#h6-0-31" id="h6-0-31" class="i">+        createNotificationChannel(
</a><a href="#h6-0-32" id="h6-0-32" class="i">+            NotificationChannel(
</a><a href="#h6-0-33" id="h6-0-33" class="i">+                NOTIFICATION_CHANNEL_ID,
</a><a href="#h6-0-34" id="h6-0-34" class="i">+                &quot;Streaks&quot;,
</a><a href="#h6-0-35" id="h6-0-35" class="i">+                NotificationManager.IMPORTANCE_HIGH
</a><a href="#h6-0-36" id="h6-0-36" class="i">+            )
</a><a href="#h6-0-37" id="h6-0-37" class="i">+        )
</a><a href="#h6-0-38" id="h6-0-38" class="i">+    }
</a><a href="#h6-0-39" id="h6-0-39" class="i">+
</a><a href="#h6-0-40" id="h6-0-40" class="i">+    override fun onReceive(ctx: Context, intent: Intent) {
</a><a href="#h6-0-41" id="h6-0-41" class="i">+        val remoteSideContext = this.remoteSideContext ?: SharedContextHolder.remote(ctx)
</a><a href="#h6-0-42" id="h6-0-42" class="i">+        if (remoteSideContext.config.root.streaksReminder.globalState != true) return
</a><a href="#h6-0-43" id="h6-0-43" class="i">+
</a><a href="#h6-0-44" id="h6-0-44" class="i">+        val notifyFriendList = remoteSideContext.modDatabase.getFriends()
</a><a href="#h6-0-45" id="h6-0-45" class="i">+            .associateBy { remoteSideContext.modDatabase.getFriendStreaks(it.userId) }
</a><a href="#h6-0-46" id="h6-0-46" class="i">+            .filter { (streaks, _) -&gt; streaks != null &amp;&amp; streaks.notify &amp;&amp; streaks.isAboutToExpire() }
</a><a href="#h6-0-47" id="h6-0-47" class="i">+
</a><a href="#h6-0-48" id="h6-0-48" class="i">+        val notificationManager = getNotificationManager(ctx)
</a><a href="#h6-0-49" id="h6-0-49" class="i">+
</a><a href="#h6-0-50" id="h6-0-50" class="i">+        notifyFriendList.forEach { (streaks, friend) -&gt;
</a><a href="#h6-0-51" id="h6-0-51" class="i">+            coroutineScope.launch {
</a><a href="#h6-0-52" id="h6-0-52" class="i">+                val bitmojiUrl = BitmojiSelfie.getBitmojiSelfie(friend.selfieId, friend.bitmojiId, BitmojiSelfie.BitmojiSelfieType.THREE_D)
</a><a href="#h6-0-53" id="h6-0-53" class="i">+                val bitmojiImage = remoteSideContext.imageLoader.execute(
</a><a href="#h6-0-54" id="h6-0-54" class="i">+                    ImageRequestHelper.newBitmojiImageRequest(ctx, bitmojiUrl)
</a><a href="#h6-0-55" id="h6-0-55" class="i">+                )
</a><a href="#h6-0-56" id="h6-0-56" class="i">+
</a><a href="#h6-0-57" id="h6-0-57" class="i">+                val notificationBuilder = NotificationCompat.Builder(ctx, NOTIFICATION_CHANNEL_ID)
</a><a href="#h6-0-58" id="h6-0-58" class="i">+                    .setContentTitle(&quot;Streaks&quot;)
</a><a href="#h6-0-59" id="h6-0-59" class="i">+                    .setContentText(&quot;You will lose streaks with ${friend.displayName} in ${streaks?.hoursLeft() ?: 0} hours&quot;)
</a><a href="#h6-0-60" id="h6-0-60" class="i">+                    .setPriority(NotificationCompat.PRIORITY_DEFAULT)
</a><a href="#h6-0-61" id="h6-0-61" class="i">+                    .setContentIntent(PendingIntent.getActivity(
</a><a href="#h6-0-62" id="h6-0-62" class="i">+                        ctx,
</a><a href="#h6-0-63" id="h6-0-63" class="i">+                        0,
</a><a href="#h6-0-64" id="h6-0-64" class="i">+                        Intent(ctx, ForceStartActivity::class.java).apply {
</a><a href="#h6-0-65" id="h6-0-65" class="i">+                            putExtra(&quot;streaks_notification_action&quot;, true)
</a><a href="#h6-0-66" id="h6-0-66" class="i">+                        },
</a><a href="#h6-0-67" id="h6-0-67" class="i">+                        PendingIntent.FLAG_IMMUTABLE
</a><a href="#h6-0-68" id="h6-0-68" class="i">+                    ))
</a><a href="#h6-0-69" id="h6-0-69" class="i">+                    .apply {
</a><a href="#h6-0-70" id="h6-0-70" class="i">+                        bitmojiImage.drawable?.let {
</a><a href="#h6-0-71" id="h6-0-71" class="i">+                            setLargeIcon(it.toBitmap())
</a><a href="#h6-0-72" id="h6-0-72" class="i">+                            setSmallIcon(R.drawable.streak_icon)
</a><a href="#h6-0-73" id="h6-0-73" class="i">+                        }
</a><a href="#h6-0-74" id="h6-0-74" class="i">+                    }
</a><a href="#h6-0-75" id="h6-0-75" class="i">+
</a><a href="#h6-0-76" id="h6-0-76" class="i">+                notificationManager.notify(friend.userId.hashCode(), notificationBuilder.build().apply {
</a><a href="#h6-0-77" id="h6-0-77" class="i">+                    flags = NotificationCompat.FLAG_ONLY_ALERT_ONCE
</a><a href="#h6-0-78" id="h6-0-78" class="i">+                })
</a><a href="#h6-0-79" id="h6-0-79" class="i">+            }
</a><a href="#h6-0-80" id="h6-0-80" class="i">+        }
</a><a href="#h6-0-81" id="h6-0-81" class="i">+    }
</a><a href="#h6-0-82" id="h6-0-82" class="i">+
</a><a href="#h6-0-83" id="h6-0-83" class="i">+    //TODO: ask for notifications permission for a13+
</a><a href="#h6-0-84" id="h6-0-84" class="i">+    fun init() {
</a><a href="#h6-0-85" id="h6-0-85" class="i">+        if (remoteSideContext == null) throw IllegalStateException(&quot;RemoteSideContext is null&quot;)
</a><a href="#h6-0-86" id="h6-0-86" class="i">+        val reminderConfig = remoteSideContext.config.root.streaksReminder.also {
</a><a href="#h6-0-87" id="h6-0-87" class="i">+            if (it.globalState != true) return
</a><a href="#h6-0-88" id="h6-0-88" class="i">+        }
</a><a href="#h6-0-89" id="h6-0-89" class="i">+
</a><a href="#h6-0-90" id="h6-0-90" class="i">+        remoteSideContext.androidContext.getSystemService(AlarmManager::class.java).setRepeating(
</a><a href="#h6-0-91" id="h6-0-91" class="i">+            AlarmManager.RTC_WAKEUP, 5000, reminderConfig.interval.get().toLong() * 60 * 60 * 1000,
</a><a href="#h6-0-92" id="h6-0-92" class="i">+            PendingIntent.getBroadcast(remoteSideContext.androidContext, 0, Intent(remoteSideContext.androidContext, StreaksReminder::class.java),
</a><a href="#h6-0-93" id="h6-0-93" class="i">+                PendingIntent.FLAG_IMMUTABLE)
</a><a href="#h6-0-94" id="h6-0-94" class="i">+        )
</a><a href="#h6-0-95" id="h6-0-95" class="i">+
</a><a href="#h6-0-96" id="h6-0-96" class="i">+        onReceive(remoteSideContext.androidContext, Intent())
</a><a href="#h6-0-97" id="h6-0-97" class="i">+    }
</a><a href="#h6-0-98" id="h6-0-98" class="i">+
</a><a href="#h6-0-99" id="h6-0-99" class="i">+    fun dismissAllNotifications() = getNotificationManager(remoteSideContext!!.androidContext).cancelAll()
</a><a href="#h6-0-100" id="h6-0-100" class="i">+}</a><a href="#h6-0-101" id="h6-0-101" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/MainActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/MainActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/MainActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/MainActivity.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -10,21 +10,23 @@ import androidx.compose.runtime.remember
</a> import androidx.navigation.NavGraph.Companion.findStartDestination
 import androidx.navigation.NavHostController
 import androidx.navigation.compose.rememberNavController
<a href="#h7-0-3" id="h7-0-3" class="i">+import me.rhunk.snapenhance.RemoteSideContext
</a> import me.rhunk.snapenhance.SharedContextHolder
 import me.rhunk.snapenhance.ui.AppMaterialTheme
 
 class MainActivity : ComponentActivity() {
     private lateinit var sections: Map&lt;EnumSection, Section&gt;
     private lateinit var navController: NavHostController
<a href="#h7-0-10" id="h7-0-10" class="i">+    private lateinit var managerContext: RemoteSideContext
</a> 
     override fun onPostResume() {
         super.onPostResume()
         sections.values.forEach { it.onResumed() }
     }
 
<a href="#h7-0-17" id="h7-0-17" class="d">-    override fun onNewIntent(intent: Intent?) {
</a><a href="#h7-0-18" id="h7-0-18" class="i">+    override fun onNewIntent(intent: Intent) {
</a>         super.onNewIntent(intent)
<a href="#h7-0-20" id="h7-0-20" class="d">-        intent?.getStringExtra(&quot;route&quot;)?.let { route -&gt;
</a><a href="#h7-0-21" id="h7-0-21" class="i">+        intent.getStringExtra(&quot;route&quot;)?.let { route -&gt;
</a>             navController.popBackStack()
             navController.navigate(route) {
                 popUpTo(navController.graph.findStartDestination().id){
<a href="#h7-1" id="h7-1" class="h">@@ -38,7 +40,7 @@ class MainActivity : ComponentActivity() {
</a>         super.onCreate(savedInstanceState)
 
         val startDestination = intent.getStringExtra(&quot;route&quot;)?.let { EnumSection.fromRoute(it) } ?: EnumSection.HOME
<a href="#h7-1-3" id="h7-1-3" class="d">-        val managerContext = SharedContextHolder.remote(this).apply {
</a><a href="#h7-1-4" id="h7-1-4" class="i">+        managerContext = SharedContextHolder.remote(this).apply {
</a>             activity = this@MainActivity
             checkForRequirements()
         }
<b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -268,9 +268,9 @@ class FeaturesSection : Section() {
</a>                     navController.navigate(FEATURE_CONTAINER_ROUTE.replace(&quot;{name}&quot;, property.name))
                 }
 
<a href="#h8-0-3" id="h8-0-3" class="d">-                if (container.globalState == null) return
</a><a href="#h8-0-4" id="h8-0-4" class="i">+                if (!container.hasGlobalState) return
</a> 
<a href="#h8-0-6" id="h8-0-6" class="d">-                var state by remember { mutableStateOf(container.globalState!!) }
</a><a href="#h8-0-7" id="h8-0-7" class="i">+                var state by remember { mutableStateOf(container.globalState ?: false) }
</a> 
                 Box(
                     modifier = Modifier
<a href="#h8-1" id="h8-1" class="h">@@ -453,6 +453,22 @@ class FeaturesSection : Section() {
</a>         if (showSearchBar) return
 
         var showExportDropdownMenu by remember { mutableStateOf(false) }
<a href="#h8-1-3" id="h8-1-3" class="i">+        var showResetConfirmationDialog by remember { mutableStateOf(false) }
</a><a href="#h8-1-4" id="h8-1-4" class="i">+
</a><a href="#h8-1-5" id="h8-1-5" class="i">+        if (showResetConfirmationDialog) {
</a><a href="#h8-1-6" id="h8-1-6" class="i">+            Dialog(onDismissRequest = { showResetConfirmationDialog = false }) {
</a><a href="#h8-1-7" id="h8-1-7" class="i">+                alertDialogs.ConfirmDialog(
</a><a href="#h8-1-8" id="h8-1-8" class="i">+                    title = &quot;Reset config&quot;,
</a><a href="#h8-1-9" id="h8-1-9" class="i">+                    message = &quot;Are you sure you want to reset the config?&quot;,
</a><a href="#h8-1-10" id="h8-1-10" class="i">+                    onConfirm = {
</a><a href="#h8-1-11" id="h8-1-11" class="i">+                        context.config.reset()
</a><a href="#h8-1-12" id="h8-1-12" class="i">+                        context.shortToast(&quot;Config successfully reset!&quot;)
</a><a href="#h8-1-13" id="h8-1-13" class="i">+                    },
</a><a href="#h8-1-14" id="h8-1-14" class="i">+                    onDismiss = { showResetConfirmationDialog = false }
</a><a href="#h8-1-15" id="h8-1-15" class="i">+                )
</a><a href="#h8-1-16" id="h8-1-16" class="i">+            }
</a><a href="#h8-1-17" id="h8-1-17" class="i">+        }
</a><a href="#h8-1-18" id="h8-1-18" class="i">+
</a>         val actions = remember {
             mapOf(
                 &quot;Export&quot; to {
<a href="#h8-2" id="h8-2" class="h">@@ -477,10 +493,7 @@ class FeaturesSection : Section() {
</a>                         }
                     }
                 },
<a href="#h8-2-3" id="h8-2-3" class="d">-                &quot;Reset&quot; to {
</a><a href="#h8-2-4" id="h8-2-4" class="d">-                    context.config.reset()
</a><a href="#h8-2-5" id="h8-2-5" class="d">-                    context.shortToast(&quot;Config successfully reset!&quot;)
</a><a href="#h8-2-6" id="h8-2-6" class="d">-                }
</a><a href="#h8-2-7" id="h8-2-7" class="i">+                &quot;Reset&quot; to { showResetConfirmationDialog = true }
</a>             )
         }
 
<b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -14,6 +14,7 @@ import androidx.compose.material.icons.Icons
</a> import androidx.compose.material.icons.filled.Search
 import androidx.compose.material3.Card
 import androidx.compose.material3.CardDefaults
<a href="#h9-0-3" id="h9-0-3" class="i">+import androidx.compose.material3.Checkbox
</a> import androidx.compose.material3.CircularProgressIndicator
 import androidx.compose.material3.Icon
 import androidx.compose.material3.MaterialTheme
<a href="#h9-1" id="h9-1" class="h">@@ -29,6 +30,7 @@ import androidx.compose.runtime.rememberCoroutineScope
</a> import androidx.compose.runtime.setValue
 import androidx.compose.ui.Alignment
 import androidx.compose.ui.Modifier
<a href="#h9-1-3" id="h9-1-3" class="i">+import androidx.compose.ui.layout.onGloballyPositioned
</a> import androidx.compose.ui.text.font.FontWeight
 import androidx.compose.ui.text.input.ImeAction
 import androidx.compose.ui.text.input.KeyboardType
<a href="#h9-2" id="h9-2" class="h">@@ -53,31 +55,34 @@ class AddFriendDialog(
</a>     private val section: SocialSection,
 ) {
     @Composable
<a href="#h9-2-3" id="h9-2-3" class="d">-    private fun ListCardEntry(name: String, exists: Boolean, stateChanged: (state: Boolean) -&gt; Unit = { }) {
</a><a href="#h9-2-4" id="h9-2-4" class="d">-        var state by remember { mutableStateOf(exists) }
</a><a href="#h9-2-5" id="h9-2-5" class="i">+    private fun ListCardEntry(name: String, currentState: () -&gt; Boolean, onState: (Boolean) -&gt; Unit = {}) {
</a><a href="#h9-2-6" id="h9-2-6" class="i">+        var currentState by remember { mutableStateOf(currentState()) }
</a> 
         Row(
             modifier = Modifier
                 .fillMaxWidth()
                 .clickable {
<a href="#h9-2-12" id="h9-2-12" class="d">-                    state = !state
</a><a href="#h9-2-13" id="h9-2-13" class="d">-                    stateChanged(state)
</a><a href="#h9-2-14" id="h9-2-14" class="i">+                    currentState = !currentState
</a><a href="#h9-2-15" id="h9-2-15" class="i">+                    onState(currentState)
</a>                 }
                 .padding(4.dp),
<a href="#h9-2-18" id="h9-2-18" class="d">-            verticalAlignment = androidx.compose.ui.Alignment.CenterVertically
</a><a href="#h9-2-19" id="h9-2-19" class="i">+            verticalAlignment = Alignment.CenterVertically
</a>         ) {
             Text(
                 text = name,
                 fontSize = 15.sp,
                 modifier = Modifier
                     .weight(1f)
<a href="#h9-2-26" id="h9-2-26" class="i">+                    .onGloballyPositioned {
</a><a href="#h9-2-27" id="h9-2-27" class="i">+                        currentState = currentState()
</a><a href="#h9-2-28" id="h9-2-28" class="i">+                    }
</a>             )
 
<a href="#h9-2-31" id="h9-2-31" class="d">-            androidx.compose.material3.Checkbox(
</a><a href="#h9-2-32" id="h9-2-32" class="d">-                checked = state,
</a><a href="#h9-2-33" id="h9-2-33" class="i">+            Checkbox(
</a><a href="#h9-2-34" id="h9-2-34" class="i">+                checked = currentState,
</a>                 onCheckedChange = {
<a href="#h9-2-36" id="h9-2-36" class="d">-                    state = it
</a><a href="#h9-2-37" id="h9-2-37" class="d">-                    stateChanged(state)
</a><a href="#h9-2-38" id="h9-2-38" class="i">+                    currentState = it
</a><a href="#h9-2-39" id="h9-2-39" class="i">+                    onState(currentState)
</a>                 }
             )
         }
<a href="#h9-3" id="h9-3" class="h">@@ -227,13 +232,12 @@ class AddFriendDialog(
</a> 
                     items(filteredGroups.size) {
                         val group = filteredGroups[it]
<a href="#h9-3-3" id="h9-3-3" class="d">-
</a>                         ListCardEntry(
                             name = group.name,
<a href="#h9-3-6" id="h9-3-6" class="d">-                            exists = remember { context.modDatabase.getGroupInfo(group.conversationId) != null }
</a><a href="#h9-3-7" id="h9-3-7" class="i">+                            currentState = { context.modDatabase.getGroupInfo(group.conversationId) != null }
</a>                         ) { state -&gt;
                             if (state) {
<a href="#h9-3-10" id="h9-3-10" class="d">-                                context.bridgeService.triggerGroupSync(cachedGroups!![it].conversationId)
</a><a href="#h9-3-11" id="h9-3-11" class="i">+                                context.bridgeService.triggerGroupSync(group.conversationId)
</a>                             } else {
                                 context.modDatabase.deleteGroup(group.conversationId)
                             }
<a href="#h9-4" id="h9-4" class="h">@@ -257,10 +261,10 @@ class AddFriendDialog(
</a> 
                         ListCardEntry(
                             name = friend.displayName?.takeIf { name -&gt; name.isNotBlank() } ?: friend.mutableUsername,
<a href="#h9-4-3" id="h9-4-3" class="d">-                            exists = remember { context.modDatabase.getFriendInfo(friend.userId) != null }
</a><a href="#h9-4-4" id="h9-4-4" class="i">+                            currentState = { context.modDatabase.getFriendInfo(friend.userId) != null }
</a>                         ) { state -&gt;
                             if (state) {
<a href="#h9-4-7" id="h9-4-7" class="d">-                                context.bridgeService.triggerFriendSync(cachedFriends!![it].userId)
</a><a href="#h9-4-8" id="h9-4-8" class="i">+                                context.bridgeService.triggerFriendSync(friend.userId)
</a>                             } else {
                                 context.modDatabase.deleteFriend(friend.userId)
                             }
<b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeContent.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeContent.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeContent.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/ScopeContent.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -177,14 +177,11 @@ class ScopeContent(
</a>                 .fillMaxWidth(),
             horizontalAlignment = Alignment.CenterHorizontally
         ) {
<a href="#h10-0-3" id="h10-0-3" class="d">-            val bitmojiUrl = (friend.selfieId to friend.bitmojiId).let { (selfieId, bitmojiId) -&gt;
</a><a href="#h10-0-4" id="h10-0-4" class="d">-                if (selfieId == null || bitmojiId == null) return@let null
</a><a href="#h10-0-5" id="h10-0-5" class="d">-                BitmojiSelfie.getBitmojiSelfie(
</a><a href="#h10-0-6" id="h10-0-6" class="d">-                    selfieId,
</a><a href="#h10-0-7" id="h10-0-7" class="d">-                    bitmojiId,
</a><a href="#h10-0-8" id="h10-0-8" class="d">-                    BitmojiSelfie.BitmojiSelfieType.THREE_D
</a><a href="#h10-0-9" id="h10-0-9" class="d">-                )
</a><a href="#h10-0-10" id="h10-0-10" class="d">-            }
</a><a href="#h10-0-11" id="h10-0-11" class="i">+            val bitmojiUrl = BitmojiSelfie.getBitmojiSelfie(
</a><a href="#h10-0-12" id="h10-0-12" class="i">+                friend.selfieId,
</a><a href="#h10-0-13" id="h10-0-13" class="i">+                friend.bitmojiId,
</a><a href="#h10-0-14" id="h10-0-14" class="i">+                BitmojiSelfie.BitmojiSelfieType.THREE_D
</a><a href="#h10-0-15" id="h10-0-15" class="i">+            )
</a>             BitmojiImage(context = context, url = bitmojiUrl, size = 100)
             Spacer(modifier = Modifier.height(16.dp))
             Text(
<a href="#h10-1" id="h10-1" class="h">@@ -218,13 +215,13 @@ class ScopeContent(
</a>                         Column(
                             modifier = Modifier.weight(1f),
                         ) {
<a href="#h10-1-3" id="h10-1-3" class="d">-                            Text(text = &quot;Count: ${streaks.length}&quot;, maxLines = 1)
</a><a href="#h10-1-4" id="h10-1-4" class="i">+                            Text(text = &quot;Length: ${streaks.length}&quot;, maxLines = 1)
</a>                             Text(text = &quot;Expires in: ${computeStreakETA(streaks.expirationTimestamp)}&quot;, maxLines = 1)
                         }
                         Row(
                             verticalAlignment = Alignment.CenterVertically
                         ) {
<a href="#h10-1-10" id="h10-1-10" class="d">-                            Text(text = &quot;Notify Expiration&quot;, maxLines = 1)
</a><a href="#h10-1-11" id="h10-1-11" class="i">+                            Text(text = &quot;Reminder&quot;, maxLines = 1, modifier = Modifier.padding(end = 10.dp))
</a>                             Switch(checked = shouldNotify, onCheckedChange = {
                                 context.modDatabase.setFriendStreaksNotify(id, it)
                                 shouldNotify = it
<b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -18,7 +18,6 @@ import androidx.compose.material.icons.Icons
</a> import androidx.compose.material.icons.rounded.Add
 import androidx.compose.material.icons.rounded.DeleteForever
 import androidx.compose.material3.Card
<a href="#h11-0-3" id="h11-0-3" class="d">-import androidx.compose.material3.ExperimentalMaterial3Api
</a> import androidx.compose.material3.FloatingActionButton
 import androidx.compose.material3.Icon
 import androidx.compose.material3.IconButton
<a href="#h11-1" id="h11-1" class="h">@@ -36,6 +35,8 @@ import androidx.compose.runtime.rememberCoroutineScope
</a> import androidx.compose.runtime.setValue
 import androidx.compose.ui.Alignment
 import androidx.compose.ui.Modifier
<a href="#h11-1-3" id="h11-1-3" class="i">+import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h11-1-4" id="h11-1-4" class="i">+import androidx.compose.ui.res.vectorResource
</a> import androidx.compose.ui.text.font.FontWeight
 import androidx.compose.ui.text.style.TextOverflow
 import androidx.compose.ui.unit.dp
<a href="#h11-2" id="h11-2" class="h">@@ -45,6 +46,7 @@ import androidx.navigation.NavGraphBuilder
</a> import androidx.navigation.compose.composable
 import androidx.navigation.navigation
 import kotlinx.coroutines.launch
<a href="#h11-2-3" id="h11-2-3" class="i">+import me.rhunk.snapenhance.R
</a> import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
 import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
 import me.rhunk.snapenhance.core.messaging.SocialScope
<a href="#h11-3" id="h11-3" class="h">@@ -175,24 +177,41 @@ class SocialSection : Section() {
</a>                         }
                         SocialScope.FRIEND -&gt; {
                             val friend = friendList[index]
<a href="#h11-3-3" id="h11-3-3" class="i">+                            val streaks = remember { context.modDatabase.getFriendStreaks(friend.userId) }
</a><a href="#h11-3-4" id="h11-3-4" class="i">+
</a>                             Row(
                                 modifier = Modifier
                                     .padding(10.dp)
                                     .fillMaxSize(),
                                 verticalAlignment = Alignment.CenterVertically
                             ) {
<a href="#h11-3-11" id="h11-3-11" class="d">-                                val bitmojiUrl = (friend.selfieId to friend.bitmojiId).let { (selfieId, bitmojiId) -&gt;
</a><a href="#h11-3-12" id="h11-3-12" class="d">-                                    if (selfieId == null || bitmojiId == null) return@let null
</a><a href="#h11-3-13" id="h11-3-13" class="d">-                                    BitmojiSelfie.getBitmojiSelfie(selfieId, bitmojiId, BitmojiSelfie.BitmojiSelfieType.THREE_D)
</a><a href="#h11-3-14" id="h11-3-14" class="d">-                                }
</a><a href="#h11-3-15" id="h11-3-15" class="d">-                                BitmojiImage(context = context, url = bitmojiUrl)
</a><a href="#h11-3-16" id="h11-3-16" class="i">+                                BitmojiImage(
</a><a href="#h11-3-17" id="h11-3-17" class="i">+                                    context = context,
</a><a href="#h11-3-18" id="h11-3-18" class="i">+                                    url = BitmojiSelfie.getBitmojiSelfie(friend.selfieId, friend.bitmojiId, BitmojiSelfie.BitmojiSelfieType.THREE_D)
</a><a href="#h11-3-19" id="h11-3-19" class="i">+                                )
</a>                                 Column(
                                     modifier = Modifier
                                         .padding(10.dp)
                                         .fillMaxWidth()
<a href="#h11-3-24" id="h11-3-24" class="i">+                                        .weight(1f)
</a>                                 ) {
                                     Text(text = friend.displayName ?: friend.mutableUsername, maxLines = 1, fontWeight = FontWeight.Bold)
<a href="#h11-3-27" id="h11-3-27" class="d">-                                    Text(text = friend.userId, maxLines = 1, fontSize = 12.sp)
</a><a href="#h11-3-28" id="h11-3-28" class="i">+                                    Text(text = friend.mutableUsername, maxLines = 1, fontSize = 12.sp, fontWeight = FontWeight.Light)
</a><a href="#h11-3-29" id="h11-3-29" class="i">+                                }
</a><a href="#h11-3-30" id="h11-3-30" class="i">+                                Row(
</a><a href="#h11-3-31" id="h11-3-31" class="i">+                                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h11-3-32" id="h11-3-32" class="i">+                                ) {
</a><a href="#h11-3-33" id="h11-3-33" class="i">+                                    if (streaks != null &amp;&amp; streaks.notify) {
</a><a href="#h11-3-34" id="h11-3-34" class="i">+                                        Icon(
</a><a href="#h11-3-35" id="h11-3-35" class="i">+                                            imageVector = ImageVector.vectorResource(id = R.drawable.streak_icon),
</a><a href="#h11-3-36" id="h11-3-36" class="i">+                                            contentDescription = null,
</a><a href="#h11-3-37" id="h11-3-37" class="i">+                                            modifier = Modifier.height(40.dp),
</a><a href="#h11-3-38" id="h11-3-38" class="i">+                                            tint = if (streaks.isAboutToExpire())
</a><a href="#h11-3-39" id="h11-3-39" class="i">+                                                MaterialTheme.colorScheme.error
</a><a href="#h11-3-40" id="h11-3-40" class="i">+                                            else MaterialTheme.colorScheme.primary
</a><a href="#h11-3-41" id="h11-3-41" class="i">+                                        )
</a><a href="#h11-3-42" id="h11-3-42" class="i">+                                        Text(text = &quot;${streaks.hoursLeft()}h&quot;, maxLines = 1, fontWeight = FontWeight.Bold)
</a><a href="#h11-3-43" id="h11-3-43" class="i">+                                    }
</a>                                 }
                             }
                         }
<b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -28,9 +28,11 @@ import androidx.compose.ui.focus.FocusRequester
</a> import androidx.compose.ui.focus.focusRequester
 import androidx.compose.ui.layout.onGloballyPositioned
 import androidx.compose.ui.text.TextRange
<a href="#h12-0-3" id="h12-0-3" class="i">+import androidx.compose.ui.text.font.FontWeight
</a> import androidx.compose.ui.text.input.KeyboardType
 import androidx.compose.ui.text.input.TextFieldValue
 import androidx.compose.ui.unit.dp
<a href="#h12-0-7" id="h12-0-7" class="i">+import androidx.compose.ui.unit.sp
</a> import me.rhunk.snapenhance.bridge.wrapper.LocaleWrapper
 import me.rhunk.snapenhance.core.config.DataProcessors
 import me.rhunk.snapenhance.core.config.PropertyPair
<a href="#h12-1" id="h12-1" class="h">@@ -57,21 +59,22 @@ class AlertDialogs(
</a>     @Composable
     fun ConfirmDialog(
         title: String,
<a href="#h12-1-3" id="h12-1-3" class="d">-        data: String? = null,
</a><a href="#h12-1-4" id="h12-1-4" class="i">+        message: String? = null,
</a>         onConfirm: () -&gt; Unit,
         onDismiss: () -&gt; Unit,
     ) {
         DefaultDialogCard {
             Text(
                 text = title,
<a href="#h12-1-11" id="h12-1-11" class="d">-                style = MaterialTheme.typography.bodyLarge,
</a><a href="#h12-1-12" id="h12-1-12" class="d">-                modifier = Modifier.padding(bottom = 10.dp)
</a><a href="#h12-1-13" id="h12-1-13" class="i">+                fontSize = 20.sp,
</a><a href="#h12-1-14" id="h12-1-14" class="i">+                fontWeight = FontWeight.Bold,
</a><a href="#h12-1-15" id="h12-1-15" class="i">+                modifier = Modifier.padding(start = 5.dp, bottom = 10.dp)
</a>             )
<a href="#h12-1-17" id="h12-1-17" class="d">-            if (data != null) {
</a><a href="#h12-1-18" id="h12-1-18" class="i">+            if (message != null) {
</a>                 Text(
<a href="#h12-1-20" id="h12-1-20" class="d">-                    text = data,
</a><a href="#h12-1-21" id="h12-1-21" class="i">+                    text = message,
</a>                     style = MaterialTheme.typography.bodyMedium,
<a href="#h12-1-23" id="h12-1-23" class="d">-                    modifier = Modifier.padding(bottom = 10.dp)
</a><a href="#h12-1-24" id="h12-1-24" class="i">+                    modifier = Modifier.padding(bottom = 15.dp)
</a>                 )
             }
             Row(
<a href="#h12-2" id="h12-2" class="h">@@ -91,20 +94,21 @@ class AlertDialogs(
</a>     @Composable
     fun InfoDialog(
         title: String,
<a href="#h12-2-3" id="h12-2-3" class="d">-        data: String? = null,
</a><a href="#h12-2-4" id="h12-2-4" class="i">+        message: String? = null,
</a>         onDismiss: () -&gt; Unit,
     ) {
         DefaultDialogCard {
             Text(
                 text = title,
<a href="#h12-2-10" id="h12-2-10" class="d">-                style = MaterialTheme.typography.bodyLarge,
</a><a href="#h12-2-11" id="h12-2-11" class="d">-                modifier = Modifier.padding(bottom = 10.dp)
</a><a href="#h12-2-12" id="h12-2-12" class="i">+                fontSize = 20.sp,
</a><a href="#h12-2-13" id="h12-2-13" class="i">+                fontWeight = FontWeight.Bold,
</a><a href="#h12-2-14" id="h12-2-14" class="i">+                modifier = Modifier.padding(start = 5.dp, bottom = 10.dp)
</a>             )
<a href="#h12-2-16" id="h12-2-16" class="d">-            if (data != null) {
</a><a href="#h12-2-17" id="h12-2-17" class="i">+            if (message != null) {
</a>                 Text(
<a href="#h12-2-19" id="h12-2-19" class="d">-                    text = data,
</a><a href="#h12-2-20" id="h12-2-20" class="i">+                    text = message,
</a>                     style = MaterialTheme.typography.bodyMedium,
<a href="#h12-2-22" id="h12-2-22" class="d">-                    modifier = Modifier.padding(bottom = 10.dp)
</a><a href="#h12-2-23" id="h12-2-23" class="i">+                    modifier = Modifier.padding(bottom = 15.dp)
</a>                 )
             }
             Row(
<b>diff --git a/<a id="h13" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ComposeImageHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ComposeImageHelper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ComposeImageHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ComposeImageHelper.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -36,18 +36,23 @@ fun BitmojiImage(context: RemoteSideContext, modifier: Modifier = Modifier, size
</a>     )
 }
 
<a href="#h13-0-3" id="h13-0-3" class="i">+fun ImageRequest.Builder.cacheKey(key: String?) = apply {
</a><a href="#h13-0-4" id="h13-0-4" class="i">+    memoryCacheKey(key)
</a><a href="#h13-0-5" id="h13-0-5" class="i">+    diskCacheKey(key)
</a><a href="#h13-0-6" id="h13-0-6" class="i">+}
</a><a href="#h13-0-7" id="h13-0-7" class="i">+
</a> object ImageRequestHelper {
     fun newBitmojiImageRequest(context: Context, url: String?) = ImageRequest.Builder(context)
         .data(url)
         .fallback(R.drawable.bitmoji_blank)
         .precision(Precision.INEXACT)
         .crossfade(true)
<a href="#h13-0-14" id="h13-0-14" class="d">-        .memoryCacheKey(url)
</a><a href="#h13-0-15" id="h13-0-15" class="i">+        .cacheKey(url)
</a>         .build()
 
     fun newDownloadPreviewImageRequest(context: Context, filePath: String?) = ImageRequest.Builder(context)
         .data(filePath)
<a href="#h13-0-20" id="h13-0-20" class="d">-        .memoryCacheKey(filePath)
</a><a href="#h13-0-21" id="h13-0-21" class="i">+        .cacheKey(filePath)
</a>         .crossfade(true)
         .build()
 } 
\ No newline at end of file
<b>diff --git a/<a id="h14" href="../file/app/src/main/res/drawable/streak_icon.xml.html">app/src/main/res/drawable/streak_icon.xml</a> b/<a href="../file/app/src/main/res/drawable/streak_icon.xml.html">app/src/main/res/drawable/streak_icon.xml</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,11 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
</a><a href="#h14-0-1" id="h14-0-1" class="i">+    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
</a><a href="#h14-0-2" id="h14-0-2" class="i">+    android:width=&quot;48dp&quot;
</a><a href="#h14-0-3" id="h14-0-3" class="i">+    android:height=&quot;48dp&quot;
</a><a href="#h14-0-4" id="h14-0-4" class="i">+    android:viewportWidth=&quot;960&quot;
</a><a href="#h14-0-5" id="h14-0-5" class="i">+    android:viewportHeight=&quot;960&quot;&gt;
</a><a href="#h14-0-6" id="h14-0-6" class="i">+  &lt;path
</a><a href="#h14-0-7" id="h14-0-7" class="i">+      android:fillColor=&quot;#FF000000&quot;
</a><a href="#h14-0-8" id="h14-0-8" class="i">+      android:pathData=&quot;M224.78,560q0,59.18 26.11,111.45 26.11,52.27 73.28,87.6 -4,-10.99 -6,-22.68 -2,-11.69 -2,-22.97 1.2,-30.8 13.31,-57.61 12.12,-26.8 34.4,-49.09L480,492.35l116.35,114.35q22.28,22.28 34.4,49.09 12.12,26.81 13.08,57.61 0,11.28 -2,22.97 -2,11.69 -5.76,22.68 46.7,-35.33 73.04,-87.6Q735.46,619.18 735.46,560q0,-52.09 -22.07,-102.06 -22.07,-49.97 -63.35,-91.96 -21,14.28 -43.84,22.42 -22.84,8.14 -45.21,8.14 -60.27,0 -100.63,-39.95Q420,316.65 417.37,254.61v-20q-44.36,32.26 -79.91,71.32 -35.55,39.05 -60.59,81.36 -25.04,42.3 -38.57,86.61 -13.52,44.31 -13.52,86.11ZM480,587.83l-68.31,67.56q-13.82,13.57 -20.96,29.92 -7.14,16.34 -7.14,35.64 0,39.5 28.09,66.89 28.09,27.38 68.37,27.38 40.28,0 68.33,-27.44 28.04,-27.44 28.04,-66.97 0,-19.05 -7.13,-35.4 -7.13,-16.35 -20.63,-29.93L480,587.83ZM483.59,114.26L483.59,252q0,32.48 22.45,54.44 22.45,21.97 54.94,21.97 17.21,0 32.04,-7.14 14.83,-7.14 26.35,-21.66l19.67,-24.39q76.21,43.41 120.38,119.74 44.17,76.33 44.17,164.97 0,135.53 -94.05,229.59 -94.05,94.06 -229.56,94.06 -135.51,0 -229.54,-94.04 -94.03,-94.04 -94.03,-229.55 0,-129.19 87.79,-249.61Q332,189.98 483.59,114.26Z&quot;
</a><a href="#h14-0-9" id="h14-0-9" class="i">+      tools:ignore=&quot;VectorPath&quot; /&gt;
</a><a href="#h14-0-10" id="h14-0-10" class="i">+&lt;/vector&gt;
</a><b>diff --git a/<a id="h15" href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a> b/<a href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -309,6 +309,16 @@
</a>                     }
                 }
             },
<a href="#h15-0-3" id="h15-0-3" class="i">+            &quot;streaks_reminder&quot;: {
</a><a href="#h15-0-4" id="h15-0-4" class="i">+                &quot;name&quot;: &quot;Streaks Reminder&quot;,
</a><a href="#h15-0-5" id="h15-0-5" class="i">+                &quot;description&quot;: &quot;Reminds you to keep your streaks&quot;,
</a><a href="#h15-0-6" id="h15-0-6" class="i">+                &quot;properties&quot;: {
</a><a href="#h15-0-7" id="h15-0-7" class="i">+                    &quot;interval&quot;: {
</a><a href="#h15-0-8" id="h15-0-8" class="i">+                        &quot;name&quot;: &quot;Interval&quot;,
</a><a href="#h15-0-9" id="h15-0-9" class="i">+                        &quot;description&quot;: &quot;The interval between each reminder (in hours)&quot;
</a><a href="#h15-0-10" id="h15-0-10" class="i">+                    }
</a><a href="#h15-0-11" id="h15-0-11" class="i">+                }
</a><a href="#h15-0-12" id="h15-0-12" class="i">+            },
</a>             &quot;experimental&quot;: {
                 &quot;name&quot;: &quot;Experimental&quot;,
                 &quot;description&quot;: &quot;Experimental features&quot;,
<b>diff --git a/<a id="h16" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -35,14 +35,14 @@ class BridgeClient(
</a>     fun start(callback: (Boolean) -&gt; Unit) {
         this.future = CompletableFuture()
 
<a href="#h16-0-3" id="h16-0-3" class="i">+        //TODO: randomize package name
</a>         with(context.androidContext) {
             //ensure the remote process is running
             startActivity(Intent()
<a href="#h16-0-7" id="h16-0-7" class="d">-                .setClassName(BuildConfig.APPLICATION_ID, ForceStartActivity::class.java.name)
</a><a href="#h16-0-8" id="h16-0-8" class="i">+                .setClassName(BuildConfig.APPLICATION_ID, &quot;me.rhunk.snapenhance.bridge.ForceStartActivity&quot;)
</a>                 .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_MULTIPLE_TASK)
             )
 
<a href="#h16-0-12" id="h16-0-12" class="d">-            //TODO: randomize package name
</a>             val intent = Intent()
                 .setClassName(BuildConfig.APPLICATION_ID, &quot;me.rhunk.snapenhance.bridge.BridgeService&quot;)
             if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) {
<b>diff --git a/<a id="h17" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -1,11 +0,0 @@
</a><a href="#h17-0-0" id="h17-0-0" class="d">-package me.rhunk.snapenhance.bridge
</a><a href="#h17-0-1" id="h17-0-1" class="d">-
</a><a href="#h17-0-2" id="h17-0-2" class="d">-import android.app.Activity
</a><a href="#h17-0-3" id="h17-0-3" class="d">-import android.os.Bundle
</a><a href="#h17-0-4" id="h17-0-4" class="d">-
</a><a href="#h17-0-5" id="h17-0-5" class="d">-class ForceStartActivity : Activity() {
</a><a href="#h17-0-6" id="h17-0-6" class="d">-    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h17-0-7" id="h17-0-7" class="d">-        super.onCreate(savedInstanceState)
</a><a href="#h17-0-8" id="h17-0-8" class="d">-        finish()
</a><a href="#h17-0-9" id="h17-0-9" class="d">-    }
</a><a href="#h17-0-10" id="h17-0-10" class="d">-}</a><a href="#h17-0-11" id="h17-0-11" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -6,10 +6,11 @@ import kotlin.reflect.KProperty
</a> typealias ConfigParamsBuilder = ConfigParams.() -&gt; Unit
 
 open class ConfigContainer(
<a href="#h18-0-3" id="h18-0-3" class="d">-    var globalState: Boolean? = null
</a><a href="#h18-0-4" id="h18-0-4" class="i">+    val hasGlobalState: Boolean = false
</a> ) {
     var parentContainerKey: PropertyKey&lt;*&gt;? = null
     val properties = mutableMapOf&lt;PropertyKey&lt;*&gt;, PropertyValue&lt;*&gt;&gt;()
<a href="#h18-0-8" id="h18-0-8" class="i">+    var globalState: Boolean? = null
</a> 
     private inline fun &lt;T&gt; registerProperty(
         key: String,
<b>diff --git a/<a id="h19" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -13,6 +13,8 @@ class Global : ConfigContainer() {
</a>     val disableGooglePlayDialogs = boolean(&quot;disable_google_play_dialogs&quot;)
     val forceMediaSourceQuality = boolean(&quot;force_media_source_quality&quot;)
     val betterNotifications = multiple(&quot;better_notifications&quot;, &quot;snap&quot;, &quot;chat&quot;, &quot;reply_button&quot;, &quot;download_button&quot;)
<a href="#h19-0-3" id="h19-0-3" class="d">-    val notificationBlacklist = multiple(&quot;notification_blacklist&quot;, *NotificationType.getIncomingValues().map { it.key }.toTypedArray())
</a><a href="#h19-0-4" id="h19-0-4" class="i">+    val notificationBlacklist = multiple(&quot;notification_blacklist&quot;, *NotificationType.getIncomingValues().map { it.key }.toTypedArray()) {
</a><a href="#h19-0-5" id="h19-0-5" class="i">+        customOptionTranslationPath = &quot;features.options.notifications&quot;
</a><a href="#h19-0-6" id="h19-0-6" class="i">+    }
</a>     val disableSnapSplitting = boolean(&quot;disable_snap_splitting&quot;) { addNotices(FeatureNotice.MAY_BREAK_INTERNAL_BEHAVIOR) }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h20" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -16,7 +16,9 @@ class MessagingTweaks : ConfigContainer() {
</a>         &quot;EXTERNAL_MEDIA&quot;,
         &quot;STICKER&quot;
     )
<a href="#h20-0-3" id="h20-0-3" class="d">-    val preventMessageSending = multiple(&quot;prevent_message_sending&quot;, *NotificationType.getOutgoingValues().map { it.key }.toTypedArray())
</a><a href="#h20-0-4" id="h20-0-4" class="i">+    val preventMessageSending = multiple(&quot;prevent_message_sending&quot;, *NotificationType.getOutgoingValues().map { it.key }.toTypedArray()) {
</a><a href="#h20-0-5" id="h20-0-5" class="i">+        customOptionTranslationPath = &quot;features.options.notifications&quot;
</a><a href="#h20-0-6" id="h20-0-6" class="i">+    }
</a>     val messageLogger = boolean(&quot;message_logger&quot;) { addNotices(FeatureNotice.MAY_CAUSE_CRASHES) }
     val galleryMediaSendOverride = boolean(&quot;gallery_media_send_override&quot;)
     val messagePreviewLength = integer(&quot;message_preview_length&quot;, defaultValue = 20)
<b>diff --git a/<a id="h21" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -9,6 +9,7 @@ class RootConfig : ConfigContainer() {
</a>     val global = container(&quot;global&quot;, Global()) { icon = &quot;MiscellaneousServices&quot; }
     val rules = container(&quot;rules&quot;, Rules()) { icon = &quot;Rule&quot; }
     val camera = container(&quot;camera&quot;, Camera()) { icon = &quot;Camera&quot;}
<a href="#h21-0-3" id="h21-0-3" class="i">+    val streaksReminder = container(&quot;streaks_reminder&quot;, StreaksReminderConfig()) { icon = &quot;Alarm&quot; }
</a>     val experimental = container(&quot;experimental&quot;, Experimental()) { icon = &quot;Science&quot; }
     val spoof = container(&quot;spoof&quot;, Spoof()) { icon = &quot;Fingerprint&quot; }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h22" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -3,13 +3,13 @@ package me.rhunk.snapenhance.core.config.impl
</a> import me.rhunk.snapenhance.core.config.ConfigContainer
 
 class Spoof : ConfigContainer() {
<a href="#h22-0-3" id="h22-0-3" class="d">-    inner class Location : ConfigContainer(globalState = false) {
</a><a href="#h22-0-4" id="h22-0-4" class="i">+    inner class Location : ConfigContainer(hasGlobalState = true) {
</a>         val latitude = float(&quot;location_latitude&quot;)
         val longitude = float(&quot;location_longitude&quot;)
     }
     val location = container(&quot;location&quot;, Location())
 
<a href="#h22-0-10" id="h22-0-10" class="d">-    inner class Device : ConfigContainer(globalState = false) {
</a><a href="#h22-0-11" id="h22-0-11" class="i">+    inner class Device : ConfigContainer(hasGlobalState = true) {
</a>         val fingerprint = string(&quot;device_fingerprint&quot;)
         val androidId = string(&quot;device_android_id&quot;)
     }
<b>diff --git a/<a id="h23" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/StreaksReminderConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/StreaksReminderConfig.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/StreaksReminderConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/StreaksReminderConfig.kt</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h23-0-0" id="h23-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h23-0-1" id="h23-0-1" class="i">+
</a><a href="#h23-0-2" id="h23-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h23-0-3" id="h23-0-3" class="i">+
</a><a href="#h23-0-4" id="h23-0-4" class="i">+class StreaksReminderConfig : ConfigContainer(hasGlobalState = true) {
</a><a href="#h23-0-5" id="h23-0-5" class="i">+    val interval = integer(&quot;interval&quot;, 2)
</a><a href="#h23-0-6" id="h23-0-6" class="i">+}</a><a href="#h23-0-7" id="h23-0-7" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h24" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -1,6 +1,7 @@
</a> package me.rhunk.snapenhance.core.messaging
 
 import me.rhunk.snapenhance.util.SerializableDataObject
<a href="#h24-0-3" id="h24-0-3" class="i">+import kotlin.time.Duration.Companion.hours
</a> 
 
 enum class RuleState(
<a href="#h24-1" id="h24-1" class="h">@@ -45,8 +46,16 @@ data class FriendStreaks(
</a>     val notify: Boolean,
     val expirationTimestamp: Long,
     val length: Int
<a href="#h24-1-3" id="h24-1-3" class="d">-) : SerializableDataObject()
</a><a href="#h24-1-4" id="h24-1-4" class="i">+) : SerializableDataObject() {
</a><a href="#h24-1-5" id="h24-1-5" class="i">+    companion object {
</a><a href="#h24-1-6" id="h24-1-6" class="i">+        //TODO: config
</a><a href="#h24-1-7" id="h24-1-7" class="i">+        val EXPIRE_THRESHOLD = 12.hours
</a><a href="#h24-1-8" id="h24-1-8" class="i">+    }
</a> 
<a href="#h24-1-10" id="h24-1-10" class="i">+    fun hoursLeft() = (expirationTimestamp - System.currentTimeMillis()) / 1000 / 60 / 60
</a><a href="#h24-1-11" id="h24-1-11" class="i">+
</a><a href="#h24-1-12" id="h24-1-12" class="i">+    fun isAboutToExpire() = expirationTimestamp - System.currentTimeMillis() &lt; EXPIRE_THRESHOLD.inWholeMilliseconds
</a><a href="#h24-1-13" id="h24-1-13" class="i">+}
</a> 
 data class MessagingGroupInfo(
     val conversationId: String,
<b>diff --git a/<a id="h25" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -61,11 +61,7 @@ class MediaDownloader : MessagingRuleFeature(&quot;MediaDownloader&quot;, MessagingRuleTyp
</a>     ): DownloadManagerClient {
         val generatedHash = mediaIdentifier.hashCode().toString(16).replaceFirst(&quot;-&quot;, &quot;&quot;)
 
<a href="#h25-0-3" id="h25-0-3" class="d">-        val iconUrl = friendInfo?.takeIf {
</a><a href="#h25-0-4" id="h25-0-4" class="d">-            it.bitmojiAvatarId != null &amp;&amp; it.bitmojiSelfieId != null
</a><a href="#h25-0-5" id="h25-0-5" class="d">-        }?.let {
</a><a href="#h25-0-6" id="h25-0-6" class="d">-            BitmojiSelfie.getBitmojiSelfie(it.bitmojiSelfieId!!, it.bitmojiAvatarId!!, BitmojiSelfie.BitmojiSelfieType.THREE_D)
</a><a href="#h25-0-7" id="h25-0-7" class="d">-        }
</a><a href="#h25-0-8" id="h25-0-8" class="i">+        val iconUrl = BitmojiSelfie.getBitmojiSelfie(friendInfo?.bitmojiSelfieId, friendInfo?.bitmojiAvatarId, BitmojiSelfie.BitmojiSelfieType.THREE_D)
</a> 
         val downloadLogging by context.config.downloader.logging
         if (downloadLogging.contains(&quot;started&quot;)) {
<b>diff --git a/<a id="h26" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -50,7 +50,7 @@ object ViewAppearanceHelper {
</a>             }
         }
 
<a href="#h26-0-3" id="h26-0-3" class="d">-        val snapchatFontResId = resources.getIdentifier(&quot;avenir_next_medium&quot;, &quot;font&quot;, &quot;com.snapchat.android&quot;)
</a><a href="#h26-0-4" id="h26-0-4" class="i">+        val snapchatFontResId = resources.getIdentifier(&quot;avenir_next_medium&quot;, &quot;font&quot;, Constants.SNAPCHAT_PACKAGE_NAME)
</a>         val scalingFactor = resources.displayMetrics.densityDpi.toDouble() / 400
 
         with(component) {
<b>diff --git a/<a id="h27" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -53,7 +53,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>                         profile.bitmojiSelfieId.toString(),
                         profile.bitmojiAvatarId.toString(),
                         BitmojiSelfie.BitmojiSelfieType.THREE_D
<a href="#h27-0-3" id="h27-0-3" class="d">-                    )
</a><a href="#h27-0-4" id="h27-0-4" class="i">+                    )!!
</a>                 )
             }
         } catch (e: Throwable) {
<b>diff --git a/<a id="h28" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -6,7 +6,10 @@ object BitmojiSelfie {
</a>         THREE_D
     }
 
<a href="#h28-0-3" id="h28-0-3" class="d">-    fun getBitmojiSelfie(selfieId: String, avatarId: String, type: BitmojiSelfieType): String {
</a><a href="#h28-0-4" id="h28-0-4" class="i">+    fun getBitmojiSelfie(selfieId: String?, avatarId: String?, type: BitmojiSelfieType): String? {
</a><a href="#h28-0-5" id="h28-0-5" class="i">+        if (selfieId.isNullOrEmpty() || avatarId.isNullOrEmpty()) {
</a><a href="#h28-0-6" id="h28-0-6" class="i">+            return null
</a><a href="#h28-0-7" id="h28-0-7" class="i">+        }
</a>         return when (type) {
             BitmojiSelfieType.STANDARD -&gt; &quot;https://sdk.bitmoji.com/render/panel/$selfieId-$avatarId-v1.webp?transparent=1&quot;
             BitmojiSelfieType.THREE_D -&gt; &quot;https://images.bitmoji.com/3d/render/$selfieId-$avatarId-v1.webp?trim=circle&quot;
</pre>
</div>
</body>
</html>
