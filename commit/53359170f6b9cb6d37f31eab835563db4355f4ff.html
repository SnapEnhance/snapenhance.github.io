<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: scripting base - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/53359170f6b9cb6d37f31eab835563db4355f4ff.html">53359170f6b9cb6d37f31eab835563db4355f4ff</a>
<b>parent</b> <a href="../commit/82658d3ad9580aa5b2376e37762308977da12b19.html">82658d3ad9580aa5b2376e37762308977da12b19</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sat, 16 Sep 2023 17:15:11 +0200

feat: scripting base

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/LogManager.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">+++++++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/download/FFMpegProcessor.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt</a></td><td> | </td><td class="num">10</td><td><span class="i">+++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">core/build.gradle.kts</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/IScripting.aidl</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/ReloadListener.aidl</a></td><td> | </td><td class="num">5</td><td><span class="i">+++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">core/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">16</td><td><span class="i">+++++++++++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">core/src/main/kotlin/me/rhunk/snapenhance/core/Logger.kt</a></td><td> | </td><td class="num">59</td><td><span class="i">+++++++++++</span><span class="d">------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h17">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Scripting.kt</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h18">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/AbstractLogger.kt</a></td><td> | </td><td class="num">23</td><td><span class="i">+++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogChannel.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h20">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogLevel.kt</a></td><td> | </td><td class="num">31</td><td><span class="i">+++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h21">core/src/main/kotlin/me/rhunk/snapenhance/scripting/JSModule.kt</a></td><td> | </td><td class="num">54</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h22">core/src/main/kotlin/me/rhunk/snapenhance/scripting/ScriptRuntime.kt</a></td><td> | </td><td class="num">71</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h23">core/src/main/kotlin/me/rhunk/snapenhance/scripting/type/ModuleInfo.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">gradle/libs.versions.toml</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h25">scripting/.gitignore</a></td><td> | </td><td class="num">2</td><td><span class="i"></span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h26">scripting/build.gradle.kts</a></td><td> | </td><td class="num">18</td><td><span class="i"></span><span class="d">------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">settings.gradle.kts</a></td><td> | </td><td class="num">1</td><td><span class="i"></span><span class="d">-</span></td></tr>
</table></pre><pre>28 files changed, 363 insertions(+), 90 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/LogManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/LogManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/LogManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/LogManager.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -3,7 +3,9 @@ package me.rhunk.snapenhance
</a> import android.content.SharedPreferences
 import android.util.Log
 import com.google.gson.GsonBuilder
<a href="#h0-0-3" id="h0-0-3" class="d">-import me.rhunk.snapenhance.core.LogLevel
</a><a href="#h0-0-4" id="h0-0-4" class="i">+import me.rhunk.snapenhance.core.logger.AbstractLogger
</a><a href="#h0-0-5" id="h0-0-5" class="i">+import me.rhunk.snapenhance.core.logger.LogChannel
</a><a href="#h0-0-6" id="h0-0-6" class="i">+import me.rhunk.snapenhance.core.logger.LogLevel
</a> import java.io.File
 import java.io.OutputStream
 import java.io.RandomAccessFile
<a href="#h0-1" id="h0-1" class="h">@@ -100,7 +102,7 @@ class LogReader(
</a> 
 class LogManager(
     private val remoteSideContext: RemoteSideContext
<a href="#h0-1-3" id="h0-1-3" class="d">-) {
</a><a href="#h0-1-4" id="h0-1-4" class="i">+): AbstractLogger(LogChannel.MANAGER) {
</a>     companion object {
         private const val TAG = &quot;SnapEnhanceManager&quot;
         private val LOG_LIFETIME = 24.hours
<a href="#h0-2" id="h0-2" class="h">@@ -171,32 +173,32 @@ class LogManager(
</a>         lineAddListener = { line -&gt; it.incrementLineCount(); onAddLine(line) }
     }
 
<a href="#h0-2-3" id="h0-2-3" class="d">-    fun debug(message: Any?, tag: String = TAG) {
</a><a href="#h0-2-4" id="h0-2-4" class="i">+    override fun debug(message: Any?, tag: String) {
</a>         internalLog(tag, LogLevel.DEBUG, message)
     }
 
<a href="#h0-2-8" id="h0-2-8" class="d">-    fun error(message: Any?, tag: String = TAG) {
</a><a href="#h0-2-9" id="h0-2-9" class="i">+    override fun error(message: Any?, tag: String) {
</a>         internalLog(tag, LogLevel.ERROR, message)
     }
 
<a href="#h0-2-13" id="h0-2-13" class="d">-    fun error(message: Any?, throwable: Throwable, tag: String = TAG) {
</a><a href="#h0-2-14" id="h0-2-14" class="i">+    override fun error(message: Any?, throwable: Throwable, tag: String) {
</a>         internalLog(tag, LogLevel.ERROR, message)
         internalLog(tag, LogLevel.ERROR, throwable.stackTraceToString())
     }
 
<a href="#h0-2-19" id="h0-2-19" class="d">-    fun info(message: Any?, tag: String = TAG) {
</a><a href="#h0-2-20" id="h0-2-20" class="i">+    override fun info(message: Any?, tag: String) {
</a>         internalLog(tag, LogLevel.INFO, message)
     }
 
<a href="#h0-2-24" id="h0-2-24" class="d">-    fun verbose(message: Any?, tag: String = TAG) {
</a><a href="#h0-2-25" id="h0-2-25" class="i">+    override fun verbose(message: Any?, tag: String) {
</a>         internalLog(tag, LogLevel.VERBOSE, message)
     }
 
<a href="#h0-2-29" id="h0-2-29" class="d">-    fun warn(message: Any?, tag: String = TAG) {
</a><a href="#h0-2-30" id="h0-2-30" class="i">+    override fun warn(message: Any?, tag: String) {
</a>         internalLog(tag, LogLevel.WARN, message)
     }
 
<a href="#h0-2-34" id="h0-2-34" class="d">-    fun assert(message: Any?, tag: String = TAG) {
</a><a href="#h0-2-35" id="h0-2-35" class="i">+    override fun assert(message: Any?, tag: String) {
</a>         internalLog(tag, LogLevel.ASSERT, message)
     }
 
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -24,6 +24,7 @@ import me.rhunk.snapenhance.core.config.ModConfig
</a> import me.rhunk.snapenhance.download.DownloadTaskManager
 import me.rhunk.snapenhance.messaging.ModDatabase
 import me.rhunk.snapenhance.messaging.StreaksReminder
<a href="#h1-0-3" id="h1-0-3" class="i">+import me.rhunk.snapenhance.scripting.RemoteScriptManager
</a> import me.rhunk.snapenhance.ui.manager.MainActivity
 import me.rhunk.snapenhance.ui.manager.data.InstallationSummary
 import me.rhunk.snapenhance.ui.manager.data.ModInfo
<a href="#h1-1" id="h1-1" class="h">@@ -54,6 +55,7 @@ class RemoteSideContext(
</a>     val modDatabase = ModDatabase(this)
     val streaksReminder = StreaksReminder(this)
     val log = LogManager(this)
<a href="#h1-1-3" id="h1-1-3" class="i">+    val scriptManager = RemoteScriptManager(this)
</a> 
     //used to load bitmoji selfies and download previews
     val imageLoader by lazy {
<a href="#h1-2" id="h1-2" class="h">@@ -75,6 +77,7 @@ class RemoteSideContext(
</a>     val coroutineScope = CoroutineScope(Dispatchers.IO)
 
     fun reload() {
<a href="#h1-2-3" id="h1-2-3" class="i">+        log.verbose(&quot;Loading RemoteSideContext&quot;)
</a>         runCatching {
             config.loadFromContext(androidContext)
             translation.apply {
<a href="#h1-3" id="h1-3" class="h">@@ -88,6 +91,7 @@ class RemoteSideContext(
</a>             downloadTaskManager.init(androidContext)
             modDatabase.init()
             streaksReminder.init()
<a href="#h1-3-3" id="h1-3-3" class="i">+            scriptManager.init()
</a>         }.onFailure {
             log.error(&quot;Failed to load RemoteSideContext&quot;, it)
         }
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -3,7 +3,6 @@ package me.rhunk.snapenhance.bridge
</a> import android.app.Service
 import android.content.Intent
 import android.os.IBinder
<a href="#h2-0-3" id="h2-0-3" class="d">-import me.rhunk.snapenhance.core.LogLevel
</a> import me.rhunk.snapenhance.RemoteSideContext
 import me.rhunk.snapenhance.SharedContextHolder
 import me.rhunk.snapenhance.core.bridge.types.BridgeFileType
<a href="#h2-1" id="h2-1" class="h">@@ -11,10 +10,11 @@ import me.rhunk.snapenhance.core.bridge.types.FileActionType
</a> import me.rhunk.snapenhance.core.bridge.wrapper.LocaleWrapper
 import me.rhunk.snapenhance.core.bridge.wrapper.MessageLoggerWrapper
 import me.rhunk.snapenhance.core.database.objects.FriendInfo
<a href="#h2-1-3" id="h2-1-3" class="i">+import me.rhunk.snapenhance.core.logger.LogLevel
</a> import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
 import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
<a href="#h2-1-6" id="h2-1-6" class="d">-import me.rhunk.snapenhance.download.DownloadProcessor
</a> import me.rhunk.snapenhance.core.util.SerializableDataObject
<a href="#h2-1-8" id="h2-1-8" class="i">+import me.rhunk.snapenhance.download.DownloadProcessor
</a> import kotlin.system.measureTimeMillis
 
 class BridgeService : Service() {
<a href="#h2-2" id="h2-2" class="h">@@ -168,5 +168,7 @@ class BridgeService : Service() {
</a>                 groups.map { SerializableDataObject.fromJson&lt;MessagingGroupInfo&gt;(it) }
             )
         }
<a href="#h2-2-3" id="h2-2-3" class="i">+
</a><a href="#h2-2-4" id="h2-2-4" class="i">+        override fun getScriptingInterface() = remoteSideContext.scriptManager
</a>     }
 }
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/FFMpegProcessor.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/FFMpegProcessor.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/FFMpegProcessor.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/FFMpegProcessor.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -4,7 +4,7 @@ import com.arthenica.ffmpegkit.FFmpegKit
</a> import com.arthenica.ffmpegkit.FFmpegSession
 import com.arthenica.ffmpegkit.Level
 import kotlinx.coroutines.suspendCancellableCoroutine
<a href="#h3-0-3" id="h3-0-3" class="d">-import me.rhunk.snapenhance.core.LogLevel
</a><a href="#h3-0-4" id="h3-0-4" class="i">+import me.rhunk.snapenhance.core.logger.LogLevel
</a> import me.rhunk.snapenhance.LogManager
 import me.rhunk.snapenhance.core.Logger
 import me.rhunk.snapenhance.core.config.impl.DownloaderConfig
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/scripting/RemoteScriptManager.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,43 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+package me.rhunk.snapenhance.scripting
</a><a href="#h4-0-1" id="h4-0-1" class="i">+
</a><a href="#h4-0-2" id="h4-0-2" class="i">+import android.net.Uri
</a><a href="#h4-0-3" id="h4-0-3" class="i">+import androidx.documentfile.provider.DocumentFile
</a><a href="#h4-0-4" id="h4-0-4" class="i">+import me.rhunk.snapenhance.RemoteSideContext
</a><a href="#h4-0-5" id="h4-0-5" class="i">+import me.rhunk.snapenhance.bridge.scripting.IScripting
</a><a href="#h4-0-6" id="h4-0-6" class="i">+import me.rhunk.snapenhance.bridge.scripting.ReloadListener
</a><a href="#h4-0-7" id="h4-0-7" class="i">+
</a><a href="#h4-0-8" id="h4-0-8" class="i">+class RemoteScriptManager(
</a><a href="#h4-0-9" id="h4-0-9" class="i">+    private val context: RemoteSideContext,
</a><a href="#h4-0-10" id="h4-0-10" class="i">+) : IScripting.Stub() {
</a><a href="#h4-0-11" id="h4-0-11" class="i">+    private val scriptRuntime = ScriptRuntime(context.log)
</a><a href="#h4-0-12" id="h4-0-12" class="i">+
</a><a href="#h4-0-13" id="h4-0-13" class="i">+    private fun getScriptFolder()
</a><a href="#h4-0-14" id="h4-0-14" class="i">+        = DocumentFile.fromTreeUri(context.androidContext, Uri.parse(context.config.root.scripting.moduleFolder.get()))
</a><a href="#h4-0-15" id="h4-0-15" class="i">+    private fun hasHotReload() = context.config.root.scripting.hotReload.get()
</a><a href="#h4-0-16" id="h4-0-16" class="i">+
</a><a href="#h4-0-17" id="h4-0-17" class="i">+    private val reloadListeners = mutableListOf&lt;ReloadListener&gt;()
</a><a href="#h4-0-18" id="h4-0-18" class="i">+
</a><a href="#h4-0-19" id="h4-0-19" class="i">+    fun init() {
</a><a href="#h4-0-20" id="h4-0-20" class="i">+        enabledScriptPaths.forEach { path -&gt;
</a><a href="#h4-0-21" id="h4-0-21" class="i">+            val content = getScriptContent(path)
</a><a href="#h4-0-22" id="h4-0-22" class="i">+            scriptRuntime.load(path, content)
</a><a href="#h4-0-23" id="h4-0-23" class="i">+        }
</a><a href="#h4-0-24" id="h4-0-24" class="i">+    }
</a><a href="#h4-0-25" id="h4-0-25" class="i">+
</a><a href="#h4-0-26" id="h4-0-26" class="i">+    override fun getEnabledScriptPaths(): List&lt;String&gt; {
</a><a href="#h4-0-27" id="h4-0-27" class="i">+        val folder = getScriptFolder() ?: return emptyList()
</a><a href="#h4-0-28" id="h4-0-28" class="i">+        return folder.listFiles().filter { it.name?.endsWith(&quot;.js&quot;) ?: false }.map { it.name!! }
</a><a href="#h4-0-29" id="h4-0-29" class="i">+    }
</a><a href="#h4-0-30" id="h4-0-30" class="i">+
</a><a href="#h4-0-31" id="h4-0-31" class="i">+    override fun getScriptContent(path: String): String {
</a><a href="#h4-0-32" id="h4-0-32" class="i">+        val folder = getScriptFolder() ?: return &quot;&quot;
</a><a href="#h4-0-33" id="h4-0-33" class="i">+        val file = folder.findFile(path) ?: return &quot;&quot;
</a><a href="#h4-0-34" id="h4-0-34" class="i">+        return context.androidContext.contentResolver.openInputStream(file.uri)?.use {
</a><a href="#h4-0-35" id="h4-0-35" class="i">+            it.readBytes().toString(Charsets.UTF_8)
</a><a href="#h4-0-36" id="h4-0-36" class="i">+        } ?: &quot;&quot;
</a><a href="#h4-0-37" id="h4-0-37" class="i">+    }
</a><a href="#h4-0-38" id="h4-0-38" class="i">+
</a><a href="#h4-0-39" id="h4-0-39" class="i">+    override fun registerReloadListener(listener: ReloadListener) {
</a><a href="#h4-0-40" id="h4-0-40" class="i">+        reloadListeners.add(listener)
</a><a href="#h4-0-41" id="h4-0-41" class="i">+    }
</a><a href="#h4-0-42" id="h4-0-42" class="i">+}</a><a href="#h4-0-43" id="h4-0-43" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -2,8 +2,8 @@ package me.rhunk.snapenhance.ui.manager
</a> 
 import androidx.compose.foundation.layout.RowScope
 import androidx.compose.material.icons.Icons
<a href="#h5-0-3" id="h5-0-3" class="i">+import androidx.compose.material.icons.filled.DataObject
</a> import androidx.compose.material.icons.filled.Download
<a href="#h5-0-5" id="h5-0-5" class="d">-import androidx.compose.material.icons.filled.Extension
</a> import androidx.compose.material.icons.filled.Group
 import androidx.compose.material.icons.filled.Home
 import androidx.compose.material.icons.filled.Stars
<a href="#h5-1" id="h5-1" class="h">@@ -13,10 +13,10 @@ import androidx.navigation.NavController
</a> import androidx.navigation.NavGraphBuilder
 import androidx.navigation.compose.composable
 import me.rhunk.snapenhance.RemoteSideContext
<a href="#h5-1-3" id="h5-1-3" class="d">-import me.rhunk.snapenhance.ui.manager.sections.home.HomeSection
</a> import me.rhunk.snapenhance.ui.manager.sections.NotImplemented
 import me.rhunk.snapenhance.ui.manager.sections.downloads.DownloadsSection
 import me.rhunk.snapenhance.ui.manager.sections.features.FeaturesSection
<a href="#h5-1-7" id="h5-1-7" class="i">+import me.rhunk.snapenhance.ui.manager.sections.home.HomeSection
</a> import me.rhunk.snapenhance.ui.manager.sections.social.SocialSection
 import kotlin.reflect.KClass
 
<a href="#h5-2" id="h5-2" class="h">@@ -45,9 +45,9 @@ enum class EnumSection(
</a>         icon = Icons.Filled.Group,
         section = SocialSection::class
     ),
<a href="#h5-2-3" id="h5-2-3" class="d">-    PLUGINS(
</a><a href="#h5-2-4" id="h5-2-4" class="d">-        route = &quot;plugins&quot;,
</a><a href="#h5-2-5" id="h5-2-5" class="d">-        icon = Icons.Filled.Extension
</a><a href="#h5-2-6" id="h5-2-6" class="i">+    SCRIPTS(
</a><a href="#h5-2-7" id="h5-2-7" class="i">+        route = &quot;scripts&quot;,
</a><a href="#h5-2-8" id="h5-2-8" class="i">+        icon = Icons.Filled.DataObject
</a>     );
 
     companion object {
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -53,8 +53,8 @@ import androidx.compose.ui.window.Dialog
</a> import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.launch
 import me.rhunk.snapenhance.Constants
<a href="#h6-0-3" id="h6-0-3" class="d">-import me.rhunk.snapenhance.core.LogChannels
</a><a href="#h6-0-4" id="h6-0-4" class="d">-import me.rhunk.snapenhance.core.LogLevel
</a><a href="#h6-0-5" id="h6-0-5" class="i">+import me.rhunk.snapenhance.core.logger.LogChannel
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import me.rhunk.snapenhance.core.logger.LogLevel
</a> import me.rhunk.snapenhance.LogReader
 import me.rhunk.snapenhance.RemoteSideContext
 import me.rhunk.snapenhance.action.EnumAction
<a href="#h6-1" id="h6-1" class="h">@@ -169,7 +169,7 @@ class HomeSubSection(
</a>                                 )
 
                                 Text(
<a href="#h6-1-3" id="h6-1-3" class="d">-                                    text = LogChannels.fromChannel(line.tag)?.shortName ?: line.tag,
</a><a href="#h6-1-4" id="h6-1-4" class="i">+                                    text = LogChannel.fromChannel(line.tag)?.shortName ?: line.tag,
</a>                                     modifier = Modifier.padding(start = 4.dp),
                                     fontWeight = FontWeight.Light,
                                     fontSize = 10.sp,
<b>diff --git a/<a id="h7" href="../file/core/build.gradle.kts.html">core/build.gradle.kts</a> b/<a href="../file/core/build.gradle.kts.html">core/build.gradle.kts</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -39,6 +39,7 @@ dependencies {
</a>     implementation(libs.gson)
     implementation(libs.okhttp)
     implementation(libs.androidx.documentfile)
<a href="#h7-0-3" id="h7-0-3" class="i">+    implementation(libs.rhino)
</a> 
     implementation(project(&quot;:mapper&quot;))
     implementation(project(&quot;:native&quot;))
<b>diff --git a/<a id="h8" href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a> b/<a href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -3,6 +3,7 @@ package me.rhunk.snapenhance.bridge;
</a> import java.util.List;
 import me.rhunk.snapenhance.bridge.DownloadCallback;
 import me.rhunk.snapenhance.bridge.SyncCallback;
<a href="#h8-0-3" id="h8-0-3" class="i">+import me.rhunk.snapenhance.bridge.scripting.IScripting;
</a> 
 interface BridgeInterface {
     /**
<a href="#h8-1" id="h8-1" class="h">@@ -85,4 +86,6 @@ interface BridgeInterface {
</a>     * @param friends list of friends (MessagingFriendInfo as json string)
     */
     oneway void passGroupsAndFriends(in List&lt;String&gt; groups, in List&lt;String&gt; friends);
<a href="#h8-1-3" id="h8-1-3" class="i">+
</a><a href="#h8-1-4" id="h8-1-4" class="i">+    IScripting getScriptingInterface();
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h9" href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/IScripting.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/IScripting.aidl</a> b/<a href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/IScripting.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/IScripting.aidl</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,11 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+package me.rhunk.snapenhance.bridge.scripting;
</a><a href="#h9-0-1" id="h9-0-1" class="i">+
</a><a href="#h9-0-2" id="h9-0-2" class="i">+import me.rhunk.snapenhance.bridge.scripting.ReloadListener;
</a><a href="#h9-0-3" id="h9-0-3" class="i">+
</a><a href="#h9-0-4" id="h9-0-4" class="i">+interface IScripting {
</a><a href="#h9-0-5" id="h9-0-5" class="i">+    List&lt;String&gt; getEnabledScriptPaths();
</a><a href="#h9-0-6" id="h9-0-6" class="i">+
</a><a href="#h9-0-7" id="h9-0-7" class="i">+    String getScriptContent(String path);
</a><a href="#h9-0-8" id="h9-0-8" class="i">+
</a><a href="#h9-0-9" id="h9-0-9" class="i">+    void registerReloadListener(ReloadListener listener);
</a><a href="#h9-0-10" id="h9-0-10" class="i">+}</a><a href="#h9-0-11" id="h9-0-11" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/ReloadListener.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/ReloadListener.aidl</a> b/<a href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/ReloadListener.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/scripting/ReloadListener.aidl</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,5 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+package me.rhunk.snapenhance.bridge.scripting;
</a><a href="#h10-0-1" id="h10-0-1" class="i">+
</a><a href="#h10-0-2" id="h10-0-2" class="i">+oneway interface ReloadListener {
</a><a href="#h10-0-3" id="h10-0-3" class="i">+    void reloadScript(String path, String content);
</a><a href="#h10-0-4" id="h10-0-4" class="i">+}
</a><b>diff --git a/<a id="h11" href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a> b/<a href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -28,7 +28,7 @@
</a>             &quot;home_debug&quot;: &quot;Debug&quot;,
             &quot;home_logs&quot;: &quot;Logs&quot;,
             &quot;social&quot;: &quot;Social&quot;,
<a href="#h11-0-3" id="h11-0-3" class="d">-            &quot;plugins&quot;: &quot;Plugins&quot;
</a><a href="#h11-0-4" id="h11-0-4" class="i">+            &quot;scripts&quot;: &quot;Scripts&quot;
</a>         },
         &quot;sections&quot;: {
             &quot;home&quot;: {
<a href="#h11-1" id="h11-1" class="h">@@ -521,6 +521,20 @@
</a>                         &quot;description&quot;: &quot;Enables unreleased/beta Snapchat Plus features\nMight not work on older Snapchat versions&quot;
                     }
                 }
<a href="#h11-1-3" id="h11-1-3" class="i">+            },
</a><a href="#h11-1-4" id="h11-1-4" class="i">+            &quot;scripting&quot;: {
</a><a href="#h11-1-5" id="h11-1-5" class="i">+                &quot;name&quot;: &quot;Scripting&quot;,
</a><a href="#h11-1-6" id="h11-1-6" class="i">+                &quot;description&quot;: &quot;Run custom scripts to extend SnapEnhance&quot;,
</a><a href="#h11-1-7" id="h11-1-7" class="i">+                &quot;properties&quot;: {
</a><a href="#h11-1-8" id="h11-1-8" class="i">+                    &quot;module_folder&quot;: {
</a><a href="#h11-1-9" id="h11-1-9" class="i">+                        &quot;name&quot;: &quot;Module Folder&quot;,
</a><a href="#h11-1-10" id="h11-1-10" class="i">+                        &quot;description&quot;: &quot;The folder where the scripts are located&quot;
</a><a href="#h11-1-11" id="h11-1-11" class="i">+                    },
</a><a href="#h11-1-12" id="h11-1-12" class="i">+                    &quot;hot_reload&quot;: {
</a><a href="#h11-1-13" id="h11-1-13" class="i">+                        &quot;name&quot;: &quot;Hot Reload&quot;,
</a><a href="#h11-1-14" id="h11-1-14" class="i">+                        &quot;description&quot;: &quot;Automatically reloads scripts when they change&quot;
</a><a href="#h11-1-15" id="h11-1-15" class="i">+                    }
</a><a href="#h11-1-16" id="h11-1-16" class="i">+                }
</a>             }
         },
         &quot;options&quot;: {
<b>diff --git a/<a id="h12" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -25,6 +25,7 @@ import me.rhunk.snapenhance.manager.impl.ActionManager
</a> import me.rhunk.snapenhance.manager.impl.FeatureManager
 import me.rhunk.snapenhance.nativelib.NativeConfig
 import me.rhunk.snapenhance.nativelib.NativeLib
<a href="#h12-0-3" id="h12-0-3" class="i">+import me.rhunk.snapenhance.scripting.ScriptRuntime
</a> import java.util.concurrent.ExecutorService
 import java.util.concurrent.Executors
 import kotlin.reflect.KClass
<a href="#h12-1" id="h12-1" class="h">@@ -59,6 +60,7 @@ class ModContext {
</a>     val messageSender = MessageSender(this)
     val classCache get() = SnapEnhance.classCache
     val resources: Resources get() = androidContext.resources
<a href="#h12-1-3" id="h12-1-3" class="i">+    val scriptRuntime by lazy { ScriptRuntime(log) }
</a> 
     fun &lt;T : Feature&gt; feature(featureClass: KClass&lt;T&gt;): T {
         return features.get(featureClass)!!
<b>diff --git a/<a id="h13" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -7,6 +7,7 @@ import android.content.pm.PackageManager
</a> import kotlinx.coroutines.runBlocking
 import kotlinx.coroutines.withContext
 import me.rhunk.snapenhance.bridge.SyncCallback
<a href="#h13-0-3" id="h13-0-3" class="i">+import me.rhunk.snapenhance.bridge.scripting.ReloadListener
</a> import me.rhunk.snapenhance.core.BuildConfig
 import me.rhunk.snapenhance.core.Logger
 import me.rhunk.snapenhance.core.bridge.BridgeClient
<a href="#h13-1" id="h13-1" class="h">@@ -113,6 +114,23 @@ class SnapEnhance {
</a>                 if (!mappings.isMappingsLoaded()) return
                 features.init()
                 syncRemote()
<a href="#h13-1-3" id="h13-1-3" class="i">+
</a><a href="#h13-1-4" id="h13-1-4" class="i">+                bridgeClient.getScriptingInterface().apply {
</a><a href="#h13-1-5" id="h13-1-5" class="i">+                    registerReloadListener(object: ReloadListener.Stub() {
</a><a href="#h13-1-6" id="h13-1-6" class="i">+                        override fun reloadScript(path: String, content: String) {
</a><a href="#h13-1-7" id="h13-1-7" class="i">+                            scriptRuntime.reload(path, content)
</a><a href="#h13-1-8" id="h13-1-8" class="i">+                        }
</a><a href="#h13-1-9" id="h13-1-9" class="i">+                    })
</a><a href="#h13-1-10" id="h13-1-10" class="i">+
</a><a href="#h13-1-11" id="h13-1-11" class="i">+                    enabledScriptPaths.forEach { path -&gt;
</a><a href="#h13-1-12" id="h13-1-12" class="i">+                        runCatching {
</a><a href="#h13-1-13" id="h13-1-13" class="i">+                            scriptRuntime.load(path, getScriptContent(path))
</a><a href="#h13-1-14" id="h13-1-14" class="i">+                        }.onFailure {
</a><a href="#h13-1-15" id="h13-1-15" class="i">+                            log.error(&quot;Failed to load script $path&quot;, it)
</a><a href="#h13-1-16" id="h13-1-16" class="i">+                        }
</a><a href="#h13-1-17" id="h13-1-17" class="i">+                    }
</a><a href="#h13-1-18" id="h13-1-18" class="i">+                }
</a><a href="#h13-1-19" id="h13-1-19" class="i">+
</a>             }
         }.also { time -&gt;
             appContext.log.verbose(&quot;init took $time&quot;)
<b>diff --git a/<a id="h14" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/Logger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/Logger.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/Logger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/Logger.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -4,54 +4,17 @@ import android.annotation.SuppressLint
</a> import android.util.Log
 import de.robv.android.xposed.XposedBridge
 import me.rhunk.snapenhance.core.bridge.BridgeClient
<a href="#h14-0-3" id="h14-0-3" class="i">+import me.rhunk.snapenhance.core.logger.AbstractLogger
</a><a href="#h14-0-4" id="h14-0-4" class="i">+import me.rhunk.snapenhance.core.logger.LogChannel
</a> import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.hook
<a href="#h14-0-7" id="h14-0-7" class="d">-
</a><a href="#h14-0-8" id="h14-0-8" class="d">-enum class LogLevel(
</a><a href="#h14-0-9" id="h14-0-9" class="d">-    val letter: String,
</a><a href="#h14-0-10" id="h14-0-10" class="d">-    val shortName: String,
</a><a href="#h14-0-11" id="h14-0-11" class="d">-    val priority: Int = Log.INFO
</a><a href="#h14-0-12" id="h14-0-12" class="d">-) {
</a><a href="#h14-0-13" id="h14-0-13" class="d">-    VERBOSE(&quot;V&quot;, &quot;verbose&quot;, Log.VERBOSE),
</a><a href="#h14-0-14" id="h14-0-14" class="d">-    DEBUG(&quot;D&quot;, &quot;debug&quot;, Log.DEBUG),
</a><a href="#h14-0-15" id="h14-0-15" class="d">-    INFO(&quot;I&quot;, &quot;info&quot;, Log.INFO),
</a><a href="#h14-0-16" id="h14-0-16" class="d">-    WARN(&quot;W&quot;, &quot;warn&quot;, Log.WARN),
</a><a href="#h14-0-17" id="h14-0-17" class="d">-    ERROR(&quot;E&quot;, &quot;error&quot;, Log.ERROR),
</a><a href="#h14-0-18" id="h14-0-18" class="d">-    ASSERT(&quot;A&quot;, &quot;assert&quot;, Log.ASSERT);
</a><a href="#h14-0-19" id="h14-0-19" class="d">-
</a><a href="#h14-0-20" id="h14-0-20" class="d">-    companion object {
</a><a href="#h14-0-21" id="h14-0-21" class="d">-        fun fromLetter(letter: String): LogLevel? {
</a><a href="#h14-0-22" id="h14-0-22" class="d">-            return values().find { it.letter == letter }
</a><a href="#h14-0-23" id="h14-0-23" class="d">-        }
</a><a href="#h14-0-24" id="h14-0-24" class="d">-
</a><a href="#h14-0-25" id="h14-0-25" class="d">-        fun fromShortName(shortName: String): LogLevel? {
</a><a href="#h14-0-26" id="h14-0-26" class="d">-            return values().find { it.shortName == shortName }
</a><a href="#h14-0-27" id="h14-0-27" class="d">-        }
</a><a href="#h14-0-28" id="h14-0-28" class="d">-
</a><a href="#h14-0-29" id="h14-0-29" class="d">-        fun fromPriority(priority: Int): LogLevel? {
</a><a href="#h14-0-30" id="h14-0-30" class="d">-            return values().find { it.priority == priority }
</a><a href="#h14-0-31" id="h14-0-31" class="d">-        }
</a><a href="#h14-0-32" id="h14-0-32" class="d">-    }
</a><a href="#h14-0-33" id="h14-0-33" class="d">-}
</a><a href="#h14-0-34" id="h14-0-34" class="d">-
</a><a href="#h14-0-35" id="h14-0-35" class="d">-enum class LogChannels(val channel: String, val shortName: String) {
</a><a href="#h14-0-36" id="h14-0-36" class="d">-    CORE(&quot;SnapEnhanceCore&quot;, &quot;core&quot;),
</a><a href="#h14-0-37" id="h14-0-37" class="d">-    NATIVE(&quot;SnapEnhanceNative&quot;, &quot;native&quot;),
</a><a href="#h14-0-38" id="h14-0-38" class="d">-    MANAGER(&quot;SnapEnhanceManager&quot;, &quot;manager&quot;),
</a><a href="#h14-0-39" id="h14-0-39" class="d">-    XPOSED(&quot;LSPosed-Bridge&quot;, &quot;xposed&quot;);
</a><a href="#h14-0-40" id="h14-0-40" class="d">-
</a><a href="#h14-0-41" id="h14-0-41" class="d">-    companion object {
</a><a href="#h14-0-42" id="h14-0-42" class="d">-        fun fromChannel(channel: String): LogChannels? {
</a><a href="#h14-0-43" id="h14-0-43" class="d">-            return values().find { it.channel == channel }
</a><a href="#h14-0-44" id="h14-0-44" class="d">-        }
</a><a href="#h14-0-45" id="h14-0-45" class="d">-    }
</a><a href="#h14-0-46" id="h14-0-46" class="d">-}
</a><a href="#h14-0-47" id="h14-0-47" class="i">+import me.rhunk.snapenhance.core.logger.LogLevel
</a> 
 
 @SuppressLint(&quot;PrivateApi&quot;)
 class Logger(
     private val bridgeClient: BridgeClient
<a href="#h14-0-53" id="h14-0-53" class="d">-) {
</a><a href="#h14-0-54" id="h14-0-54" class="i">+): AbstractLogger(LogChannel.CORE) {
</a>     companion object {
         private const val TAG = &quot;SnapEnhanceCore&quot;
 
<a href="#h14-1" id="h14-1" class="h">@@ -104,20 +67,20 @@ class Logger(
</a>         }
     }
 
<a href="#h14-1-3" id="h14-1-3" class="d">-    fun debug(message: Any?, tag: String = TAG) = internalLog(tag, LogLevel.DEBUG, message)
</a><a href="#h14-1-4" id="h14-1-4" class="i">+    override fun debug(message: Any?, tag: String) = internalLog(tag, LogLevel.DEBUG, message)
</a> 
<a href="#h14-1-6" id="h14-1-6" class="d">-    fun error(message: Any?, tag: String = TAG) = internalLog(tag, LogLevel.ERROR, message)
</a><a href="#h14-1-7" id="h14-1-7" class="i">+    override fun error(message: Any?, tag: String) = internalLog(tag, LogLevel.ERROR, message)
</a> 
<a href="#h14-1-9" id="h14-1-9" class="d">-    fun error(message: Any?, throwable: Throwable, tag: String = TAG) {
</a><a href="#h14-1-10" id="h14-1-10" class="i">+    override fun error(message: Any?, throwable: Throwable, tag: String) {
</a>         internalLog(tag, LogLevel.ERROR, message)
         internalLog(tag, LogLevel.ERROR, throwable.stackTraceToString())
     }
 
<a href="#h14-1-15" id="h14-1-15" class="d">-    fun info(message: Any?, tag: String = TAG) = internalLog(tag, LogLevel.INFO, message)
</a><a href="#h14-1-16" id="h14-1-16" class="i">+    override fun info(message: Any?, tag: String) = internalLog(tag, LogLevel.INFO, message)
</a> 
<a href="#h14-1-18" id="h14-1-18" class="d">-    fun verbose(message: Any?, tag: String = TAG) = internalLog(tag, LogLevel.VERBOSE, message)
</a><a href="#h14-1-19" id="h14-1-19" class="i">+    override fun verbose(message: Any?, tag: String) = internalLog(tag, LogLevel.VERBOSE, message)
</a> 
<a href="#h14-1-21" id="h14-1-21" class="d">-    fun warn(message: Any?, tag: String = TAG) = internalLog(tag, LogLevel.WARN, message)
</a><a href="#h14-1-22" id="h14-1-22" class="i">+    override fun warn(message: Any?, tag: String) = internalLog(tag, LogLevel.WARN, message)
</a> 
<a href="#h14-1-24" id="h14-1-24" class="d">-    fun assert(message: Any?, tag: String = TAG) = internalLog(tag, LogLevel.ASSERT, message)
</a><a href="#h14-1-25" id="h14-1-25" class="i">+    override fun assert(message: Any?, tag: String) = internalLog(tag, LogLevel.ASSERT, message)
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h15" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -148,4 +148,6 @@ class BridgeClient(
</a> 
     fun setRule(targetUuid: String, type: MessagingRuleType, state: Boolean)
         = service.setRule(targetUuid, type.key, state)
<a href="#h15-0-3" id="h15-0-3" class="i">+
</a><a href="#h15-0-4" id="h15-0-4" class="i">+    fun getScriptingInterface() = service.getScriptingInterface()
</a> }
<b>diff --git a/<a id="h16" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -14,4 +14,5 @@ class RootConfig : ConfigContainer() {
</a>     val experimental = container(&quot;experimental&quot;, Experimental()) {
         icon = &quot;Science&quot;; addNotices(FeatureNotice.UNSTABLE)
     }
<a href="#h16-0-3" id="h16-0-3" class="i">+    val scripting = container(&quot;scripting&quot;, Scripting()) { icon = &quot;DataObject&quot; }
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h17" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Scripting.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Scripting.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Scripting.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Scripting.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -0,0 +1,9 @@
</a><a href="#h17-0-0" id="h17-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h17-0-1" id="h17-0-1" class="i">+
</a><a href="#h17-0-2" id="h17-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h17-0-3" id="h17-0-3" class="i">+import me.rhunk.snapenhance.core.config.ConfigFlag
</a><a href="#h17-0-4" id="h17-0-4" class="i">+
</a><a href="#h17-0-5" id="h17-0-5" class="i">+class Scripting : ConfigContainer() {
</a><a href="#h17-0-6" id="h17-0-6" class="i">+    val moduleFolder = string(&quot;module_folder&quot;, &quot;modules&quot;) { addFlags(ConfigFlag.FOLDER)  }
</a><a href="#h17-0-7" id="h17-0-7" class="i">+    val hotReload = boolean(&quot;hot_reload&quot;, false)
</a><a href="#h17-0-8" id="h17-0-8" class="i">+}</a><a href="#h17-0-9" id="h17-0-9" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/logger/AbstractLogger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/AbstractLogger.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/logger/AbstractLogger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/AbstractLogger.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -0,0 +1,22 @@
</a><a href="#h18-0-0" id="h18-0-0" class="i">+package me.rhunk.snapenhance.core.logger
</a><a href="#h18-0-1" id="h18-0-1" class="i">+
</a><a href="#h18-0-2" id="h18-0-2" class="i">+abstract class AbstractLogger(
</a><a href="#h18-0-3" id="h18-0-3" class="i">+    logChannel: LogChannel,
</a><a href="#h18-0-4" id="h18-0-4" class="i">+) {
</a><a href="#h18-0-5" id="h18-0-5" class="i">+    private val TAG = logChannel.shortName
</a><a href="#h18-0-6" id="h18-0-6" class="i">+
</a><a href="#h18-0-7" id="h18-0-7" class="i">+
</a><a href="#h18-0-8" id="h18-0-8" class="i">+    open fun debug(message: Any?, tag: String = TAG) {}
</a><a href="#h18-0-9" id="h18-0-9" class="i">+
</a><a href="#h18-0-10" id="h18-0-10" class="i">+    open fun error(message: Any?, tag: String = TAG) {}
</a><a href="#h18-0-11" id="h18-0-11" class="i">+
</a><a href="#h18-0-12" id="h18-0-12" class="i">+    open fun error(message: Any?, throwable: Throwable, tag: String = TAG) {}
</a><a href="#h18-0-13" id="h18-0-13" class="i">+
</a><a href="#h18-0-14" id="h18-0-14" class="i">+    open fun info(message: Any?, tag: String = TAG) {}
</a><a href="#h18-0-15" id="h18-0-15" class="i">+
</a><a href="#h18-0-16" id="h18-0-16" class="i">+    open fun verbose(message: Any?, tag: String = TAG) {}
</a><a href="#h18-0-17" id="h18-0-17" class="i">+
</a><a href="#h18-0-18" id="h18-0-18" class="i">+    open fun warn(message: Any?, tag: String = TAG) {}
</a><a href="#h18-0-19" id="h18-0-19" class="i">+
</a><a href="#h18-0-20" id="h18-0-20" class="i">+    open fun assert(message: Any?, tag: String = TAG) {}
</a><a href="#h18-0-21" id="h18-0-21" class="i">+}</a><a href="#h18-0-22" id="h18-0-22" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h19" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogChannel.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogChannel.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogChannel.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogChannel.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+package me.rhunk.snapenhance.core.logger
</a><a href="#h19-0-1" id="h19-0-1" class="i">+
</a><a href="#h19-0-2" id="h19-0-2" class="i">+enum class LogChannel(
</a><a href="#h19-0-3" id="h19-0-3" class="i">+    val channel: String,
</a><a href="#h19-0-4" id="h19-0-4" class="i">+    val shortName: String
</a><a href="#h19-0-5" id="h19-0-5" class="i">+) {
</a><a href="#h19-0-6" id="h19-0-6" class="i">+    CORE(&quot;SnapEnhanceCore&quot;, &quot;core&quot;),
</a><a href="#h19-0-7" id="h19-0-7" class="i">+    NATIVE(&quot;SnapEnhanceNative&quot;, &quot;native&quot;),
</a><a href="#h19-0-8" id="h19-0-8" class="i">+    MANAGER(&quot;SnapEnhanceManager&quot;, &quot;manager&quot;),
</a><a href="#h19-0-9" id="h19-0-9" class="i">+    XPOSED(&quot;LSPosed-Bridge&quot;, &quot;xposed&quot;);
</a><a href="#h19-0-10" id="h19-0-10" class="i">+
</a><a href="#h19-0-11" id="h19-0-11" class="i">+    companion object {
</a><a href="#h19-0-12" id="h19-0-12" class="i">+        fun fromChannel(channel: String): LogChannel? {
</a><a href="#h19-0-13" id="h19-0-13" class="i">+            return values().find { it.channel == channel }
</a><a href="#h19-0-14" id="h19-0-14" class="i">+        }
</a><a href="#h19-0-15" id="h19-0-15" class="i">+    }
</a><a href="#h19-0-16" id="h19-0-16" class="i">+}</a><a href="#h19-0-17" id="h19-0-17" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogLevel.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogLevel.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogLevel.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/logger/LogLevel.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -0,0 +1,30 @@
</a><a href="#h20-0-0" id="h20-0-0" class="i">+package me.rhunk.snapenhance.core.logger
</a><a href="#h20-0-1" id="h20-0-1" class="i">+
</a><a href="#h20-0-2" id="h20-0-2" class="i">+import android.util.Log
</a><a href="#h20-0-3" id="h20-0-3" class="i">+
</a><a href="#h20-0-4" id="h20-0-4" class="i">+enum class LogLevel(
</a><a href="#h20-0-5" id="h20-0-5" class="i">+    val letter: String,
</a><a href="#h20-0-6" id="h20-0-6" class="i">+    val shortName: String,
</a><a href="#h20-0-7" id="h20-0-7" class="i">+    val priority: Int = Log.INFO
</a><a href="#h20-0-8" id="h20-0-8" class="i">+) {
</a><a href="#h20-0-9" id="h20-0-9" class="i">+    VERBOSE(&quot;V&quot;, &quot;verbose&quot;, Log.VERBOSE),
</a><a href="#h20-0-10" id="h20-0-10" class="i">+    DEBUG(&quot;D&quot;, &quot;debug&quot;, Log.DEBUG),
</a><a href="#h20-0-11" id="h20-0-11" class="i">+    INFO(&quot;I&quot;, &quot;info&quot;, Log.INFO),
</a><a href="#h20-0-12" id="h20-0-12" class="i">+    WARN(&quot;W&quot;, &quot;warn&quot;, Log.WARN),
</a><a href="#h20-0-13" id="h20-0-13" class="i">+    ERROR(&quot;E&quot;, &quot;error&quot;, Log.ERROR),
</a><a href="#h20-0-14" id="h20-0-14" class="i">+    ASSERT(&quot;A&quot;, &quot;assert&quot;, Log.ASSERT);
</a><a href="#h20-0-15" id="h20-0-15" class="i">+
</a><a href="#h20-0-16" id="h20-0-16" class="i">+    companion object {
</a><a href="#h20-0-17" id="h20-0-17" class="i">+        fun fromLetter(letter: String): LogLevel? {
</a><a href="#h20-0-18" id="h20-0-18" class="i">+            return values().find { it.letter == letter }
</a><a href="#h20-0-19" id="h20-0-19" class="i">+        }
</a><a href="#h20-0-20" id="h20-0-20" class="i">+
</a><a href="#h20-0-21" id="h20-0-21" class="i">+        fun fromShortName(shortName: String): LogLevel? {
</a><a href="#h20-0-22" id="h20-0-22" class="i">+            return values().find { it.shortName == shortName }
</a><a href="#h20-0-23" id="h20-0-23" class="i">+        }
</a><a href="#h20-0-24" id="h20-0-24" class="i">+
</a><a href="#h20-0-25" id="h20-0-25" class="i">+        fun fromPriority(priority: Int): LogLevel? {
</a><a href="#h20-0-26" id="h20-0-26" class="i">+            return values().find { it.priority == priority }
</a><a href="#h20-0-27" id="h20-0-27" class="i">+        }
</a><a href="#h20-0-28" id="h20-0-28" class="i">+    }
</a><a href="#h20-0-29" id="h20-0-29" class="i">+}</a><a href="#h20-0-30" id="h20-0-30" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h21" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/scripting/JSModule.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/scripting/JSModule.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/scripting/JSModule.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/scripting/JSModule.kt</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -0,0 +1,53 @@
</a><a href="#h21-0-0" id="h21-0-0" class="i">+package me.rhunk.snapenhance.scripting
</a><a href="#h21-0-1" id="h21-0-1" class="i">+
</a><a href="#h21-0-2" id="h21-0-2" class="i">+import me.rhunk.snapenhance.core.logger.AbstractLogger
</a><a href="#h21-0-3" id="h21-0-3" class="i">+import me.rhunk.snapenhance.scripting.type.ModuleInfo
</a><a href="#h21-0-4" id="h21-0-4" class="i">+import org.mozilla.javascript.Context
</a><a href="#h21-0-5" id="h21-0-5" class="i">+import org.mozilla.javascript.FunctionObject
</a><a href="#h21-0-6" id="h21-0-6" class="i">+import org.mozilla.javascript.ScriptableObject
</a><a href="#h21-0-7" id="h21-0-7" class="i">+
</a><a href="#h21-0-8" id="h21-0-8" class="i">+class JSModule(
</a><a href="#h21-0-9" id="h21-0-9" class="i">+    val moduleInfo: ModuleInfo,
</a><a href="#h21-0-10" id="h21-0-10" class="i">+    val content: String,
</a><a href="#h21-0-11" id="h21-0-11" class="i">+) {
</a><a href="#h21-0-12" id="h21-0-12" class="i">+    lateinit var logger: AbstractLogger
</a><a href="#h21-0-13" id="h21-0-13" class="i">+    private lateinit var scope: ScriptableObject
</a><a href="#h21-0-14" id="h21-0-14" class="i">+
</a><a href="#h21-0-15" id="h21-0-15" class="i">+    companion object {
</a><a href="#h21-0-16" id="h21-0-16" class="i">+        @JvmStatic
</a><a href="#h21-0-17" id="h21-0-17" class="i">+        fun logDebug(message: String) {
</a><a href="#h21-0-18" id="h21-0-18" class="i">+            println(message)
</a><a href="#h21-0-19" id="h21-0-19" class="i">+        }
</a><a href="#h21-0-20" id="h21-0-20" class="i">+    }
</a><a href="#h21-0-21" id="h21-0-21" class="i">+
</a><a href="#h21-0-22" id="h21-0-22" class="i">+    fun load() {
</a><a href="#h21-0-23" id="h21-0-23" class="i">+        val context = Context.enter()
</a><a href="#h21-0-24" id="h21-0-24" class="i">+        context.optimizationLevel = -1
</a><a href="#h21-0-25" id="h21-0-25" class="i">+        scope = context.initSafeStandardObjects()
</a><a href="#h21-0-26" id="h21-0-26" class="i">+        scope.putConst(&quot;module&quot;, scope, moduleInfo)
</a><a href="#h21-0-27" id="h21-0-27" class="i">+
</a><a href="#h21-0-28" id="h21-0-28" class="i">+        scope.putConst(&quot;logDebug&quot;, scope,
</a><a href="#h21-0-29" id="h21-0-29" class="i">+            FunctionObject(&quot;logDebug&quot;, JSModule::class.java.getDeclaredMethod(&quot;logDebug&quot;, String::class.java), scope)
</a><a href="#h21-0-30" id="h21-0-30" class="i">+        )
</a><a href="#h21-0-31" id="h21-0-31" class="i">+
</a><a href="#h21-0-32" id="h21-0-32" class="i">+        context.evaluateString(scope, content, moduleInfo.name, 1, null)
</a><a href="#h21-0-33" id="h21-0-33" class="i">+    }
</a><a href="#h21-0-34" id="h21-0-34" class="i">+
</a><a href="#h21-0-35" id="h21-0-35" class="i">+    fun unload() {
</a><a href="#h21-0-36" id="h21-0-36" class="i">+        val context = Context.enter()
</a><a href="#h21-0-37" id="h21-0-37" class="i">+        context.evaluateString(scope, &quot;if (typeof module.onUnload === &#39;function&#39;) module.onUnload();&quot;, &quot;onUnload&quot;, 1, null)
</a><a href="#h21-0-38" id="h21-0-38" class="i">+        Context.exit()
</a><a href="#h21-0-39" id="h21-0-39" class="i">+    }
</a><a href="#h21-0-40" id="h21-0-40" class="i">+
</a><a href="#h21-0-41" id="h21-0-41" class="i">+    fun callOnCoreLoad() {
</a><a href="#h21-0-42" id="h21-0-42" class="i">+        val context = Context.enter()
</a><a href="#h21-0-43" id="h21-0-43" class="i">+        context.evaluateString(scope, &quot;if (typeof module.onCoreLoad === &#39;function&#39;) module.onCoreLoad();&quot;, &quot;onCoreLoad&quot;, 1, null)
</a><a href="#h21-0-44" id="h21-0-44" class="i">+        Context.exit()
</a><a href="#h21-0-45" id="h21-0-45" class="i">+    }
</a><a href="#h21-0-46" id="h21-0-46" class="i">+
</a><a href="#h21-0-47" id="h21-0-47" class="i">+    fun callOnManagerLoad() {
</a><a href="#h21-0-48" id="h21-0-48" class="i">+        val context = Context.enter()
</a><a href="#h21-0-49" id="h21-0-49" class="i">+        context.evaluateString(scope, &quot;if (typeof module.onManagerLoad === &#39;function&#39;) module.onManagerLoad();&quot;, &quot;onManagerLoad&quot;, 1, null)
</a><a href="#h21-0-50" id="h21-0-50" class="i">+        Context.exit()
</a><a href="#h21-0-51" id="h21-0-51" class="i">+    }
</a><a href="#h21-0-52" id="h21-0-52" class="i">+}</a><a href="#h21-0-53" id="h21-0-53" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h22" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/scripting/ScriptRuntime.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/scripting/ScriptRuntime.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/scripting/ScriptRuntime.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/scripting/ScriptRuntime.kt</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -0,0 +1,70 @@
</a><a href="#h22-0-0" id="h22-0-0" class="i">+package me.rhunk.snapenhance.scripting
</a><a href="#h22-0-1" id="h22-0-1" class="i">+
</a><a href="#h22-0-2" id="h22-0-2" class="i">+import me.rhunk.snapenhance.core.logger.AbstractLogger
</a><a href="#h22-0-3" id="h22-0-3" class="i">+import me.rhunk.snapenhance.scripting.type.ModuleInfo
</a><a href="#h22-0-4" id="h22-0-4" class="i">+import java.io.BufferedReader
</a><a href="#h22-0-5" id="h22-0-5" class="i">+import java.io.ByteArrayInputStream
</a><a href="#h22-0-6" id="h22-0-6" class="i">+
</a><a href="#h22-0-7" id="h22-0-7" class="i">+class ScriptRuntime(
</a><a href="#h22-0-8" id="h22-0-8" class="i">+    private val logger: AbstractLogger,
</a><a href="#h22-0-9" id="h22-0-9" class="i">+) {
</a><a href="#h22-0-10" id="h22-0-10" class="i">+    private val modules = mutableMapOf&lt;String, JSModule&gt;()
</a><a href="#h22-0-11" id="h22-0-11" class="i">+
</a><a href="#h22-0-12" id="h22-0-12" class="i">+    private fun readModuleInfo(reader: BufferedReader): ModuleInfo {
</a><a href="#h22-0-13" id="h22-0-13" class="i">+        val header = reader.readLine()
</a><a href="#h22-0-14" id="h22-0-14" class="i">+        if (!header.startsWith(&quot;// ==SE_module==&quot;)) {
</a><a href="#h22-0-15" id="h22-0-15" class="i">+            throw Exception(&quot;Invalid module header&quot;)
</a><a href="#h22-0-16" id="h22-0-16" class="i">+        }
</a><a href="#h22-0-17" id="h22-0-17" class="i">+
</a><a href="#h22-0-18" id="h22-0-18" class="i">+        val properties = mutableMapOf&lt;String, String&gt;()
</a><a href="#h22-0-19" id="h22-0-19" class="i">+        while (true) {
</a><a href="#h22-0-20" id="h22-0-20" class="i">+            val line = reader.readLine()
</a><a href="#h22-0-21" id="h22-0-21" class="i">+            if (line.startsWith(&quot;// ==/SE_module==&quot;)) {
</a><a href="#h22-0-22" id="h22-0-22" class="i">+                break
</a><a href="#h22-0-23" id="h22-0-23" class="i">+            }
</a><a href="#h22-0-24" id="h22-0-24" class="i">+            val split = line.replaceFirst(&quot;//&quot;, &quot;&quot;).split(&quot;:&quot;)
</a><a href="#h22-0-25" id="h22-0-25" class="i">+            if (split.size != 2) {
</a><a href="#h22-0-26" id="h22-0-26" class="i">+                throw Exception(&quot;Invalid module property&quot;)
</a><a href="#h22-0-27" id="h22-0-27" class="i">+            }
</a><a href="#h22-0-28" id="h22-0-28" class="i">+            properties[split[0].trim()] = split[1].trim()
</a><a href="#h22-0-29" id="h22-0-29" class="i">+        }
</a><a href="#h22-0-30" id="h22-0-30" class="i">+
</a><a href="#h22-0-31" id="h22-0-31" class="i">+        return ModuleInfo(
</a><a href="#h22-0-32" id="h22-0-32" class="i">+            name = properties[&quot;name&quot;] ?: throw Exception(&quot;Missing module name&quot;),
</a><a href="#h22-0-33" id="h22-0-33" class="i">+            version = properties[&quot;version&quot;] ?: throw Exception(&quot;Missing module version&quot;),
</a><a href="#h22-0-34" id="h22-0-34" class="i">+            description = properties[&quot;description&quot;],
</a><a href="#h22-0-35" id="h22-0-35" class="i">+            author = properties[&quot;author&quot;],
</a><a href="#h22-0-36" id="h22-0-36" class="i">+            minSnapchatVersion = properties[&quot;minSnapchatVersion&quot;]?.toLong(),
</a><a href="#h22-0-37" id="h22-0-37" class="i">+            minSEVersion = properties[&quot;minSEVersion&quot;]?.toLong(),
</a><a href="#h22-0-38" id="h22-0-38" class="i">+            grantPermissions = properties[&quot;permissions&quot;]?.split(&quot;,&quot;)?.map { it.trim() },
</a><a href="#h22-0-39" id="h22-0-39" class="i">+        )
</a><a href="#h22-0-40" id="h22-0-40" class="i">+    }
</a><a href="#h22-0-41" id="h22-0-41" class="i">+
</a><a href="#h22-0-42" id="h22-0-42" class="i">+    fun reload(path: String, content: String) {
</a><a href="#h22-0-43" id="h22-0-43" class="i">+        unload(path)
</a><a href="#h22-0-44" id="h22-0-44" class="i">+        load(path, content)
</a><a href="#h22-0-45" id="h22-0-45" class="i">+    }
</a><a href="#h22-0-46" id="h22-0-46" class="i">+
</a><a href="#h22-0-47" id="h22-0-47" class="i">+    private fun unload(path: String) {
</a><a href="#h22-0-48" id="h22-0-48" class="i">+        val module = modules[path] ?: return
</a><a href="#h22-0-49" id="h22-0-49" class="i">+        module.unload()
</a><a href="#h22-0-50" id="h22-0-50" class="i">+        module.load()
</a><a href="#h22-0-51" id="h22-0-51" class="i">+        modules.remove(path)
</a><a href="#h22-0-52" id="h22-0-52" class="i">+    }
</a><a href="#h22-0-53" id="h22-0-53" class="i">+
</a><a href="#h22-0-54" id="h22-0-54" class="i">+    fun load(path: String, content: String): JSModule? {
</a><a href="#h22-0-55" id="h22-0-55" class="i">+        logger.info(&quot;Loading module $path&quot;)
</a><a href="#h22-0-56" id="h22-0-56" class="i">+        return runCatching {
</a><a href="#h22-0-57" id="h22-0-57" class="i">+            JSModule(
</a><a href="#h22-0-58" id="h22-0-58" class="i">+                moduleInfo = readModuleInfo(ByteArrayInputStream(content.toByteArray(Charsets.UTF_8)).bufferedReader()),
</a><a href="#h22-0-59" id="h22-0-59" class="i">+                content = content,
</a><a href="#h22-0-60" id="h22-0-60" class="i">+            ).apply {
</a><a href="#h22-0-61" id="h22-0-61" class="i">+                logger = this@ScriptRuntime.logger
</a><a href="#h22-0-62" id="h22-0-62" class="i">+                load()
</a><a href="#h22-0-63" id="h22-0-63" class="i">+                modules[path] = this
</a><a href="#h22-0-64" id="h22-0-64" class="i">+            }
</a><a href="#h22-0-65" id="h22-0-65" class="i">+        }.onFailure {
</a><a href="#h22-0-66" id="h22-0-66" class="i">+            logger.error(&quot;Failed to load module $path&quot;, it)
</a><a href="#h22-0-67" id="h22-0-67" class="i">+        }.getOrNull()
</a><a href="#h22-0-68" id="h22-0-68" class="i">+    }
</a><a href="#h22-0-69" id="h22-0-69" class="i">+}</a><a href="#h22-0-70" id="h22-0-70" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h23" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/scripting/type/ModuleInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/scripting/type/ModuleInfo.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/scripting/type/ModuleInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/scripting/type/ModuleInfo.kt</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -0,0 +1,11 @@
</a><a href="#h23-0-0" id="h23-0-0" class="i">+package me.rhunk.snapenhance.scripting.type
</a><a href="#h23-0-1" id="h23-0-1" class="i">+
</a><a href="#h23-0-2" id="h23-0-2" class="i">+data class ModuleInfo(
</a><a href="#h23-0-3" id="h23-0-3" class="i">+    val name: String,
</a><a href="#h23-0-4" id="h23-0-4" class="i">+    val version: String,
</a><a href="#h23-0-5" id="h23-0-5" class="i">+    val description: String? = null,
</a><a href="#h23-0-6" id="h23-0-6" class="i">+    val author: String? = null,
</a><a href="#h23-0-7" id="h23-0-7" class="i">+    val minSnapchatVersion: Long? = null,
</a><a href="#h23-0-8" id="h23-0-8" class="i">+    val minSEVersion: Long? = null,
</a><a href="#h23-0-9" id="h23-0-9" class="i">+    val grantPermissions: List&lt;String&gt;? = null,
</a><a href="#h23-0-10" id="h23-0-10" class="i">+)</a><a href="#h23-0-11" id="h23-0-11" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h24" href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a> b/<a href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -18,6 +18,7 @@ dexlib2 = &quot;2.5.2&quot;
</a> androidx-documentfile = &quot;1.1.0-alpha01&quot;
 activity-ktx = &quot;1.7.2&quot;
 material3 = &quot;1.1.1&quot;
<a href="#h24-0-3" id="h24-0-3" class="i">+rhino = &quot;1.7.14&quot;
</a> 
 
 [libraries]
<a href="#h24-1" id="h24-1" class="h">@@ -39,6 +40,7 @@ dexlib2 = { group = &quot;org.smali&quot;, name = &quot;dexlib2&quot;, version.ref = &quot;dexlib2&quot; }
</a> androidx-documentfile = { group = &quot;androidx.documentfile&quot;, name = &quot;documentfile&quot;, version.ref = &quot;androidx-documentfile&quot; }
 androidx-activity-ktx = { group = &quot;androidx.activity&quot;, name = &quot;activity-ktx&quot;, version.ref = &quot;activity-ktx&quot; }
 androidx-material3 = { group = &quot;androidx.compose.material3&quot;, name = &quot;material3&quot;, version.ref = &quot;material3&quot; }
<a href="#h24-1-3" id="h24-1-3" class="i">+rhino = { module = &quot;org.mozilla:rhino&quot;, version.ref = &quot;rhino&quot; }
</a> 
 
 [plugins]
<b>diff --git a/<a id="h25" href="../file/scripting/.gitignore.html">scripting/.gitignore</a> b/<a href="../file/scripting/.gitignore.html">scripting/.gitignore</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -1 +0,0 @@
</a><a href="#h25-0-0" id="h25-0-0" class="d">-build/</a><a href="#h25-0-1" id="h25-0-1" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h26" href="../file/scripting/build.gradle.kts.html">scripting/build.gradle.kts</a> b/<a href="../file/scripting/build.gradle.kts.html">scripting/build.gradle.kts</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -1,17 +0,0 @@
</a><a href="#h26-0-0" id="h26-0-0" class="d">-plugins {
</a><a href="#h26-0-1" id="h26-0-1" class="d">-    alias(libs.plugins.androidLibrary)
</a><a href="#h26-0-2" id="h26-0-2" class="d">-    alias(libs.plugins.kotlinAndroid)
</a><a href="#h26-0-3" id="h26-0-3" class="d">-}
</a><a href="#h26-0-4" id="h26-0-4" class="d">-
</a><a href="#h26-0-5" id="h26-0-5" class="d">-android {
</a><a href="#h26-0-6" id="h26-0-6" class="d">-    namespace = rootProject.ext[&quot;applicationId&quot;].toString() + &quot;.scripting&quot;
</a><a href="#h26-0-7" id="h26-0-7" class="d">-    compileSdk = 34
</a><a href="#h26-0-8" id="h26-0-8" class="d">-
</a><a href="#h26-0-9" id="h26-0-9" class="d">-    kotlinOptions {
</a><a href="#h26-0-10" id="h26-0-10" class="d">-        jvmTarget = &quot;1.8&quot;
</a><a href="#h26-0-11" id="h26-0-11" class="d">-    }
</a><a href="#h26-0-12" id="h26-0-12" class="d">-}
</a><a href="#h26-0-13" id="h26-0-13" class="d">-
</a><a href="#h26-0-14" id="h26-0-14" class="d">-dependencies {
</a><a href="#h26-0-15" id="h26-0-15" class="d">-    implementation(project(&quot;:core&quot;))
</a><a href="#h26-0-16" id="h26-0-16" class="d">-}</a><a href="#h26-0-17" id="h26-0-17" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h27" href="../file/settings.gradle.kts.html">settings.gradle.kts</a> b/<a href="../file/settings.gradle.kts.html">settings.gradle.kts</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -21,4 +21,3 @@ include(&quot;:core&quot;)
</a> include(&quot;:app&quot;)
 include(&quot;:mapper&quot;)
 include(&quot;:native&quot;)
<a href="#h27-0-3" id="h27-0-3" class="d">-include(&quot;:scripting&quot;)
</a></pre>
</div>
</body>
</html>
