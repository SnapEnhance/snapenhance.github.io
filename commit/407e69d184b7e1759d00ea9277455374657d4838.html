<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat(manager): root installer - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/407e69d184b7e1759d00ea9277455374657d4838.html">407e69d184b7e1759d00ea9277455374657d4838</a>
<b>parent</b> <a href="../commit/2047f32440e1f384f4a7efc61b88757747111d9e.html">2047f32440e1f384f4a7efc61b88757747111d9e</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Mon, 30 Oct 2023 19:57:33 +0100

feat(manager): root installer

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">gradle/libs.versions.toml</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">manager/build.gradle.kts</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">manager/proguard-rules.pro</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">manager/src/main/kotlin/me/rhunk/snapenhance/manager/data/SharedConfig.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/MainActivity.kt</a></td><td> | </td><td class="num">14</td><td><span class="i">+++++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Navigation.kt</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h6">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Tab.kt</a></td><td> | </td><td class="num">57</td><td><span class="i"></span><span class="d">---------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h7">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/HomeTab.kt</a></td><td> | </td><td class="num">142</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h8">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/SettingsTab.kt</a></td><td> | </td><td class="num">118</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/Tab.kt</a></td><td> | </td><td class="num">58</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h10">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/InstallPackageTab.kt</a></td><td> | </td><td class="num">190</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h11">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/LSPatchTab.kt</a></td><td> | </td><td class="num">198</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h12">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SEDownloadTab.kt</a></td><td> | </td><td class="num">246</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h13">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SnapchatPatchTab.kt</a></td><td> | </td><td class="num">236</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/HomeTab.kt</a></td><td> | </td><td class="num">147</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/SettingsTab.kt</a></td><td> | </td><td class="num">151</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h16">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/InstallPackageTab.kt</a></td><td> | </td><td class="num">224</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h17">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/LSPatchTab.kt</a></td><td> | </td><td class="num">203</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h18">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SEDownloadTab.kt</a></td><td> | </td><td class="num">246</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SnapchatPatchTab.kt</a></td><td> | </td><td class="num">329</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">settings.gradle.kts</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
</table></pre><pre>21 files changed, 1379 insertions(+), 1192 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a> b/<a href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,6 +1,7 @@
</a> [versions]
 agp = &quot;8.1.2&quot;
 apksig = &quot;8.0.2&quot;
<a href="#h0-0-3" id="h0-0-3" class="i">+libsu = &quot;5.2.1&quot;
</a> guava = &quot;32.1.3-jre&quot;
 jsoup = &quot;1.16.2&quot;
 kotlin = &quot;1.9.0&quot;
<a href="#h0-1" id="h0-1" class="h">@@ -40,6 +41,7 @@ apksig = { module = &quot;com.android.tools.build:apksig&quot;, version.ref = &quot;apksig&quot; }
</a> bcprov-jdk18on = { module = &quot;org.bouncycastle:bcprov-jdk18on&quot;, version.ref = &quot;bcprov-jdk18on&quot; }
 coil-compose = { module = &quot;io.coil-kt:coil-compose&quot;, version.ref = &quot;coil-compose&quot; }
 coil-video = { module = &quot;io.coil-kt:coil-video&quot;, version.ref = &quot;coil-compose&quot; }
<a href="#h0-1-3" id="h0-1-3" class="i">+libsu = { module = &quot;com.github.topjohnwu.libsu:core&quot;, version.ref = &quot;libsu&quot; }
</a> coroutines = { group = &quot;org.jetbrains.kotlinx&quot;, name = &quot;kotlinx-coroutines-android&quot;, version.ref = &quot;kotlinx-coroutines-android&quot; }
 dexlib2 = { group = &quot;org.smali&quot;, name = &quot;dexlib2&quot;, version.ref = &quot;dexlib2&quot; }
 ffmpeg-kit = { group = &quot;com.arthenica&quot;, name = &quot;ffmpeg-kit-full-gpl&quot;, version.ref = &quot;ffmpeg-kit&quot; }
<b>diff --git a/<a id="h1" href="../file/manager/build.gradle.kts.html">manager/build.gradle.kts</a> b/<a href="../file/manager/build.gradle.kts.html">manager/build.gradle.kts</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -72,6 +72,7 @@ configurations {
</a> 
 dependencies {
     implementation(fileTree(mapOf(&quot;dir&quot; to &quot;libs&quot;, &quot;include&quot; to listOf(&quot;*.jar&quot;))))
<a href="#h1-0-3" id="h1-0-3" class="i">+    implementation(libs.libsu)
</a>     implementation(libs.guava)
     implementation(libs.apksig)
     implementation(libs.gson)
<b>diff --git a/<a id="h2" href="../file/manager/proguard-rules.pro.html">manager/proguard-rules.pro</a> b/<a href="../file/manager/proguard-rules.pro.html">manager/proguard-rules.pro</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,3 +1,3 @@
</a> -dontwarn com.google.errorprone.annotations.**
 -dontwarn com.google.auto.value.**
<a href="#h2-0-2" id="h2-0-2" class="d">--keep enum me.rhunk.snapenhance.manager.** { *; }</a><a href="#h2-0-3" id="h2-0-3" class="d">-
\ No newline at end of file
</a><a href="#h2-0-4" id="h2-0-4" class="i">+-keep class me.rhunk.snapenhance.manager.ui.tab.** { *; }</a><a href="#h2-0-5" id="h2-0-5" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/data/SharedConfig.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/data/SharedConfig.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/data/SharedConfig.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/data/SharedConfig.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -18,4 +18,7 @@ class SharedConfig(
</a> 
     var snapEnhancePackageName get() = sharedPreferences.getString(&quot;snapEnhancePackageName&quot;, &quot;me.rhunk.snapenhance&quot;)?.takeIf { it.isNotEmpty() } ?: &quot;me.rhunk.snapenhance&quot;
         set(value) = sharedPreferences.edit().putString(&quot;snapEnhancePackageName&quot;, value).apply()
<a href="#h3-0-3" id="h3-0-3" class="i">+
</a><a href="#h3-0-4" id="h3-0-4" class="i">+    var useRootInstaller get() = sharedPreferences.getBoolean(&quot;useRootInstaller&quot;, false)
</a><a href="#h3-0-5" id="h3-0-5" class="i">+        set(value) = sharedPreferences.edit().putBoolean(&quot;useRootInstaller&quot;, value).apply()
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h4" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/MainActivity.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/MainActivity.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/MainActivity.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/MainActivity.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -9,10 +9,13 @@ import androidx.compose.material3.*
</a> import androidx.compose.runtime.remember
 import androidx.compose.ui.platform.LocalContext
 import androidx.navigation.compose.rememberNavController
<a href="#h4-0-3" id="h4-0-3" class="i">+import com.topjohnwu.superuser.Shell
</a><a href="#h4-0-4" id="h4-0-4" class="i">+import me.rhunk.snapenhance.manager.BuildConfig
</a> import me.rhunk.snapenhance.manager.data.SharedConfig
<a href="#h4-0-6" id="h4-0-6" class="d">-import me.rhunk.snapenhance.manager.ui.tab.HomeTab
</a><a href="#h4-0-7" id="h4-0-7" class="d">-import me.rhunk.snapenhance.manager.ui.tab.SettingsTab
</a><a href="#h4-0-8" id="h4-0-8" class="d">-import me.rhunk.snapenhance.manager.ui.tab.download.InstallPackageTab
</a><a href="#h4-0-9" id="h4-0-9" class="i">+import me.rhunk.snapenhance.manager.ui.tab.Tab
</a><a href="#h4-0-10" id="h4-0-10" class="i">+import me.rhunk.snapenhance.manager.ui.tab.impl.HomeTab
</a><a href="#h4-0-11" id="h4-0-11" class="i">+import me.rhunk.snapenhance.manager.ui.tab.impl.SettingsTab
</a><a href="#h4-0-12" id="h4-0-12" class="i">+import me.rhunk.snapenhance.manager.ui.tab.impl.download.InstallPackageTab
</a> 
 class MainActivity : ComponentActivity() {
     companion object{
<a href="#h4-1" id="h4-1" class="h">@@ -22,6 +25,11 @@ class MainActivity : ComponentActivity() {
</a>     override fun onCreate(savedInstanceState: Bundle?) {
         super.onCreate(savedInstanceState)
 
<a href="#h4-1-3" id="h4-1-3" class="i">+        Shell.enableVerboseLogging = BuildConfig.DEBUG;
</a><a href="#h4-1-4" id="h4-1-4" class="i">+        Shell.setDefaultBuilder(Shell.Builder.create()
</a><a href="#h4-1-5" id="h4-1-5" class="i">+            .setFlags(Shell.FLAG_REDIRECT_STDERR)
</a><a href="#h4-1-6" id="h4-1-6" class="i">+            .setTimeout(10)
</a><a href="#h4-1-7" id="h4-1-7" class="i">+        );
</a>         val tabs = primaryTabs.mapNotNull {
             runCatching { it.java.constructors.first().newInstance() as Tab }.getOrNull()
         }.toMutableList().apply {
<b>diff --git a/<a id="h5" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Navigation.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Navigation.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Navigation.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Navigation.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -20,6 +20,7 @@ import androidx.navigation.NavGraph.Companion.findStartDestination
</a> import androidx.navigation.NavHostController
 import androidx.navigation.compose.NavHost
 import androidx.navigation.compose.currentBackStackEntryAsState
<a href="#h5-0-3" id="h5-0-3" class="i">+import me.rhunk.snapenhance.manager.ui.tab.Tab
</a> import kotlin.reflect.KClass
 
 
<b>diff --git a/<a id="h6" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Tab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Tab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Tab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/Tab.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,56 +0,0 @@
</a><a href="#h6-0-0" id="h6-0-0" class="d">-package me.rhunk.snapenhance.manager.ui
</a><a href="#h6-0-1" id="h6-0-1" class="d">-
</a><a href="#h6-0-2" id="h6-0-2" class="d">-import android.os.Bundle
</a><a href="#h6-0-3" id="h6-0-3" class="d">-import android.widget.Toast
</a><a href="#h6-0-4" id="h6-0-4" class="d">-import androidx.activity.ComponentActivity
</a><a href="#h6-0-5" id="h6-0-5" class="d">-import androidx.compose.runtime.Composable
</a><a href="#h6-0-6" id="h6-0-6" class="d">-import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h6-0-7" id="h6-0-7" class="d">-import androidx.navigation.NavGraphBuilder
</a><a href="#h6-0-8" id="h6-0-8" class="d">-import androidx.navigation.compose.composable
</a><a href="#h6-0-9" id="h6-0-9" class="d">-import me.rhunk.snapenhance.manager.data.SharedConfig
</a><a href="#h6-0-10" id="h6-0-10" class="d">-import kotlin.reflect.KClass
</a><a href="#h6-0-11" id="h6-0-11" class="d">-
</a><a href="#h6-0-12" id="h6-0-12" class="d">-open class Tab(
</a><a href="#h6-0-13" id="h6-0-13" class="d">-    val route: String,
</a><a href="#h6-0-14" id="h6-0-14" class="d">-    val isPrimary: Boolean = false,
</a><a href="#h6-0-15" id="h6-0-15" class="d">-    val icon: ImageVector? = null,
</a><a href="#h6-0-16" id="h6-0-16" class="d">-) {
</a><a href="#h6-0-17" id="h6-0-17" class="d">-    lateinit var activity: ComponentActivity
</a><a href="#h6-0-18" id="h6-0-18" class="d">-    val nestedTabs = mutableListOf&lt;Tab&gt;()
</a><a href="#h6-0-19" id="h6-0-19" class="d">-
</a><a href="#h6-0-20" id="h6-0-20" class="d">-    fun getNestedTab(tab: KClass&lt;out Tab&gt;) = nestedTabs.firstOrNull { it::class == tab }
</a><a href="#h6-0-21" id="h6-0-21" class="d">-
</a><a href="#h6-0-22" id="h6-0-22" class="d">-    fun registerNestedTab(tab: KClass&lt;out Tab&gt;) = nestedTabs.add((tab.java.constructors.first().newInstance() as Tab).also {
</a><a href="#h6-0-23" id="h6-0-23" class="d">-        it.init(activity)
</a><a href="#h6-0-24" id="h6-0-24" class="d">-    })
</a><a href="#h6-0-25" id="h6-0-25" class="d">-
</a><a href="#h6-0-26" id="h6-0-26" class="d">-    lateinit var navigation: Navigation
</a><a href="#h6-0-27" id="h6-0-27" class="d">-    lateinit var sharedConfig: SharedConfig
</a><a href="#h6-0-28" id="h6-0-28" class="d">-
</a><a href="#h6-0-29" id="h6-0-29" class="d">-    fun getArguments() = navigation.navHostController.currentBackStackEntry?.savedStateHandle?.get&lt;Bundle&gt;(&quot;args&quot;)
</a><a href="#h6-0-30" id="h6-0-30" class="d">-
</a><a href="#h6-0-31" id="h6-0-31" class="d">-    open fun init(activity: ComponentActivity) {
</a><a href="#h6-0-32" id="h6-0-32" class="d">-        this.activity = activity
</a><a href="#h6-0-33" id="h6-0-33" class="d">-    }
</a><a href="#h6-0-34" id="h6-0-34" class="d">-
</a><a href="#h6-0-35" id="h6-0-35" class="d">-    open fun build(navGraphBuilder: NavGraphBuilder) {
</a><a href="#h6-0-36" id="h6-0-36" class="d">-        navGraphBuilder.composable(route) {
</a><a href="#h6-0-37" id="h6-0-37" class="d">-            Content()
</a><a href="#h6-0-38" id="h6-0-38" class="d">-        }
</a><a href="#h6-0-39" id="h6-0-39" class="d">-    }
</a><a href="#h6-0-40" id="h6-0-40" class="d">-
</a><a href="#h6-0-41" id="h6-0-41" class="d">-    @Composable
</a><a href="#h6-0-42" id="h6-0-42" class="d">-    open fun TopBar() {}
</a><a href="#h6-0-43" id="h6-0-43" class="d">-
</a><a href="#h6-0-44" id="h6-0-44" class="d">-    @Composable
</a><a href="#h6-0-45" id="h6-0-45" class="d">-    open fun FloatingActionButtons() {}
</a><a href="#h6-0-46" id="h6-0-46" class="d">-
</a><a href="#h6-0-47" id="h6-0-47" class="d">-    @Composable
</a><a href="#h6-0-48" id="h6-0-48" class="d">-    open fun Content() {}
</a><a href="#h6-0-49" id="h6-0-49" class="d">-
</a><a href="#h6-0-50" id="h6-0-50" class="d">-    fun toast(message: String) {
</a><a href="#h6-0-51" id="h6-0-51" class="d">-        activity.runOnUiThread {
</a><a href="#h6-0-52" id="h6-0-52" class="d">-            Toast.makeText(activity, message, Toast.LENGTH_SHORT).show()
</a><a href="#h6-0-53" id="h6-0-53" class="d">-        }
</a><a href="#h6-0-54" id="h6-0-54" class="d">-    }
</a><a href="#h6-0-55" id="h6-0-55" class="d">-}</a><a href="#h6-0-56" id="h6-0-56" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/HomeTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/HomeTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/HomeTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/HomeTab.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,141 +0,0 @@
</a><a href="#h7-0-0" id="h7-0-0" class="d">-package me.rhunk.snapenhance.manager.ui.tab
</a><a href="#h7-0-1" id="h7-0-1" class="d">-
</a><a href="#h7-0-2" id="h7-0-2" class="d">-import android.content.pm.ApplicationInfo.FLAG_DEBUGGABLE
</a><a href="#h7-0-3" id="h7-0-3" class="d">-import android.content.pm.PackageInfo
</a><a href="#h7-0-4" id="h7-0-4" class="d">-import androidx.activity.ComponentActivity
</a><a href="#h7-0-5" id="h7-0-5" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h7-0-6" id="h7-0-6" class="d">-import androidx.compose.foundation.layout.Arrangement
</a><a href="#h7-0-7" id="h7-0-7" class="d">-import androidx.compose.foundation.layout.Column
</a><a href="#h7-0-8" id="h7-0-8" class="d">-import androidx.compose.foundation.layout.Row
</a><a href="#h7-0-9" id="h7-0-9" class="d">-import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h7-0-10" id="h7-0-10" class="d">-import androidx.compose.foundation.layout.padding
</a><a href="#h7-0-11" id="h7-0-11" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h7-0-12" id="h7-0-12" class="d">-import androidx.compose.material.icons.automirrored.filled.OpenInNew
</a><a href="#h7-0-13" id="h7-0-13" class="d">-import androidx.compose.material.icons.filled.Home
</a><a href="#h7-0-14" id="h7-0-14" class="d">-import androidx.compose.material3.Card
</a><a href="#h7-0-15" id="h7-0-15" class="d">-import androidx.compose.material3.Icon
</a><a href="#h7-0-16" id="h7-0-16" class="d">-import androidx.compose.material3.MaterialTheme
</a><a href="#h7-0-17" id="h7-0-17" class="d">-import androidx.compose.material3.Text
</a><a href="#h7-0-18" id="h7-0-18" class="d">-import androidx.compose.runtime.*
</a><a href="#h7-0-19" id="h7-0-19" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h7-0-20" id="h7-0-20" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h7-0-21" id="h7-0-21" class="d">-import androidx.compose.ui.platform.LocalContext
</a><a href="#h7-0-22" id="h7-0-22" class="d">-import androidx.compose.ui.text.font.FontWeight
</a><a href="#h7-0-23" id="h7-0-23" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h7-0-24" id="h7-0-24" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h7-0-25" id="h7-0-25" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h7-0-26" id="h7-0-26" class="d">-import kotlinx.coroutines.launch
</a><a href="#h7-0-27" id="h7-0-27" class="d">-import me.rhunk.snapenhance.manager.lspatch.config.Constants
</a><a href="#h7-0-28" id="h7-0-28" class="d">-import me.rhunk.snapenhance.manager.ui.Tab
</a><a href="#h7-0-29" id="h7-0-29" class="d">-import me.rhunk.snapenhance.manager.ui.tab.download.SEDownloadTab
</a><a href="#h7-0-30" id="h7-0-30" class="d">-import me.rhunk.snapenhance.manager.ui.tab.download.SnapchatPatchTab
</a><a href="#h7-0-31" id="h7-0-31" class="d">-
</a><a href="#h7-0-32" id="h7-0-32" class="d">-class HomeTab : Tab(&quot;home&quot;, true, icon = Icons.Default.Home) {
</a><a href="#h7-0-33" id="h7-0-33" class="d">-    override fun init(activity: ComponentActivity) {
</a><a href="#h7-0-34" id="h7-0-34" class="d">-        super.init(activity)
</a><a href="#h7-0-35" id="h7-0-35" class="d">-        registerNestedTab(SEDownloadTab::class)
</a><a href="#h7-0-36" id="h7-0-36" class="d">-        registerNestedTab(SnapchatPatchTab::class)
</a><a href="#h7-0-37" id="h7-0-37" class="d">-    }
</a><a href="#h7-0-38" id="h7-0-38" class="d">-
</a><a href="#h7-0-39" id="h7-0-39" class="d">-    @Composable
</a><a href="#h7-0-40" id="h7-0-40" class="d">-    override fun Content() {
</a><a href="#h7-0-41" id="h7-0-41" class="d">-        val context = LocalContext.current
</a><a href="#h7-0-42" id="h7-0-42" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h7-0-43" id="h7-0-43" class="d">-        var snapchatAppInfo by remember { mutableStateOf(null as PackageInfo?) }
</a><a href="#h7-0-44" id="h7-0-44" class="d">-        var snapEnhanceInfo by remember { mutableStateOf(null as PackageInfo?) }
</a><a href="#h7-0-45" id="h7-0-45" class="d">-
</a><a href="#h7-0-46" id="h7-0-46" class="d">-        Column {
</a><a href="#h7-0-47" id="h7-0-47" class="d">-
</a><a href="#h7-0-48" id="h7-0-48" class="d">-            Card(
</a><a href="#h7-0-49" id="h7-0-49" class="d">-                modifier = Modifier
</a><a href="#h7-0-50" id="h7-0-50" class="d">-                    .fillMaxWidth()
</a><a href="#h7-0-51" id="h7-0-51" class="d">-                    .padding(10.dp),
</a><a href="#h7-0-52" id="h7-0-52" class="d">-            ) {
</a><a href="#h7-0-53" id="h7-0-53" class="d">-                Row(
</a><a href="#h7-0-54" id="h7-0-54" class="d">-                    modifier = Modifier
</a><a href="#h7-0-55" id="h7-0-55" class="d">-                        .fillMaxWidth()
</a><a href="#h7-0-56" id="h7-0-56" class="d">-                        .clickable {
</a><a href="#h7-0-57" id="h7-0-57" class="d">-                            navigation.navigateTo(SEDownloadTab::class)
</a><a href="#h7-0-58" id="h7-0-58" class="d">-                        }
</a><a href="#h7-0-59" id="h7-0-59" class="d">-                        .padding(16.dp),
</a><a href="#h7-0-60" id="h7-0-60" class="d">-                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h7-0-61" id="h7-0-61" class="d">-                ) {
</a><a href="#h7-0-62" id="h7-0-62" class="d">-                    Column {
</a><a href="#h7-0-63" id="h7-0-63" class="d">-                        Text(text = &quot;SnapEnhance&quot;, fontSize = 24.sp, color = MaterialTheme.colorScheme.onSurface, fontWeight = FontWeight.Bold)
</a><a href="#h7-0-64" id="h7-0-64" class="d">-                        snapEnhanceInfo?.let {
</a><a href="#h7-0-65" id="h7-0-65" class="d">-                            Text(text = &quot;${it.versionName} (${it.longVersionCode}) - ${if ((it.applicationInfo.flags and FLAG_DEBUGGABLE) != 0) &quot;Debug&quot; else &quot;Release&quot;}&quot;, fontSize = 12.sp, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h7-0-66" id="h7-0-66" class="d">-                        }
</a><a href="#h7-0-67" id="h7-0-67" class="d">-                    }
</a><a href="#h7-0-68" id="h7-0-68" class="d">-                    Row(
</a><a href="#h7-0-69" id="h7-0-69" class="d">-                        modifier = Modifier
</a><a href="#h7-0-70" id="h7-0-70" class="d">-                            .weight(1f),
</a><a href="#h7-0-71" id="h7-0-71" class="d">-                        horizontalArrangement = Arrangement.End,
</a><a href="#h7-0-72" id="h7-0-72" class="d">-                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h7-0-73" id="h7-0-73" class="d">-                    ) {
</a><a href="#h7-0-74" id="h7-0-74" class="d">-                        snapEnhanceInfo?.let {
</a><a href="#h7-0-75" id="h7-0-75" class="d">-                            Text(text = &quot;Installed&quot;, fontSize = 16.sp, color = MaterialTheme.colorScheme.onSurface)
</a><a href="#h7-0-76" id="h7-0-76" class="d">-                        } ?: run {
</a><a href="#h7-0-77" id="h7-0-77" class="d">-                            Text(text = &quot;Not installed&quot;, fontSize = 16.sp, color = MaterialTheme.colorScheme.onSurface)
</a><a href="#h7-0-78" id="h7-0-78" class="d">-                        }
</a><a href="#h7-0-79" id="h7-0-79" class="d">-
</a><a href="#h7-0-80" id="h7-0-80" class="d">-                        Icon(imageVector = Icons.AutoMirrored.Default.OpenInNew, contentDescription = null, Modifier.padding(10.dp))
</a><a href="#h7-0-81" id="h7-0-81" class="d">-                    }
</a><a href="#h7-0-82" id="h7-0-82" class="d">-                }
</a><a href="#h7-0-83" id="h7-0-83" class="d">-            }
</a><a href="#h7-0-84" id="h7-0-84" class="d">-
</a><a href="#h7-0-85" id="h7-0-85" class="d">-            Card(
</a><a href="#h7-0-86" id="h7-0-86" class="d">-                modifier = Modifier
</a><a href="#h7-0-87" id="h7-0-87" class="d">-                    .fillMaxWidth()
</a><a href="#h7-0-88" id="h7-0-88" class="d">-                    .padding(10.dp),
</a><a href="#h7-0-89" id="h7-0-89" class="d">-            ) {
</a><a href="#h7-0-90" id="h7-0-90" class="d">-                Row(
</a><a href="#h7-0-91" id="h7-0-91" class="d">-                    modifier = Modifier
</a><a href="#h7-0-92" id="h7-0-92" class="d">-                        .fillMaxWidth()
</a><a href="#h7-0-93" id="h7-0-93" class="d">-                        .clickable {
</a><a href="#h7-0-94" id="h7-0-94" class="d">-                            navigation.navigateTo(SnapchatPatchTab::class)
</a><a href="#h7-0-95" id="h7-0-95" class="d">-                        }
</a><a href="#h7-0-96" id="h7-0-96" class="d">-                        .padding(16.dp),
</a><a href="#h7-0-97" id="h7-0-97" class="d">-                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h7-0-98" id="h7-0-98" class="d">-                ) {
</a><a href="#h7-0-99" id="h7-0-99" class="d">-                    Column {
</a><a href="#h7-0-100" id="h7-0-100" class="d">-                        Text(text = &quot;Snapchat&quot;, fontSize = 24.sp, color = MaterialTheme.colorScheme.onSurface, fontWeight = FontWeight.Bold)
</a><a href="#h7-0-101" id="h7-0-101" class="d">-                        snapchatAppInfo?.let {
</a><a href="#h7-0-102" id="h7-0-102" class="d">-                            Text(text = &quot;${it.versionName} (${it.longVersionCode})&quot;, fontSize = 12.sp, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h7-0-103" id="h7-0-103" class="d">-                        }
</a><a href="#h7-0-104" id="h7-0-104" class="d">-                    }
</a><a href="#h7-0-105" id="h7-0-105" class="d">-                    Row(
</a><a href="#h7-0-106" id="h7-0-106" class="d">-                        modifier = Modifier
</a><a href="#h7-0-107" id="h7-0-107" class="d">-                            .weight(1f),
</a><a href="#h7-0-108" id="h7-0-108" class="d">-                        horizontalArrangement = Arrangement.spacedBy(5.dp, Alignment.End),
</a><a href="#h7-0-109" id="h7-0-109" class="d">-                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h7-0-110" id="h7-0-110" class="d">-                    ) {
</a><a href="#h7-0-111" id="h7-0-111" class="d">-                        snapchatAppInfo?.let { appInfo -&gt;
</a><a href="#h7-0-112" id="h7-0-112" class="d">-                            val isLSPatched = appInfo.applicationInfo.appComponentFactory == Constants.PROXY_APP_COMPONENT_FACTORY
</a><a href="#h7-0-113" id="h7-0-113" class="d">-                            if (isLSPatched) {
</a><a href="#h7-0-114" id="h7-0-114" class="d">-                                Text(text = &quot;Patched&quot;, fontSize = 16.sp, color = MaterialTheme.colorScheme.onSurface)
</a><a href="#h7-0-115" id="h7-0-115" class="d">-                            }
</a><a href="#h7-0-116" id="h7-0-116" class="d">-                        } ?: run {
</a><a href="#h7-0-117" id="h7-0-117" class="d">-                            Text(text = &quot;Not installed&quot;, fontSize = 16.sp, color = MaterialTheme.colorScheme.onSurface)
</a><a href="#h7-0-118" id="h7-0-118" class="d">-                        }
</a><a href="#h7-0-119" id="h7-0-119" class="d">-
</a><a href="#h7-0-120" id="h7-0-120" class="d">-                        Icon(imageVector = Icons.AutoMirrored.Default.OpenInNew, contentDescription = null, Modifier.padding(10.dp))
</a><a href="#h7-0-121" id="h7-0-121" class="d">-                    }
</a><a href="#h7-0-122" id="h7-0-122" class="d">-                }
</a><a href="#h7-0-123" id="h7-0-123" class="d">-
</a><a href="#h7-0-124" id="h7-0-124" class="d">-            }
</a><a href="#h7-0-125" id="h7-0-125" class="d">-        }
</a><a href="#h7-0-126" id="h7-0-126" class="d">-
</a><a href="#h7-0-127" id="h7-0-127" class="d">-        SideEffect {
</a><a href="#h7-0-128" id="h7-0-128" class="d">-            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h7-0-129" id="h7-0-129" class="d">-                runCatching {
</a><a href="#h7-0-130" id="h7-0-130" class="d">-                    snapchatAppInfo = runCatching {
</a><a href="#h7-0-131" id="h7-0-131" class="d">-                        context.packageManager.getPackageInfo(sharedConfig.snapchatPackageName, 0)
</a><a href="#h7-0-132" id="h7-0-132" class="d">-                    }.getOrNull()
</a><a href="#h7-0-133" id="h7-0-133" class="d">-                    snapEnhanceInfo = runCatching {
</a><a href="#h7-0-134" id="h7-0-134" class="d">-                        context.packageManager.getPackageInfo(sharedConfig.snapEnhancePackageName, 0)
</a><a href="#h7-0-135" id="h7-0-135" class="d">-                    }.getOrNull()
</a><a href="#h7-0-136" id="h7-0-136" class="d">-                }
</a><a href="#h7-0-137" id="h7-0-137" class="d">-            }
</a><a href="#h7-0-138" id="h7-0-138" class="d">-        }
</a><a href="#h7-0-139" id="h7-0-139" class="d">-    }
</a><a href="#h7-0-140" id="h7-0-140" class="d">-}</a><a href="#h7-0-141" id="h7-0-141" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h8" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/SettingsTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/SettingsTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/SettingsTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/SettingsTab.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,117 +0,0 @@
</a><a href="#h8-0-0" id="h8-0-0" class="d">-package me.rhunk.snapenhance.manager.ui.tab
</a><a href="#h8-0-1" id="h8-0-1" class="d">-
</a><a href="#h8-0-2" id="h8-0-2" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h8-0-3" id="h8-0-3" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h8-0-4" id="h8-0-4" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h8-0-5" id="h8-0-5" class="d">-import androidx.compose.material.icons.filled.Edit
</a><a href="#h8-0-6" id="h8-0-6" class="d">-import androidx.compose.material.icons.filled.Settings
</a><a href="#h8-0-7" id="h8-0-7" class="d">-import androidx.compose.material3.*
</a><a href="#h8-0-8" id="h8-0-8" class="d">-import androidx.compose.runtime.Composable
</a><a href="#h8-0-9" id="h8-0-9" class="d">-import androidx.compose.runtime.getValue
</a><a href="#h8-0-10" id="h8-0-10" class="d">-import androidx.compose.runtime.mutableStateOf
</a><a href="#h8-0-11" id="h8-0-11" class="d">-import androidx.compose.runtime.remember
</a><a href="#h8-0-12" id="h8-0-12" class="d">-import androidx.compose.runtime.setValue
</a><a href="#h8-0-13" id="h8-0-13" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h8-0-14" id="h8-0-14" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h8-0-15" id="h8-0-15" class="d">-import androidx.compose.ui.focus.FocusRequester
</a><a href="#h8-0-16" id="h8-0-16" class="d">-import androidx.compose.ui.focus.focusRequester
</a><a href="#h8-0-17" id="h8-0-17" class="d">-import androidx.compose.ui.layout.onGloballyPositioned
</a><a href="#h8-0-18" id="h8-0-18" class="d">-import androidx.compose.ui.text.TextRange
</a><a href="#h8-0-19" id="h8-0-19" class="d">-import androidx.compose.ui.text.input.TextFieldValue
</a><a href="#h8-0-20" id="h8-0-20" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h8-0-21" id="h8-0-21" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h8-0-22" id="h8-0-22" class="d">-import androidx.compose.ui.window.Dialog
</a><a href="#h8-0-23" id="h8-0-23" class="d">-import me.rhunk.snapenhance.manager.ui.Tab
</a><a href="#h8-0-24" id="h8-0-24" class="d">-
</a><a href="#h8-0-25" id="h8-0-25" class="d">-class SettingsTab : Tab(&quot;settings&quot;, isPrimary = true, icon = Icons.Default.Settings) {
</a><a href="#h8-0-26" id="h8-0-26" class="d">-    @Composable
</a><a href="#h8-0-27" id="h8-0-27" class="d">-    private fun ConfigEditRow(getValue: () -&gt; String?, setValue: (String) -&gt; Unit, label: String) {
</a><a href="#h8-0-28" id="h8-0-28" class="d">-        var showDialog by remember { mutableStateOf(false) }
</a><a href="#h8-0-29" id="h8-0-29" class="d">-
</a><a href="#h8-0-30" id="h8-0-30" class="d">-        if (showDialog) {
</a><a href="#h8-0-31" id="h8-0-31" class="d">-            val focusRequester = remember { FocusRequester() }
</a><a href="#h8-0-32" id="h8-0-32" class="d">-
</a><a href="#h8-0-33" id="h8-0-33" class="d">-            Dialog(onDismissRequest = {
</a><a href="#h8-0-34" id="h8-0-34" class="d">-                showDialog = false
</a><a href="#h8-0-35" id="h8-0-35" class="d">-            }) {
</a><a href="#h8-0-36" id="h8-0-36" class="d">-                Card {
</a><a href="#h8-0-37" id="h8-0-37" class="d">-                    Column(
</a><a href="#h8-0-38" id="h8-0-38" class="d">-                        modifier = Modifier.padding(16.dp),
</a><a href="#h8-0-39" id="h8-0-39" class="d">-                        horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h8-0-40" id="h8-0-40" class="d">-                        verticalArrangement = Arrangement.spacedBy(16.dp)
</a><a href="#h8-0-41" id="h8-0-41" class="d">-                    ) {
</a><a href="#h8-0-42" id="h8-0-42" class="d">-                        Text(text = label)
</a><a href="#h8-0-43" id="h8-0-43" class="d">-                        var textFieldValue by remember { mutableStateOf((getValue() ?: &quot;&quot;).let {
</a><a href="#h8-0-44" id="h8-0-44" class="d">-                            TextFieldValue(it, TextRange(it.length))
</a><a href="#h8-0-45" id="h8-0-45" class="d">-                        }) }
</a><a href="#h8-0-46" id="h8-0-46" class="d">-
</a><a href="#h8-0-47" id="h8-0-47" class="d">-                        TextField(
</a><a href="#h8-0-48" id="h8-0-48" class="d">-                            value = textFieldValue,
</a><a href="#h8-0-49" id="h8-0-49" class="d">-                            onValueChange = {
</a><a href="#h8-0-50" id="h8-0-50" class="d">-                                textFieldValue = it
</a><a href="#h8-0-51" id="h8-0-51" class="d">-                            },
</a><a href="#h8-0-52" id="h8-0-52" class="d">-                            modifier = Modifier
</a><a href="#h8-0-53" id="h8-0-53" class="d">-                                .focusRequester(focusRequester)
</a><a href="#h8-0-54" id="h8-0-54" class="d">-                                .onGloballyPositioned {
</a><a href="#h8-0-55" id="h8-0-55" class="d">-                                    focusRequester.requestFocus()
</a><a href="#h8-0-56" id="h8-0-56" class="d">-                                }
</a><a href="#h8-0-57" id="h8-0-57" class="d">-                        )
</a><a href="#h8-0-58" id="h8-0-58" class="d">-                        Row(
</a><a href="#h8-0-59" id="h8-0-59" class="d">-                            modifier = Modifier.fillMaxWidth(),
</a><a href="#h8-0-60" id="h8-0-60" class="d">-                            horizontalArrangement = Arrangement.SpaceAround
</a><a href="#h8-0-61" id="h8-0-61" class="d">-                        ) {
</a><a href="#h8-0-62" id="h8-0-62" class="d">-                            Button(onClick = {
</a><a href="#h8-0-63" id="h8-0-63" class="d">-                                showDialog = false
</a><a href="#h8-0-64" id="h8-0-64" class="d">-                            }) {
</a><a href="#h8-0-65" id="h8-0-65" class="d">-                                Text(text = &quot;Cancel&quot;)
</a><a href="#h8-0-66" id="h8-0-66" class="d">-                            }
</a><a href="#h8-0-67" id="h8-0-67" class="d">-                            Button(onClick = {
</a><a href="#h8-0-68" id="h8-0-68" class="d">-                                setValue(textFieldValue.text)
</a><a href="#h8-0-69" id="h8-0-69" class="d">-                                showDialog = false
</a><a href="#h8-0-70" id="h8-0-70" class="d">-                            }) {
</a><a href="#h8-0-71" id="h8-0-71" class="d">-                                Text(text = &quot;Save&quot;)
</a><a href="#h8-0-72" id="h8-0-72" class="d">-                            }
</a><a href="#h8-0-73" id="h8-0-73" class="d">-                        }
</a><a href="#h8-0-74" id="h8-0-74" class="d">-                    }
</a><a href="#h8-0-75" id="h8-0-75" class="d">-                }
</a><a href="#h8-0-76" id="h8-0-76" class="d">-            }
</a><a href="#h8-0-77" id="h8-0-77" class="d">-        }
</a><a href="#h8-0-78" id="h8-0-78" class="d">-
</a><a href="#h8-0-79" id="h8-0-79" class="d">-        Row(
</a><a href="#h8-0-80" id="h8-0-80" class="d">-            modifier = Modifier
</a><a href="#h8-0-81" id="h8-0-81" class="d">-                .fillMaxWidth()
</a><a href="#h8-0-82" id="h8-0-82" class="d">-                .clickable {
</a><a href="#h8-0-83" id="h8-0-83" class="d">-                    showDialog = true
</a><a href="#h8-0-84" id="h8-0-84" class="d">-                },
</a><a href="#h8-0-85" id="h8-0-85" class="d">-            verticalAlignment = Alignment.CenterVertically
</a><a href="#h8-0-86" id="h8-0-86" class="d">-        ) {
</a><a href="#h8-0-87" id="h8-0-87" class="d">-            Column(
</a><a href="#h8-0-88" id="h8-0-88" class="d">-                modifier = Modifier
</a><a href="#h8-0-89" id="h8-0-89" class="d">-                    .weight(1f)
</a><a href="#h8-0-90" id="h8-0-90" class="d">-                    .padding(16.dp),
</a><a href="#h8-0-91" id="h8-0-91" class="d">-                verticalArrangement = Arrangement.spacedBy(4.dp)
</a><a href="#h8-0-92" id="h8-0-92" class="d">-            ) {
</a><a href="#h8-0-93" id="h8-0-93" class="d">-                Text(text = label, fontSize = 16.sp)
</a><a href="#h8-0-94" id="h8-0-94" class="d">-                Text(text = getValue() ?: &quot;(Not specified)&quot;, fontSize = 12.sp, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h8-0-95" id="h8-0-95" class="d">-            }
</a><a href="#h8-0-96" id="h8-0-96" class="d">-            Icon(imageVector = Icons.Default.Edit, contentDescription = null, modifier = Modifier.padding(16.dp))
</a><a href="#h8-0-97" id="h8-0-97" class="d">-        }
</a><a href="#h8-0-98" id="h8-0-98" class="d">-    }
</a><a href="#h8-0-99" id="h8-0-99" class="d">-
</a><a href="#h8-0-100" id="h8-0-100" class="d">-    @Composable
</a><a href="#h8-0-101" id="h8-0-101" class="d">-    override fun Content() {
</a><a href="#h8-0-102" id="h8-0-102" class="d">-        Column {
</a><a href="#h8-0-103" id="h8-0-103" class="d">-            Spacer(modifier = Modifier.height(16.dp))
</a><a href="#h8-0-104" id="h8-0-104" class="d">-            ConfigEditRow(
</a><a href="#h8-0-105" id="h8-0-105" class="d">-                getValue = { sharedConfig.snapchatPackageName },
</a><a href="#h8-0-106" id="h8-0-106" class="d">-                setValue = { sharedConfig.snapchatPackageName = it },
</a><a href="#h8-0-107" id="h8-0-107" class="d">-                label = &quot;Snapchat package name&quot;
</a><a href="#h8-0-108" id="h8-0-108" class="d">-            )
</a><a href="#h8-0-109" id="h8-0-109" class="d">-            ConfigEditRow(
</a><a href="#h8-0-110" id="h8-0-110" class="d">-                getValue = { sharedConfig.snapEnhancePackageName },
</a><a href="#h8-0-111" id="h8-0-111" class="d">-                setValue = { sharedConfig.snapEnhancePackageName = it },
</a><a href="#h8-0-112" id="h8-0-112" class="d">-                label = &quot;SnapEnhance package name&quot;
</a><a href="#h8-0-113" id="h8-0-113" class="d">-            )
</a><a href="#h8-0-114" id="h8-0-114" class="d">-        }
</a><a href="#h8-0-115" id="h8-0-115" class="d">-    }
</a><a href="#h8-0-116" id="h8-0-116" class="d">-}</a><a href="#h8-0-117" id="h8-0-117" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h9" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/Tab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/Tab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/Tab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/Tab.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,57 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+package me.rhunk.snapenhance.manager.ui.tab
</a><a href="#h9-0-1" id="h9-0-1" class="i">+
</a><a href="#h9-0-2" id="h9-0-2" class="i">+import android.os.Bundle
</a><a href="#h9-0-3" id="h9-0-3" class="i">+import android.widget.Toast
</a><a href="#h9-0-4" id="h9-0-4" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h9-0-5" id="h9-0-5" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h9-0-6" id="h9-0-6" class="i">+import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h9-0-7" id="h9-0-7" class="i">+import androidx.navigation.NavGraphBuilder
</a><a href="#h9-0-8" id="h9-0-8" class="i">+import androidx.navigation.compose.composable
</a><a href="#h9-0-9" id="h9-0-9" class="i">+import me.rhunk.snapenhance.manager.data.SharedConfig
</a><a href="#h9-0-10" id="h9-0-10" class="i">+import me.rhunk.snapenhance.manager.ui.Navigation
</a><a href="#h9-0-11" id="h9-0-11" class="i">+import kotlin.reflect.KClass
</a><a href="#h9-0-12" id="h9-0-12" class="i">+
</a><a href="#h9-0-13" id="h9-0-13" class="i">+open class Tab(
</a><a href="#h9-0-14" id="h9-0-14" class="i">+    val route: String,
</a><a href="#h9-0-15" id="h9-0-15" class="i">+    val isPrimary: Boolean = false,
</a><a href="#h9-0-16" id="h9-0-16" class="i">+    val icon: ImageVector? = null,
</a><a href="#h9-0-17" id="h9-0-17" class="i">+) {
</a><a href="#h9-0-18" id="h9-0-18" class="i">+    lateinit var activity: ComponentActivity
</a><a href="#h9-0-19" id="h9-0-19" class="i">+    val nestedTabs = mutableListOf&lt;Tab&gt;()
</a><a href="#h9-0-20" id="h9-0-20" class="i">+
</a><a href="#h9-0-21" id="h9-0-21" class="i">+    fun getNestedTab(tab: KClass&lt;out Tab&gt;) = nestedTabs.firstOrNull { it::class == tab }
</a><a href="#h9-0-22" id="h9-0-22" class="i">+
</a><a href="#h9-0-23" id="h9-0-23" class="i">+    fun registerNestedTab(tab: KClass&lt;out Tab&gt;) = nestedTabs.add((tab.java.constructors.first().newInstance() as Tab).also {
</a><a href="#h9-0-24" id="h9-0-24" class="i">+        it.init(activity)
</a><a href="#h9-0-25" id="h9-0-25" class="i">+    })
</a><a href="#h9-0-26" id="h9-0-26" class="i">+
</a><a href="#h9-0-27" id="h9-0-27" class="i">+    lateinit var navigation: Navigation
</a><a href="#h9-0-28" id="h9-0-28" class="i">+    lateinit var sharedConfig: SharedConfig
</a><a href="#h9-0-29" id="h9-0-29" class="i">+
</a><a href="#h9-0-30" id="h9-0-30" class="i">+    fun getArguments() = navigation.navHostController.currentBackStackEntry?.savedStateHandle?.get&lt;Bundle&gt;(&quot;args&quot;)
</a><a href="#h9-0-31" id="h9-0-31" class="i">+
</a><a href="#h9-0-32" id="h9-0-32" class="i">+    open fun init(activity: ComponentActivity) {
</a><a href="#h9-0-33" id="h9-0-33" class="i">+        this.activity = activity
</a><a href="#h9-0-34" id="h9-0-34" class="i">+    }
</a><a href="#h9-0-35" id="h9-0-35" class="i">+
</a><a href="#h9-0-36" id="h9-0-36" class="i">+    open fun build(navGraphBuilder: NavGraphBuilder) {
</a><a href="#h9-0-37" id="h9-0-37" class="i">+        navGraphBuilder.composable(route) {
</a><a href="#h9-0-38" id="h9-0-38" class="i">+            Content()
</a><a href="#h9-0-39" id="h9-0-39" class="i">+        }
</a><a href="#h9-0-40" id="h9-0-40" class="i">+    }
</a><a href="#h9-0-41" id="h9-0-41" class="i">+
</a><a href="#h9-0-42" id="h9-0-42" class="i">+    @Composable
</a><a href="#h9-0-43" id="h9-0-43" class="i">+    open fun TopBar() {}
</a><a href="#h9-0-44" id="h9-0-44" class="i">+
</a><a href="#h9-0-45" id="h9-0-45" class="i">+    @Composable
</a><a href="#h9-0-46" id="h9-0-46" class="i">+    open fun FloatingActionButtons() {}
</a><a href="#h9-0-47" id="h9-0-47" class="i">+
</a><a href="#h9-0-48" id="h9-0-48" class="i">+    @Composable
</a><a href="#h9-0-49" id="h9-0-49" class="i">+    open fun Content() {}
</a><a href="#h9-0-50" id="h9-0-50" class="i">+
</a><a href="#h9-0-51" id="h9-0-51" class="i">+    fun toast(message: String) {
</a><a href="#h9-0-52" id="h9-0-52" class="i">+        activity.runOnUiThread {
</a><a href="#h9-0-53" id="h9-0-53" class="i">+            Toast.makeText(activity, message, Toast.LENGTH_SHORT).show()
</a><a href="#h9-0-54" id="h9-0-54" class="i">+        }
</a><a href="#h9-0-55" id="h9-0-55" class="i">+    }
</a><a href="#h9-0-56" id="h9-0-56" class="i">+}</a><a href="#h9-0-57" id="h9-0-57" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/InstallPackageTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/InstallPackageTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/InstallPackageTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/InstallPackageTab.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,190 +0,0 @@
</a><a href="#h10-0-0" id="h10-0-0" class="d">-package me.rhunk.snapenhance.manager.ui.tab.download
</a><a href="#h10-0-1" id="h10-0-1" class="d">-
</a><a href="#h10-0-2" id="h10-0-2" class="d">-import android.content.Intent
</a><a href="#h10-0-3" id="h10-0-3" class="d">-import android.net.Uri
</a><a href="#h10-0-4" id="h10-0-4" class="d">-import android.widget.Toast
</a><a href="#h10-0-5" id="h10-0-5" class="d">-import androidx.activity.ComponentActivity
</a><a href="#h10-0-6" id="h10-0-6" class="d">-import androidx.activity.result.ActivityResultLauncher
</a><a href="#h10-0-7" id="h10-0-7" class="d">-import androidx.activity.result.contract.ActivityResultContracts
</a><a href="#h10-0-8" id="h10-0-8" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h10-0-9" id="h10-0-9" class="d">-import androidx.compose.material3.CircularProgressIndicator
</a><a href="#h10-0-10" id="h10-0-10" class="d">-import androidx.compose.material3.LinearProgressIndicator
</a><a href="#h10-0-11" id="h10-0-11" class="d">-import androidx.compose.material3.Text
</a><a href="#h10-0-12" id="h10-0-12" class="d">-import androidx.compose.runtime.*
</a><a href="#h10-0-13" id="h10-0-13" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h10-0-14" id="h10-0-14" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h10-0-15" id="h10-0-15" class="d">-import androidx.compose.ui.graphics.StrokeCap
</a><a href="#h10-0-16" id="h10-0-16" class="d">-import androidx.compose.ui.platform.LocalContext
</a><a href="#h10-0-17" id="h10-0-17" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h10-0-18" id="h10-0-18" class="d">-import androidx.core.content.FileProvider
</a><a href="#h10-0-19" id="h10-0-19" class="d">-import androidx.core.net.toUri
</a><a href="#h10-0-20" id="h10-0-20" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h10-0-21" id="h10-0-21" class="d">-import kotlinx.coroutines.launch
</a><a href="#h10-0-22" id="h10-0-22" class="d">-import me.rhunk.snapenhance.manager.data.download.InstallStage
</a><a href="#h10-0-23" id="h10-0-23" class="d">-import me.rhunk.snapenhance.manager.ui.Tab
</a><a href="#h10-0-24" id="h10-0-24" class="d">-import me.rhunk.snapenhance.manager.ui.tab.HomeTab
</a><a href="#h10-0-25" id="h10-0-25" class="d">-import okhttp3.OkHttpClient
</a><a href="#h10-0-26" id="h10-0-26" class="d">-import okhttp3.Request
</a><a href="#h10-0-27" id="h10-0-27" class="d">-import java.io.File
</a><a href="#h10-0-28" id="h10-0-28" class="d">-
</a><a href="#h10-0-29" id="h10-0-29" class="d">-
</a><a href="#h10-0-30" id="h10-0-30" class="d">-class InstallPackageTab : Tab(&quot;install_app&quot;) {
</a><a href="#h10-0-31" id="h10-0-31" class="d">-    private lateinit var installPackageIntentLauncher: ActivityResultLauncher&lt;Intent&gt;
</a><a href="#h10-0-32" id="h10-0-32" class="d">-    private lateinit var uninstallPackageIntentLauncher: ActivityResultLauncher&lt;Intent&gt;
</a><a href="#h10-0-33" id="h10-0-33" class="d">-    private var uninstallPackageCallback: ((resultCode: Int, data: Intent?) -&gt; Unit)? = null
</a><a href="#h10-0-34" id="h10-0-34" class="d">-    private var installPackageCallback: ((resultCode: Int, data: Intent?) -&gt; Unit)? = null
</a><a href="#h10-0-35" id="h10-0-35" class="d">-
</a><a href="#h10-0-36" id="h10-0-36" class="d">-    override fun init(activity: ComponentActivity) {
</a><a href="#h10-0-37" id="h10-0-37" class="d">-        super.init(activity)
</a><a href="#h10-0-38" id="h10-0-38" class="d">-        installPackageIntentLauncher = activity.registerForActivityResult(ActivityResultContracts.StartActivityForResult()) {
</a><a href="#h10-0-39" id="h10-0-39" class="d">-            installPackageCallback?.invoke(it.resultCode, it.data)
</a><a href="#h10-0-40" id="h10-0-40" class="d">-        }
</a><a href="#h10-0-41" id="h10-0-41" class="d">-        uninstallPackageIntentLauncher = activity.registerForActivityResult(ActivityResultContracts.StartActivityForResult()) {
</a><a href="#h10-0-42" id="h10-0-42" class="d">-            uninstallPackageCallback?.invoke(it.resultCode, it.data)
</a><a href="#h10-0-43" id="h10-0-43" class="d">-        }
</a><a href="#h10-0-44" id="h10-0-44" class="d">-    }
</a><a href="#h10-0-45" id="h10-0-45" class="d">-
</a><a href="#h10-0-46" id="h10-0-46" class="d">-    private fun downloadArtifact(url: String, progress: (Float) -&gt; Unit): File? {
</a><a href="#h10-0-47" id="h10-0-47" class="d">-        val urlScheme = Uri.parse(url).scheme
</a><a href="#h10-0-48" id="h10-0-48" class="d">-        if (urlScheme != &quot;https&quot; &amp;&amp; urlScheme != &quot;http&quot;) {
</a><a href="#h10-0-49" id="h10-0-49" class="d">-            val file = File(url)
</a><a href="#h10-0-50" id="h10-0-50" class="d">-            val dest = File(activity.externalCacheDirs.first(), file.name).also {
</a><a href="#h10-0-51" id="h10-0-51" class="d">-                it.deleteOnExit()
</a><a href="#h10-0-52" id="h10-0-52" class="d">-            }
</a><a href="#h10-0-53" id="h10-0-53" class="d">-            if (dest.exists()) return file
</a><a href="#h10-0-54" id="h10-0-54" class="d">-            file.copyTo(dest)
</a><a href="#h10-0-55" id="h10-0-55" class="d">-            return dest
</a><a href="#h10-0-56" id="h10-0-56" class="d">-        }
</a><a href="#h10-0-57" id="h10-0-57" class="d">-
</a><a href="#h10-0-58" id="h10-0-58" class="d">-        val endpoint = Request.Builder().url(url).build()
</a><a href="#h10-0-59" id="h10-0-59" class="d">-        val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h10-0-60" id="h10-0-60" class="d">-        if (!response.isSuccessful) throw Throwable(&quot;Failed to download artifact: ${response.code}&quot;)
</a><a href="#h10-0-61" id="h10-0-61" class="d">-
</a><a href="#h10-0-62" id="h10-0-62" class="d">-        return response.body.byteStream().use { input -&gt;
</a><a href="#h10-0-63" id="h10-0-63" class="d">-            val file = File.createTempFile(&quot;artifact&quot;, &quot;.apk&quot;, activity.externalCacheDirs.first()).also {
</a><a href="#h10-0-64" id="h10-0-64" class="d">-                it.deleteOnExit()
</a><a href="#h10-0-65" id="h10-0-65" class="d">-            }
</a><a href="#h10-0-66" id="h10-0-66" class="d">-            runCatching {
</a><a href="#h10-0-67" id="h10-0-67" class="d">-                file.outputStream().use { output -&gt;
</a><a href="#h10-0-68" id="h10-0-68" class="d">-                    val buffer = ByteArray(4 * 1024)
</a><a href="#h10-0-69" id="h10-0-69" class="d">-                    var read: Int
</a><a href="#h10-0-70" id="h10-0-70" class="d">-                    var totalRead = 0L
</a><a href="#h10-0-71" id="h10-0-71" class="d">-                    val totalSize = response.body.contentLength()
</a><a href="#h10-0-72" id="h10-0-72" class="d">-                    while (input.read(buffer).also { read = it } != -1) {
</a><a href="#h10-0-73" id="h10-0-73" class="d">-                        output.write(buffer, 0, read)
</a><a href="#h10-0-74" id="h10-0-74" class="d">-                        totalRead += read
</a><a href="#h10-0-75" id="h10-0-75" class="d">-                        progress(totalRead.toFloat() / totalSize.toFloat())
</a><a href="#h10-0-76" id="h10-0-76" class="d">-                    }
</a><a href="#h10-0-77" id="h10-0-77" class="d">-                }
</a><a href="#h10-0-78" id="h10-0-78" class="d">-                file
</a><a href="#h10-0-79" id="h10-0-79" class="d">-            }.getOrNull()
</a><a href="#h10-0-80" id="h10-0-80" class="d">-        }
</a><a href="#h10-0-81" id="h10-0-81" class="d">-    }
</a><a href="#h10-0-82" id="h10-0-82" class="d">-
</a><a href="#h10-0-83" id="h10-0-83" class="d">-
</a><a href="#h10-0-84" id="h10-0-84" class="d">-    @Composable
</a><a href="#h10-0-85" id="h10-0-85" class="d">-    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h10-0-86" id="h10-0-86" class="d">-    override fun Content() {
</a><a href="#h10-0-87" id="h10-0-87" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h10-0-88" id="h10-0-88" class="d">-        val context = LocalContext.current
</a><a href="#h10-0-89" id="h10-0-89" class="d">-        var installStage by remember { mutableStateOf(InstallStage.DOWNLOADING) }
</a><a href="#h10-0-90" id="h10-0-90" class="d">-        var downloadProgress by remember { mutableFloatStateOf(-1f) }
</a><a href="#h10-0-91" id="h10-0-91" class="d">-        var downloadedFile by remember { mutableStateOf&lt;File?&gt;(null) }
</a><a href="#h10-0-92" id="h10-0-92" class="d">-
</a><a href="#h10-0-93" id="h10-0-93" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h10-0-94" id="h10-0-94" class="d">-            uninstallPackageCallback = null
</a><a href="#h10-0-95" id="h10-0-95" class="d">-            installPackageCallback = null
</a><a href="#h10-0-96" id="h10-0-96" class="d">-        }
</a><a href="#h10-0-97" id="h10-0-97" class="d">-
</a><a href="#h10-0-98" id="h10-0-98" class="d">-        val downloadPath = getArguments()?.getString(&quot;downloadPath&quot;) ?: return
</a><a href="#h10-0-99" id="h10-0-99" class="d">-        val appPackage = getArguments()?.getString(&quot;appPackage&quot;) ?: return
</a><a href="#h10-0-100" id="h10-0-100" class="d">-        val shouldUninstall = getArguments()?.getBoolean(&quot;uninstall&quot;) ?: false
</a><a href="#h10-0-101" id="h10-0-101" class="d">-
</a><a href="#h10-0-102" id="h10-0-102" class="d">-        Column(
</a><a href="#h10-0-103" id="h10-0-103" class="d">-            modifier = Modifier.fillMaxSize().padding(16.dp),
</a><a href="#h10-0-104" id="h10-0-104" class="d">-            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h10-0-105" id="h10-0-105" class="d">-            verticalArrangement = Arrangement.spacedBy(16.dp, Alignment.CenterVertically)
</a><a href="#h10-0-106" id="h10-0-106" class="d">-        ) {
</a><a href="#h10-0-107" id="h10-0-107" class="d">-            Row(
</a><a href="#h10-0-108" id="h10-0-108" class="d">-                modifier = Modifier.fillMaxWidth(),
</a><a href="#h10-0-109" id="h10-0-109" class="d">-                horizontalArrangement = Arrangement.Center
</a><a href="#h10-0-110" id="h10-0-110" class="d">-            ) {
</a><a href="#h10-0-111" id="h10-0-111" class="d">-                if (installStage != InstallStage.DONE &amp;&amp; installStage != InstallStage.ERROR) {
</a><a href="#h10-0-112" id="h10-0-112" class="d">-                    CircularProgressIndicator()
</a><a href="#h10-0-113" id="h10-0-113" class="d">-                }
</a><a href="#h10-0-114" id="h10-0-114" class="d">-            }
</a><a href="#h10-0-115" id="h10-0-115" class="d">-
</a><a href="#h10-0-116" id="h10-0-116" class="d">-            when (installStage) {
</a><a href="#h10-0-117" id="h10-0-117" class="d">-                InstallStage.DOWNLOADING -&gt; {
</a><a href="#h10-0-118" id="h10-0-118" class="d">-                    Text(text = &quot;Downloading ...&quot;)
</a><a href="#h10-0-119" id="h10-0-119" class="d">-                    LinearProgressIndicator(progress = downloadProgress, Modifier.fillMaxWidth().height(4.dp), strokeCap = StrokeCap.Round)
</a><a href="#h10-0-120" id="h10-0-120" class="d">-                }
</a><a href="#h10-0-121" id="h10-0-121" class="d">-                InstallStage.UNINSTALLING -&gt; {
</a><a href="#h10-0-122" id="h10-0-122" class="d">-                    Text(text = &quot;Uninstalling app $appPackage...&quot;)
</a><a href="#h10-0-123" id="h10-0-123" class="d">-                }
</a><a href="#h10-0-124" id="h10-0-124" class="d">-                InstallStage.INSTALLING -&gt; {
</a><a href="#h10-0-125" id="h10-0-125" class="d">-                    Text(text = &quot;Installing ...&quot;)
</a><a href="#h10-0-126" id="h10-0-126" class="d">-                }
</a><a href="#h10-0-127" id="h10-0-127" class="d">-                InstallStage.DONE -&gt; {
</a><a href="#h10-0-128" id="h10-0-128" class="d">-                    LaunchedEffect(Unit) {
</a><a href="#h10-0-129" id="h10-0-129" class="d">-                        navigation.navigateTo(HomeTab::class, noHistory = true)
</a><a href="#h10-0-130" id="h10-0-130" class="d">-                        Toast.makeText(context, &quot;Successfully installed $appPackage!&quot;, Toast.LENGTH_SHORT).show()
</a><a href="#h10-0-131" id="h10-0-131" class="d">-                    }
</a><a href="#h10-0-132" id="h10-0-132" class="d">-                }
</a><a href="#h10-0-133" id="h10-0-133" class="d">-                InstallStage.ERROR -&gt; Text(text = &quot;Failed to install $appPackage. Check logcat for more details.&quot;)
</a><a href="#h10-0-134" id="h10-0-134" class="d">-            }
</a><a href="#h10-0-135" id="h10-0-135" class="d">-        }
</a><a href="#h10-0-136" id="h10-0-136" class="d">-
</a><a href="#h10-0-137" id="h10-0-137" class="d">-        fun installPackage() {
</a><a href="#h10-0-138" id="h10-0-138" class="d">-            installStage = InstallStage.INSTALLING
</a><a href="#h10-0-139" id="h10-0-139" class="d">-            installPackageCallback = resultCallbacks@{ code, _ -&gt;
</a><a href="#h10-0-140" id="h10-0-140" class="d">-                installStage = if (code != ComponentActivity.RESULT_OK) {
</a><a href="#h10-0-141" id="h10-0-141" class="d">-                    InstallStage.ERROR
</a><a href="#h10-0-142" id="h10-0-142" class="d">-                } else {
</a><a href="#h10-0-143" id="h10-0-143" class="d">-                    InstallStage.DONE
</a><a href="#h10-0-144" id="h10-0-144" class="d">-                }
</a><a href="#h10-0-145" id="h10-0-145" class="d">-                downloadedFile?.delete()
</a><a href="#h10-0-146" id="h10-0-146" class="d">-            }
</a><a href="#h10-0-147" id="h10-0-147" class="d">-
</a><a href="#h10-0-148" id="h10-0-148" class="d">-            installPackageIntentLauncher.launch(Intent(Intent.ACTION_INSTALL_PACKAGE).apply {
</a><a href="#h10-0-149" id="h10-0-149" class="d">-                data = FileProvider.getUriForFile(context, &quot;me.rhunk.snapenhance.manager.provider&quot;, downloadedFile!!)
</a><a href="#h10-0-150" id="h10-0-150" class="d">-                setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
</a><a href="#h10-0-151" id="h10-0-151" class="d">-                putExtra(Intent.EXTRA_RETURN_RESULT, true)
</a><a href="#h10-0-152" id="h10-0-152" class="d">-            })
</a><a href="#h10-0-153" id="h10-0-153" class="d">-        }
</a><a href="#h10-0-154" id="h10-0-154" class="d">-
</a><a href="#h10-0-155" id="h10-0-155" class="d">-
</a><a href="#h10-0-156" id="h10-0-156" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h10-0-157" id="h10-0-157" class="d">-            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h10-0-158" id="h10-0-158" class="d">-                runCatching {
</a><a href="#h10-0-159" id="h10-0-159" class="d">-                    downloadedFile = downloadArtifact(downloadPath) { downloadProgress = it } ?: run {
</a><a href="#h10-0-160" id="h10-0-160" class="d">-                        installStage = InstallStage.ERROR
</a><a href="#h10-0-161" id="h10-0-161" class="d">-                        return@launch
</a><a href="#h10-0-162" id="h10-0-162" class="d">-                    }
</a><a href="#h10-0-163" id="h10-0-163" class="d">-                    if (shouldUninstall) {
</a><a href="#h10-0-164" id="h10-0-164" class="d">-                        installStage = InstallStage.UNINSTALLING
</a><a href="#h10-0-165" id="h10-0-165" class="d">-                        val intent = Intent(Intent.ACTION_UNINSTALL_PACKAGE).apply {
</a><a href="#h10-0-166" id="h10-0-166" class="d">-                            data = &quot;package:$appPackage&quot;.toUri()
</a><a href="#h10-0-167" id="h10-0-167" class="d">-                            putExtra(Intent.EXTRA_RETURN_RESULT, true)
</a><a href="#h10-0-168" id="h10-0-168" class="d">-                        }
</a><a href="#h10-0-169" id="h10-0-169" class="d">-                        uninstallPackageCallback = resultCallback@{ resultCode, _ -&gt;
</a><a href="#h10-0-170" id="h10-0-170" class="d">-                            if (resultCode != ComponentActivity.RESULT_OK) {
</a><a href="#h10-0-171" id="h10-0-171" class="d">-                                installStage = InstallStage.ERROR
</a><a href="#h10-0-172" id="h10-0-172" class="d">-                                downloadedFile?.delete()
</a><a href="#h10-0-173" id="h10-0-173" class="d">-                                return@resultCallback
</a><a href="#h10-0-174" id="h10-0-174" class="d">-                            }
</a><a href="#h10-0-175" id="h10-0-175" class="d">-                            installPackage()
</a><a href="#h10-0-176" id="h10-0-176" class="d">-                        }
</a><a href="#h10-0-177" id="h10-0-177" class="d">-                        uninstallPackageIntentLauncher.launch(intent)
</a><a href="#h10-0-178" id="h10-0-178" class="d">-                    } else {
</a><a href="#h10-0-179" id="h10-0-179" class="d">-                        installPackage()
</a><a href="#h10-0-180" id="h10-0-180" class="d">-                    }
</a><a href="#h10-0-181" id="h10-0-181" class="d">-                }.onFailure {
</a><a href="#h10-0-182" id="h10-0-182" class="d">-                    it.printStackTrace()
</a><a href="#h10-0-183" id="h10-0-183" class="d">-                    installStage = InstallStage.ERROR
</a><a href="#h10-0-184" id="h10-0-184" class="d">-                    downloadedFile?.delete()
</a><a href="#h10-0-185" id="h10-0-185" class="d">-                }
</a><a href="#h10-0-186" id="h10-0-186" class="d">-            }
</a><a href="#h10-0-187" id="h10-0-187" class="d">-        }
</a><a href="#h10-0-188" id="h10-0-188" class="d">-    }
</a><a href="#h10-0-189" id="h10-0-189" class="d">-}
</a><b>diff --git a/<a id="h11" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/LSPatchTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/LSPatchTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/LSPatchTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/LSPatchTab.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,197 +0,0 @@
</a><a href="#h11-0-0" id="h11-0-0" class="d">-package me.rhunk.snapenhance.manager.ui.tab.download
</a><a href="#h11-0-1" id="h11-0-1" class="d">-
</a><a href="#h11-0-2" id="h11-0-2" class="d">-import android.os.Bundle
</a><a href="#h11-0-3" id="h11-0-3" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h11-0-4" id="h11-0-4" class="d">-import androidx.compose.foundation.rememberScrollState
</a><a href="#h11-0-5" id="h11-0-5" class="d">-import androidx.compose.foundation.verticalScroll
</a><a href="#h11-0-6" id="h11-0-6" class="d">-import androidx.compose.material3.Button
</a><a href="#h11-0-7" id="h11-0-7" class="d">-import androidx.compose.material3.Card
</a><a href="#h11-0-8" id="h11-0-8" class="d">-import androidx.compose.material3.LinearProgressIndicator
</a><a href="#h11-0-9" id="h11-0-9" class="d">-import androidx.compose.material3.Text
</a><a href="#h11-0-10" id="h11-0-10" class="d">-import androidx.compose.runtime.*
</a><a href="#h11-0-11" id="h11-0-11" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h11-0-12" id="h11-0-12" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h11-0-13" id="h11-0-13" class="d">-import androidx.compose.ui.graphics.StrokeCap
</a><a href="#h11-0-14" id="h11-0-14" class="d">-import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h11-0-15" id="h11-0-15" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h11-0-16" id="h11-0-16" class="d">-import androidx.compose.ui.window.Dialog
</a><a href="#h11-0-17" id="h11-0-17" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h11-0-18" id="h11-0-18" class="d">-import kotlinx.coroutines.launch
</a><a href="#h11-0-19" id="h11-0-19" class="d">-import me.rhunk.snapenhance.manager.data.APKMirror
</a><a href="#h11-0-20" id="h11-0-20" class="d">-import me.rhunk.snapenhance.manager.data.DownloadItem
</a><a href="#h11-0-21" id="h11-0-21" class="d">-import me.rhunk.snapenhance.manager.lspatch.LSPatch
</a><a href="#h11-0-22" id="h11-0-22" class="d">-import me.rhunk.snapenhance.manager.ui.Tab
</a><a href="#h11-0-23" id="h11-0-23" class="d">-import me.rhunk.snapenhance.manager.ui.components.DowngradeNoticeDialog
</a><a href="#h11-0-24" id="h11-0-24" class="d">-import okio.use
</a><a href="#h11-0-25" id="h11-0-25" class="d">-import java.io.File
</a><a href="#h11-0-26" id="h11-0-26" class="d">-
</a><a href="#h11-0-27" id="h11-0-27" class="d">-class LSPatchTab : Tab(&quot;lspatch&quot;) {
</a><a href="#h11-0-28" id="h11-0-28" class="d">-    private lateinit var downloadItem: DownloadItem
</a><a href="#h11-0-29" id="h11-0-29" class="d">-    private var snapEnhanceModule: File? = null
</a><a href="#h11-0-30" id="h11-0-30" class="d">-    private var patchedApk by mutableStateOf&lt;File?&gt;(null)
</a><a href="#h11-0-31" id="h11-0-31" class="d">-    private val apkMirror = APKMirror()
</a><a href="#h11-0-32" id="h11-0-32" class="d">-
</a><a href="#h11-0-33" id="h11-0-33" class="d">-    private fun patch(log: (Any?) -&gt; Unit, onProgress: (Float) -&gt; Unit) {
</a><a href="#h11-0-34" id="h11-0-34" class="d">-        log(&quot;Fetching download link for ${downloadItem.title}...&quot;)
</a><a href="#h11-0-35" id="h11-0-35" class="d">-        val downloadLink = apkMirror.fetchDownloadLink(downloadItem.downloadPage) ?: run {
</a><a href="#h11-0-36" id="h11-0-36" class="d">-            log(&quot;== Failed to fetch download link ==&quot;)
</a><a href="#h11-0-37" id="h11-0-37" class="d">-            return
</a><a href="#h11-0-38" id="h11-0-38" class="d">-        }
</a><a href="#h11-0-39" id="h11-0-39" class="d">-
</a><a href="#h11-0-40" id="h11-0-40" class="d">-        log(&quot;Downloading apk...&quot;)
</a><a href="#h11-0-41" id="h11-0-41" class="d">-
</a><a href="#h11-0-42" id="h11-0-42" class="d">-        val downloadResponse = apkMirror.okhttpClient.newCall(
</a><a href="#h11-0-43" id="h11-0-43" class="d">-            okhttp3.Request.Builder()
</a><a href="#h11-0-44" id="h11-0-44" class="d">-                .url(downloadLink)
</a><a href="#h11-0-45" id="h11-0-45" class="d">-                .build()
</a><a href="#h11-0-46" id="h11-0-46" class="d">-        ).execute()
</a><a href="#h11-0-47" id="h11-0-47" class="d">-
</a><a href="#h11-0-48" id="h11-0-48" class="d">-        if (!downloadResponse.isSuccessful) {
</a><a href="#h11-0-49" id="h11-0-49" class="d">-            log(&quot;== Failed to download apk ==&quot;)
</a><a href="#h11-0-50" id="h11-0-50" class="d">-            log(&quot;Response code: ${downloadResponse.code}&quot;)
</a><a href="#h11-0-51" id="h11-0-51" class="d">-            return
</a><a href="#h11-0-52" id="h11-0-52" class="d">-        }
</a><a href="#h11-0-53" id="h11-0-53" class="d">-
</a><a href="#h11-0-54" id="h11-0-54" class="d">-        val apkFile = sharedConfig.apkCache.resolve(&quot;${downloadItem.hash}.apk&quot;)
</a><a href="#h11-0-55" id="h11-0-55" class="d">-        apkFile.outputStream().use { outputStream -&gt;
</a><a href="#h11-0-56" id="h11-0-56" class="d">-            runCatching {
</a><a href="#h11-0-57" id="h11-0-57" class="d">-                downloadResponse.body.byteStream().use { inputStream -&gt;
</a><a href="#h11-0-58" id="h11-0-58" class="d">-                    val buffer = ByteArray(DEFAULT_BUFFER_SIZE)
</a><a href="#h11-0-59" id="h11-0-59" class="d">-                    var read: Int
</a><a href="#h11-0-60" id="h11-0-60" class="d">-                    var totalRead = 0L
</a><a href="#h11-0-61" id="h11-0-61" class="d">-                    val totalSize = downloadResponse.body.contentLength()
</a><a href="#h11-0-62" id="h11-0-62" class="d">-                    while (inputStream.read(buffer).also { read = it } != -1) {
</a><a href="#h11-0-63" id="h11-0-63" class="d">-                        outputStream.write(buffer, 0, read)
</a><a href="#h11-0-64" id="h11-0-64" class="d">-                        totalRead += read
</a><a href="#h11-0-65" id="h11-0-65" class="d">-                        onProgress(totalRead.toFloat() / totalSize.toFloat())
</a><a href="#h11-0-66" id="h11-0-66" class="d">-                    }
</a><a href="#h11-0-67" id="h11-0-67" class="d">-                }
</a><a href="#h11-0-68" id="h11-0-68" class="d">-            }.onFailure {
</a><a href="#h11-0-69" id="h11-0-69" class="d">-                log(&quot;== Failed to download apk ==&quot;)
</a><a href="#h11-0-70" id="h11-0-70" class="d">-                log(it)
</a><a href="#h11-0-71" id="h11-0-71" class="d">-                return
</a><a href="#h11-0-72" id="h11-0-72" class="d">-            }
</a><a href="#h11-0-73" id="h11-0-73" class="d">-        }
</a><a href="#h11-0-74" id="h11-0-74" class="d">-
</a><a href="#h11-0-75" id="h11-0-75" class="d">-        apkFile.renameTo(File(activity.externalCacheDir!!, &quot;base.apk&quot;))
</a><a href="#h11-0-76" id="h11-0-76" class="d">-
</a><a href="#h11-0-77" id="h11-0-77" class="d">-        log(&quot;== Downloaded apk ==&quot;)
</a><a href="#h11-0-78" id="h11-0-78" class="d">-        snapEnhanceModule?.let { module -&gt;
</a><a href="#h11-0-79" id="h11-0-79" class="d">-            val lsPatch = LSPatch(activity, mapOf(
</a><a href="#h11-0-80" id="h11-0-80" class="d">-                sharedConfig.snapEnhancePackageName to module,
</a><a href="#h11-0-81" id="h11-0-81" class="d">-            ), printLog = {
</a><a href="#h11-0-82" id="h11-0-82" class="d">-                log(&quot;[LSPatch] $it&quot;)
</a><a href="#h11-0-83" id="h11-0-83" class="d">-            })
</a><a href="#h11-0-84" id="h11-0-84" class="d">-
</a><a href="#h11-0-85" id="h11-0-85" class="d">-            log(&quot;== Patching apk ==&quot;)
</a><a href="#h11-0-86" id="h11-0-86" class="d">-            val outputFiles = lsPatch.patchSplits(listOf(apkFile))
</a><a href="#h11-0-87" id="h11-0-87" class="d">-
</a><a href="#h11-0-88" id="h11-0-88" class="d">-            patchedApk = outputFiles[&quot;base.apk&quot;] ?: run {
</a><a href="#h11-0-89" id="h11-0-89" class="d">-                log(&quot;== Failed to patch apk ==&quot;)
</a><a href="#h11-0-90" id="h11-0-90" class="d">-                return
</a><a href="#h11-0-91" id="h11-0-91" class="d">-            }
</a><a href="#h11-0-92" id="h11-0-92" class="d">-            return@let
</a><a href="#h11-0-93" id="h11-0-93" class="d">-        }
</a><a href="#h11-0-94" id="h11-0-94" class="d">-        patchedApk = apkFile
</a><a href="#h11-0-95" id="h11-0-95" class="d">-    }
</a><a href="#h11-0-96" id="h11-0-96" class="d">-
</a><a href="#h11-0-97" id="h11-0-97" class="d">-    @Composable
</a><a href="#h11-0-98" id="h11-0-98" class="d">-    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h11-0-99" id="h11-0-99" class="d">-    override fun Content() {
</a><a href="#h11-0-100" id="h11-0-100" class="d">-        this.downloadItem = remember { getArguments()?.getParcelable&lt;DownloadItem&gt;(&quot;downloadItem&quot;) } ?: return
</a><a href="#h11-0-101" id="h11-0-101" class="d">-        this.snapEnhanceModule = remember {
</a><a href="#h11-0-102" id="h11-0-102" class="d">-            getArguments()?.getString(&quot;modulePath&quot;)?.let {
</a><a href="#h11-0-103" id="h11-0-103" class="d">-                File(it)
</a><a href="#h11-0-104" id="h11-0-104" class="d">-            }
</a><a href="#h11-0-105" id="h11-0-105" class="d">-        }
</a><a href="#h11-0-106" id="h11-0-106" class="d">-
</a><a href="#h11-0-107" id="h11-0-107" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h11-0-108" id="h11-0-108" class="d">-        var showDowngradeNoticeDialog by remember { mutableStateOf(false) }
</a><a href="#h11-0-109" id="h11-0-109" class="d">-
</a><a href="#h11-0-110" id="h11-0-110" class="d">-        var status by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h11-0-111" id="h11-0-111" class="d">-        var progress by remember { mutableFloatStateOf(-1f) }
</a><a href="#h11-0-112" id="h11-0-112" class="d">-
</a><a href="#h11-0-113" id="h11-0-113" class="d">-        LaunchedEffect(this.downloadItem.hash) {
</a><a href="#h11-0-114" id="h11-0-114" class="d">-            patchedApk = null
</a><a href="#h11-0-115" id="h11-0-115" class="d">-            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h11-0-116" id="h11-0-116" class="d">-                runCatching {
</a><a href="#h11-0-117" id="h11-0-117" class="d">-                    patch(log = {
</a><a href="#h11-0-118" id="h11-0-118" class="d">-                        coroutineScope.launch {
</a><a href="#h11-0-119" id="h11-0-119" class="d">-                            status += when (it) {
</a><a href="#h11-0-120" id="h11-0-120" class="d">-                                is Throwable -&gt; it.message + &quot;\n&quot; + it.stackTraceToString()
</a><a href="#h11-0-121" id="h11-0-121" class="d">-                                else -&gt; it.toString()
</a><a href="#h11-0-122" id="h11-0-122" class="d">-                            } + &quot;\n&quot;
</a><a href="#h11-0-123" id="h11-0-123" class="d">-                        }
</a><a href="#h11-0-124" id="h11-0-124" class="d">-                    }) {
</a><a href="#h11-0-125" id="h11-0-125" class="d">-                        progress = it
</a><a href="#h11-0-126" id="h11-0-126" class="d">-                    }
</a><a href="#h11-0-127" id="h11-0-127" class="d">-                }.onFailure {
</a><a href="#h11-0-128" id="h11-0-128" class="d">-                    coroutineScope.launch {
</a><a href="#h11-0-129" id="h11-0-129" class="d">-                        status += it.message + &quot;\n&quot; + it.stackTraceToString()
</a><a href="#h11-0-130" id="h11-0-130" class="d">-                    }
</a><a href="#h11-0-131" id="h11-0-131" class="d">-                }
</a><a href="#h11-0-132" id="h11-0-132" class="d">-            }
</a><a href="#h11-0-133" id="h11-0-133" class="d">-        }
</a><a href="#h11-0-134" id="h11-0-134" class="d">-
</a><a href="#h11-0-135" id="h11-0-135" class="d">-        val scrollState = rememberScrollState()
</a><a href="#h11-0-136" id="h11-0-136" class="d">-
</a><a href="#h11-0-137" id="h11-0-137" class="d">-        fun triggerInstallation(shouldUninstall: Boolean) {
</a><a href="#h11-0-138" id="h11-0-138" class="d">-            navigation.navigateTo(InstallPackageTab::class, args = Bundle().apply {
</a><a href="#h11-0-139" id="h11-0-139" class="d">-                putString(&quot;downloadPath&quot;, patchedApk?.absolutePath)
</a><a href="#h11-0-140" id="h11-0-140" class="d">-                putString(&quot;appPackage&quot;, sharedConfig.snapchatPackageName)
</a><a href="#h11-0-141" id="h11-0-141" class="d">-                putBoolean(&quot;uninstall&quot;, shouldUninstall)
</a><a href="#h11-0-142" id="h11-0-142" class="d">-            })
</a><a href="#h11-0-143" id="h11-0-143" class="d">-        }
</a><a href="#h11-0-144" id="h11-0-144" class="d">-
</a><a href="#h11-0-145" id="h11-0-145" class="d">-        Column(
</a><a href="#h11-0-146" id="h11-0-146" class="d">-            modifier = Modifier
</a><a href="#h11-0-147" id="h11-0-147" class="d">-                .fillMaxSize()
</a><a href="#h11-0-148" id="h11-0-148" class="d">-                .padding(20.dp),
</a><a href="#h11-0-149" id="h11-0-149" class="d">-            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h11-0-150" id="h11-0-150" class="d">-            verticalArrangement = Arrangement.spacedBy(10.dp)
</a><a href="#h11-0-151" id="h11-0-151" class="d">-        ) {
</a><a href="#h11-0-152" id="h11-0-152" class="d">-            Card(
</a><a href="#h11-0-153" id="h11-0-153" class="d">-                modifier = Modifier
</a><a href="#h11-0-154" id="h11-0-154" class="d">-                    .weight(1f)
</a><a href="#h11-0-155" id="h11-0-155" class="d">-                    .padding(10.dp),
</a><a href="#h11-0-156" id="h11-0-156" class="d">-            ) {
</a><a href="#h11-0-157" id="h11-0-157" class="d">-                Column(
</a><a href="#h11-0-158" id="h11-0-158" class="d">-                    modifier = Modifier
</a><a href="#h11-0-159" id="h11-0-159" class="d">-                        .fillMaxSize()
</a><a href="#h11-0-160" id="h11-0-160" class="d">-                        .verticalScroll(scrollState)
</a><a href="#h11-0-161" id="h11-0-161" class="d">-                ) {
</a><a href="#h11-0-162" id="h11-0-162" class="d">-                    Text(text = status, overflow = TextOverflow.Visible, modifier = Modifier.padding(10.dp))
</a><a href="#h11-0-163" id="h11-0-163" class="d">-                }
</a><a href="#h11-0-164" id="h11-0-164" class="d">-            }
</a><a href="#h11-0-165" id="h11-0-165" class="d">-            if (progress != -1f) {
</a><a href="#h11-0-166" id="h11-0-166" class="d">-                LinearProgressIndicator(progress = progress, modifier = Modifier.height(10.dp), strokeCap = StrokeCap.Round)
</a><a href="#h11-0-167" id="h11-0-167" class="d">-            }
</a><a href="#h11-0-168" id="h11-0-168" class="d">-
</a><a href="#h11-0-169" id="h11-0-169" class="d">-            if (patchedApk != null) {
</a><a href="#h11-0-170" id="h11-0-170" class="d">-                Button(modifier = Modifier.fillMaxWidth(), onClick = {
</a><a href="#h11-0-171" id="h11-0-171" class="d">-                    triggerInstallation(true)
</a><a href="#h11-0-172" id="h11-0-172" class="d">-                }) {
</a><a href="#h11-0-173" id="h11-0-173" class="d">-                    Text(text = &quot;Uninstall &amp; Install&quot;)
</a><a href="#h11-0-174" id="h11-0-174" class="d">-                }
</a><a href="#h11-0-175" id="h11-0-175" class="d">-
</a><a href="#h11-0-176" id="h11-0-176" class="d">-                Button(modifier = Modifier.fillMaxWidth(), onClick = {
</a><a href="#h11-0-177" id="h11-0-177" class="d">-                    showDowngradeNoticeDialog = true
</a><a href="#h11-0-178" id="h11-0-178" class="d">-                }) {
</a><a href="#h11-0-179" id="h11-0-179" class="d">-                    Text(text = &quot;Update&quot;)
</a><a href="#h11-0-180" id="h11-0-180" class="d">-                }
</a><a href="#h11-0-181" id="h11-0-181" class="d">-            }
</a><a href="#h11-0-182" id="h11-0-182" class="d">-
</a><a href="#h11-0-183" id="h11-0-183" class="d">-            LaunchedEffect(status) {
</a><a href="#h11-0-184" id="h11-0-184" class="d">-                scrollState.scrollTo(scrollState.maxValue)
</a><a href="#h11-0-185" id="h11-0-185" class="d">-            }
</a><a href="#h11-0-186" id="h11-0-186" class="d">-        }
</a><a href="#h11-0-187" id="h11-0-187" class="d">-
</a><a href="#h11-0-188" id="h11-0-188" class="d">-        if (showDowngradeNoticeDialog) {
</a><a href="#h11-0-189" id="h11-0-189" class="d">-            Dialog(onDismissRequest = { showDowngradeNoticeDialog = false }) {
</a><a href="#h11-0-190" id="h11-0-190" class="d">-                DowngradeNoticeDialog(onDismiss = { showDowngradeNoticeDialog = false }, onSuccess = {
</a><a href="#h11-0-191" id="h11-0-191" class="d">-                    triggerInstallation(false)
</a><a href="#h11-0-192" id="h11-0-192" class="d">-                })
</a><a href="#h11-0-193" id="h11-0-193" class="d">-            }
</a><a href="#h11-0-194" id="h11-0-194" class="d">-        }
</a><a href="#h11-0-195" id="h11-0-195" class="d">-    }
</a><a href="#h11-0-196" id="h11-0-196" class="d">-}</a><a href="#h11-0-197" id="h11-0-197" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h12" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SEDownloadTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SEDownloadTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SEDownloadTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SEDownloadTab.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,245 +0,0 @@
</a><a href="#h12-0-0" id="h12-0-0" class="d">-package me.rhunk.snapenhance.manager.ui.tab.download
</a><a href="#h12-0-1" id="h12-0-1" class="d">-
</a><a href="#h12-0-2" id="h12-0-2" class="d">-import android.os.Bundle
</a><a href="#h12-0-3" id="h12-0-3" class="d">-import androidx.activity.ComponentActivity
</a><a href="#h12-0-4" id="h12-0-4" class="d">-import androidx.compose.foundation.background
</a><a href="#h12-0-5" id="h12-0-5" class="d">-import androidx.compose.foundation.border
</a><a href="#h12-0-6" id="h12-0-6" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h12-0-7" id="h12-0-7" class="d">-import androidx.compose.foundation.layout.Arrangement
</a><a href="#h12-0-8" id="h12-0-8" class="d">-import androidx.compose.foundation.layout.Column
</a><a href="#h12-0-9" id="h12-0-9" class="d">-import androidx.compose.foundation.layout.Row
</a><a href="#h12-0-10" id="h12-0-10" class="d">-import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h12-0-11" id="h12-0-11" class="d">-import androidx.compose.foundation.layout.padding
</a><a href="#h12-0-12" id="h12-0-12" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h12-0-13" id="h12-0-13" class="d">-import androidx.compose.foundation.lazy.items
</a><a href="#h12-0-14" id="h12-0-14" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h12-0-15" id="h12-0-15" class="d">-import androidx.compose.material.icons.filled.Android
</a><a href="#h12-0-16" id="h12-0-16" class="d">-import androidx.compose.material3.*
</a><a href="#h12-0-17" id="h12-0-17" class="d">-import androidx.compose.runtime.*
</a><a href="#h12-0-18" id="h12-0-18" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h12-0-19" id="h12-0-19" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h12-0-20" id="h12-0-20" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h12-0-21" id="h12-0-21" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h12-0-22" id="h12-0-22" class="d">-import androidx.compose.ui.window.Dialog
</a><a href="#h12-0-23" id="h12-0-23" class="d">-import com.google.gson.JsonParser
</a><a href="#h12-0-24" id="h12-0-24" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h12-0-25" id="h12-0-25" class="d">-import kotlinx.coroutines.launch
</a><a href="#h12-0-26" id="h12-0-26" class="d">-import me.rhunk.snapenhance.manager.data.download.SEArtifact
</a><a href="#h12-0-27" id="h12-0-27" class="d">-import me.rhunk.snapenhance.manager.data.download.SEVersion
</a><a href="#h12-0-28" id="h12-0-28" class="d">-import me.rhunk.snapenhance.manager.ui.Tab
</a><a href="#h12-0-29" id="h12-0-29" class="d">-import me.rhunk.snapenhance.manager.ui.components.DowngradeNoticeDialog
</a><a href="#h12-0-30" id="h12-0-30" class="d">-import okhttp3.OkHttpClient
</a><a href="#h12-0-31" id="h12-0-31" class="d">-import okhttp3.Request
</a><a href="#h12-0-32" id="h12-0-32" class="d">-import java.text.SimpleDateFormat
</a><a href="#h12-0-33" id="h12-0-33" class="d">-import java.util.Locale
</a><a href="#h12-0-34" id="h12-0-34" class="d">-
</a><a href="#h12-0-35" id="h12-0-35" class="d">-
</a><a href="#h12-0-36" id="h12-0-36" class="d">-class SEDownloadTab : Tab(&quot;se_download&quot;) {
</a><a href="#h12-0-37" id="h12-0-37" class="d">-    private fun fetchSEReleases(): List&lt;SEVersion&gt;? {
</a><a href="#h12-0-38" id="h12-0-38" class="d">-        return runCatching {
</a><a href="#h12-0-39" id="h12-0-39" class="d">-            val endpoint = Request.Builder().url(&quot;https://api.github.com/repos/rhunk/SnapEnhance/releases&quot;).build()
</a><a href="#h12-0-40" id="h12-0-40" class="d">-            val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h12-0-41" id="h12-0-41" class="d">-            if (!response.isSuccessful) return null
</a><a href="#h12-0-42" id="h12-0-42" class="d">-
</a><a href="#h12-0-43" id="h12-0-43" class="d">-            val releases = JsonParser.parseString(response.body.string()).asJsonArray.also {
</a><a href="#h12-0-44" id="h12-0-44" class="d">-                if (it.size() == 0) return null
</a><a href="#h12-0-45" id="h12-0-45" class="d">-            }
</a><a href="#h12-0-46" id="h12-0-46" class="d">-            val isoDateFormat = SimpleDateFormat(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&#39;Z&#39;&quot;, Locale.getDefault())
</a><a href="#h12-0-47" id="h12-0-47" class="d">-
</a><a href="#h12-0-48" id="h12-0-48" class="d">-            releases.map { releaseObject -&gt;
</a><a href="#h12-0-49" id="h12-0-49" class="d">-                val release = releaseObject.asJsonObject
</a><a href="#h12-0-50" id="h12-0-50" class="d">-                val versionName = release.getAsJsonPrimitive(&quot;tag_name&quot;).asString
</a><a href="#h12-0-51" id="h12-0-51" class="d">-                val releaseDate = release.getAsJsonPrimitive(&quot;published_at&quot;).asString.let { time -&gt;
</a><a href="#h12-0-52" id="h12-0-52" class="d">-                    isoDateFormat.parse(time)?.let { date -&gt;
</a><a href="#h12-0-53" id="h12-0-53" class="d">-                        SimpleDateFormat(&quot;dd MMM yyyy&quot;, Locale.getDefault()).format(date)
</a><a href="#h12-0-54" id="h12-0-54" class="d">-                    } ?: time
</a><a href="#h12-0-55" id="h12-0-55" class="d">-                }
</a><a href="#h12-0-56" id="h12-0-56" class="d">-                val downloadAssets = release.getAsJsonArray(&quot;assets&quot;).associate { asset -&gt;
</a><a href="#h12-0-57" id="h12-0-57" class="d">-                    val assetObject = asset.asJsonObject
</a><a href="#h12-0-58" id="h12-0-58" class="d">-                    SEArtifact(
</a><a href="#h12-0-59" id="h12-0-59" class="d">-                        fileName = assetObject.getAsJsonPrimitive(&quot;name&quot;).asString,
</a><a href="#h12-0-60" id="h12-0-60" class="d">-                        size = assetObject.getAsJsonPrimitive(&quot;size&quot;).asLong,
</a><a href="#h12-0-61" id="h12-0-61" class="d">-                        downloadUrl = assetObject.getAsJsonPrimitive(&quot;browser_download_url&quot;).asString
</a><a href="#h12-0-62" id="h12-0-62" class="d">-                    ).let { it.fileName to it }
</a><a href="#h12-0-63" id="h12-0-63" class="d">-                }
</a><a href="#h12-0-64" id="h12-0-64" class="d">-                SEVersion(versionName, releaseDate, downloadAssets)
</a><a href="#h12-0-65" id="h12-0-65" class="d">-            }
</a><a href="#h12-0-66" id="h12-0-66" class="d">-        }.onFailure {
</a><a href="#h12-0-67" id="h12-0-67" class="d">-            it.printStackTrace()
</a><a href="#h12-0-68" id="h12-0-68" class="d">-        }.getOrNull()
</a><a href="#h12-0-69" id="h12-0-69" class="d">-    }
</a><a href="#h12-0-70" id="h12-0-70" class="d">-
</a><a href="#h12-0-71" id="h12-0-71" class="d">-    override fun init(activity: ComponentActivity) {
</a><a href="#h12-0-72" id="h12-0-72" class="d">-        super.init(activity)
</a><a href="#h12-0-73" id="h12-0-73" class="d">-    }
</a><a href="#h12-0-74" id="h12-0-74" class="d">-
</a><a href="#h12-0-75" id="h12-0-75" class="d">-    @Composable
</a><a href="#h12-0-76" id="h12-0-76" class="d">-    override fun Content() {
</a><a href="#h12-0-77" id="h12-0-77" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h12-0-78" id="h12-0-78" class="d">-        val snapEnhanceReleases = remember {
</a><a href="#h12-0-79" id="h12-0-79" class="d">-            mutableStateOf(null as List&lt;SEVersion&gt;?)
</a><a href="#h12-0-80" id="h12-0-80" class="d">-        }
</a><a href="#h12-0-81" id="h12-0-81" class="d">-
</a><a href="#h12-0-82" id="h12-0-82" class="d">-        var selectedVersion by remember { mutableStateOf(null as SEVersion?) }
</a><a href="#h12-0-83" id="h12-0-83" class="d">-        var selectedArtifact by remember { mutableStateOf(null as SEArtifact?) }
</a><a href="#h12-0-84" id="h12-0-84" class="d">-        val isAppInstalled = remember { runCatching { activity.packageManager.getPackageInfo(sharedConfig.snapEnhancePackageName, 0) != null }.getOrNull() != null }
</a><a href="#h12-0-85" id="h12-0-85" class="d">-
</a><a href="#h12-0-86" id="h12-0-86" class="d">-        var showDowngradeNotice by remember { mutableStateOf(false) }
</a><a href="#h12-0-87" id="h12-0-87" class="d">-
</a><a href="#h12-0-88" id="h12-0-88" class="d">-        fun triggerPackageInstallation(shouldUninstall: Boolean) {
</a><a href="#h12-0-89" id="h12-0-89" class="d">-            navigation.navigateTo(InstallPackageTab::class, Bundle().apply {
</a><a href="#h12-0-90" id="h12-0-90" class="d">-                putString(&quot;downloadPath&quot;, selectedArtifact?.downloadUrl)
</a><a href="#h12-0-91" id="h12-0-91" class="d">-                putString(&quot;appPackage&quot;, sharedConfig.snapEnhancePackageName)
</a><a href="#h12-0-92" id="h12-0-92" class="d">-                putBoolean(&quot;uninstall&quot;, shouldUninstall)
</a><a href="#h12-0-93" id="h12-0-93" class="d">-            }, noHistory = true)
</a><a href="#h12-0-94" id="h12-0-94" class="d">-        }
</a><a href="#h12-0-95" id="h12-0-95" class="d">-
</a><a href="#h12-0-96" id="h12-0-96" class="d">-        if (showDowngradeNotice) {
</a><a href="#h12-0-97" id="h12-0-97" class="d">-            Dialog(onDismissRequest = { showDowngradeNotice = false }) {
</a><a href="#h12-0-98" id="h12-0-98" class="d">-                DowngradeNoticeDialog(onDismiss = { showDowngradeNotice = false }, onSuccess = {
</a><a href="#h12-0-99" id="h12-0-99" class="d">-                    triggerPackageInstallation(false)
</a><a href="#h12-0-100" id="h12-0-100" class="d">-                })
</a><a href="#h12-0-101" id="h12-0-101" class="d">-            }
</a><a href="#h12-0-102" id="h12-0-102" class="d">-        }
</a><a href="#h12-0-103" id="h12-0-103" class="d">-
</a><a href="#h12-0-104" id="h12-0-104" class="d">-        Column(
</a><a href="#h12-0-105" id="h12-0-105" class="d">-            modifier = Modifier
</a><a href="#h12-0-106" id="h12-0-106" class="d">-                .fillMaxWidth()
</a><a href="#h12-0-107" id="h12-0-107" class="d">-                .padding(16.dp),
</a><a href="#h12-0-108" id="h12-0-108" class="d">-            verticalArrangement = Arrangement.spacedBy(16.dp),
</a><a href="#h12-0-109" id="h12-0-109" class="d">-            horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h12-0-110" id="h12-0-110" class="d">-        ) {
</a><a href="#h12-0-111" id="h12-0-111" class="d">-            Text(text = &quot;Choose SnapEnhance version&quot;)
</a><a href="#h12-0-112" id="h12-0-112" class="d">-
</a><a href="#h12-0-113" id="h12-0-113" class="d">-            LazyColumn(
</a><a href="#h12-0-114" id="h12-0-114" class="d">-                modifier = Modifier
</a><a href="#h12-0-115" id="h12-0-115" class="d">-                    .fillMaxWidth()
</a><a href="#h12-0-116" id="h12-0-116" class="d">-                    .weight(1f),
</a><a href="#h12-0-117" id="h12-0-117" class="d">-                verticalArrangement = Arrangement.spacedBy(10.dp)
</a><a href="#h12-0-118" id="h12-0-118" class="d">-            ) {
</a><a href="#h12-0-119" id="h12-0-119" class="d">-                item {
</a><a href="#h12-0-120" id="h12-0-120" class="d">-                    if (snapEnhanceReleases.value == null) {
</a><a href="#h12-0-121" id="h12-0-121" class="d">-                        Row(
</a><a href="#h12-0-122" id="h12-0-122" class="d">-                            horizontalArrangement = Arrangement.Center,
</a><a href="#h12-0-123" id="h12-0-123" class="d">-                            modifier = Modifier
</a><a href="#h12-0-124" id="h12-0-124" class="d">-                                .fillMaxWidth()
</a><a href="#h12-0-125" id="h12-0-125" class="d">-                                .padding(16.dp)
</a><a href="#h12-0-126" id="h12-0-126" class="d">-                        ) {
</a><a href="#h12-0-127" id="h12-0-127" class="d">-                            CircularProgressIndicator()
</a><a href="#h12-0-128" id="h12-0-128" class="d">-                        }
</a><a href="#h12-0-129" id="h12-0-129" class="d">-                    }
</a><a href="#h12-0-130" id="h12-0-130" class="d">-                }
</a><a href="#h12-0-131" id="h12-0-131" class="d">-                items(snapEnhanceReleases.value ?: listOf()) { version -&gt;
</a><a href="#h12-0-132" id="h12-0-132" class="d">-                    OutlinedCard(
</a><a href="#h12-0-133" id="h12-0-133" class="d">-                        shape = MaterialTheme.shapes.small,
</a><a href="#h12-0-134" id="h12-0-134" class="d">-                        modifier = Modifier
</a><a href="#h12-0-135" id="h12-0-135" class="d">-                            .clickable {
</a><a href="#h12-0-136" id="h12-0-136" class="d">-                                selectedArtifact =
</a><a href="#h12-0-137" id="h12-0-137" class="d">-                                    if (selectedVersion != version) null else selectedArtifact
</a><a href="#h12-0-138" id="h12-0-138" class="d">-                                selectedVersion = if (selectedVersion == version) null else version
</a><a href="#h12-0-139" id="h12-0-139" class="d">-                            },
</a><a href="#h12-0-140" id="h12-0-140" class="d">-                    ) {
</a><a href="#h12-0-141" id="h12-0-141" class="d">-                        Row(
</a><a href="#h12-0-142" id="h12-0-142" class="d">-                            modifier = Modifier
</a><a href="#h12-0-143" id="h12-0-143" class="d">-                                .fillMaxWidth()
</a><a href="#h12-0-144" id="h12-0-144" class="d">-                                .padding(16.dp),
</a><a href="#h12-0-145" id="h12-0-145" class="d">-                            verticalAlignment = Alignment.CenterVertically
</a><a href="#h12-0-146" id="h12-0-146" class="d">-                        ) {
</a><a href="#h12-0-147" id="h12-0-147" class="d">-                            Column {
</a><a href="#h12-0-148" id="h12-0-148" class="d">-                                Text(text = version.versionName, fontSize = 24.sp)
</a><a href="#h12-0-149" id="h12-0-149" class="d">-                                Text(text = &quot;Release ${version.releaseDate}&quot;, fontSize = 12.sp)
</a><a href="#h12-0-150" id="h12-0-150" class="d">-                            }
</a><a href="#h12-0-151" id="h12-0-151" class="d">-                            Row(
</a><a href="#h12-0-152" id="h12-0-152" class="d">-                                modifier = Modifier
</a><a href="#h12-0-153" id="h12-0-153" class="d">-                                    .weight(1f),
</a><a href="#h12-0-154" id="h12-0-154" class="d">-                                horizontalArrangement = Arrangement.End,
</a><a href="#h12-0-155" id="h12-0-155" class="d">-                                verticalAlignment = Alignment.CenterVertically
</a><a href="#h12-0-156" id="h12-0-156" class="d">-                            ) {
</a><a href="#h12-0-157" id="h12-0-157" class="d">-                                Text(text = &quot;${version.downloadAssets.size} assets&quot;, fontSize = 12.sp)
</a><a href="#h12-0-158" id="h12-0-158" class="d">-                            }
</a><a href="#h12-0-159" id="h12-0-159" class="d">-                        }
</a><a href="#h12-0-160" id="h12-0-160" class="d">-                    }
</a><a href="#h12-0-161" id="h12-0-161" class="d">-
</a><a href="#h12-0-162" id="h12-0-162" class="d">-                    selectedVersion?.takeIf { it == version }?.let { selVersion -&gt;
</a><a href="#h12-0-163" id="h12-0-163" class="d">-                        Column(
</a><a href="#h12-0-164" id="h12-0-164" class="d">-                            modifier = Modifier
</a><a href="#h12-0-165" id="h12-0-165" class="d">-                                .fillMaxWidth()
</a><a href="#h12-0-166" id="h12-0-166" class="d">-                                .padding(10.dp),
</a><a href="#h12-0-167" id="h12-0-167" class="d">-                            verticalArrangement = Arrangement.spacedBy(16.dp),
</a><a href="#h12-0-168" id="h12-0-168" class="d">-                        ) {
</a><a href="#h12-0-169" id="h12-0-169" class="d">-                            selVersion.downloadAssets.values.forEach { artifact -&gt;
</a><a href="#h12-0-170" id="h12-0-170" class="d">-                                Row(
</a><a href="#h12-0-171" id="h12-0-171" class="d">-                                    modifier = Modifier
</a><a href="#h12-0-172" id="h12-0-172" class="d">-                                        .fillMaxWidth()
</a><a href="#h12-0-173" id="h12-0-173" class="d">-                                        .border(
</a><a href="#h12-0-174" id="h12-0-174" class="d">-                                            shape = MaterialTheme.shapes.medium,
</a><a href="#h12-0-175" id="h12-0-175" class="d">-                                            width = 1.dp,
</a><a href="#h12-0-176" id="h12-0-176" class="d">-                                            color = MaterialTheme.colorScheme.onSurfaceVariant
</a><a href="#h12-0-177" id="h12-0-177" class="d">-                                        )
</a><a href="#h12-0-178" id="h12-0-178" class="d">-                                        .clickable {
</a><a href="#h12-0-179" id="h12-0-179" class="d">-                                            selectedArtifact =
</a><a href="#h12-0-180" id="h12-0-180" class="d">-                                                if (selectedArtifact == artifact) null else artifact
</a><a href="#h12-0-181" id="h12-0-181" class="d">-                                        }
</a><a href="#h12-0-182" id="h12-0-182" class="d">-                                        .background(
</a><a href="#h12-0-183" id="h12-0-183" class="d">-                                            if (selectedArtifact == artifact) MaterialTheme.colorScheme.surfaceVariant else MaterialTheme.colorScheme.surface,
</a><a href="#h12-0-184" id="h12-0-184" class="d">-                                            shape = MaterialTheme.shapes.medium
</a><a href="#h12-0-185" id="h12-0-185" class="d">-                                        )
</a><a href="#h12-0-186" id="h12-0-186" class="d">-                                        .padding(16.dp),
</a><a href="#h12-0-187" id="h12-0-187" class="d">-                                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h12-0-188" id="h12-0-188" class="d">-                                ) {
</a><a href="#h12-0-189" id="h12-0-189" class="d">-                                    Icon(imageVector = Icons.Default.Android, contentDescription = null, modifier = Modifier.padding(start = 2.dp, end = 2.dp))
</a><a href="#h12-0-190" id="h12-0-190" class="d">-                                    Column(
</a><a href="#h12-0-191" id="h12-0-191" class="d">-                                        modifier = Modifier
</a><a href="#h12-0-192" id="h12-0-192" class="d">-                                            .padding(start = 13.dp)
</a><a href="#h12-0-193" id="h12-0-193" class="d">-                                    ) {
</a><a href="#h12-0-194" id="h12-0-194" class="d">-                                        Text(text = artifact.fileName, fontSize = 15.sp)
</a><a href="#h12-0-195" id="h12-0-195" class="d">-                                        Text(
</a><a href="#h12-0-196" id="h12-0-196" class="d">-                                            text = &quot;${artifact.size / 1024 / 1024} MB&quot;,
</a><a href="#h12-0-197" id="h12-0-197" class="d">-                                            fontSize = 10.sp
</a><a href="#h12-0-198" id="h12-0-198" class="d">-                                        )
</a><a href="#h12-0-199" id="h12-0-199" class="d">-                                    }
</a><a href="#h12-0-200" id="h12-0-200" class="d">-                                }
</a><a href="#h12-0-201" id="h12-0-201" class="d">-                            }
</a><a href="#h12-0-202" id="h12-0-202" class="d">-                        }
</a><a href="#h12-0-203" id="h12-0-203" class="d">-                    }
</a><a href="#h12-0-204" id="h12-0-204" class="d">-                }
</a><a href="#h12-0-205" id="h12-0-205" class="d">-            }
</a><a href="#h12-0-206" id="h12-0-206" class="d">-            Column(
</a><a href="#h12-0-207" id="h12-0-207" class="d">-                modifier = Modifier
</a><a href="#h12-0-208" id="h12-0-208" class="d">-                    .fillMaxWidth(),
</a><a href="#h12-0-209" id="h12-0-209" class="d">-                horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h12-0-210" id="h12-0-210" class="d">-            ) {
</a><a href="#h12-0-211" id="h12-0-211" class="d">-                if (isAppInstalled) {
</a><a href="#h12-0-212" id="h12-0-212" class="d">-                    Button(
</a><a href="#h12-0-213" id="h12-0-213" class="d">-                        onClick = {
</a><a href="#h12-0-214" id="h12-0-214" class="d">-                            triggerPackageInstallation(true)
</a><a href="#h12-0-215" id="h12-0-215" class="d">-                        },
</a><a href="#h12-0-216" id="h12-0-216" class="d">-                        enabled = selectedVersion != null &amp;&amp; selectedArtifact != null,
</a><a href="#h12-0-217" id="h12-0-217" class="d">-                        modifier = Modifier.fillMaxWidth()
</a><a href="#h12-0-218" id="h12-0-218" class="d">-                    ) {
</a><a href="#h12-0-219" id="h12-0-219" class="d">-                        Text(text = &quot;Uninstall &amp; Install&quot;)
</a><a href="#h12-0-220" id="h12-0-220" class="d">-                    }
</a><a href="#h12-0-221" id="h12-0-221" class="d">-                }
</a><a href="#h12-0-222" id="h12-0-222" class="d">-                Button(
</a><a href="#h12-0-223" id="h12-0-223" class="d">-                    onClick = {
</a><a href="#h12-0-224" id="h12-0-224" class="d">-                        if (isAppInstalled) {
</a><a href="#h12-0-225" id="h12-0-225" class="d">-                            showDowngradeNotice = true
</a><a href="#h12-0-226" id="h12-0-226" class="d">-                        } else {
</a><a href="#h12-0-227" id="h12-0-227" class="d">-                            triggerPackageInstallation(false)
</a><a href="#h12-0-228" id="h12-0-228" class="d">-                        }
</a><a href="#h12-0-229" id="h12-0-229" class="d">-                    },
</a><a href="#h12-0-230" id="h12-0-230" class="d">-                    enabled = selectedVersion != null &amp;&amp; selectedArtifact != null,
</a><a href="#h12-0-231" id="h12-0-231" class="d">-                    modifier = Modifier.fillMaxWidth()
</a><a href="#h12-0-232" id="h12-0-232" class="d">-                ) {
</a><a href="#h12-0-233" id="h12-0-233" class="d">-                    Text(text = if (isAppInstalled) &quot;Update&quot; else &quot;Install&quot;)
</a><a href="#h12-0-234" id="h12-0-234" class="d">-                }
</a><a href="#h12-0-235" id="h12-0-235" class="d">-            }
</a><a href="#h12-0-236" id="h12-0-236" class="d">-        }
</a><a href="#h12-0-237" id="h12-0-237" class="d">-
</a><a href="#h12-0-238" id="h12-0-238" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h12-0-239" id="h12-0-239" class="d">-            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h12-0-240" id="h12-0-240" class="d">-                snapEnhanceReleases.value = fetchSEReleases()
</a><a href="#h12-0-241" id="h12-0-241" class="d">-            }
</a><a href="#h12-0-242" id="h12-0-242" class="d">-        }
</a><a href="#h12-0-243" id="h12-0-243" class="d">-    }
</a><a href="#h12-0-244" id="h12-0-244" class="d">-}</a><a href="#h12-0-245" id="h12-0-245" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h13" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SnapchatPatchTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SnapchatPatchTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SnapchatPatchTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/download/SnapchatPatchTab.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,235 +0,0 @@
</a><a href="#h13-0-0" id="h13-0-0" class="d">-package me.rhunk.snapenhance.manager.ui.tab.download
</a><a href="#h13-0-1" id="h13-0-1" class="d">-
</a><a href="#h13-0-2" id="h13-0-2" class="d">-import android.os.Bundle
</a><a href="#h13-0-3" id="h13-0-3" class="d">-import androidx.activity.ComponentActivity
</a><a href="#h13-0-4" id="h13-0-4" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h13-0-5" id="h13-0-5" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h13-0-6" id="h13-0-6" class="d">-import androidx.compose.foundation.lazy.items
</a><a href="#h13-0-7" id="h13-0-7" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h13-0-8" id="h13-0-8" class="d">-import androidx.compose.material.icons.filled.Check
</a><a href="#h13-0-9" id="h13-0-9" class="d">-import androidx.compose.material.icons.filled.DeleteForever
</a><a href="#h13-0-10" id="h13-0-10" class="d">-import androidx.compose.material3.*
</a><a href="#h13-0-11" id="h13-0-11" class="d">-import androidx.compose.runtime.*
</a><a href="#h13-0-12" id="h13-0-12" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h13-0-13" id="h13-0-13" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h13-0-14" id="h13-0-14" class="d">-import androidx.compose.ui.draw.alpha
</a><a href="#h13-0-15" id="h13-0-15" class="d">-import androidx.compose.ui.res.painterResource
</a><a href="#h13-0-16" id="h13-0-16" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h13-0-17" id="h13-0-17" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h13-0-18" id="h13-0-18" class="d">-import kotlinx.coroutines.launch
</a><a href="#h13-0-19" id="h13-0-19" class="d">-import kotlinx.coroutines.withContext
</a><a href="#h13-0-20" id="h13-0-20" class="d">-import me.rhunk.snapenhance.manager.R
</a><a href="#h13-0-21" id="h13-0-21" class="d">-import me.rhunk.snapenhance.manager.data.APKMirror
</a><a href="#h13-0-22" id="h13-0-22" class="d">-import me.rhunk.snapenhance.manager.data.DownloadItem
</a><a href="#h13-0-23" id="h13-0-23" class="d">-import me.rhunk.snapenhance.manager.ui.Tab
</a><a href="#h13-0-24" id="h13-0-24" class="d">-import me.rhunk.snapenhance.manager.ui.components.ConfirmationDialog
</a><a href="#h13-0-25" id="h13-0-25" class="d">-
</a><a href="#h13-0-26" id="h13-0-26" class="d">-@OptIn(ExperimentalMaterial3Api::class)
</a><a href="#h13-0-27" id="h13-0-27" class="d">-class SnapchatPatchTab : Tab(&quot;snapchat_download&quot;) {
</a><a href="#h13-0-28" id="h13-0-28" class="d">-    private val apkMirror =  APKMirror()
</a><a href="#h13-0-29" id="h13-0-29" class="d">-    private val cachedDownloadItems = mutableListOf&lt;DownloadItem&gt;()
</a><a href="#h13-0-30" id="h13-0-30" class="d">-    private var currentPage by mutableIntStateOf(1)
</a><a href="#h13-0-31" id="h13-0-31" class="d">-
</a><a href="#h13-0-32" id="h13-0-32" class="d">-    override fun init(activity: ComponentActivity) {
</a><a href="#h13-0-33" id="h13-0-33" class="d">-        super.init(activity)
</a><a href="#h13-0-34" id="h13-0-34" class="d">-        registerNestedTab(LSPatchTab::class)
</a><a href="#h13-0-35" id="h13-0-35" class="d">-    }
</a><a href="#h13-0-36" id="h13-0-36" class="d">-
</a><a href="#h13-0-37" id="h13-0-37" class="d">-    @Composable
</a><a href="#h13-0-38" id="h13-0-38" class="d">-    override fun TopBar() {
</a><a href="#h13-0-39" id="h13-0-39" class="d">-        var deleteAllDialog by remember { mutableStateOf(false) }
</a><a href="#h13-0-40" id="h13-0-40" class="d">-        IconButton(onClick = { deleteAllDialog = true }) {
</a><a href="#h13-0-41" id="h13-0-41" class="d">-            Icon(imageVector = Icons.Default.DeleteForever, contentDescription = null)
</a><a href="#h13-0-42" id="h13-0-42" class="d">-        }
</a><a href="#h13-0-43" id="h13-0-43" class="d">-
</a><a href="#h13-0-44" id="h13-0-44" class="d">-        if (deleteAllDialog) {
</a><a href="#h13-0-45" id="h13-0-45" class="d">-            AlertDialog(onDismissRequest = { deleteAllDialog = false }) {
</a><a href="#h13-0-46" id="h13-0-46" class="d">-                ConfirmationDialog(title = &quot;Are you sure you want to delete all downloads?&quot;, onDismiss = { deleteAllDialog = false }) {
</a><a href="#h13-0-47" id="h13-0-47" class="d">-                    deleteAllDialog = false
</a><a href="#h13-0-48" id="h13-0-48" class="d">-                    runCatching {
</a><a href="#h13-0-49" id="h13-0-49" class="d">-                        sharedConfig.apkCache.listFiles()?.forEach { it.deleteRecursively() }
</a><a href="#h13-0-50" id="h13-0-50" class="d">-                    }.onFailure {
</a><a href="#h13-0-51" id="h13-0-51" class="d">-                        toast(&quot;Failed to delete downloads&quot;)
</a><a href="#h13-0-52" id="h13-0-52" class="d">-                        it.printStackTrace()
</a><a href="#h13-0-53" id="h13-0-53" class="d">-                    }
</a><a href="#h13-0-54" id="h13-0-54" class="d">-                    toast(&quot;Done!&quot;)
</a><a href="#h13-0-55" id="h13-0-55" class="d">-                }
</a><a href="#h13-0-56" id="h13-0-56" class="d">-            }
</a><a href="#h13-0-57" id="h13-0-57" class="d">-        }
</a><a href="#h13-0-58" id="h13-0-58" class="d">-    }
</a><a href="#h13-0-59" id="h13-0-59" class="d">-
</a><a href="#h13-0-60" id="h13-0-60" class="d">-    @Composable
</a><a href="#h13-0-61" id="h13-0-61" class="d">-    private fun DownloadItemRow(item: DownloadItem, onSelected: () -&gt; Unit = {}) {
</a><a href="#h13-0-62" id="h13-0-62" class="d">-        ElevatedCard(
</a><a href="#h13-0-63" id="h13-0-63" class="d">-            modifier = Modifier.padding(10.dp),
</a><a href="#h13-0-64" id="h13-0-64" class="d">-        ) {
</a><a href="#h13-0-65" id="h13-0-65" class="d">-            Row(
</a><a href="#h13-0-66" id="h13-0-66" class="d">-                modifier = Modifier
</a><a href="#h13-0-67" id="h13-0-67" class="d">-                    .fillMaxWidth()
</a><a href="#h13-0-68" id="h13-0-68" class="d">-                    .padding(5.dp),
</a><a href="#h13-0-69" id="h13-0-69" class="d">-                horizontalArrangement = Arrangement.spacedBy(10.dp),
</a><a href="#h13-0-70" id="h13-0-70" class="d">-                verticalAlignment = Alignment.CenterVertically
</a><a href="#h13-0-71" id="h13-0-71" class="d">-            ) {
</a><a href="#h13-0-72" id="h13-0-72" class="d">-                Column(
</a><a href="#h13-0-73" id="h13-0-73" class="d">-                    modifier = Modifier.padding(10.dp),
</a><a href="#h13-0-74" id="h13-0-74" class="d">-                ) {
</a><a href="#h13-0-75" id="h13-0-75" class="d">-                    Icon(painter = painterResource(R.drawable.sclogo), contentDescription = null, tint = MaterialTheme.colorScheme.onSurface, modifier = Modifier.size(40.dp))
</a><a href="#h13-0-76" id="h13-0-76" class="d">-                }
</a><a href="#h13-0-77" id="h13-0-77" class="d">-                Column(
</a><a href="#h13-0-78" id="h13-0-78" class="d">-                    modifier = Modifier.weight(1f),
</a><a href="#h13-0-79" id="h13-0-79" class="d">-                    verticalArrangement = Arrangement.spacedBy(5.dp)
</a><a href="#h13-0-80" id="h13-0-80" class="d">-                ) {
</a><a href="#h13-0-81" id="h13-0-81" class="d">-                    Text(item.shortTitle)
</a><a href="#h13-0-82" id="h13-0-82" class="d">-                    if (!item.isBeta) {
</a><a href="#h13-0-83" id="h13-0-83" class="d">-                        Text(&quot;Recommended&quot;, color = MaterialTheme.colorScheme.tertiary)
</a><a href="#h13-0-84" id="h13-0-84" class="d">-                    }
</a><a href="#h13-0-85" id="h13-0-85" class="d">-                }
</a><a href="#h13-0-86" id="h13-0-86" class="d">-                Row(
</a><a href="#h13-0-87" id="h13-0-87" class="d">-                    modifier = Modifier.padding(5.dp),
</a><a href="#h13-0-88" id="h13-0-88" class="d">-                    horizontalArrangement = Arrangement.spacedBy(5.dp),
</a><a href="#h13-0-89" id="h13-0-89" class="d">-                ) {
</a><a href="#h13-0-90" id="h13-0-90" class="d">-                    FilledIconButton(onClick = { onSelected() }) {
</a><a href="#h13-0-91" id="h13-0-91" class="d">-                        Icon(imageVector = Icons.Default.Check, contentDescription = null)
</a><a href="#h13-0-92" id="h13-0-92" class="d">-                    }
</a><a href="#h13-0-93" id="h13-0-93" class="d">-                }
</a><a href="#h13-0-94" id="h13-0-94" class="d">-            }
</a><a href="#h13-0-95" id="h13-0-95" class="d">-        }
</a><a href="#h13-0-96" id="h13-0-96" class="d">-    }
</a><a href="#h13-0-97" id="h13-0-97" class="d">-
</a><a href="#h13-0-98" id="h13-0-98" class="d">-
</a><a href="#h13-0-99" id="h13-0-99" class="d">-    @Composable
</a><a href="#h13-0-100" id="h13-0-100" class="d">-    private fun SelectSnapchatVersionDialog(onSelected: (DownloadItem) -&gt; Unit = {}) {
</a><a href="#h13-0-101" id="h13-0-101" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h13-0-102" id="h13-0-102" class="d">-        var isFetching by remember { mutableStateOf(false) }
</a><a href="#h13-0-103" id="h13-0-103" class="d">-        val downloadItems = remember { cachedDownloadItems.toMutableStateList() }
</a><a href="#h13-0-104" id="h13-0-104" class="d">-
</a><a href="#h13-0-105" id="h13-0-105" class="d">-        LazyColumn {
</a><a href="#h13-0-106" id="h13-0-106" class="d">-            items(downloadItems, key = { it.hash }) { item -&gt;
</a><a href="#h13-0-107" id="h13-0-107" class="d">-                DownloadItemRow(item) {
</a><a href="#h13-0-108" id="h13-0-108" class="d">-                    onSelected(item)
</a><a href="#h13-0-109" id="h13-0-109" class="d">-                }
</a><a href="#h13-0-110" id="h13-0-110" class="d">-            }
</a><a href="#h13-0-111" id="h13-0-111" class="d">-            item {
</a><a href="#h13-0-112" id="h13-0-112" class="d">-                Box(
</a><a href="#h13-0-113" id="h13-0-113" class="d">-                    modifier = Modifier
</a><a href="#h13-0-114" id="h13-0-114" class="d">-                        .fillMaxWidth()
</a><a href="#h13-0-115" id="h13-0-115" class="d">-                        .padding(20.dp),
</a><a href="#h13-0-116" id="h13-0-116" class="d">-                    contentAlignment = Alignment.Center
</a><a href="#h13-0-117" id="h13-0-117" class="d">-                ) {
</a><a href="#h13-0-118" id="h13-0-118" class="d">-                    CircularProgressIndicator(modifier = Modifier.alpha(if (isFetching) 1f else 0f))
</a><a href="#h13-0-119" id="h13-0-119" class="d">-                }
</a><a href="#h13-0-120" id="h13-0-120" class="d">-                SideEffect {
</a><a href="#h13-0-121" id="h13-0-121" class="d">-                    if (isFetching) return@SideEffect
</a><a href="#h13-0-122" id="h13-0-122" class="d">-                    isFetching = true
</a><a href="#h13-0-123" id="h13-0-123" class="d">-                    coroutineScope.launch {
</a><a href="#h13-0-124" id="h13-0-124" class="d">-                        runCatching {
</a><a href="#h13-0-125" id="h13-0-125" class="d">-                            withContext(Dispatchers.IO) {
</a><a href="#h13-0-126" id="h13-0-126" class="d">-                                apkMirror.fetchSnapchatVersions(currentPage)?.let {
</a><a href="#h13-0-127" id="h13-0-127" class="d">-                                    withContext(Dispatchers.Main) {
</a><a href="#h13-0-128" id="h13-0-128" class="d">-                                        cachedDownloadItems.addAll(it)
</a><a href="#h13-0-129" id="h13-0-129" class="d">-                                        downloadItems.addAll(it)
</a><a href="#h13-0-130" id="h13-0-130" class="d">-                                    }
</a><a href="#h13-0-131" id="h13-0-131" class="d">-                                }
</a><a href="#h13-0-132" id="h13-0-132" class="d">-                            }
</a><a href="#h13-0-133" id="h13-0-133" class="d">-                        }.onFailure {
</a><a href="#h13-0-134" id="h13-0-134" class="d">-                            it.printStackTrace()
</a><a href="#h13-0-135" id="h13-0-135" class="d">-                        }
</a><a href="#h13-0-136" id="h13-0-136" class="d">-                        ++currentPage
</a><a href="#h13-0-137" id="h13-0-137" class="d">-                        isFetching = false
</a><a href="#h13-0-138" id="h13-0-138" class="d">-                    }
</a><a href="#h13-0-139" id="h13-0-139" class="d">-                }
</a><a href="#h13-0-140" id="h13-0-140" class="d">-            }
</a><a href="#h13-0-141" id="h13-0-141" class="d">-        }
</a><a href="#h13-0-142" id="h13-0-142" class="d">-    }
</a><a href="#h13-0-143" id="h13-0-143" class="d">-
</a><a href="#h13-0-144" id="h13-0-144" class="d">-    @Composable
</a><a href="#h13-0-145" id="h13-0-145" class="d">-    override fun Content() {
</a><a href="#h13-0-146" id="h13-0-146" class="d">-        var showSelectSnapchatVersionDialog by remember { mutableStateOf(false) }
</a><a href="#h13-0-147" id="h13-0-147" class="d">-        var selectedSnapchatVersion by remember { mutableStateOf(null as DownloadItem?) }
</a><a href="#h13-0-148" id="h13-0-148" class="d">-        val installedSnapEnhanceVersion = remember { runCatching { activity.packageManager.getPackageInfo(
</a><a href="#h13-0-149" id="h13-0-149" class="d">-            sharedConfig.snapEnhancePackageName, 0) }.getOrNull() }
</a><a href="#h13-0-150" id="h13-0-150" class="d">-
</a><a href="#h13-0-151" id="h13-0-151" class="d">-        if (showSelectSnapchatVersionDialog) {
</a><a href="#h13-0-152" id="h13-0-152" class="d">-            AlertDialog(onDismissRequest = { showSelectSnapchatVersionDialog = false }) {
</a><a href="#h13-0-153" id="h13-0-153" class="d">-                SelectSnapchatVersionDialog {
</a><a href="#h13-0-154" id="h13-0-154" class="d">-                    selectedSnapchatVersion = it
</a><a href="#h13-0-155" id="h13-0-155" class="d">-                    showSelectSnapchatVersionDialog = false
</a><a href="#h13-0-156" id="h13-0-156" class="d">-                }
</a><a href="#h13-0-157" id="h13-0-157" class="d">-            }
</a><a href="#h13-0-158" id="h13-0-158" class="d">-        }
</a><a href="#h13-0-159" id="h13-0-159" class="d">-
</a><a href="#h13-0-160" id="h13-0-160" class="d">-        Column(
</a><a href="#h13-0-161" id="h13-0-161" class="d">-            modifier = Modifier.fillMaxSize(),
</a><a href="#h13-0-162" id="h13-0-162" class="d">-            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h13-0-163" id="h13-0-163" class="d">-            verticalArrangement = Arrangement.spacedBy(10.dp)
</a><a href="#h13-0-164" id="h13-0-164" class="d">-        ) {
</a><a href="#h13-0-165" id="h13-0-165" class="d">-            Text(&quot;Select a version to download and patch&quot;)
</a><a href="#h13-0-166" id="h13-0-166" class="d">-
</a><a href="#h13-0-167" id="h13-0-167" class="d">-            ElevatedCard(
</a><a href="#h13-0-168" id="h13-0-168" class="d">-                modifier = Modifier.padding(10.dp),
</a><a href="#h13-0-169" id="h13-0-169" class="d">-            ) {
</a><a href="#h13-0-170" id="h13-0-170" class="d">-                Row(
</a><a href="#h13-0-171" id="h13-0-171" class="d">-                    modifier = Modifier
</a><a href="#h13-0-172" id="h13-0-172" class="d">-                        .fillMaxWidth()
</a><a href="#h13-0-173" id="h13-0-173" class="d">-                        .padding(10.dp),
</a><a href="#h13-0-174" id="h13-0-174" class="d">-                    horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h13-0-175" id="h13-0-175" class="d">-                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h13-0-176" id="h13-0-176" class="d">-                ) {
</a><a href="#h13-0-177" id="h13-0-177" class="d">-                    Icon(painter = painterResource(R.drawable.sclogo), contentDescription = null, tint = MaterialTheme.colorScheme.onSurface, modifier = Modifier.size(40.dp))
</a><a href="#h13-0-178" id="h13-0-178" class="d">-                    if (selectedSnapchatVersion == null) {
</a><a href="#h13-0-179" id="h13-0-179" class="d">-                        Text(text = &quot;Snapchat&quot;)
</a><a href="#h13-0-180" id="h13-0-180" class="d">-                    }
</a><a href="#h13-0-181" id="h13-0-181" class="d">-                    Text(text = selectedSnapchatVersion?.shortTitle ?: &quot;Not Selected&quot;)
</a><a href="#h13-0-182" id="h13-0-182" class="d">-                    Button(onClick = { showSelectSnapchatVersionDialog = true }) {
</a><a href="#h13-0-183" id="h13-0-183" class="d">-                        Text(&quot;Choose&quot;)
</a><a href="#h13-0-184" id="h13-0-184" class="d">-                    }
</a><a href="#h13-0-185" id="h13-0-185" class="d">-                }
</a><a href="#h13-0-186" id="h13-0-186" class="d">-            }
</a><a href="#h13-0-187" id="h13-0-187" class="d">-
</a><a href="#h13-0-188" id="h13-0-188" class="d">-            ElevatedCard(
</a><a href="#h13-0-189" id="h13-0-189" class="d">-                modifier = Modifier.padding(10.dp),
</a><a href="#h13-0-190" id="h13-0-190" class="d">-            ) {
</a><a href="#h13-0-191" id="h13-0-191" class="d">-                Row(
</a><a href="#h13-0-192" id="h13-0-192" class="d">-                    modifier = Modifier
</a><a href="#h13-0-193" id="h13-0-193" class="d">-                        .fillMaxWidth()
</a><a href="#h13-0-194" id="h13-0-194" class="d">-                        .padding(20.dp),
</a><a href="#h13-0-195" id="h13-0-195" class="d">-                    horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h13-0-196" id="h13-0-196" class="d">-                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h13-0-197" id="h13-0-197" class="d">-                ) {
</a><a href="#h13-0-198" id="h13-0-198" class="d">-                    Text(text = &quot;SnapEnhance&quot;)
</a><a href="#h13-0-199" id="h13-0-199" class="d">-                    Text(text = installedSnapEnhanceVersion?.versionName ?: &quot;Not installed&quot;)
</a><a href="#h13-0-200" id="h13-0-200" class="d">-                }
</a><a href="#h13-0-201" id="h13-0-201" class="d">-            }
</a><a href="#h13-0-202" id="h13-0-202" class="d">-
</a><a href="#h13-0-203" id="h13-0-203" class="d">-            Column(
</a><a href="#h13-0-204" id="h13-0-204" class="d">-                modifier = Modifier.padding(top = 10.dp, bottom = 10.dp, start = 20.dp, end = 20.dp),
</a><a href="#h13-0-205" id="h13-0-205" class="d">-                verticalArrangement = Arrangement.spacedBy(5.dp)
</a><a href="#h13-0-206" id="h13-0-206" class="d">-            ) {
</a><a href="#h13-0-207" id="h13-0-207" class="d">-                Button(
</a><a href="#h13-0-208" id="h13-0-208" class="d">-                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h13-0-209" id="h13-0-209" class="d">-                    enabled = selectedSnapchatVersion != null &amp;&amp; installedSnapEnhanceVersion != null,
</a><a href="#h13-0-210" id="h13-0-210" class="d">-                    onClick = {
</a><a href="#h13-0-211" id="h13-0-211" class="d">-                        navigation.navigateTo(LSPatchTab::class, args = Bundle().apply {
</a><a href="#h13-0-212" id="h13-0-212" class="d">-                            putParcelable(&quot;downloadItem&quot;, selectedSnapchatVersion)
</a><a href="#h13-0-213" id="h13-0-213" class="d">-                            putString(&quot;modulePath&quot;, installedSnapEnhanceVersion?.applicationInfo?.sourceDir)
</a><a href="#h13-0-214" id="h13-0-214" class="d">-                        }, noHistory = true)
</a><a href="#h13-0-215" id="h13-0-215" class="d">-                    }
</a><a href="#h13-0-216" id="h13-0-216" class="d">-                ) {
</a><a href="#h13-0-217" id="h13-0-217" class="d">-                    Text(&quot;Download &amp; Patch&quot;)
</a><a href="#h13-0-218" id="h13-0-218" class="d">-                }
</a><a href="#h13-0-219" id="h13-0-219" class="d">-
</a><a href="#h13-0-220" id="h13-0-220" class="d">-                Button(
</a><a href="#h13-0-221" id="h13-0-221" class="d">-                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h13-0-222" id="h13-0-222" class="d">-                    enabled = selectedSnapchatVersion != null,
</a><a href="#h13-0-223" id="h13-0-223" class="d">-                    onClick = {
</a><a href="#h13-0-224" id="h13-0-224" class="d">-                        navigation.navigateTo(LSPatchTab::class, args = Bundle().apply {
</a><a href="#h13-0-225" id="h13-0-225" class="d">-                            putParcelable(&quot;downloadItem&quot;, selectedSnapchatVersion)
</a><a href="#h13-0-226" id="h13-0-226" class="d">-                        }, noHistory = true)
</a><a href="#h13-0-227" id="h13-0-227" class="d">-                    }
</a><a href="#h13-0-228" id="h13-0-228" class="d">-                ) {
</a><a href="#h13-0-229" id="h13-0-229" class="d">-                    Text(&quot;Install/Restore Original Snapchat&quot;)
</a><a href="#h13-0-230" id="h13-0-230" class="d">-                }
</a><a href="#h13-0-231" id="h13-0-231" class="d">-            }
</a><a href="#h13-0-232" id="h13-0-232" class="d">-        }
</a><a href="#h13-0-233" id="h13-0-233" class="d">-    }
</a><a href="#h13-0-234" id="h13-0-234" class="d">-}</a><a href="#h13-0-235" id="h13-0-235" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/HomeTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/HomeTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/HomeTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/HomeTab.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,146 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+package me.rhunk.snapenhance.manager.ui.tab.impl
</a><a href="#h14-0-1" id="h14-0-1" class="i">+
</a><a href="#h14-0-2" id="h14-0-2" class="i">+import android.content.pm.ApplicationInfo.FLAG_DEBUGGABLE
</a><a href="#h14-0-3" id="h14-0-3" class="i">+import android.content.pm.PackageInfo
</a><a href="#h14-0-4" id="h14-0-4" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h14-0-5" id="h14-0-5" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h14-0-6" id="h14-0-6" class="i">+import androidx.compose.foundation.layout.Arrangement
</a><a href="#h14-0-7" id="h14-0-7" class="i">+import androidx.compose.foundation.layout.Column
</a><a href="#h14-0-8" id="h14-0-8" class="i">+import androidx.compose.foundation.layout.Row
</a><a href="#h14-0-9" id="h14-0-9" class="i">+import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h14-0-10" id="h14-0-10" class="i">+import androidx.compose.foundation.layout.padding
</a><a href="#h14-0-11" id="h14-0-11" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h14-0-12" id="h14-0-12" class="i">+import androidx.compose.material.icons.automirrored.filled.OpenInNew
</a><a href="#h14-0-13" id="h14-0-13" class="i">+import androidx.compose.material.icons.filled.Check
</a><a href="#h14-0-14" id="h14-0-14" class="i">+import androidx.compose.material.icons.filled.Close
</a><a href="#h14-0-15" id="h14-0-15" class="i">+import androidx.compose.material.icons.filled.Home
</a><a href="#h14-0-16" id="h14-0-16" class="i">+import androidx.compose.material3.Card
</a><a href="#h14-0-17" id="h14-0-17" class="i">+import androidx.compose.material3.Icon
</a><a href="#h14-0-18" id="h14-0-18" class="i">+import androidx.compose.material3.MaterialTheme
</a><a href="#h14-0-19" id="h14-0-19" class="i">+import androidx.compose.material3.Text
</a><a href="#h14-0-20" id="h14-0-20" class="i">+import androidx.compose.runtime.*
</a><a href="#h14-0-21" id="h14-0-21" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h14-0-22" id="h14-0-22" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h14-0-23" id="h14-0-23" class="i">+import androidx.compose.ui.platform.LocalContext
</a><a href="#h14-0-24" id="h14-0-24" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h14-0-25" id="h14-0-25" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h14-0-26" id="h14-0-26" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h14-0-27" id="h14-0-27" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h14-0-28" id="h14-0-28" class="i">+import kotlinx.coroutines.launch
</a><a href="#h14-0-29" id="h14-0-29" class="i">+import me.rhunk.snapenhance.manager.lspatch.config.Constants
</a><a href="#h14-0-30" id="h14-0-30" class="i">+import me.rhunk.snapenhance.manager.ui.tab.Tab
</a><a href="#h14-0-31" id="h14-0-31" class="i">+import me.rhunk.snapenhance.manager.ui.tab.impl.download.SEDownloadTab
</a><a href="#h14-0-32" id="h14-0-32" class="i">+import me.rhunk.snapenhance.manager.ui.tab.impl.download.SnapchatPatchTab
</a><a href="#h14-0-33" id="h14-0-33" class="i">+
</a><a href="#h14-0-34" id="h14-0-34" class="i">+class HomeTab : Tab(&quot;home&quot;, true, icon = Icons.Default.Home) {
</a><a href="#h14-0-35" id="h14-0-35" class="i">+    override fun init(activity: ComponentActivity) {
</a><a href="#h14-0-36" id="h14-0-36" class="i">+        super.init(activity)
</a><a href="#h14-0-37" id="h14-0-37" class="i">+        registerNestedTab(SEDownloadTab::class)
</a><a href="#h14-0-38" id="h14-0-38" class="i">+        registerNestedTab(SnapchatPatchTab::class)
</a><a href="#h14-0-39" id="h14-0-39" class="i">+    }
</a><a href="#h14-0-40" id="h14-0-40" class="i">+
</a><a href="#h14-0-41" id="h14-0-41" class="i">+    @Composable
</a><a href="#h14-0-42" id="h14-0-42" class="i">+    override fun Content() {
</a><a href="#h14-0-43" id="h14-0-43" class="i">+        val context = LocalContext.current
</a><a href="#h14-0-44" id="h14-0-44" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h14-0-45" id="h14-0-45" class="i">+        var snapchatAppInfo by remember { mutableStateOf(null as PackageInfo?) }
</a><a href="#h14-0-46" id="h14-0-46" class="i">+        var snapEnhanceInfo by remember { mutableStateOf(null as PackageInfo?) }
</a><a href="#h14-0-47" id="h14-0-47" class="i">+
</a><a href="#h14-0-48" id="h14-0-48" class="i">+        Column {
</a><a href="#h14-0-49" id="h14-0-49" class="i">+
</a><a href="#h14-0-50" id="h14-0-50" class="i">+            Card(
</a><a href="#h14-0-51" id="h14-0-51" class="i">+                modifier = Modifier
</a><a href="#h14-0-52" id="h14-0-52" class="i">+                    .fillMaxWidth()
</a><a href="#h14-0-53" id="h14-0-53" class="i">+                    .padding(10.dp),
</a><a href="#h14-0-54" id="h14-0-54" class="i">+            ) {
</a><a href="#h14-0-55" id="h14-0-55" class="i">+                Row(
</a><a href="#h14-0-56" id="h14-0-56" class="i">+                    modifier = Modifier
</a><a href="#h14-0-57" id="h14-0-57" class="i">+                        .fillMaxWidth()
</a><a href="#h14-0-58" id="h14-0-58" class="i">+                        .clickable {
</a><a href="#h14-0-59" id="h14-0-59" class="i">+                            navigation.navigateTo(SEDownloadTab::class)
</a><a href="#h14-0-60" id="h14-0-60" class="i">+                        }
</a><a href="#h14-0-61" id="h14-0-61" class="i">+                        .padding(16.dp),
</a><a href="#h14-0-62" id="h14-0-62" class="i">+                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h14-0-63" id="h14-0-63" class="i">+                ) {
</a><a href="#h14-0-64" id="h14-0-64" class="i">+                    Column {
</a><a href="#h14-0-65" id="h14-0-65" class="i">+                        Text(text = &quot;SnapEnhance&quot;, fontSize = 24.sp, color = MaterialTheme.colorScheme.onSurface, fontWeight = FontWeight.Bold)
</a><a href="#h14-0-66" id="h14-0-66" class="i">+                        snapEnhanceInfo?.let {
</a><a href="#h14-0-67" id="h14-0-67" class="i">+                            Text(text = &quot;${it.versionName} (${it.longVersionCode}) - ${if ((it.applicationInfo.flags and FLAG_DEBUGGABLE) != 0) &quot;Debug&quot; else &quot;Release&quot;}&quot;, fontSize = 12.sp, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h14-0-68" id="h14-0-68" class="i">+                        }
</a><a href="#h14-0-69" id="h14-0-69" class="i">+                    }
</a><a href="#h14-0-70" id="h14-0-70" class="i">+                    Row(
</a><a href="#h14-0-71" id="h14-0-71" class="i">+                        modifier = Modifier
</a><a href="#h14-0-72" id="h14-0-72" class="i">+                            .weight(1f),
</a><a href="#h14-0-73" id="h14-0-73" class="i">+                        horizontalArrangement = Arrangement.End,
</a><a href="#h14-0-74" id="h14-0-74" class="i">+                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h14-0-75" id="h14-0-75" class="i">+                    ) {
</a><a href="#h14-0-76" id="h14-0-76" class="i">+                        snapEnhanceInfo?.let {
</a><a href="#h14-0-77" id="h14-0-77" class="i">+                            Text(text = &quot;Installed&quot;, fontSize = 16.sp, color = MaterialTheme.colorScheme.onSurface)
</a><a href="#h14-0-78" id="h14-0-78" class="i">+                        } ?: run {
</a><a href="#h14-0-79" id="h14-0-79" class="i">+                            Text(text = &quot;Not installed&quot;, fontSize = 16.sp, color = MaterialTheme.colorScheme.onSurface)
</a><a href="#h14-0-80" id="h14-0-80" class="i">+                        }
</a><a href="#h14-0-81" id="h14-0-81" class="i">+
</a><a href="#h14-0-82" id="h14-0-82" class="i">+                        Icon(imageVector = Icons.AutoMirrored.Default.OpenInNew, contentDescription = null, Modifier.padding(10.dp))
</a><a href="#h14-0-83" id="h14-0-83" class="i">+                    }
</a><a href="#h14-0-84" id="h14-0-84" class="i">+                }
</a><a href="#h14-0-85" id="h14-0-85" class="i">+            }
</a><a href="#h14-0-86" id="h14-0-86" class="i">+
</a><a href="#h14-0-87" id="h14-0-87" class="i">+            Card(
</a><a href="#h14-0-88" id="h14-0-88" class="i">+                modifier = Modifier
</a><a href="#h14-0-89" id="h14-0-89" class="i">+                    .fillMaxWidth()
</a><a href="#h14-0-90" id="h14-0-90" class="i">+                    .padding(10.dp),
</a><a href="#h14-0-91" id="h14-0-91" class="i">+            ) {
</a><a href="#h14-0-92" id="h14-0-92" class="i">+                Row(
</a><a href="#h14-0-93" id="h14-0-93" class="i">+                    modifier = Modifier
</a><a href="#h14-0-94" id="h14-0-94" class="i">+                        .fillMaxWidth()
</a><a href="#h14-0-95" id="h14-0-95" class="i">+                        .clickable {
</a><a href="#h14-0-96" id="h14-0-96" class="i">+                            navigation.navigateTo(SnapchatPatchTab::class)
</a><a href="#h14-0-97" id="h14-0-97" class="i">+                        }
</a><a href="#h14-0-98" id="h14-0-98" class="i">+                        .padding(16.dp),
</a><a href="#h14-0-99" id="h14-0-99" class="i">+                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h14-0-100" id="h14-0-100" class="i">+                ) {
</a><a href="#h14-0-101" id="h14-0-101" class="i">+                    Column {
</a><a href="#h14-0-102" id="h14-0-102" class="i">+                        Text(text = &quot;Snapchat&quot;, fontSize = 24.sp, color = MaterialTheme.colorScheme.onSurface, fontWeight = FontWeight.Bold)
</a><a href="#h14-0-103" id="h14-0-103" class="i">+                        snapchatAppInfo?.let {
</a><a href="#h14-0-104" id="h14-0-104" class="i">+                            Text(text = &quot;${it.versionName} (${it.longVersionCode})&quot;, fontSize = 12.sp, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h14-0-105" id="h14-0-105" class="i">+                        }
</a><a href="#h14-0-106" id="h14-0-106" class="i">+                    }
</a><a href="#h14-0-107" id="h14-0-107" class="i">+                    Row(
</a><a href="#h14-0-108" id="h14-0-108" class="i">+                        modifier = Modifier
</a><a href="#h14-0-109" id="h14-0-109" class="i">+                            .weight(1f),
</a><a href="#h14-0-110" id="h14-0-110" class="i">+                        horizontalArrangement = Arrangement.spacedBy(10.dp, Alignment.End),
</a><a href="#h14-0-111" id="h14-0-111" class="i">+                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h14-0-112" id="h14-0-112" class="i">+                    ) {
</a><a href="#h14-0-113" id="h14-0-113" class="i">+                        snapchatAppInfo?.let { appInfo -&gt;
</a><a href="#h14-0-114" id="h14-0-114" class="i">+                            val isLSPatched = appInfo.applicationInfo.appComponentFactory == Constants.PROXY_APP_COMPONENT_FACTORY
</a><a href="#h14-0-115" id="h14-0-115" class="i">+                            if (isLSPatched) {
</a><a href="#h14-0-116" id="h14-0-116" class="i">+                                Icon(imageVector = Icons.Default.Check, contentDescription = null)
</a><a href="#h14-0-117" id="h14-0-117" class="i">+                                Text(text = &quot;Patched&quot;, fontSize = 16.sp)
</a><a href="#h14-0-118" id="h14-0-118" class="i">+                            } else {
</a><a href="#h14-0-119" id="h14-0-119" class="i">+                                Icon(imageVector = Icons.Default.Close, contentDescription = null)
</a><a href="#h14-0-120" id="h14-0-120" class="i">+                                Text(text = &quot;Not patched&quot;, fontSize = 16.sp, color = MaterialTheme.colorScheme.onSurface)
</a><a href="#h14-0-121" id="h14-0-121" class="i">+                            }
</a><a href="#h14-0-122" id="h14-0-122" class="i">+                        } ?: run {
</a><a href="#h14-0-123" id="h14-0-123" class="i">+                            Text(text = &quot;Not installed&quot;, fontSize = 16.sp, color = MaterialTheme.colorScheme.onSurface)
</a><a href="#h14-0-124" id="h14-0-124" class="i">+                        }
</a><a href="#h14-0-125" id="h14-0-125" class="i">+
</a><a href="#h14-0-126" id="h14-0-126" class="i">+                    }
</a><a href="#h14-0-127" id="h14-0-127" class="i">+                }
</a><a href="#h14-0-128" id="h14-0-128" class="i">+
</a><a href="#h14-0-129" id="h14-0-129" class="i">+            }
</a><a href="#h14-0-130" id="h14-0-130" class="i">+        }
</a><a href="#h14-0-131" id="h14-0-131" class="i">+
</a><a href="#h14-0-132" id="h14-0-132" class="i">+        SideEffect {
</a><a href="#h14-0-133" id="h14-0-133" class="i">+            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h14-0-134" id="h14-0-134" class="i">+                runCatching {
</a><a href="#h14-0-135" id="h14-0-135" class="i">+                    snapchatAppInfo = runCatching {
</a><a href="#h14-0-136" id="h14-0-136" class="i">+                        context.packageManager.getPackageInfo(sharedConfig.snapchatPackageName, 0)
</a><a href="#h14-0-137" id="h14-0-137" class="i">+                    }.getOrNull()
</a><a href="#h14-0-138" id="h14-0-138" class="i">+                    snapEnhanceInfo = runCatching {
</a><a href="#h14-0-139" id="h14-0-139" class="i">+                        context.packageManager.getPackageInfo(sharedConfig.snapEnhancePackageName, 0)
</a><a href="#h14-0-140" id="h14-0-140" class="i">+                    }.getOrNull()
</a><a href="#h14-0-141" id="h14-0-141" class="i">+                }
</a><a href="#h14-0-142" id="h14-0-142" class="i">+            }
</a><a href="#h14-0-143" id="h14-0-143" class="i">+        }
</a><a href="#h14-0-144" id="h14-0-144" class="i">+    }
</a><a href="#h14-0-145" id="h14-0-145" class="i">+}</a><a href="#h14-0-146" id="h14-0-146" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/SettingsTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/SettingsTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/SettingsTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/SettingsTab.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,150 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+package me.rhunk.snapenhance.manager.ui.tab.impl
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h15-0-3" id="h15-0-3" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h15-0-4" id="h15-0-4" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h15-0-5" id="h15-0-5" class="i">+import androidx.compose.material.icons.filled.Edit
</a><a href="#h15-0-6" id="h15-0-6" class="i">+import androidx.compose.material.icons.filled.Settings
</a><a href="#h15-0-7" id="h15-0-7" class="i">+import androidx.compose.material3.*
</a><a href="#h15-0-8" id="h15-0-8" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h15-0-9" id="h15-0-9" class="i">+import androidx.compose.runtime.getValue
</a><a href="#h15-0-10" id="h15-0-10" class="i">+import androidx.compose.runtime.mutableStateOf
</a><a href="#h15-0-11" id="h15-0-11" class="i">+import androidx.compose.runtime.remember
</a><a href="#h15-0-12" id="h15-0-12" class="i">+import androidx.compose.runtime.setValue
</a><a href="#h15-0-13" id="h15-0-13" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h15-0-14" id="h15-0-14" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h15-0-15" id="h15-0-15" class="i">+import androidx.compose.ui.focus.FocusRequester
</a><a href="#h15-0-16" id="h15-0-16" class="i">+import androidx.compose.ui.focus.focusRequester
</a><a href="#h15-0-17" id="h15-0-17" class="i">+import androidx.compose.ui.layout.onGloballyPositioned
</a><a href="#h15-0-18" id="h15-0-18" class="i">+import androidx.compose.ui.text.TextRange
</a><a href="#h15-0-19" id="h15-0-19" class="i">+import androidx.compose.ui.text.input.TextFieldValue
</a><a href="#h15-0-20" id="h15-0-20" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h15-0-21" id="h15-0-21" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h15-0-22" id="h15-0-22" class="i">+import androidx.compose.ui.window.Dialog
</a><a href="#h15-0-23" id="h15-0-23" class="i">+import me.rhunk.snapenhance.manager.ui.tab.Tab
</a><a href="#h15-0-24" id="h15-0-24" class="i">+
</a><a href="#h15-0-25" id="h15-0-25" class="i">+class SettingsTab : Tab(&quot;settings&quot;, isPrimary = true, icon = Icons.Default.Settings) {
</a><a href="#h15-0-26" id="h15-0-26" class="i">+    @Composable
</a><a href="#h15-0-27" id="h15-0-27" class="i">+    private fun ConfigEditRow(getValue: () -&gt; String?, setValue: (String) -&gt; Unit, label: String) {
</a><a href="#h15-0-28" id="h15-0-28" class="i">+        var showDialog by remember { mutableStateOf(false) }
</a><a href="#h15-0-29" id="h15-0-29" class="i">+
</a><a href="#h15-0-30" id="h15-0-30" class="i">+        if (showDialog) {
</a><a href="#h15-0-31" id="h15-0-31" class="i">+            val focusRequester = remember { FocusRequester() }
</a><a href="#h15-0-32" id="h15-0-32" class="i">+
</a><a href="#h15-0-33" id="h15-0-33" class="i">+            Dialog(onDismissRequest = {
</a><a href="#h15-0-34" id="h15-0-34" class="i">+                showDialog = false
</a><a href="#h15-0-35" id="h15-0-35" class="i">+            }) {
</a><a href="#h15-0-36" id="h15-0-36" class="i">+                Card {
</a><a href="#h15-0-37" id="h15-0-37" class="i">+                    Column(
</a><a href="#h15-0-38" id="h15-0-38" class="i">+                        modifier = Modifier.padding(16.dp),
</a><a href="#h15-0-39" id="h15-0-39" class="i">+                        horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h15-0-40" id="h15-0-40" class="i">+                        verticalArrangement = Arrangement.spacedBy(16.dp)
</a><a href="#h15-0-41" id="h15-0-41" class="i">+                    ) {
</a><a href="#h15-0-42" id="h15-0-42" class="i">+                        Text(text = label)
</a><a href="#h15-0-43" id="h15-0-43" class="i">+                        var textFieldValue by remember { mutableStateOf((getValue() ?: &quot;&quot;).let {
</a><a href="#h15-0-44" id="h15-0-44" class="i">+                            TextFieldValue(it, TextRange(it.length))
</a><a href="#h15-0-45" id="h15-0-45" class="i">+                        }) }
</a><a href="#h15-0-46" id="h15-0-46" class="i">+
</a><a href="#h15-0-47" id="h15-0-47" class="i">+                        TextField(
</a><a href="#h15-0-48" id="h15-0-48" class="i">+                            value = textFieldValue,
</a><a href="#h15-0-49" id="h15-0-49" class="i">+                            onValueChange = {
</a><a href="#h15-0-50" id="h15-0-50" class="i">+                                textFieldValue = it
</a><a href="#h15-0-51" id="h15-0-51" class="i">+                            },
</a><a href="#h15-0-52" id="h15-0-52" class="i">+                            modifier = Modifier
</a><a href="#h15-0-53" id="h15-0-53" class="i">+                                .focusRequester(focusRequester)
</a><a href="#h15-0-54" id="h15-0-54" class="i">+                                .onGloballyPositioned {
</a><a href="#h15-0-55" id="h15-0-55" class="i">+                                    focusRequester.requestFocus()
</a><a href="#h15-0-56" id="h15-0-56" class="i">+                                }
</a><a href="#h15-0-57" id="h15-0-57" class="i">+                        )
</a><a href="#h15-0-58" id="h15-0-58" class="i">+                        Row(
</a><a href="#h15-0-59" id="h15-0-59" class="i">+                            modifier = Modifier.fillMaxWidth(),
</a><a href="#h15-0-60" id="h15-0-60" class="i">+                            horizontalArrangement = Arrangement.SpaceAround
</a><a href="#h15-0-61" id="h15-0-61" class="i">+                        ) {
</a><a href="#h15-0-62" id="h15-0-62" class="i">+                            Button(onClick = {
</a><a href="#h15-0-63" id="h15-0-63" class="i">+                                showDialog = false
</a><a href="#h15-0-64" id="h15-0-64" class="i">+                            }) {
</a><a href="#h15-0-65" id="h15-0-65" class="i">+                                Text(text = &quot;Cancel&quot;)
</a><a href="#h15-0-66" id="h15-0-66" class="i">+                            }
</a><a href="#h15-0-67" id="h15-0-67" class="i">+                            Button(onClick = {
</a><a href="#h15-0-68" id="h15-0-68" class="i">+                                setValue(textFieldValue.text)
</a><a href="#h15-0-69" id="h15-0-69" class="i">+                                showDialog = false
</a><a href="#h15-0-70" id="h15-0-70" class="i">+                            }) {
</a><a href="#h15-0-71" id="h15-0-71" class="i">+                                Text(text = &quot;Save&quot;)
</a><a href="#h15-0-72" id="h15-0-72" class="i">+                            }
</a><a href="#h15-0-73" id="h15-0-73" class="i">+                        }
</a><a href="#h15-0-74" id="h15-0-74" class="i">+                    }
</a><a href="#h15-0-75" id="h15-0-75" class="i">+                }
</a><a href="#h15-0-76" id="h15-0-76" class="i">+            }
</a><a href="#h15-0-77" id="h15-0-77" class="i">+        }
</a><a href="#h15-0-78" id="h15-0-78" class="i">+
</a><a href="#h15-0-79" id="h15-0-79" class="i">+        Row(
</a><a href="#h15-0-80" id="h15-0-80" class="i">+            modifier = Modifier
</a><a href="#h15-0-81" id="h15-0-81" class="i">+                .fillMaxWidth()
</a><a href="#h15-0-82" id="h15-0-82" class="i">+                .clickable {
</a><a href="#h15-0-83" id="h15-0-83" class="i">+                    showDialog = true
</a><a href="#h15-0-84" id="h15-0-84" class="i">+                },
</a><a href="#h15-0-85" id="h15-0-85" class="i">+            verticalAlignment = Alignment.CenterVertically
</a><a href="#h15-0-86" id="h15-0-86" class="i">+        ) {
</a><a href="#h15-0-87" id="h15-0-87" class="i">+            Column(
</a><a href="#h15-0-88" id="h15-0-88" class="i">+                modifier = Modifier
</a><a href="#h15-0-89" id="h15-0-89" class="i">+                    .weight(1f)
</a><a href="#h15-0-90" id="h15-0-90" class="i">+                    .padding(16.dp),
</a><a href="#h15-0-91" id="h15-0-91" class="i">+                verticalArrangement = Arrangement.spacedBy(4.dp)
</a><a href="#h15-0-92" id="h15-0-92" class="i">+            ) {
</a><a href="#h15-0-93" id="h15-0-93" class="i">+                Text(text = label, fontSize = 16.sp)
</a><a href="#h15-0-94" id="h15-0-94" class="i">+                Text(text = getValue() ?: &quot;(Not specified)&quot;, fontSize = 12.sp, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h15-0-95" id="h15-0-95" class="i">+            }
</a><a href="#h15-0-96" id="h15-0-96" class="i">+            Icon(imageVector = Icons.Default.Edit, contentDescription = null, modifier = Modifier.padding(16.dp))
</a><a href="#h15-0-97" id="h15-0-97" class="i">+        }
</a><a href="#h15-0-98" id="h15-0-98" class="i">+    }
</a><a href="#h15-0-99" id="h15-0-99" class="i">+
</a><a href="#h15-0-100" id="h15-0-100" class="i">+
</a><a href="#h15-0-101" id="h15-0-101" class="i">+    @Composable
</a><a href="#h15-0-102" id="h15-0-102" class="i">+    private fun ConfigBooleanRow(getValue: () -&gt; Boolean, setValue: (Boolean) -&gt; Unit, label: String) {
</a><a href="#h15-0-103" id="h15-0-103" class="i">+        var value by remember { mutableStateOf(getValue()) }
</a><a href="#h15-0-104" id="h15-0-104" class="i">+        Row(
</a><a href="#h15-0-105" id="h15-0-105" class="i">+            modifier = Modifier
</a><a href="#h15-0-106" id="h15-0-106" class="i">+                .fillMaxWidth()
</a><a href="#h15-0-107" id="h15-0-107" class="i">+                .clickable {
</a><a href="#h15-0-108" id="h15-0-108" class="i">+                    value = !value
</a><a href="#h15-0-109" id="h15-0-109" class="i">+                    setValue(value)
</a><a href="#h15-0-110" id="h15-0-110" class="i">+                },
</a><a href="#h15-0-111" id="h15-0-111" class="i">+            verticalAlignment = Alignment.CenterVertically
</a><a href="#h15-0-112" id="h15-0-112" class="i">+        ) {
</a><a href="#h15-0-113" id="h15-0-113" class="i">+            Column(
</a><a href="#h15-0-114" id="h15-0-114" class="i">+                modifier = Modifier
</a><a href="#h15-0-115" id="h15-0-115" class="i">+                    .weight(1f)
</a><a href="#h15-0-116" id="h15-0-116" class="i">+                    .padding(16.dp),
</a><a href="#h15-0-117" id="h15-0-117" class="i">+                verticalArrangement = Arrangement.spacedBy(4.dp)
</a><a href="#h15-0-118" id="h15-0-118" class="i">+            ) {
</a><a href="#h15-0-119" id="h15-0-119" class="i">+                Text(text = label, fontSize = 16.sp)
</a><a href="#h15-0-120" id="h15-0-120" class="i">+            }
</a><a href="#h15-0-121" id="h15-0-121" class="i">+            Checkbox(checked = value, onCheckedChange = {
</a><a href="#h15-0-122" id="h15-0-122" class="i">+                value = it
</a><a href="#h15-0-123" id="h15-0-123" class="i">+                setValue(it)
</a><a href="#h15-0-124" id="h15-0-124" class="i">+            }, modifier = Modifier.padding(5.dp))
</a><a href="#h15-0-125" id="h15-0-125" class="i">+        }
</a><a href="#h15-0-126" id="h15-0-126" class="i">+    }
</a><a href="#h15-0-127" id="h15-0-127" class="i">+
</a><a href="#h15-0-128" id="h15-0-128" class="i">+    @Composable
</a><a href="#h15-0-129" id="h15-0-129" class="i">+    override fun Content() {
</a><a href="#h15-0-130" id="h15-0-130" class="i">+        Column {
</a><a href="#h15-0-131" id="h15-0-131" class="i">+            Spacer(modifier = Modifier.height(16.dp))
</a><a href="#h15-0-132" id="h15-0-132" class="i">+            ConfigEditRow(
</a><a href="#h15-0-133" id="h15-0-133" class="i">+                getValue = { sharedConfig.snapchatPackageName },
</a><a href="#h15-0-134" id="h15-0-134" class="i">+                setValue = { sharedConfig.snapchatPackageName = it },
</a><a href="#h15-0-135" id="h15-0-135" class="i">+                label = &quot;Override Snapchat package name&quot;
</a><a href="#h15-0-136" id="h15-0-136" class="i">+            )
</a><a href="#h15-0-137" id="h15-0-137" class="i">+            ConfigEditRow(
</a><a href="#h15-0-138" id="h15-0-138" class="i">+                getValue = { sharedConfig.snapEnhancePackageName },
</a><a href="#h15-0-139" id="h15-0-139" class="i">+                setValue = { sharedConfig.snapEnhancePackageName = it },
</a><a href="#h15-0-140" id="h15-0-140" class="i">+                label = &quot;Override SnapEnhance package name&quot;
</a><a href="#h15-0-141" id="h15-0-141" class="i">+            )
</a><a href="#h15-0-142" id="h15-0-142" class="i">+            ConfigBooleanRow(
</a><a href="#h15-0-143" id="h15-0-143" class="i">+                getValue = { sharedConfig.useRootInstaller },
</a><a href="#h15-0-144" id="h15-0-144" class="i">+                setValue = { sharedConfig.useRootInstaller = it },
</a><a href="#h15-0-145" id="h15-0-145" class="i">+                label = &quot;Use root installer&quot;
</a><a href="#h15-0-146" id="h15-0-146" class="i">+            )
</a><a href="#h15-0-147" id="h15-0-147" class="i">+        }
</a><a href="#h15-0-148" id="h15-0-148" class="i">+    }
</a><a href="#h15-0-149" id="h15-0-149" class="i">+}</a><a href="#h15-0-150" id="h15-0-150" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/InstallPackageTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/InstallPackageTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/InstallPackageTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/InstallPackageTab.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -0,0 +1,224 @@
</a><a href="#h16-0-0" id="h16-0-0" class="i">+package me.rhunk.snapenhance.manager.ui.tab.impl.download
</a><a href="#h16-0-1" id="h16-0-1" class="i">+
</a><a href="#h16-0-2" id="h16-0-2" class="i">+import android.content.Intent
</a><a href="#h16-0-3" id="h16-0-3" class="i">+import android.net.Uri
</a><a href="#h16-0-4" id="h16-0-4" class="i">+import android.widget.Toast
</a><a href="#h16-0-5" id="h16-0-5" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h16-0-6" id="h16-0-6" class="i">+import androidx.activity.result.ActivityResultLauncher
</a><a href="#h16-0-7" id="h16-0-7" class="i">+import androidx.activity.result.contract.ActivityResultContracts
</a><a href="#h16-0-8" id="h16-0-8" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h16-0-9" id="h16-0-9" class="i">+import androidx.compose.material3.CircularProgressIndicator
</a><a href="#h16-0-10" id="h16-0-10" class="i">+import androidx.compose.material3.LinearProgressIndicator
</a><a href="#h16-0-11" id="h16-0-11" class="i">+import androidx.compose.material3.Text
</a><a href="#h16-0-12" id="h16-0-12" class="i">+import androidx.compose.runtime.*
</a><a href="#h16-0-13" id="h16-0-13" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h16-0-14" id="h16-0-14" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h16-0-15" id="h16-0-15" class="i">+import androidx.compose.ui.graphics.StrokeCap
</a><a href="#h16-0-16" id="h16-0-16" class="i">+import androidx.compose.ui.platform.LocalContext
</a><a href="#h16-0-17" id="h16-0-17" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h16-0-18" id="h16-0-18" class="i">+import androidx.core.content.FileProvider
</a><a href="#h16-0-19" id="h16-0-19" class="i">+import androidx.core.net.toUri
</a><a href="#h16-0-20" id="h16-0-20" class="i">+import com.topjohnwu.superuser.Shell
</a><a href="#h16-0-21" id="h16-0-21" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h16-0-22" id="h16-0-22" class="i">+import kotlinx.coroutines.launch
</a><a href="#h16-0-23" id="h16-0-23" class="i">+import me.rhunk.snapenhance.manager.data.download.InstallStage
</a><a href="#h16-0-24" id="h16-0-24" class="i">+import me.rhunk.snapenhance.manager.ui.tab.Tab
</a><a href="#h16-0-25" id="h16-0-25" class="i">+import me.rhunk.snapenhance.manager.ui.tab.impl.HomeTab
</a><a href="#h16-0-26" id="h16-0-26" class="i">+import okhttp3.OkHttpClient
</a><a href="#h16-0-27" id="h16-0-27" class="i">+import okhttp3.Request
</a><a href="#h16-0-28" id="h16-0-28" class="i">+import java.io.File
</a><a href="#h16-0-29" id="h16-0-29" class="i">+
</a><a href="#h16-0-30" id="h16-0-30" class="i">+
</a><a href="#h16-0-31" id="h16-0-31" class="i">+class InstallPackageTab : Tab(&quot;install_app&quot;) {
</a><a href="#h16-0-32" id="h16-0-32" class="i">+    private lateinit var installPackageIntentLauncher: ActivityResultLauncher&lt;Intent&gt;
</a><a href="#h16-0-33" id="h16-0-33" class="i">+    private lateinit var uninstallPackageIntentLauncher: ActivityResultLauncher&lt;Intent&gt;
</a><a href="#h16-0-34" id="h16-0-34" class="i">+    private var uninstallPackageCallback: ((resultCode: Int) -&gt; Unit)? = null
</a><a href="#h16-0-35" id="h16-0-35" class="i">+    private var installPackageCallback: ((resultCode: Int) -&gt; Unit)? = null
</a><a href="#h16-0-36" id="h16-0-36" class="i">+
</a><a href="#h16-0-37" id="h16-0-37" class="i">+    private val hasRoot get() = sharedConfig.useRootInstaller
</a><a href="#h16-0-38" id="h16-0-38" class="i">+
</a><a href="#h16-0-39" id="h16-0-39" class="i">+    override fun init(activity: ComponentActivity) {
</a><a href="#h16-0-40" id="h16-0-40" class="i">+        super.init(activity)
</a><a href="#h16-0-41" id="h16-0-41" class="i">+        installPackageIntentLauncher = activity.registerForActivityResult(ActivityResultContracts.StartActivityForResult()) {
</a><a href="#h16-0-42" id="h16-0-42" class="i">+            installPackageCallback?.invoke(it.resultCode)
</a><a href="#h16-0-43" id="h16-0-43" class="i">+        }
</a><a href="#h16-0-44" id="h16-0-44" class="i">+        uninstallPackageIntentLauncher = activity.registerForActivityResult(ActivityResultContracts.StartActivityForResult()) {
</a><a href="#h16-0-45" id="h16-0-45" class="i">+            uninstallPackageCallback?.invoke(it.resultCode)
</a><a href="#h16-0-46" id="h16-0-46" class="i">+        }
</a><a href="#h16-0-47" id="h16-0-47" class="i">+    }
</a><a href="#h16-0-48" id="h16-0-48" class="i">+
</a><a href="#h16-0-49" id="h16-0-49" class="i">+    private fun downloadArtifact(url: String, progress: (Float) -&gt; Unit): File? {
</a><a href="#h16-0-50" id="h16-0-50" class="i">+        val urlScheme = Uri.parse(url).scheme
</a><a href="#h16-0-51" id="h16-0-51" class="i">+        if (urlScheme != &quot;https&quot; &amp;&amp; urlScheme != &quot;http&quot;) {
</a><a href="#h16-0-52" id="h16-0-52" class="i">+            val file = File(url)
</a><a href="#h16-0-53" id="h16-0-53" class="i">+            val dest = File(activity.externalCacheDirs.first(), file.name).also {
</a><a href="#h16-0-54" id="h16-0-54" class="i">+                it.deleteOnExit()
</a><a href="#h16-0-55" id="h16-0-55" class="i">+            }
</a><a href="#h16-0-56" id="h16-0-56" class="i">+            if (dest.exists()) return file
</a><a href="#h16-0-57" id="h16-0-57" class="i">+            file.copyTo(dest)
</a><a href="#h16-0-58" id="h16-0-58" class="i">+            return dest
</a><a href="#h16-0-59" id="h16-0-59" class="i">+        }
</a><a href="#h16-0-60" id="h16-0-60" class="i">+
</a><a href="#h16-0-61" id="h16-0-61" class="i">+        val endpoint = Request.Builder().url(url).build()
</a><a href="#h16-0-62" id="h16-0-62" class="i">+        val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h16-0-63" id="h16-0-63" class="i">+        if (!response.isSuccessful) throw Throwable(&quot;Failed to download artifact: ${response.code}&quot;)
</a><a href="#h16-0-64" id="h16-0-64" class="i">+
</a><a href="#h16-0-65" id="h16-0-65" class="i">+        return response.body.byteStream().use { input -&gt;
</a><a href="#h16-0-66" id="h16-0-66" class="i">+            val file = File.createTempFile(&quot;artifact&quot;, &quot;.apk&quot;, activity.externalCacheDirs.first()).also {
</a><a href="#h16-0-67" id="h16-0-67" class="i">+                it.deleteOnExit()
</a><a href="#h16-0-68" id="h16-0-68" class="i">+            }
</a><a href="#h16-0-69" id="h16-0-69" class="i">+            runCatching {
</a><a href="#h16-0-70" id="h16-0-70" class="i">+                file.outputStream().use { output -&gt;
</a><a href="#h16-0-71" id="h16-0-71" class="i">+                    val buffer = ByteArray(4 * 1024)
</a><a href="#h16-0-72" id="h16-0-72" class="i">+                    var read: Int
</a><a href="#h16-0-73" id="h16-0-73" class="i">+                    var totalRead = 0L
</a><a href="#h16-0-74" id="h16-0-74" class="i">+                    val totalSize = response.body.contentLength()
</a><a href="#h16-0-75" id="h16-0-75" class="i">+                    while (input.read(buffer).also { read = it } != -1) {
</a><a href="#h16-0-76" id="h16-0-76" class="i">+                        output.write(buffer, 0, read)
</a><a href="#h16-0-77" id="h16-0-77" class="i">+                        totalRead += read
</a><a href="#h16-0-78" id="h16-0-78" class="i">+                        progress(totalRead.toFloat() / totalSize.toFloat())
</a><a href="#h16-0-79" id="h16-0-79" class="i">+                    }
</a><a href="#h16-0-80" id="h16-0-80" class="i">+                }
</a><a href="#h16-0-81" id="h16-0-81" class="i">+                file
</a><a href="#h16-0-82" id="h16-0-82" class="i">+            }.getOrNull()
</a><a href="#h16-0-83" id="h16-0-83" class="i">+        }
</a><a href="#h16-0-84" id="h16-0-84" class="i">+    }
</a><a href="#h16-0-85" id="h16-0-85" class="i">+
</a><a href="#h16-0-86" id="h16-0-86" class="i">+
</a><a href="#h16-0-87" id="h16-0-87" class="i">+    @Composable
</a><a href="#h16-0-88" id="h16-0-88" class="i">+    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h16-0-89" id="h16-0-89" class="i">+    override fun Content() {
</a><a href="#h16-0-90" id="h16-0-90" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h16-0-91" id="h16-0-91" class="i">+        val context = LocalContext.current
</a><a href="#h16-0-92" id="h16-0-92" class="i">+        var installStage by remember { mutableStateOf(InstallStage.DOWNLOADING) }
</a><a href="#h16-0-93" id="h16-0-93" class="i">+        var downloadProgress by remember { mutableFloatStateOf(-1f) }
</a><a href="#h16-0-94" id="h16-0-94" class="i">+        var downloadedFile by remember { mutableStateOf&lt;File?&gt;(null) }
</a><a href="#h16-0-95" id="h16-0-95" class="i">+
</a><a href="#h16-0-96" id="h16-0-96" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h16-0-97" id="h16-0-97" class="i">+            uninstallPackageCallback = null
</a><a href="#h16-0-98" id="h16-0-98" class="i">+            installPackageCallback = null
</a><a href="#h16-0-99" id="h16-0-99" class="i">+        }
</a><a href="#h16-0-100" id="h16-0-100" class="i">+
</a><a href="#h16-0-101" id="h16-0-101" class="i">+        val downloadPath = getArguments()?.getString(&quot;downloadPath&quot;) ?: return
</a><a href="#h16-0-102" id="h16-0-102" class="i">+        val appPackage = getArguments()?.getString(&quot;appPackage&quot;) ?: return
</a><a href="#h16-0-103" id="h16-0-103" class="i">+        val shouldUninstall = getArguments()?.getBoolean(&quot;uninstall&quot;) ?: false
</a><a href="#h16-0-104" id="h16-0-104" class="i">+
</a><a href="#h16-0-105" id="h16-0-105" class="i">+        Column(
</a><a href="#h16-0-106" id="h16-0-106" class="i">+            modifier = Modifier.fillMaxSize().padding(16.dp),
</a><a href="#h16-0-107" id="h16-0-107" class="i">+            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h16-0-108" id="h16-0-108" class="i">+            verticalArrangement = Arrangement.spacedBy(16.dp, Alignment.CenterVertically)
</a><a href="#h16-0-109" id="h16-0-109" class="i">+        ) {
</a><a href="#h16-0-110" id="h16-0-110" class="i">+            Row(
</a><a href="#h16-0-111" id="h16-0-111" class="i">+                modifier = Modifier.fillMaxWidth(),
</a><a href="#h16-0-112" id="h16-0-112" class="i">+                horizontalArrangement = Arrangement.Center
</a><a href="#h16-0-113" id="h16-0-113" class="i">+            ) {
</a><a href="#h16-0-114" id="h16-0-114" class="i">+                if (installStage != InstallStage.DONE &amp;&amp; installStage != InstallStage.ERROR) {
</a><a href="#h16-0-115" id="h16-0-115" class="i">+                    CircularProgressIndicator()
</a><a href="#h16-0-116" id="h16-0-116" class="i">+                }
</a><a href="#h16-0-117" id="h16-0-117" class="i">+            }
</a><a href="#h16-0-118" id="h16-0-118" class="i">+
</a><a href="#h16-0-119" id="h16-0-119" class="i">+            when (installStage) {
</a><a href="#h16-0-120" id="h16-0-120" class="i">+                InstallStage.DOWNLOADING -&gt; {
</a><a href="#h16-0-121" id="h16-0-121" class="i">+                    Text(text = &quot;Downloading ...&quot;)
</a><a href="#h16-0-122" id="h16-0-122" class="i">+                    LinearProgressIndicator(progress = downloadProgress, Modifier.fillMaxWidth().height(4.dp), strokeCap = StrokeCap.Round)
</a><a href="#h16-0-123" id="h16-0-123" class="i">+                }
</a><a href="#h16-0-124" id="h16-0-124" class="i">+                InstallStage.UNINSTALLING -&gt; {
</a><a href="#h16-0-125" id="h16-0-125" class="i">+                    Text(text = &quot;Uninstalling app $appPackage...&quot;)
</a><a href="#h16-0-126" id="h16-0-126" class="i">+                }
</a><a href="#h16-0-127" id="h16-0-127" class="i">+                InstallStage.INSTALLING -&gt; {
</a><a href="#h16-0-128" id="h16-0-128" class="i">+                    Text(text = &quot;Installing ...&quot;)
</a><a href="#h16-0-129" id="h16-0-129" class="i">+                }
</a><a href="#h16-0-130" id="h16-0-130" class="i">+                InstallStage.DONE -&gt; {
</a><a href="#h16-0-131" id="h16-0-131" class="i">+                    LaunchedEffect(Unit) {
</a><a href="#h16-0-132" id="h16-0-132" class="i">+                        navigation.navigateTo(HomeTab::class, noHistory = true)
</a><a href="#h16-0-133" id="h16-0-133" class="i">+                        Toast.makeText(context, &quot;Successfully installed $appPackage!&quot;, Toast.LENGTH_SHORT).show()
</a><a href="#h16-0-134" id="h16-0-134" class="i">+                    }
</a><a href="#h16-0-135" id="h16-0-135" class="i">+                }
</a><a href="#h16-0-136" id="h16-0-136" class="i">+                InstallStage.ERROR -&gt; Text(text = &quot;Failed to install $appPackage. Check logcat for more details.&quot;)
</a><a href="#h16-0-137" id="h16-0-137" class="i">+            }
</a><a href="#h16-0-138" id="h16-0-138" class="i">+        }
</a><a href="#h16-0-139" id="h16-0-139" class="i">+
</a><a href="#h16-0-140" id="h16-0-140" class="i">+        fun uninstallPackageRoot(): Boolean {
</a><a href="#h16-0-141" id="h16-0-141" class="i">+            val result = Shell.su(&quot;pm uninstall $appPackage&quot;).exec()
</a><a href="#h16-0-142" id="h16-0-142" class="i">+            if (result.isSuccess) {
</a><a href="#h16-0-143" id="h16-0-143" class="i">+                return true
</a><a href="#h16-0-144" id="h16-0-144" class="i">+            }
</a><a href="#h16-0-145" id="h16-0-145" class="i">+            toast(&quot;Root uninstall failed: ${result.out}&quot;)
</a><a href="#h16-0-146" id="h16-0-146" class="i">+            return false
</a><a href="#h16-0-147" id="h16-0-147" class="i">+        }
</a><a href="#h16-0-148" id="h16-0-148" class="i">+
</a><a href="#h16-0-149" id="h16-0-149" class="i">+        fun installPackageRoot(): Boolean {
</a><a href="#h16-0-150" id="h16-0-150" class="i">+            val result = Shell.su(
</a><a href="#h16-0-151" id="h16-0-151" class="i">+                &quot;cp \&quot;${downloadedFile!!.absolutePath}\&quot; /data/local/tmp/&quot;,
</a><a href="#h16-0-152" id="h16-0-152" class="i">+                &quot;pm install -r \&quot;/data/local/tmp/${downloadedFile!!.name}\&quot;&quot;,
</a><a href="#h16-0-153" id="h16-0-153" class="i">+                &quot;rm /data/local/tmp/${downloadedFile!!.name}&quot;
</a><a href="#h16-0-154" id="h16-0-154" class="i">+            ).exec()
</a><a href="#h16-0-155" id="h16-0-155" class="i">+            if (result.isSuccess) {
</a><a href="#h16-0-156" id="h16-0-156" class="i">+                installStage = InstallStage.DONE
</a><a href="#h16-0-157" id="h16-0-157" class="i">+                return true
</a><a href="#h16-0-158" id="h16-0-158" class="i">+            }
</a><a href="#h16-0-159" id="h16-0-159" class="i">+            toast(&quot;Root install failed: ${result.out}&quot;)
</a><a href="#h16-0-160" id="h16-0-160" class="i">+            return false
</a><a href="#h16-0-161" id="h16-0-161" class="i">+        }
</a><a href="#h16-0-162" id="h16-0-162" class="i">+
</a><a href="#h16-0-163" id="h16-0-163" class="i">+        fun installPackage() {
</a><a href="#h16-0-164" id="h16-0-164" class="i">+            installStage = InstallStage.INSTALLING
</a><a href="#h16-0-165" id="h16-0-165" class="i">+            if (hasRoot &amp;&amp; installPackageRoot()) {
</a><a href="#h16-0-166" id="h16-0-166" class="i">+                downloadedFile?.delete()
</a><a href="#h16-0-167" id="h16-0-167" class="i">+                return
</a><a href="#h16-0-168" id="h16-0-168" class="i">+            }
</a><a href="#h16-0-169" id="h16-0-169" class="i">+            installPackageCallback = resultCallbacks@{ code -&gt;
</a><a href="#h16-0-170" id="h16-0-170" class="i">+                installStage = if (code != ComponentActivity.RESULT_OK) {
</a><a href="#h16-0-171" id="h16-0-171" class="i">+                    InstallStage.ERROR
</a><a href="#h16-0-172" id="h16-0-172" class="i">+                } else {
</a><a href="#h16-0-173" id="h16-0-173" class="i">+                    InstallStage.DONE
</a><a href="#h16-0-174" id="h16-0-174" class="i">+                }
</a><a href="#h16-0-175" id="h16-0-175" class="i">+                downloadedFile?.delete()
</a><a href="#h16-0-176" id="h16-0-176" class="i">+            }
</a><a href="#h16-0-177" id="h16-0-177" class="i">+
</a><a href="#h16-0-178" id="h16-0-178" class="i">+            installPackageIntentLauncher.launch(Intent(Intent.ACTION_INSTALL_PACKAGE).apply {
</a><a href="#h16-0-179" id="h16-0-179" class="i">+                data = FileProvider.getUriForFile(context, &quot;me.rhunk.snapenhance.manager.provider&quot;, downloadedFile!!)
</a><a href="#h16-0-180" id="h16-0-180" class="i">+                setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
</a><a href="#h16-0-181" id="h16-0-181" class="i">+                putExtra(Intent.EXTRA_RETURN_RESULT, true)
</a><a href="#h16-0-182" id="h16-0-182" class="i">+            })
</a><a href="#h16-0-183" id="h16-0-183" class="i">+        }
</a><a href="#h16-0-184" id="h16-0-184" class="i">+
</a><a href="#h16-0-185" id="h16-0-185" class="i">+
</a><a href="#h16-0-186" id="h16-0-186" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h16-0-187" id="h16-0-187" class="i">+            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h16-0-188" id="h16-0-188" class="i">+                runCatching {
</a><a href="#h16-0-189" id="h16-0-189" class="i">+                    downloadedFile = downloadArtifact(downloadPath) { downloadProgress = it } ?: run {
</a><a href="#h16-0-190" id="h16-0-190" class="i">+                        installStage = InstallStage.ERROR
</a><a href="#h16-0-191" id="h16-0-191" class="i">+                        return@launch
</a><a href="#h16-0-192" id="h16-0-192" class="i">+                    }
</a><a href="#h16-0-193" id="h16-0-193" class="i">+                    if (shouldUninstall) {
</a><a href="#h16-0-194" id="h16-0-194" class="i">+                        installStage = InstallStage.UNINSTALLING
</a><a href="#h16-0-195" id="h16-0-195" class="i">+                        if (hasRoot &amp;&amp; uninstallPackageRoot()) {
</a><a href="#h16-0-196" id="h16-0-196" class="i">+                            installPackage()
</a><a href="#h16-0-197" id="h16-0-197" class="i">+                            return@launch
</a><a href="#h16-0-198" id="h16-0-198" class="i">+                        }
</a><a href="#h16-0-199" id="h16-0-199" class="i">+                        val intent = Intent(Intent.ACTION_UNINSTALL_PACKAGE).apply {
</a><a href="#h16-0-200" id="h16-0-200" class="i">+                            data = &quot;package:$appPackage&quot;.toUri()
</a><a href="#h16-0-201" id="h16-0-201" class="i">+                            putExtra(Intent.EXTRA_RETURN_RESULT, true)
</a><a href="#h16-0-202" id="h16-0-202" class="i">+                        }
</a><a href="#h16-0-203" id="h16-0-203" class="i">+                        uninstallPackageCallback = resultCallback@{ resultCode -&gt;
</a><a href="#h16-0-204" id="h16-0-204" class="i">+                            if (resultCode != ComponentActivity.RESULT_OK) {
</a><a href="#h16-0-205" id="h16-0-205" class="i">+                                installStage = InstallStage.ERROR
</a><a href="#h16-0-206" id="h16-0-206" class="i">+                                downloadedFile?.delete()
</a><a href="#h16-0-207" id="h16-0-207" class="i">+                                return@resultCallback
</a><a href="#h16-0-208" id="h16-0-208" class="i">+                            }
</a><a href="#h16-0-209" id="h16-0-209" class="i">+                            installPackage()
</a><a href="#h16-0-210" id="h16-0-210" class="i">+                        }
</a><a href="#h16-0-211" id="h16-0-211" class="i">+                        uninstallPackageIntentLauncher.launch(intent)
</a><a href="#h16-0-212" id="h16-0-212" class="i">+                    } else {
</a><a href="#h16-0-213" id="h16-0-213" class="i">+                        installPackage()
</a><a href="#h16-0-214" id="h16-0-214" class="i">+                    }
</a><a href="#h16-0-215" id="h16-0-215" class="i">+                }.onFailure {
</a><a href="#h16-0-216" id="h16-0-216" class="i">+                    it.printStackTrace()
</a><a href="#h16-0-217" id="h16-0-217" class="i">+                    installStage = InstallStage.ERROR
</a><a href="#h16-0-218" id="h16-0-218" class="i">+                    downloadedFile?.delete()
</a><a href="#h16-0-219" id="h16-0-219" class="i">+                }
</a><a href="#h16-0-220" id="h16-0-220" class="i">+            }
</a><a href="#h16-0-221" id="h16-0-221" class="i">+        }
</a><a href="#h16-0-222" id="h16-0-222" class="i">+    }
</a><a href="#h16-0-223" id="h16-0-223" class="i">+}
</a><b>diff --git a/<a id="h17" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/LSPatchTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/LSPatchTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/LSPatchTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/LSPatchTab.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -0,0 +1,202 @@
</a><a href="#h17-0-0" id="h17-0-0" class="i">+package me.rhunk.snapenhance.manager.ui.tab.impl.download
</a><a href="#h17-0-1" id="h17-0-1" class="i">+
</a><a href="#h17-0-2" id="h17-0-2" class="i">+import android.os.Bundle
</a><a href="#h17-0-3" id="h17-0-3" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h17-0-4" id="h17-0-4" class="i">+import androidx.compose.foundation.rememberScrollState
</a><a href="#h17-0-5" id="h17-0-5" class="i">+import androidx.compose.foundation.verticalScroll
</a><a href="#h17-0-6" id="h17-0-6" class="i">+import androidx.compose.material3.Button
</a><a href="#h17-0-7" id="h17-0-7" class="i">+import androidx.compose.material3.Card
</a><a href="#h17-0-8" id="h17-0-8" class="i">+import androidx.compose.material3.LinearProgressIndicator
</a><a href="#h17-0-9" id="h17-0-9" class="i">+import androidx.compose.material3.Text
</a><a href="#h17-0-10" id="h17-0-10" class="i">+import androidx.compose.runtime.*
</a><a href="#h17-0-11" id="h17-0-11" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h17-0-12" id="h17-0-12" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h17-0-13" id="h17-0-13" class="i">+import androidx.compose.ui.graphics.StrokeCap
</a><a href="#h17-0-14" id="h17-0-14" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h17-0-15" id="h17-0-15" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h17-0-16" id="h17-0-16" class="i">+import androidx.compose.ui.window.Dialog
</a><a href="#h17-0-17" id="h17-0-17" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h17-0-18" id="h17-0-18" class="i">+import kotlinx.coroutines.launch
</a><a href="#h17-0-19" id="h17-0-19" class="i">+import me.rhunk.snapenhance.manager.data.APKMirror
</a><a href="#h17-0-20" id="h17-0-20" class="i">+import me.rhunk.snapenhance.manager.data.DownloadItem
</a><a href="#h17-0-21" id="h17-0-21" class="i">+import me.rhunk.snapenhance.manager.lspatch.LSPatch
</a><a href="#h17-0-22" id="h17-0-22" class="i">+import me.rhunk.snapenhance.manager.ui.components.DowngradeNoticeDialog
</a><a href="#h17-0-23" id="h17-0-23" class="i">+import me.rhunk.snapenhance.manager.ui.tab.Tab
</a><a href="#h17-0-24" id="h17-0-24" class="i">+import okio.use
</a><a href="#h17-0-25" id="h17-0-25" class="i">+import java.io.File
</a><a href="#h17-0-26" id="h17-0-26" class="i">+
</a><a href="#h17-0-27" id="h17-0-27" class="i">+class LSPatchTab : Tab(&quot;lspatch&quot;) {
</a><a href="#h17-0-28" id="h17-0-28" class="i">+    private var localItemFile: File? = null
</a><a href="#h17-0-29" id="h17-0-29" class="i">+    private var downloadItem: DownloadItem? = null
</a><a href="#h17-0-30" id="h17-0-30" class="i">+    private var snapEnhanceModule: File? = null
</a><a href="#h17-0-31" id="h17-0-31" class="i">+    private var patchedApk by mutableStateOf&lt;File?&gt;(null)
</a><a href="#h17-0-32" id="h17-0-32" class="i">+    private val apkMirror = APKMirror()
</a><a href="#h17-0-33" id="h17-0-33" class="i">+
</a><a href="#h17-0-34" id="h17-0-34" class="i">+    private fun patch(log: (Any?) -&gt; Unit, onProgress: (Float) -&gt; Unit) {
</a><a href="#h17-0-35" id="h17-0-35" class="i">+        var apkFile: File? = localItemFile
</a><a href="#h17-0-36" id="h17-0-36" class="i">+
</a><a href="#h17-0-37" id="h17-0-37" class="i">+        downloadItem?.let {
</a><a href="#h17-0-38" id="h17-0-38" class="i">+            log(&quot;Fetching download link for ${it.title}...&quot;)
</a><a href="#h17-0-39" id="h17-0-39" class="i">+            val downloadLink = apkMirror.fetchDownloadLink(it.downloadPage) ?: run {
</a><a href="#h17-0-40" id="h17-0-40" class="i">+                log(&quot;== Failed to fetch download link ==&quot;)
</a><a href="#h17-0-41" id="h17-0-41" class="i">+                return
</a><a href="#h17-0-42" id="h17-0-42" class="i">+            }
</a><a href="#h17-0-43" id="h17-0-43" class="i">+            log(&quot;Downloading apk...&quot;)
</a><a href="#h17-0-44" id="h17-0-44" class="i">+
</a><a href="#h17-0-45" id="h17-0-45" class="i">+            val downloadResponse = apkMirror.okhttpClient.newCall(
</a><a href="#h17-0-46" id="h17-0-46" class="i">+                okhttp3.Request.Builder()
</a><a href="#h17-0-47" id="h17-0-47" class="i">+                    .url(downloadLink)
</a><a href="#h17-0-48" id="h17-0-48" class="i">+                    .build()
</a><a href="#h17-0-49" id="h17-0-49" class="i">+            ).execute()
</a><a href="#h17-0-50" id="h17-0-50" class="i">+
</a><a href="#h17-0-51" id="h17-0-51" class="i">+            if (!downloadResponse.isSuccessful) {
</a><a href="#h17-0-52" id="h17-0-52" class="i">+                log(&quot;== Failed to download apk ==&quot;)
</a><a href="#h17-0-53" id="h17-0-53" class="i">+                log(&quot;Response code: ${downloadResponse.code}&quot;)
</a><a href="#h17-0-54" id="h17-0-54" class="i">+                return
</a><a href="#h17-0-55" id="h17-0-55" class="i">+            }
</a><a href="#h17-0-56" id="h17-0-56" class="i">+
</a><a href="#h17-0-57" id="h17-0-57" class="i">+            apkFile = sharedConfig.apkCache.resolve(&quot;${it.hash}.apk&quot;)
</a><a href="#h17-0-58" id="h17-0-58" class="i">+            apkFile!!.outputStream().use { outputStream -&gt;
</a><a href="#h17-0-59" id="h17-0-59" class="i">+                runCatching {
</a><a href="#h17-0-60" id="h17-0-60" class="i">+                    downloadResponse.body.byteStream().use { inputStream -&gt;
</a><a href="#h17-0-61" id="h17-0-61" class="i">+                        val buffer = ByteArray(DEFAULT_BUFFER_SIZE)
</a><a href="#h17-0-62" id="h17-0-62" class="i">+                        var read: Int
</a><a href="#h17-0-63" id="h17-0-63" class="i">+                        var totalRead = 0L
</a><a href="#h17-0-64" id="h17-0-64" class="i">+                        val totalSize = downloadResponse.body.contentLength()
</a><a href="#h17-0-65" id="h17-0-65" class="i">+                        while (inputStream.read(buffer).also { read = it } != -1) {
</a><a href="#h17-0-66" id="h17-0-66" class="i">+                            outputStream.write(buffer, 0, read)
</a><a href="#h17-0-67" id="h17-0-67" class="i">+                            totalRead += read
</a><a href="#h17-0-68" id="h17-0-68" class="i">+                            onProgress(totalRead.toFloat() / totalSize.toFloat())
</a><a href="#h17-0-69" id="h17-0-69" class="i">+                        }
</a><a href="#h17-0-70" id="h17-0-70" class="i">+                    }
</a><a href="#h17-0-71" id="h17-0-71" class="i">+                }.onFailure { throwable -&gt;
</a><a href="#h17-0-72" id="h17-0-72" class="i">+                    log(&quot;== Failed to download apk ==&quot;)
</a><a href="#h17-0-73" id="h17-0-73" class="i">+                    log(throwable)
</a><a href="#h17-0-74" id="h17-0-74" class="i">+                    return
</a><a href="#h17-0-75" id="h17-0-75" class="i">+                }
</a><a href="#h17-0-76" id="h17-0-76" class="i">+            }
</a><a href="#h17-0-77" id="h17-0-77" class="i">+
</a><a href="#h17-0-78" id="h17-0-78" class="i">+            apkFile!!.renameTo(File(activity.externalCacheDir!!, &quot;base.apk&quot;))
</a><a href="#h17-0-79" id="h17-0-79" class="i">+        }
</a><a href="#h17-0-80" id="h17-0-80" class="i">+
</a><a href="#h17-0-81" id="h17-0-81" class="i">+        log(&quot;== Downloaded apk ==&quot;)
</a><a href="#h17-0-82" id="h17-0-82" class="i">+        snapEnhanceModule?.let { module -&gt;
</a><a href="#h17-0-83" id="h17-0-83" class="i">+            val lsPatch = LSPatch(activity, mapOf(
</a><a href="#h17-0-84" id="h17-0-84" class="i">+                sharedConfig.snapEnhancePackageName to module,
</a><a href="#h17-0-85" id="h17-0-85" class="i">+            ), printLog = {
</a><a href="#h17-0-86" id="h17-0-86" class="i">+                log(&quot;[LSPatch] $it&quot;)
</a><a href="#h17-0-87" id="h17-0-87" class="i">+            })
</a><a href="#h17-0-88" id="h17-0-88" class="i">+
</a><a href="#h17-0-89" id="h17-0-89" class="i">+            log(&quot;== Patching apk ==&quot;)
</a><a href="#h17-0-90" id="h17-0-90" class="i">+            val outputFiles = lsPatch.patchSplits(listOf(apkFile!!))
</a><a href="#h17-0-91" id="h17-0-91" class="i">+
</a><a href="#h17-0-92" id="h17-0-92" class="i">+            patchedApk = outputFiles[&quot;base.apk&quot;] ?: run {
</a><a href="#h17-0-93" id="h17-0-93" class="i">+                log(&quot;== Failed to patch apk ==&quot;)
</a><a href="#h17-0-94" id="h17-0-94" class="i">+                return
</a><a href="#h17-0-95" id="h17-0-95" class="i">+            }
</a><a href="#h17-0-96" id="h17-0-96" class="i">+            return
</a><a href="#h17-0-97" id="h17-0-97" class="i">+        }
</a><a href="#h17-0-98" id="h17-0-98" class="i">+        patchedApk = apkFile
</a><a href="#h17-0-99" id="h17-0-99" class="i">+    }
</a><a href="#h17-0-100" id="h17-0-100" class="i">+
</a><a href="#h17-0-101" id="h17-0-101" class="i">+    @Composable
</a><a href="#h17-0-102" id="h17-0-102" class="i">+    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h17-0-103" id="h17-0-103" class="i">+    override fun Content() {
</a><a href="#h17-0-104" id="h17-0-104" class="i">+        this.localItemFile = remember { getArguments()?.getString(&quot;localItemFile&quot;)?.let { File(it) } }
</a><a href="#h17-0-105" id="h17-0-105" class="i">+        this.downloadItem = remember { getArguments()?.getParcelable(&quot;downloadItem&quot;) }
</a><a href="#h17-0-106" id="h17-0-106" class="i">+        this.snapEnhanceModule = remember {
</a><a href="#h17-0-107" id="h17-0-107" class="i">+            getArguments()?.getString(&quot;modulePath&quot;)?.let {
</a><a href="#h17-0-108" id="h17-0-108" class="i">+                File(it)
</a><a href="#h17-0-109" id="h17-0-109" class="i">+            }
</a><a href="#h17-0-110" id="h17-0-110" class="i">+        }
</a><a href="#h17-0-111" id="h17-0-111" class="i">+
</a><a href="#h17-0-112" id="h17-0-112" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h17-0-113" id="h17-0-113" class="i">+        var showDowngradeNoticeDialog by remember { mutableStateOf(false) }
</a><a href="#h17-0-114" id="h17-0-114" class="i">+
</a><a href="#h17-0-115" id="h17-0-115" class="i">+        var status by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h17-0-116" id="h17-0-116" class="i">+        var progress by remember { mutableFloatStateOf(-1f) }
</a><a href="#h17-0-117" id="h17-0-117" class="i">+
</a><a href="#h17-0-118" id="h17-0-118" class="i">+        LaunchedEffect(this.snapEnhanceModule) {
</a><a href="#h17-0-119" id="h17-0-119" class="i">+            patchedApk = null
</a><a href="#h17-0-120" id="h17-0-120" class="i">+            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h17-0-121" id="h17-0-121" class="i">+                runCatching {
</a><a href="#h17-0-122" id="h17-0-122" class="i">+                    patch(log = {
</a><a href="#h17-0-123" id="h17-0-123" class="i">+                        coroutineScope.launch {
</a><a href="#h17-0-124" id="h17-0-124" class="i">+                            status += when (it) {
</a><a href="#h17-0-125" id="h17-0-125" class="i">+                                is Throwable -&gt; it.message + &quot;\n&quot; + it.stackTraceToString()
</a><a href="#h17-0-126" id="h17-0-126" class="i">+                                else -&gt; it.toString()
</a><a href="#h17-0-127" id="h17-0-127" class="i">+                            } + &quot;\n&quot;
</a><a href="#h17-0-128" id="h17-0-128" class="i">+                        }
</a><a href="#h17-0-129" id="h17-0-129" class="i">+                    }) {
</a><a href="#h17-0-130" id="h17-0-130" class="i">+                        progress = it
</a><a href="#h17-0-131" id="h17-0-131" class="i">+                    }
</a><a href="#h17-0-132" id="h17-0-132" class="i">+                }.onFailure {
</a><a href="#h17-0-133" id="h17-0-133" class="i">+                    coroutineScope.launch {
</a><a href="#h17-0-134" id="h17-0-134" class="i">+                        status += it.message + &quot;\n&quot; + it.stackTraceToString()
</a><a href="#h17-0-135" id="h17-0-135" class="i">+                    }
</a><a href="#h17-0-136" id="h17-0-136" class="i">+                }
</a><a href="#h17-0-137" id="h17-0-137" class="i">+            }
</a><a href="#h17-0-138" id="h17-0-138" class="i">+        }
</a><a href="#h17-0-139" id="h17-0-139" class="i">+
</a><a href="#h17-0-140" id="h17-0-140" class="i">+        val scrollState = rememberScrollState()
</a><a href="#h17-0-141" id="h17-0-141" class="i">+
</a><a href="#h17-0-142" id="h17-0-142" class="i">+        fun triggerInstallation(shouldUninstall: Boolean) {
</a><a href="#h17-0-143" id="h17-0-143" class="i">+            navigation.navigateTo(InstallPackageTab::class, args = Bundle().apply {
</a><a href="#h17-0-144" id="h17-0-144" class="i">+                putString(&quot;downloadPath&quot;, patchedApk?.absolutePath)
</a><a href="#h17-0-145" id="h17-0-145" class="i">+                putString(&quot;appPackage&quot;, sharedConfig.snapchatPackageName)
</a><a href="#h17-0-146" id="h17-0-146" class="i">+                putBoolean(&quot;uninstall&quot;, shouldUninstall)
</a><a href="#h17-0-147" id="h17-0-147" class="i">+            })
</a><a href="#h17-0-148" id="h17-0-148" class="i">+        }
</a><a href="#h17-0-149" id="h17-0-149" class="i">+
</a><a href="#h17-0-150" id="h17-0-150" class="i">+        Column(
</a><a href="#h17-0-151" id="h17-0-151" class="i">+            modifier = Modifier
</a><a href="#h17-0-152" id="h17-0-152" class="i">+                .fillMaxSize()
</a><a href="#h17-0-153" id="h17-0-153" class="i">+                .padding(20.dp),
</a><a href="#h17-0-154" id="h17-0-154" class="i">+            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h17-0-155" id="h17-0-155" class="i">+            verticalArrangement = Arrangement.spacedBy(10.dp)
</a><a href="#h17-0-156" id="h17-0-156" class="i">+        ) {
</a><a href="#h17-0-157" id="h17-0-157" class="i">+            Card(
</a><a href="#h17-0-158" id="h17-0-158" class="i">+                modifier = Modifier
</a><a href="#h17-0-159" id="h17-0-159" class="i">+                    .weight(1f)
</a><a href="#h17-0-160" id="h17-0-160" class="i">+                    .padding(10.dp),
</a><a href="#h17-0-161" id="h17-0-161" class="i">+            ) {
</a><a href="#h17-0-162" id="h17-0-162" class="i">+                Column(
</a><a href="#h17-0-163" id="h17-0-163" class="i">+                    modifier = Modifier
</a><a href="#h17-0-164" id="h17-0-164" class="i">+                        .fillMaxSize()
</a><a href="#h17-0-165" id="h17-0-165" class="i">+                        .verticalScroll(scrollState)
</a><a href="#h17-0-166" id="h17-0-166" class="i">+                ) {
</a><a href="#h17-0-167" id="h17-0-167" class="i">+                    Text(text = status, overflow = TextOverflow.Visible, modifier = Modifier.padding(10.dp))
</a><a href="#h17-0-168" id="h17-0-168" class="i">+                }
</a><a href="#h17-0-169" id="h17-0-169" class="i">+            }
</a><a href="#h17-0-170" id="h17-0-170" class="i">+            if (progress != -1f) {
</a><a href="#h17-0-171" id="h17-0-171" class="i">+                LinearProgressIndicator(progress = progress, modifier = Modifier.height(10.dp), strokeCap = StrokeCap.Round)
</a><a href="#h17-0-172" id="h17-0-172" class="i">+            }
</a><a href="#h17-0-173" id="h17-0-173" class="i">+
</a><a href="#h17-0-174" id="h17-0-174" class="i">+            if (patchedApk != null) {
</a><a href="#h17-0-175" id="h17-0-175" class="i">+                Button(modifier = Modifier.fillMaxWidth(), onClick = {
</a><a href="#h17-0-176" id="h17-0-176" class="i">+                    triggerInstallation(true)
</a><a href="#h17-0-177" id="h17-0-177" class="i">+                }) {
</a><a href="#h17-0-178" id="h17-0-178" class="i">+                    Text(text = &quot;Uninstall &amp; Install&quot;)
</a><a href="#h17-0-179" id="h17-0-179" class="i">+                }
</a><a href="#h17-0-180" id="h17-0-180" class="i">+
</a><a href="#h17-0-181" id="h17-0-181" class="i">+                Button(modifier = Modifier.fillMaxWidth(), onClick = {
</a><a href="#h17-0-182" id="h17-0-182" class="i">+                    showDowngradeNoticeDialog = true
</a><a href="#h17-0-183" id="h17-0-183" class="i">+                }) {
</a><a href="#h17-0-184" id="h17-0-184" class="i">+                    Text(text = &quot;Update&quot;)
</a><a href="#h17-0-185" id="h17-0-185" class="i">+                }
</a><a href="#h17-0-186" id="h17-0-186" class="i">+            }
</a><a href="#h17-0-187" id="h17-0-187" class="i">+
</a><a href="#h17-0-188" id="h17-0-188" class="i">+            LaunchedEffect(status) {
</a><a href="#h17-0-189" id="h17-0-189" class="i">+                scrollState.scrollTo(scrollState.maxValue)
</a><a href="#h17-0-190" id="h17-0-190" class="i">+            }
</a><a href="#h17-0-191" id="h17-0-191" class="i">+        }
</a><a href="#h17-0-192" id="h17-0-192" class="i">+
</a><a href="#h17-0-193" id="h17-0-193" class="i">+        if (showDowngradeNoticeDialog) {
</a><a href="#h17-0-194" id="h17-0-194" class="i">+            Dialog(onDismissRequest = { showDowngradeNoticeDialog = false }) {
</a><a href="#h17-0-195" id="h17-0-195" class="i">+                DowngradeNoticeDialog(onDismiss = { showDowngradeNoticeDialog = false }, onSuccess = {
</a><a href="#h17-0-196" id="h17-0-196" class="i">+                    triggerInstallation(false)
</a><a href="#h17-0-197" id="h17-0-197" class="i">+                })
</a><a href="#h17-0-198" id="h17-0-198" class="i">+            }
</a><a href="#h17-0-199" id="h17-0-199" class="i">+        }
</a><a href="#h17-0-200" id="h17-0-200" class="i">+    }
</a><a href="#h17-0-201" id="h17-0-201" class="i">+}</a><a href="#h17-0-202" id="h17-0-202" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SEDownloadTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SEDownloadTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SEDownloadTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SEDownloadTab.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -0,0 +1,245 @@
</a><a href="#h18-0-0" id="h18-0-0" class="i">+package me.rhunk.snapenhance.manager.ui.tab.impl.download
</a><a href="#h18-0-1" id="h18-0-1" class="i">+
</a><a href="#h18-0-2" id="h18-0-2" class="i">+import android.os.Bundle
</a><a href="#h18-0-3" id="h18-0-3" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h18-0-4" id="h18-0-4" class="i">+import androidx.compose.foundation.background
</a><a href="#h18-0-5" id="h18-0-5" class="i">+import androidx.compose.foundation.border
</a><a href="#h18-0-6" id="h18-0-6" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h18-0-7" id="h18-0-7" class="i">+import androidx.compose.foundation.layout.Arrangement
</a><a href="#h18-0-8" id="h18-0-8" class="i">+import androidx.compose.foundation.layout.Column
</a><a href="#h18-0-9" id="h18-0-9" class="i">+import androidx.compose.foundation.layout.Row
</a><a href="#h18-0-10" id="h18-0-10" class="i">+import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h18-0-11" id="h18-0-11" class="i">+import androidx.compose.foundation.layout.padding
</a><a href="#h18-0-12" id="h18-0-12" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h18-0-13" id="h18-0-13" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h18-0-14" id="h18-0-14" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h18-0-15" id="h18-0-15" class="i">+import androidx.compose.material.icons.filled.Android
</a><a href="#h18-0-16" id="h18-0-16" class="i">+import androidx.compose.material3.*
</a><a href="#h18-0-17" id="h18-0-17" class="i">+import androidx.compose.runtime.*
</a><a href="#h18-0-18" id="h18-0-18" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h18-0-19" id="h18-0-19" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h18-0-20" id="h18-0-20" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h18-0-21" id="h18-0-21" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h18-0-22" id="h18-0-22" class="i">+import androidx.compose.ui.window.Dialog
</a><a href="#h18-0-23" id="h18-0-23" class="i">+import com.google.gson.JsonParser
</a><a href="#h18-0-24" id="h18-0-24" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h18-0-25" id="h18-0-25" class="i">+import kotlinx.coroutines.launch
</a><a href="#h18-0-26" id="h18-0-26" class="i">+import me.rhunk.snapenhance.manager.data.download.SEArtifact
</a><a href="#h18-0-27" id="h18-0-27" class="i">+import me.rhunk.snapenhance.manager.data.download.SEVersion
</a><a href="#h18-0-28" id="h18-0-28" class="i">+import me.rhunk.snapenhance.manager.ui.components.DowngradeNoticeDialog
</a><a href="#h18-0-29" id="h18-0-29" class="i">+import me.rhunk.snapenhance.manager.ui.tab.Tab
</a><a href="#h18-0-30" id="h18-0-30" class="i">+import okhttp3.OkHttpClient
</a><a href="#h18-0-31" id="h18-0-31" class="i">+import okhttp3.Request
</a><a href="#h18-0-32" id="h18-0-32" class="i">+import java.text.SimpleDateFormat
</a><a href="#h18-0-33" id="h18-0-33" class="i">+import java.util.Locale
</a><a href="#h18-0-34" id="h18-0-34" class="i">+
</a><a href="#h18-0-35" id="h18-0-35" class="i">+
</a><a href="#h18-0-36" id="h18-0-36" class="i">+class SEDownloadTab : Tab(&quot;se_download&quot;) {
</a><a href="#h18-0-37" id="h18-0-37" class="i">+    private fun fetchSEReleases(): List&lt;SEVersion&gt;? {
</a><a href="#h18-0-38" id="h18-0-38" class="i">+        return runCatching {
</a><a href="#h18-0-39" id="h18-0-39" class="i">+            val endpoint = Request.Builder().url(&quot;https://api.github.com/repos/rhunk/SnapEnhance/releases&quot;).build()
</a><a href="#h18-0-40" id="h18-0-40" class="i">+            val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h18-0-41" id="h18-0-41" class="i">+            if (!response.isSuccessful) return null
</a><a href="#h18-0-42" id="h18-0-42" class="i">+
</a><a href="#h18-0-43" id="h18-0-43" class="i">+            val releases = JsonParser.parseString(response.body.string()).asJsonArray.also {
</a><a href="#h18-0-44" id="h18-0-44" class="i">+                if (it.size() == 0) return null
</a><a href="#h18-0-45" id="h18-0-45" class="i">+            }
</a><a href="#h18-0-46" id="h18-0-46" class="i">+            val isoDateFormat = SimpleDateFormat(&quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&#39;Z&#39;&quot;, Locale.getDefault())
</a><a href="#h18-0-47" id="h18-0-47" class="i">+
</a><a href="#h18-0-48" id="h18-0-48" class="i">+            releases.map { releaseObject -&gt;
</a><a href="#h18-0-49" id="h18-0-49" class="i">+                val release = releaseObject.asJsonObject
</a><a href="#h18-0-50" id="h18-0-50" class="i">+                val versionName = release.getAsJsonPrimitive(&quot;tag_name&quot;).asString
</a><a href="#h18-0-51" id="h18-0-51" class="i">+                val releaseDate = release.getAsJsonPrimitive(&quot;published_at&quot;).asString.let { time -&gt;
</a><a href="#h18-0-52" id="h18-0-52" class="i">+                    isoDateFormat.parse(time)?.let { date -&gt;
</a><a href="#h18-0-53" id="h18-0-53" class="i">+                        SimpleDateFormat(&quot;dd MMM yyyy&quot;, Locale.getDefault()).format(date)
</a><a href="#h18-0-54" id="h18-0-54" class="i">+                    } ?: time
</a><a href="#h18-0-55" id="h18-0-55" class="i">+                }
</a><a href="#h18-0-56" id="h18-0-56" class="i">+                val downloadAssets = release.getAsJsonArray(&quot;assets&quot;).associate { asset -&gt;
</a><a href="#h18-0-57" id="h18-0-57" class="i">+                    val assetObject = asset.asJsonObject
</a><a href="#h18-0-58" id="h18-0-58" class="i">+                    SEArtifact(
</a><a href="#h18-0-59" id="h18-0-59" class="i">+                        fileName = assetObject.getAsJsonPrimitive(&quot;name&quot;).asString,
</a><a href="#h18-0-60" id="h18-0-60" class="i">+                        size = assetObject.getAsJsonPrimitive(&quot;size&quot;).asLong,
</a><a href="#h18-0-61" id="h18-0-61" class="i">+                        downloadUrl = assetObject.getAsJsonPrimitive(&quot;browser_download_url&quot;).asString
</a><a href="#h18-0-62" id="h18-0-62" class="i">+                    ).let { it.fileName to it }
</a><a href="#h18-0-63" id="h18-0-63" class="i">+                }
</a><a href="#h18-0-64" id="h18-0-64" class="i">+                SEVersion(versionName, releaseDate, downloadAssets)
</a><a href="#h18-0-65" id="h18-0-65" class="i">+            }
</a><a href="#h18-0-66" id="h18-0-66" class="i">+        }.onFailure {
</a><a href="#h18-0-67" id="h18-0-67" class="i">+            it.printStackTrace()
</a><a href="#h18-0-68" id="h18-0-68" class="i">+        }.getOrNull()
</a><a href="#h18-0-69" id="h18-0-69" class="i">+    }
</a><a href="#h18-0-70" id="h18-0-70" class="i">+
</a><a href="#h18-0-71" id="h18-0-71" class="i">+    override fun init(activity: ComponentActivity) {
</a><a href="#h18-0-72" id="h18-0-72" class="i">+        super.init(activity)
</a><a href="#h18-0-73" id="h18-0-73" class="i">+    }
</a><a href="#h18-0-74" id="h18-0-74" class="i">+
</a><a href="#h18-0-75" id="h18-0-75" class="i">+    @Composable
</a><a href="#h18-0-76" id="h18-0-76" class="i">+    override fun Content() {
</a><a href="#h18-0-77" id="h18-0-77" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h18-0-78" id="h18-0-78" class="i">+        val snapEnhanceReleases = remember {
</a><a href="#h18-0-79" id="h18-0-79" class="i">+            mutableStateOf(null as List&lt;SEVersion&gt;?)
</a><a href="#h18-0-80" id="h18-0-80" class="i">+        }
</a><a href="#h18-0-81" id="h18-0-81" class="i">+
</a><a href="#h18-0-82" id="h18-0-82" class="i">+        var selectedVersion by remember { mutableStateOf(null as SEVersion?) }
</a><a href="#h18-0-83" id="h18-0-83" class="i">+        var selectedArtifact by remember { mutableStateOf(null as SEArtifact?) }
</a><a href="#h18-0-84" id="h18-0-84" class="i">+        val isAppInstalled = remember { runCatching { activity.packageManager.getPackageInfo(sharedConfig.snapEnhancePackageName, 0) != null }.getOrNull() != null }
</a><a href="#h18-0-85" id="h18-0-85" class="i">+
</a><a href="#h18-0-86" id="h18-0-86" class="i">+        var showDowngradeNotice by remember { mutableStateOf(false) }
</a><a href="#h18-0-87" id="h18-0-87" class="i">+
</a><a href="#h18-0-88" id="h18-0-88" class="i">+        fun triggerPackageInstallation(shouldUninstall: Boolean) {
</a><a href="#h18-0-89" id="h18-0-89" class="i">+            navigation.navigateTo(InstallPackageTab::class, Bundle().apply {
</a><a href="#h18-0-90" id="h18-0-90" class="i">+                putString(&quot;downloadPath&quot;, selectedArtifact?.downloadUrl)
</a><a href="#h18-0-91" id="h18-0-91" class="i">+                putString(&quot;appPackage&quot;, sharedConfig.snapEnhancePackageName)
</a><a href="#h18-0-92" id="h18-0-92" class="i">+                putBoolean(&quot;uninstall&quot;, shouldUninstall)
</a><a href="#h18-0-93" id="h18-0-93" class="i">+            }, noHistory = true)
</a><a href="#h18-0-94" id="h18-0-94" class="i">+        }
</a><a href="#h18-0-95" id="h18-0-95" class="i">+
</a><a href="#h18-0-96" id="h18-0-96" class="i">+        if (showDowngradeNotice) {
</a><a href="#h18-0-97" id="h18-0-97" class="i">+            Dialog(onDismissRequest = { showDowngradeNotice = false }) {
</a><a href="#h18-0-98" id="h18-0-98" class="i">+                DowngradeNoticeDialog(onDismiss = { showDowngradeNotice = false }, onSuccess = {
</a><a href="#h18-0-99" id="h18-0-99" class="i">+                    triggerPackageInstallation(false)
</a><a href="#h18-0-100" id="h18-0-100" class="i">+                })
</a><a href="#h18-0-101" id="h18-0-101" class="i">+            }
</a><a href="#h18-0-102" id="h18-0-102" class="i">+        }
</a><a href="#h18-0-103" id="h18-0-103" class="i">+
</a><a href="#h18-0-104" id="h18-0-104" class="i">+        Column(
</a><a href="#h18-0-105" id="h18-0-105" class="i">+            modifier = Modifier
</a><a href="#h18-0-106" id="h18-0-106" class="i">+                .fillMaxWidth()
</a><a href="#h18-0-107" id="h18-0-107" class="i">+                .padding(16.dp),
</a><a href="#h18-0-108" id="h18-0-108" class="i">+            verticalArrangement = Arrangement.spacedBy(16.dp),
</a><a href="#h18-0-109" id="h18-0-109" class="i">+            horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h18-0-110" id="h18-0-110" class="i">+        ) {
</a><a href="#h18-0-111" id="h18-0-111" class="i">+            Text(text = &quot;Choose SnapEnhance version&quot;)
</a><a href="#h18-0-112" id="h18-0-112" class="i">+
</a><a href="#h18-0-113" id="h18-0-113" class="i">+            LazyColumn(
</a><a href="#h18-0-114" id="h18-0-114" class="i">+                modifier = Modifier
</a><a href="#h18-0-115" id="h18-0-115" class="i">+                    .fillMaxWidth()
</a><a href="#h18-0-116" id="h18-0-116" class="i">+                    .weight(1f),
</a><a href="#h18-0-117" id="h18-0-117" class="i">+                verticalArrangement = Arrangement.spacedBy(10.dp)
</a><a href="#h18-0-118" id="h18-0-118" class="i">+            ) {
</a><a href="#h18-0-119" id="h18-0-119" class="i">+                item {
</a><a href="#h18-0-120" id="h18-0-120" class="i">+                    if (snapEnhanceReleases.value == null) {
</a><a href="#h18-0-121" id="h18-0-121" class="i">+                        Row(
</a><a href="#h18-0-122" id="h18-0-122" class="i">+                            horizontalArrangement = Arrangement.Center,
</a><a href="#h18-0-123" id="h18-0-123" class="i">+                            modifier = Modifier
</a><a href="#h18-0-124" id="h18-0-124" class="i">+                                .fillMaxWidth()
</a><a href="#h18-0-125" id="h18-0-125" class="i">+                                .padding(16.dp)
</a><a href="#h18-0-126" id="h18-0-126" class="i">+                        ) {
</a><a href="#h18-0-127" id="h18-0-127" class="i">+                            CircularProgressIndicator()
</a><a href="#h18-0-128" id="h18-0-128" class="i">+                        }
</a><a href="#h18-0-129" id="h18-0-129" class="i">+                    }
</a><a href="#h18-0-130" id="h18-0-130" class="i">+                }
</a><a href="#h18-0-131" id="h18-0-131" class="i">+                items(snapEnhanceReleases.value ?: listOf()) { version -&gt;
</a><a href="#h18-0-132" id="h18-0-132" class="i">+                    OutlinedCard(
</a><a href="#h18-0-133" id="h18-0-133" class="i">+                        shape = MaterialTheme.shapes.small,
</a><a href="#h18-0-134" id="h18-0-134" class="i">+                        modifier = Modifier
</a><a href="#h18-0-135" id="h18-0-135" class="i">+                            .clickable {
</a><a href="#h18-0-136" id="h18-0-136" class="i">+                                selectedArtifact =
</a><a href="#h18-0-137" id="h18-0-137" class="i">+                                    if (selectedVersion != version) null else selectedArtifact
</a><a href="#h18-0-138" id="h18-0-138" class="i">+                                selectedVersion = if (selectedVersion == version) null else version
</a><a href="#h18-0-139" id="h18-0-139" class="i">+                            },
</a><a href="#h18-0-140" id="h18-0-140" class="i">+                    ) {
</a><a href="#h18-0-141" id="h18-0-141" class="i">+                        Row(
</a><a href="#h18-0-142" id="h18-0-142" class="i">+                            modifier = Modifier
</a><a href="#h18-0-143" id="h18-0-143" class="i">+                                .fillMaxWidth()
</a><a href="#h18-0-144" id="h18-0-144" class="i">+                                .padding(16.dp),
</a><a href="#h18-0-145" id="h18-0-145" class="i">+                            verticalAlignment = Alignment.CenterVertically
</a><a href="#h18-0-146" id="h18-0-146" class="i">+                        ) {
</a><a href="#h18-0-147" id="h18-0-147" class="i">+                            Column {
</a><a href="#h18-0-148" id="h18-0-148" class="i">+                                Text(text = version.versionName, fontSize = 24.sp)
</a><a href="#h18-0-149" id="h18-0-149" class="i">+                                Text(text = &quot;Release ${version.releaseDate}&quot;, fontSize = 12.sp)
</a><a href="#h18-0-150" id="h18-0-150" class="i">+                            }
</a><a href="#h18-0-151" id="h18-0-151" class="i">+                            Row(
</a><a href="#h18-0-152" id="h18-0-152" class="i">+                                modifier = Modifier
</a><a href="#h18-0-153" id="h18-0-153" class="i">+                                    .weight(1f),
</a><a href="#h18-0-154" id="h18-0-154" class="i">+                                horizontalArrangement = Arrangement.End,
</a><a href="#h18-0-155" id="h18-0-155" class="i">+                                verticalAlignment = Alignment.CenterVertically
</a><a href="#h18-0-156" id="h18-0-156" class="i">+                            ) {
</a><a href="#h18-0-157" id="h18-0-157" class="i">+                                Text(text = &quot;${version.downloadAssets.size} assets&quot;, fontSize = 12.sp)
</a><a href="#h18-0-158" id="h18-0-158" class="i">+                            }
</a><a href="#h18-0-159" id="h18-0-159" class="i">+                        }
</a><a href="#h18-0-160" id="h18-0-160" class="i">+                    }
</a><a href="#h18-0-161" id="h18-0-161" class="i">+
</a><a href="#h18-0-162" id="h18-0-162" class="i">+                    selectedVersion?.takeIf { it == version }?.let { selVersion -&gt;
</a><a href="#h18-0-163" id="h18-0-163" class="i">+                        Column(
</a><a href="#h18-0-164" id="h18-0-164" class="i">+                            modifier = Modifier
</a><a href="#h18-0-165" id="h18-0-165" class="i">+                                .fillMaxWidth()
</a><a href="#h18-0-166" id="h18-0-166" class="i">+                                .padding(10.dp),
</a><a href="#h18-0-167" id="h18-0-167" class="i">+                            verticalArrangement = Arrangement.spacedBy(16.dp),
</a><a href="#h18-0-168" id="h18-0-168" class="i">+                        ) {
</a><a href="#h18-0-169" id="h18-0-169" class="i">+                            selVersion.downloadAssets.values.forEach { artifact -&gt;
</a><a href="#h18-0-170" id="h18-0-170" class="i">+                                Row(
</a><a href="#h18-0-171" id="h18-0-171" class="i">+                                    modifier = Modifier
</a><a href="#h18-0-172" id="h18-0-172" class="i">+                                        .fillMaxWidth()
</a><a href="#h18-0-173" id="h18-0-173" class="i">+                                        .border(
</a><a href="#h18-0-174" id="h18-0-174" class="i">+                                            shape = MaterialTheme.shapes.medium,
</a><a href="#h18-0-175" id="h18-0-175" class="i">+                                            width = 1.dp,
</a><a href="#h18-0-176" id="h18-0-176" class="i">+                                            color = MaterialTheme.colorScheme.onSurfaceVariant
</a><a href="#h18-0-177" id="h18-0-177" class="i">+                                        )
</a><a href="#h18-0-178" id="h18-0-178" class="i">+                                        .clickable {
</a><a href="#h18-0-179" id="h18-0-179" class="i">+                                            selectedArtifact =
</a><a href="#h18-0-180" id="h18-0-180" class="i">+                                                if (selectedArtifact == artifact) null else artifact
</a><a href="#h18-0-181" id="h18-0-181" class="i">+                                        }
</a><a href="#h18-0-182" id="h18-0-182" class="i">+                                        .background(
</a><a href="#h18-0-183" id="h18-0-183" class="i">+                                            if (selectedArtifact == artifact) MaterialTheme.colorScheme.surfaceVariant else MaterialTheme.colorScheme.surface,
</a><a href="#h18-0-184" id="h18-0-184" class="i">+                                            shape = MaterialTheme.shapes.medium
</a><a href="#h18-0-185" id="h18-0-185" class="i">+                                        )
</a><a href="#h18-0-186" id="h18-0-186" class="i">+                                        .padding(16.dp),
</a><a href="#h18-0-187" id="h18-0-187" class="i">+                                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h18-0-188" id="h18-0-188" class="i">+                                ) {
</a><a href="#h18-0-189" id="h18-0-189" class="i">+                                    Icon(imageVector = Icons.Default.Android, contentDescription = null, modifier = Modifier.padding(start = 2.dp, end = 2.dp))
</a><a href="#h18-0-190" id="h18-0-190" class="i">+                                    Column(
</a><a href="#h18-0-191" id="h18-0-191" class="i">+                                        modifier = Modifier
</a><a href="#h18-0-192" id="h18-0-192" class="i">+                                            .padding(start = 13.dp)
</a><a href="#h18-0-193" id="h18-0-193" class="i">+                                    ) {
</a><a href="#h18-0-194" id="h18-0-194" class="i">+                                        Text(text = artifact.fileName, fontSize = 15.sp)
</a><a href="#h18-0-195" id="h18-0-195" class="i">+                                        Text(
</a><a href="#h18-0-196" id="h18-0-196" class="i">+                                            text = &quot;${artifact.size / 1024 / 1024} MB&quot;,
</a><a href="#h18-0-197" id="h18-0-197" class="i">+                                            fontSize = 10.sp
</a><a href="#h18-0-198" id="h18-0-198" class="i">+                                        )
</a><a href="#h18-0-199" id="h18-0-199" class="i">+                                    }
</a><a href="#h18-0-200" id="h18-0-200" class="i">+                                }
</a><a href="#h18-0-201" id="h18-0-201" class="i">+                            }
</a><a href="#h18-0-202" id="h18-0-202" class="i">+                        }
</a><a href="#h18-0-203" id="h18-0-203" class="i">+                    }
</a><a href="#h18-0-204" id="h18-0-204" class="i">+                }
</a><a href="#h18-0-205" id="h18-0-205" class="i">+            }
</a><a href="#h18-0-206" id="h18-0-206" class="i">+            Column(
</a><a href="#h18-0-207" id="h18-0-207" class="i">+                modifier = Modifier
</a><a href="#h18-0-208" id="h18-0-208" class="i">+                    .fillMaxWidth(),
</a><a href="#h18-0-209" id="h18-0-209" class="i">+                horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h18-0-210" id="h18-0-210" class="i">+            ) {
</a><a href="#h18-0-211" id="h18-0-211" class="i">+                if (isAppInstalled) {
</a><a href="#h18-0-212" id="h18-0-212" class="i">+                    Button(
</a><a href="#h18-0-213" id="h18-0-213" class="i">+                        onClick = {
</a><a href="#h18-0-214" id="h18-0-214" class="i">+                            triggerPackageInstallation(true)
</a><a href="#h18-0-215" id="h18-0-215" class="i">+                        },
</a><a href="#h18-0-216" id="h18-0-216" class="i">+                        enabled = selectedVersion != null &amp;&amp; selectedArtifact != null,
</a><a href="#h18-0-217" id="h18-0-217" class="i">+                        modifier = Modifier.fillMaxWidth()
</a><a href="#h18-0-218" id="h18-0-218" class="i">+                    ) {
</a><a href="#h18-0-219" id="h18-0-219" class="i">+                        Text(text = &quot;Uninstall &amp; Install&quot;)
</a><a href="#h18-0-220" id="h18-0-220" class="i">+                    }
</a><a href="#h18-0-221" id="h18-0-221" class="i">+                }
</a><a href="#h18-0-222" id="h18-0-222" class="i">+                Button(
</a><a href="#h18-0-223" id="h18-0-223" class="i">+                    onClick = {
</a><a href="#h18-0-224" id="h18-0-224" class="i">+                        if (isAppInstalled) {
</a><a href="#h18-0-225" id="h18-0-225" class="i">+                            showDowngradeNotice = true
</a><a href="#h18-0-226" id="h18-0-226" class="i">+                        } else {
</a><a href="#h18-0-227" id="h18-0-227" class="i">+                            triggerPackageInstallation(false)
</a><a href="#h18-0-228" id="h18-0-228" class="i">+                        }
</a><a href="#h18-0-229" id="h18-0-229" class="i">+                    },
</a><a href="#h18-0-230" id="h18-0-230" class="i">+                    enabled = selectedVersion != null &amp;&amp; selectedArtifact != null,
</a><a href="#h18-0-231" id="h18-0-231" class="i">+                    modifier = Modifier.fillMaxWidth()
</a><a href="#h18-0-232" id="h18-0-232" class="i">+                ) {
</a><a href="#h18-0-233" id="h18-0-233" class="i">+                    Text(text = if (isAppInstalled) &quot;Update&quot; else &quot;Install&quot;)
</a><a href="#h18-0-234" id="h18-0-234" class="i">+                }
</a><a href="#h18-0-235" id="h18-0-235" class="i">+            }
</a><a href="#h18-0-236" id="h18-0-236" class="i">+        }
</a><a href="#h18-0-237" id="h18-0-237" class="i">+
</a><a href="#h18-0-238" id="h18-0-238" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h18-0-239" id="h18-0-239" class="i">+            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h18-0-240" id="h18-0-240" class="i">+                snapEnhanceReleases.value = fetchSEReleases()
</a><a href="#h18-0-241" id="h18-0-241" class="i">+            }
</a><a href="#h18-0-242" id="h18-0-242" class="i">+        }
</a><a href="#h18-0-243" id="h18-0-243" class="i">+    }
</a><a href="#h18-0-244" id="h18-0-244" class="i">+}</a><a href="#h18-0-245" id="h18-0-245" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h19" href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SnapchatPatchTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SnapchatPatchTab.kt</a> b/<a href="../file/manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SnapchatPatchTab.kt.html">manager/src/main/kotlin/me/rhunk/snapenhance/manager/ui/tab/impl/download/SnapchatPatchTab.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,328 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+package me.rhunk.snapenhance.manager.ui.tab.impl.download
</a><a href="#h19-0-1" id="h19-0-1" class="i">+
</a><a href="#h19-0-2" id="h19-0-2" class="i">+import android.os.Bundle
</a><a href="#h19-0-3" id="h19-0-3" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h19-0-4" id="h19-0-4" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h19-0-5" id="h19-0-5" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h19-0-6" id="h19-0-6" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h19-0-7" id="h19-0-7" class="i">+import androidx.compose.foundation.rememberScrollState
</a><a href="#h19-0-8" id="h19-0-8" class="i">+import androidx.compose.foundation.verticalScroll
</a><a href="#h19-0-9" id="h19-0-9" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h19-0-10" id="h19-0-10" class="i">+import androidx.compose.material.icons.filled.Check
</a><a href="#h19-0-11" id="h19-0-11" class="i">+import androidx.compose.material.icons.filled.DeleteForever
</a><a href="#h19-0-12" id="h19-0-12" class="i">+import androidx.compose.material3.*
</a><a href="#h19-0-13" id="h19-0-13" class="i">+import androidx.compose.runtime.*
</a><a href="#h19-0-14" id="h19-0-14" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h19-0-15" id="h19-0-15" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h19-0-16" id="h19-0-16" class="i">+import androidx.compose.ui.draw.alpha
</a><a href="#h19-0-17" id="h19-0-17" class="i">+import androidx.compose.ui.res.painterResource
</a><a href="#h19-0-18" id="h19-0-18" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h19-0-19" id="h19-0-19" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h19-0-20" id="h19-0-20" class="i">+import kotlinx.coroutines.launch
</a><a href="#h19-0-21" id="h19-0-21" class="i">+import kotlinx.coroutines.withContext
</a><a href="#h19-0-22" id="h19-0-22" class="i">+import me.rhunk.snapenhance.manager.R
</a><a href="#h19-0-23" id="h19-0-23" class="i">+import me.rhunk.snapenhance.manager.data.APKMirror
</a><a href="#h19-0-24" id="h19-0-24" class="i">+import me.rhunk.snapenhance.manager.data.DownloadItem
</a><a href="#h19-0-25" id="h19-0-25" class="i">+import me.rhunk.snapenhance.manager.lspatch.config.Constants
</a><a href="#h19-0-26" id="h19-0-26" class="i">+import me.rhunk.snapenhance.manager.ui.components.ConfirmationDialog
</a><a href="#h19-0-27" id="h19-0-27" class="i">+import me.rhunk.snapenhance.manager.ui.tab.Tab
</a><a href="#h19-0-28" id="h19-0-28" class="i">+import java.io.File
</a><a href="#h19-0-29" id="h19-0-29" class="i">+import java.util.zip.ZipFile
</a><a href="#h19-0-30" id="h19-0-30" class="i">+
</a><a href="#h19-0-31" id="h19-0-31" class="i">+@OptIn(ExperimentalMaterial3Api::class)
</a><a href="#h19-0-32" id="h19-0-32" class="i">+class SnapchatPatchTab : Tab(&quot;snapchat_download&quot;) {
</a><a href="#h19-0-33" id="h19-0-33" class="i">+    private val apkMirror =  APKMirror()
</a><a href="#h19-0-34" id="h19-0-34" class="i">+    private val cachedDownloadItems = mutableListOf&lt;DownloadItem&gt;()
</a><a href="#h19-0-35" id="h19-0-35" class="i">+    private var currentPage by mutableIntStateOf(1)
</a><a href="#h19-0-36" id="h19-0-36" class="i">+
</a><a href="#h19-0-37" id="h19-0-37" class="i">+    override fun init(activity: ComponentActivity) {
</a><a href="#h19-0-38" id="h19-0-38" class="i">+        super.init(activity)
</a><a href="#h19-0-39" id="h19-0-39" class="i">+        registerNestedTab(LSPatchTab::class)
</a><a href="#h19-0-40" id="h19-0-40" class="i">+    }
</a><a href="#h19-0-41" id="h19-0-41" class="i">+
</a><a href="#h19-0-42" id="h19-0-42" class="i">+    @Composable
</a><a href="#h19-0-43" id="h19-0-43" class="i">+    override fun TopBar() {
</a><a href="#h19-0-44" id="h19-0-44" class="i">+        var deleteAllDialog by remember { mutableStateOf(false) }
</a><a href="#h19-0-45" id="h19-0-45" class="i">+        IconButton(onClick = { deleteAllDialog = true }) {
</a><a href="#h19-0-46" id="h19-0-46" class="i">+            Icon(imageVector = Icons.Default.DeleteForever, contentDescription = null)
</a><a href="#h19-0-47" id="h19-0-47" class="i">+        }
</a><a href="#h19-0-48" id="h19-0-48" class="i">+
</a><a href="#h19-0-49" id="h19-0-49" class="i">+        if (deleteAllDialog) {
</a><a href="#h19-0-50" id="h19-0-50" class="i">+            AlertDialog(onDismissRequest = { deleteAllDialog = false }) {
</a><a href="#h19-0-51" id="h19-0-51" class="i">+                ConfirmationDialog(title = &quot;Are you sure you want to delete all downloads?&quot;, onDismiss = { deleteAllDialog = false }) {
</a><a href="#h19-0-52" id="h19-0-52" class="i">+                    deleteAllDialog = false
</a><a href="#h19-0-53" id="h19-0-53" class="i">+                    runCatching {
</a><a href="#h19-0-54" id="h19-0-54" class="i">+                        sharedConfig.apkCache.listFiles()?.forEach { it.deleteRecursively() }
</a><a href="#h19-0-55" id="h19-0-55" class="i">+                    }.onFailure {
</a><a href="#h19-0-56" id="h19-0-56" class="i">+                        toast(&quot;Failed to delete downloads&quot;)
</a><a href="#h19-0-57" id="h19-0-57" class="i">+                        it.printStackTrace()
</a><a href="#h19-0-58" id="h19-0-58" class="i">+                    }
</a><a href="#h19-0-59" id="h19-0-59" class="i">+                    toast(&quot;Done!&quot;)
</a><a href="#h19-0-60" id="h19-0-60" class="i">+                }
</a><a href="#h19-0-61" id="h19-0-61" class="i">+            }
</a><a href="#h19-0-62" id="h19-0-62" class="i">+        }
</a><a href="#h19-0-63" id="h19-0-63" class="i">+    }
</a><a href="#h19-0-64" id="h19-0-64" class="i">+
</a><a href="#h19-0-65" id="h19-0-65" class="i">+    @Composable
</a><a href="#h19-0-66" id="h19-0-66" class="i">+    private fun DownloadItemRow(item: DownloadItem, onSelected: () -&gt; Unit = {}) {
</a><a href="#h19-0-67" id="h19-0-67" class="i">+        ElevatedCard(
</a><a href="#h19-0-68" id="h19-0-68" class="i">+            modifier = Modifier.padding(10.dp),
</a><a href="#h19-0-69" id="h19-0-69" class="i">+        ) {
</a><a href="#h19-0-70" id="h19-0-70" class="i">+            Row(
</a><a href="#h19-0-71" id="h19-0-71" class="i">+                modifier = Modifier
</a><a href="#h19-0-72" id="h19-0-72" class="i">+                    .fillMaxWidth()
</a><a href="#h19-0-73" id="h19-0-73" class="i">+                    .padding(5.dp),
</a><a href="#h19-0-74" id="h19-0-74" class="i">+                horizontalArrangement = Arrangement.spacedBy(10.dp),
</a><a href="#h19-0-75" id="h19-0-75" class="i">+                verticalAlignment = Alignment.CenterVertically
</a><a href="#h19-0-76" id="h19-0-76" class="i">+            ) {
</a><a href="#h19-0-77" id="h19-0-77" class="i">+                Column(
</a><a href="#h19-0-78" id="h19-0-78" class="i">+                    modifier = Modifier.padding(10.dp),
</a><a href="#h19-0-79" id="h19-0-79" class="i">+                ) {
</a><a href="#h19-0-80" id="h19-0-80" class="i">+                    Icon(painter = painterResource(R.drawable.sclogo), contentDescription = null, tint = MaterialTheme.colorScheme.onSurface, modifier = Modifier.size(40.dp))
</a><a href="#h19-0-81" id="h19-0-81" class="i">+                }
</a><a href="#h19-0-82" id="h19-0-82" class="i">+                Column(
</a><a href="#h19-0-83" id="h19-0-83" class="i">+                    modifier = Modifier.weight(1f),
</a><a href="#h19-0-84" id="h19-0-84" class="i">+                    verticalArrangement = Arrangement.spacedBy(5.dp)
</a><a href="#h19-0-85" id="h19-0-85" class="i">+                ) {
</a><a href="#h19-0-86" id="h19-0-86" class="i">+                    Text(item.shortTitle)
</a><a href="#h19-0-87" id="h19-0-87" class="i">+                    if (!item.isBeta) {
</a><a href="#h19-0-88" id="h19-0-88" class="i">+                        Text(&quot;Recommended&quot;, color = MaterialTheme.colorScheme.tertiary)
</a><a href="#h19-0-89" id="h19-0-89" class="i">+                    }
</a><a href="#h19-0-90" id="h19-0-90" class="i">+                }
</a><a href="#h19-0-91" id="h19-0-91" class="i">+                Row(
</a><a href="#h19-0-92" id="h19-0-92" class="i">+                    modifier = Modifier.padding(5.dp),
</a><a href="#h19-0-93" id="h19-0-93" class="i">+                    horizontalArrangement = Arrangement.spacedBy(5.dp),
</a><a href="#h19-0-94" id="h19-0-94" class="i">+                ) {
</a><a href="#h19-0-95" id="h19-0-95" class="i">+                    FilledIconButton(onClick = { onSelected() }) {
</a><a href="#h19-0-96" id="h19-0-96" class="i">+                        Icon(imageVector = Icons.Default.Check, contentDescription = null)
</a><a href="#h19-0-97" id="h19-0-97" class="i">+                    }
</a><a href="#h19-0-98" id="h19-0-98" class="i">+                }
</a><a href="#h19-0-99" id="h19-0-99" class="i">+            }
</a><a href="#h19-0-100" id="h19-0-100" class="i">+        }
</a><a href="#h19-0-101" id="h19-0-101" class="i">+    }
</a><a href="#h19-0-102" id="h19-0-102" class="i">+
</a><a href="#h19-0-103" id="h19-0-103" class="i">+
</a><a href="#h19-0-104" id="h19-0-104" class="i">+    @Composable
</a><a href="#h19-0-105" id="h19-0-105" class="i">+    private fun SelectSnapchatVersionDialog(onSelected: (DownloadItem) -&gt; Unit = {}) {
</a><a href="#h19-0-106" id="h19-0-106" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h19-0-107" id="h19-0-107" class="i">+        var isFetching by remember { mutableStateOf(false) }
</a><a href="#h19-0-108" id="h19-0-108" class="i">+        val downloadItems = remember { cachedDownloadItems.toMutableStateList() }
</a><a href="#h19-0-109" id="h19-0-109" class="i">+
</a><a href="#h19-0-110" id="h19-0-110" class="i">+        LazyColumn {
</a><a href="#h19-0-111" id="h19-0-111" class="i">+            items(downloadItems, key = { it.hash }) { item -&gt;
</a><a href="#h19-0-112" id="h19-0-112" class="i">+                DownloadItemRow(item) {
</a><a href="#h19-0-113" id="h19-0-113" class="i">+                    onSelected(item)
</a><a href="#h19-0-114" id="h19-0-114" class="i">+                }
</a><a href="#h19-0-115" id="h19-0-115" class="i">+            }
</a><a href="#h19-0-116" id="h19-0-116" class="i">+            item {
</a><a href="#h19-0-117" id="h19-0-117" class="i">+                Box(
</a><a href="#h19-0-118" id="h19-0-118" class="i">+                    modifier = Modifier
</a><a href="#h19-0-119" id="h19-0-119" class="i">+                        .fillMaxWidth()
</a><a href="#h19-0-120" id="h19-0-120" class="i">+                        .padding(20.dp),
</a><a href="#h19-0-121" id="h19-0-121" class="i">+                    contentAlignment = Alignment.Center
</a><a href="#h19-0-122" id="h19-0-122" class="i">+                ) {
</a><a href="#h19-0-123" id="h19-0-123" class="i">+                    CircularProgressIndicator(modifier = Modifier.alpha(if (isFetching) 1f else 0f))
</a><a href="#h19-0-124" id="h19-0-124" class="i">+                }
</a><a href="#h19-0-125" id="h19-0-125" class="i">+                SideEffect {
</a><a href="#h19-0-126" id="h19-0-126" class="i">+                    if (isFetching) return@SideEffect
</a><a href="#h19-0-127" id="h19-0-127" class="i">+                    isFetching = true
</a><a href="#h19-0-128" id="h19-0-128" class="i">+                    coroutineScope.launch {
</a><a href="#h19-0-129" id="h19-0-129" class="i">+                        runCatching {
</a><a href="#h19-0-130" id="h19-0-130" class="i">+                            withContext(Dispatchers.IO) {
</a><a href="#h19-0-131" id="h19-0-131" class="i">+                                apkMirror.fetchSnapchatVersions(currentPage)?.let {
</a><a href="#h19-0-132" id="h19-0-132" class="i">+                                    withContext(Dispatchers.Main) {
</a><a href="#h19-0-133" id="h19-0-133" class="i">+                                        cachedDownloadItems.addAll(it)
</a><a href="#h19-0-134" id="h19-0-134" class="i">+                                        downloadItems.addAll(it)
</a><a href="#h19-0-135" id="h19-0-135" class="i">+                                    }
</a><a href="#h19-0-136" id="h19-0-136" class="i">+                                }
</a><a href="#h19-0-137" id="h19-0-137" class="i">+                            }
</a><a href="#h19-0-138" id="h19-0-138" class="i">+                        }.onFailure {
</a><a href="#h19-0-139" id="h19-0-139" class="i">+                            it.printStackTrace()
</a><a href="#h19-0-140" id="h19-0-140" class="i">+                        }
</a><a href="#h19-0-141" id="h19-0-141" class="i">+                        ++currentPage
</a><a href="#h19-0-142" id="h19-0-142" class="i">+                        isFetching = false
</a><a href="#h19-0-143" id="h19-0-143" class="i">+                    }
</a><a href="#h19-0-144" id="h19-0-144" class="i">+                }
</a><a href="#h19-0-145" id="h19-0-145" class="i">+            }
</a><a href="#h19-0-146" id="h19-0-146" class="i">+        }
</a><a href="#h19-0-147" id="h19-0-147" class="i">+    }
</a><a href="#h19-0-148" id="h19-0-148" class="i">+
</a><a href="#h19-0-149" id="h19-0-149" class="i">+    @Composable
</a><a href="#h19-0-150" id="h19-0-150" class="i">+    override fun Content() {
</a><a href="#h19-0-151" id="h19-0-151" class="i">+        var showSelectSnapchatVersionDialog by remember { mutableStateOf(false) }
</a><a href="#h19-0-152" id="h19-0-152" class="i">+        var showRestoreMenuDialog by remember { mutableStateOf(false) }
</a><a href="#h19-0-153" id="h19-0-153" class="i">+
</a><a href="#h19-0-154" id="h19-0-154" class="i">+        var selectedSnapchatVersion by remember { mutableStateOf(null as DownloadItem?) }
</a><a href="#h19-0-155" id="h19-0-155" class="i">+        val installedSnapEnhanceVersion = remember { runCatching { activity.packageManager.getPackageInfo(
</a><a href="#h19-0-156" id="h19-0-156" class="i">+            sharedConfig.snapEnhancePackageName, 0) }.getOrNull() }
</a><a href="#h19-0-157" id="h19-0-157" class="i">+
</a><a href="#h19-0-158" id="h19-0-158" class="i">+        val installedSnapchatPackage = remember { runCatching { activity.packageManager.getPackageInfo(
</a><a href="#h19-0-159" id="h19-0-159" class="i">+            sharedConfig.snapchatPackageName, 0) }.getOrNull() }
</a><a href="#h19-0-160" id="h19-0-160" class="i">+        val isInstalledSnapchatPatched = remember { installedSnapchatPackage?.applicationInfo?.appComponentFactory == Constants.PROXY_APP_COMPONENT_FACTORY }
</a><a href="#h19-0-161" id="h19-0-161" class="i">+        val isSnapchatNotSplitConfig = remember {
</a><a href="#h19-0-162" id="h19-0-162" class="i">+            installedSnapchatPackage?.applicationInfo?.let { it.splitSourceDirs == null || it.splitSourceDirs?.isEmpty() == true } ?: false
</a><a href="#h19-0-163" id="h19-0-163" class="i">+        }
</a><a href="#h19-0-164" id="h19-0-164" class="i">+
</a><a href="#h19-0-165" id="h19-0-165" class="i">+        if (showRestoreMenuDialog) {
</a><a href="#h19-0-166" id="h19-0-166" class="i">+            fun triggerSnapchatInstallation(shouldUninstall: Boolean) {
</a><a href="#h19-0-167" id="h19-0-167" class="i">+                val apkFile = File(installedSnapchatPackage?.applicationInfo?.sourceDir ?: return).also {
</a><a href="#h19-0-168" id="h19-0-168" class="i">+                    if (!it.exists()) return
</a><a href="#h19-0-169" id="h19-0-169" class="i">+                }
</a><a href="#h19-0-170" id="h19-0-170" class="i">+                toast(&quot;Extracting origin apk&quot;)
</a><a href="#h19-0-171" id="h19-0-171" class="i">+                val originApk = File.createTempFile(&quot;origin&quot;, &quot;.apk&quot;, activity.externalCacheDirs.first()).also {
</a><a href="#h19-0-172" id="h19-0-172" class="i">+                    it.deleteOnExit()
</a><a href="#h19-0-173" id="h19-0-173" class="i">+                }
</a><a href="#h19-0-174" id="h19-0-174" class="i">+                ZipFile(apkFile).let { zipFile -&gt;
</a><a href="#h19-0-175" id="h19-0-175" class="i">+                    zipFile.getEntry(&quot;assets/lspatch/origin.apk&quot;)?.apply {
</a><a href="#h19-0-176" id="h19-0-176" class="i">+                        originApk.outputStream().use { output -&gt;
</a><a href="#h19-0-177" id="h19-0-177" class="i">+                            zipFile.getInputStream(this).copyTo(output)
</a><a href="#h19-0-178" id="h19-0-178" class="i">+                        }
</a><a href="#h19-0-179" id="h19-0-179" class="i">+                    } ?: run {
</a><a href="#h19-0-180" id="h19-0-180" class="i">+                        toast(&quot;Failed to extract origin apk&quot;)
</a><a href="#h19-0-181" id="h19-0-181" class="i">+                        return
</a><a href="#h19-0-182" id="h19-0-182" class="i">+                    }
</a><a href="#h19-0-183" id="h19-0-183" class="i">+                }
</a><a href="#h19-0-184" id="h19-0-184" class="i">+
</a><a href="#h19-0-185" id="h19-0-185" class="i">+                showRestoreMenuDialog = false
</a><a href="#h19-0-186" id="h19-0-186" class="i">+
</a><a href="#h19-0-187" id="h19-0-187" class="i">+                navigation.navigateTo(InstallPackageTab::class, args = Bundle().apply {
</a><a href="#h19-0-188" id="h19-0-188" class="i">+                    putString(&quot;downloadPath&quot;, originApk.absolutePath)
</a><a href="#h19-0-189" id="h19-0-189" class="i">+                    putString(&quot;appPackage&quot;, sharedConfig.snapchatPackageName)
</a><a href="#h19-0-190" id="h19-0-190" class="i">+                    putBoolean(&quot;uninstall&quot;, shouldUninstall)
</a><a href="#h19-0-191" id="h19-0-191" class="i">+                }, noHistory = true)
</a><a href="#h19-0-192" id="h19-0-192" class="i">+            }
</a><a href="#h19-0-193" id="h19-0-193" class="i">+
</a><a href="#h19-0-194" id="h19-0-194" class="i">+            AlertDialog(onDismissRequest = { showRestoreMenuDialog = false }) {
</a><a href="#h19-0-195" id="h19-0-195" class="i">+                Card {
</a><a href="#h19-0-196" id="h19-0-196" class="i">+                    Column(
</a><a href="#h19-0-197" id="h19-0-197" class="i">+                        modifier = Modifier.padding(16.dp).fillMaxWidth(),
</a><a href="#h19-0-198" id="h19-0-198" class="i">+                        horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h19-0-199" id="h19-0-199" class="i">+                        verticalArrangement = Arrangement.spacedBy(10.dp)
</a><a href="#h19-0-200" id="h19-0-200" class="i">+                    ) {
</a><a href="#h19-0-201" id="h19-0-201" class="i">+                        Button(onClick = {
</a><a href="#h19-0-202" id="h19-0-202" class="i">+                            triggerSnapchatInstallation(true)
</a><a href="#h19-0-203" id="h19-0-203" class="i">+                        }) {
</a><a href="#h19-0-204" id="h19-0-204" class="i">+                            Text(&quot;Uninstall &amp; Install&quot;)
</a><a href="#h19-0-205" id="h19-0-205" class="i">+                        }
</a><a href="#h19-0-206" id="h19-0-206" class="i">+                        Button(onClick = {
</a><a href="#h19-0-207" id="h19-0-207" class="i">+                            triggerSnapchatInstallation(false)
</a><a href="#h19-0-208" id="h19-0-208" class="i">+                        }) {
</a><a href="#h19-0-209" id="h19-0-209" class="i">+                            Text(&quot;Update&quot;)
</a><a href="#h19-0-210" id="h19-0-210" class="i">+                        }
</a><a href="#h19-0-211" id="h19-0-211" class="i">+                    }
</a><a href="#h19-0-212" id="h19-0-212" class="i">+                }
</a><a href="#h19-0-213" id="h19-0-213" class="i">+            }
</a><a href="#h19-0-214" id="h19-0-214" class="i">+        }
</a><a href="#h19-0-215" id="h19-0-215" class="i">+
</a><a href="#h19-0-216" id="h19-0-216" class="i">+
</a><a href="#h19-0-217" id="h19-0-217" class="i">+        if (showSelectSnapchatVersionDialog) {
</a><a href="#h19-0-218" id="h19-0-218" class="i">+            AlertDialog(onDismissRequest = { showSelectSnapchatVersionDialog = false }) {
</a><a href="#h19-0-219" id="h19-0-219" class="i">+                SelectSnapchatVersionDialog {
</a><a href="#h19-0-220" id="h19-0-220" class="i">+                    selectedSnapchatVersion = it
</a><a href="#h19-0-221" id="h19-0-221" class="i">+                    showSelectSnapchatVersionDialog = false
</a><a href="#h19-0-222" id="h19-0-222" class="i">+                }
</a><a href="#h19-0-223" id="h19-0-223" class="i">+            }
</a><a href="#h19-0-224" id="h19-0-224" class="i">+        }
</a><a href="#h19-0-225" id="h19-0-225" class="i">+
</a><a href="#h19-0-226" id="h19-0-226" class="i">+        Column(
</a><a href="#h19-0-227" id="h19-0-227" class="i">+            modifier = Modifier.fillMaxSize().verticalScroll(rememberScrollState()),
</a><a href="#h19-0-228" id="h19-0-228" class="i">+            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h19-0-229" id="h19-0-229" class="i">+            verticalArrangement = Arrangement.spacedBy(5.dp)
</a><a href="#h19-0-230" id="h19-0-230" class="i">+        ) {
</a><a href="#h19-0-231" id="h19-0-231" class="i">+            Text(&quot;Patch Snapchat&quot;)
</a><a href="#h19-0-232" id="h19-0-232" class="i">+
</a><a href="#h19-0-233" id="h19-0-233" class="i">+            ElevatedCard(
</a><a href="#h19-0-234" id="h19-0-234" class="i">+                modifier = Modifier.padding(10.dp),
</a><a href="#h19-0-235" id="h19-0-235" class="i">+            ) {
</a><a href="#h19-0-236" id="h19-0-236" class="i">+                Row(
</a><a href="#h19-0-237" id="h19-0-237" class="i">+                    modifier = Modifier
</a><a href="#h19-0-238" id="h19-0-238" class="i">+                        .fillMaxWidth()
</a><a href="#h19-0-239" id="h19-0-239" class="i">+                        .padding(10.dp),
</a><a href="#h19-0-240" id="h19-0-240" class="i">+                    horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h19-0-241" id="h19-0-241" class="i">+                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h19-0-242" id="h19-0-242" class="i">+                ) {
</a><a href="#h19-0-243" id="h19-0-243" class="i">+                    Icon(painter = painterResource(R.drawable.sclogo), contentDescription = null, tint = MaterialTheme.colorScheme.onSurface, modifier = Modifier.size(40.dp))
</a><a href="#h19-0-244" id="h19-0-244" class="i">+                    if (selectedSnapchatVersion == null) {
</a><a href="#h19-0-245" id="h19-0-245" class="i">+                        Text(text = &quot;Snapchat&quot;)
</a><a href="#h19-0-246" id="h19-0-246" class="i">+                    }
</a><a href="#h19-0-247" id="h19-0-247" class="i">+                    Text(text = selectedSnapchatVersion?.shortTitle ?: &quot;Not Selected&quot;)
</a><a href="#h19-0-248" id="h19-0-248" class="i">+                    Button(onClick = { showSelectSnapchatVersionDialog = true }) {
</a><a href="#h19-0-249" id="h19-0-249" class="i">+                        Text(&quot;Choose&quot;)
</a><a href="#h19-0-250" id="h19-0-250" class="i">+                    }
</a><a href="#h19-0-251" id="h19-0-251" class="i">+                }
</a><a href="#h19-0-252" id="h19-0-252" class="i">+            }
</a><a href="#h19-0-253" id="h19-0-253" class="i">+
</a><a href="#h19-0-254" id="h19-0-254" class="i">+            ElevatedCard(
</a><a href="#h19-0-255" id="h19-0-255" class="i">+                modifier = Modifier.padding(10.dp),
</a><a href="#h19-0-256" id="h19-0-256" class="i">+            ) {
</a><a href="#h19-0-257" id="h19-0-257" class="i">+                Row(
</a><a href="#h19-0-258" id="h19-0-258" class="i">+                    modifier = Modifier
</a><a href="#h19-0-259" id="h19-0-259" class="i">+                        .fillMaxWidth()
</a><a href="#h19-0-260" id="h19-0-260" class="i">+                        .padding(20.dp),
</a><a href="#h19-0-261" id="h19-0-261" class="i">+                    horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h19-0-262" id="h19-0-262" class="i">+                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h19-0-263" id="h19-0-263" class="i">+                ) {
</a><a href="#h19-0-264" id="h19-0-264" class="i">+                    Text(text = &quot;SnapEnhance&quot;)
</a><a href="#h19-0-265" id="h19-0-265" class="i">+                    Text(text = installedSnapEnhanceVersion?.versionName ?: &quot;Not installed&quot;)
</a><a href="#h19-0-266" id="h19-0-266" class="i">+                }
</a><a href="#h19-0-267" id="h19-0-267" class="i">+            }
</a><a href="#h19-0-268" id="h19-0-268" class="i">+
</a><a href="#h19-0-269" id="h19-0-269" class="i">+            Column(
</a><a href="#h19-0-270" id="h19-0-270" class="i">+                modifier = Modifier.padding(top = 10.dp, bottom = 10.dp, start = 20.dp, end = 20.dp),
</a><a href="#h19-0-271" id="h19-0-271" class="i">+                horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h19-0-272" id="h19-0-272" class="i">+                verticalArrangement = Arrangement.spacedBy(5.dp)
</a><a href="#h19-0-273" id="h19-0-273" class="i">+            ) {
</a><a href="#h19-0-274" id="h19-0-274" class="i">+                Button(
</a><a href="#h19-0-275" id="h19-0-275" class="i">+                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h19-0-276" id="h19-0-276" class="i">+                    enabled = selectedSnapchatVersion != null &amp;&amp; installedSnapEnhanceVersion != null,
</a><a href="#h19-0-277" id="h19-0-277" class="i">+                    onClick = {
</a><a href="#h19-0-278" id="h19-0-278" class="i">+                        navigation.navigateTo(LSPatchTab::class, args = Bundle().apply {
</a><a href="#h19-0-279" id="h19-0-279" class="i">+                            putParcelable(&quot;downloadItem&quot;, selectedSnapchatVersion)
</a><a href="#h19-0-280" id="h19-0-280" class="i">+                            putString(&quot;modulePath&quot;, installedSnapEnhanceVersion?.applicationInfo?.sourceDir)
</a><a href="#h19-0-281" id="h19-0-281" class="i">+                        }, noHistory = true)
</a><a href="#h19-0-282" id="h19-0-282" class="i">+                    }
</a><a href="#h19-0-283" id="h19-0-283" class="i">+                ) {
</a><a href="#h19-0-284" id="h19-0-284" class="i">+                    Text(&quot;Download &amp; Patch&quot;)
</a><a href="#h19-0-285" id="h19-0-285" class="i">+                }
</a><a href="#h19-0-286" id="h19-0-286" class="i">+
</a><a href="#h19-0-287" id="h19-0-287" class="i">+                if (isSnapchatNotSplitConfig) {
</a><a href="#h19-0-288" id="h19-0-288" class="i">+                    Button(
</a><a href="#h19-0-289" id="h19-0-289" class="i">+                        modifier = Modifier.fillMaxWidth(),
</a><a href="#h19-0-290" id="h19-0-290" class="i">+                        onClick = {
</a><a href="#h19-0-291" id="h19-0-291" class="i">+                            navigation.navigateTo(LSPatchTab::class, args = Bundle().apply {
</a><a href="#h19-0-292" id="h19-0-292" class="i">+                                putString(&quot;localItemFile&quot;, installedSnapchatPackage?.applicationInfo?.sourceDir ?: return@apply)
</a><a href="#h19-0-293" id="h19-0-293" class="i">+                                putString(&quot;modulePath&quot;, installedSnapEnhanceVersion?.applicationInfo?.sourceDir ?: return@apply)
</a><a href="#h19-0-294" id="h19-0-294" class="i">+                            }, noHistory = true)
</a><a href="#h19-0-295" id="h19-0-295" class="i">+                        }
</a><a href="#h19-0-296" id="h19-0-296" class="i">+                    ) {
</a><a href="#h19-0-297" id="h19-0-297" class="i">+                        Text(&quot;Patch from existing installation&quot;)
</a><a href="#h19-0-298" id="h19-0-298" class="i">+                    }
</a><a href="#h19-0-299" id="h19-0-299" class="i">+                }
</a><a href="#h19-0-300" id="h19-0-300" class="i">+
</a><a href="#h19-0-301" id="h19-0-301" class="i">+                if (isInstalledSnapchatPatched) {
</a><a href="#h19-0-302" id="h19-0-302" class="i">+                    Text(&quot;Restore Snapchat&quot;, modifier = Modifier.padding(20.dp))
</a><a href="#h19-0-303" id="h19-0-303" class="i">+                    Button(
</a><a href="#h19-0-304" id="h19-0-304" class="i">+                        modifier = Modifier.fillMaxWidth(),
</a><a href="#h19-0-305" id="h19-0-305" class="i">+                        enabled = selectedSnapchatVersion != null,
</a><a href="#h19-0-306" id="h19-0-306" class="i">+                        onClick = {
</a><a href="#h19-0-307" id="h19-0-307" class="i">+                            navigation.navigateTo(LSPatchTab::class, args = Bundle().apply {
</a><a href="#h19-0-308" id="h19-0-308" class="i">+                                putParcelable(&quot;downloadItem&quot;, selectedSnapchatVersion)
</a><a href="#h19-0-309" id="h19-0-309" class="i">+                            }, noHistory = true)
</a><a href="#h19-0-310" id="h19-0-310" class="i">+                        }
</a><a href="#h19-0-311" id="h19-0-311" class="i">+                    ) {
</a><a href="#h19-0-312" id="h19-0-312" class="i">+                        Text(&quot;Install/Restore Original Snapchat&quot;)
</a><a href="#h19-0-313" id="h19-0-313" class="i">+                    }
</a><a href="#h19-0-314" id="h19-0-314" class="i">+
</a><a href="#h19-0-315" id="h19-0-315" class="i">+                    if (isSnapchatNotSplitConfig) {
</a><a href="#h19-0-316" id="h19-0-316" class="i">+                        Button(
</a><a href="#h19-0-317" id="h19-0-317" class="i">+                            modifier = Modifier.fillMaxWidth(),
</a><a href="#h19-0-318" id="h19-0-318" class="i">+                            onClick = { showRestoreMenuDialog = true }
</a><a href="#h19-0-319" id="h19-0-319" class="i">+                        ) {
</a><a href="#h19-0-320" id="h19-0-320" class="i">+                            Text(&quot;Restore Snapchat from existing installation&quot;)
</a><a href="#h19-0-321" id="h19-0-321" class="i">+                        }
</a><a href="#h19-0-322" id="h19-0-322" class="i">+                    }
</a><a href="#h19-0-323" id="h19-0-323" class="i">+                }
</a><a href="#h19-0-324" id="h19-0-324" class="i">+            }
</a><a href="#h19-0-325" id="h19-0-325" class="i">+        }
</a><a href="#h19-0-326" id="h19-0-326" class="i">+    }
</a><a href="#h19-0-327" id="h19-0-327" class="i">+}</a><a href="#h19-0-328" id="h19-0-328" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/settings.gradle.kts.html">settings.gradle.kts</a> b/<a href="../file/settings.gradle.kts.html">settings.gradle.kts</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -12,6 +12,7 @@ dependencyResolutionManagement {
</a>     repositories {
         google()
         mavenCentral()
<a href="#h20-0-3" id="h20-0-3" class="i">+        maven { url = uri(&quot;https://jitpack.io&quot;) }
</a>     }
 }
 
</pre>
</div>
</body>
</html>
