<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>refactor: optimize code &amp; improve ui - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/0f711b698ee14668bd29d337fe3e07962091a60c.html">0f711b698ee14668bd29d337fe3e07962091a60c</a>
<b>parent</b> <a href="../commit/88bcfe96516d513e4ef4725ba36b0ed6f4dc9be0.html">88bcfe96516d513e4ef4725ba36b0ed6f4dc9be0</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sun, 28 May 2023 17:27:49 +0200

refactor: optimize code &amp; improve ui

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">README.md</a></td><td> | </td><td class="num">8</td><td><span class="i">+++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></td><td> | </td><td class="num">50</td><td><span class="i">+++++++++++++++++++++++</span><span class="d">---------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/AnonymousStoryViewing.kt</a></td><td> | </td><td class="num">20</td><td><span class="i"></span><span class="d">--------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/MessageLogger.kt</a></td><td> | </td><td class="num">87</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/PreventReadReceipts.kt</a></td><td> | </td><td class="num">28</td><td><span class="i"></span><span class="d">----------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt</a></td><td> | </td><td class="num">20</td><td><span class="i"></span><span class="d">--------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a></td><td> | </td><td class="num">87</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a></td><td> | </td><td class="num">28</td><td><span class="i">++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h19">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a></td><td> | </td><td class="num">14</td><td><span class="i">++++++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></td><td> | </td><td class="num">9</td><td><span class="i">++++</span><span class="d">-----</span></td></tr>
</table></pre><pre>21 files changed, 224 insertions(+), 219 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/README.md.html">README.md</a> b/<a href="../file/README.md.html">README.md</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -31,7 +31,7 @@ If the software is redistributed, it must remain under the same GPLv3 license an
</a> &lt;/details&gt;
 
 &lt;details open&gt;
<a href="#h0-0-3" id="h0-0-3" class="d">-  &lt;summary&gt;Spy&lt;/summary&gt;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+  &lt;summary&gt;Spying&lt;/summary&gt;
</a> 
   - Anonymous story viewing (other users won&#39;t know you viewed their story)
   - Message logger (log all messages sent and received, you will be able to see deleted messages)
<a href="#h0-1" id="h0-1" class="h">@@ -59,3 +59,8 @@ You can also download the latest build from the [actions](https://github.com/rhu
</a> - BCH: qpu57a05kqljjadvpgjc6t894apprvth9slvlj4vpj
 - Bitcoin: bc1qaqnfn6mauzhmx0e6kkenh2wh4r6js0vh5vel92
 - ETH: 0x0760987491e9de53A73fd87F092Bd432a227Ee92
<a href="#h0-1-3" id="h0-1-3" class="i">+
</a><a href="#h0-1-4" id="h0-1-4" class="i">+## Contributors
</a><a href="#h0-1-5" id="h0-1-5" class="i">+- [rathmerdominik](https://github.com/rathmerdominik)
</a><a href="#h0-1-6" id="h0-1-6" class="i">+- [Flole998](https://github.com/Flole998)
</a><a href="#h0-1-7" id="h0-1-7" class="i">+- [authorisation](https://github.com/authorisation/)</a><a href="#h0-1-8" id="h0-1-8" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h1" href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a> b/<a href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,13 +1,14 @@
</a> {
     &quot;category&quot;: {
         &quot;general&quot;: &quot;General&quot;,
<a href="#h1-0-3" id="h1-0-3" class="d">-        &quot;spy&quot;: &quot;Spy&quot;,
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        &quot;spying&quot;: &quot;Spying&quot;,
</a>         &quot;media_download&quot;: &quot;Media Downloader&quot;,
         &quot;privacy&quot;: &quot;Privacy&quot;,
         &quot;ui&quot;: &quot;UI&quot;,
         &quot;extras&quot;: &quot;Extras&quot;,
         &quot;tweaks&quot;: &quot;Tweaks&quot;,
<a href="#h1-0-10" id="h1-0-10" class="d">-        &quot;experimental&quot;: &quot;Experimental&quot;
</a><a href="#h1-0-11" id="h1-0-11" class="i">+        &quot;experimental&quot;: &quot;Experimental&quot;,
</a><a href="#h1-0-12" id="h1-0-12" class="i">+        &quot;debugging&quot;: &quot;Debugging&quot;
</a>     },
 
     &quot;action&quot;: {
<a href="#h1-1" id="h1-1" class="h">@@ -21,7 +22,7 @@
</a>         &quot;prevent_read_receipts&quot;: &quot;Prevent Read Receipts&quot;,
         &quot;hide_bitmoji_presence&quot;: &quot;Hide Bitmoji Presence&quot;,
         &quot;show_message_content_in_notifications&quot;: &quot;Show Message Content In Notifications&quot;,
<a href="#h1-1-3" id="h1-1-3" class="d">-        &quot;notification_filter&quot;: &quot;Notification Filter&quot;,
</a><a href="#h1-1-4" id="h1-1-4" class="i">+        &quot;notification_blacklist&quot;: &quot;Notification Blacklist&quot;,
</a>         &quot;message_logger&quot;: &quot;Message Logger&quot;,
         &quot;unlimited_snap_view_time&quot;: &quot;Unlimited Snap View Time&quot;,
         &quot;auto_download_snaps&quot;: &quot;Auto Download Snaps&quot;,
<a href="#h1-2" id="h1-2" class="h">@@ -61,7 +62,7 @@
</a> 
     &quot;option&quot;: {
         &quot;property&quot;: {
<a href="#h1-2-3" id="h1-2-3" class="d">-            &quot;notification_filter&quot;: {
</a><a href="#h1-2-4" id="h1-2-4" class="i">+            &quot;notification_blacklist&quot;: {
</a>                 &quot;chat&quot;: &quot;Chat&quot;,
                 &quot;snap&quot;: &quot;Snap&quot;,
                 &quot;typing&quot;: &quot;Typing&quot;
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -4,7 +4,7 @@ enum class ConfigCategory(
</a>     val key: String
 ) {
     GENERAL(&quot;category.general&quot;),
<a href="#h2-0-3" id="h2-0-3" class="d">-    SPY(&quot;category.spy&quot;),
</a><a href="#h2-0-4" id="h2-0-4" class="i">+    SPYING(&quot;category.spying&quot;),
</a>     MEDIA_DOWNLOADER(&quot;category.media_download&quot;),
     PRIVACY(&quot;category.privacy&quot;),
     UI(&quot;category.ui&quot;),
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -25,25 +25,25 @@ enum class ConfigProperty(
</a>     PREVENT_READ_RECEIPTS(
         &quot;property.prevent_read_receipts&quot;,
         &quot;description.prevent_read_receipts&quot;,
<a href="#h3-0-3" id="h3-0-3" class="d">-        ConfigCategory.SPY,
</a><a href="#h3-0-4" id="h3-0-4" class="i">+        ConfigCategory.SPYING,
</a>         ConfigStateValue(false)
     ),
     HIDE_BITMOJI_PRESENCE(
         &quot;property.hide_bitmoji_presence&quot;,
         &quot;description.hide_bitmoji_presence&quot;,
<a href="#h3-0-10" id="h3-0-10" class="d">-        ConfigCategory.SPY,
</a><a href="#h3-0-11" id="h3-0-11" class="i">+        ConfigCategory.SPYING,
</a>         ConfigStateValue(false)
     ),
     SHOW_MESSAGE_CONTENT_IN_NOTIFICATIONS(
         &quot;property.show_message_content_in_notifications&quot;,
         &quot;description.show_message_content_in_notifications&quot;,
<a href="#h3-0-17" id="h3-0-17" class="d">-        ConfigCategory.SPY,
</a><a href="#h3-0-18" id="h3-0-18" class="i">+        ConfigCategory.SPYING,
</a>         ConfigStateValue(false)
     ),
<a href="#h3-0-21" id="h3-0-21" class="d">-    NOTIFICATION_FILTER(
</a><a href="#h3-0-22" id="h3-0-22" class="d">-        &quot;property.notification_filter&quot;,
</a><a href="#h3-0-23" id="h3-0-23" class="d">-        &quot;description.notification_filter&quot;,
</a><a href="#h3-0-24" id="h3-0-24" class="d">-        ConfigCategory.SPY,
</a><a href="#h3-0-25" id="h3-0-25" class="i">+    NOTIFICATION_BLACKLIST(
</a><a href="#h3-0-26" id="h3-0-26" class="i">+        &quot;property.notification_blacklist&quot;,
</a><a href="#h3-0-27" id="h3-0-27" class="i">+        &quot;description.notification_blacklist&quot;,
</a><a href="#h3-0-28" id="h3-0-28" class="i">+        ConfigCategory.SPYING,
</a>         ConfigStateListValue(
             listOf(&quot;snap&quot;, &quot;chat&quot;, &quot;typing&quot;),
             mutableMapOf(
<a href="#h3-1" id="h3-1" class="h">@@ -54,8 +54,8 @@ enum class ConfigProperty(
</a>         )
     ),
 
<a href="#h3-1-3" id="h3-1-3" class="d">-    MESSAGE_LOGGER(&quot;property.message_logger&quot;, &quot;description.message_logger&quot;, ConfigCategory.SPY, ConfigStateValue(false)),
</a><a href="#h3-1-4" id="h3-1-4" class="d">-    UNLIMITED_SNAP_VIEW_TIME(&quot;property.unlimited_snap_view_time&quot;, &quot;description.unlimited_snap_view_time&quot;, ConfigCategory.SPY, ConfigStateValue(false)),
</a><a href="#h3-1-5" id="h3-1-5" class="i">+    MESSAGE_LOGGER(&quot;property.message_logger&quot;, &quot;description.message_logger&quot;, ConfigCategory.SPYING, ConfigStateValue(false)),
</a><a href="#h3-1-6" id="h3-1-6" class="i">+    UNLIMITED_SNAP_VIEW_TIME(&quot;property.unlimited_snap_view_time&quot;, &quot;description.unlimited_snap_view_time&quot;, ConfigCategory.SPYING, ConfigStateValue(false)),
</a> 
     AUTO_DOWNLOAD_SNAPS(
         &quot;property.auto_download_snaps&quot;,
<a href="#h3-2" id="h3-2" class="h">@@ -134,46 +134,46 @@ enum class ConfigProperty(
</a>         ConfigIntegerValue(20)
     ),
 
<a href="#h3-2-3" id="h3-2-3" class="d">-    GALLERY_MEDIA_SEND_OVERRIDE(
</a><a href="#h3-2-4" id="h3-2-4" class="d">-        &quot;property.gallery_media_send_override&quot;,
</a><a href="#h3-2-5" id="h3-2-5" class="d">-        &quot;description.gallery_media_send_override&quot;,
</a><a href="#h3-2-6" id="h3-2-6" class="d">-        ConfigCategory.EXTRAS,
</a><a href="#h3-2-7" id="h3-2-7" class="d">-        ConfigStateSelection(
</a><a href="#h3-2-8" id="h3-2-8" class="d">-            listOf(&quot;OFF&quot;, &quot;NOTE&quot;, &quot;SNAP&quot;),
</a><a href="#h3-2-9" id="h3-2-9" class="d">-            &quot;OFF&quot;
</a><a href="#h3-2-10" id="h3-2-10" class="d">-        )
</a><a href="#h3-2-11" id="h3-2-11" class="d">-    ),
</a>     AUTO_SAVE(&quot;property.auto_save&quot;, &quot;description.auto_save&quot;, ConfigCategory.EXTRAS, ConfigStateValue(false)),
     ANTI_AUTO_SAVE(&quot;property.anti_auto_save&quot;, &quot;description.anti_auto_save&quot;, ConfigCategory.EXTRAS, ConfigStateValue(false)),
     SNAPCHAT_PLUS(&quot;property.snapchat_plus&quot;, &quot;description.snapchat_plus&quot;, ConfigCategory.EXTRAS, ConfigStateValue(false)),
<a href="#h3-2-15" id="h3-2-15" class="d">-
</a>     DISABLE_SNAP_SPLITTING(
         &quot;property.disable_snap_splitting&quot;,
         &quot;description.disable_snap_splitting&quot;,
<a href="#h3-2-19" id="h3-2-19" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h3-2-20" id="h3-2-20" class="i">+        ConfigCategory.EXTRAS,
</a>         ConfigStateValue(false)
     ),
     DISABLE_VIDEO_LENGTH_RESTRICTION(
         &quot;property.disable_video_length_restriction&quot;,
         &quot;description.disable_video_length_restriction&quot;,
<a href="#h3-2-26" id="h3-2-26" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h3-2-27" id="h3-2-27" class="i">+        ConfigCategory.EXTRAS,
</a>         ConfigStateValue(false)
     ),
     OVERRIDE_MEDIA_QUALITY(
         &quot;property.override_media_quality&quot;,
         &quot;description.override_media_quality&quot;,
<a href="#h3-2-33" id="h3-2-33" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h3-2-34" id="h3-2-34" class="i">+        ConfigCategory.EXTRAS,
</a>         ConfigStateValue(false)
     ),
     MEDIA_QUALITY_LEVEL(
         &quot;property.media_quality_level&quot;,
         &quot;description.media_quality_level&quot;,
<a href="#h3-2-40" id="h3-2-40" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h3-2-41" id="h3-2-41" class="i">+        ConfigCategory.EXTRAS,
</a>         ConfigStateSelection(
             listOf(&quot;LEVEL_NONE&quot;, &quot;LEVEL_1&quot;, &quot;LEVEL_2&quot;, &quot;LEVEL_3&quot;, &quot;LEVEL_4&quot;, &quot;LEVEL_5&quot;, &quot;LEVEL_6&quot;, &quot;LEVEL_7&quot;, &quot;LEVEL_MAX&quot;),
             &quot;LEVEL_NONE&quot;
         )
     ),
<a href="#h3-2-47" id="h3-2-47" class="i">+    GALLERY_MEDIA_SEND_OVERRIDE(
</a><a href="#h3-2-48" id="h3-2-48" class="i">+        &quot;property.gallery_media_send_override&quot;,
</a><a href="#h3-2-49" id="h3-2-49" class="i">+        &quot;description.gallery_media_send_override&quot;,
</a><a href="#h3-2-50" id="h3-2-50" class="i">+        ConfigCategory.EXTRAS,
</a><a href="#h3-2-51" id="h3-2-51" class="i">+        ConfigStateSelection(
</a><a href="#h3-2-52" id="h3-2-52" class="i">+            listOf(&quot;OFF&quot;, &quot;NOTE&quot;, &quot;SNAP&quot;),
</a><a href="#h3-2-53" id="h3-2-53" class="i">+            &quot;OFF&quot;
</a><a href="#h3-2-54" id="h3-2-54" class="i">+        )
</a><a href="#h3-2-55" id="h3-2-55" class="i">+    ),
</a><a href="#h3-2-56" id="h3-2-56" class="i">+
</a>     REMOVE_VOICE_RECORD_BUTTON(
         &quot;property.remove_voice_record_button&quot;,
         &quot;description.remove_voice_record_button&quot;,
<a href="#h3-3" id="h3-3" class="h">@@ -233,10 +233,6 @@ enum class ConfigProperty(
</a>     );
 
     companion object {
<a href="#h3-3-3" id="h3-3-3" class="d">-        fun fromNameKey(nameKey: String): ConfigProperty? {
</a><a href="#h3-3-4" id="h3-3-4" class="d">-            return values().find { it.nameKey == nameKey }
</a><a href="#h3-3-5" id="h3-3-5" class="d">-        }
</a><a href="#h3-3-6" id="h3-3-6" class="d">-
</a>         fun sortedByCategory(): List&lt;ConfigProperty&gt; {
             return values().sortedBy { it.category.ordinal }
         }
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -21,7 +21,7 @@ import me.rhunk.snapenhance.data.wrapper.impl.media.opera.ParamMap
</a> import me.rhunk.snapenhance.features.Feature
 import me.rhunk.snapenhance.features.FeatureLoadParams
 import me.rhunk.snapenhance.features.impl.Messaging
<a href="#h4-0-3" id="h4-0-3" class="d">-import me.rhunk.snapenhance.features.impl.spy.MessageLogger
</a><a href="#h4-0-4" id="h4-0-4" class="i">+import me.rhunk.snapenhance.features.impl.spying.MessageLogger
</a> import me.rhunk.snapenhance.hook.HookAdapter
 import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
<a href="#h4-1" id="h4-1" class="h">@@ -62,7 +62,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>         return isFFmpegPresent
     }
 
<a href="#h4-1-3" id="h4-1-3" class="d">-    private fun createNewFilePath(hash: Int, author: String, fileType: FileType): String? {
</a><a href="#h4-1-4" id="h4-1-4" class="i">+    private fun createNewFilePath(hash: Int, author: String, fileType: FileType): String {
</a>         val hexHash = Integer.toHexString(hash)
         return author + &quot;/&quot; + hexHash + &quot;.&quot; + fileType.fileExtension
     }
<b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -8,8 +8,8 @@ import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a> import me.rhunk.snapenhance.features.Feature
 import me.rhunk.snapenhance.features.FeatureLoadParams
 import me.rhunk.snapenhance.features.impl.Messaging
<a href="#h5-0-3" id="h5-0-3" class="d">-import me.rhunk.snapenhance.features.impl.spy.MessageLogger
</a><a href="#h5-0-4" id="h5-0-4" class="d">-import me.rhunk.snapenhance.features.impl.spy.StealthMode
</a><a href="#h5-0-5" id="h5-0-5" class="i">+import me.rhunk.snapenhance.features.impl.spying.MessageLogger
</a><a href="#h5-0-6" id="h5-0-6" class="i">+import me.rhunk.snapenhance.features.impl.spying.StealthMode
</a> import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
 import me.rhunk.snapenhance.util.CallbackBuilder
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -155,8 +155,7 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>     }
 
     private fun shouldIgnoreNotification(type: String): Boolean {
<a href="#h6-0-3" id="h6-0-3" class="d">-        Logger.debug(&quot;notification type: $type&quot;)
</a><a href="#h6-0-4" id="h6-0-4" class="d">-        val states = context.config.options(ConfigProperty.NOTIFICATION_FILTER)
</a><a href="#h6-0-5" id="h6-0-5" class="i">+        val states = context.config.options(ConfigProperty.NOTIFICATION_BLACKLIST)
</a> 
         states[&quot;snap&quot;]?.let { if (type.endsWith(&quot;SNAP&quot;) &amp;&amp; it) return true }
         states[&quot;chat&quot;]?.let { if (type.endsWith(&quot;CHAT&quot;) &amp;&amp; it) return true }
<b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -29,14 +29,14 @@ class DisableMetrics : Feature(&quot;DisableMetrics&quot;, loadParams = FeatureLoadParams.
</a>         Hooker.hook(context.classCache.networkApi, &quot;submit&quot;, HookStage.BEFORE, disableMetricsFilter) { param -&gt;
             val httpRequest: Any = param.arg(0)
             val url = XposedHelpers.getObjectField(httpRequest, &quot;mUrl&quot;).toString()
<a href="#h7-0-3" id="h7-0-3" class="d">-            if (url.contains(&quot;resolve?co=&quot;)) {
</a><a href="#h7-0-4" id="h7-0-4" class="i">+            /*if (url.contains(&quot;resolve?co=&quot;)) {
</a>                 val index = url.indexOf(&quot;co=&quot;)
                 val end = url.lastIndexOf(&quot;&amp;&quot;)
                 val co = url.substring(index + 3, end)
                 val decoded = Base64.getDecoder().decode(co.toByteArray(StandardCharsets.UTF_8))
                 debug(&quot;decoded : &quot; + decoded.toString(Charsets.UTF_8))
                 debug(&quot;content: $co&quot;)
<a href="#h7-0-11" id="h7-0-11" class="d">-            }
</a><a href="#h7-0-12" id="h7-0-12" class="i">+            }*/
</a>             if (url.contains(&quot;app-analytics&quot;) || url.endsWith(&quot;v1/metrics&quot;)) {
                 param.setResult(null)
             }
<b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/AnonymousStoryViewing.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/AnonymousStoryViewing.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/AnonymousStoryViewing.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/AnonymousStoryViewing.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,20 +0,0 @@
</a><a href="#h8-0-0" id="h8-0-0" class="d">-package me.rhunk.snapenhance.features.impl.spy
</a><a href="#h8-0-1" id="h8-0-1" class="d">-
</a><a href="#h8-0-2" id="h8-0-2" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h8-0-3" id="h8-0-3" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h8-0-4" id="h8-0-4" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h8-0-5" id="h8-0-5" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h8-0-6" id="h8-0-6" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h8-0-7" id="h8-0-7" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h8-0-8" id="h8-0-8" class="d">-
</a><a href="#h8-0-9" id="h8-0-9" class="d">-class AnonymousStoryViewing : Feature(&quot;Anonymous Story Viewing&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h8-0-10" id="h8-0-10" class="d">-    override fun asyncOnActivityCreate() {
</a><a href="#h8-0-11" id="h8-0-11" class="d">-        Hooker.hook(context.classCache.networkApi,&quot;submit&quot;, HookStage.BEFORE, { context.config.bool(ConfigProperty.ANONYMOUS_STORY_VIEW) }) {
</a><a href="#h8-0-12" id="h8-0-12" class="d">-            val httpRequest: Any = it.arg(0)
</a><a href="#h8-0-13" id="h8-0-13" class="d">-            val url = httpRequest.getObjectField(&quot;mUrl&quot;) as String
</a><a href="#h8-0-14" id="h8-0-14" class="d">-            if (url.endsWith(&quot;readreceipt-indexer/batchuploadreadreceipts&quot;) || url.endsWith(&quot;v2/batch_cta&quot;)) {
</a><a href="#h8-0-15" id="h8-0-15" class="d">-                it.setResult(null)
</a><a href="#h8-0-16" id="h8-0-16" class="d">-            }
</a><a href="#h8-0-17" id="h8-0-17" class="d">-        }
</a><a href="#h8-0-18" id="h8-0-18" class="d">-    }
</a><a href="#h8-0-19" id="h8-0-19" class="d">-}
</a><b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/MessageLogger.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/MessageLogger.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/MessageLogger.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/MessageLogger.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,86 +0,0 @@
</a><a href="#h9-0-0" id="h9-0-0" class="d">-package me.rhunk.snapenhance.features.impl.spy
</a><a href="#h9-0-1" id="h9-0-1" class="d">-
</a><a href="#h9-0-2" id="h9-0-2" class="d">-import com.google.gson.JsonParser
</a><a href="#h9-0-3" id="h9-0-3" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h9-0-4" id="h9-0-4" class="d">-import me.rhunk.snapenhance.data.ContentType
</a><a href="#h9-0-5" id="h9-0-5" class="d">-import me.rhunk.snapenhance.data.MessageState
</a><a href="#h9-0-6" id="h9-0-6" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h9-0-7" id="h9-0-7" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h9-0-8" id="h9-0-8" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h9-0-9" id="h9-0-9" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h9-0-10" id="h9-0-10" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h9-0-11" id="h9-0-11" class="d">-
</a><a href="#h9-0-12" id="h9-0-12" class="d">-class MessageLogger : Feature(&quot;MessageLogger&quot;, loadParams = FeatureLoadParams.INIT_SYNC or FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h9-0-13" id="h9-0-13" class="d">-    private val messageCache = mutableMapOf&lt;Long, String&gt;()
</a><a href="#h9-0-14" id="h9-0-14" class="d">-    private val removedMessages = linkedSetOf&lt;Long&gt;()
</a><a href="#h9-0-15" id="h9-0-15" class="d">-    private val myUserId by lazy { context.database.getMyUserId() }
</a><a href="#h9-0-16" id="h9-0-16" class="d">-
</a><a href="#h9-0-17" id="h9-0-17" class="d">-    fun isMessageRemoved(messageId: Long) = removedMessages.contains(messageId)
</a><a href="#h9-0-18" id="h9-0-18" class="d">-
</a><a href="#h9-0-19" id="h9-0-19" class="d">-    override fun onActivityCreate() {
</a><a href="#h9-0-20" id="h9-0-20" class="d">-        if (!context.database.hasArroyo()) {
</a><a href="#h9-0-21" id="h9-0-21" class="d">-            context.bridgeClient.clearMessageLogger()
</a><a href="#h9-0-22" id="h9-0-22" class="d">-        }
</a><a href="#h9-0-23" id="h9-0-23" class="d">-    }
</a><a href="#h9-0-24" id="h9-0-24" class="d">-
</a><a href="#h9-0-25" id="h9-0-25" class="d">-    //FIXME: message disappears when the conversation is set to delete on view
</a><a href="#h9-0-26" id="h9-0-26" class="d">-    override fun init() {
</a><a href="#h9-0-27" id="h9-0-27" class="d">-        Hooker.hookConstructor(context.classCache.message, HookStage.AFTER, {
</a><a href="#h9-0-28" id="h9-0-28" class="d">-            context.config.bool(ConfigProperty.MESSAGE_LOGGER)
</a><a href="#h9-0-29" id="h9-0-29" class="d">-        }) {
</a><a href="#h9-0-30" id="h9-0-30" class="d">-            val message = Message(it.thisObject())
</a><a href="#h9-0-31" id="h9-0-31" class="d">-            val messageId = message.messageDescriptor.messageId
</a><a href="#h9-0-32" id="h9-0-32" class="d">-            val contentType = message.messageContent.contentType
</a><a href="#h9-0-33" id="h9-0-33" class="d">-            val messageState = message.messageState
</a><a href="#h9-0-34" id="h9-0-34" class="d">-
</a><a href="#h9-0-35" id="h9-0-35" class="d">-            if (messageState != MessageState.COMMITTED) return@hookConstructor
</a><a href="#h9-0-36" id="h9-0-36" class="d">-
</a><a href="#h9-0-37" id="h9-0-37" class="d">-
</a><a href="#h9-0-38" id="h9-0-38" class="d">-            if (contentType == ContentType.STATUS) {
</a><a href="#h9-0-39" id="h9-0-39" class="d">-                //query the deleted message
</a><a href="#h9-0-40" id="h9-0-40" class="d">-                val deletedMessage: String = if (messageCache.containsKey(messageId)) messageCache[messageId] else {
</a><a href="#h9-0-41" id="h9-0-41" class="d">-                    context.bridgeClient.getMessageLoggerMessage(messageId)?.toString(Charsets.UTF_8)
</a><a href="#h9-0-42" id="h9-0-42" class="d">-                } ?: return@hookConstructor
</a><a href="#h9-0-43" id="h9-0-43" class="d">-
</a><a href="#h9-0-44" id="h9-0-44" class="d">-                val messageJsonObject = JsonParser.parseString(deletedMessage).asJsonObject
</a><a href="#h9-0-45" id="h9-0-45" class="d">-
</a><a href="#h9-0-46" id="h9-0-46" class="d">-                //if the message is a snap make it playable
</a><a href="#h9-0-47" id="h9-0-47" class="d">-                if (messageJsonObject[&quot;mMessageContent&quot;]?.asJsonObject?.get(&quot;mContentType&quot;)?.asString == &quot;SNAP&quot;) {
</a><a href="#h9-0-48" id="h9-0-48" class="d">-                    messageJsonObject[&quot;mMetadata&quot;].asJsonObject.addProperty(&quot;mPlayableSnapState&quot;, &quot;PLAYABLE&quot;)
</a><a href="#h9-0-49" id="h9-0-49" class="d">-                }
</a><a href="#h9-0-50" id="h9-0-50" class="d">-
</a><a href="#h9-0-51" id="h9-0-51" class="d">-                //serialize all properties of messageJsonObject and put in the message object
</a><a href="#h9-0-52" id="h9-0-52" class="d">-                message.instanceNonNull().javaClass.declaredFields.forEach { field -&gt;
</a><a href="#h9-0-53" id="h9-0-53" class="d">-                    field.isAccessible = true
</a><a href="#h9-0-54" id="h9-0-54" class="d">-                    val fieldName = field.name
</a><a href="#h9-0-55" id="h9-0-55" class="d">-                    val fieldValue = messageJsonObject[fieldName]
</a><a href="#h9-0-56" id="h9-0-56" class="d">-                    if (fieldValue != null) {
</a><a href="#h9-0-57" id="h9-0-57" class="d">-                        field.set(message.instanceNonNull(), context.gson.fromJson(fieldValue, field.type))
</a><a href="#h9-0-58" id="h9-0-58" class="d">-                    }
</a><a href="#h9-0-59" id="h9-0-59" class="d">-                }
</a><a href="#h9-0-60" id="h9-0-60" class="d">-
</a><a href="#h9-0-61" id="h9-0-61" class="d">-                //set the message state to PREPARING for visibility
</a><a href="#h9-0-62" id="h9-0-62" class="d">-                if (message.messageContent.contentType != ContentType.SNAP &amp;&amp; message.messageContent.contentType != ContentType.EXTERNAL_MEDIA) {
</a><a href="#h9-0-63" id="h9-0-63" class="d">-                    message.messageState = MessageState.PREPARING
</a><a href="#h9-0-64" id="h9-0-64" class="d">-                }
</a><a href="#h9-0-65" id="h9-0-65" class="d">-                removedMessages.add(messageId)
</a><a href="#h9-0-66" id="h9-0-66" class="d">-                return@hookConstructor
</a><a href="#h9-0-67" id="h9-0-67" class="d">-            }
</a><a href="#h9-0-68" id="h9-0-68" class="d">-
</a><a href="#h9-0-69" id="h9-0-69" class="d">-            //exclude messages sent by me
</a><a href="#h9-0-70" id="h9-0-70" class="d">-            if (message.senderId.toString() == myUserId) return@hookConstructor
</a><a href="#h9-0-71" id="h9-0-71" class="d">-
</a><a href="#h9-0-72" id="h9-0-72" class="d">-            if (!messageCache.containsKey(messageId)) {
</a><a href="#h9-0-73" id="h9-0-73" class="d">-                context.executeAsync {
</a><a href="#h9-0-74" id="h9-0-74" class="d">-                    val storedMessage = context.bridgeClient.getMessageLoggerMessage(messageId)?.toString(Charsets.UTF_8)
</a><a href="#h9-0-75" id="h9-0-75" class="d">-                    if (storedMessage == null) {
</a><a href="#h9-0-76" id="h9-0-76" class="d">-                        messageCache[messageId] = context.gson.toJson(message.instanceNonNull())
</a><a href="#h9-0-77" id="h9-0-77" class="d">-                        context.bridgeClient.addMessageLoggerMessage(messageId, messageCache[messageId]!!.toByteArray(Charsets.UTF_8))
</a><a href="#h9-0-78" id="h9-0-78" class="d">-                        return@executeAsync
</a><a href="#h9-0-79" id="h9-0-79" class="d">-                    }
</a><a href="#h9-0-80" id="h9-0-80" class="d">-                    messageCache[messageId] = storedMessage
</a><a href="#h9-0-81" id="h9-0-81" class="d">-                }
</a><a href="#h9-0-82" id="h9-0-82" class="d">-            }
</a><a href="#h9-0-83" id="h9-0-83" class="d">-        }
</a><a href="#h9-0-84" id="h9-0-84" class="d">-    }
</a><a href="#h9-0-85" id="h9-0-85" class="d">-}</a><a href="#h9-0-86" id="h9-0-86" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/PreventReadReceipts.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/PreventReadReceipts.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/PreventReadReceipts.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/PreventReadReceipts.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,28 +0,0 @@
</a><a href="#h10-0-0" id="h10-0-0" class="d">-package me.rhunk.snapenhance.features.impl.spy
</a><a href="#h10-0-1" id="h10-0-1" class="d">-
</a><a href="#h10-0-2" id="h10-0-2" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h10-0-3" id="h10-0-3" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a><a href="#h10-0-4" id="h10-0-4" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h10-0-5" id="h10-0-5" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h10-0-6" id="h10-0-6" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h10-0-7" id="h10-0-7" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h10-0-8" id="h10-0-8" class="d">-
</a><a href="#h10-0-9" id="h10-0-9" class="d">-class PreventReadReceipts : Feature(&quot;PreventReadReceipts&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h10-0-10" id="h10-0-10" class="d">-    override fun onActivityCreate() {
</a><a href="#h10-0-11" id="h10-0-11" class="d">-        val isConversationInStealthMode: (SnapUUID) -&gt; Boolean = hook@{
</a><a href="#h10-0-12" id="h10-0-12" class="d">-            if (context.config.bool(ConfigProperty.PREVENT_READ_RECEIPTS)) return@hook true
</a><a href="#h10-0-13" id="h10-0-13" class="d">-            context.feature(StealthMode::class).isStealth(it.toString())
</a><a href="#h10-0-14" id="h10-0-14" class="d">-        }
</a><a href="#h10-0-15" id="h10-0-15" class="d">-
</a><a href="#h10-0-16" id="h10-0-16" class="d">-        arrayOf(&quot;mediaMessagesDisplayed&quot;, &quot;displayedMessages&quot;).forEach { methodName: String -&gt;
</a><a href="#h10-0-17" id="h10-0-17" class="d">-            Hooker.hook(context.classCache.conversationManager, methodName, HookStage.BEFORE, { isConversationInStealthMode(SnapUUID(it.arg(0))) }) {
</a><a href="#h10-0-18" id="h10-0-18" class="d">-                it.setResult(null)
</a><a href="#h10-0-19" id="h10-0-19" class="d">-            }
</a><a href="#h10-0-20" id="h10-0-20" class="d">-        }
</a><a href="#h10-0-21" id="h10-0-21" class="d">-        Hooker.hook(context.classCache.snapManager, &quot;onSnapInteraction&quot;, HookStage.BEFORE) {
</a><a href="#h10-0-22" id="h10-0-22" class="d">-            if (isConversationInStealthMode(SnapUUID(it.arg(1) as Any))) {
</a><a href="#h10-0-23" id="h10-0-23" class="d">-                it.setResult(null)
</a><a href="#h10-0-24" id="h10-0-24" class="d">-            }
</a><a href="#h10-0-25" id="h10-0-25" class="d">-        }
</a><a href="#h10-0-26" id="h10-0-26" class="d">-    }
</a><a href="#h10-0-27" id="h10-0-27" class="d">-}
</a><b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,20 +0,0 @@
</a><a href="#h11-0-0" id="h11-0-0" class="d">-package me.rhunk.snapenhance.features.impl.spy
</a><a href="#h11-0-1" id="h11-0-1" class="d">-
</a><a href="#h11-0-2" id="h11-0-2" class="d">-import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h11-0-3" id="h11-0-3" class="d">-import me.rhunk.snapenhance.features.BridgeFileFeature
</a><a href="#h11-0-4" id="h11-0-4" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h11-0-5" id="h11-0-5" class="d">-
</a><a href="#h11-0-6" id="h11-0-6" class="d">-
</a><a href="#h11-0-7" id="h11-0-7" class="d">-class StealthMode : BridgeFileFeature(&quot;StealthMode&quot;, BridgeFileType.STEALTH, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h11-0-8" id="h11-0-8" class="d">-    override fun onActivityCreate() {
</a><a href="#h11-0-9" id="h11-0-9" class="d">-        readFile()
</a><a href="#h11-0-10" id="h11-0-10" class="d">-    }
</a><a href="#h11-0-11" id="h11-0-11" class="d">-
</a><a href="#h11-0-12" id="h11-0-12" class="d">-    fun setStealth(conversationId: String, stealth: Boolean) {
</a><a href="#h11-0-13" id="h11-0-13" class="d">-        setState(conversationId.hashCode().toLong().toString(16), stealth)
</a><a href="#h11-0-14" id="h11-0-14" class="d">-    }
</a><a href="#h11-0-15" id="h11-0-15" class="d">-
</a><a href="#h11-0-16" id="h11-0-16" class="d">-    fun isStealth(conversationId: String): Boolean {
</a><a href="#h11-0-17" id="h11-0-17" class="d">-        return exists(conversationId.hashCode().toLong().toString(16))
</a><a href="#h11-0-18" id="h11-0-18" class="d">-    }
</a><a href="#h11-0-19" id="h11-0-19" class="d">-}
</a><b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+package me.rhunk.snapenhance.features.impl.spying
</a><a href="#h12-0-1" id="h12-0-1" class="i">+
</a><a href="#h12-0-2" id="h12-0-2" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h12-0-3" id="h12-0-3" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h12-0-4" id="h12-0-4" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h12-0-5" id="h12-0-5" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h12-0-6" id="h12-0-6" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h12-0-7" id="h12-0-7" class="i">+import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h12-0-8" id="h12-0-8" class="i">+
</a><a href="#h12-0-9" id="h12-0-9" class="i">+class AnonymousStoryViewing : Feature(&quot;Anonymous Story Viewing&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h12-0-10" id="h12-0-10" class="i">+    override fun asyncOnActivityCreate() {
</a><a href="#h12-0-11" id="h12-0-11" class="i">+        Hooker.hook(context.classCache.networkApi,&quot;submit&quot;, HookStage.BEFORE, { context.config.bool(ConfigProperty.ANONYMOUS_STORY_VIEW) }) {
</a><a href="#h12-0-12" id="h12-0-12" class="i">+            val httpRequest: Any = it.arg(0)
</a><a href="#h12-0-13" id="h12-0-13" class="i">+            val url = httpRequest.getObjectField(&quot;mUrl&quot;) as String
</a><a href="#h12-0-14" id="h12-0-14" class="i">+            if (url.endsWith(&quot;readreceipt-indexer/batchuploadreadreceipts&quot;) || url.endsWith(&quot;v2/batch_cta&quot;)) {
</a><a href="#h12-0-15" id="h12-0-15" class="i">+                it.setResult(null)
</a><a href="#h12-0-16" id="h12-0-16" class="i">+            }
</a><a href="#h12-0-17" id="h12-0-17" class="i">+        }
</a><a href="#h12-0-18" id="h12-0-18" class="i">+    }
</a><a href="#h12-0-19" id="h12-0-19" class="i">+}
</a><b>diff --git a/<a id="h13" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,86 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+package me.rhunk.snapenhance.features.impl.spying
</a><a href="#h13-0-1" id="h13-0-1" class="i">+
</a><a href="#h13-0-2" id="h13-0-2" class="i">+import com.google.gson.JsonParser
</a><a href="#h13-0-3" id="h13-0-3" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h13-0-4" id="h13-0-4" class="i">+import me.rhunk.snapenhance.data.ContentType
</a><a href="#h13-0-5" id="h13-0-5" class="i">+import me.rhunk.snapenhance.data.MessageState
</a><a href="#h13-0-6" id="h13-0-6" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h13-0-7" id="h13-0-7" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h13-0-8" id="h13-0-8" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h13-0-9" id="h13-0-9" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h13-0-10" id="h13-0-10" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h13-0-11" id="h13-0-11" class="i">+
</a><a href="#h13-0-12" id="h13-0-12" class="i">+class MessageLogger : Feature(&quot;MessageLogger&quot;, loadParams = FeatureLoadParams.INIT_SYNC or FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h13-0-13" id="h13-0-13" class="i">+    private val messageCache = mutableMapOf&lt;Long, String&gt;()
</a><a href="#h13-0-14" id="h13-0-14" class="i">+    private val removedMessages = linkedSetOf&lt;Long&gt;()
</a><a href="#h13-0-15" id="h13-0-15" class="i">+    private val myUserId by lazy { context.database.getMyUserId() }
</a><a href="#h13-0-16" id="h13-0-16" class="i">+
</a><a href="#h13-0-17" id="h13-0-17" class="i">+    fun isMessageRemoved(messageId: Long) = removedMessages.contains(messageId)
</a><a href="#h13-0-18" id="h13-0-18" class="i">+
</a><a href="#h13-0-19" id="h13-0-19" class="i">+    override fun onActivityCreate() {
</a><a href="#h13-0-20" id="h13-0-20" class="i">+        if (!context.database.hasArroyo()) {
</a><a href="#h13-0-21" id="h13-0-21" class="i">+            context.bridgeClient.clearMessageLogger()
</a><a href="#h13-0-22" id="h13-0-22" class="i">+        }
</a><a href="#h13-0-23" id="h13-0-23" class="i">+    }
</a><a href="#h13-0-24" id="h13-0-24" class="i">+
</a><a href="#h13-0-25" id="h13-0-25" class="i">+    //FIXME: message disappears when the conversation is set to delete on view
</a><a href="#h13-0-26" id="h13-0-26" class="i">+    override fun init() {
</a><a href="#h13-0-27" id="h13-0-27" class="i">+        Hooker.hookConstructor(context.classCache.message, HookStage.AFTER, {
</a><a href="#h13-0-28" id="h13-0-28" class="i">+            context.config.bool(ConfigProperty.MESSAGE_LOGGER)
</a><a href="#h13-0-29" id="h13-0-29" class="i">+        }) {
</a><a href="#h13-0-30" id="h13-0-30" class="i">+            val message = Message(it.thisObject())
</a><a href="#h13-0-31" id="h13-0-31" class="i">+            val messageId = message.messageDescriptor.messageId
</a><a href="#h13-0-32" id="h13-0-32" class="i">+            val contentType = message.messageContent.contentType
</a><a href="#h13-0-33" id="h13-0-33" class="i">+            val messageState = message.messageState
</a><a href="#h13-0-34" id="h13-0-34" class="i">+
</a><a href="#h13-0-35" id="h13-0-35" class="i">+            if (messageState != MessageState.COMMITTED) return@hookConstructor
</a><a href="#h13-0-36" id="h13-0-36" class="i">+
</a><a href="#h13-0-37" id="h13-0-37" class="i">+
</a><a href="#h13-0-38" id="h13-0-38" class="i">+            if (contentType == ContentType.STATUS) {
</a><a href="#h13-0-39" id="h13-0-39" class="i">+                //query the deleted message
</a><a href="#h13-0-40" id="h13-0-40" class="i">+                val deletedMessage: String = if (messageCache.containsKey(messageId)) messageCache[messageId] else {
</a><a href="#h13-0-41" id="h13-0-41" class="i">+                    context.bridgeClient.getMessageLoggerMessage(messageId)?.toString(Charsets.UTF_8)
</a><a href="#h13-0-42" id="h13-0-42" class="i">+                } ?: return@hookConstructor
</a><a href="#h13-0-43" id="h13-0-43" class="i">+
</a><a href="#h13-0-44" id="h13-0-44" class="i">+                val messageJsonObject = JsonParser.parseString(deletedMessage).asJsonObject
</a><a href="#h13-0-45" id="h13-0-45" class="i">+
</a><a href="#h13-0-46" id="h13-0-46" class="i">+                //if the message is a snap make it playable
</a><a href="#h13-0-47" id="h13-0-47" class="i">+                if (messageJsonObject[&quot;mMessageContent&quot;]?.asJsonObject?.get(&quot;mContentType&quot;)?.asString == &quot;SNAP&quot;) {
</a><a href="#h13-0-48" id="h13-0-48" class="i">+                    messageJsonObject[&quot;mMetadata&quot;].asJsonObject.addProperty(&quot;mPlayableSnapState&quot;, &quot;PLAYABLE&quot;)
</a><a href="#h13-0-49" id="h13-0-49" class="i">+                }
</a><a href="#h13-0-50" id="h13-0-50" class="i">+
</a><a href="#h13-0-51" id="h13-0-51" class="i">+                //serialize all properties of messageJsonObject and put in the message object
</a><a href="#h13-0-52" id="h13-0-52" class="i">+                message.instanceNonNull().javaClass.declaredFields.forEach { field -&gt;
</a><a href="#h13-0-53" id="h13-0-53" class="i">+                    field.isAccessible = true
</a><a href="#h13-0-54" id="h13-0-54" class="i">+                    val fieldName = field.name
</a><a href="#h13-0-55" id="h13-0-55" class="i">+                    val fieldValue = messageJsonObject[fieldName]
</a><a href="#h13-0-56" id="h13-0-56" class="i">+                    if (fieldValue != null) {
</a><a href="#h13-0-57" id="h13-0-57" class="i">+                        field.set(message.instanceNonNull(), context.gson.fromJson(fieldValue, field.type))
</a><a href="#h13-0-58" id="h13-0-58" class="i">+                    }
</a><a href="#h13-0-59" id="h13-0-59" class="i">+                }
</a><a href="#h13-0-60" id="h13-0-60" class="i">+
</a><a href="#h13-0-61" id="h13-0-61" class="i">+                //set the message state to PREPARING for visibility
</a><a href="#h13-0-62" id="h13-0-62" class="i">+                if (message.messageContent.contentType != ContentType.SNAP &amp;&amp; message.messageContent.contentType != ContentType.EXTERNAL_MEDIA) {
</a><a href="#h13-0-63" id="h13-0-63" class="i">+                    message.messageState = MessageState.PREPARING
</a><a href="#h13-0-64" id="h13-0-64" class="i">+                }
</a><a href="#h13-0-65" id="h13-0-65" class="i">+                removedMessages.add(messageId)
</a><a href="#h13-0-66" id="h13-0-66" class="i">+                return@hookConstructor
</a><a href="#h13-0-67" id="h13-0-67" class="i">+            }
</a><a href="#h13-0-68" id="h13-0-68" class="i">+
</a><a href="#h13-0-69" id="h13-0-69" class="i">+            //exclude messages sent by me
</a><a href="#h13-0-70" id="h13-0-70" class="i">+            if (message.senderId.toString() == myUserId) return@hookConstructor
</a><a href="#h13-0-71" id="h13-0-71" class="i">+
</a><a href="#h13-0-72" id="h13-0-72" class="i">+            if (!messageCache.containsKey(messageId)) {
</a><a href="#h13-0-73" id="h13-0-73" class="i">+                context.executeAsync {
</a><a href="#h13-0-74" id="h13-0-74" class="i">+                    val storedMessage = context.bridgeClient.getMessageLoggerMessage(messageId)?.toString(Charsets.UTF_8)
</a><a href="#h13-0-75" id="h13-0-75" class="i">+                    if (storedMessage == null) {
</a><a href="#h13-0-76" id="h13-0-76" class="i">+                        messageCache[messageId] = context.gson.toJson(message.instanceNonNull())
</a><a href="#h13-0-77" id="h13-0-77" class="i">+                        context.bridgeClient.addMessageLoggerMessage(messageId, messageCache[messageId]!!.toByteArray(Charsets.UTF_8))
</a><a href="#h13-0-78" id="h13-0-78" class="i">+                        return@executeAsync
</a><a href="#h13-0-79" id="h13-0-79" class="i">+                    }
</a><a href="#h13-0-80" id="h13-0-80" class="i">+                    messageCache[messageId] = storedMessage
</a><a href="#h13-0-81" id="h13-0-81" class="i">+                }
</a><a href="#h13-0-82" id="h13-0-82" class="i">+            }
</a><a href="#h13-0-83" id="h13-0-83" class="i">+        }
</a><a href="#h13-0-84" id="h13-0-84" class="i">+    }
</a><a href="#h13-0-85" id="h13-0-85" class="i">+}</a><a href="#h13-0-86" id="h13-0-86" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,28 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+package me.rhunk.snapenhance.features.impl.spying
</a><a href="#h14-0-1" id="h14-0-1" class="i">+
</a><a href="#h14-0-2" id="h14-0-2" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h14-0-3" id="h14-0-3" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a><a href="#h14-0-4" id="h14-0-4" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h14-0-5" id="h14-0-5" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h14-0-6" id="h14-0-6" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h14-0-7" id="h14-0-7" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h14-0-8" id="h14-0-8" class="i">+
</a><a href="#h14-0-9" id="h14-0-9" class="i">+class PreventReadReceipts : Feature(&quot;PreventReadReceipts&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h14-0-10" id="h14-0-10" class="i">+    override fun onActivityCreate() {
</a><a href="#h14-0-11" id="h14-0-11" class="i">+        val isConversationInStealthMode: (SnapUUID) -&gt; Boolean = hook@{
</a><a href="#h14-0-12" id="h14-0-12" class="i">+            if (context.config.bool(ConfigProperty.PREVENT_READ_RECEIPTS)) return@hook true
</a><a href="#h14-0-13" id="h14-0-13" class="i">+            context.feature(StealthMode::class).isStealth(it.toString())
</a><a href="#h14-0-14" id="h14-0-14" class="i">+        }
</a><a href="#h14-0-15" id="h14-0-15" class="i">+
</a><a href="#h14-0-16" id="h14-0-16" class="i">+        arrayOf(&quot;mediaMessagesDisplayed&quot;, &quot;displayedMessages&quot;).forEach { methodName: String -&gt;
</a><a href="#h14-0-17" id="h14-0-17" class="i">+            Hooker.hook(context.classCache.conversationManager, methodName, HookStage.BEFORE, { isConversationInStealthMode(SnapUUID(it.arg(0))) }) {
</a><a href="#h14-0-18" id="h14-0-18" class="i">+                it.setResult(null)
</a><a href="#h14-0-19" id="h14-0-19" class="i">+            }
</a><a href="#h14-0-20" id="h14-0-20" class="i">+        }
</a><a href="#h14-0-21" id="h14-0-21" class="i">+        Hooker.hook(context.classCache.snapManager, &quot;onSnapInteraction&quot;, HookStage.BEFORE) {
</a><a href="#h14-0-22" id="h14-0-22" class="i">+            if (isConversationInStealthMode(SnapUUID(it.arg(1) as Any))) {
</a><a href="#h14-0-23" id="h14-0-23" class="i">+                it.setResult(null)
</a><a href="#h14-0-24" id="h14-0-24" class="i">+            }
</a><a href="#h14-0-25" id="h14-0-25" class="i">+        }
</a><a href="#h14-0-26" id="h14-0-26" class="i">+    }
</a><a href="#h14-0-27" id="h14-0-27" class="i">+}
</a><b>diff --git a/<a id="h15" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+package me.rhunk.snapenhance.features.impl.spying
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h15-0-3" id="h15-0-3" class="i">+import me.rhunk.snapenhance.features.BridgeFileFeature
</a><a href="#h15-0-4" id="h15-0-4" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h15-0-5" id="h15-0-5" class="i">+
</a><a href="#h15-0-6" id="h15-0-6" class="i">+
</a><a href="#h15-0-7" id="h15-0-7" class="i">+class StealthMode : BridgeFileFeature(&quot;StealthMode&quot;, BridgeFileType.STEALTH, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h15-0-8" id="h15-0-8" class="i">+    override fun onActivityCreate() {
</a><a href="#h15-0-9" id="h15-0-9" class="i">+        readFile()
</a><a href="#h15-0-10" id="h15-0-10" class="i">+    }
</a><a href="#h15-0-11" id="h15-0-11" class="i">+
</a><a href="#h15-0-12" id="h15-0-12" class="i">+    fun setStealth(conversationId: String, stealth: Boolean) {
</a><a href="#h15-0-13" id="h15-0-13" class="i">+        setState(conversationId.hashCode().toLong().toString(16), stealth)
</a><a href="#h15-0-14" id="h15-0-14" class="i">+    }
</a><a href="#h15-0-15" id="h15-0-15" class="i">+
</a><a href="#h15-0-16" id="h15-0-16" class="i">+    fun isStealth(conversationId: String): Boolean {
</a><a href="#h15-0-17" id="h15-0-17" class="i">+        return exists(conversationId.hashCode().toLong().toString(16))
</a><a href="#h15-0-18" id="h15-0-18" class="i">+    }
</a><a href="#h15-0-19" id="h15-0-19" class="i">+}
</a><b>diff --git a/<a id="h16" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/ViewAppearanceHelper.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -11,25 +11,24 @@ import android.widget.TextView
</a> import me.rhunk.snapenhance.Constants
 
 object ViewAppearanceHelper {
<a href="#h16-0-3" id="h16-0-3" class="d">-    fun applyIndentation(view: TextView) {
</a><a href="#h16-0-4" id="h16-0-4" class="d">-        view.setPadding(70, 0, 55, 0)
</a><a href="#h16-0-5" id="h16-0-5" class="d">-    }
</a><a href="#h16-0-6" id="h16-0-6" class="d">-
</a>     @SuppressLint(&quot;UseSwitchCompatOrMaterialCode&quot;, &quot;RtlHardcoded&quot;, &quot;DiscouragedApi&quot;)
     fun applyTheme(viewModel: View, view: TextView) {
<a href="#h16-0-9" id="h16-0-9" class="i">+        val snapchatFontResId = view.context.resources.getIdentifier(&quot;avenir_next_medium&quot;, &quot;font&quot;, &quot;com.snapchat.android&quot;)
</a>         //remove the shadow
         view.setBackgroundColor(0x00000000)
         view.setTextColor(viewModel.resources.getColor(viewModel.resources.getIdentifier(&quot;sig_color_text_primary_light&quot;, &quot;color&quot;, Constants.SNAPCHAT_PACKAGE_NAME), null))
<a href="#h16-0-13" id="h16-0-13" class="d">-        view.setShadowLayer(0f, 0f, 0f, 0)
</a><a href="#h16-0-14" id="h16-0-14" class="i">+        view.setShadowLayer(0F, 0F, 0F, 0)
</a>         view.outlineProvider = null
         view.gravity = Gravity.LEFT or Gravity.CENTER_VERTICAL
         view.width = viewModel.width
<a href="#h16-0-18" id="h16-0-18" class="d">-        //FIXME: hardcoded dimensions
</a><a href="#h16-0-19" id="h16-0-19" class="d">-        view.height = 160
</a><a href="#h16-0-20" id="h16-0-20" class="d">-        view.setPadding(35, 0, 55, 0)
</a><a href="#h16-0-21" id="h16-0-21" class="i">+
</a><a href="#h16-0-22" id="h16-0-22" class="i">+        //DPI Calculator
</a><a href="#h16-0-23" id="h16-0-23" class="i">+        val scalingFactor = view.context.resources.displayMetrics.densityDpi.toDouble() / 400
</a><a href="#h16-0-24" id="h16-0-24" class="i">+        view.height = (150 * scalingFactor).toInt()
</a><a href="#h16-0-25" id="h16-0-25" class="i">+        view.setPadding((40 * scalingFactor).toInt(), 0, (25 * scalingFactor).toInt(), 0)
</a>         view.isAllCaps = false
<a href="#h16-0-27" id="h16-0-27" class="d">-        view.textSize = 15f
</a><a href="#h16-0-28" id="h16-0-28" class="d">-        view.typeface = Typeface.DEFAULT
</a><a href="#h16-0-29" id="h16-0-29" class="i">+        view.textSize = 16f
</a><a href="#h16-0-30" id="h16-0-30" class="i">+        view.typeface = view.context.resources.getFont(snapchatFontResId)
</a> 
         //remove click effect
         if (view.javaClass == TextView::class.java) {
<b>diff --git a/<a id="h17" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -2,9 +2,8 @@ package me.rhunk.snapenhance.features.impl.ui.menus.impl
</a> 
 import android.annotation.SuppressLint
 import android.content.res.Resources
<a href="#h17-0-3" id="h17-0-3" class="d">-import android.graphics.BlendMode
</a><a href="#h17-0-4" id="h17-0-4" class="d">-import android.graphics.BlendModeColorFilter
</a> import android.graphics.Color
<a href="#h17-0-6" id="h17-0-6" class="i">+import android.graphics.drawable.ColorDrawable
</a> import android.os.SystemClock
 import android.util.TypedValue
 import android.view.MotionEvent
<a href="#h17-1" id="h17-1" class="h">@@ -27,7 +26,7 @@ class ChatActionMenu : AbstractMenu() {
</a>     }
 
     private fun applyButtonTheme(parent: View, button: Button) {
<a href="#h17-1-3" id="h17-1-3" class="d">-        button.background.colorFilter = BlendModeColorFilter(Color.WHITE, BlendMode.SRC_ATOP)
</a><a href="#h17-1-4" id="h17-1-4" class="i">+        button.background = ColorDrawable(Color.WHITE)
</a>         button.setTextColor(Color.BLACK)
         button.transformationMethod = null
         val margin = TypedValue.applyDimension(
<b>diff --git a/<a id="h18" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -22,7 +22,7 @@ import me.rhunk.snapenhance.database.objects.UserConversationLink
</a> import me.rhunk.snapenhance.features.impl.Messaging
 import me.rhunk.snapenhance.features.impl.downloader.AntiAutoDownload
 import me.rhunk.snapenhance.features.impl.extras.AntiAutoSave
<a href="#h18-0-3" id="h18-0-3" class="d">-import me.rhunk.snapenhance.features.impl.spy.StealthMode
</a><a href="#h18-0-4" id="h18-0-4" class="i">+import me.rhunk.snapenhance.features.impl.spying.StealthMode
</a> import me.rhunk.snapenhance.features.impl.ui.menus.AbstractMenu
 import me.rhunk.snapenhance.features.impl.ui.menus.ViewAppearanceHelper.applyTheme
 import java.net.HttpURLConnection
<b>diff --git a/<a id="h19" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -2,6 +2,7 @@ package me.rhunk.snapenhance.features.impl.ui.menus.impl
</a> 
 import android.annotation.SuppressLint
 import android.app.AlertDialog
<a href="#h19-0-3" id="h19-0-3" class="i">+import android.graphics.Typeface
</a> import android.text.InputType
 import android.view.View
 import android.widget.Button
<a href="#h19-1" id="h19-1" class="h">@@ -24,7 +25,8 @@ class SettingsMenu : AbstractMenu() {
</a>         val categoryText = TextView(viewModel.context)
         categoryText.text = context.translation.get(key)
         ViewAppearanceHelper.applyTheme(viewModel, categoryText)
<a href="#h19-1-3" id="h19-1-3" class="d">-        categoryText.textSize = 18f
</a><a href="#h19-1-4" id="h19-1-4" class="i">+        categoryText.textSize = 20f
</a><a href="#h19-1-5" id="h19-1-5" class="i">+        categoryText.typeface = categoryText.typeface?.let { Typeface.create(it, Typeface.BOLD) }
</a>         return categoryText
     }
 
<a href="#h19-2" id="h19-2" class="h">@@ -33,6 +35,9 @@ class SettingsMenu : AbstractMenu() {
</a>         val updateButtonText: (TextView, String) -&gt; Unit = { textView, text -&gt;
             textView.text = &quot;${context.translation.get(property.nameKey)} $text&quot;
         }
<a href="#h19-2-3" id="h19-2-3" class="i">+        val updateStateSelectionText: (TextView, String) -&gt; Unit = { textView, text -&gt;
</a><a href="#h19-2-4" id="h19-2-4" class="i">+            updateButtonText(textView, text.let { if (it.isEmpty()) &quot;(empty)&quot; else &quot;: $it&quot; })
</a><a href="#h19-2-5" id="h19-2-5" class="i">+        }
</a> 
         val textEditor: ((String) -&gt; Unit) -&gt; Unit = { updateValue -&gt;
             val builder = AlertDialog.Builder(viewModel.context)
<a href="#h19-3" id="h19-3" class="h">@@ -116,7 +121,7 @@ class SettingsMenu : AbstractMenu() {
</a>             }
             is ConfigStateListValue -&gt; {
                 val button = Button(viewModel.context)
<a href="#h19-3-3" id="h19-3-3" class="d">-                updateButtonText(button, property.valueContainer.toString())
</a><a href="#h19-3-4" id="h19-3-4" class="i">+                updateStateSelectionText(button, property.valueContainer.toString())
</a> 
                 button.setOnClickListener {_ -&gt;
                     val builder = AlertDialog.Builder(viewModel.context)
<a href="#h19-4" id="h19-4" class="h">@@ -134,7 +139,7 @@ class SettingsMenu : AbstractMenu() {
</a>                     }
 
                     builder.setPositiveButton(&quot;OK&quot;) { _, _ -&gt;
<a href="#h19-4-3" id="h19-4-3" class="d">-                        updateButtonText(button, property.valueContainer.toString())
</a><a href="#h19-4-4" id="h19-4-4" class="i">+                        updateStateSelectionText(button, property.valueContainer.toString())
</a>                     }
 
                     builder.show()
<a href="#h19-5" id="h19-5" class="h">@@ -177,7 +182,8 @@ class SettingsMenu : AbstractMenu() {
</a>             }
         }
 
<a href="#h19-5-3" id="h19-5-3" class="d">-        //actions
</a><a href="#h19-5-4" id="h19-5-4" class="i">+        addView(createCategoryTitle(viewModel, &quot;category.debugging&quot;))
</a><a href="#h19-5-5" id="h19-5-5" class="i">+
</a>         context.actionManager.getActions().forEach {
             val button = Button(viewModel.context)
             button.text = context.translation.get(it.nameKey)
<b>diff --git a/<a id="h20" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -20,10 +20,10 @@ import me.rhunk.snapenhance.features.impl.extras.SnapchatPlus
</a> import me.rhunk.snapenhance.features.impl.extras.UnlimitedSnapViewTime
 import me.rhunk.snapenhance.features.impl.privacy.DisableMetrics
 import me.rhunk.snapenhance.features.impl.privacy.PreventMessageSending
<a href="#h20-0-3" id="h20-0-3" class="d">-import me.rhunk.snapenhance.features.impl.spy.AnonymousStoryViewing
</a><a href="#h20-0-4" id="h20-0-4" class="d">-import me.rhunk.snapenhance.features.impl.spy.MessageLogger
</a><a href="#h20-0-5" id="h20-0-5" class="d">-import me.rhunk.snapenhance.features.impl.spy.PreventReadReceipts
</a><a href="#h20-0-6" id="h20-0-6" class="d">-import me.rhunk.snapenhance.features.impl.spy.StealthMode
</a><a href="#h20-0-7" id="h20-0-7" class="i">+import me.rhunk.snapenhance.features.impl.spying.AnonymousStoryViewing
</a><a href="#h20-0-8" id="h20-0-8" class="i">+import me.rhunk.snapenhance.features.impl.spying.MessageLogger
</a><a href="#h20-0-9" id="h20-0-9" class="i">+import me.rhunk.snapenhance.features.impl.spying.PreventReadReceipts
</a><a href="#h20-0-10" id="h20-0-10" class="i">+import me.rhunk.snapenhance.features.impl.spying.StealthMode
</a> import me.rhunk.snapenhance.features.impl.ui.UITweaks
 import me.rhunk.snapenhance.features.impl.ui.menus.MenuViewInjector
 import me.rhunk.snapenhance.manager.Manager
<a href="#h20-1" id="h20-1" class="h">@@ -37,7 +37,6 @@ class FeatureManager(private val context: ModContext) : Manager {
</a>     private fun register(featureClass: KClass&lt;out Feature&gt;) {
         runCatching {
             with(featureClass.java.newInstance()) {
<a href="#h20-1-3" id="h20-1-3" class="d">-                if (loadParams and FeatureLoadParams.NO_INIT != 0) return@with
</a>                 context = this@FeatureManager.context
                 features.add(this)
             }
</pre>
</div>
</body>
</html>
