<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: permission screen - single context coroutine scope - refactor activity launcher helper - move updater to home section - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/6b9938b8b2702a10164ae9e05a67308aaa9409eb.html">6b9938b8b2702a10164ae9e05a67308aaa9409eb</a>
<b>parent</b> <a href="../commit/a3edd40cfbb188ee21ddf2233092aab2ce304aee.html">a3edd40cfbb188ee21ddf2233092aab2ce304aee</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Fri,  1 Sep 2023 18:15:40 +0200

feat: permission screen
- single context coroutine scope
- refactor activity launcher helper
- move updater to home section

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/InstallationSummary.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/Updater.kt</a></td><td> | </td><td class="num">32</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a></td><td> | </td><td class="num">131</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PermissionsScreen.kt</a></td><td> | </td><td class="num">116</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt</a></td><td> | </td><td class="num">57</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a></td><td> | </td><td class="num">1</td><td><span class="i"></span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a></td><td> | </td><td class="num">2</td><td><span class="i"></span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h13">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></td><td> | </td><td class="num">115</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">+</span><span class="d">---</span></td></tr>
</table></pre><pre>15 files changed, 299 insertions(+), 187 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -14,6 +14,7 @@ import coil.ImageLoader
</a> import coil.decode.VideoFrameDecoder
 import coil.disk.DiskCache
 import coil.memory.MemoryCache
<a href="#h0-0-3" id="h0-0-3" class="i">+import kotlinx.coroutines.CoroutineScope
</a> import kotlinx.coroutines.Dispatchers
 import me.rhunk.snapenhance.bridge.BridgeService
 import me.rhunk.snapenhance.core.BuildConfig
<a href="#h0-1" id="h0-1" class="h">@@ -71,6 +72,7 @@ class RemoteSideContext(
</a>             }
             .components { add(VideoFrameDecoder.Factory()) }.build()
     }
<a href="#h0-1-3" id="h0-1-3" class="i">+    val coroutineScope = CoroutineScope(Dispatchers.IO)
</a> 
     fun reload() {
         runCatching {
<a href="#h0-2" id="h0-2" class="h">@@ -103,7 +105,7 @@ class RemoteSideContext(
</a>                 )
             },
             modInfo = ModInfo(
<a href="#h0-2-3" id="h0-2-3" class="d">-                loaderPackageName = MainActivity::class.java.`package`?.name ?: &quot;unknown&quot;,
</a><a href="#h0-2-4" id="h0-2-4" class="i">+                loaderPackageName = MainActivity::class.java.`package`?.name,
</a>                 buildPackageName = BuildConfig.APPLICATION_ID,
                 buildVersion = BuildConfig.VERSION_NAME,
                 buildVersionCode = BuildConfig.VERSION_CODE.toLong(),
<a href="#h0-3" id="h0-3" class="h">@@ -119,7 +121,6 @@ class RemoteSideContext(
</a>             ),
             platformInfo = PlatformInfo(
                 device = Build.DEVICE,
<a href="#h0-3-3" id="h0-3-3" class="d">-                buildFingerprint = Build.FINGERPRINT,
</a>                 androidVersion = Build.VERSION.RELEASE,
                 systemAbi = Build.SUPPORTED_ABIS.firstOrNull() ?: &quot;unknown&quot;
             )
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -316,7 +316,7 @@ class DownloadProcessor (
</a>     }
 
     fun onReceive(intent: Intent) {
<a href="#h1-0-3" id="h1-0-3" class="d">-        CoroutineScope(Dispatchers.IO).launch {
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        remoteSideContext.coroutineScope.launch {
</a>             val downloadMetadata = gson.fromJson(intent.getStringExtra(DownloadManagerClient.DOWNLOAD_METADATA_EXTRA)!!, DownloadMetadata::class.java)
             val downloadRequest = gson.fromJson(intent.getStringExtra(DownloadManagerClient.DOWNLOAD_REQUEST_EXTRA)!!, DownloadRequest::class.java)
 
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/StreaksReminder.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -9,8 +9,6 @@ import android.content.Context
</a> import android.content.Intent
 import androidx.core.app.NotificationCompat
 import androidx.core.graphics.drawable.toBitmap
<a href="#h2-0-3" id="h2-0-3" class="d">-import kotlinx.coroutines.CoroutineScope
</a><a href="#h2-0-4" id="h2-0-4" class="d">-import kotlinx.coroutines.Dispatchers
</a> import kotlinx.coroutines.launch
 import me.rhunk.snapenhance.R
 import me.rhunk.snapenhance.RemoteSideContext
<a href="#h2-1" id="h2-1" class="h">@@ -26,8 +24,6 @@ class StreaksReminder(
</a>         private const val NOTIFICATION_CHANNEL_ID = &quot;streaks&quot;
     }
 
<a href="#h2-1-3" id="h2-1-3" class="d">-    private val coroutineScope = CoroutineScope(Dispatchers.IO)
</a><a href="#h2-1-4" id="h2-1-4" class="d">-
</a>     private fun getNotificationManager(context: Context) = context.getSystemService(NotificationManager::class.java).apply {
         createNotificationChannel(
             NotificationChannel(
<a href="#h2-2" id="h2-2" class="h">@@ -65,7 +61,7 @@ class StreaksReminder(
</a>         }
 
         notifyFriendList.forEach { (streaks, friend) -&gt;
<a href="#h2-2-3" id="h2-2-3" class="d">-            coroutineScope.launch {
</a><a href="#h2-2-4" id="h2-2-4" class="i">+            remoteSideContext.coroutineScope.launch {
</a>                 val bitmojiUrl = BitmojiSelfie.getBitmojiSelfie(friend.selfieId, friend.bitmojiId, BitmojiSelfie.BitmojiSelfieType.THREE_D)
                 val bitmojiImage = remoteSideContext.imageLoader.execute(
                     ImageRequestHelper.newBitmojiImageRequest(ctx, bitmojiUrl)
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/InstallationSummary.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/InstallationSummary.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/InstallationSummary.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/InstallationSummary.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -10,7 +10,7 @@ data class SnapchatAppInfo(
</a> )
 
 data class ModInfo(
<a href="#h3-0-3" id="h3-0-3" class="d">-    val loaderPackageName: String,
</a><a href="#h3-0-4" id="h3-0-4" class="i">+    val loaderPackageName: String?,
</a>     val buildPackageName: String,
     val buildVersion: String,
     val buildVersionCode: Long,
<a href="#h3-1" id="h3-1" class="h">@@ -22,7 +22,6 @@ data class ModInfo(
</a> 
 data class PlatformInfo(
     val device: String,
<a href="#h3-1-3" id="h3-1-3" class="d">-    val buildFingerprint: String,
</a>     val androidVersion: String,
     val systemAbi: String,
 )
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/Updater.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/Updater.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/Updater.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/data/Updater.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,31 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.data
</a><a href="#h4-0-1" id="h4-0-1" class="i">+
</a><a href="#h4-0-2" id="h4-0-2" class="i">+import com.google.gson.JsonParser
</a><a href="#h4-0-3" id="h4-0-3" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h4-0-4" id="h4-0-4" class="i">+import okhttp3.OkHttpClient
</a><a href="#h4-0-5" id="h4-0-5" class="i">+import okhttp3.Request
</a><a href="#h4-0-6" id="h4-0-6" class="i">+
</a><a href="#h4-0-7" id="h4-0-7" class="i">+
</a><a href="#h4-0-8" id="h4-0-8" class="i">+object Updater {
</a><a href="#h4-0-9" id="h4-0-9" class="i">+    data class LatestRelease(
</a><a href="#h4-0-10" id="h4-0-10" class="i">+        val versionName: String,
</a><a href="#h4-0-11" id="h4-0-11" class="i">+        val releaseUrl: String
</a><a href="#h4-0-12" id="h4-0-12" class="i">+    )
</a><a href="#h4-0-13" id="h4-0-13" class="i">+
</a><a href="#h4-0-14" id="h4-0-14" class="i">+    fun checkForLatestRelease(): LatestRelease? {
</a><a href="#h4-0-15" id="h4-0-15" class="i">+        val endpoint = Request.Builder().url(&quot;https://api.github.com/repos/rhunk/SnapEnhance/releases&quot;).build()
</a><a href="#h4-0-16" id="h4-0-16" class="i">+        val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h4-0-17" id="h4-0-17" class="i">+
</a><a href="#h4-0-18" id="h4-0-18" class="i">+        if (!response.isSuccessful) throw Throwable(&quot;Failed to fetch releases: ${response.code}&quot;)
</a><a href="#h4-0-19" id="h4-0-19" class="i">+
</a><a href="#h4-0-20" id="h4-0-20" class="i">+        val releases = JsonParser.parseString(response.body.string()).asJsonArray.also {
</a><a href="#h4-0-21" id="h4-0-21" class="i">+            if (it.size() == 0) throw Throwable(&quot;No releases found&quot;)
</a><a href="#h4-0-22" id="h4-0-22" class="i">+        }
</a><a href="#h4-0-23" id="h4-0-23" class="i">+
</a><a href="#h4-0-24" id="h4-0-24" class="i">+        val latestRelease = releases.get(0).asJsonObject
</a><a href="#h4-0-25" id="h4-0-25" class="i">+        val latestVersion = latestRelease.getAsJsonPrimitive(&quot;tag_name&quot;).asString
</a><a href="#h4-0-26" id="h4-0-26" class="i">+        if (latestVersion.removePrefix(&quot;v&quot;) == BuildConfig.VERSION_NAME) return null
</a><a href="#h4-0-27" id="h4-0-27" class="i">+
</a><a href="#h4-0-28" id="h4-0-28" class="i">+        return LatestRelease(latestVersion, endpoint.url.toString().replace(&quot;api.&quot;, &quot;&quot;).replace(&quot;repos/&quot;, &quot;&quot;))
</a><a href="#h4-0-29" id="h4-0-29" class="i">+    }
</a><a href="#h4-0-30" id="h4-0-30" class="i">+}</a><a href="#h4-0-31" id="h4-0-31" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -50,7 +50,6 @@ import androidx.compose.ui.text.style.TextOverflow
</a> import androidx.compose.ui.unit.dp
 import androidx.compose.ui.unit.sp
 import coil.compose.rememberAsyncImagePainter
<a href="#h5-0-3" id="h5-0-3" class="d">-import kotlinx.coroutines.CoroutineScope
</a> import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.future.asCompletableFuture
 import kotlinx.coroutines.launch
<a href="#h5-1" id="h5-1" class="h">@@ -64,11 +63,10 @@ import me.rhunk.snapenhance.ui.util.ImageRequestHelper
</a> class DownloadsSection : Section() {
     private val loadedDownloads = mutableStateOf(mapOf&lt;Int, DownloadObject&gt;())
     private var currentFilter = mutableStateOf(MediaDownloadSource.NONE)
<a href="#h5-1-3" id="h5-1-3" class="d">-    private val coroutineScope = CoroutineScope(Dispatchers.IO)
</a> 
     override fun onResumed() {
         super.onResumed()
<a href="#h5-1-7" id="h5-1-7" class="d">-        coroutineScope.launch {
</a><a href="#h5-1-8" id="h5-1-8" class="i">+        context.coroutineScope.launch {
</a>             loadByFilter(currentFilter.value)
         }
     }
<a href="#h5-2" id="h5-2" class="h">@@ -129,7 +127,7 @@ class DownloadsSection : Section() {
</a>                         }
                    },
                     onClick = {
<a href="#h5-2-3" id="h5-2-3" class="d">-                        coroutineScope.launch {
</a><a href="#h5-2-4" id="h5-2-4" class="i">+                        context.coroutineScope.launch {
</a>                             loadByFilter(filter)
                             showMenu = false
                         }
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,5 +1,6 @@
</a> package me.rhunk.snapenhance.ui.manager.sections.home
 
<a href="#h6-0-2" id="h6-0-2" class="i">+import android.content.Intent
</a> import android.net.Uri
 import androidx.compose.foundation.Image
 import androidx.compose.foundation.ScrollState
<a href="#h6-1" id="h6-1" class="h">@@ -48,9 +49,11 @@ import androidx.compose.ui.unit.sp
</a> import androidx.navigation.NavGraphBuilder
 import androidx.navigation.compose.composable
 import androidx.navigation.navigation
<a href="#h6-1-3" id="h6-1-3" class="i">+import kotlinx.coroutines.launch
</a> import me.rhunk.snapenhance.R
 import me.rhunk.snapenhance.ui.manager.Section
 import me.rhunk.snapenhance.ui.manager.data.InstallationSummary
<a href="#h6-1-7" id="h6-1-7" class="i">+import me.rhunk.snapenhance.ui.manager.data.Updater
</a> import me.rhunk.snapenhance.ui.setup.Requirements
 import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
 import me.rhunk.snapenhance.ui.util.saveFile
<a href="#h6-2" id="h6-2" class="h">@@ -64,9 +67,10 @@ class HomeSection : Section() {
</a>         const val LOGS_SECTION_ROUTE = &quot;home_logs&quot;
     }
 
<a href="#h6-2-3" id="h6-2-3" class="d">-    private val installationSummary = mutableStateOf(null as InstallationSummary?)
</a><a href="#h6-2-4" id="h6-2-4" class="d">-    private val userLocale = mutableStateOf(null as String?)
</a><a href="#h6-2-5" id="h6-2-5" class="i">+    private var installationSummary: InstallationSummary? = null
</a><a href="#h6-2-6" id="h6-2-6" class="i">+    private var userLocale: String? = null
</a>     private val homeSubSection by lazy { HomeSubSection(context) }
<a href="#h6-2-8" id="h6-2-8" class="i">+    private var latestUpdate: Updater.LatestRelease? = null
</a>     private lateinit var activityLauncherHelper: ActivityLauncherHelper
 
     override fun init() {
<a href="#h6-3" id="h6-3" class="h">@@ -100,42 +104,16 @@ class HomeSection : Section() {
</a> 
     @Composable
     private fun SummaryCards(installationSummary: InstallationSummary) {
<a href="#h6-3-3" id="h6-3-3" class="d">-        OutlinedCard(
</a><a href="#h6-3-4" id="h6-3-4" class="d">-            modifier = Modifier
</a><a href="#h6-3-5" id="h6-3-5" class="d">-                .padding(all = cardMargin)
</a><a href="#h6-3-6" id="h6-3-6" class="d">-                .fillMaxWidth()
</a><a href="#h6-3-7" id="h6-3-7" class="d">-        ) {
</a><a href="#h6-3-8" id="h6-3-8" class="d">-            SummaryCardRow(
</a><a href="#h6-3-9" id="h6-3-9" class="d">-                icon = Icons.Filled.Map,
</a><a href="#h6-3-10" id="h6-3-10" class="d">-                title = if (installationSummary.modInfo == null || installationSummary.modInfo.mappingsOutdated == true) {
</a><a href="#h6-3-11" id="h6-3-11" class="d">-                    &quot;Mappings ${if (installationSummary.modInfo == null) &quot;not generated&quot; else &quot;outdated&quot;}&quot;
</a><a href="#h6-3-12" id="h6-3-12" class="d">-                } else {
</a><a href="#h6-3-13" id="h6-3-13" class="d">-                    &quot;Mappings version ${installationSummary.modInfo.mappingVersion}&quot;
</a><a href="#h6-3-14" id="h6-3-14" class="d">-                }
</a><a href="#h6-3-15" id="h6-3-15" class="d">-            ) {
</a><a href="#h6-3-16" id="h6-3-16" class="d">-                Button(onClick = {
</a><a href="#h6-3-17" id="h6-3-17" class="d">-                    context.checkForRequirements(Requirements.MAPPINGS)
</a><a href="#h6-3-18" id="h6-3-18" class="d">-                }, modifier = Modifier.height(40.dp)) {
</a><a href="#h6-3-19" id="h6-3-19" class="d">-                    Icon(Icons.Filled.Refresh, contentDescription = null)
</a><a href="#h6-3-20" id="h6-3-20" class="d">-                }
</a><a href="#h6-3-21" id="h6-3-21" class="d">-            }
</a><a href="#h6-3-22" id="h6-3-22" class="d">-
</a><a href="#h6-3-23" id="h6-3-23" class="d">-            SummaryCardRow(icon = Icons.Filled.Language, title = userLocale.value ?: &quot;Unknown&quot;) {
</a><a href="#h6-3-24" id="h6-3-24" class="d">-                Button(onClick = {
</a><a href="#h6-3-25" id="h6-3-25" class="d">-                    context.checkForRequirements(Requirements.LANGUAGE)
</a><a href="#h6-3-26" id="h6-3-26" class="d">-                }, modifier = Modifier.height(40.dp)) {
</a><a href="#h6-3-27" id="h6-3-27" class="d">-                    Icon(Icons.Filled.OpenInNew, contentDescription = null)
</a><a href="#h6-3-28" id="h6-3-28" class="d">-                }
</a><a href="#h6-3-29" id="h6-3-29" class="d">-            }
</a><a href="#h6-3-30" id="h6-3-30" class="d">-        }
</a><a href="#h6-3-31" id="h6-3-31" class="d">-
</a>         val summaryInfo = remember {
             mapOf(
                 &quot;Build Issuer&quot; to (installationSummary.modInfo?.buildIssuer ?: &quot;Unknown&quot;),
<a href="#h6-3-35" id="h6-3-35" class="i">+                &quot;Build Type&quot; to (if (installationSummary.modInfo?.isDebugBuild == true) &quot;debug&quot; else &quot;release&quot;),
</a><a href="#h6-3-36" id="h6-3-36" class="i">+                &quot;Build Version&quot; to (installationSummary.modInfo?.buildVersion ?: &quot;Unknown&quot;),
</a><a href="#h6-3-37" id="h6-3-37" class="i">+                &quot;Build Package&quot; to (installationSummary.modInfo?.buildPackageName ?: &quot;Unknown&quot;),
</a><a href="#h6-3-38" id="h6-3-38" class="i">+                &quot;Activity Package&quot; to (installationSummary.modInfo?.loaderPackageName ?: &quot;Unknown&quot;),
</a>                 &quot;Device&quot; to installationSummary.platformInfo.device,
<a href="#h6-3-40" id="h6-3-40" class="d">-                &quot;Android version&quot; to installationSummary.platformInfo.androidVersion,
</a><a href="#h6-3-41" id="h6-3-41" class="d">-                &quot;System ABI&quot; to installationSummary.platformInfo.systemAbi,
</a><a href="#h6-3-42" id="h6-3-42" class="d">-                &quot;Build fingerprint&quot; to installationSummary.platformInfo.buildFingerprint
</a><a href="#h6-3-43" id="h6-3-43" class="i">+                &quot;Android Version&quot; to installationSummary.platformInfo.androidVersion,
</a><a href="#h6-3-44" id="h6-3-44" class="i">+                &quot;System ABI&quot; to installationSummary.platformInfo.systemAbi
</a>             )
         }
 
<a href="#h6-4" id="h6-4" class="h">@@ -172,7 +150,35 @@ class HomeSection : Section() {
</a>                     }
                 }
             }
<a href="#h6-4-3" id="h6-4-3" class="i">+        }
</a><a href="#h6-4-4" id="h6-4-4" class="i">+
</a><a href="#h6-4-5" id="h6-4-5" class="i">+        OutlinedCard(
</a><a href="#h6-4-6" id="h6-4-6" class="i">+            modifier = Modifier
</a><a href="#h6-4-7" id="h6-4-7" class="i">+                .padding(all = cardMargin)
</a><a href="#h6-4-8" id="h6-4-8" class="i">+                .fillMaxWidth()
</a><a href="#h6-4-9" id="h6-4-9" class="i">+        ) {
</a><a href="#h6-4-10" id="h6-4-10" class="i">+            SummaryCardRow(
</a><a href="#h6-4-11" id="h6-4-11" class="i">+                icon = Icons.Filled.Map,
</a><a href="#h6-4-12" id="h6-4-12" class="i">+                title = if (installationSummary.modInfo == null || installationSummary.modInfo.mappingsOutdated == true) {
</a><a href="#h6-4-13" id="h6-4-13" class="i">+                    &quot;Mappings ${if (installationSummary.modInfo == null) &quot;not generated&quot; else &quot;outdated&quot;}&quot;
</a><a href="#h6-4-14" id="h6-4-14" class="i">+                } else {
</a><a href="#h6-4-15" id="h6-4-15" class="i">+                    &quot;Mappings version ${installationSummary.modInfo.mappingVersion}&quot;
</a><a href="#h6-4-16" id="h6-4-16" class="i">+                }
</a><a href="#h6-4-17" id="h6-4-17" class="i">+            ) {
</a><a href="#h6-4-18" id="h6-4-18" class="i">+                Button(onClick = {
</a><a href="#h6-4-19" id="h6-4-19" class="i">+                    context.checkForRequirements(Requirements.MAPPINGS)
</a><a href="#h6-4-20" id="h6-4-20" class="i">+                }, modifier = Modifier.height(40.dp)) {
</a><a href="#h6-4-21" id="h6-4-21" class="i">+                    Icon(Icons.Filled.Refresh, contentDescription = null)
</a><a href="#h6-4-22" id="h6-4-22" class="i">+                }
</a><a href="#h6-4-23" id="h6-4-23" class="i">+            }
</a> 
<a href="#h6-4-25" id="h6-4-25" class="i">+            SummaryCardRow(icon = Icons.Filled.Language, title = userLocale ?: &quot;Unknown&quot;) {
</a><a href="#h6-4-26" id="h6-4-26" class="i">+                Button(onClick = {
</a><a href="#h6-4-27" id="h6-4-27" class="i">+                    context.checkForRequirements(Requirements.LANGUAGE)
</a><a href="#h6-4-28" id="h6-4-28" class="i">+                }, modifier = Modifier.height(40.dp)) {
</a><a href="#h6-4-29" id="h6-4-29" class="i">+                    Icon(Icons.Filled.OpenInNew, contentDescription = null)
</a><a href="#h6-4-30" id="h6-4-30" class="i">+                }
</a><a href="#h6-4-31" id="h6-4-31" class="i">+            }
</a>         }
     }
 
<a href="#h6-5" id="h6-5" class="h">@@ -180,8 +186,19 @@ class HomeSection : Section() {
</a>         if (!context.mappings.isMappingsLoaded()) {
             context.mappings.init(context.androidContext)
         }
<a href="#h6-5-3" id="h6-5-3" class="d">-        installationSummary.value = context.installationSummary
</a><a href="#h6-5-4" id="h6-5-4" class="d">-        userLocale.value = context.translation.loadedLocale.getDisplayName(Locale.getDefault())
</a><a href="#h6-5-5" id="h6-5-5" class="i">+        context.coroutineScope.launch {
</a><a href="#h6-5-6" id="h6-5-6" class="i">+            userLocale = context.translation.loadedLocale.getDisplayName(Locale.getDefault())
</a><a href="#h6-5-7" id="h6-5-7" class="i">+            runCatching {
</a><a href="#h6-5-8" id="h6-5-8" class="i">+                installationSummary = context.installationSummary
</a><a href="#h6-5-9" id="h6-5-9" class="i">+            }.onFailure {
</a><a href="#h6-5-10" id="h6-5-10" class="i">+                context.longToast(&quot;SnapEnhance failed to load installation summary: ${it.message}&quot;)
</a><a href="#h6-5-11" id="h6-5-11" class="i">+            }
</a><a href="#h6-5-12" id="h6-5-12" class="i">+            runCatching {
</a><a href="#h6-5-13" id="h6-5-13" class="i">+                latestUpdate = Updater.checkForLatestRelease()
</a><a href="#h6-5-14" id="h6-5-14" class="i">+            }.onFailure {
</a><a href="#h6-5-15" id="h6-5-15" class="i">+                context.longToast(&quot;SnapEnhance failed to check for updates: ${it.message}&quot;)
</a><a href="#h6-5-16" id="h6-5-16" class="i">+            }
</a><a href="#h6-5-17" id="h6-5-17" class="i">+        }
</a>     }
 
     override fun sectionTopBarName(): String {
<a href="#h6-6" id="h6-6" class="h">@@ -304,13 +321,53 @@ class HomeSection : Section() {
</a>                 )
             }
 
<a href="#h6-6-3" id="h6-6-3" class="i">+            if (latestUpdate != null) {
</a><a href="#h6-6-4" id="h6-6-4" class="i">+                OutlinedCard(
</a><a href="#h6-6-5" id="h6-6-5" class="i">+                    modifier = Modifier
</a><a href="#h6-6-6" id="h6-6-6" class="i">+                        .padding(all = cardMargin)
</a><a href="#h6-6-7" id="h6-6-7" class="i">+                        .fillMaxWidth(),
</a><a href="#h6-6-8" id="h6-6-8" class="i">+                    colors = CardDefaults.cardColors(
</a><a href="#h6-6-9" id="h6-6-9" class="i">+                        containerColor = MaterialTheme.colorScheme.surfaceVariant,
</a><a href="#h6-6-10" id="h6-6-10" class="i">+                        contentColor = MaterialTheme.colorScheme.onSurfaceVariant
</a><a href="#h6-6-11" id="h6-6-11" class="i">+                    )
</a><a href="#h6-6-12" id="h6-6-12" class="i">+                ){
</a><a href="#h6-6-13" id="h6-6-13" class="i">+                    Row(
</a><a href="#h6-6-14" id="h6-6-14" class="i">+                        modifier = Modifier
</a><a href="#h6-6-15" id="h6-6-15" class="i">+                            .fillMaxWidth()
</a><a href="#h6-6-16" id="h6-6-16" class="i">+                            .padding(all = 15.dp),
</a><a href="#h6-6-17" id="h6-6-17" class="i">+                        horizontalArrangement = Arrangement.SpaceBetween
</a><a href="#h6-6-18" id="h6-6-18" class="i">+                    ) {
</a><a href="#h6-6-19" id="h6-6-19" class="i">+                        Column {
</a><a href="#h6-6-20" id="h6-6-20" class="i">+                            Text(
</a><a href="#h6-6-21" id="h6-6-21" class="i">+                                text = &quot;SnapEnhance Update&quot;,
</a><a href="#h6-6-22" id="h6-6-22" class="i">+                                fontSize = 14.sp,
</a><a href="#h6-6-23" id="h6-6-23" class="i">+                                fontWeight = FontWeight.Bold,
</a><a href="#h6-6-24" id="h6-6-24" class="i">+                            )
</a><a href="#h6-6-25" id="h6-6-25" class="i">+                            Text(
</a><a href="#h6-6-26" id="h6-6-26" class="i">+                                fontSize = 12.sp,
</a><a href="#h6-6-27" id="h6-6-27" class="i">+                                text = &quot;Version ${latestUpdate?.versionName} is available!&quot;,
</a><a href="#h6-6-28" id="h6-6-28" class="i">+                                lineHeight = 20.sp
</a><a href="#h6-6-29" id="h6-6-29" class="i">+                            )
</a><a href="#h6-6-30" id="h6-6-30" class="i">+                        }
</a><a href="#h6-6-31" id="h6-6-31" class="i">+                        Button(onClick = {
</a><a href="#h6-6-32" id="h6-6-32" class="i">+                            context.activity?.startActivity(
</a><a href="#h6-6-33" id="h6-6-33" class="i">+                                Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h6-6-34" id="h6-6-34" class="i">+                                    data = Uri.parse(latestUpdate?.releaseUrl)
</a><a href="#h6-6-35" id="h6-6-35" class="i">+                                }
</a><a href="#h6-6-36" id="h6-6-36" class="i">+                            )
</a><a href="#h6-6-37" id="h6-6-37" class="i">+                        }, modifier = Modifier.height(40.dp)) {
</a><a href="#h6-6-38" id="h6-6-38" class="i">+                            Text(text = &quot;Download&quot;)
</a><a href="#h6-6-39" id="h6-6-39" class="i">+                        }
</a><a href="#h6-6-40" id="h6-6-40" class="i">+                    }
</a><a href="#h6-6-41" id="h6-6-41" class="i">+                }
</a><a href="#h6-6-42" id="h6-6-42" class="i">+            }
</a> 
             Text(
                 text = &quot;An xposed module that enhances the Snapchat experience&quot;,
                 modifier = Modifier.padding(16.dp)
             )
 
<a href="#h6-6-49" id="h6-6-49" class="d">-            SummaryCards(installationSummary = installationSummary.value ?: return)
</a><a href="#h6-6-50" id="h6-6-50" class="i">+            SummaryCards(installationSummary = installationSummary ?: return)
</a>         }
     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -5,6 +5,7 @@ object Requirements {
</a>     const val LANGUAGE = 0b00010
     const val MAPPINGS = 0b00100
     const val SAVE_FOLDER = 0b01000
<a href="#h7-0-3" id="h7-0-3" class="i">+    const val GRANT_PERMISSIONS = 0b10000
</a> 
     fun getName(requirement: Int): String {
         return when (requirement) {
<a href="#h7-1" id="h7-1" class="h">@@ -12,6 +13,7 @@ object Requirements {
</a>             LANGUAGE -&gt; &quot;LANGUAGE&quot;
             MAPPINGS -&gt; &quot;MAPPINGS&quot;
             SAVE_FOLDER -&gt; &quot;SAVE_FOLDER&quot;
<a href="#h7-1-3" id="h7-1-3" class="i">+            GRANT_PERMISSIONS -&gt; &quot;GRANT_PERMISSIONS&quot;
</a>             else -&gt; &quot;UNKNOWN&quot;
         }
     }
<b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -36,6 +36,7 @@ import me.rhunk.snapenhance.SharedContextHolder
</a> import me.rhunk.snapenhance.ui.AppMaterialTheme
 import me.rhunk.snapenhance.ui.setup.screens.SetupScreen
 import me.rhunk.snapenhance.ui.setup.screens.impl.MappingsScreen
<a href="#h8-0-3" id="h8-0-3" class="i">+import me.rhunk.snapenhance.ui.setup.screens.impl.PermissionsScreen
</a> import me.rhunk.snapenhance.ui.setup.screens.impl.PickLanguageScreen
 import me.rhunk.snapenhance.ui.setup.screens.impl.SaveFolderScreen
 
<a href="#h8-1" id="h8-1" class="h">@@ -65,6 +66,9 @@ class SetupActivity : ComponentActivity() {
</a>             if (isFirstRun || hasRequirement(Requirements.LANGUAGE)) {
                 add(PickLanguageScreen().apply { route = &quot;language&quot; })
             }
<a href="#h8-1-3" id="h8-1-3" class="i">+            if (isFirstRun || hasRequirement(Requirements.GRANT_PERMISSIONS)) {
</a><a href="#h8-1-4" id="h8-1-4" class="i">+                add(PermissionsScreen().apply { route = &quot;permissions&quot; })
</a><a href="#h8-1-5" id="h8-1-5" class="i">+            }
</a>             if (isFirstRun || hasRequirement(Requirements.SAVE_FOLDER)) {
                 add(SaveFolderScreen().apply { route = &quot;saveFolder&quot; })
             }
<b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PermissionsScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PermissionsScreen.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PermissionsScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PermissionsScreen.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,115 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+package me.rhunk.snapenhance.ui.setup.screens.impl
</a><a href="#h9-0-1" id="h9-0-1" class="i">+
</a><a href="#h9-0-2" id="h9-0-2" class="i">+import android.Manifest
</a><a href="#h9-0-3" id="h9-0-3" class="i">+import android.annotation.SuppressLint
</a><a href="#h9-0-4" id="h9-0-4" class="i">+import android.content.Context
</a><a href="#h9-0-5" id="h9-0-5" class="i">+import android.content.Intent
</a><a href="#h9-0-6" id="h9-0-6" class="i">+import android.content.pm.PackageManager
</a><a href="#h9-0-7" id="h9-0-7" class="i">+import android.net.Uri
</a><a href="#h9-0-8" id="h9-0-8" class="i">+import android.os.Build
</a><a href="#h9-0-9" id="h9-0-9" class="i">+import android.os.PowerManager
</a><a href="#h9-0-10" id="h9-0-10" class="i">+import android.provider.Settings
</a><a href="#h9-0-11" id="h9-0-11" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h9-0-12" id="h9-0-12" class="i">+import androidx.compose.foundation.layout.Arrangement
</a><a href="#h9-0-13" id="h9-0-13" class="i">+import androidx.compose.foundation.layout.Column
</a><a href="#h9-0-14" id="h9-0-14" class="i">+import androidx.compose.foundation.layout.Row
</a><a href="#h9-0-15" id="h9-0-15" class="i">+import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h9-0-16" id="h9-0-16" class="i">+import androidx.compose.foundation.layout.padding
</a><a href="#h9-0-17" id="h9-0-17" class="i">+import androidx.compose.material3.Button
</a><a href="#h9-0-18" id="h9-0-18" class="i">+import androidx.compose.material3.OutlinedCard
</a><a href="#h9-0-19" id="h9-0-19" class="i">+import androidx.compose.material3.Text
</a><a href="#h9-0-20" id="h9-0-20" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h9-0-21" id="h9-0-21" class="i">+import androidx.compose.runtime.LaunchedEffect
</a><a href="#h9-0-22" id="h9-0-22" class="i">+import androidx.compose.runtime.getValue
</a><a href="#h9-0-23" id="h9-0-23" class="i">+import androidx.compose.runtime.mutableStateOf
</a><a href="#h9-0-24" id="h9-0-24" class="i">+import androidx.compose.runtime.remember
</a><a href="#h9-0-25" id="h9-0-25" class="i">+import androidx.compose.runtime.rememberCoroutineScope
</a><a href="#h9-0-26" id="h9-0-26" class="i">+import androidx.compose.runtime.setValue
</a><a href="#h9-0-27" id="h9-0-27" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h9-0-28" id="h9-0-28" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h9-0-29" id="h9-0-29" class="i">+import kotlinx.coroutines.launch
</a><a href="#h9-0-30" id="h9-0-30" class="i">+import me.rhunk.snapenhance.ui.setup.screens.SetupScreen
</a><a href="#h9-0-31" id="h9-0-31" class="i">+import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
</a><a href="#h9-0-32" id="h9-0-32" class="i">+
</a><a href="#h9-0-33" id="h9-0-33" class="i">+class PermissionsScreen : SetupScreen() {
</a><a href="#h9-0-34" id="h9-0-34" class="i">+    private lateinit var activityLauncherHelper: ActivityLauncherHelper
</a><a href="#h9-0-35" id="h9-0-35" class="i">+
</a><a href="#h9-0-36" id="h9-0-36" class="i">+    override fun init() {
</a><a href="#h9-0-37" id="h9-0-37" class="i">+        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h9-0-38" id="h9-0-38" class="i">+    }
</a><a href="#h9-0-39" id="h9-0-39" class="i">+
</a><a href="#h9-0-40" id="h9-0-40" class="i">+    @SuppressLint(&quot;BatteryLife&quot;)
</a><a href="#h9-0-41" id="h9-0-41" class="i">+    @Composable
</a><a href="#h9-0-42" id="h9-0-42" class="i">+    override fun Content() {
</a><a href="#h9-0-43" id="h9-0-43" class="i">+        var notificationPermissionGranted by remember { mutableStateOf(true) }
</a><a href="#h9-0-44" id="h9-0-44" class="i">+        var isBatteryOptimisationIgnored by remember { mutableStateOf(false) }
</a><a href="#h9-0-45" id="h9-0-45" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h9-0-46" id="h9-0-46" class="i">+
</a><a href="#h9-0-47" id="h9-0-47" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h9-0-48" id="h9-0-48" class="i">+            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {
</a><a href="#h9-0-49" id="h9-0-49" class="i">+                notificationPermissionGranted = context.androidContext.checkSelfPermission(Manifest.permission.POST_NOTIFICATIONS) == PackageManager.PERMISSION_GRANTED
</a><a href="#h9-0-50" id="h9-0-50" class="i">+            }
</a><a href="#h9-0-51" id="h9-0-51" class="i">+            val powerManager = context.androidContext.getSystemService(Context.POWER_SERVICE) as PowerManager
</a><a href="#h9-0-52" id="h9-0-52" class="i">+            isBatteryOptimisationIgnored = powerManager.isIgnoringBatteryOptimizations(context.androidContext.packageName)
</a><a href="#h9-0-53" id="h9-0-53" class="i">+        }
</a><a href="#h9-0-54" id="h9-0-54" class="i">+
</a><a href="#h9-0-55" id="h9-0-55" class="i">+        if (isBatteryOptimisationIgnored &amp;&amp; notificationPermissionGranted) {
</a><a href="#h9-0-56" id="h9-0-56" class="i">+            allowNext(true)
</a><a href="#h9-0-57" id="h9-0-57" class="i">+        } else {
</a><a href="#h9-0-58" id="h9-0-58" class="i">+            allowNext(false)
</a><a href="#h9-0-59" id="h9-0-59" class="i">+        }
</a><a href="#h9-0-60" id="h9-0-60" class="i">+
</a><a href="#h9-0-61" id="h9-0-61" class="i">+        DialogText(text = &quot;To continue you need to fit the following requirements:&quot;)
</a><a href="#h9-0-62" id="h9-0-62" class="i">+
</a><a href="#h9-0-63" id="h9-0-63" class="i">+        OutlinedCard(
</a><a href="#h9-0-64" id="h9-0-64" class="i">+            modifier = Modifier
</a><a href="#h9-0-65" id="h9-0-65" class="i">+                .padding(16.dp)
</a><a href="#h9-0-66" id="h9-0-66" class="i">+                .fillMaxWidth(),
</a><a href="#h9-0-67" id="h9-0-67" class="i">+        ) {
</a><a href="#h9-0-68" id="h9-0-68" class="i">+            Column(
</a><a href="#h9-0-69" id="h9-0-69" class="i">+                modifier = Modifier
</a><a href="#h9-0-70" id="h9-0-70" class="i">+                    .padding(5.dp)
</a><a href="#h9-0-71" id="h9-0-71" class="i">+            ) {
</a><a href="#h9-0-72" id="h9-0-72" class="i">+                Row(
</a><a href="#h9-0-73" id="h9-0-73" class="i">+                    horizontalArrangement = Arrangement.Absolute.SpaceAround
</a><a href="#h9-0-74" id="h9-0-74" class="i">+                ) {
</a><a href="#h9-0-75" id="h9-0-75" class="i">+                    DialogText(text = &quot;Notification access&quot;, modifier = Modifier.weight(1f))
</a><a href="#h9-0-76" id="h9-0-76" class="i">+                    if (notificationPermissionGranted) {
</a><a href="#h9-0-77" id="h9-0-77" class="i">+                        DialogText(text = &quot;Granted&quot;)
</a><a href="#h9-0-78" id="h9-0-78" class="i">+                    } else {
</a><a href="#h9-0-79" id="h9-0-79" class="i">+                        Button(onClick = {
</a><a href="#h9-0-80" id="h9-0-80" class="i">+                            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {
</a><a href="#h9-0-81" id="h9-0-81" class="i">+                                activityLauncherHelper.requestPermission(Manifest.permission.POST_NOTIFICATIONS) { resultCode, _ -&gt;
</a><a href="#h9-0-82" id="h9-0-82" class="i">+                                    coroutineScope.launch {
</a><a href="#h9-0-83" id="h9-0-83" class="i">+                                        notificationPermissionGranted = resultCode == ComponentActivity.RESULT_OK
</a><a href="#h9-0-84" id="h9-0-84" class="i">+                                    }
</a><a href="#h9-0-85" id="h9-0-85" class="i">+                                }
</a><a href="#h9-0-86" id="h9-0-86" class="i">+                            }
</a><a href="#h9-0-87" id="h9-0-87" class="i">+                        }) {
</a><a href="#h9-0-88" id="h9-0-88" class="i">+                            Text(text = &quot;Request&quot;)
</a><a href="#h9-0-89" id="h9-0-89" class="i">+                        }
</a><a href="#h9-0-90" id="h9-0-90" class="i">+                    }
</a><a href="#h9-0-91" id="h9-0-91" class="i">+                }
</a><a href="#h9-0-92" id="h9-0-92" class="i">+                Row {
</a><a href="#h9-0-93" id="h9-0-93" class="i">+                    DialogText(text = &quot;Battery optimisation&quot;, modifier = Modifier.weight(1f))
</a><a href="#h9-0-94" id="h9-0-94" class="i">+                    if (isBatteryOptimisationIgnored) {
</a><a href="#h9-0-95" id="h9-0-95" class="i">+                        DialogText(text = &quot;Ignored&quot;)
</a><a href="#h9-0-96" id="h9-0-96" class="i">+                    } else {
</a><a href="#h9-0-97" id="h9-0-97" class="i">+                        Button(onClick = {
</a><a href="#h9-0-98" id="h9-0-98" class="i">+                            activityLauncherHelper.launch(Intent().apply {
</a><a href="#h9-0-99" id="h9-0-99" class="i">+                                action = Settings.ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS
</a><a href="#h9-0-100" id="h9-0-100" class="i">+                                data = Uri.parse(&quot;package:${context.androidContext.packageName}&quot;)
</a><a href="#h9-0-101" id="h9-0-101" class="i">+                            }) { resultCode, _ -&gt;
</a><a href="#h9-0-102" id="h9-0-102" class="i">+                                coroutineScope.launch {
</a><a href="#h9-0-103" id="h9-0-103" class="i">+                                    isBatteryOptimisationIgnored = resultCode == 0
</a><a href="#h9-0-104" id="h9-0-104" class="i">+                                }
</a><a href="#h9-0-105" id="h9-0-105" class="i">+                            }
</a><a href="#h9-0-106" id="h9-0-106" class="i">+                        }) {
</a><a href="#h9-0-107" id="h9-0-107" class="i">+                            Text(text = &quot;Request&quot;)
</a><a href="#h9-0-108" id="h9-0-108" class="i">+                        }
</a><a href="#h9-0-109" id="h9-0-109" class="i">+                    }
</a><a href="#h9-0-110" id="h9-0-110" class="i">+                }
</a><a href="#h9-0-111" id="h9-0-111" class="i">+            }
</a><a href="#h9-0-112" id="h9-0-112" class="i">+        }
</a><a href="#h9-0-113" id="h9-0-113" class="i">+    }
</a><a href="#h9-0-114" id="h9-0-114" class="i">+}</a><a href="#h9-0-115" id="h9-0-115" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ActivityLauncherHelper.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -6,29 +6,47 @@ import androidx.activity.result.ActivityResultLauncher
</a> import androidx.activity.result.contract.ActivityResultContracts
 import me.rhunk.snapenhance.Logger
 
<a href="#h10-0-3" id="h10-0-3" class="i">+typealias ActivityLauncherCallback = (resultCode: Int, intent: Intent?) -&gt; Unit
</a><a href="#h10-0-4" id="h10-0-4" class="i">+
</a> class ActivityLauncherHelper(
<a href="#h10-0-6" id="h10-0-6" class="d">-    val activity: ComponentActivity
</a><a href="#h10-0-7" id="h10-0-7" class="i">+    val activity: ComponentActivity,
</a> ) {
<a href="#h10-0-9" id="h10-0-9" class="d">-    private var callback: ((Intent) -&gt; Unit)? = null
</a><a href="#h10-0-10" id="h10-0-10" class="i">+    private var callback: ActivityLauncherCallback? = null
</a><a href="#h10-0-11" id="h10-0-11" class="i">+    private var permissionResultLauncher: ActivityResultLauncher&lt;String&gt; =
</a><a href="#h10-0-12" id="h10-0-12" class="i">+        activity.registerForActivityResult(ActivityResultContracts.RequestPermission()) { result -&gt;
</a><a href="#h10-0-13" id="h10-0-13" class="i">+            runCatching {
</a><a href="#h10-0-14" id="h10-0-14" class="i">+                callback?.let { it(if (result) ComponentActivity.RESULT_OK else ComponentActivity.RESULT_CANCELED, null) }
</a><a href="#h10-0-15" id="h10-0-15" class="i">+            }.onFailure {
</a><a href="#h10-0-16" id="h10-0-16" class="i">+                Logger.directError(&quot;Failed to process activity result&quot;, it)
</a><a href="#h10-0-17" id="h10-0-17" class="i">+            }
</a><a href="#h10-0-18" id="h10-0-18" class="i">+            callback = null
</a><a href="#h10-0-19" id="h10-0-19" class="i">+        }
</a><a href="#h10-0-20" id="h10-0-20" class="i">+
</a>     private var activityResultLauncher: ActivityResultLauncher&lt;Intent&gt; =
         activity.registerForActivityResult(ActivityResultContracts.StartActivityForResult()) { result -&gt;
<a href="#h10-0-23" id="h10-0-23" class="d">-            if (result.resultCode == ComponentActivity.RESULT_OK) {
</a><a href="#h10-0-24" id="h10-0-24" class="d">-                runCatching {
</a><a href="#h10-0-25" id="h10-0-25" class="d">-                    callback?.let { it(result.data!!) }
</a><a href="#h10-0-26" id="h10-0-26" class="d">-                }.onFailure {
</a><a href="#h10-0-27" id="h10-0-27" class="d">-                    Logger.directError(&quot;Failed to process activity result&quot;, it)
</a><a href="#h10-0-28" id="h10-0-28" class="d">-                }
</a><a href="#h10-0-29" id="h10-0-29" class="i">+            runCatching {
</a><a href="#h10-0-30" id="h10-0-30" class="i">+                callback?.let { it(result.resultCode, result.data) }
</a><a href="#h10-0-31" id="h10-0-31" class="i">+            }.onFailure {
</a><a href="#h10-0-32" id="h10-0-32" class="i">+                Logger.directError(&quot;Failed to process activity result&quot;, it)
</a>             }
             callback = null
         }
 
<a href="#h10-0-37" id="h10-0-37" class="d">-    fun launch(intent: Intent, callback: (Intent) -&gt; Unit) {
</a><a href="#h10-0-38" id="h10-0-38" class="i">+    fun launch(intent: Intent, callback: ActivityLauncherCallback) {
</a>         if (this.callback != null) {
             throw IllegalStateException(&quot;Already launching an activity&quot;)
         }
         this.callback = callback
         activityResultLauncher.launch(intent)
     }
<a href="#h10-0-45" id="h10-0-45" class="i">+
</a><a href="#h10-0-46" id="h10-0-46" class="i">+    fun requestPermission(permission: String, callback: ActivityLauncherCallback) {
</a><a href="#h10-0-47" id="h10-0-47" class="i">+        if (this.callback != null) {
</a><a href="#h10-0-48" id="h10-0-48" class="i">+            throw IllegalStateException(&quot;Already launching an activity&quot;)
</a><a href="#h10-0-49" id="h10-0-49" class="i">+        }
</a><a href="#h10-0-50" id="h10-0-50" class="i">+        this.callback = callback
</a><a href="#h10-0-51" id="h10-0-51" class="i">+        permissionResultLauncher.launch(permission)
</a><a href="#h10-0-52" id="h10-0-52" class="i">+    }
</a> }
 
 fun ActivityLauncherHelper.chooseFolder(callback: (uri: String) -&gt; Unit) {
<a href="#h10-1" id="h10-1" class="h">@@ -36,8 +54,11 @@ fun ActivityLauncherHelper.chooseFolder(callback: (uri: String) -&gt; Unit) {
</a>         Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)
             .addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
             .addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
<a href="#h10-1-3" id="h10-1-3" class="d">-    ) {
</a><a href="#h10-1-4" id="h10-1-4" class="d">-        val uri = it.data ?: return@launch
</a><a href="#h10-1-5" id="h10-1-5" class="i">+    ) { resultCode, intent -&gt;
</a><a href="#h10-1-6" id="h10-1-6" class="i">+        if (resultCode != ComponentActivity.RESULT_OK) {
</a><a href="#h10-1-7" id="h10-1-7" class="i">+            return@launch
</a><a href="#h10-1-8" id="h10-1-8" class="i">+        }
</a><a href="#h10-1-9" id="h10-1-9" class="i">+        val uri = intent?.data ?: return@launch
</a>         val value = uri.toString()
         this.activity.contentResolver.takePersistableUriPermission(
             uri,
<a href="#h10-2" id="h10-2" class="h">@@ -55,8 +76,11 @@ fun ActivityLauncherHelper.saveFile(name: String, type: String = &quot;*/*&quot;, callback
</a>             .putExtra(Intent.EXTRA_TITLE, name)
             .addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
             .addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
<a href="#h10-2-3" id="h10-2-3" class="d">-    ) {
</a><a href="#h10-2-4" id="h10-2-4" class="d">-        val uri = it.data ?: return@launch
</a><a href="#h10-2-5" id="h10-2-5" class="i">+    ) { resultCode, intent -&gt;
</a><a href="#h10-2-6" id="h10-2-6" class="i">+        if (resultCode != ComponentActivity.RESULT_OK) {
</a><a href="#h10-2-7" id="h10-2-7" class="i">+            return@launch
</a><a href="#h10-2-8" id="h10-2-8" class="i">+        }
</a><a href="#h10-2-9" id="h10-2-9" class="i">+        val uri = intent?.data ?: return@launch
</a>         val value = uri.toString()
         this.activity.contentResolver.takePersistableUriPermission(
             uri,
<a href="#h10-3" id="h10-3" class="h">@@ -72,8 +96,11 @@ fun ActivityLauncherHelper.openFile(type: String = &quot;*/*&quot;, callback: (uri: String
</a>             .setType(type)
             .addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
             .addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
<a href="#h10-3-3" id="h10-3-3" class="d">-    ) {
</a><a href="#h10-3-4" id="h10-3-4" class="d">-        val uri = it.data ?: return@launch
</a><a href="#h10-3-5" id="h10-3-5" class="i">+    ) { resultCode, intent -&gt;
</a><a href="#h10-3-6" id="h10-3-6" class="i">+        if (resultCode != ComponentActivity.RESULT_OK) {
</a><a href="#h10-3-7" id="h10-3-7" class="i">+            return@launch
</a><a href="#h10-3-8" id="h10-3-8" class="i">+        }
</a><a href="#h10-3-9" id="h10-3-9" class="i">+        val uri = intent?.data ?: return@launch
</a>         val value = uri.toString()
         this.activity.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
         callback(value)
<b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -101,7 +101,6 @@ class AlertDialogs(
</a>             Text(
                 text = title,
                 fontSize = 20.sp,
<a href="#h11-0-3" id="h11-0-3" class="d">-                fontWeight = FontWeight.Bold,
</a>                 modifier = Modifier.padding(start = 5.dp, bottom = 10.dp)
             )
             if (message != null) {
<b>diff --git a/<a id="h12" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -2,11 +2,9 @@ package me.rhunk.snapenhance.core.config.impl
</a> 
 import me.rhunk.snapenhance.core.config.ConfigContainer
 import me.rhunk.snapenhance.core.config.FeatureNotice
<a href="#h12-0-3" id="h12-0-3" class="d">-import me.rhunk.snapenhance.data.NotificationType
</a> 
 class Global : ConfigContainer() {
     val snapchatPlus = boolean(&quot;snapchat_plus&quot;) { addNotices(FeatureNotice.MAY_BAN) }
<a href="#h12-0-7" id="h12-0-7" class="d">-    val autoUpdater = unique(&quot;auto_updater&quot;, &quot;EVERY_LAUNCH&quot;, &quot;DAILY&quot;, &quot;WEEKLY&quot;).apply { set(&quot;DAILY&quot;) }
</a>     val disableMetrics = boolean(&quot;disable_metrics&quot;)
     val blockAds = boolean(&quot;block_ads&quot;)
     val disableVideoLengthRestrictions = boolean(&quot;disable_video_length_restrictions&quot;) { addNotices(FeatureNotice.MAY_BAN) }
<b>diff --git a/<a id="h13" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,114 +0,0 @@
</a><a href="#h13-0-0" id="h13-0-0" class="d">-package me.rhunk.snapenhance.features.impl
</a><a href="#h13-0-1" id="h13-0-1" class="d">-
</a><a href="#h13-0-2" id="h13-0-2" class="d">-import android.annotation.SuppressLint
</a><a href="#h13-0-3" id="h13-0-3" class="d">-import android.app.DownloadManager
</a><a href="#h13-0-4" id="h13-0-4" class="d">-import android.content.BroadcastReceiver
</a><a href="#h13-0-5" id="h13-0-5" class="d">-import android.content.Context
</a><a href="#h13-0-6" id="h13-0-6" class="d">-import android.content.Intent
</a><a href="#h13-0-7" id="h13-0-7" class="d">-import android.content.IntentFilter
</a><a href="#h13-0-8" id="h13-0-8" class="d">-import android.net.Uri
</a><a href="#h13-0-9" id="h13-0-9" class="d">-import android.os.Build
</a><a href="#h13-0-10" id="h13-0-10" class="d">-import android.os.Environment
</a><a href="#h13-0-11" id="h13-0-11" class="d">-import com.google.gson.JsonParser
</a><a href="#h13-0-12" id="h13-0-12" class="d">-import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h13-0-13" id="h13-0-13" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h13-0-14" id="h13-0-14" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h13-0-15" id="h13-0-15" class="d">-import me.rhunk.snapenhance.ui.ViewAppearanceHelper
</a><a href="#h13-0-16" id="h13-0-16" class="d">-import okhttp3.OkHttpClient
</a><a href="#h13-0-17" id="h13-0-17" class="d">-import okhttp3.Request
</a><a href="#h13-0-18" id="h13-0-18" class="d">-
</a><a href="#h13-0-19" id="h13-0-19" class="d">-class AutoUpdater : Feature(&quot;AutoUpdater&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h13-0-20" id="h13-0-20" class="d">-    override fun asyncOnActivityCreate() {
</a><a href="#h13-0-21" id="h13-0-21" class="d">-        val autoUpdaterTime = context.config.global.autoUpdater.getNullable() ?: return
</a><a href="#h13-0-22" id="h13-0-22" class="d">-        val currentTimeMillis = System.currentTimeMillis()
</a><a href="#h13-0-23" id="h13-0-23" class="d">-        val checkForUpdatesTimestamp = context.bridgeClient.getAutoUpdaterTime()
</a><a href="#h13-0-24" id="h13-0-24" class="d">-
</a><a href="#h13-0-25" id="h13-0-25" class="d">-        val delayTimestamp = when (autoUpdaterTime) {
</a><a href="#h13-0-26" id="h13-0-26" class="d">-            &quot;EVERY_LAUNCH&quot; -&gt; currentTimeMillis - checkForUpdatesTimestamp
</a><a href="#h13-0-27" id="h13-0-27" class="d">-            &quot;DAILY&quot; -&gt; 86400000L
</a><a href="#h13-0-28" id="h13-0-28" class="d">-            &quot;WEEKLY&quot; -&gt; 604800000L
</a><a href="#h13-0-29" id="h13-0-29" class="d">-            else -&gt; return
</a><a href="#h13-0-30" id="h13-0-30" class="d">-        }
</a><a href="#h13-0-31" id="h13-0-31" class="d">-
</a><a href="#h13-0-32" id="h13-0-32" class="d">-        if (checkForUpdatesTimestamp + delayTimestamp &gt; currentTimeMillis) return
</a><a href="#h13-0-33" id="h13-0-33" class="d">-
</a><a href="#h13-0-34" id="h13-0-34" class="d">-        runCatching {
</a><a href="#h13-0-35" id="h13-0-35" class="d">-            checkForUpdates()
</a><a href="#h13-0-36" id="h13-0-36" class="d">-        }.onFailure {
</a><a href="#h13-0-37" id="h13-0-37" class="d">-            context.log.error(&quot;Failed to check for updates: ${it.message}&quot;, it)
</a><a href="#h13-0-38" id="h13-0-38" class="d">-        }.onSuccess {
</a><a href="#h13-0-39" id="h13-0-39" class="d">-            context.bridgeClient.setAutoUpdaterTime(currentTimeMillis)
</a><a href="#h13-0-40" id="h13-0-40" class="d">-        }
</a><a href="#h13-0-41" id="h13-0-41" class="d">-    }
</a><a href="#h13-0-42" id="h13-0-42" class="d">-
</a><a href="#h13-0-43" id="h13-0-43" class="d">-    @SuppressLint(&quot;UnspecifiedRegisterReceiverFlag&quot;)
</a><a href="#h13-0-44" id="h13-0-44" class="d">-    fun checkForUpdates(): String? {
</a><a href="#h13-0-45" id="h13-0-45" class="d">-        val endpoint = Request.Builder().url(&quot;https://api.github.com/repos/rhunk/SnapEnhance/releases&quot;).build()
</a><a href="#h13-0-46" id="h13-0-46" class="d">-        val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h13-0-47" id="h13-0-47" class="d">-
</a><a href="#h13-0-48" id="h13-0-48" class="d">-        if (!response.isSuccessful) throw Throwable(&quot;Failed to fetch releases: ${response.code}&quot;)
</a><a href="#h13-0-49" id="h13-0-49" class="d">-
</a><a href="#h13-0-50" id="h13-0-50" class="d">-        val releases = JsonParser.parseString(response.body.string()).asJsonArray.also {
</a><a href="#h13-0-51" id="h13-0-51" class="d">-            if (it.size() == 0) throw Throwable(&quot;No releases found&quot;)
</a><a href="#h13-0-52" id="h13-0-52" class="d">-        }
</a><a href="#h13-0-53" id="h13-0-53" class="d">-
</a><a href="#h13-0-54" id="h13-0-54" class="d">-        val latestRelease = releases.get(0).asJsonObject
</a><a href="#h13-0-55" id="h13-0-55" class="d">-        val latestVersion = latestRelease.getAsJsonPrimitive(&quot;tag_name&quot;).asString
</a><a href="#h13-0-56" id="h13-0-56" class="d">-        if (latestVersion.removePrefix(&quot;v&quot;) == BuildConfig.VERSION_NAME) return null
</a><a href="#h13-0-57" id="h13-0-57" class="d">-
</a><a href="#h13-0-58" id="h13-0-58" class="d">-        val architectureName = Build.SUPPORTED_ABIS.let {
</a><a href="#h13-0-59" id="h13-0-59" class="d">-            if (it.contains(&quot;arm64-v8a&quot;)) return@let &quot;armv8&quot;
</a><a href="#h13-0-60" id="h13-0-60" class="d">-            if (it.contains(&quot;armeabi-v7a&quot;) || it.contains(&quot;armeabi&quot;)) return@let &quot;armv7&quot;
</a><a href="#h13-0-61" id="h13-0-61" class="d">-            throw Throwable(&quot;Failed getting architecture&quot;)
</a><a href="#h13-0-62" id="h13-0-62" class="d">-        }
</a><a href="#h13-0-63" id="h13-0-63" class="d">-
</a><a href="#h13-0-64" id="h13-0-64" class="d">-        val releaseContentBody = latestRelease.getAsJsonPrimitive(&quot;body&quot;).asString
</a><a href="#h13-0-65" id="h13-0-65" class="d">-        val downloadEndpoint = &quot;https://github.com/rhunk/SnapEnhance/releases/download/${latestVersion}/app-${latestVersion.removePrefix(&quot;v&quot;)}-${architectureName}-release-signed.apk&quot;
</a><a href="#h13-0-66" id="h13-0-66" class="d">-
</a><a href="#h13-0-67" id="h13-0-67" class="d">-        context.runOnUiThread {
</a><a href="#h13-0-68" id="h13-0-68" class="d">-            ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h13-0-69" id="h13-0-69" class="d">-                .setTitle(context.translation[&quot;auto_updater.dialog_title&quot;])
</a><a href="#h13-0-70" id="h13-0-70" class="d">-                .setMessage(
</a><a href="#h13-0-71" id="h13-0-71" class="d">-                    context.translation.format(&quot;auto_updater.dialog_message&quot;,
</a><a href="#h13-0-72" id="h13-0-72" class="d">-                        &quot;version&quot; to latestVersion,
</a><a href="#h13-0-73" id="h13-0-73" class="d">-                        &quot;body&quot; to releaseContentBody)
</a><a href="#h13-0-74" id="h13-0-74" class="d">-                )
</a><a href="#h13-0-75" id="h13-0-75" class="d">-                .setNegativeButton(context.translation[&quot;auto_updater.dialog_negative_button&quot;]) { dialog, _ -&gt;
</a><a href="#h13-0-76" id="h13-0-76" class="d">-                    dialog.dismiss()
</a><a href="#h13-0-77" id="h13-0-77" class="d">-                }
</a><a href="#h13-0-78" id="h13-0-78" class="d">-                .setPositiveButton(context.translation[&quot;auto_updater.dialog_positive_button&quot;]) { dialog, _ -&gt;
</a><a href="#h13-0-79" id="h13-0-79" class="d">-                    dialog.dismiss()
</a><a href="#h13-0-80" id="h13-0-80" class="d">-                    context.longToast(context.translation[&quot;auto_updater.downloading_toast&quot;])
</a><a href="#h13-0-81" id="h13-0-81" class="d">-
</a><a href="#h13-0-82" id="h13-0-82" class="d">-                    val request = DownloadManager.Request(Uri.parse(downloadEndpoint))
</a><a href="#h13-0-83" id="h13-0-83" class="d">-                        .setTitle(context.translation[&quot;auto_updater.download_manager_notification_title&quot;])
</a><a href="#h13-0-84" id="h13-0-84" class="d">-                        .setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, &quot;latest-snapenhance.apk&quot;)
</a><a href="#h13-0-85" id="h13-0-85" class="d">-                        .setMimeType(&quot;application/vnd.android.package-archive&quot;)
</a><a href="#h13-0-86" id="h13-0-86" class="d">-                        .setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE)
</a><a href="#h13-0-87" id="h13-0-87" class="d">-
</a><a href="#h13-0-88" id="h13-0-88" class="d">-                    val downloadManager = context.androidContext.getSystemService(Context.DOWNLOAD_SERVICE) as DownloadManager
</a><a href="#h13-0-89" id="h13-0-89" class="d">-                    val downloadId = downloadManager.enqueue(request)
</a><a href="#h13-0-90" id="h13-0-90" class="d">-
</a><a href="#h13-0-91" id="h13-0-91" class="d">-                    val onCompleteReceiver = object: BroadcastReceiver() {
</a><a href="#h13-0-92" id="h13-0-92" class="d">-                        override fun onReceive(context: Context, intent: Intent) {
</a><a href="#h13-0-93" id="h13-0-93" class="d">-                            val id = intent.getLongExtra(DownloadManager.EXTRA_DOWNLOAD_ID, -1)
</a><a href="#h13-0-94" id="h13-0-94" class="d">-                            if (id != downloadId) return
</a><a href="#h13-0-95" id="h13-0-95" class="d">-                            context.unregisterReceiver(this)
</a><a href="#h13-0-96" id="h13-0-96" class="d">-                            context.startActivity(
</a><a href="#h13-0-97" id="h13-0-97" class="d">-                                Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h13-0-98" id="h13-0-98" class="d">-                                    setDataAndType(downloadManager.getUriForDownloadedFile(downloadId), &quot;application/vnd.android.package-archive&quot;)
</a><a href="#h13-0-99" id="h13-0-99" class="d">-                                    flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h13-0-100" id="h13-0-100" class="d">-                                }
</a><a href="#h13-0-101" id="h13-0-101" class="d">-                            )
</a><a href="#h13-0-102" id="h13-0-102" class="d">-                        }
</a><a href="#h13-0-103" id="h13-0-103" class="d">-                    }
</a><a href="#h13-0-104" id="h13-0-104" class="d">-
</a><a href="#h13-0-105" id="h13-0-105" class="d">-                    context.mainActivity?.registerReceiver(onCompleteReceiver, IntentFilter(
</a><a href="#h13-0-106" id="h13-0-106" class="d">-                        DownloadManager.ACTION_DOWNLOAD_COMPLETE
</a><a href="#h13-0-107" id="h13-0-107" class="d">-                    ))
</a><a href="#h13-0-108" id="h13-0-108" class="d">-                }.show()
</a><a href="#h13-0-109" id="h13-0-109" class="d">-        }
</a><a href="#h13-0-110" id="h13-0-110" class="d">-
</a><a href="#h13-0-111" id="h13-0-111" class="d">-        return latestVersion
</a><a href="#h13-0-112" id="h13-0-112" class="d">-    }
</a><a href="#h13-0-113" id="h13-0-113" class="d">-}</a><a href="#h13-0-114" id="h13-0-114" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -4,7 +4,6 @@ import me.rhunk.snapenhance.Logger
</a> import me.rhunk.snapenhance.ModContext
 import me.rhunk.snapenhance.features.Feature
 import me.rhunk.snapenhance.features.FeatureLoadParams
<a href="#h14-0-3" id="h14-0-3" class="d">-import me.rhunk.snapenhance.features.impl.AutoUpdater
</a> import me.rhunk.snapenhance.features.impl.ConfigurationOverride
 import me.rhunk.snapenhance.features.impl.Messaging
 import me.rhunk.snapenhance.features.impl.downloader.MediaDownloader
<a href="#h14-1" id="h14-1" class="h">@@ -27,11 +26,11 @@ import me.rhunk.snapenhance.features.impl.tweaks.AutoSave
</a> import me.rhunk.snapenhance.features.impl.tweaks.CameraTweaks
 import me.rhunk.snapenhance.features.impl.tweaks.DisableReplayInFF
 import me.rhunk.snapenhance.features.impl.tweaks.DisableVideoLengthRestriction
<a href="#h14-1-3" id="h14-1-3" class="d">-import me.rhunk.snapenhance.features.impl.tweaks.SendOverride
</a> import me.rhunk.snapenhance.features.impl.tweaks.GooglePlayServicesDialogs
 import me.rhunk.snapenhance.features.impl.tweaks.LocationSpoofer
 import me.rhunk.snapenhance.features.impl.tweaks.MediaQualityLevelOverride
 import me.rhunk.snapenhance.features.impl.tweaks.Notifications
<a href="#h14-1-8" id="h14-1-8" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.SendOverride
</a> import me.rhunk.snapenhance.features.impl.tweaks.SnapchatPlus
 import me.rhunk.snapenhance.features.impl.tweaks.UnlimitedSnapViewTime
 import me.rhunk.snapenhance.features.impl.ui.PinConversations
<a href="#h14-2" id="h14-2" class="h">@@ -84,7 +83,6 @@ class FeatureManager(private val context: ModContext) : Manager {
</a>         register(MeoPasscodeBypass::class)
         register(AppPasscode::class)
         register(LocationSpoofer::class)
<a href="#h14-2-3" id="h14-2-3" class="d">-        register(AutoUpdater::class)
</a>         register(CameraTweaks::class)
         register(InfiniteStoryBoost::class)
         register(AmoledDarkMode::class)
</pre>
</div>
</body>
</html>
