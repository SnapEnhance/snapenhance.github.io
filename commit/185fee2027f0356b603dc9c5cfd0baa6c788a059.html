<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>localization - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/185fee2027f0356b603dc9c5cfd0baa6c788a059.html">185fee2027f0356b603dc9c5cfd0baa6c788a059</a>
<b>parent</b> <a href="../commit/5df7d067ac6c96ff88b50e8e655c30d99696cdb8.html">5df7d067ac6c96ff88b50e8e655c30d99696cdb8</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Tue, 16 May 2023 01:35:16 +0200

localization

<b>Diffstat:</b>
<table><tr><td class="A">A</td><td><a href="#h0">app/src/main/assets/lang/en.json</a></td><td> | </td><td class="num">77</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt</a></td><td> | </td><td class="num">17</td><td><span class="i">++++++++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt</a></td><td> | </td><td class="num">7</td><td><span class="i">+</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt</a></td><td> | </td><td class="num">11</td><td><span class="i">++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></td><td> | </td><td class="num">88</td><td><span class="i">++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></td><td> | </td><td class="num">17</td><td><span class="i">++++++++++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt</a></td><td> | </td><td class="num">25</td><td><span class="i">+++++++++++++++++++++++</span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h13">app/src/main/res/values-fr/strings.xml</a></td><td> | </td><td class="num">5</td><td><span class="i"></span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">app/src/main/res/values/strings.xml</a></td><td> | </td><td class="num">30</td><td><span class="i"></span><span class="d">------------------------------</span></td></tr>
</table></pre><pre>15 files changed, 200 insertions(+), 135 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/assets/lang/en.json.html">app/src/main/assets/lang/en.json</a> b/<a href="../file/app/src/main/assets/lang/en.json.html">app/src/main/assets/lang/en.json</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -0,0 +1,76 @@
</a><a href="#h0-0-0" id="h0-0-0" class="i">+{
</a><a href="#h0-0-1" id="h0-0-1" class="i">+    &quot;category&quot;: {
</a><a href="#h0-0-2" id="h0-0-2" class="i">+        &quot;general&quot;: &quot;General&quot;,
</a><a href="#h0-0-3" id="h0-0-3" class="i">+        &quot;spy&quot;: &quot;Spy&quot;,
</a><a href="#h0-0-4" id="h0-0-4" class="i">+        &quot;media_download&quot;: &quot;Media Downloader&quot;,
</a><a href="#h0-0-5" id="h0-0-5" class="i">+        &quot;privacy&quot;: &quot;Privacy&quot;,
</a><a href="#h0-0-6" id="h0-0-6" class="i">+        &quot;ui&quot;: &quot;UI&quot;,
</a><a href="#h0-0-7" id="h0-0-7" class="i">+        &quot;extras&quot;: &quot;Extras&quot;,
</a><a href="#h0-0-8" id="h0-0-8" class="i">+        &quot;tweaks&quot;: &quot;Tweaks&quot;,
</a><a href="#h0-0-9" id="h0-0-9" class="i">+        &quot;experimental&quot;: &quot;Experimental&quot;
</a><a href="#h0-0-10" id="h0-0-10" class="i">+    },
</a><a href="#h0-0-11" id="h0-0-11" class="i">+   
</a><a href="#h0-0-12" id="h0-0-12" class="i">+    &quot;property&quot;: {
</a><a href="#h0-0-13" id="h0-0-13" class="i">+        &quot;save_folder&quot;: &quot;Save Folder&quot;,
</a><a href="#h0-0-14" id="h0-0-14" class="i">+        &quot;prevent_read_receipts&quot;: &quot;Prevent Read Receipts&quot;,
</a><a href="#h0-0-15" id="h0-0-15" class="i">+        &quot;hide_bitmoji_presence&quot;: &quot;Hide Bitmoji Presence&quot;,
</a><a href="#h0-0-16" id="h0-0-16" class="i">+        &quot;show_message_content&quot;: &quot;Show Message Content&quot;,
</a><a href="#h0-0-17" id="h0-0-17" class="i">+        &quot;message_logger&quot;: &quot;Message Logger&quot;,
</a><a href="#h0-0-18" id="h0-0-18" class="i">+        &quot;auto_download_snaps&quot;: &quot;Auto Download Snaps&quot;,
</a><a href="#h0-0-19" id="h0-0-19" class="i">+        &quot;auto_download_stories&quot;: &quot;Auto Download Stories&quot;,
</a><a href="#h0-0-20" id="h0-0-20" class="i">+        &quot;auto_download_public_stories&quot;: &quot;Auto Download Public Stories&quot;,
</a><a href="#h0-0-21" id="h0-0-21" class="i">+        &quot;auto_download_spotlight&quot;: &quot;Auto Download Spotlight&quot;,
</a><a href="#h0-0-22" id="h0-0-22" class="i">+        &quot;overlay_merge&quot;: &quot;Snap Image Overlay Merge&quot;,
</a><a href="#h0-0-23" id="h0-0-23" class="i">+        &quot;download_inchat_snaps&quot;: &quot;Download Inchat Snaps&quot;,
</a><a href="#h0-0-24" id="h0-0-24" class="i">+        &quot;anti_auto_download_button&quot;: &quot;Anti Auto Download Button&quot;,
</a><a href="#h0-0-25" id="h0-0-25" class="i">+        &quot;disable_metrics&quot;: &quot;Disable Metrics&quot;,
</a><a href="#h0-0-26" id="h0-0-26" class="i">+        &quot;prevent_screenshots&quot;: &quot;Prevent Screenshots&quot;,
</a><a href="#h0-0-27" id="h0-0-27" class="i">+        &quot;prevent_status_notifications&quot;: &quot;Prevent Status Notifications (Screenrecord, media save)&quot;,
</a><a href="#h0-0-28" id="h0-0-28" class="i">+        &quot;anonymous_story_view&quot;: &quot;Anonymous Story View&quot;,
</a><a href="#h0-0-29" id="h0-0-29" class="i">+        &quot;hide_typing_notification&quot;: &quot;Hide Typing Notification&quot;,
</a><a href="#h0-0-30" id="h0-0-30" class="i">+        &quot;menu_slot_id&quot;: &quot;Friend Menu Slot ID&quot;,
</a><a href="#h0-0-31" id="h0-0-31" class="i">+        &quot;message_preview_length&quot;: &quot;Message Preview Length&quot;,
</a><a href="#h0-0-32" id="h0-0-32" class="i">+        &quot;auto_save&quot;: &quot;Auto Save&quot;,
</a><a href="#h0-0-33" id="h0-0-33" class="i">+        &quot;snapchat_plus&quot;: &quot;Snapchat Plus&quot;,
</a><a href="#h0-0-34" id="h0-0-34" class="i">+        &quot;remove_voice_record_button&quot;: &quot;Remove Voice Record Button&quot;,
</a><a href="#h0-0-35" id="h0-0-35" class="i">+        &quot;remove_stickers_button&quot;: &quot;Remove Stickers Button&quot;,
</a><a href="#h0-0-36" id="h0-0-36" class="i">+        &quot;remove_cognac_button&quot;: &quot;Remove Cognac Button&quot;,
</a><a href="#h0-0-37" id="h0-0-37" class="i">+        &quot;remove_call_buttons&quot;: &quot;Remove Call Buttons&quot;,
</a><a href="#h0-0-38" id="h0-0-38" class="i">+        &quot;long_snap_sending&quot;: &quot;Long Snap Sending&quot;,
</a><a href="#h0-0-39" id="h0-0-39" class="i">+        &quot;block_ads&quot;: &quot;Block Ads&quot;,
</a><a href="#h0-0-40" id="h0-0-40" class="i">+        &quot;streak_expiration_info&quot;: &quot;Show Streak Expiration Info&quot;,
</a><a href="#h0-0-41" id="h0-0-41" class="i">+        &quot;new_map_ui&quot;: &quot;New Map UI&quot;,
</a><a href="#h0-0-42" id="h0-0-42" class="i">+        &quot;use_download_manager&quot;: &quot;Use Android Download Manager&quot;
</a><a href="#h0-0-43" id="h0-0-43" class="i">+    },
</a><a href="#h0-0-44" id="h0-0-44" class="i">+   
</a><a href="#h0-0-45" id="h0-0-45" class="i">+
</a><a href="#h0-0-46" id="h0-0-46" class="i">+    &quot;friend_menu_option&quot;: {
</a><a href="#h0-0-47" id="h0-0-47" class="i">+        &quot;preview&quot;: &quot;Preview&quot;,
</a><a href="#h0-0-48" id="h0-0-48" class="i">+        &quot;stealth_mode&quot;: &quot;Stealth Mode&quot;,
</a><a href="#h0-0-49" id="h0-0-49" class="i">+        &quot;anti_auto_download&quot;: &quot;Anti Auto Download&quot;
</a><a href="#h0-0-50" id="h0-0-50" class="i">+    },
</a><a href="#h0-0-51" id="h0-0-51" class="i">+
</a><a href="#h0-0-52" id="h0-0-52" class="i">+    &quot;message_context_menu_option&quot;: {
</a><a href="#h0-0-53" id="h0-0-53" class="i">+        &quot;download&quot;: &quot;Download&quot;,
</a><a href="#h0-0-54" id="h0-0-54" class="i">+        &quot;preview&quot;: &quot;Preview&quot;
</a><a href="#h0-0-55" id="h0-0-55" class="i">+    },
</a><a href="#h0-0-56" id="h0-0-56" class="i">+
</a><a href="#h0-0-57" id="h0-0-57" class="i">+    &quot;modal_option&quot;: {
</a><a href="#h0-0-58" id="h0-0-58" class="i">+        &quot;profile_info&quot;: &quot;Profile Info&quot;,
</a><a href="#h0-0-59" id="h0-0-59" class="i">+        &quot;close&quot;: &quot;Close&quot;
</a><a href="#h0-0-60" id="h0-0-60" class="i">+    },
</a><a href="#h0-0-61" id="h0-0-61" class="i">+
</a><a href="#h0-0-62" id="h0-0-62" class="i">+    &quot;conversation_preview&quot;: {
</a><a href="#h0-0-63" id="h0-0-63" class="i">+        &quot;streak_expiration&quot;: &quot;expires in %s days %s hours %s minutes&quot;,
</a><a href="#h0-0-64" id="h0-0-64" class="i">+        &quot;title&quot;: &quot;Preview&quot;,
</a><a href="#h0-0-65" id="h0-0-65" class="i">+        &quot;unknown_user&quot;: &quot;Unknown User&quot;
</a><a href="#h0-0-66" id="h0-0-66" class="i">+    },
</a><a href="#h0-0-67" id="h0-0-67" class="i">+
</a><a href="#h0-0-68" id="h0-0-68" class="i">+    &quot;profile_info&quot;: {
</a><a href="#h0-0-69" id="h0-0-69" class="i">+        &quot;title&quot;: &quot;Profile Info&quot;,
</a><a href="#h0-0-70" id="h0-0-70" class="i">+        &quot;username&quot;: &quot;Username&quot;,
</a><a href="#h0-0-71" id="h0-0-71" class="i">+        &quot;display_name&quot;: &quot;Display Name&quot;,
</a><a href="#h0-0-72" id="h0-0-72" class="i">+        &quot;added_date&quot;: &quot;Added Date&quot;,
</a><a href="#h0-0-73" id="h0-0-73" class="i">+        &quot;birthday&quot;: &quot;Birthday : {month} {day}&quot;
</a><a href="#h0-0-74" id="h0-0-74" class="i">+    }
</a><a href="#h0-0-75" id="h0-0-75" class="i">+}</a><a href="#h0-0-76" id="h0-0-76" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -89,6 +89,12 @@ class ModContext {
</a>         exitProcess(0)
     }
 
<a href="#h1-0-3" id="h1-0-3" class="i">+    fun crash(message: String, throwable: Throwable? = null) {
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        Logger.xposedLog(message, throwable)
</a><a href="#h1-0-5" id="h1-0-5" class="i">+        longToast(message)
</a><a href="#h1-0-6" id="h1-0-6" class="i">+        delayForceCloseApp(100)
</a><a href="#h1-0-7" id="h1-0-7" class="i">+    }
</a><a href="#h1-0-8" id="h1-0-8" class="i">+
</a>     fun delayForceCloseApp(delay: Long) = Handler(Looper.getMainLooper()).postDelayed({
         forceCloseApp()
     }, delay)
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -53,11 +53,12 @@ class BridgeClient(
</a>             BridgeMessageType.FILE_ACCESS_RESULT -&gt; FileAccessResult()
             BridgeMessageType.DOWNLOAD_CONTENT_RESULT -&gt; DownloadContentResult()
             BridgeMessageType.MESSAGE_LOGGER_RESULT -&gt; MessageLoggerResult()
<a href="#h2-0-3" id="h2-0-3" class="i">+            BridgeMessageType.LOCALE_RESULT -&gt; LocaleResult()
</a>             else -&gt; {
<a href="#h2-0-5" id="h2-0-5" class="d">-                log(&quot;Unknown message type: ${msg.what}&quot;)
</a><a href="#h2-0-6" id="h2-0-6" class="d">-                null
</a><a href="#h2-0-7" id="h2-0-7" class="i">+                future.completeExceptionally(IllegalStateException(&quot;Unknown message type: ${msg.what}&quot;))
</a><a href="#h2-0-8" id="h2-0-8" class="i">+                return
</a>             }
<a href="#h2-0-10" id="h2-0-10" class="d">-        } ?: return
</a><a href="#h2-0-11" id="h2-0-11" class="i">+        }
</a> 
         with(message) {
             read(msg.data)
<a href="#h2-1" id="h2-1" class="h">@@ -220,6 +221,16 @@ class BridgeClient(
</a>         )
     }
 
<a href="#h2-1-3" id="h2-1-3" class="i">+    fun fetchTranslations(): LocaleResult {
</a><a href="#h2-1-4" id="h2-1-4" class="i">+        sendMessage(
</a><a href="#h2-1-5" id="h2-1-5" class="i">+            BridgeMessageType.LOCALE_REQUEST,
</a><a href="#h2-1-6" id="h2-1-6" class="i">+            LocaleRequest(),
</a><a href="#h2-1-7" id="h2-1-7" class="i">+            LocaleResult::class
</a><a href="#h2-1-8" id="h2-1-8" class="i">+        ).run {
</a><a href="#h2-1-9" id="h2-1-9" class="i">+            return this
</a><a href="#h2-1-10" id="h2-1-10" class="i">+        }
</a><a href="#h2-1-11" id="h2-1-11" class="i">+    }
</a><a href="#h2-1-12" id="h2-1-12" class="i">+
</a>     override fun onServiceConnected(name: ComponentName, service: IBinder) {
         messenger = Messenger(service)
         future.complete(true)
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -3,15 +3,10 @@ package me.rhunk.snapenhance.bridge.common.impl
</a> import android.os.Bundle
 import me.rhunk.snapenhance.bridge.common.BridgeMessage
 
<a href="#h3-0-3" id="h3-0-3" class="d">-class LocaleRequest(
</a><a href="#h3-0-4" id="h3-0-4" class="d">-    var locale: String? = null
</a><a href="#h3-0-5" id="h3-0-5" class="d">-) : BridgeMessage() {
</a><a href="#h3-0-6" id="h3-0-6" class="d">-
</a><a href="#h3-0-7" id="h3-0-7" class="i">+class LocaleRequest() : BridgeMessage() {
</a>     override fun write(bundle: Bundle) {
<a href="#h3-0-9" id="h3-0-9" class="d">-        bundle.putString(&quot;locale&quot;, locale)
</a>     }
 
     override fun read(bundle: Bundle) {
<a href="#h3-0-13" id="h3-0-13" class="d">-        locale = bundle.getString(&quot;locale&quot;)
</a>     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -10,6 +10,7 @@ import me.rhunk.snapenhance.Logger
</a> import me.rhunk.snapenhance.bridge.common.BridgeMessageType
 import me.rhunk.snapenhance.bridge.common.impl.*
 import java.io.File
<a href="#h4-0-3" id="h4-0-3" class="i">+import java.util.*
</a> 
 class BridgeService : Service() {
     companion object {
<a href="#h4-1" id="h4-1" class="h">@@ -112,9 +113,13 @@ class BridgeService : Service() {
</a>     }
 
     private fun handleLocaleRequest(msg: LocaleRequest, reply: (Message) -&gt; Unit) {
<a href="#h4-1-3" id="h4-1-3" class="d">-        val locale = resources.configuration.locales[0]
</a><a href="#h4-1-4" id="h4-1-4" class="d">-        Logger.log(&quot;Locale: ${locale.language}_${locale.country}&quot;)
</a><a href="#h4-1-5" id="h4-1-5" class="d">-        TODO()
</a><a href="#h4-1-6" id="h4-1-6" class="i">+        val deviceLocale = Locale.getDefault().language
</a><a href="#h4-1-7" id="h4-1-7" class="i">+        val compatibleLocale = resources.assets.list(&quot;lang&quot;)?.find { it.startsWith(deviceLocale) }?.substring(0, 2) ?: &quot;en&quot;
</a><a href="#h4-1-8" id="h4-1-8" class="i">+
</a><a href="#h4-1-9" id="h4-1-9" class="i">+        resources.assets.open(&quot;lang/$compatibleLocale.json&quot;).use { inputStream -&gt;
</a><a href="#h4-1-10" id="h4-1-10" class="i">+            val json = inputStream.bufferedReader().use { it.readText() }
</a><a href="#h4-1-11" id="h4-1-11" class="i">+            reply(LocaleResult(compatibleLocale, json.toByteArray(Charsets.UTF_8)).toMessage(BridgeMessageType.LOCALE_RESULT.value))
</a><a href="#h4-1-12" id="h4-1-12" class="i">+        }
</a>     }
 
     private fun handleDownloadContent(msg: DownloadContentRequest, reply: (Message) -&gt; Unit) {
<b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -3,12 +3,12 @@ package me.rhunk.snapenhance.config
</a> enum class ConfigCategory(
     val key: String
 ) {
<a href="#h5-0-3" id="h5-0-3" class="d">-    GENERAL(&quot;general&quot;),
</a><a href="#h5-0-4" id="h5-0-4" class="d">-    SPY(&quot;spy&quot;),
</a><a href="#h5-0-5" id="h5-0-5" class="d">-    MEDIA_DOWNLOADER(&quot;media_download&quot;),
</a><a href="#h5-0-6" id="h5-0-6" class="d">-    PRIVACY(&quot;privacy&quot;),
</a><a href="#h5-0-7" id="h5-0-7" class="d">-    UI(&quot;ui&quot;),
</a><a href="#h5-0-8" id="h5-0-8" class="d">-    EXTRAS(&quot;extras&quot;),
</a><a href="#h5-0-9" id="h5-0-9" class="d">-    TWEAKS(&quot;tweaks&quot;),
</a><a href="#h5-0-10" id="h5-0-10" class="d">-    EXPERIMENTS(&quot;experiments&quot;);
</a><a href="#h5-0-11" id="h5-0-11" class="i">+    GENERAL(&quot;category.general&quot;),
</a><a href="#h5-0-12" id="h5-0-12" class="i">+    SPY(&quot;category.spy&quot;),
</a><a href="#h5-0-13" id="h5-0-13" class="i">+    MEDIA_DOWNLOADER(&quot;category.media_download&quot;),
</a><a href="#h5-0-14" id="h5-0-14" class="i">+    PRIVACY(&quot;category.privacy&quot;),
</a><a href="#h5-0-15" id="h5-0-15" class="i">+    UI(&quot;category.ui&quot;),
</a><a href="#h5-0-16" id="h5-0-16" class="i">+    EXTRAS(&quot;category.extras&quot;),
</a><a href="#h5-0-17" id="h5-0-17" class="i">+    TWEAKS(&quot;category.tweaks&quot;),
</a><a href="#h5-0-18" id="h5-0-18" class="i">+    EXPERIMENTAL(&quot;category.experimental&quot;);
</a> }
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -10,7 +10,7 @@ enum class ConfigProperty(
</a>     val defaultValue: Any
 ) {
     SAVE_FOLDER(
<a href="#h6-0-3" id="h6-0-3" class="d">-        &quot;save_folder&quot;, &quot;description.save_folder&quot;, ConfigCategory.GENERAL,
</a><a href="#h6-0-4" id="h6-0-4" class="i">+        &quot;property.save_folder&quot;, &quot;description.save_folder&quot;, ConfigCategory.GENERAL,
</a>         File(
             Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM).absolutePath + &quot;/Snapchat&quot;,
             &quot;SnapEnhance&quot;
<a href="#h6-1" id="h6-1" class="h">@@ -18,166 +18,148 @@ enum class ConfigProperty(
</a>     ),
 
     PREVENT_READ_RECEIPTS(
<a href="#h6-1-3" id="h6-1-3" class="d">-        &quot;prevent_read_receipts&quot;,
</a><a href="#h6-1-4" id="h6-1-4" class="i">+        &quot;property.prevent_read_receipts&quot;,
</a>         &quot;description.prevent_read_receipts&quot;,
         ConfigCategory.SPY,
         false
     ),
     HIDE_BITMOJI_PRESENCE(
<a href="#h6-1-10" id="h6-1-10" class="d">-        &quot;hide_bitmoji_presence&quot;,
</a><a href="#h6-1-11" id="h6-1-11" class="i">+        &quot;property.hide_bitmoji_presence&quot;,
</a>         &quot;description.hide_bitmoji_presence&quot;,
         ConfigCategory.SPY,
         false
     ),
     SHOW_MESSAGE_CONTENT(
<a href="#h6-1-17" id="h6-1-17" class="d">-        &quot;show_message_content&quot;,
</a><a href="#h6-1-18" id="h6-1-18" class="i">+        &quot;property.show_message_content&quot;,
</a>         &quot;description.show_message_content&quot;,
         ConfigCategory.SPY,
         false
     ),
<a href="#h6-1-23" id="h6-1-23" class="d">-    MESSAGE_LOGGER(&quot;message_logger&quot;, &quot;description.message_logger&quot;, ConfigCategory.SPY, false),
</a><a href="#h6-1-24" id="h6-1-24" class="i">+    MESSAGE_LOGGER(&quot;property.message_logger&quot;, &quot;description.message_logger&quot;, ConfigCategory.SPY, false),
</a> 
<a href="#h6-1-26" id="h6-1-26" class="d">-    MEDIA_DOWNLOADER(
</a><a href="#h6-1-27" id="h6-1-27" class="d">-        &quot;media_downloader&quot;,
</a><a href="#h6-1-28" id="h6-1-28" class="d">-        &quot;description.media_downloader&quot;,
</a><a href="#h6-1-29" id="h6-1-29" class="d">-        ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h6-1-30" id="h6-1-30" class="d">-        true
</a><a href="#h6-1-31" id="h6-1-31" class="d">-    ),
</a>     AUTO_DOWNLOAD_SNAPS(
<a href="#h6-1-33" id="h6-1-33" class="d">-        &quot;auto_download_snaps&quot;,
</a><a href="#h6-1-34" id="h6-1-34" class="i">+        &quot;property.auto_download_snaps&quot;,
</a>         &quot;description.auto_download_snaps&quot;,
         ConfigCategory.MEDIA_DOWNLOADER,
         true
     ),
     AUTO_DOWNLOAD_STORIES(
<a href="#h6-1-40" id="h6-1-40" class="d">-        &quot;auto_download_stories&quot;,
</a><a href="#h6-1-41" id="h6-1-41" class="i">+        &quot;property.auto_download_stories&quot;,
</a>         &quot;description.auto_download_stories&quot;,
         ConfigCategory.MEDIA_DOWNLOADER,
         false
     ),
     AUTO_DOWNLOAD_PUBLIC_STORIES(
<a href="#h6-1-47" id="h6-1-47" class="d">-        &quot;auto_download_public_stories&quot;,
</a><a href="#h6-1-48" id="h6-1-48" class="i">+        &quot;property.auto_download_public_stories&quot;,
</a>         &quot;description.auto_download_public_stories&quot;,
         ConfigCategory.MEDIA_DOWNLOADER,
         false
     ),
     AUTO_DOWNLOAD_SPOTLIGHT(
<a href="#h6-1-54" id="h6-1-54" class="d">-        &quot;auto_download_spotlight&quot;,
</a><a href="#h6-1-55" id="h6-1-55" class="i">+        &quot;property.auto_download_spotlight&quot;,
</a>         &quot;description.auto_download_spotlight&quot;,
         ConfigCategory.MEDIA_DOWNLOADER,
         false
     ),
     OVERLAY_MERGE(
<a href="#h6-1-61" id="h6-1-61" class="d">-        &quot;overlay_merge&quot;,
</a><a href="#h6-1-62" id="h6-1-62" class="i">+        &quot;property.overlay_merge&quot;,
</a>         &quot;description.overlay_merge&quot;,
         ConfigCategory.MEDIA_DOWNLOADER,
         true
     ),
     DOWNLOAD_INCHAT_SNAPS(
<a href="#h6-1-68" id="h6-1-68" class="d">-        &quot;download_inchat_snaps&quot;,
</a><a href="#h6-1-69" id="h6-1-69" class="i">+        &quot;property.download_inchat_snaps&quot;,
</a>         &quot;description.download_inchat_snaps&quot;,
         ConfigCategory.MEDIA_DOWNLOADER,
         true
     ),
     ANTI_DOWNLOAD_BUTTON(
<a href="#h6-1-75" id="h6-1-75" class="d">-        &quot;anti_download_button&quot;,
</a><a href="#h6-1-76" id="h6-1-76" class="d">-        &quot;description.anti_download_button&quot;,
</a><a href="#h6-1-77" id="h6-1-77" class="i">+        &quot;property.anti_auto_download_button&quot;,
</a><a href="#h6-1-78" id="h6-1-78" class="i">+        &quot;description.anti_auto_download_button&quot;,
</a>         ConfigCategory.MEDIA_DOWNLOADER,
         false
     ),
 
<a href="#h6-1-83" id="h6-1-83" class="d">-    DISABLE_METRICS(&quot;disable_metrics&quot;, &quot;description.disable_metrics&quot;, ConfigCategory.PRIVACY, true),
</a><a href="#h6-1-84" id="h6-1-84" class="i">+    DISABLE_METRICS(&quot;property.disable_metrics&quot;, &quot;description.disable_metrics&quot;, ConfigCategory.PRIVACY, true),
</a>     PREVENT_SCREENSHOTS(
<a href="#h6-1-86" id="h6-1-86" class="d">-        &quot;prevent_screenshots&quot;,
</a><a href="#h6-1-87" id="h6-1-87" class="i">+        &quot;property.prevent_screenshots&quot;,
</a>         &quot;description.prevent_screenshots&quot;,
         ConfigCategory.PRIVACY,
         true
     ),
     PREVENT_STATUS_NOTIFICATIONS(
<a href="#h6-1-93" id="h6-1-93" class="d">-        &quot;prevent_status_notifications&quot;,
</a><a href="#h6-1-94" id="h6-1-94" class="i">+        &quot;property.prevent_status_notifications&quot;,
</a>         &quot;description.prevent_status_notifications&quot;,
         ConfigCategory.PRIVACY,
         true
     ),
     ANONYMOUS_STORY_VIEW(
<a href="#h6-1-100" id="h6-1-100" class="d">-        &quot;anonymous_story_view&quot;,
</a><a href="#h6-1-101" id="h6-1-101" class="i">+        &quot;property.anonymous_story_view&quot;,
</a>         &quot;description.anonymous_story_view&quot;,
         ConfigCategory.PRIVACY,
         false
     ),
     HIDE_TYPING_NOTIFICATION(
<a href="#h6-1-107" id="h6-1-107" class="d">-        &quot;hide_typing_notification&quot;,
</a><a href="#h6-1-108" id="h6-1-108" class="i">+        &quot;property.hide_typing_notification&quot;,
</a>         &quot;description.hide_typing_notification&quot;,
         ConfigCategory.PRIVACY,
         false
     ),
 
<a href="#h6-1-114" id="h6-1-114" class="d">-    MENU_SLOT_ID(&quot;menu_slot_id&quot;, &quot;description.menu_slot_id&quot;, ConfigCategory.UI, 1),
</a><a href="#h6-1-115" id="h6-1-115" class="i">+    MENU_SLOT_ID(&quot;property.menu_slot_id&quot;, &quot;description.menu_slot_id&quot;, ConfigCategory.UI, 1),
</a>     MESSAGE_PREVIEW_LENGTH(
<a href="#h6-1-117" id="h6-1-117" class="d">-        &quot;message_preview_length&quot;,
</a><a href="#h6-1-118" id="h6-1-118" class="i">+        &quot;property.message_preview_length&quot;,
</a>         &quot;description.message_preview_length&quot;,
         ConfigCategory.UI,
         20
     ),
 
<a href="#h6-1-124" id="h6-1-124" class="d">-    AUTO_SAVE(&quot;auto_save&quot;, &quot;description.auto_save&quot;, ConfigCategory.EXTRAS, false),
</a><a href="#h6-1-125" id="h6-1-125" class="d">-    /*EXTERNAL_MEDIA_AS_SNAP(
</a><a href="#h6-1-126" id="h6-1-126" class="d">-        &quot;external_media_as_snap&quot;,
</a><a href="#h6-1-127" id="h6-1-127" class="d">-        &quot;description.external_media_as_snap&quot;,
</a><a href="#h6-1-128" id="h6-1-128" class="d">-        ConfigCategory.EXTRAS,
</a><a href="#h6-1-129" id="h6-1-129" class="d">-        false
</a><a href="#h6-1-130" id="h6-1-130" class="d">-    ),
</a><a href="#h6-1-131" id="h6-1-131" class="d">-    CONVERSATION_EXPORT(
</a><a href="#h6-1-132" id="h6-1-132" class="d">-        &quot;conversation_export&quot;,
</a><a href="#h6-1-133" id="h6-1-133" class="d">-        &quot;description.conversation_export&quot;,
</a><a href="#h6-1-134" id="h6-1-134" class="d">-        ConfigCategory.EXTRAS,
</a><a href="#h6-1-135" id="h6-1-135" class="d">-        false
</a><a href="#h6-1-136" id="h6-1-136" class="d">-    ),*/
</a><a href="#h6-1-137" id="h6-1-137" class="d">-    SNAPCHAT_PLUS(&quot;snapchat_plus&quot;, &quot;description.snapchat_plus&quot;, ConfigCategory.EXTRAS, false),
</a><a href="#h6-1-138" id="h6-1-138" class="i">+    AUTO_SAVE(&quot;property.auto_save&quot;, &quot;description.auto_save&quot;, ConfigCategory.EXTRAS, false),
</a><a href="#h6-1-139" id="h6-1-139" class="i">+    SNAPCHAT_PLUS(&quot;property.snapchat_plus&quot;, &quot;description.snapchat_plus&quot;, ConfigCategory.EXTRAS, false),
</a> 
     REMOVE_VOICE_RECORD_BUTTON(
<a href="#h6-1-142" id="h6-1-142" class="d">-        &quot;remove_voice_record_button&quot;,
</a><a href="#h6-1-143" id="h6-1-143" class="i">+        &quot;property.remove_voice_record_button&quot;,
</a>         &quot;description.remove_voice_record_button&quot;,
         ConfigCategory.TWEAKS,
         false
     ),
     REMOVE_STICKERS_BUTTON(
<a href="#h6-1-149" id="h6-1-149" class="d">-        &quot;remove_stickers_button&quot;,
</a><a href="#h6-1-150" id="h6-1-150" class="i">+        &quot;property.remove_stickers_button&quot;,
</a>         &quot;description.remove_stickers_button&quot;,
         ConfigCategory.TWEAKS,
         false
     ),
     REMOVE_COGNAC_BUTTON(
<a href="#h6-1-156" id="h6-1-156" class="d">-        &quot;remove_cognac_button&quot;,
</a><a href="#h6-1-157" id="h6-1-157" class="i">+        &quot;property.remove_cognac_button&quot;,
</a>         &quot;description.remove_cognac_button&quot;,
         ConfigCategory.TWEAKS,
         false
     ),
<a href="#h6-1-162" id="h6-1-162" class="d">-    REMOVE_CALLBUTTONS(
</a><a href="#h6-1-163" id="h6-1-163" class="d">-        &quot;remove_callbuttons&quot;,
</a><a href="#h6-1-164" id="h6-1-164" class="d">-        &quot;description.remove_callbuttons&quot;,
</a><a href="#h6-1-165" id="h6-1-165" class="i">+    REMOVE_CALL_BUTTONS(
</a><a href="#h6-1-166" id="h6-1-166" class="i">+        &quot;property.remove_call_buttons&quot;,
</a><a href="#h6-1-167" id="h6-1-167" class="i">+        &quot;description.remove_call_buttons&quot;,
</a>         ConfigCategory.TWEAKS,
         false
     ),
     LONG_SNAP_SENDING(
<a href="#h6-1-172" id="h6-1-172" class="d">-        &quot;long_snap_sending&quot;,
</a><a href="#h6-1-173" id="h6-1-173" class="i">+        &quot;property.long_snap_sending&quot;,
</a>         &quot;description.long_snap_sending&quot;,
         ConfigCategory.TWEAKS,
         false
     ),
<a href="#h6-1-178" id="h6-1-178" class="d">-    BLOCK_ADS(&quot;block_ads&quot;, &quot;description.block_ads&quot;, ConfigCategory.TWEAKS, false),
</a><a href="#h6-1-179" id="h6-1-179" class="d">-    STREAKEXPIRATIONINFO(
</a><a href="#h6-1-180" id="h6-1-180" class="d">-        &quot;streakexpirationinfo&quot;,
</a><a href="#h6-1-181" id="h6-1-181" class="i">+    BLOCK_ADS(&quot;property.block_ads&quot;, &quot;description.block_ads&quot;, ConfigCategory.TWEAKS, false),
</a><a href="#h6-1-182" id="h6-1-182" class="i">+    STREAK_EXPIRATION_INFO(
</a><a href="#h6-1-183" id="h6-1-183" class="i">+        &quot;property.streak_expiration_info&quot;,
</a>         &quot;description.streakexpirationinfo&quot;,
         ConfigCategory.TWEAKS,
         false
     ),
<a href="#h6-1-188" id="h6-1-188" class="d">-    NEW_MAP_UI(&quot;new_map_ui&quot;, &quot;description.new_map_ui&quot;, ConfigCategory.TWEAKS, false),
</a><a href="#h6-1-189" id="h6-1-189" class="i">+    NEW_MAP_UI(&quot;property.new_map_ui&quot;, &quot;description.new_map_ui&quot;, ConfigCategory.TWEAKS, false),
</a> 
     USE_DOWNLOAD_MANAGER(
<a href="#h6-1-192" id="h6-1-192" class="d">-        &quot;use_download_manager&quot;,
</a><a href="#h6-1-193" id="h6-1-193" class="i">+        &quot;property.use_download_manager&quot;,
</a>         &quot;description.use_download_manager&quot;,
<a href="#h6-1-195" id="h6-1-195" class="d">-        ConfigCategory.EXPERIMENTS,
</a><a href="#h6-1-196" id="h6-1-196" class="i">+        ConfigCategory.EXPERIMENTAL,
</a>         false
     );
 
<b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -47,7 +47,7 @@ class ConfigEnumKeys : Feature(&quot;Config enum keys&quot;, loadParams = FeatureLoadParam
</a>             }
         }
 
<a href="#h7-0-3" id="h7-0-3" class="d">-        if (context.config.bool(ConfigProperty.STREAKEXPIRATIONINFO)) {
</a><a href="#h7-0-4" id="h7-0-4" class="i">+        if (context.config.bool(ConfigProperty.STREAK_EXPIRATION_INFO)) {
</a>             hookAllEnums(context.mappings.getMappedClass(&quot;enums&quot;, &quot;FRIENDS_FEED&quot;)) { key, atomicValue -&gt;
                 if (key == &quot;STREAK_EXPIRATION_INFO&quot;) atomicValue.set(true)
             }
<b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -84,7 +84,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>                 )
                 onDownloadComplete()
             } catch (e: Throwable) {
<a href="#h8-0-3" id="h8-0-3" class="d">-                Logger.xposedLog(e)
</a><a href="#h8-0-4" id="h8-0-4" class="i">+                xposedLog(e)
</a>                 context.longToast(&quot;Failed to save file: &quot; + e.message)
                 return false
             }
<a href="#h8-1" id="h8-1" class="h">@@ -135,7 +135,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>         if (fFmpegSession.returnCode.value != 0) {
             mergedFile.delete()
             context.longToast(&quot;Failed to merge video and overlay. See logs for more details.&quot;)
<a href="#h8-1-3" id="h8-1-3" class="d">-            Logger.xposedLog(fFmpegSession.output)
</a><a href="#h8-1-4" id="h8-1-4" class="i">+            xposedLog(fFmpegSession.output)
</a>             return null
         }
         val mergedFileData: ByteArray = FileInputStream(mergedFile).readBytes()
<a href="#h8-2" id="h8-2" class="h">@@ -285,11 +285,18 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>         }
     }
 
<a href="#h8-2-3" id="h8-2-3" class="i">+    private fun canAutoDownload(): Boolean {
</a><a href="#h8-2-4" id="h8-2-4" class="i">+        return context.config.bool(ConfigProperty.AUTO_DOWNLOAD_SNAPS) ||
</a><a href="#h8-2-5" id="h8-2-5" class="i">+                context.config.bool(ConfigProperty.AUTO_DOWNLOAD_STORIES) ||
</a><a href="#h8-2-6" id="h8-2-6" class="i">+                context.config.bool(ConfigProperty.AUTO_DOWNLOAD_PUBLIC_STORIES) ||
</a><a href="#h8-2-7" id="h8-2-7" class="i">+                context.config.bool(ConfigProperty.AUTO_DOWNLOAD_SPOTLIGHT)
</a><a href="#h8-2-8" id="h8-2-8" class="i">+    }
</a><a href="#h8-2-9" id="h8-2-9" class="i">+
</a>     override fun asyncOnActivityCreate() {
         val operaViewerControllerClass: Class&lt;*&gt; = context.mappings.getMappedClass(&quot;OperaPageViewController&quot;, &quot;Class&quot;)
 
         val onOperaViewStateCallback: (HookAdapter) -&gt; Unit = onOperaViewStateCallback@{ param -&gt;
<a href="#h8-2-14" id="h8-2-14" class="d">-            if (!context.config.bool(ConfigProperty.MEDIA_DOWNLOADER)) return@onOperaViewStateCallback
</a><a href="#h8-2-15" id="h8-2-15" class="i">+            if (!canAutoDownload()) return@onOperaViewStateCallback
</a> 
             val viewState = (param.thisObject() as Any).getObjectField(context.mappings.getMappedValue(&quot;OperaPageViewController&quot;, &quot;viewStateField&quot;)).toString()
             if (viewState != &quot;FULLY_DISPLAYED&quot;) {
<a href="#h8-3" id="h8-3" class="h">@@ -317,7 +324,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>                 try {
                     handleOperaMedia(mediaParamMap, mediaInfoMap, false)
                 } catch (e: Throwable) {
<a href="#h8-3-3" id="h8-3-3" class="d">-                    Logger.xposedLog(e)
</a><a href="#h8-3-4" id="h8-3-4" class="i">+                    xposedLog(e)
</a>                     context.longToast(e.message!!)
                 }
             }
<a href="#h8-4" id="h8-4" class="h">@@ -390,7 +397,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>                     }
                 }
                 if (videoData == null || overlayData == null) {
<a href="#h8-4-3" id="h8-4-3" class="d">-                    Logger.xposedLog(&quot;Invalid data in zip file&quot;)
</a><a href="#h8-4-4" id="h8-4-4" class="i">+                    xposedLog(&quot;Invalid data in zip file&quot;)
</a>                     return
                 }
                 val mergedVideo = mergeOverlay(videoData, overlayData, isPreviewMode)
<b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -45,7 +45,7 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a>             if (chatInputBarSticker == viewId &amp;&amp; context.config.bool(ConfigProperty.REMOVE_STICKERS_BUTTON)) {
                 view.visibility = View.GONE
             }
<a href="#h9-0-3" id="h9-0-3" class="d">-            if (context.config.bool(ConfigProperty.REMOVE_CALLBUTTONS)) {
</a><a href="#h9-0-4" id="h9-0-4" class="i">+            if (context.config.bool(ConfigProperty.REMOVE_CALL_BUTTONS)) {
</a>                 if (viewId == callButton1 || viewId == callButton2) {
                     if (view.visibility == View.GONE) return@hook
                     Hooker.ephemeralHookObjectMethod(View::class.java, view, &quot;setVisibility&quot;, HookStage.BEFORE) { param -&gt;
<b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -64,15 +64,15 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>             val birthday = Calendar.getInstance()
             birthday[Calendar.MONTH] = (profile.birthday shr 32).toInt() - 1
             val message: String = &quot;&quot;&quot;
<a href="#h10-0-3" id="h10-0-3" class="d">-                ${context.translation.get(&quot;info.username&quot;)}: ${profile.username}
</a><a href="#h10-0-4" id="h10-0-4" class="d">-                ${context.translation.get(&quot;info.display_name&quot;)}: ${profile.displayName}
</a><a href="#h10-0-5" id="h10-0-5" class="d">-                ${context.translation.get(&quot;info.added_date&quot;)}: ${formatDate(addedTimestamp)}
</a><a href="#h10-0-6" id="h10-0-6" class="i">+                ${context.translation.get(&quot;profile_info.username&quot;)}: ${profile.username}
</a><a href="#h10-0-7" id="h10-0-7" class="i">+                ${context.translation.get(&quot;profile_info.display_name&quot;)}: ${profile.displayName}
</a><a href="#h10-0-8" id="h10-0-8" class="i">+                ${context.translation.get(&quot;profile_info.added_date&quot;)}: ${formatDate(addedTimestamp)}
</a>                 ${birthday.getDisplayName(
                     Calendar.MONTH,
                     Calendar.LONG,
<a href="#h10-0-12" id="h10-0-12" class="d">-                    context.translation.getLocale()
</a><a href="#h10-0-13" id="h10-0-13" class="i">+                    context.translation.locale
</a>                 )?.let {
<a href="#h10-0-15" id="h10-0-15" class="d">-                    context.translation.get(&quot;info.birthday&quot;)
</a><a href="#h10-0-16" id="h10-0-16" class="i">+                    context.translation.get(&quot;profile_info.birthday&quot;)
</a>                         .replace(&quot;{month}&quot;, it)
                         .replace(&quot;{day}&quot;, profile.birthday.toInt().toString())
                 }
<a href="#h10-1" id="h10-1" class="h">@@ -120,7 +120,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>                 }
             }
 
<a href="#h10-1-3" id="h10-1-3" class="d">-            var displayUsername = sender?.displayName ?: sender?.usernameForSorting?: &quot;Unknown user&quot;
</a><a href="#h10-1-4" id="h10-1-4" class="i">+            var displayUsername = sender?.displayName ?: sender?.usernameForSorting?: context.translation.get(&quot;conversation_preview.unknown_user&quot;)
</a> 
             if (displayUsername.length &gt; 12) {
                 displayUsername = displayUsername.substring(0, 13) + &quot;... &quot;
<a href="#h10-2" id="h10-2" class="h">@@ -136,7 +136,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>             val timeSecondDiff = ((it.streakExpirationTimestamp - System.currentTimeMillis()) / 1000 / 60).toInt()
             messageBuilder.append(&quot;\n\n&quot;)
                 .append(&quot;\uD83D\uDD25 &quot;) //fire emoji
<a href="#h10-2-3" id="h10-2-3" class="d">-                .append(context.translation.get(&quot;streak_expiration&quot;).format(
</a><a href="#h10-2-4" id="h10-2-4" class="i">+                .append(context.translation.get(&quot;conversation_preview.streak_expiration&quot;).format(
</a>                     timeSecondDiff / 60 / 24,
                     timeSecondDiff / 60 % 24,
                     timeSecondDiff % 60
<a href="#h10-3" id="h10-3" class="h">@@ -145,13 +145,13 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a> 
         //alert dialog
         val builder = AlertDialog.Builder(context.mainActivity)
<a href="#h10-3-3" id="h10-3-3" class="d">-        builder.setTitle(context.translation.get(&quot;preview&quot;))
</a><a href="#h10-3-4" id="h10-3-4" class="i">+        builder.setTitle(context.translation.get(&quot;conversation_preview.title&quot;))
</a>         builder.setMessage(messageBuilder.toString())
         builder.setPositiveButton(
             &quot;OK&quot;
         ) { dialog: DialogInterface, _: Int -&gt; dialog.dismiss() }
         targetPerson?.let {
<a href="#h10-3-10" id="h10-3-10" class="d">-            builder.setNegativeButton(context.translation.get(&quot;profile_info&quot;)) {_, _ -&gt;
</a><a href="#h10-3-11" id="h10-3-11" class="i">+            builder.setNegativeButton(context.translation.get(&quot;modal_option.profile_info&quot;)) {_, _ -&gt;
</a>                 context.executeAsync {
                     showProfileInfo(it)
                 }
<a href="#h10-4" id="h10-4" class="h">@@ -175,7 +175,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a> 
         //preview button
         val previewButton = Button(viewModel.context)
<a href="#h10-4-3" id="h10-4-3" class="d">-        previewButton.text = context.translation.get(&quot;preview&quot;)
</a><a href="#h10-4-4" id="h10-4-4" class="i">+        previewButton.text = context.translation.get(&quot;friend_menu_option.preview&quot;)
</a>         applyTheme(viewModel, previewButton)
         val finalFocusedConversationTargetUser = focusedConversationTargetUser
         previewButton.setOnClickListener { v: View? -&gt;
<a href="#h10-5" id="h10-5" class="h">@@ -188,7 +188,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a> 
         //stealth switch
         val stealthSwitch = Switch(viewModel.context)
<a href="#h10-5-3" id="h10-5-3" class="d">-        stealthSwitch.text = context.translation.get(&quot;stealth_mode&quot;)
</a><a href="#h10-5-4" id="h10-5-4" class="i">+        stealthSwitch.text = context.translation.get(&quot;friend_menu_option.stealth_mode&quot;)
</a>         stealthSwitch.isChecked = context.feature(StealthMode::class).isStealth(conversationId)
         applyTheme(viewModel, stealthSwitch)
         stealthSwitch.setOnCheckedChangeListener { _: CompoundButton?, isChecked: Boolean -&gt;
<a href="#h10-6" id="h10-6" class="h">@@ -202,7 +202,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>             val userId = context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId ?: return
 
             val antiAutoDownload = Switch(viewModel.context)
<a href="#h10-6-3" id="h10-6-3" class="d">-            antiAutoDownload.text = context.translation.get(&quot;anti_auto_download&quot;)
</a><a href="#h10-6-4" id="h10-6-4" class="i">+            antiAutoDownload.text = context.translation.get(&quot;friend_menu_option.anti_auto_download&quot;)
</a>             antiAutoDownload.isChecked = context.feature(AntiAutoDownload::class).isUserIgnored(userId)
             applyTheme(viewModel, antiAutoDownload)
             antiAutoDownload.setOnCheckedChangeListener { _: CompoundButton?, isChecked: Boolean -&gt;
<b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -44,9 +44,7 @@ class MappingManager(private val context: ModContext) : Manager {
</a>             runCatching {
                 loadCached()
             }.onFailure {
<a href="#h11-0-3" id="h11-0-3" class="d">-                context.shortToast(&quot;Failed to load cached mappings ${it.message}&quot;)
</a><a href="#h11-0-4" id="h11-0-4" class="d">-                Logger.xposedLog(it)
</a><a href="#h11-0-5" id="h11-0-5" class="d">-                context.delayForceCloseApp(1000)
</a><a href="#h11-0-6" id="h11-0-6" class="i">+                context.crash(&quot;Failed to load cached mappings ${it.message}&quot;, it)
</a>             }
 
             if (snapBuildNumber != currentBuildNumber) {
<a href="#h11-1" id="h11-1" class="h">@@ -60,9 +58,7 @@ class MappingManager(private val context: ModContext) : Manager {
</a>         }.onSuccess {
             context.shortToast(&quot;Generated mappings for build $snapBuildNumber&quot;)
         }.onFailure {
<a href="#h11-1-3" id="h11-1-3" class="d">-            context.shortToast(&quot;Failed to generate mappings ${it.message}&quot;)
</a><a href="#h11-1-4" id="h11-1-4" class="d">-            Logger.xposedLog(it)
</a><a href="#h11-1-5" id="h11-1-5" class="d">-            context.delayForceCloseApp(1000)
</a><a href="#h11-1-6" id="h11-1-6" class="i">+            context.crash(&quot;Failed to generate mappings ${it.message}&quot;, it)
</a>         }
     }
 
<b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,5 +1,7 @@
</a> package me.rhunk.snapenhance.manager.impl
 
<a href="#h12-0-2" id="h12-0-2" class="i">+import com.google.gson.JsonParser
</a><a href="#h12-0-3" id="h12-0-3" class="i">+import me.rhunk.snapenhance.Logger
</a> import me.rhunk.snapenhance.ModContext
 import me.rhunk.snapenhance.manager.Manager
 import java.util.*
<a href="#h12-1" id="h12-1" class="h">@@ -7,13 +9,32 @@ import java.util.*
</a> class TranslationManager(
     private val context: ModContext
 ) : Manager {
<a href="#h12-1-3" id="h12-1-3" class="i">+    private val translationMap = mutableMapOf&lt;String, String&gt;()
</a><a href="#h12-1-4" id="h12-1-4" class="i">+    lateinit var locale: Locale
</a><a href="#h12-1-5" id="h12-1-5" class="i">+
</a>     override fun init() {
<a href="#h12-1-7" id="h12-1-7" class="i">+        val messageLocaleResult = context.bridgeClient.fetchTranslations();
</a><a href="#h12-1-8" id="h12-1-8" class="i">+        locale = Locale(messageLocaleResult.locale!!)
</a><a href="#h12-1-9" id="h12-1-9" class="i">+
</a><a href="#h12-1-10" id="h12-1-10" class="i">+        val translations = JsonParser.parseString(messageLocaleResult.content?.toString(Charsets.UTF_8)).asJsonObject
</a><a href="#h12-1-11" id="h12-1-11" class="i">+        if (translations == null || translations.isJsonNull) {
</a><a href="#h12-1-12" id="h12-1-12" class="i">+            context.crash(&quot;Failed to fetch translations&quot;)
</a><a href="#h12-1-13" id="h12-1-13" class="i">+            return
</a><a href="#h12-1-14" id="h12-1-14" class="i">+        }
</a> 
<a href="#h12-1-16" id="h12-1-16" class="i">+        translations.asJsonObject.entrySet().forEach {
</a><a href="#h12-1-17" id="h12-1-17" class="i">+            if (it.value.isJsonPrimitive) {
</a><a href="#h12-1-18" id="h12-1-18" class="i">+                translationMap[it.key] = it.value.asString
</a><a href="#h12-1-19" id="h12-1-19" class="i">+            }
</a><a href="#h12-1-20" id="h12-1-20" class="i">+            if (!it.value.isJsonObject) return@forEach
</a><a href="#h12-1-21" id="h12-1-21" class="i">+            it.value.asJsonObject.entrySet().forEach { entry -&gt;
</a><a href="#h12-1-22" id="h12-1-22" class="i">+                translationMap[&quot;${it.key}.${entry.key}&quot;] = entry.value.asString
</a><a href="#h12-1-23" id="h12-1-23" class="i">+            }
</a><a href="#h12-1-24" id="h12-1-24" class="i">+        }
</a>     }
 
<a href="#h12-1-27" id="h12-1-27" class="d">-    fun getLocale(): Locale = Locale.getDefault()
</a> 
     fun get(key: String): String {
<a href="#h12-1-30" id="h12-1-30" class="d">-        return key
</a><a href="#h12-1-31" id="h12-1-31" class="i">+        return translationMap[key] ?: key.also { Logger.xposedLog(&quot;Missing translation for $key&quot;) }
</a>     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h13" href="../file/app/src/main/res/values-fr/strings.xml.html">app/src/main/res/values-fr/strings.xml</a> b/<a href="../file/app/src/main/res/values-fr/strings.xml.html">app/src/main/res/values-fr/strings.xml</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,4 +0,0 @@
</a><a href="#h13-0-0" id="h13-0-0" class="d">-&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
</a><a href="#h13-0-1" id="h13-0-1" class="d">-&lt;resources&gt;
</a><a href="#h13-0-2" id="h13-0-2" class="d">-
</a><a href="#h13-0-3" id="h13-0-3" class="d">-&lt;/resources&gt;</a><a href="#h13-0-4" id="h13-0-4" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/app/src/main/res/values/strings.xml.html">app/src/main/res/values/strings.xml</a> b/<a href="../file/app/src/main/res/values/strings.xml.html">app/src/main/res/values/strings.xml</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,33 +1,3 @@
</a> &lt;resources&gt;
     &lt;string name=&quot;app_name&quot; translatable=&quot;false&quot;&gt;Snap Enhance&lt;/string&gt;
<a href="#h14-0-2" id="h14-0-2" class="d">-    &lt;string name=&quot;property.save_folder&quot;&gt;Save folder&lt;/string&gt;
</a><a href="#h14-0-3" id="h14-0-3" class="d">-    &lt;string name=&quot;property.prevent_read_receipts&quot;&gt;Prevent read receipts&lt;/string&gt;
</a><a href="#h14-0-4" id="h14-0-4" class="d">-    &lt;string name=&quot;property.hide_bitmoji_presence&quot;&gt;Hide Bitmoji presence&lt;/string&gt;
</a><a href="#h14-0-5" id="h14-0-5" class="d">-    &lt;string name=&quot;property.show_message_content&quot;&gt;Show message content&lt;/string&gt;
</a><a href="#h14-0-6" id="h14-0-6" class="d">-    &lt;string name=&quot;property.message_logger&quot;&gt;Message logger&lt;/string&gt;
</a><a href="#h14-0-7" id="h14-0-7" class="d">-    &lt;string name=&quot;property.media_downloader_feature&quot;&gt;Media downloader feature&lt;/string&gt;
</a><a href="#h14-0-8" id="h14-0-8" class="d">-    &lt;string name=&quot;property.download_stories&quot;&gt;Download stories&lt;/string&gt;
</a><a href="#h14-0-9" id="h14-0-9" class="d">-    &lt;string name=&quot;property.download_public_stories&quot;&gt;Download public stories&lt;/string&gt;
</a><a href="#h14-0-10" id="h14-0-10" class="d">-    &lt;string name=&quot;property.download_spotlight&quot;&gt;Download spotlight&lt;/string&gt;
</a><a href="#h14-0-11" id="h14-0-11" class="d">-    &lt;string name=&quot;property.overlay_merge&quot;&gt;Overlay merge&lt;/string&gt;
</a><a href="#h14-0-12" id="h14-0-12" class="d">-    &lt;string name=&quot;property.download_inchat_snaps&quot;&gt;Download in chat snaps&lt;/string&gt;
</a><a href="#h14-0-13" id="h14-0-13" class="d">-    &lt;string name=&quot;property.disable_metrics&quot;&gt;Disable metrics&lt;/string&gt;
</a><a href="#h14-0-14" id="h14-0-14" class="d">-    &lt;string name=&quot;property.prevent_screenshot&quot;&gt;Prevent screenshot&lt;/string&gt;
</a><a href="#h14-0-15" id="h14-0-15" class="d">-    &lt;string name=&quot;property.anonymous_story_view&quot;&gt;Anonymous story view&lt;/string&gt;
</a><a href="#h14-0-16" id="h14-0-16" class="d">-    &lt;string name=&quot;property.hide_typing_notification&quot;&gt;Hide typing notification&lt;/string&gt;
</a><a href="#h14-0-17" id="h14-0-17" class="d">-    &lt;string name=&quot;property.menu_slot_id&quot;&gt;Menu slot id&lt;/string&gt;
</a><a href="#h14-0-18" id="h14-0-18" class="d">-    &lt;string name=&quot;property.message_preview_length&quot;&gt;Message preview length&lt;/string&gt;
</a><a href="#h14-0-19" id="h14-0-19" class="d">-    &lt;string name=&quot;property.auto_save&quot;&gt;Auto save&lt;/string&gt;
</a><a href="#h14-0-20" id="h14-0-20" class="d">-    &lt;string name=&quot;property.external_media_as_snap&quot;&gt;External media as snap&lt;/string&gt;
</a><a href="#h14-0-21" id="h14-0-21" class="d">-    &lt;string name=&quot;property.conversation_export&quot;&gt;Conversation export&lt;/string&gt;
</a><a href="#h14-0-22" id="h14-0-22" class="d">-    &lt;string name=&quot;property.snapchat_plus&quot;&gt;Snapchat Plus&lt;/string&gt;
</a><a href="#h14-0-23" id="h14-0-23" class="d">-    &lt;string name=&quot;property.remove_voice_record_button&quot;&gt;Remove voice record button&lt;/string&gt;
</a><a href="#h14-0-24" id="h14-0-24" class="d">-    &lt;string name=&quot;property.remove_stickers_button&quot;&gt;Remove stickers button&lt;/string&gt;
</a><a href="#h14-0-25" id="h14-0-25" class="d">-    &lt;string name=&quot;property.remove_cognac_button&quot;&gt;Remove cognac button&lt;/string&gt;
</a><a href="#h14-0-26" id="h14-0-26" class="d">-    &lt;string name=&quot;property.remove_callbuttons&quot;&gt;Remove call buttons&lt;/string&gt;
</a><a href="#h14-0-27" id="h14-0-27" class="d">-    &lt;string name=&quot;property.long_snap_sending&quot;&gt;Long snap sending&lt;/string&gt;
</a><a href="#h14-0-28" id="h14-0-28" class="d">-    &lt;string name=&quot;property.block_ads&quot;&gt;Block ads&lt;/string&gt;
</a><a href="#h14-0-29" id="h14-0-29" class="d">-    &lt;string name=&quot;property.streakexpirationinfo&quot;&gt;Streak Expiration Info&lt;/string&gt;
</a><a href="#h14-0-30" id="h14-0-30" class="d">-    &lt;string name=&quot;property.new_map_ui&quot;&gt;New map ui&lt;/string&gt;
</a><a href="#h14-0-31" id="h14-0-31" class="d">-    &lt;string name=&quot;property.use_download_manager&quot;&gt;Use download manager&lt;/string&gt;
</a> &lt;/resources&gt; 
\ No newline at end of file
</pre>
</div>
</body>
</html>
