<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>refactor: debug properties - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/97806d693e3cbf8e8cfe57bee4d414a80fe15651.html">97806d693e3cbf8e8cfe57bee4d414a80fe15651</a>
<b>parent</b> <a href="../commit/4ecf5f81773dd351c2f99b1dfd8a435f98da4468.html">4ecf5f81773dd351c2f99b1dfd8a435f98da4468</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sun, 10 Mar 2024 12:37:11 +0100

refactor: debug properties

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">common/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">common/src/main/kotlin/me/rhunk/snapenhance/common/database/impl/FriendInfo.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">++++</span><span class="d">--</span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">core/src/main/kotlin/me/rhunk/snapenhance/core/action/ActionManager.kt</a></td><td> | </td><td class="num">42</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">core/src/main/kotlin/me/rhunk/snapenhance/core/database/DatabaseAccess.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">core/src/main/kotlin/me/rhunk/snapenhance/core/event/EventDispatcher.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">++</span><span class="d">----</span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a></td><td> | </td><td class="num">193</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h12">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/Manager.kt</a></td><td> | </td><td class="num">7</td><td><span class="i"></span><span class="d">-------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h13">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt</a></td><td> | </td><td class="num">46</td><td><span class="i"></span><span class="d">----------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h14">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt</a></td><td> | </td><td class="num">190</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
</table></pre><pre>15 files changed, 295 insertions(+), 261 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -198,7 +198,7 @@ class RemoteSideContext(
</a>             }
         }
 
<a href="#h0-0-3" id="h0-0-3" class="d">-        if (mappings.isMappingsOutdated() || !mappings.isMappingsLoaded) {
</a><a href="#h0-0-4" id="h0-0-4" class="i">+        if (!sharedPreferences.getBoolean(&quot;debug_disable_mapper&quot;, false) &amp;&amp; (mappings.isMappingsOutdated() || !mappings.isMappingsLoaded)) {
</a>             requirements = requirements or Requirements.MAPPINGS
         }
 
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -202,5 +202,9 @@ class BridgeService : Service() {
</a>         override fun registerConfigStateListener(listener: ConfigStateListener) {
             remoteSideContext.config.configStateListener = listener
         }
<a href="#h1-0-3" id="h1-0-3" class="i">+
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        override fun getDebugProp(key: String, defaultValue: String?): String? {
</a><a href="#h1-0-5" id="h1-0-5" class="i">+            return remoteSideContext.sharedPreferences.all[&quot;debug_$key&quot;]?.toString() ?: defaultValue
</a><a href="#h1-0-6" id="h1-0-6" class="i">+        }
</a>     }
 }
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,5 +1,6 @@
</a> package me.rhunk.snapenhance.ui.manager.pages.home
 
<a href="#h2-0-2" id="h2-0-2" class="i">+import android.content.SharedPreferences
</a> import androidx.compose.foundation.ScrollState
 import androidx.compose.foundation.clickable
 import androidx.compose.foundation.layout.*
<a href="#h2-1" id="h2-1" class="h">@@ -41,6 +42,30 @@ class HomeSettings : Routes.Route() {
</a>     }
 
     @Composable
<a href="#h2-1-3" id="h2-1-3" class="i">+    private fun PreferenceToggle(sharedPreferences: SharedPreferences, key: String, text: String) {
</a><a href="#h2-1-4" id="h2-1-4" class="i">+        val realKey = &quot;debug_$key&quot;
</a><a href="#h2-1-5" id="h2-1-5" class="i">+        var value by remember { mutableStateOf(sharedPreferences.getBoolean(realKey, false)) }
</a><a href="#h2-1-6" id="h2-1-6" class="i">+
</a><a href="#h2-1-7" id="h2-1-7" class="i">+        Row(
</a><a href="#h2-1-8" id="h2-1-8" class="i">+            modifier = Modifier
</a><a href="#h2-1-9" id="h2-1-9" class="i">+                .fillMaxWidth()
</a><a href="#h2-1-10" id="h2-1-10" class="i">+                .height(55.dp)
</a><a href="#h2-1-11" id="h2-1-11" class="i">+                .clickable {
</a><a href="#h2-1-12" id="h2-1-12" class="i">+                    value = !value
</a><a href="#h2-1-13" id="h2-1-13" class="i">+                    sharedPreferences.edit().putBoolean(realKey, value).apply()
</a><a href="#h2-1-14" id="h2-1-14" class="i">+                },
</a><a href="#h2-1-15" id="h2-1-15" class="i">+            horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h2-1-16" id="h2-1-16" class="i">+            verticalAlignment = Alignment.CenterVertically
</a><a href="#h2-1-17" id="h2-1-17" class="i">+        ) {
</a><a href="#h2-1-18" id="h2-1-18" class="i">+            Text(text = text)
</a><a href="#h2-1-19" id="h2-1-19" class="i">+            Switch(checked = value, onCheckedChange = {
</a><a href="#h2-1-20" id="h2-1-20" class="i">+                value = it
</a><a href="#h2-1-21" id="h2-1-21" class="i">+                sharedPreferences.edit().putBoolean(realKey, it).apply()
</a><a href="#h2-1-22" id="h2-1-22" class="i">+            }, modifier = Modifier.padding(end = 26.dp))
</a><a href="#h2-1-23" id="h2-1-23" class="i">+        }
</a><a href="#h2-1-24" id="h2-1-24" class="i">+    }
</a><a href="#h2-1-25" id="h2-1-25" class="i">+
</a><a href="#h2-1-26" id="h2-1-26" class="i">+    @Composable
</a>     private fun RowAction(title: String, requireConfirmation: Boolean = false, action: () -&gt; Unit) {
         var confirmationDialog by remember {
             mutableStateOf(false)
<a href="#h2-2" id="h2-2" class="h">@@ -184,7 +209,9 @@ class HomeSettings : Routes.Route() {
</a>                         }
                     }
                     OutlinedButton(
<a href="#h2-2-3" id="h2-2-3" class="d">-                        modifier = Modifier.fillMaxWidth().padding(5.dp),
</a><a href="#h2-2-4" id="h2-2-4" class="i">+                        modifier = Modifier
</a><a href="#h2-2-5" id="h2-2-5" class="i">+                            .fillMaxWidth()
</a><a href="#h2-2-6" id="h2-2-6" class="i">+                            .padding(5.dp),
</a>                         onClick = {
                             routes.loggerHistory.navigate()
                         }
<a href="#h2-3" id="h2-3" class="h">@@ -194,7 +221,7 @@ class HomeSettings : Routes.Route() {
</a>                 }
             }
 
<a href="#h2-3-3" id="h2-3-3" class="d">-            RowTitle(title = &quot;Clear App Files&quot;)
</a><a href="#h2-3-4" id="h2-3-4" class="i">+            RowTitle(title = &quot;Debug&quot;)
</a>             Row(
                 horizontalArrangement = Arrangement.SpaceBetween,
                 verticalAlignment = Alignment.CenterVertically,
<a href="#h2-4" id="h2-4" class="h">@@ -210,7 +237,7 @@ class HomeSettings : Routes.Route() {
</a>                     ExposedDropdownMenuBox(
                         expanded = expanded,
                         onExpandedChange = { expanded = it },
<a href="#h2-4-3" id="h2-4-3" class="d">-                        modifier = Modifier.fillMaxWidth(0.8f)
</a><a href="#h2-4-4" id="h2-4-4" class="i">+                        modifier = Modifier.fillMaxWidth(0.7f)
</a>                     ) {
                         TextField(
                             value = selectedFileType.displayName,
<a href="#h2-5" id="h2-5" class="h">@@ -241,7 +268,16 @@ class HomeSettings : Routes.Route() {
</a>                         context.shortToast(&quot;Done!&quot;)
                     }
                 }) {
<a href="#h2-5-3" id="h2-5-3" class="d">-                    Text(text = &quot;Clear&quot;)
</a><a href="#h2-5-4" id="h2-5-4" class="i">+                    Text(text = &quot;Clear File&quot;)
</a><a href="#h2-5-5" id="h2-5-5" class="i">+                }
</a><a href="#h2-5-6" id="h2-5-6" class="i">+            }
</a><a href="#h2-5-7" id="h2-5-7" class="i">+            ShiftedRow {
</a><a href="#h2-5-8" id="h2-5-8" class="i">+                Column(
</a><a href="#h2-5-9" id="h2-5-9" class="i">+                    verticalArrangement = Arrangement.spacedBy(4.dp),
</a><a href="#h2-5-10" id="h2-5-10" class="i">+                ) {
</a><a href="#h2-5-11" id="h2-5-11" class="i">+                    PreferenceToggle(context.sharedPreferences, key = &quot;disable_feature_loading&quot;, text = &quot;Disable Feature Loading&quot;)
</a><a href="#h2-5-12" id="h2-5-12" class="i">+                    PreferenceToggle(context.sharedPreferences, key = &quot;disable_mapper&quot;, text = &quot;Disable Auto Mapper&quot;)
</a><a href="#h2-5-13" id="h2-5-13" class="i">+                    PreferenceToggle(context.sharedPreferences, key = &quot;force_native_load&quot;, text = &quot;Force Native Load&quot;)
</a>                 }
             }
             Spacer(modifier = Modifier.height(50.dp))
<b>diff --git a/<a id="h3" href="../file/common/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">common/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a> b/<a href="../file/common/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">common/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -94,4 +94,6 @@ interface BridgeInterface {
</a>     oneway void closeSettingsOverlay();
 
     oneway void registerConfigStateListener(in ConfigStateListener listener);
<a href="#h3-0-3" id="h3-0-3" class="i">+
</a><a href="#h3-0-4" id="h3-0-4" class="i">+    @nullable String getDebugProp(String key, @nullable String defaultValue);
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h4" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/database/impl/FriendInfo.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/database/impl/FriendInfo.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/database/impl/FriendInfo.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/database/impl/FriendInfo.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -59,7 +59,7 @@ data class FriendInfo(
</a>             serverDisplayName = getStringOrNull(&quot;serverDisplayName&quot;)
             streakLength = getInteger(&quot;streakLength&quot;)
             streakExpirationTimestamp = getLong(&quot;streakExpiration&quot;)
<a href="#h4-0-3" id="h4-0-3" class="d">-            reverseBestFriendRanking = getInteger(&quot;reverseBestFriendRanking&quot;)
</a><a href="#h4-0-4" id="h4-0-4" class="i">+            reverseBestFriendRanking = getIntOrNull(&quot;reverseBestFriendRanking&quot;) ?: 0
</a>             usernameForSorting = getStringOrNull(&quot;usernameForSorting&quot;)
             friendLinkType = getInteger(&quot;friendLinkType&quot;)
             postViewEmoji = getStringOrNull(&quot;postViewEmoji&quot;)
<a href="#h4-1" id="h4-1" class="h">@@ -68,5 +68,4 @@ data class FriendInfo(
</a>             plusBadgeVisibility = getIntOrNull(&quot;plusBadgeVisibility&quot;) ?: 0
         }
     }
<a href="#h4-1-3" id="h4-1-3" class="d">-
</a> }
<b>diff --git a/<a id="h5" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -24,8 +24,8 @@ import me.rhunk.snapenhance.core.event.EventBus
</a> import me.rhunk.snapenhance.core.event.EventDispatcher
 import me.rhunk.snapenhance.core.features.Feature
 import me.rhunk.snapenhance.core.logger.CoreLogger
<a href="#h5-0-3" id="h5-0-3" class="d">-import me.rhunk.snapenhance.core.manager.impl.ActionManager
</a><a href="#h5-0-4" id="h5-0-4" class="d">-import me.rhunk.snapenhance.core.manager.impl.FeatureManager
</a><a href="#h5-0-5" id="h5-0-5" class="i">+import me.rhunk.snapenhance.core.action.ActionManager
</a><a href="#h5-0-6" id="h5-0-6" class="i">+import me.rhunk.snapenhance.core.features.FeatureManager
</a> import me.rhunk.snapenhance.core.messaging.CoreMessagingBridge
 import me.rhunk.snapenhance.core.messaging.MessageSender
 import me.rhunk.snapenhance.core.scripting.CoreScriptRuntime
<b>diff --git a/<a id="h6" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -132,7 +132,6 @@ class SnapEnhance {
</a>             }
 
             reloadConfig()
<a href="#h6-0-3" id="h6-0-3" class="d">-            actionManager.init()
</a>             initConfigListener()
             initWidgetListener()
             initNative()
<a href="#h6-1" id="h6-1" class="h">@@ -175,7 +174,10 @@ class SnapEnhance {
</a> 
     private fun initNative() {
         // don&#39;t initialize native when not logged in
<a href="#h6-1-3" id="h6-1-3" class="d">-        if (appContext.androidContext.getSharedPreferences(&quot;user_session_shared_pref&quot;, 0).getString(&quot;key_user_id&quot;, null) == null) return
</a><a href="#h6-1-4" id="h6-1-4" class="i">+        if (
</a><a href="#h6-1-5" id="h6-1-5" class="i">+            appContext.androidContext.getSharedPreferences(&quot;user_session_shared_pref&quot;, 0).getString(&quot;key_user_id&quot;, null) == null &amp;&amp;
</a><a href="#h6-1-6" id="h6-1-6" class="i">+            appContext.bridgeClient.getDebugProp(&quot;force_native_load&quot;, null) != &quot;true&quot;
</a><a href="#h6-1-7" id="h6-1-7" class="i">+        ) return
</a>         if (appContext.config.experimental.nativeHooks.globalState != true) return
 
         lateinit var unhook: () -&gt; Unit
<b>diff --git a/<a id="h7" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/action/ActionManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/action/ActionManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/action/ActionManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/action/ActionManager.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,41 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+package me.rhunk.snapenhance.core.action
</a><a href="#h7-0-1" id="h7-0-1" class="i">+
</a><a href="#h7-0-2" id="h7-0-2" class="i">+import android.content.Intent
</a><a href="#h7-0-3" id="h7-0-3" class="i">+import me.rhunk.snapenhance.common.action.EnumAction
</a><a href="#h7-0-4" id="h7-0-4" class="i">+import me.rhunk.snapenhance.core.ModContext
</a><a href="#h7-0-5" id="h7-0-5" class="i">+import me.rhunk.snapenhance.core.action.impl.BulkMessagingAction
</a><a href="#h7-0-6" id="h7-0-6" class="i">+import me.rhunk.snapenhance.core.action.impl.CleanCache
</a><a href="#h7-0-7" id="h7-0-7" class="i">+import me.rhunk.snapenhance.core.action.impl.ExportChatMessages
</a><a href="#h7-0-8" id="h7-0-8" class="i">+import me.rhunk.snapenhance.core.action.impl.ExportMemories
</a><a href="#h7-0-9" id="h7-0-9" class="i">+
</a><a href="#h7-0-10" id="h7-0-10" class="i">+class ActionManager(
</a><a href="#h7-0-11" id="h7-0-11" class="i">+    private val modContext: ModContext,
</a><a href="#h7-0-12" id="h7-0-12" class="i">+) {
</a><a href="#h7-0-13" id="h7-0-13" class="i">+
</a><a href="#h7-0-14" id="h7-0-14" class="i">+    private val actions by lazy {
</a><a href="#h7-0-15" id="h7-0-15" class="i">+        mapOf(
</a><a href="#h7-0-16" id="h7-0-16" class="i">+            EnumAction.CLEAN_CACHE to CleanCache(),
</a><a href="#h7-0-17" id="h7-0-17" class="i">+            EnumAction.EXPORT_CHAT_MESSAGES to ExportChatMessages(),
</a><a href="#h7-0-18" id="h7-0-18" class="i">+            EnumAction.BULK_MESSAGING_ACTION to BulkMessagingAction(),
</a><a href="#h7-0-19" id="h7-0-19" class="i">+            EnumAction.EXPORT_MEMORIES to ExportMemories(),
</a><a href="#h7-0-20" id="h7-0-20" class="i">+        ).map {
</a><a href="#h7-0-21" id="h7-0-21" class="i">+            it.key to it.value.apply {
</a><a href="#h7-0-22" id="h7-0-22" class="i">+                this.context = modContext
</a><a href="#h7-0-23" id="h7-0-23" class="i">+            }
</a><a href="#h7-0-24" id="h7-0-24" class="i">+        }.toMap().toMutableMap()
</a><a href="#h7-0-25" id="h7-0-25" class="i">+    }
</a><a href="#h7-0-26" id="h7-0-26" class="i">+
</a><a href="#h7-0-27" id="h7-0-27" class="i">+    fun onNewIntent(intent: Intent?) {
</a><a href="#h7-0-28" id="h7-0-28" class="i">+        val action = intent?.getStringExtra(EnumAction.ACTION_PARAMETER) ?: return
</a><a href="#h7-0-29" id="h7-0-29" class="i">+        intent.removeExtra(EnumAction.ACTION_PARAMETER)
</a><a href="#h7-0-30" id="h7-0-30" class="i">+        execute(EnumAction.entries.find { it.key == action } ?: return)
</a><a href="#h7-0-31" id="h7-0-31" class="i">+    }
</a><a href="#h7-0-32" id="h7-0-32" class="i">+
</a><a href="#h7-0-33" id="h7-0-33" class="i">+    fun execute(enumAction: EnumAction) {
</a><a href="#h7-0-34" id="h7-0-34" class="i">+        val action = actions[enumAction] ?: return
</a><a href="#h7-0-35" id="h7-0-35" class="i">+        action.run()
</a><a href="#h7-0-36" id="h7-0-36" class="i">+        if (enumAction.exitOnFinish) {
</a><a href="#h7-0-37" id="h7-0-37" class="i">+            modContext.forceCloseApp()
</a><a href="#h7-0-38" id="h7-0-38" class="i">+        }
</a><a href="#h7-0-39" id="h7-0-39" class="i">+    }
</a><a href="#h7-0-40" id="h7-0-40" class="i">+}</a><a href="#h7-0-41" id="h7-0-41" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h8" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -209,4 +209,6 @@ class BridgeClient(
</a>     fun closeSettingsOverlay() = safeServiceCall { service.closeSettingsOverlay() }
 
     fun registerConfigStateListener(listener: ConfigStateListener) = safeServiceCall { service.registerConfigStateListener(listener) }
<a href="#h8-0-3" id="h8-0-3" class="i">+
</a><a href="#h8-0-4" id="h8-0-4" class="i">+    fun getDebugProp(name: String, defaultValue: String? = null) = safeServiceCall { service.getDebugProp(name, defaultValue) }
</a> }
<b>diff --git a/<a id="h9" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/database/DatabaseAccess.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/database/DatabaseAccess.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/database/DatabaseAccess.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/database/DatabaseAccess.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -17,7 +17,6 @@ import me.rhunk.snapenhance.common.util.ktx.getInteger
</a> import me.rhunk.snapenhance.common.util.ktx.getStringOrNull
 import me.rhunk.snapenhance.common.util.protobuf.ProtoReader
 import me.rhunk.snapenhance.core.ModContext
<a href="#h9-0-3" id="h9-0-3" class="d">-import me.rhunk.snapenhance.core.manager.Manager
</a> import me.rhunk.snapenhance.nativelib.NativeLib
 
 
<a href="#h9-1" id="h9-1" class="h">@@ -30,7 +29,7 @@ enum class DatabaseType(
</a> 
 class DatabaseAccess(
     private val context: ModContext
<a href="#h9-1-3" id="h9-1-3" class="d">-) : Manager {
</a><a href="#h9-1-4" id="h9-1-4" class="i">+) {
</a>     private val openedDatabases = mutableMapOf&lt;DatabaseType, SQLiteDatabase&gt;()
 
     private fun useDatabase(database: DatabaseType, writeMode: Boolean = false): SQLiteDatabase? {
<a href="#h9-2" id="h9-2" class="h">@@ -118,7 +117,7 @@ class DatabaseAccess(
</a>     fun hasMain(): Boolean = useDatabase(DatabaseType.MAIN)?.isOpen == true
     fun hasArroyo(): Boolean = useDatabase(DatabaseType.ARROYO)?.isOpen == true
 
<a href="#h9-2-3" id="h9-2-3" class="d">-    override fun init() {
</a><a href="#h9-2-4" id="h9-2-4" class="i">+    fun init() {
</a>         // perform integrity check on databases
         DatabaseType.entries.forEach { type -&gt;
             useDatabase(type, writeMode = true)?.apply {
<b>diff --git a/<a id="h10" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/event/EventDispatcher.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/event/EventDispatcher.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/event/EventDispatcher.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/event/EventDispatcher.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -7,7 +7,6 @@ import android.view.ViewGroup.LayoutParams
</a> import me.rhunk.snapenhance.common.util.snap.SnapWidgetBroadcastReceiverHelper
 import me.rhunk.snapenhance.core.ModContext
 import me.rhunk.snapenhance.core.event.events.impl.*
<a href="#h10-0-3" id="h10-0-3" class="d">-import me.rhunk.snapenhance.core.manager.Manager
</a> import me.rhunk.snapenhance.core.util.hook.HookStage
 import me.rhunk.snapenhance.core.util.hook.Hooker
 import me.rhunk.snapenhance.core.util.hook.hook
<a href="#h10-1" id="h10-1" class="h">@@ -23,7 +22,7 @@ import java.nio.ByteBuffer
</a> 
 class EventDispatcher(
     private val context: ModContext
<a href="#h10-1-3" id="h10-1-3" class="d">-) : Manager {
</a><a href="#h10-1-4" id="h10-1-4" class="i">+) {
</a>     private fun hookViewBinder() {
         context.mappings.useMapper(ViewBinderMapper::class) {
             val cachedHooks = mutableListOf&lt;String&gt;()
<a href="#h10-2" id="h10-2" class="h">@@ -60,8 +59,7 @@ class EventDispatcher(
</a> 
     }
 
<a href="#h10-2-3" id="h10-2-3" class="d">-
</a><a href="#h10-2-4" id="h10-2-4" class="d">-    override fun init() {
</a><a href="#h10-2-5" id="h10-2-5" class="i">+    fun init() {
</a>         context.classCache.conversationManager.hook(&quot;sendMessageWithContent&quot;, HookStage.BEFORE) { param -&gt;
             context.event.post(SendMessageWithContentEvent(
                 destinations = MessageDestinations(param.arg(0)),
<b>diff --git a/<a id="h11" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,192 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+package me.rhunk.snapenhance.core.features
</a><a href="#h11-0-1" id="h11-0-1" class="i">+
</a><a href="#h11-0-2" id="h11-0-2" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h11-0-3" id="h11-0-3" class="i">+import kotlinx.coroutines.launch
</a><a href="#h11-0-4" id="h11-0-4" class="i">+import kotlinx.coroutines.runBlocking
</a><a href="#h11-0-5" id="h11-0-5" class="i">+import me.rhunk.snapenhance.core.ModContext
</a><a href="#h11-0-6" id="h11-0-6" class="i">+import me.rhunk.snapenhance.core.features.impl.ConfigurationOverride
</a><a href="#h11-0-7" id="h11-0-7" class="i">+import me.rhunk.snapenhance.core.features.impl.MixerStories
</a><a href="#h11-0-8" id="h11-0-8" class="i">+import me.rhunk.snapenhance.core.features.impl.OperaViewerParamsOverride
</a><a href="#h11-0-9" id="h11-0-9" class="i">+import me.rhunk.snapenhance.core.features.impl.ScopeSync
</a><a href="#h11-0-10" id="h11-0-10" class="i">+import me.rhunk.snapenhance.core.features.impl.downloader.MediaDownloader
</a><a href="#h11-0-11" id="h11-0-11" class="i">+import me.rhunk.snapenhance.core.features.impl.downloader.ProfilePictureDownloader
</a><a href="#h11-0-12" id="h11-0-12" class="i">+import me.rhunk.snapenhance.core.features.impl.experiments.*
</a><a href="#h11-0-13" id="h11-0-13" class="i">+import me.rhunk.snapenhance.core.features.impl.global.*
</a><a href="#h11-0-14" id="h11-0-14" class="i">+import me.rhunk.snapenhance.core.features.impl.messaging.*
</a><a href="#h11-0-15" id="h11-0-15" class="i">+import me.rhunk.snapenhance.core.features.impl.spying.HalfSwipeNotifier
</a><a href="#h11-0-16" id="h11-0-16" class="i">+import me.rhunk.snapenhance.core.features.impl.spying.MessageLogger
</a><a href="#h11-0-17" id="h11-0-17" class="i">+import me.rhunk.snapenhance.core.features.impl.spying.StealthMode
</a><a href="#h11-0-18" id="h11-0-18" class="i">+import me.rhunk.snapenhance.core.features.impl.tweaks.BypassScreenshotDetection
</a><a href="#h11-0-19" id="h11-0-19" class="i">+import me.rhunk.snapenhance.core.features.impl.tweaks.CameraTweaks
</a><a href="#h11-0-20" id="h11-0-20" class="i">+import me.rhunk.snapenhance.core.features.impl.tweaks.DisablePermissionRequests
</a><a href="#h11-0-21" id="h11-0-21" class="i">+import me.rhunk.snapenhance.core.features.impl.tweaks.PreventMessageListAutoScroll
</a><a href="#h11-0-22" id="h11-0-22" class="i">+import me.rhunk.snapenhance.core.features.impl.tweaks.UnsaveableMessages
</a><a href="#h11-0-23" id="h11-0-23" class="i">+import me.rhunk.snapenhance.core.features.impl.ui.*
</a><a href="#h11-0-24" id="h11-0-24" class="i">+import me.rhunk.snapenhance.core.logger.CoreLogger
</a><a href="#h11-0-25" id="h11-0-25" class="i">+import me.rhunk.snapenhance.core.ui.menu.MenuViewInjector
</a><a href="#h11-0-26" id="h11-0-26" class="i">+import kotlin.reflect.KClass
</a><a href="#h11-0-27" id="h11-0-27" class="i">+import kotlin.system.measureTimeMillis
</a><a href="#h11-0-28" id="h11-0-28" class="i">+
</a><a href="#h11-0-29" id="h11-0-29" class="i">+class FeatureManager(
</a><a href="#h11-0-30" id="h11-0-30" class="i">+    private val context: ModContext
</a><a href="#h11-0-31" id="h11-0-31" class="i">+) {
</a><a href="#h11-0-32" id="h11-0-32" class="i">+    private val features = mutableMapOf&lt;KClass&lt;out Feature&gt;, Feature&gt;()
</a><a href="#h11-0-33" id="h11-0-33" class="i">+
</a><a href="#h11-0-34" id="h11-0-34" class="i">+    private fun register(vararg featureList: Feature) {
</a><a href="#h11-0-35" id="h11-0-35" class="i">+        if (context.bridgeClient.getDebugProp(&quot;disable_feature_loading&quot;) == &quot;true&quot;) {
</a><a href="#h11-0-36" id="h11-0-36" class="i">+            context.log.warn(&quot;Feature loading is disabled&quot;)
</a><a href="#h11-0-37" id="h11-0-37" class="i">+            return
</a><a href="#h11-0-38" id="h11-0-38" class="i">+        }
</a><a href="#h11-0-39" id="h11-0-39" class="i">+
</a><a href="#h11-0-40" id="h11-0-40" class="i">+        runBlocking {
</a><a href="#h11-0-41" id="h11-0-41" class="i">+            featureList.forEach { feature -&gt;
</a><a href="#h11-0-42" id="h11-0-42" class="i">+                launch(Dispatchers.IO) {
</a><a href="#h11-0-43" id="h11-0-43" class="i">+                    runCatching {
</a><a href="#h11-0-44" id="h11-0-44" class="i">+                        feature.context = context
</a><a href="#h11-0-45" id="h11-0-45" class="i">+                        synchronized(features) {
</a><a href="#h11-0-46" id="h11-0-46" class="i">+                            features[feature::class] = feature
</a><a href="#h11-0-47" id="h11-0-47" class="i">+                        }
</a><a href="#h11-0-48" id="h11-0-48" class="i">+                    }.onFailure {
</a><a href="#h11-0-49" id="h11-0-49" class="i">+                        CoreLogger.xposedLog(&quot;Failed to register feature ${feature.featureKey}&quot;, it)
</a><a href="#h11-0-50" id="h11-0-50" class="i">+                    }
</a><a href="#h11-0-51" id="h11-0-51" class="i">+                }
</a><a href="#h11-0-52" id="h11-0-52" class="i">+            }
</a><a href="#h11-0-53" id="h11-0-53" class="i">+        }
</a><a href="#h11-0-54" id="h11-0-54" class="i">+    }
</a><a href="#h11-0-55" id="h11-0-55" class="i">+
</a><a href="#h11-0-56" id="h11-0-56" class="i">+    @Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h11-0-57" id="h11-0-57" class="i">+    fun &lt;T : Feature&gt; get(featureClass: KClass&lt;T&gt;): T? {
</a><a href="#h11-0-58" id="h11-0-58" class="i">+        return features[featureClass] as? T
</a><a href="#h11-0-59" id="h11-0-59" class="i">+    }
</a><a href="#h11-0-60" id="h11-0-60" class="i">+
</a><a href="#h11-0-61" id="h11-0-61" class="i">+    fun getRuleFeatures() = features.values.filterIsInstance&lt;MessagingRuleFeature&gt;().sortedBy { it.ruleType.ordinal }
</a><a href="#h11-0-62" id="h11-0-62" class="i">+
</a><a href="#h11-0-63" id="h11-0-63" class="i">+    fun init() {
</a><a href="#h11-0-64" id="h11-0-64" class="i">+        register(
</a><a href="#h11-0-65" id="h11-0-65" class="i">+            EndToEndEncryption(),
</a><a href="#h11-0-66" id="h11-0-66" class="i">+            ScopeSync(),
</a><a href="#h11-0-67" id="h11-0-67" class="i">+            PreventMessageListAutoScroll(),
</a><a href="#h11-0-68" id="h11-0-68" class="i">+            Messaging(),
</a><a href="#h11-0-69" id="h11-0-69" class="i">+            MediaDownloader(),
</a><a href="#h11-0-70" id="h11-0-70" class="i">+            StealthMode(),
</a><a href="#h11-0-71" id="h11-0-71" class="i">+            MenuViewInjector(),
</a><a href="#h11-0-72" id="h11-0-72" class="i">+            PreventReadReceipts(),
</a><a href="#h11-0-73" id="h11-0-73" class="i">+            MessageLogger(),
</a><a href="#h11-0-74" id="h11-0-74" class="i">+            ConvertMessageLocally(),
</a><a href="#h11-0-75" id="h11-0-75" class="i">+            SnapchatPlus(),
</a><a href="#h11-0-76" id="h11-0-76" class="i">+            DisableMetrics(),
</a><a href="#h11-0-77" id="h11-0-77" class="i">+            PreventMessageSending(),
</a><a href="#h11-0-78" id="h11-0-78" class="i">+            Notifications(),
</a><a href="#h11-0-79" id="h11-0-79" class="i">+            AutoSave(),
</a><a href="#h11-0-80" id="h11-0-80" class="i">+            UITweaks(),
</a><a href="#h11-0-81" id="h11-0-81" class="i">+            ConfigurationOverride(),
</a><a href="#h11-0-82" id="h11-0-82" class="i">+            UnsaveableMessages(),
</a><a href="#h11-0-83" id="h11-0-83" class="i">+            SendOverride(),
</a><a href="#h11-0-84" id="h11-0-84" class="i">+            UnlimitedSnapViewTime(),
</a><a href="#h11-0-85" id="h11-0-85" class="i">+            BypassVideoLengthRestriction(),
</a><a href="#h11-0-86" id="h11-0-86" class="i">+            MediaQualityLevelOverride(),
</a><a href="#h11-0-87" id="h11-0-87" class="i">+            MeoPasscodeBypass(),
</a><a href="#h11-0-88" id="h11-0-88" class="i">+            AppPasscode(),
</a><a href="#h11-0-89" id="h11-0-89" class="i">+            LocationSpoofer(),
</a><a href="#h11-0-90" id="h11-0-90" class="i">+            CameraTweaks(),
</a><a href="#h11-0-91" id="h11-0-91" class="i">+            InfiniteStoryBoost(),
</a><a href="#h11-0-92" id="h11-0-92" class="i">+            AmoledDarkMode(),
</a><a href="#h11-0-93" id="h11-0-93" class="i">+            PinConversations(),
</a><a href="#h11-0-94" id="h11-0-94" class="i">+            DeviceSpooferHook(),
</a><a href="#h11-0-95" id="h11-0-95" class="i">+            ClientBootstrapOverride(),
</a><a href="#h11-0-96" id="h11-0-96" class="i">+            GooglePlayServicesDialogs(),
</a><a href="#h11-0-97" id="h11-0-97" class="i">+            NoFriendScoreDelay(),
</a><a href="#h11-0-98" id="h11-0-98" class="i">+            ProfilePictureDownloader(),
</a><a href="#h11-0-99" id="h11-0-99" class="i">+            AddFriendSourceSpoof(),
</a><a href="#h11-0-100" id="h11-0-100" class="i">+            DisableReplayInFF(),
</a><a href="#h11-0-101" id="h11-0-101" class="i">+            OldBitmojiSelfie(),
</a><a href="#h11-0-102" id="h11-0-102" class="i">+            FriendFeedMessagePreview(),
</a><a href="#h11-0-103" id="h11-0-103" class="i">+            HideStreakRestore(),
</a><a href="#h11-0-104" id="h11-0-104" class="i">+            HideFriendFeedEntry(),
</a><a href="#h11-0-105" id="h11-0-105" class="i">+            HideQuickAddFriendFeed(),
</a><a href="#h11-0-106" id="h11-0-106" class="i">+            CallStartConfirmation(),
</a><a href="#h11-0-107" id="h11-0-107" class="i">+            SnapPreview(),
</a><a href="#h11-0-108" id="h11-0-108" class="i">+            InstantDelete(),
</a><a href="#h11-0-109" id="h11-0-109" class="i">+            BypassScreenshotDetection(),
</a><a href="#h11-0-110" id="h11-0-110" class="i">+            HalfSwipeNotifier(),
</a><a href="#h11-0-111" id="h11-0-111" class="i">+            DisableConfirmationDialogs(),
</a><a href="#h11-0-112" id="h11-0-112" class="i">+            MixerStories(),
</a><a href="#h11-0-113" id="h11-0-113" class="i">+            DisableComposerModules(),
</a><a href="#h11-0-114" id="h11-0-114" class="i">+            FideliusIndicator(),
</a><a href="#h11-0-115" id="h11-0-115" class="i">+            EditTextOverride(),
</a><a href="#h11-0-116" id="h11-0-116" class="i">+            PreventForcedLogout(),
</a><a href="#h11-0-117" id="h11-0-117" class="i">+            SuspendLocationUpdates(),
</a><a href="#h11-0-118" id="h11-0-118" class="i">+            ConversationToolbox(),
</a><a href="#h11-0-119" id="h11-0-119" class="i">+            SpotlightCommentsUsername(),
</a><a href="#h11-0-120" id="h11-0-120" class="i">+            OperaViewerParamsOverride(),
</a><a href="#h11-0-121" id="h11-0-121" class="i">+            StealthModeIndicator(),
</a><a href="#h11-0-122" id="h11-0-122" class="i">+            DisablePermissionRequests(),
</a><a href="#h11-0-123" id="h11-0-123" class="i">+            SessionEvents(),
</a><a href="#h11-0-124" id="h11-0-124" class="i">+            DefaultVolumeControls(),
</a><a href="#h11-0-125" id="h11-0-125" class="i">+            CallRecorder(),
</a><a href="#h11-0-126" id="h11-0-126" class="i">+            DisableMemoriesSnapFeed(),
</a><a href="#h11-0-127" id="h11-0-127" class="i">+            AccountSwitcher(),
</a><a href="#h11-0-128" id="h11-0-128" class="i">+        )
</a><a href="#h11-0-129" id="h11-0-129" class="i">+
</a><a href="#h11-0-130" id="h11-0-130" class="i">+        initializeFeatures()
</a><a href="#h11-0-131" id="h11-0-131" class="i">+    }
</a><a href="#h11-0-132" id="h11-0-132" class="i">+
</a><a href="#h11-0-133" id="h11-0-133" class="i">+    private inline fun tryInit(feature: Feature, crossinline block: () -&gt; Unit) {
</a><a href="#h11-0-134" id="h11-0-134" class="i">+        runCatching {
</a><a href="#h11-0-135" id="h11-0-135" class="i">+            block()
</a><a href="#h11-0-136" id="h11-0-136" class="i">+        }.onFailure {
</a><a href="#h11-0-137" id="h11-0-137" class="i">+            context.log.error(&quot;Failed to init feature ${feature.featureKey}&quot;, it)
</a><a href="#h11-0-138" id="h11-0-138" class="i">+            context.longToast(&quot;Failed to init feature ${feature.featureKey}! Check logcat for more details.&quot;)
</a><a href="#h11-0-139" id="h11-0-139" class="i">+        }
</a><a href="#h11-0-140" id="h11-0-140" class="i">+    }
</a><a href="#h11-0-141" id="h11-0-141" class="i">+
</a><a href="#h11-0-142" id="h11-0-142" class="i">+    private fun initFeatures(
</a><a href="#h11-0-143" id="h11-0-143" class="i">+        syncParam: Int,
</a><a href="#h11-0-144" id="h11-0-144" class="i">+        asyncParam: Int,
</a><a href="#h11-0-145" id="h11-0-145" class="i">+        syncAction: (Feature) -&gt; Unit,
</a><a href="#h11-0-146" id="h11-0-146" class="i">+        asyncAction: (Feature) -&gt; Unit
</a><a href="#h11-0-147" id="h11-0-147" class="i">+    ) {
</a><a href="#h11-0-148" id="h11-0-148" class="i">+
</a><a href="#h11-0-149" id="h11-0-149" class="i">+        features.values.toList().forEach { feature -&gt;
</a><a href="#h11-0-150" id="h11-0-150" class="i">+            if (feature.loadParams and syncParam != 0) {
</a><a href="#h11-0-151" id="h11-0-151" class="i">+                tryInit(feature) {
</a><a href="#h11-0-152" id="h11-0-152" class="i">+                    syncAction(feature)
</a><a href="#h11-0-153" id="h11-0-153" class="i">+                }
</a><a href="#h11-0-154" id="h11-0-154" class="i">+            }
</a><a href="#h11-0-155" id="h11-0-155" class="i">+            if (feature.loadParams and asyncParam != 0) {
</a><a href="#h11-0-156" id="h11-0-156" class="i">+                context.coroutineScope.launch {
</a><a href="#h11-0-157" id="h11-0-157" class="i">+                    tryInit(feature) {
</a><a href="#h11-0-158" id="h11-0-158" class="i">+                        asyncAction(feature)
</a><a href="#h11-0-159" id="h11-0-159" class="i">+                    }
</a><a href="#h11-0-160" id="h11-0-160" class="i">+                }
</a><a href="#h11-0-161" id="h11-0-161" class="i">+            }
</a><a href="#h11-0-162" id="h11-0-162" class="i">+        }
</a><a href="#h11-0-163" id="h11-0-163" class="i">+    }
</a><a href="#h11-0-164" id="h11-0-164" class="i">+
</a><a href="#h11-0-165" id="h11-0-165" class="i">+    private fun initializeFeatures() {
</a><a href="#h11-0-166" id="h11-0-166" class="i">+        //TODO: async called when all features are initiated ?
</a><a href="#h11-0-167" id="h11-0-167" class="i">+        measureTimeMillis {
</a><a href="#h11-0-168" id="h11-0-168" class="i">+            initFeatures(
</a><a href="#h11-0-169" id="h11-0-169" class="i">+                FeatureLoadParams.INIT_SYNC,
</a><a href="#h11-0-170" id="h11-0-170" class="i">+                FeatureLoadParams.INIT_ASYNC,
</a><a href="#h11-0-171" id="h11-0-171" class="i">+                Feature::init,
</a><a href="#h11-0-172" id="h11-0-172" class="i">+                Feature::asyncInit
</a><a href="#h11-0-173" id="h11-0-173" class="i">+            )
</a><a href="#h11-0-174" id="h11-0-174" class="i">+        }.also {
</a><a href="#h11-0-175" id="h11-0-175" class="i">+            context.log.verbose(&quot;feature manager init took $it ms&quot;)
</a><a href="#h11-0-176" id="h11-0-176" class="i">+        }
</a><a href="#h11-0-177" id="h11-0-177" class="i">+    }
</a><a href="#h11-0-178" id="h11-0-178" class="i">+
</a><a href="#h11-0-179" id="h11-0-179" class="i">+    fun onActivityCreate() {
</a><a href="#h11-0-180" id="h11-0-180" class="i">+        measureTimeMillis {
</a><a href="#h11-0-181" id="h11-0-181" class="i">+            initFeatures(
</a><a href="#h11-0-182" id="h11-0-182" class="i">+                FeatureLoadParams.ACTIVITY_CREATE_SYNC,
</a><a href="#h11-0-183" id="h11-0-183" class="i">+                FeatureLoadParams.ACTIVITY_CREATE_ASYNC,
</a><a href="#h11-0-184" id="h11-0-184" class="i">+                Feature::onActivityCreate,
</a><a href="#h11-0-185" id="h11-0-185" class="i">+                Feature::asyncOnActivityCreate
</a><a href="#h11-0-186" id="h11-0-186" class="i">+            )
</a><a href="#h11-0-187" id="h11-0-187" class="i">+        }.also {
</a><a href="#h11-0-188" id="h11-0-188" class="i">+            context.log.verbose(&quot;feature manager onActivityCreate took $it ms&quot;)
</a><a href="#h11-0-189" id="h11-0-189" class="i">+        }
</a><a href="#h11-0-190" id="h11-0-190" class="i">+    }
</a><a href="#h11-0-191" id="h11-0-191" class="i">+}</a><a href="#h11-0-192" id="h11-0-192" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h12" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/Manager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/Manager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/Manager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/Manager.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,6 +0,0 @@
</a><a href="#h12-0-0" id="h12-0-0" class="d">-package me.rhunk.snapenhance.core.manager
</a><a href="#h12-0-1" id="h12-0-1" class="d">-
</a><a href="#h12-0-2" id="h12-0-2" class="d">-interface Manager {
</a><a href="#h12-0-3" id="h12-0-3" class="d">-    fun init() {}
</a><a href="#h12-0-4" id="h12-0-4" class="d">-    fun onActivityCreate() {}
</a><a href="#h12-0-5" id="h12-0-5" class="d">-}</a><a href="#h12-0-6" id="h12-0-6" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h13" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,45 +0,0 @@
</a><a href="#h13-0-0" id="h13-0-0" class="d">-package me.rhunk.snapenhance.core.manager.impl
</a><a href="#h13-0-1" id="h13-0-1" class="d">-
</a><a href="#h13-0-2" id="h13-0-2" class="d">-import android.content.Intent
</a><a href="#h13-0-3" id="h13-0-3" class="d">-import me.rhunk.snapenhance.common.action.EnumAction
</a><a href="#h13-0-4" id="h13-0-4" class="d">-import me.rhunk.snapenhance.core.ModContext
</a><a href="#h13-0-5" id="h13-0-5" class="d">-import me.rhunk.snapenhance.core.action.impl.BulkMessagingAction
</a><a href="#h13-0-6" id="h13-0-6" class="d">-import me.rhunk.snapenhance.core.action.impl.CleanCache
</a><a href="#h13-0-7" id="h13-0-7" class="d">-import me.rhunk.snapenhance.core.action.impl.ExportChatMessages
</a><a href="#h13-0-8" id="h13-0-8" class="d">-import me.rhunk.snapenhance.core.action.impl.ExportMemories
</a><a href="#h13-0-9" id="h13-0-9" class="d">-import me.rhunk.snapenhance.core.manager.Manager
</a><a href="#h13-0-10" id="h13-0-10" class="d">-
</a><a href="#h13-0-11" id="h13-0-11" class="d">-class ActionManager(
</a><a href="#h13-0-12" id="h13-0-12" class="d">-    private val modContext: ModContext,
</a><a href="#h13-0-13" id="h13-0-13" class="d">-) : Manager {
</a><a href="#h13-0-14" id="h13-0-14" class="d">-
</a><a href="#h13-0-15" id="h13-0-15" class="d">-    private val actions by lazy {
</a><a href="#h13-0-16" id="h13-0-16" class="d">-        mapOf(
</a><a href="#h13-0-17" id="h13-0-17" class="d">-            EnumAction.CLEAN_CACHE to CleanCache(),
</a><a href="#h13-0-18" id="h13-0-18" class="d">-            EnumAction.EXPORT_CHAT_MESSAGES to ExportChatMessages(),
</a><a href="#h13-0-19" id="h13-0-19" class="d">-            EnumAction.BULK_MESSAGING_ACTION to BulkMessagingAction(),
</a><a href="#h13-0-20" id="h13-0-20" class="d">-            EnumAction.EXPORT_MEMORIES to ExportMemories(),
</a><a href="#h13-0-21" id="h13-0-21" class="d">-        ).map {
</a><a href="#h13-0-22" id="h13-0-22" class="d">-            it.key to it.value.apply {
</a><a href="#h13-0-23" id="h13-0-23" class="d">-                this.context = modContext
</a><a href="#h13-0-24" id="h13-0-24" class="d">-            }
</a><a href="#h13-0-25" id="h13-0-25" class="d">-        }.toMap().toMutableMap()
</a><a href="#h13-0-26" id="h13-0-26" class="d">-    }
</a><a href="#h13-0-27" id="h13-0-27" class="d">-
</a><a href="#h13-0-28" id="h13-0-28" class="d">-    override fun init() {
</a><a href="#h13-0-29" id="h13-0-29" class="d">-    }
</a><a href="#h13-0-30" id="h13-0-30" class="d">-
</a><a href="#h13-0-31" id="h13-0-31" class="d">-    fun onNewIntent(intent: Intent?) {
</a><a href="#h13-0-32" id="h13-0-32" class="d">-        val action = intent?.getStringExtra(EnumAction.ACTION_PARAMETER) ?: return
</a><a href="#h13-0-33" id="h13-0-33" class="d">-        intent.removeExtra(EnumAction.ACTION_PARAMETER)
</a><a href="#h13-0-34" id="h13-0-34" class="d">-        execute(EnumAction.entries.find { it.key == action } ?: return)
</a><a href="#h13-0-35" id="h13-0-35" class="d">-    }
</a><a href="#h13-0-36" id="h13-0-36" class="d">-
</a><a href="#h13-0-37" id="h13-0-37" class="d">-    fun execute(enumAction: EnumAction) {
</a><a href="#h13-0-38" id="h13-0-38" class="d">-        val action = actions[enumAction] ?: return
</a><a href="#h13-0-39" id="h13-0-39" class="d">-        action.run()
</a><a href="#h13-0-40" id="h13-0-40" class="d">-        if (enumAction.exitOnFinish) {
</a><a href="#h13-0-41" id="h13-0-41" class="d">-            modContext.forceCloseApp()
</a><a href="#h13-0-42" id="h13-0-42" class="d">-        }
</a><a href="#h13-0-43" id="h13-0-43" class="d">-    }
</a><a href="#h13-0-44" id="h13-0-44" class="d">-}</a><a href="#h13-0-45" id="h13-0-45" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/FeatureManager.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,189 +0,0 @@
</a><a href="#h14-0-0" id="h14-0-0" class="d">-package me.rhunk.snapenhance.core.manager.impl
</a><a href="#h14-0-1" id="h14-0-1" class="d">-
</a><a href="#h14-0-2" id="h14-0-2" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h14-0-3" id="h14-0-3" class="d">-import kotlinx.coroutines.launch
</a><a href="#h14-0-4" id="h14-0-4" class="d">-import kotlinx.coroutines.runBlocking
</a><a href="#h14-0-5" id="h14-0-5" class="d">-import me.rhunk.snapenhance.core.ModContext
</a><a href="#h14-0-6" id="h14-0-6" class="d">-import me.rhunk.snapenhance.core.features.Feature
</a><a href="#h14-0-7" id="h14-0-7" class="d">-import me.rhunk.snapenhance.core.features.FeatureLoadParams
</a><a href="#h14-0-8" id="h14-0-8" class="d">-import me.rhunk.snapenhance.core.features.MessagingRuleFeature
</a><a href="#h14-0-9" id="h14-0-9" class="d">-import me.rhunk.snapenhance.core.features.impl.ConfigurationOverride
</a><a href="#h14-0-10" id="h14-0-10" class="d">-import me.rhunk.snapenhance.core.features.impl.MixerStories
</a><a href="#h14-0-11" id="h14-0-11" class="d">-import me.rhunk.snapenhance.core.features.impl.OperaViewerParamsOverride
</a><a href="#h14-0-12" id="h14-0-12" class="d">-import me.rhunk.snapenhance.core.features.impl.ScopeSync
</a><a href="#h14-0-13" id="h14-0-13" class="d">-import me.rhunk.snapenhance.core.features.impl.downloader.MediaDownloader
</a><a href="#h14-0-14" id="h14-0-14" class="d">-import me.rhunk.snapenhance.core.features.impl.downloader.ProfilePictureDownloader
</a><a href="#h14-0-15" id="h14-0-15" class="d">-import me.rhunk.snapenhance.core.features.impl.experiments.*
</a><a href="#h14-0-16" id="h14-0-16" class="d">-import me.rhunk.snapenhance.core.features.impl.global.*
</a><a href="#h14-0-17" id="h14-0-17" class="d">-import me.rhunk.snapenhance.core.features.impl.messaging.*
</a><a href="#h14-0-18" id="h14-0-18" class="d">-import me.rhunk.snapenhance.core.features.impl.spying.*
</a><a href="#h14-0-19" id="h14-0-19" class="d">-import me.rhunk.snapenhance.core.features.impl.tweaks.BypassScreenshotDetection
</a><a href="#h14-0-20" id="h14-0-20" class="d">-import me.rhunk.snapenhance.core.features.impl.tweaks.CameraTweaks
</a><a href="#h14-0-21" id="h14-0-21" class="d">-import me.rhunk.snapenhance.core.features.impl.tweaks.DisablePermissionRequests
</a><a href="#h14-0-22" id="h14-0-22" class="d">-import me.rhunk.snapenhance.core.features.impl.tweaks.PreventMessageListAutoScroll
</a><a href="#h14-0-23" id="h14-0-23" class="d">-import me.rhunk.snapenhance.core.features.impl.tweaks.UnsaveableMessages
</a><a href="#h14-0-24" id="h14-0-24" class="d">-import me.rhunk.snapenhance.core.features.impl.ui.*
</a><a href="#h14-0-25" id="h14-0-25" class="d">-import me.rhunk.snapenhance.core.logger.CoreLogger
</a><a href="#h14-0-26" id="h14-0-26" class="d">-import me.rhunk.snapenhance.core.manager.Manager
</a><a href="#h14-0-27" id="h14-0-27" class="d">-import me.rhunk.snapenhance.core.ui.menu.MenuViewInjector
</a><a href="#h14-0-28" id="h14-0-28" class="d">-import kotlin.reflect.KClass
</a><a href="#h14-0-29" id="h14-0-29" class="d">-import kotlin.system.measureTimeMillis
</a><a href="#h14-0-30" id="h14-0-30" class="d">-
</a><a href="#h14-0-31" id="h14-0-31" class="d">-class FeatureManager(
</a><a href="#h14-0-32" id="h14-0-32" class="d">-    private val context: ModContext
</a><a href="#h14-0-33" id="h14-0-33" class="d">-) : Manager {
</a><a href="#h14-0-34" id="h14-0-34" class="d">-    private val features = mutableMapOf&lt;KClass&lt;out Feature&gt;, Feature&gt;()
</a><a href="#h14-0-35" id="h14-0-35" class="d">-
</a><a href="#h14-0-36" id="h14-0-36" class="d">-    private fun register(vararg featureList: Feature) {
</a><a href="#h14-0-37" id="h14-0-37" class="d">-        runBlocking {
</a><a href="#h14-0-38" id="h14-0-38" class="d">-            featureList.forEach { feature -&gt;
</a><a href="#h14-0-39" id="h14-0-39" class="d">-                launch(Dispatchers.IO) {
</a><a href="#h14-0-40" id="h14-0-40" class="d">-                    runCatching {
</a><a href="#h14-0-41" id="h14-0-41" class="d">-                        feature.context = context
</a><a href="#h14-0-42" id="h14-0-42" class="d">-                        synchronized(features) {
</a><a href="#h14-0-43" id="h14-0-43" class="d">-                            features[feature::class] = feature
</a><a href="#h14-0-44" id="h14-0-44" class="d">-                        }
</a><a href="#h14-0-45" id="h14-0-45" class="d">-                    }.onFailure {
</a><a href="#h14-0-46" id="h14-0-46" class="d">-                        CoreLogger.xposedLog(&quot;Failed to register feature ${feature.featureKey}&quot;, it)
</a><a href="#h14-0-47" id="h14-0-47" class="d">-                    }
</a><a href="#h14-0-48" id="h14-0-48" class="d">-                }
</a><a href="#h14-0-49" id="h14-0-49" class="d">-            }
</a><a href="#h14-0-50" id="h14-0-50" class="d">-        }
</a><a href="#h14-0-51" id="h14-0-51" class="d">-    }
</a><a href="#h14-0-52" id="h14-0-52" class="d">-
</a><a href="#h14-0-53" id="h14-0-53" class="d">-    @Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h14-0-54" id="h14-0-54" class="d">-    fun &lt;T : Feature&gt; get(featureClass: KClass&lt;T&gt;): T? {
</a><a href="#h14-0-55" id="h14-0-55" class="d">-        return features[featureClass] as? T
</a><a href="#h14-0-56" id="h14-0-56" class="d">-    }
</a><a href="#h14-0-57" id="h14-0-57" class="d">-
</a><a href="#h14-0-58" id="h14-0-58" class="d">-    fun getRuleFeatures() = features.values.filterIsInstance&lt;MessagingRuleFeature&gt;().sortedBy { it.ruleType.ordinal }
</a><a href="#h14-0-59" id="h14-0-59" class="d">-
</a><a href="#h14-0-60" id="h14-0-60" class="d">-    override fun init() {
</a><a href="#h14-0-61" id="h14-0-61" class="d">-        register(
</a><a href="#h14-0-62" id="h14-0-62" class="d">-            EndToEndEncryption(),
</a><a href="#h14-0-63" id="h14-0-63" class="d">-            ScopeSync(),
</a><a href="#h14-0-64" id="h14-0-64" class="d">-            PreventMessageListAutoScroll(),
</a><a href="#h14-0-65" id="h14-0-65" class="d">-            Messaging(),
</a><a href="#h14-0-66" id="h14-0-66" class="d">-            MediaDownloader(),
</a><a href="#h14-0-67" id="h14-0-67" class="d">-            StealthMode(),
</a><a href="#h14-0-68" id="h14-0-68" class="d">-            MenuViewInjector(),
</a><a href="#h14-0-69" id="h14-0-69" class="d">-            PreventReadReceipts(),
</a><a href="#h14-0-70" id="h14-0-70" class="d">-            MessageLogger(),
</a><a href="#h14-0-71" id="h14-0-71" class="d">-            ConvertMessageLocally(),
</a><a href="#h14-0-72" id="h14-0-72" class="d">-            SnapchatPlus(),
</a><a href="#h14-0-73" id="h14-0-73" class="d">-            DisableMetrics(),
</a><a href="#h14-0-74" id="h14-0-74" class="d">-            PreventMessageSending(),
</a><a href="#h14-0-75" id="h14-0-75" class="d">-            Notifications(),
</a><a href="#h14-0-76" id="h14-0-76" class="d">-            AutoSave(),
</a><a href="#h14-0-77" id="h14-0-77" class="d">-            UITweaks(),
</a><a href="#h14-0-78" id="h14-0-78" class="d">-            ConfigurationOverride(),
</a><a href="#h14-0-79" id="h14-0-79" class="d">-            UnsaveableMessages(),
</a><a href="#h14-0-80" id="h14-0-80" class="d">-            SendOverride(),
</a><a href="#h14-0-81" id="h14-0-81" class="d">-            UnlimitedSnapViewTime(),
</a><a href="#h14-0-82" id="h14-0-82" class="d">-            BypassVideoLengthRestriction(),
</a><a href="#h14-0-83" id="h14-0-83" class="d">-            MediaQualityLevelOverride(),
</a><a href="#h14-0-84" id="h14-0-84" class="d">-            MeoPasscodeBypass(),
</a><a href="#h14-0-85" id="h14-0-85" class="d">-            AppPasscode(),
</a><a href="#h14-0-86" id="h14-0-86" class="d">-            LocationSpoofer(),
</a><a href="#h14-0-87" id="h14-0-87" class="d">-            CameraTweaks(),
</a><a href="#h14-0-88" id="h14-0-88" class="d">-            InfiniteStoryBoost(),
</a><a href="#h14-0-89" id="h14-0-89" class="d">-            AmoledDarkMode(),
</a><a href="#h14-0-90" id="h14-0-90" class="d">-            PinConversations(),
</a><a href="#h14-0-91" id="h14-0-91" class="d">-            DeviceSpooferHook(),
</a><a href="#h14-0-92" id="h14-0-92" class="d">-            ClientBootstrapOverride(),
</a><a href="#h14-0-93" id="h14-0-93" class="d">-            GooglePlayServicesDialogs(),
</a><a href="#h14-0-94" id="h14-0-94" class="d">-            NoFriendScoreDelay(),
</a><a href="#h14-0-95" id="h14-0-95" class="d">-            ProfilePictureDownloader(),
</a><a href="#h14-0-96" id="h14-0-96" class="d">-            AddFriendSourceSpoof(),
</a><a href="#h14-0-97" id="h14-0-97" class="d">-            DisableReplayInFF(),
</a><a href="#h14-0-98" id="h14-0-98" class="d">-            OldBitmojiSelfie(),
</a><a href="#h14-0-99" id="h14-0-99" class="d">-            FriendFeedMessagePreview(),
</a><a href="#h14-0-100" id="h14-0-100" class="d">-            HideStreakRestore(),
</a><a href="#h14-0-101" id="h14-0-101" class="d">-            HideFriendFeedEntry(),
</a><a href="#h14-0-102" id="h14-0-102" class="d">-            HideQuickAddFriendFeed(),
</a><a href="#h14-0-103" id="h14-0-103" class="d">-            CallStartConfirmation(),
</a><a href="#h14-0-104" id="h14-0-104" class="d">-            SnapPreview(),
</a><a href="#h14-0-105" id="h14-0-105" class="d">-            InstantDelete(),
</a><a href="#h14-0-106" id="h14-0-106" class="d">-            BypassScreenshotDetection(),
</a><a href="#h14-0-107" id="h14-0-107" class="d">-            HalfSwipeNotifier(),
</a><a href="#h14-0-108" id="h14-0-108" class="d">-            DisableConfirmationDialogs(),
</a><a href="#h14-0-109" id="h14-0-109" class="d">-            MixerStories(),
</a><a href="#h14-0-110" id="h14-0-110" class="d">-            DisableComposerModules(),
</a><a href="#h14-0-111" id="h14-0-111" class="d">-            FideliusIndicator(),
</a><a href="#h14-0-112" id="h14-0-112" class="d">-            EditTextOverride(),
</a><a href="#h14-0-113" id="h14-0-113" class="d">-            PreventForcedLogout(),
</a><a href="#h14-0-114" id="h14-0-114" class="d">-            SuspendLocationUpdates(),
</a><a href="#h14-0-115" id="h14-0-115" class="d">-            ConversationToolbox(),
</a><a href="#h14-0-116" id="h14-0-116" class="d">-            SpotlightCommentsUsername(),
</a><a href="#h14-0-117" id="h14-0-117" class="d">-            OperaViewerParamsOverride(),
</a><a href="#h14-0-118" id="h14-0-118" class="d">-            StealthModeIndicator(),
</a><a href="#h14-0-119" id="h14-0-119" class="d">-            DisablePermissionRequests(),
</a><a href="#h14-0-120" id="h14-0-120" class="d">-            SessionEvents(),
</a><a href="#h14-0-121" id="h14-0-121" class="d">-            DefaultVolumeControls(),
</a><a href="#h14-0-122" id="h14-0-122" class="d">-            CallRecorder(),
</a><a href="#h14-0-123" id="h14-0-123" class="d">-            DisableMemoriesSnapFeed(),
</a><a href="#h14-0-124" id="h14-0-124" class="d">-            AccountSwitcher(),
</a><a href="#h14-0-125" id="h14-0-125" class="d">-        )
</a><a href="#h14-0-126" id="h14-0-126" class="d">-
</a><a href="#h14-0-127" id="h14-0-127" class="d">-        initializeFeatures()
</a><a href="#h14-0-128" id="h14-0-128" class="d">-    }
</a><a href="#h14-0-129" id="h14-0-129" class="d">-
</a><a href="#h14-0-130" id="h14-0-130" class="d">-    private inline fun tryInit(feature: Feature, crossinline block: () -&gt; Unit) {
</a><a href="#h14-0-131" id="h14-0-131" class="d">-        runCatching {
</a><a href="#h14-0-132" id="h14-0-132" class="d">-            block()
</a><a href="#h14-0-133" id="h14-0-133" class="d">-        }.onFailure {
</a><a href="#h14-0-134" id="h14-0-134" class="d">-            context.log.error(&quot;Failed to init feature ${feature.featureKey}&quot;, it)
</a><a href="#h14-0-135" id="h14-0-135" class="d">-            context.longToast(&quot;Failed to init feature ${feature.featureKey}! Check logcat for more details.&quot;)
</a><a href="#h14-0-136" id="h14-0-136" class="d">-        }
</a><a href="#h14-0-137" id="h14-0-137" class="d">-    }
</a><a href="#h14-0-138" id="h14-0-138" class="d">-
</a><a href="#h14-0-139" id="h14-0-139" class="d">-    private fun initFeatures(
</a><a href="#h14-0-140" id="h14-0-140" class="d">-        syncParam: Int,
</a><a href="#h14-0-141" id="h14-0-141" class="d">-        asyncParam: Int,
</a><a href="#h14-0-142" id="h14-0-142" class="d">-        syncAction: (Feature) -&gt; Unit,
</a><a href="#h14-0-143" id="h14-0-143" class="d">-        asyncAction: (Feature) -&gt; Unit
</a><a href="#h14-0-144" id="h14-0-144" class="d">-    ) {
</a><a href="#h14-0-145" id="h14-0-145" class="d">-
</a><a href="#h14-0-146" id="h14-0-146" class="d">-        features.values.toList().forEach { feature -&gt;
</a><a href="#h14-0-147" id="h14-0-147" class="d">-            if (feature.loadParams and syncParam != 0) {
</a><a href="#h14-0-148" id="h14-0-148" class="d">-                tryInit(feature) {
</a><a href="#h14-0-149" id="h14-0-149" class="d">-                    syncAction(feature)
</a><a href="#h14-0-150" id="h14-0-150" class="d">-                }
</a><a href="#h14-0-151" id="h14-0-151" class="d">-            }
</a><a href="#h14-0-152" id="h14-0-152" class="d">-            if (feature.loadParams and asyncParam != 0) {
</a><a href="#h14-0-153" id="h14-0-153" class="d">-                context.coroutineScope.launch {
</a><a href="#h14-0-154" id="h14-0-154" class="d">-                    tryInit(feature) {
</a><a href="#h14-0-155" id="h14-0-155" class="d">-                        asyncAction(feature)
</a><a href="#h14-0-156" id="h14-0-156" class="d">-                    }
</a><a href="#h14-0-157" id="h14-0-157" class="d">-                }
</a><a href="#h14-0-158" id="h14-0-158" class="d">-            }
</a><a href="#h14-0-159" id="h14-0-159" class="d">-        }
</a><a href="#h14-0-160" id="h14-0-160" class="d">-    }
</a><a href="#h14-0-161" id="h14-0-161" class="d">-
</a><a href="#h14-0-162" id="h14-0-162" class="d">-    private fun initializeFeatures() {
</a><a href="#h14-0-163" id="h14-0-163" class="d">-        //TODO: async called when all features are initiated ?
</a><a href="#h14-0-164" id="h14-0-164" class="d">-        measureTimeMillis {
</a><a href="#h14-0-165" id="h14-0-165" class="d">-            initFeatures(
</a><a href="#h14-0-166" id="h14-0-166" class="d">-                FeatureLoadParams.INIT_SYNC,
</a><a href="#h14-0-167" id="h14-0-167" class="d">-                FeatureLoadParams.INIT_ASYNC,
</a><a href="#h14-0-168" id="h14-0-168" class="d">-                Feature::init,
</a><a href="#h14-0-169" id="h14-0-169" class="d">-                Feature::asyncInit
</a><a href="#h14-0-170" id="h14-0-170" class="d">-            )
</a><a href="#h14-0-171" id="h14-0-171" class="d">-        }.also {
</a><a href="#h14-0-172" id="h14-0-172" class="d">-            context.log.verbose(&quot;feature manager init took $it ms&quot;)
</a><a href="#h14-0-173" id="h14-0-173" class="d">-        }
</a><a href="#h14-0-174" id="h14-0-174" class="d">-    }
</a><a href="#h14-0-175" id="h14-0-175" class="d">-
</a><a href="#h14-0-176" id="h14-0-176" class="d">-    override fun onActivityCreate() {
</a><a href="#h14-0-177" id="h14-0-177" class="d">-        measureTimeMillis {
</a><a href="#h14-0-178" id="h14-0-178" class="d">-            initFeatures(
</a><a href="#h14-0-179" id="h14-0-179" class="d">-                FeatureLoadParams.ACTIVITY_CREATE_SYNC,
</a><a href="#h14-0-180" id="h14-0-180" class="d">-                FeatureLoadParams.ACTIVITY_CREATE_ASYNC,
</a><a href="#h14-0-181" id="h14-0-181" class="d">-                Feature::onActivityCreate,
</a><a href="#h14-0-182" id="h14-0-182" class="d">-                Feature::asyncOnActivityCreate
</a><a href="#h14-0-183" id="h14-0-183" class="d">-            )
</a><a href="#h14-0-184" id="h14-0-184" class="d">-        }.also {
</a><a href="#h14-0-185" id="h14-0-185" class="d">-            context.log.verbose(&quot;feature manager onActivityCreate took $it ms&quot;)
</a><a href="#h14-0-186" id="h14-0-186" class="d">-        }
</a><a href="#h14-0-187" id="h14-0-187" class="d">-    }
</a><a href="#h14-0-188" id="h14-0-188" class="d">-}</a><a href="#h14-0-189" id="h14-0-189" class="d">-
\ No newline at end of file
</a></pre>
</div>
</body>
</html>
