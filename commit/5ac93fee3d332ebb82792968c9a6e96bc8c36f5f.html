<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat(core/message_exporter): new template design - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/5ac93fee3d332ebb82792968c9a6e96bc8c36f5f.html">5ac93fee3d332ebb82792968c9a6e96bc8c36f5f</a>
<b>parent</b> <a href="../commit/3bde12a2af8e4123ff41729b371808b7838999a7.html">3bde12a2af8e4123ff41729b371808b7838999a7</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Thu, 19 Oct 2023 22:01:39 +0200

feat(core/message_exporter): new template design

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">core/src/main/assets/web/export_template.html</a></td><td> | </td><td class="num">520</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessageExporter.kt</a></td><td> | </td><td class="num">40</td><td><span class="i">+++++++++++++++++++++++</span><span class="d">-----------------</span></td></tr>
</table></pre><pre>2 files changed, 317 insertions(+), 243 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/core/src/main/assets/web/export_template.html.html">core/src/main/assets/web/export_template.html</a> b/<a href="../file/core/src/main/assets/web/export_template.html.html">core/src/main/assets/web/export_template.html</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,295 +1,362 @@
</a> &lt;style&gt;
     :root {
<a href="#h0-0-2" id="h0-0-2" class="d">-        --sigIconPrimary: #dedede;
</a><a href="#h0-0-3" id="h0-0-3" class="d">-        --sigIconSecondary: #999;
</a><a href="#h0-0-4" id="h0-0-4" class="d">-        --sigIconTertiary: #616161;
</a><a href="#h0-0-5" id="h0-0-5" class="d">-        --sigIconNegative: #f23c57;
</a><a href="#h0-0-6" id="h0-0-6" class="d">-        --sigTextPrimary: #dedede;
</a><a href="#h0-0-7" id="h0-0-7" class="d">-        --sigTextPrimaryInverse: #000;
</a><a href="#h0-0-8" id="h0-0-8" class="d">-        --sigTextSecondary: #999;
</a><a href="#h0-0-9" id="h0-0-9" class="d">-        --sigTextTertiary: #616161;
</a><a href="#h0-0-10" id="h0-0-10" class="d">-        --sigTextPlayer: #fff;
</a><a href="#h0-0-11" id="h0-0-11" class="d">-        --sigTextNegative: #f23c57;
</a><a href="#h0-0-12" id="h0-0-12" class="d">-        --sigColorBackgroundBorder: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-13" id="h0-0-13" class="d">-        --sigBackgroundPrimary: #121212;
</a><a href="#h0-0-14" id="h0-0-14" class="d">-        --sigBackgroundPrimaryInverse: #fff;
</a><a href="#h0-0-15" id="h0-0-15" class="d">-        --sigBackgroundSecondary: #1e1e1e;
</a><a href="#h0-0-16" id="h0-0-16" class="d">-        --sigBackgroundSecondaryHover: #2b2b2b;
</a><a href="#h0-0-17" id="h0-0-17" class="d">-        --sigBackgroundFeedHover: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-18" id="h0-0-18" class="d">-        --sigBackgroundMessageHover: #292929;
</a><a href="#h0-0-19" id="h0-0-19" class="d">-        --sigBackgroundMessageSaved: #333232;
</a><a href="#h0-0-20" id="h0-0-20" class="d">-        --sigBackgroundMessageSavedHover: #3a3a3a;
</a><a href="#h0-0-21" id="h0-0-21" class="d">-        --sigMediaControlContainerBackground: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-22" id="h0-0-22" class="d">-        --sigStartupFooterBackground: rgba(0, 0, 0, 0.05);
</a><a href="#h0-0-23" id="h0-0-23" class="d">-        --sigButtonPrimary: #0fadff;
</a><a href="#h0-0-24" id="h0-0-24" class="d">-        --sigButtonPrimaryHover: #42bfff;
</a><a href="#h0-0-25" id="h0-0-25" class="d">-        --sigButtonSecondary: #2b2b2b;
</a><a href="#h0-0-26" id="h0-0-26" class="d">-        --sigButtonSecondaryHover: #424242;
</a><a href="#h0-0-27" id="h0-0-27" class="d">-        --sigButtonSecondaryActive: #5c5c5c;
</a><a href="#h0-0-28" id="h0-0-28" class="d">-        --sigButtonTertiary: #4e565f;
</a><a href="#h0-0-29" id="h0-0-29" class="d">-        --sigButtonQuaternary: #fff;
</a><a href="#h0-0-30" id="h0-0-30" class="d">-        --sigButtonInactive: #1e1e1e;
</a><a href="#h0-0-31" id="h0-0-31" class="d">-        --sigButtonNegative: #e1143d;
</a><a href="#h0-0-32" id="h0-0-32" class="d">-        --sigButtonOnPrimary: #fff;
</a><a href="#h0-0-33" id="h0-0-33" class="d">-        --sigButtonOnSecondary: #dedede;
</a><a href="#h0-0-34" id="h0-0-34" class="d">-        --sigButtonOnTertiary: #fff;
</a><a href="#h0-0-35" id="h0-0-35" class="d">-        --sigButtonOnQuaternary: #1e1e1e;
</a><a href="#h0-0-36" id="h0-0-36" class="d">-        --sigButtonOnInactive: rgba(255, 255, 255, 0.3);
</a><a href="#h0-0-37" id="h0-0-37" class="d">-        --sigButtonOnNegative: #fff;
</a><a href="#h0-0-38" id="h0-0-38" class="d">-        --sigMain: #121212;
</a><a href="#h0-0-39" id="h0-0-39" class="d">-        --sigSubscreen: #121212;
</a><a href="#h0-0-40" id="h0-0-40" class="d">-        --sigOverlay: rgba(0, 0, 0, 0.4);
</a><a href="#h0-0-41" id="h0-0-41" class="d">-        --sigOverlayHover: rgba(0, 0, 0, 0.35);
</a><a href="#h0-0-42" id="h0-0-42" class="d">-        --sigSurface: #1e1e1e;
</a><a href="#h0-0-43" id="h0-0-43" class="d">-        --sigSurfaceRGB: 30, 30, 30;
</a><a href="#h0-0-44" id="h0-0-44" class="d">-        --sigSurfaceDown: #212121;
</a><a href="#h0-0-45" id="h0-0-45" class="d">-        --sigAboveSurface: #292929;
</a><a href="#h0-0-46" id="h0-0-46" class="d">-        --sigObject: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-47" id="h0-0-47" class="d">-        --sigObjectDown: rgba(255, 255, 255, 0.19);
</a><a href="#h0-0-48" id="h0-0-48" class="d">-        --sigConversationBoxBackground: rgba(255, 255, 255, 0.25);
</a><a href="#h0-0-49" id="h0-0-49" class="d">-        --sigDivider: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-50" id="h0-0-50" class="d">-        --sigDividerLight: rgba(255, 255, 255, 0.2);
</a><a href="#h0-0-51" id="h0-0-51" class="d">-        --sigPlaceholder: #1e1e1e;
</a><a href="#h0-0-52" id="h0-0-52" class="d">-        --sigDisabled: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-53" id="h0-0-53" class="d">-        --sigCallTileHighlight: rgba(255, 255, 255, 0.8);
</a><a href="#h0-0-54" id="h0-0-54" class="d">-        --sigChat: #0fadff;
</a><a href="#h0-0-55" id="h0-0-55" class="d">-        --sigSnapWithoutSound: #f23c57;
</a><a href="#h0-0-56" id="h0-0-56" class="d">-        --sigSnapWithSound: #a05dcd;
</a><a href="#h0-0-57" id="h0-0-57" class="d">-        --sigChatSurfaceCalling: #39ca8e;
</a><a href="#h0-0-58" id="h0-0-58" class="d">-        --sigChatSurfaceCallingDisabled: #105e3d;
</a><a href="#h0-0-59" id="h0-0-59" class="d">-        --sigChatPending: #767676;
</a><a href="#h0-0-60" id="h0-0-60" class="d">-        --sigChatPendingHover: #8f8f8f;
</a><a href="#h0-0-61" id="h0-0-61" class="d">-        --sigChatIcon: #0fadff;
</a><a href="#h0-0-62" id="h0-0-62" class="d">-        --sigChatIconCaret: #f8616d;
</a><a href="#h0-0-63" id="h0-0-63" class="d">-        --sigChatShadowOne: 0 0 17px rgba(33, 33, 33, 0.07), 0 0 22px rgba(0, 0, 0, 0.06), 0 0 8px rgba(84, 84, 84, 0.1);
</a><a href="#h0-0-64" id="h0-0-64" class="d">-        --selectedMiddleColorGradient: rgba(4, 4, 4, 0.1);
</a><a href="#h0-0-65" id="h0-0-65" class="d">-        --selectedRightColorGradient: rgba(4, 4, 4, 0);
</a><a href="#h0-0-66" id="h0-0-66" class="i">+        --Snap-sigIconPrimary: #dedede;
</a><a href="#h0-0-67" id="h0-0-67" class="i">+        --Snap-sigIconSecondary: #999;
</a><a href="#h0-0-68" id="h0-0-68" class="i">+        --Snap-sigIconTertiary: #616161;
</a><a href="#h0-0-69" id="h0-0-69" class="i">+        --Snap-sigIconNegative: #f23c57;
</a><a href="#h0-0-70" id="h0-0-70" class="i">+        --Snap-sigTextPrimary: #dedede;
</a><a href="#h0-0-71" id="h0-0-71" class="i">+        --Snap-sigTextPrimaryInverse: #000;
</a><a href="#h0-0-72" id="h0-0-72" class="i">+        --Snap-sigTextSecondary: #999;
</a><a href="#h0-0-73" id="h0-0-73" class="i">+        --Snap-sigTextTertiary: #616161;
</a><a href="#h0-0-74" id="h0-0-74" class="i">+        --Snap-sigTextPlayer: #fff;
</a><a href="#h0-0-75" id="h0-0-75" class="i">+        --Snap-sigTextNegative: #f23c57;
</a><a href="#h0-0-76" id="h0-0-76" class="i">+        --Snap-sigColorBackgroundBorder: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-77" id="h0-0-77" class="i">+        --Snap-sigBackgroundPrimary: #121212;
</a><a href="#h0-0-78" id="h0-0-78" class="i">+        --Snap-sigBackgroundPrimaryInverse: #fff;
</a><a href="#h0-0-79" id="h0-0-79" class="i">+        --Snap-sigBackgroundSecondary: #1e1e1e;
</a><a href="#h0-0-80" id="h0-0-80" class="i">+        --Snap-sigBackgroundSecondaryHover: #2b2b2b;
</a><a href="#h0-0-81" id="h0-0-81" class="i">+        --Snap-sigBackgroundFeedHover: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-82" id="h0-0-82" class="i">+        --Snap-sigBackgroundMessageHover: #292929;
</a><a href="#h0-0-83" id="h0-0-83" class="i">+        --Snap-sigBackgroundMessageSaved: #333232;
</a><a href="#h0-0-84" id="h0-0-84" class="i">+        --Snap-sigBackgroundMessageSavedHover: #3a3a3a;
</a><a href="#h0-0-85" id="h0-0-85" class="i">+        --Snap-sigMediaControlContainerBackground: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-86" id="h0-0-86" class="i">+        --Snap-sigStartupFooterBackground: rgba(0, 0, 0, 0.05);
</a><a href="#h0-0-87" id="h0-0-87" class="i">+        --Snap-sigButtonPrimary: #0fadff;
</a><a href="#h0-0-88" id="h0-0-88" class="i">+        --Snap-sigButtonPrimaryHover: #42bfff;
</a><a href="#h0-0-89" id="h0-0-89" class="i">+        --Snap-sigButtonSecondary: #2b2b2b;
</a><a href="#h0-0-90" id="h0-0-90" class="i">+        --Snap-sigButtonSecondaryHover: #424242;
</a><a href="#h0-0-91" id="h0-0-91" class="i">+        --Snap-sigButtonSecondaryActive: #5c5c5c;
</a><a href="#h0-0-92" id="h0-0-92" class="i">+        --Snap-sigButtonTertiary: #4e565f;
</a><a href="#h0-0-93" id="h0-0-93" class="i">+        --Snap-sigButtonQuaternary: #fff;
</a><a href="#h0-0-94" id="h0-0-94" class="i">+        --Snap-sigButtonInactive: #1e1e1e;
</a><a href="#h0-0-95" id="h0-0-95" class="i">+        --Snap-sigButtonNegative: #e1143d;
</a><a href="#h0-0-96" id="h0-0-96" class="i">+        --Snap-sigButtonOnPrimary: #fff;
</a><a href="#h0-0-97" id="h0-0-97" class="i">+        --Snap-sigButtonOnSecondary: #dedede;
</a><a href="#h0-0-98" id="h0-0-98" class="i">+        --Snap-sigButtonOnTertiary: #fff;
</a><a href="#h0-0-99" id="h0-0-99" class="i">+        --Snap-sigButtonOnQuaternary: #1e1e1e;
</a><a href="#h0-0-100" id="h0-0-100" class="i">+        --Snap-sigButtonOnInactive: rgba(255, 255, 255, 0.3);
</a><a href="#h0-0-101" id="h0-0-101" class="i">+        --Snap-sigButtonOnNegative: #fff;
</a><a href="#h0-0-102" id="h0-0-102" class="i">+        --Snap-sigMain: #121212;
</a><a href="#h0-0-103" id="h0-0-103" class="i">+        --Snap-sigSubscreen: #121212;
</a><a href="#h0-0-104" id="h0-0-104" class="i">+        --Snap-sigOverlay: rgba(0, 0, 0, 0.4);
</a><a href="#h0-0-105" id="h0-0-105" class="i">+        --Snap-sigOverlayHover: rgba(0, 0, 0, 0.35);
</a><a href="#h0-0-106" id="h0-0-106" class="i">+        --Snap-sigSurface: #1e1e1e;
</a><a href="#h0-0-107" id="h0-0-107" class="i">+        --Snap-sigSurfaceRGB: 30, 30, 30;
</a><a href="#h0-0-108" id="h0-0-108" class="i">+        --Snap-sigSurfaceDown: #212121;
</a><a href="#h0-0-109" id="h0-0-109" class="i">+        --Snap-sigAboveSurface: #292929;
</a><a href="#h0-0-110" id="h0-0-110" class="i">+        --Snap-sigObject: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-111" id="h0-0-111" class="i">+        --Snap-sigObjectDown: rgba(255, 255, 255, 0.19);
</a><a href="#h0-0-112" id="h0-0-112" class="i">+        --Snap-sigConversationBoxBackground: rgba(255, 255, 255, 0.25);
</a><a href="#h0-0-113" id="h0-0-113" class="i">+        --Snap-sigDivider: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-114" id="h0-0-114" class="i">+        --Snap-sigDividerLight: rgba(255, 255, 255, 0.2);
</a><a href="#h0-0-115" id="h0-0-115" class="i">+        --Snap-sigPlaceholder: #1e1e1e;
</a><a href="#h0-0-116" id="h0-0-116" class="i">+        --Snap-sigDisabled: rgba(255, 255, 255, 0.1);
</a><a href="#h0-0-117" id="h0-0-117" class="i">+        --Snap-sigCallTileHighlight: rgba(255, 255, 255, 0.8);
</a><a href="#h0-0-118" id="h0-0-118" class="i">+        --Snap-sigChat: #0fadff;
</a><a href="#h0-0-119" id="h0-0-119" class="i">+        --Snap-sigSnapWithoutSound: #f23c57;
</a><a href="#h0-0-120" id="h0-0-120" class="i">+        --Snap-sigSnapWithSound: #a05dcd;
</a><a href="#h0-0-121" id="h0-0-121" class="i">+        --Snap-sigChatSurfaceCalling: #39ca8e;
</a><a href="#h0-0-122" id="h0-0-122" class="i">+        --Snap-sigChatSurfaceCallingDisabled: #105e3d;
</a><a href="#h0-0-123" id="h0-0-123" class="i">+        --Snap-sigChatPending: #767676;
</a><a href="#h0-0-124" id="h0-0-124" class="i">+        --Snap-sigChatPendingHover: #8f8f8f;
</a><a href="#h0-0-125" id="h0-0-125" class="i">+        --Snap-sigChatIcon: #0fadff;
</a><a href="#h0-0-126" id="h0-0-126" class="i">+        --Snap-sigChatIconCaret: #f8616d;
</a><a href="#h0-0-127" id="h0-0-127" class="i">+        --Snap-sigChatShadowOne: 0 0 17px rgba(33, 33, 33, 0.07), 0 0 22px rgba(0, 0, 0, 0.06), 0 0 8px rgba(84, 84, 84, 0.1);
</a><a href="#h0-0-128" id="h0-0-128" class="i">+        --Snap-selectedMiddleColorGradient: rgba(4, 4, 4, 0.1);
</a><a href="#h0-0-129" id="h0-0-129" class="i">+        --Snap-selectedRightColorGradient: rgba(4, 4, 4, 0);
</a><a href="#h0-0-130" id="h0-0-130" class="i">+        --Border: 1px solid var(--Snap-sigColorBackgroundBorder);
</a>     }
 
     body {
<a href="#h0-0-134" id="h0-0-134" class="d">-        margin: 0;
</a>         font-family: &#39;Avenir Next&#39;, sans-serif;
<a href="#h0-0-136" id="h0-0-136" class="d">-        color: var(--sigTextPrimary);
</a><a href="#h0-0-137" id="h0-0-137" class="d">-        background-color: var(--sigBackgroundPrimary);
</a><a href="#h0-0-138" id="h0-0-138" class="i">+        color: var(--Snap-sigTextPrimary);
</a><a href="#h0-0-139" id="h0-0-139" class="i">+        background-color: var(--Snap-sigBackgroundPrimary);
</a><a href="#h0-0-140" id="h0-0-140" class="i">+        margin: 0;
</a><a href="#h0-0-141" id="h0-0-141" class="i">+        padding: 0;
</a><a href="#h0-0-142" id="h0-0-142" class="i">+        display: flex;
</a><a href="#h0-0-143" id="h0-0-143" class="i">+        flex-direction: column;
</a><a href="#h0-0-144" id="h0-0-144" class="i">+        align-items: center;
</a><a href="#h0-0-145" id="h0-0-145" class="i">+        justify-content: flex-start;
</a>     }
 
<a href="#h0-0-148" id="h0-0-148" class="d">-    /* like an header */
</a><a href="#h0-0-149" id="h0-0-149" class="d">-    .conversation_summary {
</a><a href="#h0-0-150" id="h0-0-150" class="i">+    header {
</a><a href="#h0-0-151" id="h0-0-151" class="i">+        width: 100%;
</a><a href="#h0-0-152" id="h0-0-152" class="i">+        padding: 10px 0px;
</a>         display: flex;
<a href="#h0-0-154" id="h0-0-154" class="d">-        flex-direction: row;
</a><a href="#h0-0-155" id="h0-0-155" class="i">+        flex-direction: column;
</a>         align-items: center;
<a href="#h0-0-157" id="h0-0-157" class="d">-        padding: 10px;
</a><a href="#h0-0-158" id="h0-0-158" class="d">-        border-bottom: 1px solid var(--sigColorBackgroundBorder);
</a><a href="#h0-0-159" id="h0-0-159" class="i">+        justify-content: flex-start;
</a><a href="#h0-0-160" id="h0-0-160" class="i">+    }
</a><a href="#h0-0-161" id="h0-0-161" class="i">+
</a><a href="#h0-0-162" id="h0-0-162" class="i">+    header .title {
</a><a href="#h0-0-163" id="h0-0-163" class="i">+        background-color: var(--Snap-sigButtonSecondary);
</a><a href="#h0-0-164" id="h0-0-164" class="i">+        height: 40px;
</a><a href="#h0-0-165" id="h0-0-165" class="i">+        font-weight: 600;
</a><a href="#h0-0-166" id="h0-0-166" class="i">+        padding-inline-end: 16px;
</a><a href="#h0-0-167" id="h0-0-167" class="i">+        border-radius: 999px;
</a><a href="#h0-0-168" id="h0-0-168" class="i">+        line-height: 40px;
</a><a href="#h0-0-169" id="h0-0-169" class="i">+        padding: 0 20px;
</a>     }
 
<a href="#h0-0-172" id="h0-0-172" class="d">-    .conversation_message_container {
</a><a href="#h0-0-173" id="h0-0-173" class="i">+    main {
</a><a href="#h0-0-174" id="h0-0-174" class="i">+        background-color: var(--Snap-sigBackgroundSecondary);
</a><a href="#h0-0-175" id="h0-0-175" class="i">+        border: var(--Border);
</a><a href="#h0-0-176" id="h0-0-176" class="i">+        border-radius: 12px;
</a><a href="#h0-0-177" id="h0-0-177" class="i">+        width: calc(100% - 30px);
</a>         display: flex;
         flex-direction: column;
<a href="#h0-0-180" id="h0-0-180" class="d">-        padding: 5px;
</a><a href="#h0-0-181" id="h0-0-181" class="d">-        background-color: var(--sigBackgroundSecondary);
</a>     }
 
<a href="#h0-0-184" id="h0-0-184" class="d">-    .message {
</a><a href="#h0-0-185" id="h0-0-185" class="i">+    main&gt;.message {
</a>         display: flex;
<a href="#h0-0-187" id="h0-0-187" class="d">-        flex-direction: row;
</a><a href="#h0-0-188" id="h0-0-188" class="d">-        align-items: center;
</a><a href="#h0-0-189" id="h0-0-189" class="d">-        padding: 5px;
</a><a href="#h0-0-190" id="h0-0-190" class="d">-        margin-left: 5px;
</a><a href="#h0-0-191" id="h0-0-191" class="d">-        border-bottom: 1px solid var(--sigColorBackgroundBorder);
</a><a href="#h0-0-192" id="h0-0-192" class="i">+        flex-direction: column;
</a><a href="#h0-0-193" id="h0-0-193" class="i">+        align-items: stretch;
</a><a href="#h0-0-194" id="h0-0-194" class="i">+        justify-content: flex-start;
</a><a href="#h0-0-195" id="h0-0-195" class="i">+        flex-wrap: nowrap;
</a><a href="#h0-0-196" id="h0-0-196" class="i">+        margin: 5px 15px;
</a>     }
 
<a href="#h0-0-199" id="h0-0-199" class="d">-    .message .header {
</a><a href="#h0-0-200" id="h0-0-200" class="i">+    main&gt;.message .header {
</a><a href="#h0-0-201" id="h0-0-201" class="i">+        width: 100%;
</a>         display: flex;
<a href="#h0-0-203" id="h0-0-203" class="d">-        flex-direction: column;
</a>         vertical-align: top;
         align-self: flex-start;
<a href="#h0-0-206" id="h0-0-206" class="i">+        flex-direction: row;
</a><a href="#h0-0-207" id="h0-0-207" class="i">+        flex-wrap: nowrap;
</a><a href="#h0-0-208" id="h0-0-208" class="i">+        justify-content: space-between;
</a><a href="#h0-0-209" id="h0-0-209" class="i">+        align-items: center;
</a>     }
 
<a href="#h0-0-212" id="h0-0-212" class="d">-    .message .username {
</a><a href="#h0-0-213" id="h0-0-213" class="i">+    main&gt;.message:nth-child(2n) .username {
</a><a href="#h0-0-214" id="h0-0-214" class="i">+        color: #dcedc1;
</a><a href="#h0-0-215" id="h0-0-215" class="i">+    }
</a><a href="#h0-0-216" id="h0-0-216" class="i">+
</a><a href="#h0-0-217" id="h0-0-217" class="i">+    main&gt;.message:nth-child(2n + 1) .username {
</a><a href="#h0-0-218" id="h0-0-218" class="i">+        color: #ffd3b6;
</a><a href="#h0-0-219" id="h0-0-219" class="i">+    }
</a><a href="#h0-0-220" id="h0-0-220" class="i">+
</a><a href="#h0-0-221" id="h0-0-221" class="i">+    main&gt;.message .username {
</a>         font-weight: bold;
     }
 
<a href="#h0-0-225" id="h0-0-225" class="d">-    .message .time {
</a><a href="#h0-0-226" id="h0-0-226" class="i">+    main&gt;.message .time {
</a><a href="#h0-0-227" id="h0-0-227" class="i">+        color: var(--Snap-sigTextSecondary);
</a>         font-size: 12px;
<a href="#h0-0-229" id="h0-0-229" class="d">-        color: var(--sigTextSecondary);
</a><a href="#h0-0-230" id="h0-0-230" class="i">+        font-weight: 600;
</a>     }
 
<a href="#h0-0-233" id="h0-0-233" class="d">-    .message .content {
</a><a href="#h0-0-234" id="h0-0-234" class="d">-        margin-left: 10px;
</a><a href="#h0-0-235" id="h0-0-235" class="d">-        display: flex;
</a><a href="#h0-0-236" id="h0-0-236" class="d">-        flex-direction: row;
</a><a href="#h0-0-237" id="h0-0-237" class="d">-        align-items: center;
</a><a href="#h0-0-238" id="h0-0-238" class="i">+    main&gt;.message:nth-child(2n) .content {
</a><a href="#h0-0-239" id="h0-0-239" class="i">+        border-color: #dcedc1;
</a><a href="#h0-0-240" id="h0-0-240" class="i">+    }
</a> 
<a href="#h0-0-242" id="h0-0-242" class="i">+    main&gt;.message:nth-child(2n + 1) .content {
</a><a href="#h0-0-243" id="h0-0-243" class="i">+        border-color: #ffd3b6;
</a>     }
 
<a href="#h0-0-246" id="h0-0-246" class="d">-    .chat_media {
</a><a href="#h0-0-247" id="h0-0-247" class="d">-        max-width: 300px;
</a><a href="#h0-0-248" id="h0-0-248" class="d">-        max-height: 500px;
</a><a href="#h0-0-249" id="h0-0-249" class="i">+    main&gt;.message .content {
</a><a href="#h0-0-250" id="h0-0-250" class="i">+        background-color: var(--Snap-sigBackgroundMessageSaved);
</a><a href="#h0-0-251" id="h0-0-251" class="i">+        border-left: 3px solid;
</a><a href="#h0-0-252" id="h0-0-252" class="i">+        border-radius: 3px;
</a><a href="#h0-0-253" id="h0-0-253" class="i">+        margin-top: 4px;
</a><a href="#h0-0-254" id="h0-0-254" class="i">+        padding-left: 4px;
</a><a href="#h0-0-255" id="h0-0-255" class="i">+        padding: 3px 0 3px 6px;
</a>     }
 
<a href="#h0-0-258" id="h0-0-258" class="d">-    .overlay_media {
</a><a href="#h0-0-259" id="h0-0-259" class="i">+    main&gt;.message .content div:has(.chat_media:not(audio):not(.overlay_media)) {
</a><a href="#h0-0-260" id="h0-0-260" class="i">+        display: inline-block;
</a><a href="#h0-0-261" id="h0-0-261" class="i">+        resize: horizontal;
</a><a href="#h0-0-262" id="h0-0-262" class="i">+        overflow: hidden;
</a><a href="#h0-0-263" id="h0-0-263" class="i">+        line-height: 0;
</a><a href="#h0-0-264" id="h0-0-264" class="i">+        height: auto;
</a><a href="#h0-0-265" id="h0-0-265" class="i">+        width: 300px;
</a><a href="#h0-0-266" id="h0-0-266" class="i">+    }
</a><a href="#h0-0-267" id="h0-0-267" class="i">+
</a><a href="#h0-0-268" id="h0-0-268" class="i">+    main&gt;.message .chat_media:not(audio):not(.overlay_media) {
</a><a href="#h0-0-269" id="h0-0-269" class="i">+        width: 100%;
</a><a href="#h0-0-270" id="h0-0-270" class="i">+        height: auto;
</a><a href="#h0-0-271" id="h0-0-271" class="i">+    }
</a><a href="#h0-0-272" id="h0-0-272" class="i">+
</a><a href="#h0-0-273" id="h0-0-273" class="i">+    @-moz-document url-prefix() {
</a><a href="#h0-0-274" id="h0-0-274" class="i">+        main&gt;.message .content div {
</a><a href="#h0-0-275" id="h0-0-275" class="i">+            display: inline-block;
</a><a href="#h0-0-276" id="h0-0-276" class="i">+            resize: horizontal;
</a><a href="#h0-0-277" id="h0-0-277" class="i">+            overflow: hidden;
</a><a href="#h0-0-278" id="h0-0-278" class="i">+            line-height: 0;
</a><a href="#h0-0-279" id="h0-0-279" class="i">+            height: auto;
</a><a href="#h0-0-280" id="h0-0-280" class="i">+            width: 300px;
</a><a href="#h0-0-281" id="h0-0-281" class="i">+        }
</a><a href="#h0-0-282" id="h0-0-282" class="i">+
</a><a href="#h0-0-283" id="h0-0-283" class="i">+        main&gt;.message .chat_media:not(.overlay_media) {
</a><a href="#h0-0-284" id="h0-0-284" class="i">+            width: 100%;
</a><a href="#h0-0-285" id="h0-0-285" class="i">+            height: auto;
</a><a href="#h0-0-286" id="h0-0-286" class="i">+        }
</a><a href="#h0-0-287" id="h0-0-287" class="i">+    }
</a><a href="#h0-0-288" id="h0-0-288" class="i">+
</a><a href="#h0-0-289" id="h0-0-289" class="i">+
</a><a href="#h0-0-290" id="h0-0-290" class="i">+    main&gt;.message .overlay_media {
</a><a href="#h0-0-291" id="h0-0-291" class="i">+        width: inherit;
</a><a href="#h0-0-292" id="h0-0-292" class="i">+        height: inherit;
</a>         position: absolute;
         pointer-events: none;
     }
 
<a href="#h0-0-297" id="h0-0-297" class="d">-    .red_snap_svg {
</a><a href="#h0-0-298" id="h0-0-298" class="d">-        color: var(--sigSnapWithoutSound);
</a><a href="#h0-0-299" id="h0-0-299" class="i">+    main&gt;.message .red_snap_svg {
</a><a href="#h0-0-300" id="h0-0-300" class="i">+        color: var(--Snap-sigSnapWithoutSound);
</a>     }
 &lt;/style&gt;
 &lt;body&gt;
<a href="#h0-0-304" id="h0-0-304" class="d">-    &lt;div class=&quot;conversation_summary&quot;&gt;
</a><a href="#h0-0-305" id="h0-0-305" class="d">-        &lt;div class=&quot;title&quot;&gt;&lt;/div&gt;
</a><a href="#h0-0-306" id="h0-0-306" class="d">-    &lt;/div&gt;
</a><a href="#h0-0-307" id="h0-0-307" class="d">-
</a><a href="#h0-0-308" id="h0-0-308" class="d">-    &lt;div class=&quot;conversation_message_container&quot;&gt;&lt;/div&gt;
</a><a href="#h0-0-309" id="h0-0-309" class="d">-    &lt;div style=&quot;display: none;&quot;&gt;
</a><a href="#h0-0-310" id="h0-0-310" class="d">-        &lt;svg class=&quot;red_snap_svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; fill=&quot;none&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
</a><a href="#h0-0-311" id="h0-0-311" class="d">-            &lt;rect x=&quot;2.75&quot; y=&quot;2.75&quot; width=&quot;10.5&quot; height=&quot;10.5&quot; rx=&quot;1.808&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;1.5&quot;&gt;&lt;/rect&gt;
</a><a href="#h0-0-312" id="h0-0-312" class="d">-        &lt;/svg&gt;
</a><a href="#h0-0-313" id="h0-0-313" class="d">-    &lt;/div&gt;
</a><a href="#h0-0-314" id="h0-0-314" class="d">-
</a><a href="#h0-0-315" id="h0-0-315" class="d">-    &lt;script&gt;
</a><a href="#h0-0-316" id="h0-0-316" class="d">-        const conversationData = JSON.parse(document.querySelector(&quot;.exported_content&quot;).innerHTML)
</a><a href="#h0-0-317" id="h0-0-317" class="d">-        const participants = Object.values(conversationData.participants)
</a><a href="#h0-0-318" id="h0-0-318" class="d">-
</a><a href="#h0-0-319" id="h0-0-319" class="d">-        function base64decode(data) {
</a><a href="#h0-0-320" id="h0-0-320" class="d">-            return new Uint8Array(atob(data).split(&#39;&#39;).map(c =&gt; c.charCodeAt(0)))
</a><a href="#h0-0-321" id="h0-0-321" class="d">-        }
</a><a href="#h0-0-322" id="h0-0-322" class="i">+&lt;header&gt;
</a><a href="#h0-0-323" id="h0-0-323" class="i">+    &lt;div class=&quot;title&quot;&gt;&lt;/div&gt;
</a><a href="#h0-0-324" id="h0-0-324" class="i">+&lt;/header&gt;
</a> 
<a href="#h0-0-326" id="h0-0-326" class="d">-        function makeConversationSummary() {
</a><a href="#h0-0-327" id="h0-0-327" class="d">-            const conversationTitle = conversationData.conversationName != null ?
</a><a href="#h0-0-328" id="h0-0-328" class="d">-            conversationData.conversationName : &quot;DM with &quot; + Object.values(participants).map(user =&gt; user.username).join(&quot;, &quot;)
</a><a href="#h0-0-329" id="h0-0-329" class="i">+&lt;main&gt;&lt;/main&gt;
</a> 
<a href="#h0-0-331" id="h0-0-331" class="d">-            document.querySelector(&quot;.conversation_summary .title&quot;).textContent = conversationTitle
</a><a href="#h0-0-332" id="h0-0-332" class="d">-        }
</a><a href="#h0-0-333" id="h0-0-333" class="i">+&lt;div style=&quot;display: none;&quot;&gt;
</a><a href="#h0-0-334" id="h0-0-334" class="i">+    &lt;svg class=&quot;red_snap_svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; fill=&quot;none&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
</a><a href="#h0-0-335" id="h0-0-335" class="i">+        &lt;rect x=&quot;4&quot; y=&quot;5&quot; width=&quot;10.5&quot; height=&quot;10.5&quot; rx=&quot;1.808&quot; stroke=&quot;currentColor&quot; stroke-width=&quot;1.5&quot;&gt;&lt;/rect&gt;
</a><a href="#h0-0-336" id="h0-0-336" class="i">+    &lt;/svg&gt;
</a><a href="#h0-0-337" id="h0-0-337" class="i">+&lt;/div&gt;
</a> 
<a href="#h0-0-339" id="h0-0-339" class="d">-        function decodeMedia(element) {
</a><a href="#h0-0-340" id="h0-0-340" class="d">-            const decodedData = new Uint8Array(
</a><a href="#h0-0-341" id="h0-0-341" class="d">-                inflate(
</a><a href="#h0-0-342" id="h0-0-342" class="d">-                    base64decode(
</a><a href="#h0-0-343" id="h0-0-343" class="d">-                        element.innerHTML.substring(5, element.innerHTML.length - 4)
</a><a href="#h0-0-344" id="h0-0-344" class="d">-                    )
</a><a href="#h0-0-345" id="h0-0-345" class="i">+&lt;script&gt;
</a><a href="#h0-0-346" id="h0-0-346" class="i">+    function base64decode(data) {
</a><a href="#h0-0-347" id="h0-0-347" class="i">+        return new Uint8Array(atob(data).split(&#39;&#39;).map(c =&gt; c.charCodeAt(0)))
</a><a href="#h0-0-348" id="h0-0-348" class="i">+    }
</a><a href="#h0-0-349" id="h0-0-349" class="i">+
</a><a href="#h0-0-350" id="h0-0-350" class="i">+    const conversationData = JSON.parse(new TextDecoder().decode(new Uint8Array(inflate(base64decode(document.querySelector(&quot;.exported_content&quot;).innerHTML)))))
</a><a href="#h0-0-351" id="h0-0-351" class="i">+    const participants = Object.values(conversationData.participants)
</a><a href="#h0-0-352" id="h0-0-352" class="i">+
</a><a href="#h0-0-353" id="h0-0-353" class="i">+    function makeHeader() {
</a><a href="#h0-0-354" id="h0-0-354" class="i">+        const conversationTitle = conversationData.conversationName != null ? conversationData.conversationName : &quot;DM with &quot; + Object.values(participants).map(user =&gt; user.username).join(&quot;, &quot;)
</a><a href="#h0-0-355" id="h0-0-355" class="i">+        document.querySelector(&quot;header &gt; .title&quot;).textContent = conversationTitle
</a><a href="#h0-0-356" id="h0-0-356" class="i">+        document.title = conversationTitle
</a><a href="#h0-0-357" id="h0-0-357" class="i">+    }
</a><a href="#h0-0-358" id="h0-0-358" class="i">+
</a><a href="#h0-0-359" id="h0-0-359" class="i">+    function decodeMedia(element) {
</a><a href="#h0-0-360" id="h0-0-360" class="i">+        const decodedData = new Uint8Array(
</a><a href="#h0-0-361" id="h0-0-361" class="i">+            inflate(
</a><a href="#h0-0-362" id="h0-0-362" class="i">+                base64decode(
</a><a href="#h0-0-363" id="h0-0-363" class="i">+                    element.innerHTML.substring(5, element.innerHTML.length - 4)
</a>                 )
             )
<a href="#h0-0-366" id="h0-0-366" class="i">+        )
</a> 
<a href="#h0-0-368" id="h0-0-368" class="d">-            return URL.createObjectURL(new Blob([decodedData]))
</a><a href="#h0-0-369" id="h0-0-369" class="d">-        }
</a><a href="#h0-0-370" id="h0-0-370" class="d">-
</a><a href="#h0-0-371" id="h0-0-371" class="d">-        function makeConversationMessageContainer() {
</a><a href="#h0-0-372" id="h0-0-372" class="d">-            const messageTemplate = document.querySelector(&quot;#message_template&quot;)
</a><a href="#h0-0-373" id="h0-0-373" class="d">-            Object.values(conversationData.messages).forEach(message =&gt; {
</a><a href="#h0-0-374" id="h0-0-374" class="d">-                const messageObject = document.createElement(&quot;div&quot;)
</a><a href="#h0-0-375" id="h0-0-375" class="d">-                messageObject.classList.add(&quot;message&quot;)
</a><a href="#h0-0-376" id="h0-0-376" class="i">+        return URL.createObjectURL(new Blob([decodedData]))
</a><a href="#h0-0-377" id="h0-0-377" class="i">+    }
</a> 
<a href="#h0-0-379" id="h0-0-379" class="d">-                messageObject.appendChild(((headerElement) =&gt;{
</a><a href="#h0-0-380" id="h0-0-380" class="d">-                    headerElement.classList.add(&quot;header&quot;)
</a><a href="#h0-0-381" id="h0-0-381" class="i">+    function makeMain() {
</a><a href="#h0-0-382" id="h0-0-382" class="i">+        const messageTemplate = document.querySelector(&quot;#message_template&quot;)
</a><a href="#h0-0-383" id="h0-0-383" class="i">+        Object.values(conversationData.messages).forEach(message =&gt; {
</a><a href="#h0-0-384" id="h0-0-384" class="i">+            const messageObject = document.createElement(&quot;div&quot;)
</a><a href="#h0-0-385" id="h0-0-385" class="i">+            messageObject.classList.add(&quot;message&quot;)
</a> 
<a href="#h0-0-387" id="h0-0-387" class="d">-                    headerElement.appendChild(((elem) =&gt;{
</a><a href="#h0-0-388" id="h0-0-388" class="d">-                        elem.classList.add(&quot;username&quot;)
</a><a href="#h0-0-389" id="h0-0-389" class="d">-                        const participant = participants[message.senderId]
</a><a href="#h0-0-390" id="h0-0-390" class="d">-                        elem.innerHTML = (participant == null) ? &quot;Unknown user&quot; : participant.username
</a><a href="#h0-0-391" id="h0-0-391" class="d">-                        return elem
</a><a href="#h0-0-392" id="h0-0-392" class="d">-                    })(document.createElement(&quot;div&quot;)))
</a><a href="#h0-0-393" id="h0-0-393" class="i">+            messageObject.appendChild(((headerElement) =&gt; {
</a><a href="#h0-0-394" id="h0-0-394" class="i">+                headerElement.classList.add(&quot;header&quot;)
</a> 
<a href="#h0-0-396" id="h0-0-396" class="i">+                headerElement.appendChild(((elem) =&gt; {
</a><a href="#h0-0-397" id="h0-0-397" class="i">+                    elem.classList.add(&quot;username&quot;)
</a><a href="#h0-0-398" id="h0-0-398" class="i">+                    const participant = participants[message.senderId]
</a><a href="#h0-0-399" id="h0-0-399" class="i">+                    elem.innerHTML = (participant == null) ? &quot;Unknown user&quot; : participant.username
</a><a href="#h0-0-400" id="h0-0-400" class="i">+                    return elem
</a><a href="#h0-0-401" id="h0-0-401" class="i">+                })(document.createElement(&quot;div&quot;)))
</a> 
<a href="#h0-0-403" id="h0-0-403" class="d">-                    headerElement.appendChild(((elem) =&gt;{
</a><a href="#h0-0-404" id="h0-0-404" class="d">-                        elem.classList.add(&quot;time&quot;)
</a><a href="#h0-0-405" id="h0-0-405" class="d">-                        elem.innerHTML = new Date(message.createdTimestamp).toISOString()
</a><a href="#h0-0-406" id="h0-0-406" class="d">-                        return elem
</a><a href="#h0-0-407" id="h0-0-407" class="d">-                    })(document.createElement(&quot;div&quot;)))
</a> 
<a href="#h0-0-409" id="h0-0-409" class="d">-                    return headerElement
</a><a href="#h0-0-410" id="h0-0-410" class="i">+                headerElement.appendChild(((elem) =&gt; {
</a><a href="#h0-0-411" id="h0-0-411" class="i">+                    elem.classList.add(&quot;time&quot;)
</a><a href="#h0-0-412" id="h0-0-412" class="i">+                    elem.innerHTML = new Date(message.createdTimestamp).toUTCString()
</a><a href="#h0-0-413" id="h0-0-413" class="i">+                    return elem
</a>                 })(document.createElement(&quot;div&quot;)))
 
<a href="#h0-0-416" id="h0-0-416" class="d">-                messageObject.appendChild(((messageContainer) =&gt;{
</a><a href="#h0-0-417" id="h0-0-417" class="d">-                    messageContainer.classList.add(&quot;content&quot;)
</a><a href="#h0-0-418" id="h0-0-418" class="d">-
</a><a href="#h0-0-419" id="h0-0-419" class="d">-                    messageContainer.innerHTML = message.serializedContent
</a><a href="#h0-0-420" id="h0-0-420" class="d">-
</a><a href="#h0-0-421" id="h0-0-421" class="d">-                    if (!message.serializedContent) {
</a><a href="#h0-0-422" id="h0-0-422" class="d">-                        messageContainer.innerHTML = &quot;&quot;
</a><a href="#h0-0-423" id="h0-0-423" class="d">-                        let messageData = &quot;&quot;
</a><a href="#h0-0-424" id="h0-0-424" class="d">-                        switch(message.type) {
</a><a href="#h0-0-425" id="h0-0-425" class="d">-                            case &quot;SNAP&quot;:
</a><a href="#h0-0-426" id="h0-0-426" class="d">-                                messageContainer.appendChild(document.querySelector(&#39;.red_snap_svg&#39;).cloneNode(true))
</a><a href="#h0-0-427" id="h0-0-427" class="d">-                                messageData = &quot;Snap&quot;
</a><a href="#h0-0-428" id="h0-0-428" class="d">-                                break
</a><a href="#h0-0-429" id="h0-0-429" class="d">-                            default:
</a><a href="#h0-0-430" id="h0-0-430" class="d">-                                messageData = message.type
</a><a href="#h0-0-431" id="h0-0-431" class="d">-                        }
</a><a href="#h0-0-432" id="h0-0-432" class="d">-                        messageContainer.innerHTML += messageData
</a><a href="#h0-0-433" id="h0-0-433" class="i">+                return headerElement
</a><a href="#h0-0-434" id="h0-0-434" class="i">+            })(document.createElement(&quot;div&quot;)))
</a><a href="#h0-0-435" id="h0-0-435" class="i">+
</a><a href="#h0-0-436" id="h0-0-436" class="i">+            messageObject.appendChild(((messageContainer) =&gt; {
</a><a href="#h0-0-437" id="h0-0-437" class="i">+                messageContainer.classList.add(&quot;content&quot;)
</a><a href="#h0-0-438" id="h0-0-438" class="i">+                messageContainer.innerHTML = message.serializedContent
</a><a href="#h0-0-439" id="h0-0-439" class="i">+
</a><a href="#h0-0-440" id="h0-0-440" class="i">+                if (!message.serializedContent) {
</a><a href="#h0-0-441" id="h0-0-441" class="i">+                    messageContainer.innerHTML = &quot;&quot;
</a><a href="#h0-0-442" id="h0-0-442" class="i">+                    let messageData = &quot;&quot;
</a><a href="#h0-0-443" id="h0-0-443" class="i">+                    switch (message.type) {
</a><a href="#h0-0-444" id="h0-0-444" class="i">+                        case &quot;SNAP&quot;:
</a><a href="#h0-0-445" id="h0-0-445" class="i">+                            messageContainer.appendChild(document.querySelector(&#39;.red_snap_svg&#39;).cloneNode(true))
</a><a href="#h0-0-446" id="h0-0-446" class="i">+                            messageData = &quot;Snap&quot;
</a><a href="#h0-0-447" id="h0-0-447" class="i">+                            break
</a><a href="#h0-0-448" id="h0-0-448" class="i">+                        default:
</a><a href="#h0-0-449" id="h0-0-449" class="i">+                            messageData = message.type
</a>                     }
<a href="#h0-0-451" id="h0-0-451" class="i">+                    messageContainer.innerHTML += messageData
</a><a href="#h0-0-452" id="h0-0-452" class="i">+                }
</a> 
<a href="#h0-0-454" id="h0-0-454" class="d">-                    if (message.attachments &amp;&amp; message.attachments.length &gt; 0) {
</a><a href="#h0-0-455" id="h0-0-455" class="d">-                        let observers = []
</a><a href="#h0-0-456" id="h0-0-456" class="i">+                if (message.attachments &amp;&amp; message.attachments.length &gt; 0) {
</a><a href="#h0-0-457" id="h0-0-457" class="i">+                    let observers = []
</a> 
<a href="#h0-0-459" id="h0-0-459" class="d">-                        message.attachments.forEach((attachment, index) =&gt; {
</a><a href="#h0-0-460" id="h0-0-460" class="d">-                            const mediaKey = attachment.key.replace(/(=)/g, &quot;&quot;)
</a><a href="#h0-0-461" id="h0-0-461" class="i">+                    message.attachments.forEach((attachment, index) =&gt; {
</a><a href="#h0-0-462" id="h0-0-462" class="i">+                        const mediaKey = attachment.key.replace(/(=)/g, &quot;&quot;)
</a> 
<a href="#h0-0-464" id="h0-0-464" class="d">-                            observers.push(() =&gt; {
</a><a href="#h0-0-465" id="h0-0-465" class="d">-                                const originalMedia = document.querySelector(&#39;.media-ORIGINAL_&#39; + mediaKey)
</a><a href="#h0-0-466" id="h0-0-466" class="d">-                                if (!originalMedia) {
</a><a href="#h0-0-467" id="h0-0-467" class="d">-                                    return
</a><a href="#h0-0-468" id="h0-0-468" class="d">-                                }
</a><a href="#h0-0-469" id="h0-0-469" class="i">+                        observers.push(() =&gt; {
</a><a href="#h0-0-470" id="h0-0-470" class="i">+                            const originalMedia = document.querySelector(&#39;.media-ORIGINAL_&#39; + mediaKey)
</a><a href="#h0-0-471" id="h0-0-471" class="i">+                            if (!originalMedia) {
</a><a href="#h0-0-472" id="h0-0-472" class="i">+                                return
</a><a href="#h0-0-473" id="h0-0-473" class="i">+                            }
</a> 
<a href="#h0-0-475" id="h0-0-475" class="d">-                                const originalMediaUrl = decodeMedia(originalMedia)
</a><a href="#h0-0-476" id="h0-0-476" class="i">+                            const originalMediaUrl = decodeMedia(originalMedia)
</a> 
<a href="#h0-0-478" id="h0-0-478" class="d">-                                const mediaContainer = document.createElement(&quot;div&quot;)
</a><a href="#h0-0-479" id="h0-0-479" class="d">-                                messageContainer.appendChild(mediaContainer)
</a><a href="#h0-0-480" id="h0-0-480" class="i">+                            const mediaContainer = document.createElement(&quot;div&quot;)
</a><a href="#h0-0-481" id="h0-0-481" class="i">+                            messageContainer.appendChild(mediaContainer)
</a> 
<a href="#h0-0-483" id="h0-0-483" class="d">-                                const imageTag = document.createElement(&quot;img&quot;)
</a><a href="#h0-0-484" id="h0-0-484" class="d">-                                imageTag.src = originalMediaUrl
</a><a href="#h0-0-485" id="h0-0-485" class="d">-                                imageTag.classList.add(&quot;chat_media&quot;)
</a><a href="#h0-0-486" id="h0-0-486" class="d">-                                mediaContainer.appendChild(imageTag)
</a><a href="#h0-0-487" id="h0-0-487" class="i">+                            const imageTag = document.createElement(&quot;img&quot;)
</a><a href="#h0-0-488" id="h0-0-488" class="i">+                            imageTag.src = originalMediaUrl
</a><a href="#h0-0-489" id="h0-0-489" class="i">+                            imageTag.classList.add(&quot;chat_media&quot;)
</a><a href="#h0-0-490" id="h0-0-490" class="i">+                            mediaContainer.appendChild(imageTag)
</a> 
<a href="#h0-0-492" id="h0-0-492" class="d">-                                imageTag.onerror = () =&gt; {
</a><a href="#h0-0-493" id="h0-0-493" class="d">-                                    mediaContainer.removeChild(imageTag)
</a><a href="#h0-0-494" id="h0-0-494" class="d">-                                    const mediaTag = document.createElement(message.type === &quot;NOTE&quot; ? &quot;audio&quot; : &quot;video&quot;)
</a><a href="#h0-0-495" id="h0-0-495" class="d">-                                    mediaTag.classList.add(&quot;chat_media&quot;)
</a><a href="#h0-0-496" id="h0-0-496" class="d">-                                    mediaTag.src = originalMediaUrl
</a><a href="#h0-0-497" id="h0-0-497" class="d">-                                    mediaTag.preload = &quot;metadata&quot;
</a><a href="#h0-0-498" id="h0-0-498" class="d">-                                    mediaTag.controls = true
</a><a href="#h0-0-499" id="h0-0-499" class="d">-                                    mediaContainer.appendChild(mediaTag)
</a><a href="#h0-0-500" id="h0-0-500" class="d">-                                }
</a><a href="#h0-0-501" id="h0-0-501" class="i">+                            imageTag.onerror = () =&gt; {
</a><a href="#h0-0-502" id="h0-0-502" class="i">+                                mediaContainer.removeChild(imageTag)
</a><a href="#h0-0-503" id="h0-0-503" class="i">+                                const mediaTag = document.createElement(message.type === &quot;NOTE&quot; ? &quot;audio&quot; : &quot;video&quot;)
</a><a href="#h0-0-504" id="h0-0-504" class="i">+                                mediaTag.classList.add(&quot;chat_media&quot;)
</a><a href="#h0-0-505" id="h0-0-505" class="i">+                                mediaTag.src = originalMediaUrl
</a><a href="#h0-0-506" id="h0-0-506" class="i">+                                mediaTag.preload = &quot;metadata&quot;
</a><a href="#h0-0-507" id="h0-0-507" class="i">+                                mediaTag.controls = true
</a><a href="#h0-0-508" id="h0-0-508" class="i">+                                mediaContainer.appendChild(mediaTag)
</a><a href="#h0-0-509" id="h0-0-509" class="i">+                            }
</a> 
<a href="#h0-0-511" id="h0-0-511" class="d">-                                const overlay = document.querySelector(&#39;.media-OVERLAY_&#39; + mediaKey)
</a><a href="#h0-0-512" id="h0-0-512" class="d">-                                if (!overlay) {
</a><a href="#h0-0-513" id="h0-0-513" class="d">-                                    return
</a><a href="#h0-0-514" id="h0-0-514" class="d">-                                }
</a><a href="#h0-0-515" id="h0-0-515" class="i">+                            const overlay = document.querySelector(&#39;.media-OVERLAY_&#39; + mediaKey)
</a><a href="#h0-0-516" id="h0-0-516" class="i">+                            if (!overlay) {
</a><a href="#h0-0-517" id="h0-0-517" class="i">+                                return
</a><a href="#h0-0-518" id="h0-0-518" class="i">+                            }
</a> 
<a href="#h0-0-520" id="h0-0-520" class="d">-                                const overlayImage = document.createElement(&quot;img&quot;)
</a><a href="#h0-0-521" id="h0-0-521" class="d">-                                overlayImage.src = decodeMedia(overlay)
</a><a href="#h0-0-522" id="h0-0-522" class="d">-                                overlayImage.classList.add(&quot;chat_media&quot;)
</a><a href="#h0-0-523" id="h0-0-523" class="d">-                                overlayImage.classList.add(&quot;overlay_media&quot;)
</a><a href="#h0-0-524" id="h0-0-524" class="d">-                                mediaContainer.appendChild(overlayImage)
</a><a href="#h0-0-525" id="h0-0-525" class="d">-                            })
</a><a href="#h0-0-526" id="h0-0-526" class="i">+                            const overlayImage = document.createElement(&quot;img&quot;)
</a><a href="#h0-0-527" id="h0-0-527" class="i">+                            overlayImage.src = decodeMedia(overlay)
</a><a href="#h0-0-528" id="h0-0-528" class="i">+                            overlayImage.classList.add(&quot;chat_media&quot;)
</a><a href="#h0-0-529" id="h0-0-529" class="i">+                            overlayImage.classList.add(&quot;overlay_media&quot;)
</a><a href="#h0-0-530" id="h0-0-530" class="i">+                            mediaContainer.appendChild(overlayImage)
</a>                         })
<a href="#h0-0-532" id="h0-0-532" class="i">+                    })
</a><a href="#h0-0-533" id="h0-0-533" class="i">+
</a><a href="#h0-0-534" id="h0-0-534" class="i">+                    let fetched = false
</a><a href="#h0-0-535" id="h0-0-535" class="i">+
</a><a href="#h0-0-536" id="h0-0-536" class="i">+                    new IntersectionObserver(entries =&gt; {
</a><a href="#h0-0-537" id="h0-0-537" class="i">+                        if (!fetched &amp;&amp; entries[0].isIntersecting === true) {
</a><a href="#h0-0-538" id="h0-0-538" class="i">+                            fetched = true
</a><a href="#h0-0-539" id="h0-0-539" class="i">+                            messageContainer.innerHTML = &quot;&quot;
</a><a href="#h0-0-540" id="h0-0-540" class="i">+                            observers.forEach(c =&gt; {
</a><a href="#h0-0-541" id="h0-0-541" class="i">+                                try {
</a><a href="#h0-0-542" id="h0-0-542" class="i">+                                    c()
</a><a href="#h0-0-543" id="h0-0-543" class="i">+                                } catch (e) {
</a><a href="#h0-0-544" id="h0-0-544" class="i">+                                    console.log(e)
</a><a href="#h0-0-545" id="h0-0-545" class="i">+                                }
</a><a href="#h0-0-546" id="h0-0-546" class="i">+                            })
</a><a href="#h0-0-547" id="h0-0-547" class="i">+                        }
</a><a href="#h0-0-548" id="h0-0-548" class="i">+                    }).observe(messageContainer)
</a><a href="#h0-0-549" id="h0-0-549" class="i">+                }
</a> 
<a href="#h0-0-551" id="h0-0-551" class="d">-                        let fetched = false
</a><a href="#h0-0-552" id="h0-0-552" class="d">-
</a><a href="#h0-0-553" id="h0-0-553" class="d">-                        new IntersectionObserver(entries =&gt; {
</a><a href="#h0-0-554" id="h0-0-554" class="d">-                            if(!fetched &amp;&amp; entries[0].isIntersecting === true) {
</a><a href="#h0-0-555" id="h0-0-555" class="d">-                                fetched = true
</a><a href="#h0-0-556" id="h0-0-556" class="d">-                                messageContainer.innerHTML = &quot;&quot;
</a><a href="#h0-0-557" id="h0-0-557" class="d">-                                observers.forEach(c =&gt; {
</a><a href="#h0-0-558" id="h0-0-558" class="d">-                                    try {
</a><a href="#h0-0-559" id="h0-0-559" class="d">-                                        c()
</a><a href="#h0-0-560" id="h0-0-560" class="d">-                                    } catch (e) {
</a><a href="#h0-0-561" id="h0-0-561" class="d">-                                        console.log(e)
</a><a href="#h0-0-562" id="h0-0-562" class="d">-                                    }
</a><a href="#h0-0-563" id="h0-0-563" class="d">-                                })
</a><a href="#h0-0-564" id="h0-0-564" class="d">-                            }
</a><a href="#h0-0-565" id="h0-0-565" class="d">-                        }).observe(messageContainer)
</a><a href="#h0-0-566" id="h0-0-566" class="d">-                    }
</a><a href="#h0-0-567" id="h0-0-567" class="d">-
</a><a href="#h0-0-568" id="h0-0-568" class="d">-                    return messageContainer
</a><a href="#h0-0-569" id="h0-0-569" class="d">-                })(document.createElement(&quot;div&quot;)))
</a><a href="#h0-0-570" id="h0-0-570" class="i">+                return messageContainer
</a><a href="#h0-0-571" id="h0-0-571" class="i">+            })(document.createElement(&quot;div&quot;)))
</a> 
<a href="#h0-0-573" id="h0-0-573" class="d">-                document.querySelector(&#39;.conversation_message_container&#39;).appendChild(messageObject)
</a><a href="#h0-0-574" id="h0-0-574" class="d">-            })
</a><a href="#h0-0-575" id="h0-0-575" class="d">-        }
</a><a href="#h0-0-576" id="h0-0-576" class="i">+            document.querySelector(&#39;main&#39;).appendChild(messageObject)
</a><a href="#h0-0-577" id="h0-0-577" class="i">+        })
</a><a href="#h0-0-578" id="h0-0-578" class="i">+    }
</a> 
<a href="#h0-0-580" id="h0-0-580" class="d">-        makeConversationSummary()
</a><a href="#h0-0-581" id="h0-0-581" class="d">-        makeConversationMessageContainer()
</a><a href="#h0-0-582" id="h0-0-582" class="d">-    &lt;/script&gt;
</a><a href="#h0-0-583" id="h0-0-583" class="d">-&lt;/body&gt;
</a><a href="#h0-0-584" id="h0-0-584" class="i">+    makeHeader()
</a><a href="#h0-0-585" id="h0-0-585" class="i">+    makeMain()
</a><a href="#h0-0-586" id="h0-0-586" class="i">+&lt;/script&gt;
</a><a href="#h0-0-587" id="h0-0-587" class="i">+&lt;/body&gt;</a><a href="#h0-0-588" id="h0-0-588" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h1" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessageExporter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessageExporter.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessageExporter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessageExporter.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -2,6 +2,7 @@ package me.rhunk.snapenhance.core.messaging
</a> 
 import android.os.Environment
 import android.util.Base64InputStream
<a href="#h1-0-3" id="h1-0-3" class="i">+import android.util.Base64OutputStream
</a> import com.google.gson.JsonArray
 import com.google.gson.JsonNull
 import com.google.gson.JsonObject
<a href="#h1-1" id="h1-1" class="h">@@ -21,11 +22,7 @@ import me.rhunk.snapenhance.core.features.impl.downloader.decoder.AttachmentType
</a> import me.rhunk.snapenhance.core.features.impl.downloader.decoder.MessageDecoder
 import me.rhunk.snapenhance.core.wrapper.impl.Message
 import me.rhunk.snapenhance.core.wrapper.impl.SnapUUID
<a href="#h1-1-3" id="h1-1-3" class="d">-import java.io.BufferedInputStream
</a><a href="#h1-1-4" id="h1-1-4" class="d">-import java.io.File
</a><a href="#h1-1-5" id="h1-1-5" class="d">-import java.io.FileOutputStream
</a><a href="#h1-1-6" id="h1-1-6" class="d">-import java.io.InputStream
</a><a href="#h1-1-7" id="h1-1-7" class="d">-import java.io.OutputStream
</a><a href="#h1-1-8" id="h1-1-8" class="i">+import java.io.*
</a> import java.text.SimpleDateFormat
 import java.util.Collections
 import java.util.Date
<a href="#h1-2" id="h1-2" class="h">@@ -34,6 +31,7 @@ import java.util.concurrent.Executors
</a> import java.util.concurrent.TimeUnit
 import java.util.zip.Deflater
 import java.util.zip.DeflaterInputStream
<a href="#h1-2-3" id="h1-2-3" class="i">+import java.util.zip.DeflaterOutputStream
</a> import java.util.zip.ZipFile
 import kotlin.io.encoding.Base64
 import kotlin.io.encoding.ExperimentalEncodingApi
<a href="#h1-3" id="h1-3" class="h">@@ -172,17 +170,15 @@ class MessageExporter(
</a> 
             mediaFiles.forEach { (key, filePair) -&gt;
                 output.write(&quot;&lt;div class=\&quot;media-$key\&quot;&gt;&lt;!-- &quot;.toByteArray())
<a href="#h1-3-3" id="h1-3-3" class="d">-
</a><a href="#h1-3-4" id="h1-3-4" class="d">-                val deflateInputStream = DeflaterInputStream(filePair.second.inputStream(), Deflater(Deflater.BEST_COMPRESSION, true))
</a><a href="#h1-3-5" id="h1-3-5" class="d">-                val base64InputStream = XposedHelpers.newInstance(
</a><a href="#h1-3-6" id="h1-3-6" class="d">-                    Base64InputStream::class.java,
</a><a href="#h1-3-7" id="h1-3-7" class="d">-                    deflateInputStream,
</a><a href="#h1-3-8" id="h1-3-8" class="d">-                    android.util.Base64.DEFAULT or android.util.Base64.NO_WRAP,
</a><a href="#h1-3-9" id="h1-3-9" class="d">-                    true
</a><a href="#h1-3-10" id="h1-3-10" class="d">-                ) as InputStream
</a><a href="#h1-3-11" id="h1-3-11" class="d">-                base64InputStream.copyTo(output)
</a><a href="#h1-3-12" id="h1-3-12" class="d">-                deflateInputStream.close()
</a><a href="#h1-3-13" id="h1-3-13" class="d">-
</a><a href="#h1-3-14" id="h1-3-14" class="i">+                filePair.second.inputStream().use { inputStream -&gt;
</a><a href="#h1-3-15" id="h1-3-15" class="i">+                    val deflateInputStream = DeflaterInputStream(inputStream, Deflater(Deflater.BEST_COMPRESSION, true))
</a><a href="#h1-3-16" id="h1-3-16" class="i">+                    (XposedHelpers.newInstance(
</a><a href="#h1-3-17" id="h1-3-17" class="i">+                        Base64InputStream::class.java,
</a><a href="#h1-3-18" id="h1-3-18" class="i">+                        deflateInputStream,
</a><a href="#h1-3-19" id="h1-3-19" class="i">+                        android.util.Base64.DEFAULT or android.util.Base64.NO_WRAP,
</a><a href="#h1-3-20" id="h1-3-20" class="i">+                        true
</a><a href="#h1-3-21" id="h1-3-21" class="i">+                    ) as InputStream).copyTo(output)
</a><a href="#h1-3-22" id="h1-3-22" class="i">+                }
</a>                 output.write(&quot; --&gt;&lt;/div&gt;\n&quot;.toByteArray())
                 output.flush()
                 updateProgress(&quot;wrote&quot;)
<a href="#h1-4" id="h1-4" class="h">@@ -191,7 +187,17 @@ class MessageExporter(
</a> 
             //write the json file
             output.write(&quot;&lt;script type=\&quot;application/json\&quot; class=\&quot;exported_content\&quot;&gt;&quot;.toByteArray())
<a href="#h1-4-3" id="h1-4-3" class="d">-            exportJson(output)
</a><a href="#h1-4-4" id="h1-4-4" class="i">+
</a><a href="#h1-4-5" id="h1-4-5" class="i">+            val deflateOutputStream = DeflaterOutputStream((XposedHelpers.newInstance(
</a><a href="#h1-4-6" id="h1-4-6" class="i">+                    Base64OutputStream::class.java,
</a><a href="#h1-4-7" id="h1-4-7" class="i">+                    output,
</a><a href="#h1-4-8" id="h1-4-8" class="i">+                    android.util.Base64.DEFAULT or android.util.Base64.NO_WRAP,
</a><a href="#h1-4-9" id="h1-4-9" class="i">+                    true
</a><a href="#h1-4-10" id="h1-4-10" class="i">+                ) as OutputStream), Deflater(Deflater.BEST_COMPRESSION, true))
</a><a href="#h1-4-11" id="h1-4-11" class="i">+
</a><a href="#h1-4-12" id="h1-4-12" class="i">+            exportJson(deflateOutputStream)
</a><a href="#h1-4-13" id="h1-4-13" class="i">+            deflateOutputStream.finish()
</a><a href="#h1-4-14" id="h1-4-14" class="i">+
</a>             output.write(&quot;&lt;/script&gt;\n&quot;.toByteArray())
 
             printLog(&quot;writing template...&quot;)
</pre>
</div>
</body>
</html>
