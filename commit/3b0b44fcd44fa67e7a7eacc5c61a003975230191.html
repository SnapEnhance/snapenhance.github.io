<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: bulk messaging actions - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/3b0b44fcd44fa67e7a7eacc5c61a003975230191.html">3b0b44fcd44fa67e7a7eacc5c61a003975230191</a>
<b>parent</b> <a href="../commit/9c5a590a6088aab4d9a623c732b47757c638a684.html">9c5a590a6088aab4d9a623c732b47757c638a684</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Mon, 27 Nov 2023 19:26:39 +0100

feat: bulk messaging actions

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">common/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">17</td><td><span class="i">++++++++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">common/src/main/kotlin/me/rhunk/snapenhance/common/action/EnumAction.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkMessagingAction.kt</a></td><td> | </td><td class="num">167</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h3">core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkRemoveFriends.kt</a></td><td> | </td><td class="num">120</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/messaging/Messaging.kt</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumBulkAction.kt</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">core/src/main/kotlin/me/rhunk/snapenhance/core/wrapper/impl/ConversationManager.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>8 files changed, 230 insertions(+), 130 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/common/src/main/assets/lang/en_US.json.html">common/src/main/assets/lang/en_US.json</a> b/<a href="../file/common/src/main/assets/lang/en_US.json.html">common/src/main/assets/lang/en_US.json</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -116,7 +116,7 @@
</a>         &quot;open_map&quot;: &quot;Choose location on map&quot;,
         &quot;check_for_updates&quot;: &quot;Check for updates&quot;,
         &quot;export_chat_messages&quot;: &quot;Export Chat Messages&quot;,
<a href="#h0-0-3" id="h0-0-3" class="d">-        &quot;bulk_remove_friends&quot;: &quot;Bulk Remove Friends&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="i">+        &quot;bulk_messaging_action&quot;: &quot;Bulk Messaging Action&quot;
</a>     },
 
     &quot;features&quot;: {
<a href="#h0-1" id="h0-1" class="h">@@ -865,14 +865,17 @@
</a>         &quot;incoming_follower&quot;: &quot;Incoming Follower&quot;
     },
 
<a href="#h0-1-3" id="h0-1-3" class="d">-    &quot;bulk_remove_friends&quot;: {
</a><a href="#h0-1-4" id="h0-1-4" class="d">-        &quot;title&quot;: &quot;Bulk Remove Friend&quot;,
</a><a href="#h0-1-5" id="h0-1-5" class="d">-        &quot;progress_status&quot;: &quot;Removing friends {index} of {total}&quot;,
</a><a href="#h0-1-6" id="h0-1-6" class="d">-        &quot;selection_dialog_title&quot;: &quot;Select friends to remove&quot;,
</a><a href="#h0-1-7" id="h0-1-7" class="d">-        &quot;selection_dialog_remove_button&quot;: &quot;Remove Selection&quot;,
</a><a href="#h0-1-8" id="h0-1-8" class="i">+    &quot;bulk_messaging_action&quot;: {
</a><a href="#h0-1-9" id="h0-1-9" class="i">+        &quot;choose_action_title&quot;: &quot;Choose an action&quot;,
</a><a href="#h0-1-10" id="h0-1-10" class="i">+        &quot;progress_status&quot;: &quot;Processing {index} of {total}&quot;,
</a><a href="#h0-1-11" id="h0-1-11" class="i">+        &quot;selection_dialog_continue_button&quot;: &quot;Continue&quot;,
</a>         &quot;confirmation_dialog&quot;: {
             &quot;title&quot;: &quot;Are you sure?&quot;,
<a href="#h0-1-14" id="h0-1-14" class="d">-            &quot;message&quot;: &quot;This will remove all selected friends. This action cannot be undone.&quot;
</a><a href="#h0-1-15" id="h0-1-15" class="i">+            &quot;message&quot;: &quot;This will affect all selected friends. This action cannot be undone.&quot;
</a><a href="#h0-1-16" id="h0-1-16" class="i">+        },
</a><a href="#h0-1-17" id="h0-1-17" class="i">+        &quot;actions&quot;: {
</a><a href="#h0-1-18" id="h0-1-18" class="i">+            &quot;remove_friends&quot;: &quot;Remove Friends&quot;,
</a><a href="#h0-1-19" id="h0-1-19" class="i">+            &quot;clear_conversations&quot;: &quot;Clear Conversations&quot;
</a>         }
     },
 
<b>diff --git a/<a id="h1" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/action/EnumAction.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/action/EnumAction.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/action/EnumAction.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/action/EnumAction.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -9,7 +9,7 @@ enum class EnumAction(
</a> ) {
     CLEAN_CACHE(&quot;clean_snapchat_cache&quot;, exitOnFinish = true),
     EXPORT_CHAT_MESSAGES(&quot;export_chat_messages&quot;),
<a href="#h1-0-3" id="h1-0-3" class="d">-    BULK_REMOVE_FRIENDS(&quot;bulk_remove_friends&quot;);
</a><a href="#h1-0-4" id="h1-0-4" class="i">+    BULK_MESSAGING_ACTION(&quot;bulk_messaging_action&quot;);
</a> 
     companion object {
         const val ACTION_PARAMETER = &quot;se_action&quot;
<b>diff --git a/<a id="h2" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkMessagingAction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkMessagingAction.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkMessagingAction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkMessagingAction.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,166 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+package me.rhunk.snapenhance.core.action.impl
</a><a href="#h2-0-1" id="h2-0-1" class="i">+
</a><a href="#h2-0-2" id="h2-0-2" class="i">+import android.widget.ProgressBar
</a><a href="#h2-0-3" id="h2-0-3" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h2-0-4" id="h2-0-4" class="i">+import kotlinx.coroutines.delay
</a><a href="#h2-0-5" id="h2-0-5" class="i">+import kotlinx.coroutines.launch
</a><a href="#h2-0-6" id="h2-0-6" class="i">+import kotlinx.coroutines.suspendCancellableCoroutine
</a><a href="#h2-0-7" id="h2-0-7" class="i">+import kotlinx.coroutines.withContext
</a><a href="#h2-0-8" id="h2-0-8" class="i">+import me.rhunk.snapenhance.common.data.FriendLinkType
</a><a href="#h2-0-9" id="h2-0-9" class="i">+import me.rhunk.snapenhance.core.action.AbstractAction
</a><a href="#h2-0-10" id="h2-0-10" class="i">+import me.rhunk.snapenhance.core.features.impl.experiments.AddFriendSourceSpoof
</a><a href="#h2-0-11" id="h2-0-11" class="i">+import me.rhunk.snapenhance.core.features.impl.messaging.Messaging
</a><a href="#h2-0-12" id="h2-0-12" class="i">+import me.rhunk.snapenhance.core.messaging.EnumBulkAction
</a><a href="#h2-0-13" id="h2-0-13" class="i">+import me.rhunk.snapenhance.core.ui.ViewAppearanceHelper
</a><a href="#h2-0-14" id="h2-0-14" class="i">+
</a><a href="#h2-0-15" id="h2-0-15" class="i">+class BulkMessagingAction : AbstractAction() {
</a><a href="#h2-0-16" id="h2-0-16" class="i">+    private val translation by lazy { context.translation.getCategory(&quot;bulk_messaging_action&quot;) }
</a><a href="#h2-0-17" id="h2-0-17" class="i">+
</a><a href="#h2-0-18" id="h2-0-18" class="i">+    private fun removeAction(ids: List&lt;String&gt;, action: (String) -&gt; Unit = {}) {
</a><a href="#h2-0-19" id="h2-0-19" class="i">+        var index = 0
</a><a href="#h2-0-20" id="h2-0-20" class="i">+        val dialog = ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h2-0-21" id="h2-0-21" class="i">+            .setTitle(&quot;...&quot;)
</a><a href="#h2-0-22" id="h2-0-22" class="i">+            .setView(ProgressBar(context.mainActivity))
</a><a href="#h2-0-23" id="h2-0-23" class="i">+            .setCancelable(false)
</a><a href="#h2-0-24" id="h2-0-24" class="i">+            .show()
</a><a href="#h2-0-25" id="h2-0-25" class="i">+
</a><a href="#h2-0-26" id="h2-0-26" class="i">+        context.coroutineScope.launch {
</a><a href="#h2-0-27" id="h2-0-27" class="i">+            ids.forEach { id -&gt;
</a><a href="#h2-0-28" id="h2-0-28" class="i">+                runCatching {
</a><a href="#h2-0-29" id="h2-0-29" class="i">+                    action(id)
</a><a href="#h2-0-30" id="h2-0-30" class="i">+                }.onFailure {
</a><a href="#h2-0-31" id="h2-0-31" class="i">+                    context.log.error(&quot;Failed to process $it&quot;, it)
</a><a href="#h2-0-32" id="h2-0-32" class="i">+                    context.shortToast(&quot;Failed to process $id&quot;)
</a><a href="#h2-0-33" id="h2-0-33" class="i">+                }
</a><a href="#h2-0-34" id="h2-0-34" class="i">+                index++
</a><a href="#h2-0-35" id="h2-0-35" class="i">+                withContext(Dispatchers.Main) {
</a><a href="#h2-0-36" id="h2-0-36" class="i">+                    dialog.setTitle(
</a><a href="#h2-0-37" id="h2-0-37" class="i">+                        translation.format(&quot;progress_status&quot;, &quot;index&quot; to index.toString(), &quot;total&quot; to ids.size.toString())
</a><a href="#h2-0-38" id="h2-0-38" class="i">+                    )
</a><a href="#h2-0-39" id="h2-0-39" class="i">+                }
</a><a href="#h2-0-40" id="h2-0-40" class="i">+                delay(500)
</a><a href="#h2-0-41" id="h2-0-41" class="i">+            }
</a><a href="#h2-0-42" id="h2-0-42" class="i">+            withContext(Dispatchers.Main) {
</a><a href="#h2-0-43" id="h2-0-43" class="i">+                dialog.dismiss()
</a><a href="#h2-0-44" id="h2-0-44" class="i">+            }
</a><a href="#h2-0-45" id="h2-0-45" class="i">+        }
</a><a href="#h2-0-46" id="h2-0-46" class="i">+    }
</a><a href="#h2-0-47" id="h2-0-47" class="i">+
</a><a href="#h2-0-48" id="h2-0-48" class="i">+    private suspend fun askActionType() = suspendCancellableCoroutine { cont -&gt;
</a><a href="#h2-0-49" id="h2-0-49" class="i">+        context.runOnUiThread {
</a><a href="#h2-0-50" id="h2-0-50" class="i">+            ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h2-0-51" id="h2-0-51" class="i">+                .setTitle(translation[&quot;choose_action_title&quot;])
</a><a href="#h2-0-52" id="h2-0-52" class="i">+                .setItems(EnumBulkAction.entries.map { translation[&quot;actions.${it.key}&quot;] }.toTypedArray()) { _, which -&gt;
</a><a href="#h2-0-53" id="h2-0-53" class="i">+                    cont.resumeWith(Result.success(EnumBulkAction.entries[which]))
</a><a href="#h2-0-54" id="h2-0-54" class="i">+                }
</a><a href="#h2-0-55" id="h2-0-55" class="i">+                .setOnCancelListener {
</a><a href="#h2-0-56" id="h2-0-56" class="i">+                    cont.resumeWith(Result.success(null))
</a><a href="#h2-0-57" id="h2-0-57" class="i">+                }
</a><a href="#h2-0-58" id="h2-0-58" class="i">+                .show()
</a><a href="#h2-0-59" id="h2-0-59" class="i">+        }
</a><a href="#h2-0-60" id="h2-0-60" class="i">+    }
</a><a href="#h2-0-61" id="h2-0-61" class="i">+
</a><a href="#h2-0-62" id="h2-0-62" class="i">+    private fun confirmationDialog(onConfirm: () -&gt; Unit) {
</a><a href="#h2-0-63" id="h2-0-63" class="i">+        ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h2-0-64" id="h2-0-64" class="i">+            .setTitle(translation[&quot;confirmation_dialog.title&quot;])
</a><a href="#h2-0-65" id="h2-0-65" class="i">+            .setMessage(translation[&quot;confirmation_dialog.message&quot;])
</a><a href="#h2-0-66" id="h2-0-66" class="i">+            .setPositiveButton(context.translation[&quot;button.positive&quot;]) { _, _ -&gt;
</a><a href="#h2-0-67" id="h2-0-67" class="i">+                onConfirm()
</a><a href="#h2-0-68" id="h2-0-68" class="i">+            }
</a><a href="#h2-0-69" id="h2-0-69" class="i">+            .setNegativeButton(context.translation[&quot;button.negative&quot;]) { _, _ -&gt; }
</a><a href="#h2-0-70" id="h2-0-70" class="i">+            .show()
</a><a href="#h2-0-71" id="h2-0-71" class="i">+    }
</a><a href="#h2-0-72" id="h2-0-72" class="i">+
</a><a href="#h2-0-73" id="h2-0-73" class="i">+    override fun run() {
</a><a href="#h2-0-74" id="h2-0-74" class="i">+        val userIdBlacklist = arrayOf(
</a><a href="#h2-0-75" id="h2-0-75" class="i">+            context.database.myUserId,
</a><a href="#h2-0-76" id="h2-0-76" class="i">+            &quot;b42f1f70-5a8b-4c53-8c25-34e7ec9e6781&quot;, // myai
</a><a href="#h2-0-77" id="h2-0-77" class="i">+            &quot;84ee8839-3911-492d-8b94-72dd80f3713a&quot;, // teamsnapchat
</a><a href="#h2-0-78" id="h2-0-78" class="i">+        )
</a><a href="#h2-0-79" id="h2-0-79" class="i">+
</a><a href="#h2-0-80" id="h2-0-80" class="i">+        context.coroutineScope.launch(Dispatchers.Main) {
</a><a href="#h2-0-81" id="h2-0-81" class="i">+            val bulkAction = askActionType() ?: return@launch
</a><a href="#h2-0-82" id="h2-0-82" class="i">+
</a><a href="#h2-0-83" id="h2-0-83" class="i">+            val friends = context.database.getAllFriends().filter {
</a><a href="#h2-0-84" id="h2-0-84" class="i">+                it.userId !in userIdBlacklist &amp;&amp;
</a><a href="#h2-0-85" id="h2-0-85" class="i">+                it.addedTimestamp != -1L &amp;&amp;
</a><a href="#h2-0-86" id="h2-0-86" class="i">+                it.friendLinkType == FriendLinkType.MUTUAL.value ||
</a><a href="#h2-0-87" id="h2-0-87" class="i">+                it.friendLinkType == FriendLinkType.OUTGOING.value
</a><a href="#h2-0-88" id="h2-0-88" class="i">+            }.sortedByDescending {
</a><a href="#h2-0-89" id="h2-0-89" class="i">+                it.friendLinkType == FriendLinkType.OUTGOING.value
</a><a href="#h2-0-90" id="h2-0-90" class="i">+            }
</a><a href="#h2-0-91" id="h2-0-91" class="i">+
</a><a href="#h2-0-92" id="h2-0-92" class="i">+            val selectedFriends = mutableListOf&lt;String&gt;()
</a><a href="#h2-0-93" id="h2-0-93" class="i">+
</a><a href="#h2-0-94" id="h2-0-94" class="i">+            ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h2-0-95" id="h2-0-95" class="i">+                .setTitle(translation[&quot;actions.${bulkAction.key}&quot;])
</a><a href="#h2-0-96" id="h2-0-96" class="i">+                .setMultiChoiceItems(friends.map { friend -&gt;
</a><a href="#h2-0-97" id="h2-0-97" class="i">+                    (friend.displayName?.let {
</a><a href="#h2-0-98" id="h2-0-98" class="i">+                        &quot;$it (${friend.mutableUsername})&quot;
</a><a href="#h2-0-99" id="h2-0-99" class="i">+                    } ?: friend.mutableUsername) +
</a><a href="#h2-0-100" id="h2-0-100" class="i">+                    &quot;: ${context.translation[&quot;friendship_link_type.${FriendLinkType.fromValue(friend.friendLinkType).shortName}&quot;]}&quot;
</a><a href="#h2-0-101" id="h2-0-101" class="i">+                }.toTypedArray(), null) { _, which, isChecked -&gt;
</a><a href="#h2-0-102" id="h2-0-102" class="i">+                    if (isChecked) {
</a><a href="#h2-0-103" id="h2-0-103" class="i">+                        selectedFriends.add(friends[which].userId!!)
</a><a href="#h2-0-104" id="h2-0-104" class="i">+                    } else {
</a><a href="#h2-0-105" id="h2-0-105" class="i">+                        selectedFriends.remove(friends[which].userId)
</a><a href="#h2-0-106" id="h2-0-106" class="i">+                    }
</a><a href="#h2-0-107" id="h2-0-107" class="i">+                }
</a><a href="#h2-0-108" id="h2-0-108" class="i">+                .setPositiveButton(translation[&quot;selection_dialog_continue_button&quot;]) { _, _ -&gt;
</a><a href="#h2-0-109" id="h2-0-109" class="i">+                    confirmationDialog {
</a><a href="#h2-0-110" id="h2-0-110" class="i">+                        when (bulkAction) {
</a><a href="#h2-0-111" id="h2-0-111" class="i">+                            EnumBulkAction.REMOVE_FRIENDS -&gt; {
</a><a href="#h2-0-112" id="h2-0-112" class="i">+                                removeAction(selectedFriends) {
</a><a href="#h2-0-113" id="h2-0-113" class="i">+                                    removeFriend(it)
</a><a href="#h2-0-114" id="h2-0-114" class="i">+                                }
</a><a href="#h2-0-115" id="h2-0-115" class="i">+                            }
</a><a href="#h2-0-116" id="h2-0-116" class="i">+                            EnumBulkAction.CLEAR_CONVERSATIONS -&gt; clearConversations(selectedFriends)
</a><a href="#h2-0-117" id="h2-0-117" class="i">+                        }
</a><a href="#h2-0-118" id="h2-0-118" class="i">+                    }
</a><a href="#h2-0-119" id="h2-0-119" class="i">+                }
</a><a href="#h2-0-120" id="h2-0-120" class="i">+                .setNegativeButton(context.translation[&quot;button.cancel&quot;]) { dialog, _ -&gt;
</a><a href="#h2-0-121" id="h2-0-121" class="i">+                    dialog.dismiss()
</a><a href="#h2-0-122" id="h2-0-122" class="i">+                }
</a><a href="#h2-0-123" id="h2-0-123" class="i">+                .setCancelable(false)
</a><a href="#h2-0-124" id="h2-0-124" class="i">+                .show()
</a><a href="#h2-0-125" id="h2-0-125" class="i">+        }
</a><a href="#h2-0-126" id="h2-0-126" class="i">+    }
</a><a href="#h2-0-127" id="h2-0-127" class="i">+
</a><a href="#h2-0-128" id="h2-0-128" class="i">+    private fun clearConversations(friendIds: List&lt;String&gt;) {
</a><a href="#h2-0-129" id="h2-0-129" class="i">+        val messaging = context.feature(Messaging::class)
</a><a href="#h2-0-130" id="h2-0-130" class="i">+
</a><a href="#h2-0-131" id="h2-0-131" class="i">+        messaging.conversationManager?.apply {
</a><a href="#h2-0-132" id="h2-0-132" class="i">+            getOneOnOneConversationIds(friendIds, onError = { error -&gt;
</a><a href="#h2-0-133" id="h2-0-133" class="i">+                context.shortToast(&quot;Failed to fetch conversations: $error&quot;)
</a><a href="#h2-0-134" id="h2-0-134" class="i">+            }, onSuccess = { conversations -&gt;
</a><a href="#h2-0-135" id="h2-0-135" class="i">+                context.runOnUiThread {
</a><a href="#h2-0-136" id="h2-0-136" class="i">+                    removeAction(conversations.map { it.second }.distinct()) {
</a><a href="#h2-0-137" id="h2-0-137" class="i">+                        messaging.clearConversationFromFeed(it, onError = { error -&gt;
</a><a href="#h2-0-138" id="h2-0-138" class="i">+                            context.shortToast(&quot;Failed to clear conversation: $error&quot;)
</a><a href="#h2-0-139" id="h2-0-139" class="i">+                        })
</a><a href="#h2-0-140" id="h2-0-140" class="i">+                    }
</a><a href="#h2-0-141" id="h2-0-141" class="i">+                }
</a><a href="#h2-0-142" id="h2-0-142" class="i">+            })
</a><a href="#h2-0-143" id="h2-0-143" class="i">+        }
</a><a href="#h2-0-144" id="h2-0-144" class="i">+    }
</a><a href="#h2-0-145" id="h2-0-145" class="i">+
</a><a href="#h2-0-146" id="h2-0-146" class="i">+    private fun removeFriend(userId: String) {
</a><a href="#h2-0-147" id="h2-0-147" class="i">+        val friendRelationshipChangerMapping = context.mappings.getMappedMap(&quot;FriendRelationshipChanger&quot;)
</a><a href="#h2-0-148" id="h2-0-148" class="i">+        val friendRelationshipChangerInstance = context.feature(AddFriendSourceSpoof::class).friendRelationshipChangerInstance!!
</a><a href="#h2-0-149" id="h2-0-149" class="i">+
</a><a href="#h2-0-150" id="h2-0-150" class="i">+        val removeFriendMethod = friendRelationshipChangerInstance::class.java.methods.first {
</a><a href="#h2-0-151" id="h2-0-151" class="i">+            it.name == friendRelationshipChangerMapping[&quot;removeFriendMethod&quot;].toString()
</a><a href="#h2-0-152" id="h2-0-152" class="i">+        }
</a><a href="#h2-0-153" id="h2-0-153" class="i">+
</a><a href="#h2-0-154" id="h2-0-154" class="i">+        val completable = removeFriendMethod.invoke(friendRelationshipChangerInstance,
</a><a href="#h2-0-155" id="h2-0-155" class="i">+            userId, // userId
</a><a href="#h2-0-156" id="h2-0-156" class="i">+            removeFriendMethod.parameterTypes[1].enumConstants.first { it.toString() == &quot;DELETED_BY_MY_FRIENDS&quot; }, // source
</a><a href="#h2-0-157" id="h2-0-157" class="i">+            null, // unknown
</a><a href="#h2-0-158" id="h2-0-158" class="i">+            null, // unknown
</a><a href="#h2-0-159" id="h2-0-159" class="i">+            null // InteractionPlacementInfo
</a><a href="#h2-0-160" id="h2-0-160" class="i">+        )!!
</a><a href="#h2-0-161" id="h2-0-161" class="i">+        completable::class.java.methods.first {
</a><a href="#h2-0-162" id="h2-0-162" class="i">+            it.name == &quot;subscribe&quot; &amp;&amp; it.parameterTypes.isEmpty()
</a><a href="#h2-0-163" id="h2-0-163" class="i">+        }.invoke(completable)
</a><a href="#h2-0-164" id="h2-0-164" class="i">+    }
</a><a href="#h2-0-165" id="h2-0-165" class="i">+}</a><a href="#h2-0-166" id="h2-0-166" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkRemoveFriends.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkRemoveFriends.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkRemoveFriends.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/action/impl/BulkRemoveFriends.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,119 +0,0 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-package me.rhunk.snapenhance.core.action.impl
</a><a href="#h3-0-1" id="h3-0-1" class="d">-
</a><a href="#h3-0-2" id="h3-0-2" class="d">-import android.widget.ProgressBar
</a><a href="#h3-0-3" id="h3-0-3" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h3-0-4" id="h3-0-4" class="d">-import kotlinx.coroutines.delay
</a><a href="#h3-0-5" id="h3-0-5" class="d">-import kotlinx.coroutines.launch
</a><a href="#h3-0-6" id="h3-0-6" class="d">-import kotlinx.coroutines.withContext
</a><a href="#h3-0-7" id="h3-0-7" class="d">-import me.rhunk.snapenhance.common.data.FriendLinkType
</a><a href="#h3-0-8" id="h3-0-8" class="d">-import me.rhunk.snapenhance.core.action.AbstractAction
</a><a href="#h3-0-9" id="h3-0-9" class="d">-import me.rhunk.snapenhance.core.features.impl.experiments.AddFriendSourceSpoof
</a><a href="#h3-0-10" id="h3-0-10" class="d">-import me.rhunk.snapenhance.core.ui.ViewAppearanceHelper
</a><a href="#h3-0-11" id="h3-0-11" class="d">-
</a><a href="#h3-0-12" id="h3-0-12" class="d">-class BulkRemoveFriends : AbstractAction() {
</a><a href="#h3-0-13" id="h3-0-13" class="d">-    private val translation by lazy { context.translation.getCategory(&quot;bulk_remove_friends&quot;) }
</a><a href="#h3-0-14" id="h3-0-14" class="d">-
</a><a href="#h3-0-15" id="h3-0-15" class="d">-    private fun removeFriends(friendIds: List&lt;String&gt;) {
</a><a href="#h3-0-16" id="h3-0-16" class="d">-        var index = 0
</a><a href="#h3-0-17" id="h3-0-17" class="d">-        val dialog = ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h3-0-18" id="h3-0-18" class="d">-            .setTitle(&quot;...&quot;)
</a><a href="#h3-0-19" id="h3-0-19" class="d">-            .setView(ProgressBar(context.mainActivity))
</a><a href="#h3-0-20" id="h3-0-20" class="d">-            .setCancelable(false)
</a><a href="#h3-0-21" id="h3-0-21" class="d">-            .show()
</a><a href="#h3-0-22" id="h3-0-22" class="d">-
</a><a href="#h3-0-23" id="h3-0-23" class="d">-        context.coroutineScope.launch {
</a><a href="#h3-0-24" id="h3-0-24" class="d">-            friendIds.forEach { userId -&gt;
</a><a href="#h3-0-25" id="h3-0-25" class="d">-                runCatching {
</a><a href="#h3-0-26" id="h3-0-26" class="d">-                    removeFriend(userId)
</a><a href="#h3-0-27" id="h3-0-27" class="d">-                }.onFailure {
</a><a href="#h3-0-28" id="h3-0-28" class="d">-                    context.log.error(&quot;Failed to remove friend $it&quot;, it)
</a><a href="#h3-0-29" id="h3-0-29" class="d">-                    context.shortToast(&quot;Failed to remove friend $userId&quot;)
</a><a href="#h3-0-30" id="h3-0-30" class="d">-                }
</a><a href="#h3-0-31" id="h3-0-31" class="d">-                index++
</a><a href="#h3-0-32" id="h3-0-32" class="d">-                withContext(Dispatchers.Main) {
</a><a href="#h3-0-33" id="h3-0-33" class="d">-                    dialog.setTitle(
</a><a href="#h3-0-34" id="h3-0-34" class="d">-                        translation.format(&quot;progress_status&quot;, &quot;index&quot; to index.toString(), &quot;total&quot; to friendIds.size.toString())
</a><a href="#h3-0-35" id="h3-0-35" class="d">-                    )
</a><a href="#h3-0-36" id="h3-0-36" class="d">-                }
</a><a href="#h3-0-37" id="h3-0-37" class="d">-                delay(500)
</a><a href="#h3-0-38" id="h3-0-38" class="d">-            }
</a><a href="#h3-0-39" id="h3-0-39" class="d">-            withContext(Dispatchers.Main) {
</a><a href="#h3-0-40" id="h3-0-40" class="d">-                dialog.dismiss()
</a><a href="#h3-0-41" id="h3-0-41" class="d">-            }
</a><a href="#h3-0-42" id="h3-0-42" class="d">-        }
</a><a href="#h3-0-43" id="h3-0-43" class="d">-    }
</a><a href="#h3-0-44" id="h3-0-44" class="d">-
</a><a href="#h3-0-45" id="h3-0-45" class="d">-    private fun confirmationDialog(onConfirm: () -&gt; Unit) {
</a><a href="#h3-0-46" id="h3-0-46" class="d">-        ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h3-0-47" id="h3-0-47" class="d">-            .setTitle(translation[&quot;confirmation_dialog.title&quot;])
</a><a href="#h3-0-48" id="h3-0-48" class="d">-            .setMessage(translation[&quot;confirmation_dialog.message&quot;])
</a><a href="#h3-0-49" id="h3-0-49" class="d">-            .setPositiveButton(context.translation[&quot;button.positive&quot;]) { _, _ -&gt;
</a><a href="#h3-0-50" id="h3-0-50" class="d">-                onConfirm()
</a><a href="#h3-0-51" id="h3-0-51" class="d">-            }
</a><a href="#h3-0-52" id="h3-0-52" class="d">-            .setNegativeButton(context.translation[&quot;button.negative&quot;]) { _, _ -&gt; }
</a><a href="#h3-0-53" id="h3-0-53" class="d">-            .show()
</a><a href="#h3-0-54" id="h3-0-54" class="d">-    }
</a><a href="#h3-0-55" id="h3-0-55" class="d">-
</a><a href="#h3-0-56" id="h3-0-56" class="d">-    override fun run() {
</a><a href="#h3-0-57" id="h3-0-57" class="d">-        val userIdBlacklist = arrayOf(
</a><a href="#h3-0-58" id="h3-0-58" class="d">-            context.database.myUserId,
</a><a href="#h3-0-59" id="h3-0-59" class="d">-            &quot;b42f1f70-5a8b-4c53-8c25-34e7ec9e6781&quot;, // myai
</a><a href="#h3-0-60" id="h3-0-60" class="d">-            &quot;84ee8839-3911-492d-8b94-72dd80f3713a&quot;, // teamsnapchat
</a><a href="#h3-0-61" id="h3-0-61" class="d">-        )
</a><a href="#h3-0-62" id="h3-0-62" class="d">-
</a><a href="#h3-0-63" id="h3-0-63" class="d">-        context.coroutineScope.launch(Dispatchers.Main) {
</a><a href="#h3-0-64" id="h3-0-64" class="d">-            val friends = context.database.getAllFriends().filter {
</a><a href="#h3-0-65" id="h3-0-65" class="d">-                it.userId !in userIdBlacklist &amp;&amp;
</a><a href="#h3-0-66" id="h3-0-66" class="d">-                it.addedTimestamp != -1L &amp;&amp;
</a><a href="#h3-0-67" id="h3-0-67" class="d">-                it.friendLinkType == FriendLinkType.MUTUAL.value ||
</a><a href="#h3-0-68" id="h3-0-68" class="d">-                it.friendLinkType == FriendLinkType.OUTGOING.value
</a><a href="#h3-0-69" id="h3-0-69" class="d">-            }.sortedByDescending {
</a><a href="#h3-0-70" id="h3-0-70" class="d">-                it.friendLinkType == FriendLinkType.OUTGOING.value
</a><a href="#h3-0-71" id="h3-0-71" class="d">-            }
</a><a href="#h3-0-72" id="h3-0-72" class="d">-
</a><a href="#h3-0-73" id="h3-0-73" class="d">-            val selectedFriends = mutableListOf&lt;String&gt;()
</a><a href="#h3-0-74" id="h3-0-74" class="d">-
</a><a href="#h3-0-75" id="h3-0-75" class="d">-            ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h3-0-76" id="h3-0-76" class="d">-                .setTitle(translation[&quot;selection_dialog_title&quot;])
</a><a href="#h3-0-77" id="h3-0-77" class="d">-                .setMultiChoiceItems(friends.map { friend -&gt;
</a><a href="#h3-0-78" id="h3-0-78" class="d">-                    (friend.displayName?.let {
</a><a href="#h3-0-79" id="h3-0-79" class="d">-                        &quot;$it (${friend.mutableUsername})&quot;
</a><a href="#h3-0-80" id="h3-0-80" class="d">-                    } ?: friend.mutableUsername) +
</a><a href="#h3-0-81" id="h3-0-81" class="d">-                    &quot;: ${context.translation[&quot;friendship_link_type.${FriendLinkType.fromValue(friend.friendLinkType).shortName}&quot;]}&quot;
</a><a href="#h3-0-82" id="h3-0-82" class="d">-                }.toTypedArray(), null) { _, which, isChecked -&gt;
</a><a href="#h3-0-83" id="h3-0-83" class="d">-                    if (isChecked) {
</a><a href="#h3-0-84" id="h3-0-84" class="d">-                        selectedFriends.add(friends[which].userId!!)
</a><a href="#h3-0-85" id="h3-0-85" class="d">-                    } else {
</a><a href="#h3-0-86" id="h3-0-86" class="d">-                        selectedFriends.remove(friends[which].userId)
</a><a href="#h3-0-87" id="h3-0-87" class="d">-                    }
</a><a href="#h3-0-88" id="h3-0-88" class="d">-                }
</a><a href="#h3-0-89" id="h3-0-89" class="d">-                .setPositiveButton(translation[&quot;selection_dialog_remove_button&quot;]) { _, _ -&gt;
</a><a href="#h3-0-90" id="h3-0-90" class="d">-                    confirmationDialog {
</a><a href="#h3-0-91" id="h3-0-91" class="d">-                        removeFriends(selectedFriends)
</a><a href="#h3-0-92" id="h3-0-92" class="d">-                    }
</a><a href="#h3-0-93" id="h3-0-93" class="d">-                }
</a><a href="#h3-0-94" id="h3-0-94" class="d">-                .setNegativeButton(context.translation[&quot;button.cancel&quot;]) { _, _ -&gt; }
</a><a href="#h3-0-95" id="h3-0-95" class="d">-                .show()
</a><a href="#h3-0-96" id="h3-0-96" class="d">-        }
</a><a href="#h3-0-97" id="h3-0-97" class="d">-    }
</a><a href="#h3-0-98" id="h3-0-98" class="d">-
</a><a href="#h3-0-99" id="h3-0-99" class="d">-    private fun removeFriend(userId: String) {
</a><a href="#h3-0-100" id="h3-0-100" class="d">-        val friendRelationshipChangerMapping = context.mappings.getMappedMap(&quot;FriendRelationshipChanger&quot;)
</a><a href="#h3-0-101" id="h3-0-101" class="d">-        val friendRelationshipChangerInstance = context.feature(AddFriendSourceSpoof::class).friendRelationshipChangerInstance!!
</a><a href="#h3-0-102" id="h3-0-102" class="d">-
</a><a href="#h3-0-103" id="h3-0-103" class="d">-        val removeFriendMethod = friendRelationshipChangerInstance::class.java.methods.first {
</a><a href="#h3-0-104" id="h3-0-104" class="d">-            it.name == friendRelationshipChangerMapping[&quot;removeFriendMethod&quot;].toString()
</a><a href="#h3-0-105" id="h3-0-105" class="d">-        }
</a><a href="#h3-0-106" id="h3-0-106" class="d">-
</a><a href="#h3-0-107" id="h3-0-107" class="d">-        val completable = removeFriendMethod.invoke(friendRelationshipChangerInstance,
</a><a href="#h3-0-108" id="h3-0-108" class="d">-            userId, // userId
</a><a href="#h3-0-109" id="h3-0-109" class="d">-            removeFriendMethod.parameterTypes[1].enumConstants.first { it.toString() == &quot;DELETED_BY_MY_FRIENDS&quot; }, // source
</a><a href="#h3-0-110" id="h3-0-110" class="d">-            null, // unknown
</a><a href="#h3-0-111" id="h3-0-111" class="d">-            null, // unknown
</a><a href="#h3-0-112" id="h3-0-112" class="d">-            null // InteractionPlacementInfo
</a><a href="#h3-0-113" id="h3-0-113" class="d">-        )!!
</a><a href="#h3-0-114" id="h3-0-114" class="d">-        completable::class.java.methods.first {
</a><a href="#h3-0-115" id="h3-0-115" class="d">-            it.name == &quot;subscribe&quot; &amp;&amp; it.parameterTypes.isEmpty()
</a><a href="#h3-0-116" id="h3-0-116" class="d">-        }.invoke(completable)
</a><a href="#h3-0-117" id="h3-0-117" class="d">-    }
</a><a href="#h3-0-118" id="h3-0-118" class="d">-}</a><a href="#h3-0-119" id="h3-0-119" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h4" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/messaging/Messaging.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/messaging/Messaging.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/messaging/Messaging.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/messaging/Messaging.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -15,10 +15,12 @@ import me.rhunk.snapenhance.core.util.ktx.getObjectFieldOrNull
</a> import me.rhunk.snapenhance.core.wrapper.impl.ConversationManager
 import me.rhunk.snapenhance.core.wrapper.impl.Message
 import me.rhunk.snapenhance.core.wrapper.impl.SnapUUID
<a href="#h4-0-3" id="h4-0-3" class="i">+import me.rhunk.snapenhance.core.wrapper.impl.toSnapUUID
</a> 
 class Messaging : Feature(&quot;Messaging&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC or FeatureLoadParams.INIT_ASYNC or FeatureLoadParams.INIT_SYNC) {
     var conversationManager: ConversationManager? = null
         private set
<a href="#h4-0-8" id="h4-0-8" class="i">+    private var conversationManagerDelegate: Any? = null
</a>     var openedConversationUUID: SnapUUID? = null
         private set
     var lastFetchConversationUserUUID: SnapUUID? = null
<a href="#h4-1" id="h4-1" class="h">@@ -43,6 +45,22 @@ class Messaging : Feature(&quot;Messaging&quot;, loadParams = FeatureLoadParams.ACTIVITY_C
</a> 
     fun getFeedCachedMessageIds(conversationId: String) = feedCachedSnapMessages[conversationId]
 
<a href="#h4-1-3" id="h4-1-3" class="i">+    fun clearConversationFromFeed(conversationId: String, onError : (String) -&gt; Unit = {}, onSuccess : () -&gt; Unit = {}) {
</a><a href="#h4-1-4" id="h4-1-4" class="i">+        conversationManager?.clearConversation(conversationId, onError = { onError(it) }, onSuccess = {
</a><a href="#h4-1-5" id="h4-1-5" class="i">+            runCatching {
</a><a href="#h4-1-6" id="h4-1-6" class="i">+                conversationManagerDelegate!!.let {
</a><a href="#h4-1-7" id="h4-1-7" class="i">+                    it::class.java.methods.first { method -&gt;
</a><a href="#h4-1-8" id="h4-1-8" class="i">+                        method.name == &quot;onConversationRemoved&quot;
</a><a href="#h4-1-9" id="h4-1-9" class="i">+                    }.invoke(conversationManagerDelegate, conversationId.toSnapUUID().instanceNonNull())
</a><a href="#h4-1-10" id="h4-1-10" class="i">+                }
</a><a href="#h4-1-11" id="h4-1-11" class="i">+                onSuccess()
</a><a href="#h4-1-12" id="h4-1-12" class="i">+            }.onFailure {
</a><a href="#h4-1-13" id="h4-1-13" class="i">+                context.log.error(&quot;Failed to invoke onConversationRemoved: $it&quot;)
</a><a href="#h4-1-14" id="h4-1-14" class="i">+                onError(it.message ?: &quot;Unknown error&quot;)
</a><a href="#h4-1-15" id="h4-1-15" class="i">+            }
</a><a href="#h4-1-16" id="h4-1-16" class="i">+        })
</a><a href="#h4-1-17" id="h4-1-17" class="i">+    }
</a><a href="#h4-1-18" id="h4-1-18" class="i">+
</a>     override fun onActivityCreate() {
         context.mappings.getMappedObjectNullable(&quot;FriendsFeedEventDispatcher&quot;).let { it as? Map&lt;*, *&gt; }?.let { mappings -&gt;
             findClass(mappings[&quot;class&quot;].toString()).hook(&quot;onItemLongPress&quot;, HookStage.BEFORE) { param -&gt;
<a href="#h4-2" id="h4-2" class="h">@@ -57,6 +75,9 @@ class Messaging : Feature(&quot;Messaging&quot;, loadParams = FeatureLoadParams.ACTIVITY_C
</a>             }
         }
 
<a href="#h4-2-3" id="h4-2-3" class="i">+        context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;ConversationManagerDelegate&quot;).hookConstructor(HookStage.AFTER) { param -&gt;
</a><a href="#h4-2-4" id="h4-2-4" class="i">+            conversationManagerDelegate = param.thisObject()
</a><a href="#h4-2-5" id="h4-2-5" class="i">+        }
</a> 
         context.classCache.feedEntry.hookConstructor(HookStage.AFTER) { param -&gt;
             val instance = param.thisObject&lt;Any&gt;()
<b>diff --git a/<a id="h5" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/manager/impl/ActionManager.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -3,7 +3,7 @@ package me.rhunk.snapenhance.core.manager.impl
</a> import android.content.Intent
 import me.rhunk.snapenhance.common.action.EnumAction
 import me.rhunk.snapenhance.core.ModContext
<a href="#h5-0-3" id="h5-0-3" class="d">-import me.rhunk.snapenhance.core.action.impl.BulkRemoveFriends
</a><a href="#h5-0-4" id="h5-0-4" class="i">+import me.rhunk.snapenhance.core.action.impl.BulkMessagingAction
</a> import me.rhunk.snapenhance.core.action.impl.CleanCache
 import me.rhunk.snapenhance.core.action.impl.ExportChatMessages
 import me.rhunk.snapenhance.core.manager.Manager
<a href="#h5-1" id="h5-1" class="h">@@ -16,7 +16,7 @@ class ActionManager(
</a>         mapOf(
             EnumAction.CLEAN_CACHE to CleanCache::class,
             EnumAction.EXPORT_CHAT_MESSAGES to ExportChatMessages::class,
<a href="#h5-1-3" id="h5-1-3" class="d">-            EnumAction.BULK_REMOVE_FRIENDS to BulkRemoveFriends::class,
</a><a href="#h5-1-4" id="h5-1-4" class="i">+            EnumAction.BULK_MESSAGING_ACTION to BulkMessagingAction::class,
</a>         ).map {
             it.key to it.value.java.getConstructor().newInstance().apply {
                 this.context = modContext
<b>diff --git a/<a id="h6" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumBulkAction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumBulkAction.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumBulkAction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumBulkAction.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,8 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+package me.rhunk.snapenhance.core.messaging
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+enum class EnumBulkAction(
</a><a href="#h6-0-3" id="h6-0-3" class="i">+    val key: String,
</a><a href="#h6-0-4" id="h6-0-4" class="i">+) {
</a><a href="#h6-0-5" id="h6-0-5" class="i">+    REMOVE_FRIENDS(&quot;remove_friends&quot;),
</a><a href="#h6-0-6" id="h6-0-6" class="i">+    CLEAR_CONVERSATIONS(&quot;clear_conversations&quot;),
</a><a href="#h6-0-7" id="h6-0-7" class="i">+}</a><a href="#h6-0-8" id="h6-0-8" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/wrapper/impl/ConversationManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/wrapper/impl/ConversationManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/wrapper/impl/ConversationManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/wrapper/impl/ConversationManager.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -22,6 +22,8 @@ class ConversationManager(
</a>     private val fetchMessagesByServerIds by lazy { findMethodByName(&quot;fetchMessagesByServerIds&quot;) }
     private val displayedMessagesMethod by lazy { findMethodByName(&quot;displayedMessages&quot;) }
     private val fetchMessage by lazy { findMethodByName(&quot;fetchMessage&quot;) }
<a href="#h7-0-3" id="h7-0-3" class="i">+    private val clearConversation by lazy { findMethodByName(&quot;clearConversation&quot;) }
</a><a href="#h7-0-4" id="h7-0-4" class="i">+    private val getOneOnOneConversationIds by lazy { findMethodByName(&quot;getOneOnOneConversationIds&quot;) }
</a> 
 
     fun updateMessage(conversationId: String, messageId: Long, action: MessageUpdate, onResult: CallbackResult = {}) {
<a href="#h7-1" id="h7-1" class="h">@@ -128,4 +130,22 @@ class ConversationManager(
</a>                 }.build()
         )
     }
<a href="#h7-1-3" id="h7-1-3" class="i">+
</a><a href="#h7-1-4" id="h7-1-4" class="i">+    fun clearConversation(conversationId: String, onSuccess: () -&gt; Unit, onError: (error: String) -&gt; Unit) {
</a><a href="#h7-1-5" id="h7-1-5" class="i">+        val callback = CallbackBuilder(context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;Callback&quot;))
</a><a href="#h7-1-6" id="h7-1-6" class="i">+            .override(&quot;onSuccess&quot;) { onSuccess() }
</a><a href="#h7-1-7" id="h7-1-7" class="i">+            .override(&quot;onError&quot;) { onError(it.arg&lt;Any&gt;(0).toString()) }.build()
</a><a href="#h7-1-8" id="h7-1-8" class="i">+        clearConversation.invoke(instanceNonNull(), conversationId.toSnapUUID().instanceNonNull(), callback)
</a><a href="#h7-1-9" id="h7-1-9" class="i">+    }
</a><a href="#h7-1-10" id="h7-1-10" class="i">+
</a><a href="#h7-1-11" id="h7-1-11" class="i">+    fun getOneOnOneConversationIds(userIds: List&lt;String&gt;, onSuccess: (List&lt;Pair&lt;String, String&gt;&gt;) -&gt; Unit, onError: (error: String) -&gt; Unit) {
</a><a href="#h7-1-12" id="h7-1-12" class="i">+        val callback = CallbackBuilder(context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;GetOneOnOneConversationIdsCallback&quot;))
</a><a href="#h7-1-13" id="h7-1-13" class="i">+            .override(&quot;onSuccess&quot;) { param -&gt;
</a><a href="#h7-1-14" id="h7-1-14" class="i">+                onSuccess(param.arg&lt;ArrayList&lt;*&gt;&gt;(0).map {
</a><a href="#h7-1-15" id="h7-1-15" class="i">+                    SnapUUID(it.getObjectField(&quot;mUserId&quot;)).toString() to SnapUUID(it.getObjectField(&quot;mConversationId&quot;)).toString()
</a><a href="#h7-1-16" id="h7-1-16" class="i">+                })
</a><a href="#h7-1-17" id="h7-1-17" class="i">+            }
</a><a href="#h7-1-18" id="h7-1-18" class="i">+            .override(&quot;onError&quot;) { onError(it.arg&lt;Any&gt;(0).toString()) }.build()
</a><a href="#h7-1-19" id="h7-1-19" class="i">+        getOneOnOneConversationIds.invoke(instanceNonNull(), userIds.map { it.toSnapUUID().instanceNonNull() }.toMutableList(), callback)
</a><a href="#h7-1-20" id="h7-1-20" class="i">+    }
</a> } 
\ No newline at end of file
</pre>
</div>
</body>
</html>
