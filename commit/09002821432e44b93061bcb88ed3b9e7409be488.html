<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat!: unsafe bridge for sdk 28 - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/09002821432e44b93061bcb88ed3b9e7409be488.html">09002821432e44b93061bcb88ed3b9e7409be488</a>
<b>parent</b> <a href="../commit/39e23564d7e5b9ce7468aa4f5605817298f4cec5.html">39e23564d7e5b9ce7468aa4f5605817298f4cec5</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Thu, 25 May 2023 23:17:32 +0200

feat!: unsafe bridge for sdk 28

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></td><td> | </td><td class="num">39</td><td><span class="i">+++++++++++++++++++++++++++++</span><span class="d">----------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt</a></td><td> | </td><td class="num">96</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/bridge/MessageLoggerWrapper.kt</a></td><td> | </td><td class="num">48</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt</a></td><td> | </td><td class="num">254</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt</a></td><td> | </td><td class="num">134</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt</a></td><td> | </td><td class="num">226</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentRequest.kt</a></td><td> | </td><td class="num">20</td><td><span class="i"></span><span class="d">--------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentResult.kt</a></td><td> | </td><td class="num">17</td><td><span class="i"></span><span class="d">-----------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessRequest.kt</a></td><td> | </td><td class="num">43</td><td><span class="i"></span><span class="d">-------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessResult.kt</a></td><td> | </td><td class="num">20</td><td><span class="i"></span><span class="d">--------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt</a></td><td> | </td><td class="num">13</td><td><span class="i"></span><span class="d">-------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleResult.kt</a></td><td> | </td><td class="num">20</td><td><span class="i"></span><span class="d">--------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h13">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerRequest.kt</a></td><td> | </td><td class="num">30</td><td><span class="i"></span><span class="d">------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h14">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerResult.kt</a></td><td> | </td><td class="num">21</td><td><span class="i"></span><span class="d">---------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentRequest.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h16">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentResult.kt</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h17">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h18">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessRequest.kt</a></td><td> | </td><td class="num">33</td><td><span class="i">+++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessResult.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h20">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleRequest.kt</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h21">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleResult.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h22">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt</a></td><td> | </td><td class="num">30</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h23">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerResult.kt</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt</a></td><td> | </td><td class="num">84</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d">-------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h26">app/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt</a></td><td> | </td><td class="num">55</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt</a></td><td> | </td><td class="num">48</td><td><span class="i">++++++</span><span class="d">------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h28">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h29">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt</a></td><td> | </td><td class="num">54</td><td><span class="i">++++++</span><span class="d">------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h30">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/EnumMapper.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/OperaPageViewControllerMapper.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">app/src/main/kotlin/me/rhunk/snapenhance/util/EncryptionHelper.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">app/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h38">app/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
</table></pre><pre>39 files changed, 849 insertions(+), 611 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -10,7 +10,7 @@ import android.os.Process
</a> import android.widget.Toast
 import com.google.gson.Gson
 import com.google.gson.GsonBuilder
<a href="#h0-0-3" id="h0-0-3" class="d">-import me.rhunk.snapenhance.bridge.client.BridgeClient
</a><a href="#h0-0-4" id="h0-0-4" class="i">+import me.rhunk.snapenhance.bridge.AbstractBridgeClient
</a> import me.rhunk.snapenhance.database.DatabaseAccess
 import me.rhunk.snapenhance.features.Feature
 import me.rhunk.snapenhance.manager.impl.ActionManager
<a href="#h0-1" id="h0-1" class="h">@@ -29,10 +29,10 @@ class ModContext {
</a> 
     lateinit var androidContext: Context
     var mainActivity: Activity? = null
<a href="#h0-1-3" id="h0-1-3" class="i">+    lateinit var bridgeClient: AbstractBridgeClient
</a> 
     val gson: Gson = GsonBuilder().create()
 
<a href="#h0-1-7" id="h0-1-7" class="d">-    val bridgeClient = BridgeClient(this)
</a>     val translation = TranslationManager(this)
     val features = FeatureManager(this)
     val mappings = MappingManager(this)
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,8 +1,13 @@
</a> package me.rhunk.snapenhance
 
<a href="#h1-0-2" id="h1-0-2" class="i">+import android.annotation.SuppressLint
</a> import android.app.Activity
 import android.app.Application
 import android.content.Context
<a href="#h1-0-6" id="h1-0-6" class="i">+import android.os.Build
</a><a href="#h1-0-7" id="h1-0-7" class="i">+import me.rhunk.snapenhance.bridge.AbstractBridgeClient
</a><a href="#h1-0-8" id="h1-0-8" class="i">+import me.rhunk.snapenhance.bridge.client.RootBridgeClient
</a><a href="#h1-0-9" id="h1-0-9" class="i">+import me.rhunk.snapenhance.bridge.client.ServiceBridgeClient
</a> import me.rhunk.snapenhance.data.SnapClassCache
 import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
<a href="#h1-1" id="h1-1" class="h">@@ -17,21 +22,26 @@ class SnapEnhance {
</a>     private val appContext = ModContext()
 
     init {
<a href="#h1-1-3" id="h1-1-3" class="i">+
</a>         Hooker.hook(Application::class.java, &quot;attach&quot;, HookStage.BEFORE) { param -&gt;
             appContext.androidContext = param.arg&lt;Context&gt;(0).also {
                 classLoader = it.classLoader
             }
<a href="#h1-1-8" id="h1-1-8" class="i">+            appContext.bridgeClient = provideBridgeClient()
</a> 
<a href="#h1-1-10" id="h1-1-10" class="d">-            appContext.bridgeClient.start { bridgeResult -&gt;
</a><a href="#h1-1-11" id="h1-1-11" class="d">-                if (!bridgeResult) {
</a><a href="#h1-1-12" id="h1-1-12" class="d">-                    Logger.xposedLog(&quot;Cannot connect to bridge service&quot;)
</a><a href="#h1-1-13" id="h1-1-13" class="d">-                    appContext.restartApp()
</a><a href="#h1-1-14" id="h1-1-14" class="d">-                    return@start
</a><a href="#h1-1-15" id="h1-1-15" class="d">-                }
</a><a href="#h1-1-16" id="h1-1-16" class="d">-                runCatching {
</a><a href="#h1-1-17" id="h1-1-17" class="d">-                    init()
</a><a href="#h1-1-18" id="h1-1-18" class="d">-                }.onFailure {
</a><a href="#h1-1-19" id="h1-1-19" class="d">-                    Logger.xposedLog(&quot;Failed to initialize&quot;, it)
</a><a href="#h1-1-20" id="h1-1-20" class="i">+            appContext.bridgeClient.apply {
</a><a href="#h1-1-21" id="h1-1-21" class="i">+                this.context = appContext
</a><a href="#h1-1-22" id="h1-1-22" class="i">+                start { bridgeResult -&gt;
</a><a href="#h1-1-23" id="h1-1-23" class="i">+                    if (!bridgeResult) {
</a><a href="#h1-1-24" id="h1-1-24" class="i">+                        Logger.xposedLog(&quot;Cannot connect to bridge service&quot;)
</a><a href="#h1-1-25" id="h1-1-25" class="i">+                        appContext.restartApp()
</a><a href="#h1-1-26" id="h1-1-26" class="i">+                        return@start
</a><a href="#h1-1-27" id="h1-1-27" class="i">+                    }
</a><a href="#h1-1-28" id="h1-1-28" class="i">+                    runCatching {
</a><a href="#h1-1-29" id="h1-1-29" class="i">+                        init()
</a><a href="#h1-1-30" id="h1-1-30" class="i">+                    }.onFailure {
</a><a href="#h1-1-31" id="h1-1-31" class="i">+                        Logger.xposedLog(&quot;Failed to initialize&quot;, it)
</a><a href="#h1-1-32" id="h1-1-32" class="i">+                    }
</a>                 }
             }
         }
<a href="#h1-2" id="h1-2" class="h">@@ -46,6 +56,15 @@ class SnapEnhance {
</a>         }
     }
 
<a href="#h1-2-3" id="h1-2-3" class="i">+    @SuppressLint(&quot;ObsoleteSdkInt&quot;)
</a><a href="#h1-2-4" id="h1-2-4" class="i">+    private fun provideBridgeClient(): AbstractBridgeClient {
</a><a href="#h1-2-5" id="h1-2-5" class="i">+        //unsafe way for Android 9 devices
</a><a href="#h1-2-6" id="h1-2-6" class="i">+        if (Build.VERSION.SDK_INT &lt;= Build.VERSION_CODES.P) {
</a><a href="#h1-2-7" id="h1-2-7" class="i">+            return RootBridgeClient()
</a><a href="#h1-2-8" id="h1-2-8" class="i">+        }
</a><a href="#h1-2-9" id="h1-2-9" class="i">+        return ServiceBridgeClient()
</a><a href="#h1-2-10" id="h1-2-10" class="i">+    }
</a><a href="#h1-2-11" id="h1-2-11" class="i">+
</a>     private fun init() {
         val time = System.currentTimeMillis()
         with(appContext) {
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,95 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+package me.rhunk.snapenhance.bridge
</a><a href="#h2-0-1" id="h2-0-1" class="i">+
</a><a href="#h2-0-2" id="h2-0-2" class="i">+import me.rhunk.snapenhance.ModContext
</a><a href="#h2-0-3" id="h2-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h2-0-4" id="h2-0-4" class="i">+import me.rhunk.snapenhance.bridge.common.impl.locale.LocaleResult
</a><a href="#h2-0-5" id="h2-0-5" class="i">+
</a><a href="#h2-0-6" id="h2-0-6" class="i">+abstract class AbstractBridgeClient {
</a><a href="#h2-0-7" id="h2-0-7" class="i">+    lateinit var context: ModContext
</a><a href="#h2-0-8" id="h2-0-8" class="i">+
</a><a href="#h2-0-9" id="h2-0-9" class="i">+    /**
</a><a href="#h2-0-10" id="h2-0-10" class="i">+     * Start the bridge client
</a><a href="#h2-0-11" id="h2-0-11" class="i">+     *
</a><a href="#h2-0-12" id="h2-0-12" class="i">+     * @param callback the callback to call when the initialization is done
</a><a href="#h2-0-13" id="h2-0-13" class="i">+     */
</a><a href="#h2-0-14" id="h2-0-14" class="i">+    abstract fun start(callback: (Boolean) -&gt; Unit = {})
</a><a href="#h2-0-15" id="h2-0-15" class="i">+
</a><a href="#h2-0-16" id="h2-0-16" class="i">+    /**
</a><a href="#h2-0-17" id="h2-0-17" class="i">+     * Create a file if it doesn&#39;t exist, and read it
</a><a href="#h2-0-18" id="h2-0-18" class="i">+     *
</a><a href="#h2-0-19" id="h2-0-19" class="i">+     * @param fileType       the type of file to create and read
</a><a href="#h2-0-20" id="h2-0-20" class="i">+     * @param defaultContent the default content to write to the file if it doesn&#39;t exist
</a><a href="#h2-0-21" id="h2-0-21" class="i">+     * @return the content of the file
</a><a href="#h2-0-22" id="h2-0-22" class="i">+     */
</a><a href="#h2-0-23" id="h2-0-23" class="i">+    abstract fun createAndReadFile(fileType: BridgeFileType, defaultContent: ByteArray): ByteArray
</a><a href="#h2-0-24" id="h2-0-24" class="i">+
</a><a href="#h2-0-25" id="h2-0-25" class="i">+    /**
</a><a href="#h2-0-26" id="h2-0-26" class="i">+     * Read a file
</a><a href="#h2-0-27" id="h2-0-27" class="i">+     *
</a><a href="#h2-0-28" id="h2-0-28" class="i">+     * @param fileType the type of file to read
</a><a href="#h2-0-29" id="h2-0-29" class="i">+     * @return the content of the file
</a><a href="#h2-0-30" id="h2-0-30" class="i">+     */
</a><a href="#h2-0-31" id="h2-0-31" class="i">+    abstract fun readFile(fileType: BridgeFileType): ByteArray
</a><a href="#h2-0-32" id="h2-0-32" class="i">+
</a><a href="#h2-0-33" id="h2-0-33" class="i">+    /**
</a><a href="#h2-0-34" id="h2-0-34" class="i">+     * Write a file
</a><a href="#h2-0-35" id="h2-0-35" class="i">+     *
</a><a href="#h2-0-36" id="h2-0-36" class="i">+     * @param fileType the type of file to write
</a><a href="#h2-0-37" id="h2-0-37" class="i">+     * @param content  the content to write to the file
</a><a href="#h2-0-38" id="h2-0-38" class="i">+     * @return true if the file was written successfully
</a><a href="#h2-0-39" id="h2-0-39" class="i">+     */
</a><a href="#h2-0-40" id="h2-0-40" class="i">+    abstract fun writeFile(fileType: BridgeFileType, content: ByteArray?): Boolean
</a><a href="#h2-0-41" id="h2-0-41" class="i">+
</a><a href="#h2-0-42" id="h2-0-42" class="i">+    /**
</a><a href="#h2-0-43" id="h2-0-43" class="i">+     * Delete a file
</a><a href="#h2-0-44" id="h2-0-44" class="i">+     *
</a><a href="#h2-0-45" id="h2-0-45" class="i">+     * @param fileType the type of file to delete
</a><a href="#h2-0-46" id="h2-0-46" class="i">+     * @return true if the file was deleted successfully
</a><a href="#h2-0-47" id="h2-0-47" class="i">+     */
</a><a href="#h2-0-48" id="h2-0-48" class="i">+    abstract fun deleteFile(fileType: BridgeFileType): Boolean
</a><a href="#h2-0-49" id="h2-0-49" class="i">+
</a><a href="#h2-0-50" id="h2-0-50" class="i">+    /**
</a><a href="#h2-0-51" id="h2-0-51" class="i">+     * Check if a file exists
</a><a href="#h2-0-52" id="h2-0-52" class="i">+     *
</a><a href="#h2-0-53" id="h2-0-53" class="i">+     * @param fileType the type of file to check
</a><a href="#h2-0-54" id="h2-0-54" class="i">+     * @return true if the file exists
</a><a href="#h2-0-55" id="h2-0-55" class="i">+     */
</a><a href="#h2-0-56" id="h2-0-56" class="i">+    abstract fun isFileExists(fileType: BridgeFileType): Boolean
</a><a href="#h2-0-57" id="h2-0-57" class="i">+
</a><a href="#h2-0-58" id="h2-0-58" class="i">+    /**
</a><a href="#h2-0-59" id="h2-0-59" class="i">+     * Download content from a URL and save it to a file
</a><a href="#h2-0-60" id="h2-0-60" class="i">+     *
</a><a href="#h2-0-61" id="h2-0-61" class="i">+     * @param url  the URL to download content from
</a><a href="#h2-0-62" id="h2-0-62" class="i">+     * @param path the path to save the content to
</a><a href="#h2-0-63" id="h2-0-63" class="i">+     * @return true if the content was downloaded successfully
</a><a href="#h2-0-64" id="h2-0-64" class="i">+     */
</a><a href="#h2-0-65" id="h2-0-65" class="i">+    abstract fun downloadContent(url: String, path: String): Boolean
</a><a href="#h2-0-66" id="h2-0-66" class="i">+
</a><a href="#h2-0-67" id="h2-0-67" class="i">+    /**
</a><a href="#h2-0-68" id="h2-0-68" class="i">+     * Get the content of a logged message from the database
</a><a href="#h2-0-69" id="h2-0-69" class="i">+     *
</a><a href="#h2-0-70" id="h2-0-70" class="i">+     * @param id the ID of the message logger message
</a><a href="#h2-0-71" id="h2-0-71" class="i">+     * @return the content of the message
</a><a href="#h2-0-72" id="h2-0-72" class="i">+     */
</a><a href="#h2-0-73" id="h2-0-73" class="i">+    abstract fun getMessageLoggerMessage(id: Long): ByteArray?
</a><a href="#h2-0-74" id="h2-0-74" class="i">+
</a><a href="#h2-0-75" id="h2-0-75" class="i">+    /**
</a><a href="#h2-0-76" id="h2-0-76" class="i">+     * Add a message to the message logger database
</a><a href="#h2-0-77" id="h2-0-77" class="i">+     *
</a><a href="#h2-0-78" id="h2-0-78" class="i">+     * @param id      the ID of the message logger message
</a><a href="#h2-0-79" id="h2-0-79" class="i">+     * @param message the content of the message
</a><a href="#h2-0-80" id="h2-0-80" class="i">+     */
</a><a href="#h2-0-81" id="h2-0-81" class="i">+    abstract fun addMessageLoggerMessage(id: Long, message: ByteArray)
</a><a href="#h2-0-82" id="h2-0-82" class="i">+
</a><a href="#h2-0-83" id="h2-0-83" class="i">+    /**
</a><a href="#h2-0-84" id="h2-0-84" class="i">+     * Clear the message logger database
</a><a href="#h2-0-85" id="h2-0-85" class="i">+     */
</a><a href="#h2-0-86" id="h2-0-86" class="i">+    abstract fun clearMessageLogger()
</a><a href="#h2-0-87" id="h2-0-87" class="i">+
</a><a href="#h2-0-88" id="h2-0-88" class="i">+    /**
</a><a href="#h2-0-89" id="h2-0-89" class="i">+     * Fetch the translations
</a><a href="#h2-0-90" id="h2-0-90" class="i">+     *
</a><a href="#h2-0-91" id="h2-0-91" class="i">+     * @return the translations result
</a><a href="#h2-0-92" id="h2-0-92" class="i">+     */
</a><a href="#h2-0-93" id="h2-0-93" class="i">+    abstract fun fetchTranslations(): LocaleResult
</a><a href="#h2-0-94" id="h2-0-94" class="i">+}</a><a href="#h2-0-95" id="h2-0-95" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/MessageLoggerWrapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/MessageLoggerWrapper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/MessageLoggerWrapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/MessageLoggerWrapper.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,47 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+package me.rhunk.snapenhance.bridge
</a><a href="#h3-0-1" id="h3-0-1" class="i">+
</a><a href="#h3-0-2" id="h3-0-2" class="i">+import android.content.ContentValues
</a><a href="#h3-0-3" id="h3-0-3" class="i">+import android.database.sqlite.SQLiteDatabase
</a><a href="#h3-0-4" id="h3-0-4" class="i">+import java.io.File
</a><a href="#h3-0-5" id="h3-0-5" class="i">+
</a><a href="#h3-0-6" id="h3-0-6" class="i">+class MessageLoggerWrapper(
</a><a href="#h3-0-7" id="h3-0-7" class="i">+    private val databaseFile: File
</a><a href="#h3-0-8" id="h3-0-8" class="i">+) {
</a><a href="#h3-0-9" id="h3-0-9" class="i">+
</a><a href="#h3-0-10" id="h3-0-10" class="i">+    lateinit var database: SQLiteDatabase
</a><a href="#h3-0-11" id="h3-0-11" class="i">+
</a><a href="#h3-0-12" id="h3-0-12" class="i">+    fun init() {
</a><a href="#h3-0-13" id="h3-0-13" class="i">+        database = SQLiteDatabase.openDatabase(databaseFile.absolutePath, null, SQLiteDatabase.CREATE_IF_NECESSARY or SQLiteDatabase.OPEN_READWRITE)
</a><a href="#h3-0-14" id="h3-0-14" class="i">+        database.execSQL(&quot;CREATE TABLE IF NOT EXISTS messages (message_id INTEGER PRIMARY KEY, serialized_message BLOB)&quot;)
</a><a href="#h3-0-15" id="h3-0-15" class="i">+    }
</a><a href="#h3-0-16" id="h3-0-16" class="i">+
</a><a href="#h3-0-17" id="h3-0-17" class="i">+    fun addMessage(messageId: Long, serializedMessage: ByteArray): Boolean {
</a><a href="#h3-0-18" id="h3-0-18" class="i">+        val cursor = database.rawQuery(&quot;SELECT message_id FROM messages WHERE message_id = ?&quot;, arrayOf(messageId.toString()))
</a><a href="#h3-0-19" id="h3-0-19" class="i">+        val state = cursor.moveToFirst()
</a><a href="#h3-0-20" id="h3-0-20" class="i">+        cursor.close()
</a><a href="#h3-0-21" id="h3-0-21" class="i">+        if (state) {
</a><a href="#h3-0-22" id="h3-0-22" class="i">+            return false
</a><a href="#h3-0-23" id="h3-0-23" class="i">+        }
</a><a href="#h3-0-24" id="h3-0-24" class="i">+        database.insert(&quot;messages&quot;, null, ContentValues().apply {
</a><a href="#h3-0-25" id="h3-0-25" class="i">+            put(&quot;message_id&quot;, messageId)
</a><a href="#h3-0-26" id="h3-0-26" class="i">+            put(&quot;serialized_message&quot;, serializedMessage)
</a><a href="#h3-0-27" id="h3-0-27" class="i">+        })
</a><a href="#h3-0-28" id="h3-0-28" class="i">+        return true
</a><a href="#h3-0-29" id="h3-0-29" class="i">+    }
</a><a href="#h3-0-30" id="h3-0-30" class="i">+
</a><a href="#h3-0-31" id="h3-0-31" class="i">+    fun clearMessages() {
</a><a href="#h3-0-32" id="h3-0-32" class="i">+        database.execSQL(&quot;DELETE FROM messages&quot;)
</a><a href="#h3-0-33" id="h3-0-33" class="i">+    }
</a><a href="#h3-0-34" id="h3-0-34" class="i">+
</a><a href="#h3-0-35" id="h3-0-35" class="i">+    fun getMessage(messageId: Long): Pair&lt;Boolean, ByteArray?&gt; {
</a><a href="#h3-0-36" id="h3-0-36" class="i">+        val cursor = database.rawQuery(&quot;SELECT serialized_message FROM messages WHERE message_id = ?&quot;, arrayOf(messageId.toString()))
</a><a href="#h3-0-37" id="h3-0-37" class="i">+        val state = cursor.moveToFirst()
</a><a href="#h3-0-38" id="h3-0-38" class="i">+        val message: ByteArray? = if (state) {
</a><a href="#h3-0-39" id="h3-0-39" class="i">+            cursor.getBlob(0)
</a><a href="#h3-0-40" id="h3-0-40" class="i">+        } else {
</a><a href="#h3-0-41" id="h3-0-41" class="i">+            null
</a><a href="#h3-0-42" id="h3-0-42" class="i">+        }
</a><a href="#h3-0-43" id="h3-0-43" class="i">+        cursor.close()
</a><a href="#h3-0-44" id="h3-0-44" class="i">+        return Pair(state, message)
</a><a href="#h3-0-45" id="h3-0-45" class="i">+    }
</a><a href="#h3-0-46" id="h3-0-46" class="i">+}</a><a href="#h3-0-47" id="h3-0-47" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/BridgeClient.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,254 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-package me.rhunk.snapenhance.bridge.client
</a><a href="#h4-0-1" id="h4-0-1" class="d">-
</a><a href="#h4-0-2" id="h4-0-2" class="d">-
</a><a href="#h4-0-3" id="h4-0-3" class="d">-import android.content.ComponentName
</a><a href="#h4-0-4" id="h4-0-4" class="d">-import android.content.Context
</a><a href="#h4-0-5" id="h4-0-5" class="d">-import android.content.Intent
</a><a href="#h4-0-6" id="h4-0-6" class="d">-import android.content.ServiceConnection
</a><a href="#h4-0-7" id="h4-0-7" class="d">-import android.os.*
</a><a href="#h4-0-8" id="h4-0-8" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h4-0-9" id="h4-0-9" class="d">-import me.rhunk.snapenhance.Logger.xposedLog
</a><a href="#h4-0-10" id="h4-0-10" class="d">-import me.rhunk.snapenhance.ModContext
</a><a href="#h4-0-11" id="h4-0-11" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h4-0-12" id="h4-0-12" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessageType
</a><a href="#h4-0-13" id="h4-0-13" class="d">-import me.rhunk.snapenhance.bridge.common.impl.*
</a><a href="#h4-0-14" id="h4-0-14" class="d">-import me.rhunk.snapenhance.bridge.service.BridgeService
</a><a href="#h4-0-15" id="h4-0-15" class="d">-import java.util.concurrent.CompletableFuture
</a><a href="#h4-0-16" id="h4-0-16" class="d">-import java.util.concurrent.Executors
</a><a href="#h4-0-17" id="h4-0-17" class="d">-import kotlin.reflect.KClass
</a><a href="#h4-0-18" id="h4-0-18" class="d">-import kotlin.system.exitProcess
</a><a href="#h4-0-19" id="h4-0-19" class="d">-
</a><a href="#h4-0-20" id="h4-0-20" class="d">-
</a><a href="#h4-0-21" id="h4-0-21" class="d">-class BridgeClient(
</a><a href="#h4-0-22" id="h4-0-22" class="d">-    private val context: ModContext
</a><a href="#h4-0-23" id="h4-0-23" class="d">-) : ServiceConnection {
</a><a href="#h4-0-24" id="h4-0-24" class="d">-    private val handlerThread = HandlerThread(&quot;BridgeClient&quot;)
</a><a href="#h4-0-25" id="h4-0-25" class="d">-
</a><a href="#h4-0-26" id="h4-0-26" class="d">-    private lateinit var messenger: Messenger
</a><a href="#h4-0-27" id="h4-0-27" class="d">-    private lateinit var future: CompletableFuture&lt;Boolean&gt;
</a><a href="#h4-0-28" id="h4-0-28" class="d">-
</a><a href="#h4-0-29" id="h4-0-29" class="d">-    fun start(callback: (Boolean) -&gt; Unit = {}) {
</a><a href="#h4-0-30" id="h4-0-30" class="d">-        this.future = CompletableFuture()
</a><a href="#h4-0-31" id="h4-0-31" class="d">-        this.handlerThread.start()
</a><a href="#h4-0-32" id="h4-0-32" class="d">-
</a><a href="#h4-0-33" id="h4-0-33" class="d">-        with(context.androidContext) {
</a><a href="#h4-0-34" id="h4-0-34" class="d">-            val intent = Intent()
</a><a href="#h4-0-35" id="h4-0-35" class="d">-                .setClassName(BuildConfig.APPLICATION_ID, BridgeService::class.java.name)
</a><a href="#h4-0-36" id="h4-0-36" class="d">-            bindService(
</a><a href="#h4-0-37" id="h4-0-37" class="d">-                intent,
</a><a href="#h4-0-38" id="h4-0-38" class="d">-                Context.BIND_AUTO_CREATE,
</a><a href="#h4-0-39" id="h4-0-39" class="d">-                Executors.newSingleThreadExecutor(),
</a><a href="#h4-0-40" id="h4-0-40" class="d">-                this@BridgeClient
</a><a href="#h4-0-41" id="h4-0-41" class="d">-            )
</a><a href="#h4-0-42" id="h4-0-42" class="d">-        }
</a><a href="#h4-0-43" id="h4-0-43" class="d">-        callback(future.get())
</a><a href="#h4-0-44" id="h4-0-44" class="d">-    }
</a><a href="#h4-0-45" id="h4-0-45" class="d">-
</a><a href="#h4-0-46" id="h4-0-46" class="d">-    private fun handleResponseMessage(
</a><a href="#h4-0-47" id="h4-0-47" class="d">-        msg: Message,
</a><a href="#h4-0-48" id="h4-0-48" class="d">-        future: CompletableFuture&lt;BridgeMessage&gt;
</a><a href="#h4-0-49" id="h4-0-49" class="d">-    ) {
</a><a href="#h4-0-50" id="h4-0-50" class="d">-        val message: BridgeMessage = when (BridgeMessageType.fromValue(msg.what)) {
</a><a href="#h4-0-51" id="h4-0-51" class="d">-            BridgeMessageType.FILE_ACCESS_RESULT -&gt; FileAccessResult()
</a><a href="#h4-0-52" id="h4-0-52" class="d">-            BridgeMessageType.DOWNLOAD_CONTENT_RESULT -&gt; DownloadContentResult()
</a><a href="#h4-0-53" id="h4-0-53" class="d">-            BridgeMessageType.MESSAGE_LOGGER_RESULT -&gt; MessageLoggerResult()
</a><a href="#h4-0-54" id="h4-0-54" class="d">-            BridgeMessageType.LOCALE_RESULT -&gt; LocaleResult()
</a><a href="#h4-0-55" id="h4-0-55" class="d">-            else -&gt; {
</a><a href="#h4-0-56" id="h4-0-56" class="d">-                future.completeExceptionally(IllegalStateException(&quot;Unknown message type: ${msg.what}&quot;))
</a><a href="#h4-0-57" id="h4-0-57" class="d">-                return
</a><a href="#h4-0-58" id="h4-0-58" class="d">-            }
</a><a href="#h4-0-59" id="h4-0-59" class="d">-        }
</a><a href="#h4-0-60" id="h4-0-60" class="d">-
</a><a href="#h4-0-61" id="h4-0-61" class="d">-        with(message) {
</a><a href="#h4-0-62" id="h4-0-62" class="d">-            read(msg.data)
</a><a href="#h4-0-63" id="h4-0-63" class="d">-            future.complete(this)
</a><a href="#h4-0-64" id="h4-0-64" class="d">-        }
</a><a href="#h4-0-65" id="h4-0-65" class="d">-    }
</a><a href="#h4-0-66" id="h4-0-66" class="d">-
</a><a href="#h4-0-67" id="h4-0-67" class="d">-    @Suppress(&quot;UNCHECKED_CAST&quot;, &quot;UNUSED_PARAMETER&quot;)
</a><a href="#h4-0-68" id="h4-0-68" class="d">-    private fun &lt;T : BridgeMessage&gt; sendMessage(
</a><a href="#h4-0-69" id="h4-0-69" class="d">-        messageType: BridgeMessageType,
</a><a href="#h4-0-70" id="h4-0-70" class="d">-        message: BridgeMessage,
</a><a href="#h4-0-71" id="h4-0-71" class="d">-        resultType: KClass&lt;T&gt;? = null
</a><a href="#h4-0-72" id="h4-0-72" class="d">-    ): T {
</a><a href="#h4-0-73" id="h4-0-73" class="d">-        val future = CompletableFuture&lt;BridgeMessage&gt;()
</a><a href="#h4-0-74" id="h4-0-74" class="d">-
</a><a href="#h4-0-75" id="h4-0-75" class="d">-        val replyMessenger = Messenger(object : Handler(handlerThread.looper) {
</a><a href="#h4-0-76" id="h4-0-76" class="d">-            override fun handleMessage(msg: Message) {
</a><a href="#h4-0-77" id="h4-0-77" class="d">-                handleResponseMessage(msg, future)
</a><a href="#h4-0-78" id="h4-0-78" class="d">-            }
</a><a href="#h4-0-79" id="h4-0-79" class="d">-        })
</a><a href="#h4-0-80" id="h4-0-80" class="d">-
</a><a href="#h4-0-81" id="h4-0-81" class="d">-        runCatching {
</a><a href="#h4-0-82" id="h4-0-82" class="d">-            with(Message.obtain()) {
</a><a href="#h4-0-83" id="h4-0-83" class="d">-                what = messageType.value
</a><a href="#h4-0-84" id="h4-0-84" class="d">-                replyTo = replyMessenger
</a><a href="#h4-0-85" id="h4-0-85" class="d">-                data = Bundle()
</a><a href="#h4-0-86" id="h4-0-86" class="d">-                message.write(data)
</a><a href="#h4-0-87" id="h4-0-87" class="d">-                messenger.send(this)
</a><a href="#h4-0-88" id="h4-0-88" class="d">-            }
</a><a href="#h4-0-89" id="h4-0-89" class="d">-        }
</a><a href="#h4-0-90" id="h4-0-90" class="d">-
</a><a href="#h4-0-91" id="h4-0-91" class="d">-        return future.get() as T
</a><a href="#h4-0-92" id="h4-0-92" class="d">-    }
</a><a href="#h4-0-93" id="h4-0-93" class="d">-
</a><a href="#h4-0-94" id="h4-0-94" class="d">-    /**
</a><a href="#h4-0-95" id="h4-0-95" class="d">-     * Create a file if it doesn&#39;t exist, and read it
</a><a href="#h4-0-96" id="h4-0-96" class="d">-     *
</a><a href="#h4-0-97" id="h4-0-97" class="d">-     * @param fileType       the type of file to create and read
</a><a href="#h4-0-98" id="h4-0-98" class="d">-     * @param defaultContent the default content to write to the file if it doesn&#39;t exist
</a><a href="#h4-0-99" id="h4-0-99" class="d">-     * @return the content of the file
</a><a href="#h4-0-100" id="h4-0-100" class="d">-     */
</a><a href="#h4-0-101" id="h4-0-101" class="d">-    fun createAndReadFile(
</a><a href="#h4-0-102" id="h4-0-102" class="d">-        fileType: FileAccessRequest.FileType,
</a><a href="#h4-0-103" id="h4-0-103" class="d">-        defaultContent: ByteArray
</a><a href="#h4-0-104" id="h4-0-104" class="d">-    ): ByteArray {
</a><a href="#h4-0-105" id="h4-0-105" class="d">-        sendMessage(
</a><a href="#h4-0-106" id="h4-0-106" class="d">-            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h4-0-107" id="h4-0-107" class="d">-            FileAccessRequest(FileAccessRequest.FileAccessAction.EXISTS, fileType, null),
</a><a href="#h4-0-108" id="h4-0-108" class="d">-            FileAccessResult::class
</a><a href="#h4-0-109" id="h4-0-109" class="d">-        ).run {
</a><a href="#h4-0-110" id="h4-0-110" class="d">-            if (state!!) {
</a><a href="#h4-0-111" id="h4-0-111" class="d">-                return readFile(fileType)
</a><a href="#h4-0-112" id="h4-0-112" class="d">-            }
</a><a href="#h4-0-113" id="h4-0-113" class="d">-            writeFile(fileType, defaultContent)
</a><a href="#h4-0-114" id="h4-0-114" class="d">-            return defaultContent
</a><a href="#h4-0-115" id="h4-0-115" class="d">-        }
</a><a href="#h4-0-116" id="h4-0-116" class="d">-    }
</a><a href="#h4-0-117" id="h4-0-117" class="d">-
</a><a href="#h4-0-118" id="h4-0-118" class="d">-    /**
</a><a href="#h4-0-119" id="h4-0-119" class="d">-     * Read a file
</a><a href="#h4-0-120" id="h4-0-120" class="d">-     *
</a><a href="#h4-0-121" id="h4-0-121" class="d">-     * @param fileType the type of file to read
</a><a href="#h4-0-122" id="h4-0-122" class="d">-     * @return the content of the file
</a><a href="#h4-0-123" id="h4-0-123" class="d">-     */
</a><a href="#h4-0-124" id="h4-0-124" class="d">-    fun readFile(fileType: FileAccessRequest.FileType): ByteArray {
</a><a href="#h4-0-125" id="h4-0-125" class="d">-        sendMessage(
</a><a href="#h4-0-126" id="h4-0-126" class="d">-            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h4-0-127" id="h4-0-127" class="d">-            FileAccessRequest(FileAccessRequest.FileAccessAction.READ, fileType, null),
</a><a href="#h4-0-128" id="h4-0-128" class="d">-            FileAccessResult::class
</a><a href="#h4-0-129" id="h4-0-129" class="d">-        ).run {
</a><a href="#h4-0-130" id="h4-0-130" class="d">-            return content!!
</a><a href="#h4-0-131" id="h4-0-131" class="d">-        }
</a><a href="#h4-0-132" id="h4-0-132" class="d">-    }
</a><a href="#h4-0-133" id="h4-0-133" class="d">-
</a><a href="#h4-0-134" id="h4-0-134" class="d">-    /**
</a><a href="#h4-0-135" id="h4-0-135" class="d">-     * Write a file
</a><a href="#h4-0-136" id="h4-0-136" class="d">-     *
</a><a href="#h4-0-137" id="h4-0-137" class="d">-     * @param fileType the type of file to write
</a><a href="#h4-0-138" id="h4-0-138" class="d">-     * @param content  the content to write to the file
</a><a href="#h4-0-139" id="h4-0-139" class="d">-     * @return true if the file was written successfully
</a><a href="#h4-0-140" id="h4-0-140" class="d">-     */
</a><a href="#h4-0-141" id="h4-0-141" class="d">-    fun writeFile(
</a><a href="#h4-0-142" id="h4-0-142" class="d">-        fileType: FileAccessRequest.FileType,
</a><a href="#h4-0-143" id="h4-0-143" class="d">-        content: ByteArray?
</a><a href="#h4-0-144" id="h4-0-144" class="d">-    ): Boolean {
</a><a href="#h4-0-145" id="h4-0-145" class="d">-        sendMessage(
</a><a href="#h4-0-146" id="h4-0-146" class="d">-            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h4-0-147" id="h4-0-147" class="d">-            FileAccessRequest(FileAccessRequest.FileAccessAction.WRITE, fileType, content),
</a><a href="#h4-0-148" id="h4-0-148" class="d">-            FileAccessResult::class
</a><a href="#h4-0-149" id="h4-0-149" class="d">-        ).run {
</a><a href="#h4-0-150" id="h4-0-150" class="d">-            return state!!
</a><a href="#h4-0-151" id="h4-0-151" class="d">-        }
</a><a href="#h4-0-152" id="h4-0-152" class="d">-    }
</a><a href="#h4-0-153" id="h4-0-153" class="d">-
</a><a href="#h4-0-154" id="h4-0-154" class="d">-    /**
</a><a href="#h4-0-155" id="h4-0-155" class="d">-     * Delete a file
</a><a href="#h4-0-156" id="h4-0-156" class="d">-     *
</a><a href="#h4-0-157" id="h4-0-157" class="d">-     * @param fileType the type of file to delete
</a><a href="#h4-0-158" id="h4-0-158" class="d">-     * @return true if the file was deleted successfully
</a><a href="#h4-0-159" id="h4-0-159" class="d">-     */
</a><a href="#h4-0-160" id="h4-0-160" class="d">-    fun deleteFile(fileType: FileAccessRequest.FileType): Boolean {
</a><a href="#h4-0-161" id="h4-0-161" class="d">-        sendMessage(
</a><a href="#h4-0-162" id="h4-0-162" class="d">-            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h4-0-163" id="h4-0-163" class="d">-            FileAccessRequest(FileAccessRequest.FileAccessAction.DELETE, fileType, null),
</a><a href="#h4-0-164" id="h4-0-164" class="d">-            FileAccessResult::class
</a><a href="#h4-0-165" id="h4-0-165" class="d">-        ).run {
</a><a href="#h4-0-166" id="h4-0-166" class="d">-            return state!!
</a><a href="#h4-0-167" id="h4-0-167" class="d">-        }
</a><a href="#h4-0-168" id="h4-0-168" class="d">-    }
</a><a href="#h4-0-169" id="h4-0-169" class="d">-
</a><a href="#h4-0-170" id="h4-0-170" class="d">-    /**
</a><a href="#h4-0-171" id="h4-0-171" class="d">-     * Check if a file exists
</a><a href="#h4-0-172" id="h4-0-172" class="d">-     *
</a><a href="#h4-0-173" id="h4-0-173" class="d">-     * @param fileType the type of file to check
</a><a href="#h4-0-174" id="h4-0-174" class="d">-     * @return true if the file exists
</a><a href="#h4-0-175" id="h4-0-175" class="d">-     */
</a><a href="#h4-0-176" id="h4-0-176" class="d">-
</a><a href="#h4-0-177" id="h4-0-177" class="d">-    fun isFileExists(fileType: FileAccessRequest.FileType): Boolean {
</a><a href="#h4-0-178" id="h4-0-178" class="d">-        sendMessage(
</a><a href="#h4-0-179" id="h4-0-179" class="d">-            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h4-0-180" id="h4-0-180" class="d">-            FileAccessRequest(FileAccessRequest.FileAccessAction.EXISTS, fileType, null),
</a><a href="#h4-0-181" id="h4-0-181" class="d">-            FileAccessResult::class
</a><a href="#h4-0-182" id="h4-0-182" class="d">-        ).run {
</a><a href="#h4-0-183" id="h4-0-183" class="d">-            return state!!
</a><a href="#h4-0-184" id="h4-0-184" class="d">-        }
</a><a href="#h4-0-185" id="h4-0-185" class="d">-    }
</a><a href="#h4-0-186" id="h4-0-186" class="d">-
</a><a href="#h4-0-187" id="h4-0-187" class="d">-    /**
</a><a href="#h4-0-188" id="h4-0-188" class="d">-     * Download content from a URL and save it to a file
</a><a href="#h4-0-189" id="h4-0-189" class="d">-     *
</a><a href="#h4-0-190" id="h4-0-190" class="d">-     * @param url  the URL to download content from
</a><a href="#h4-0-191" id="h4-0-191" class="d">-     * @param path the path to save the content to
</a><a href="#h4-0-192" id="h4-0-192" class="d">-     * @return true if the content was downloaded successfully
</a><a href="#h4-0-193" id="h4-0-193" class="d">-     */
</a><a href="#h4-0-194" id="h4-0-194" class="d">-    fun downloadContent(url: String, path: String): Boolean {
</a><a href="#h4-0-195" id="h4-0-195" class="d">-        sendMessage(
</a><a href="#h4-0-196" id="h4-0-196" class="d">-            BridgeMessageType.DOWNLOAD_CONTENT_REQUEST,
</a><a href="#h4-0-197" id="h4-0-197" class="d">-            DownloadContentRequest(url, path),
</a><a href="#h4-0-198" id="h4-0-198" class="d">-            DownloadContentResult::class
</a><a href="#h4-0-199" id="h4-0-199" class="d">-        ).run {
</a><a href="#h4-0-200" id="h4-0-200" class="d">-            return state!!
</a><a href="#h4-0-201" id="h4-0-201" class="d">-        }
</a><a href="#h4-0-202" id="h4-0-202" class="d">-    }
</a><a href="#h4-0-203" id="h4-0-203" class="d">-
</a><a href="#h4-0-204" id="h4-0-204" class="d">-    fun getMessageLoggerMessage(id: Long): ByteArray? {
</a><a href="#h4-0-205" id="h4-0-205" class="d">-        sendMessage(
</a><a href="#h4-0-206" id="h4-0-206" class="d">-            BridgeMessageType.MESSAGE_LOGGER_REQUEST,
</a><a href="#h4-0-207" id="h4-0-207" class="d">-            MessageLoggerRequest(MessageLoggerRequest.Action.GET, id),
</a><a href="#h4-0-208" id="h4-0-208" class="d">-            MessageLoggerResult::class
</a><a href="#h4-0-209" id="h4-0-209" class="d">-        ).run {
</a><a href="#h4-0-210" id="h4-0-210" class="d">-            return message
</a><a href="#h4-0-211" id="h4-0-211" class="d">-        }
</a><a href="#h4-0-212" id="h4-0-212" class="d">-    }
</a><a href="#h4-0-213" id="h4-0-213" class="d">-
</a><a href="#h4-0-214" id="h4-0-214" class="d">-    fun addMessageLoggerMessage(id: Long, message: ByteArray) {
</a><a href="#h4-0-215" id="h4-0-215" class="d">-        sendMessage(
</a><a href="#h4-0-216" id="h4-0-216" class="d">-            BridgeMessageType.MESSAGE_LOGGER_REQUEST,
</a><a href="#h4-0-217" id="h4-0-217" class="d">-            MessageLoggerRequest(MessageLoggerRequest.Action.ADD, id, message),
</a><a href="#h4-0-218" id="h4-0-218" class="d">-            MessageLoggerResult::class
</a><a href="#h4-0-219" id="h4-0-219" class="d">-        )
</a><a href="#h4-0-220" id="h4-0-220" class="d">-    }
</a><a href="#h4-0-221" id="h4-0-221" class="d">-
</a><a href="#h4-0-222" id="h4-0-222" class="d">-    fun clearMessageLogger() {
</a><a href="#h4-0-223" id="h4-0-223" class="d">-        sendMessage(
</a><a href="#h4-0-224" id="h4-0-224" class="d">-            BridgeMessageType.MESSAGE_LOGGER_REQUEST,
</a><a href="#h4-0-225" id="h4-0-225" class="d">-            MessageLoggerRequest(MessageLoggerRequest.Action.CLEAR, 0),
</a><a href="#h4-0-226" id="h4-0-226" class="d">-            MessageLoggerResult::class
</a><a href="#h4-0-227" id="h4-0-227" class="d">-        )
</a><a href="#h4-0-228" id="h4-0-228" class="d">-    }
</a><a href="#h4-0-229" id="h4-0-229" class="d">-
</a><a href="#h4-0-230" id="h4-0-230" class="d">-    fun fetchTranslations(): LocaleResult {
</a><a href="#h4-0-231" id="h4-0-231" class="d">-        sendMessage(
</a><a href="#h4-0-232" id="h4-0-232" class="d">-            BridgeMessageType.LOCALE_REQUEST,
</a><a href="#h4-0-233" id="h4-0-233" class="d">-            LocaleRequest(),
</a><a href="#h4-0-234" id="h4-0-234" class="d">-            LocaleResult::class
</a><a href="#h4-0-235" id="h4-0-235" class="d">-        ).run {
</a><a href="#h4-0-236" id="h4-0-236" class="d">-            return this
</a><a href="#h4-0-237" id="h4-0-237" class="d">-        }
</a><a href="#h4-0-238" id="h4-0-238" class="d">-    }
</a><a href="#h4-0-239" id="h4-0-239" class="d">-
</a><a href="#h4-0-240" id="h4-0-240" class="d">-    override fun onServiceConnected(name: ComponentName, service: IBinder) {
</a><a href="#h4-0-241" id="h4-0-241" class="d">-        messenger = Messenger(service)
</a><a href="#h4-0-242" id="h4-0-242" class="d">-        future.complete(true)
</a><a href="#h4-0-243" id="h4-0-243" class="d">-    }
</a><a href="#h4-0-244" id="h4-0-244" class="d">-
</a><a href="#h4-0-245" id="h4-0-245" class="d">-    override fun onNullBinding(name: ComponentName) {
</a><a href="#h4-0-246" id="h4-0-246" class="d">-        xposedLog(&quot;failed to connect to bridge service&quot;)
</a><a href="#h4-0-247" id="h4-0-247" class="d">-        future.complete(false)
</a><a href="#h4-0-248" id="h4-0-248" class="d">-    }
</a><a href="#h4-0-249" id="h4-0-249" class="d">-
</a><a href="#h4-0-250" id="h4-0-250" class="d">-    override fun onServiceDisconnected(name: ComponentName) {
</a><a href="#h4-0-251" id="h4-0-251" class="d">-        exitProcess(0)
</a><a href="#h4-0-252" id="h4-0-252" class="d">-    }
</a><a href="#h4-0-253" id="h4-0-253" class="d">-}
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,133 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+package me.rhunk.snapenhance.bridge.client
</a><a href="#h5-0-1" id="h5-0-1" class="i">+
</a><a href="#h5-0-2" id="h5-0-2" class="i">+import android.os.Environment
</a><a href="#h5-0-3" id="h5-0-3" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h5-0-4" id="h5-0-4" class="i">+import me.rhunk.snapenhance.bridge.AbstractBridgeClient
</a><a href="#h5-0-5" id="h5-0-5" class="i">+import me.rhunk.snapenhance.bridge.MessageLoggerWrapper
</a><a href="#h5-0-6" id="h5-0-6" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h5-0-7" id="h5-0-7" class="i">+import me.rhunk.snapenhance.bridge.common.impl.locale.LocaleResult
</a><a href="#h5-0-8" id="h5-0-8" class="i">+import java.io.File
</a><a href="#h5-0-9" id="h5-0-9" class="i">+import java.io.FileInputStream
</a><a href="#h5-0-10" id="h5-0-10" class="i">+import java.io.FileOutputStream
</a><a href="#h5-0-11" id="h5-0-11" class="i">+import java.io.OutputStream
</a><a href="#h5-0-12" id="h5-0-12" class="i">+import java.util.zip.ZipInputStream
</a><a href="#h5-0-13" id="h5-0-13" class="i">+
</a><a href="#h5-0-14" id="h5-0-14" class="i">+class RootBridgeClient : AbstractBridgeClient() {
</a><a href="#h5-0-15" id="h5-0-15" class="i">+    private lateinit var messageLoggerWrapper: MessageLoggerWrapper
</a><a href="#h5-0-16" id="h5-0-16" class="i">+    companion object {
</a><a href="#h5-0-17" id="h5-0-17" class="i">+        private val MOD_FOLDER = File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOCUMENTS),&quot;SnapEnhance&quot;)
</a><a href="#h5-0-18" id="h5-0-18" class="i">+    }
</a><a href="#h5-0-19" id="h5-0-19" class="i">+
</a><a href="#h5-0-20" id="h5-0-20" class="i">+    override fun start(callback: (Boolean) -&gt; Unit) {
</a><a href="#h5-0-21" id="h5-0-21" class="i">+        if (!MOD_FOLDER.exists()) {
</a><a href="#h5-0-22" id="h5-0-22" class="i">+            MOD_FOLDER.mkdirs()
</a><a href="#h5-0-23" id="h5-0-23" class="i">+        }
</a><a href="#h5-0-24" id="h5-0-24" class="i">+        messageLoggerWrapper = MessageLoggerWrapper(File(MOD_FOLDER, BridgeFileType.MESSAGE_LOGGER_DATABASE.fileName)).also { it.init() }
</a><a href="#h5-0-25" id="h5-0-25" class="i">+        callback(true)
</a><a href="#h5-0-26" id="h5-0-26" class="i">+    }
</a><a href="#h5-0-27" id="h5-0-27" class="i">+
</a><a href="#h5-0-28" id="h5-0-28" class="i">+    override fun createAndReadFile(fileType: BridgeFileType, defaultContent: ByteArray): ByteArray {
</a><a href="#h5-0-29" id="h5-0-29" class="i">+        val file = File(MOD_FOLDER, fileType.fileName)
</a><a href="#h5-0-30" id="h5-0-30" class="i">+        if (file.exists()) {
</a><a href="#h5-0-31" id="h5-0-31" class="i">+            return readFile(fileType)
</a><a href="#h5-0-32" id="h5-0-32" class="i">+        }
</a><a href="#h5-0-33" id="h5-0-33" class="i">+        val outputStream = openFileWritable(file)
</a><a href="#h5-0-34" id="h5-0-34" class="i">+        outputStream.write(defaultContent)
</a><a href="#h5-0-35" id="h5-0-35" class="i">+        outputStream.close()
</a><a href="#h5-0-36" id="h5-0-36" class="i">+        return defaultContent
</a><a href="#h5-0-37" id="h5-0-37" class="i">+    }
</a><a href="#h5-0-38" id="h5-0-38" class="i">+
</a><a href="#h5-0-39" id="h5-0-39" class="i">+    override fun readFile(fileType: BridgeFileType): ByteArray {
</a><a href="#h5-0-40" id="h5-0-40" class="i">+        return File(MOD_FOLDER, fileType.fileName).readBytes()
</a><a href="#h5-0-41" id="h5-0-41" class="i">+    }
</a><a href="#h5-0-42" id="h5-0-42" class="i">+
</a><a href="#h5-0-43" id="h5-0-43" class="i">+    override fun writeFile(fileType: BridgeFileType, content: ByteArray?): Boolean {
</a><a href="#h5-0-44" id="h5-0-44" class="i">+        val outputStream = openFileWritable(File(MOD_FOLDER, fileType.fileName))
</a><a href="#h5-0-45" id="h5-0-45" class="i">+        outputStream.write(content)
</a><a href="#h5-0-46" id="h5-0-46" class="i">+        outputStream.close()
</a><a href="#h5-0-47" id="h5-0-47" class="i">+        return true
</a><a href="#h5-0-48" id="h5-0-48" class="i">+    }
</a><a href="#h5-0-49" id="h5-0-49" class="i">+
</a><a href="#h5-0-50" id="h5-0-50" class="i">+    override fun deleteFile(fileType: BridgeFileType): Boolean {
</a><a href="#h5-0-51" id="h5-0-51" class="i">+        val file = File(MOD_FOLDER, fileType.fileName)
</a><a href="#h5-0-52" id="h5-0-52" class="i">+        val exists = file.exists()
</a><a href="#h5-0-53" id="h5-0-53" class="i">+        if (exists) {
</a><a href="#h5-0-54" id="h5-0-54" class="i">+            rootOperation(&quot;rm ${file.absolutePath}&quot;)
</a><a href="#h5-0-55" id="h5-0-55" class="i">+        }
</a><a href="#h5-0-56" id="h5-0-56" class="i">+        return exists
</a><a href="#h5-0-57" id="h5-0-57" class="i">+    }
</a><a href="#h5-0-58" id="h5-0-58" class="i">+
</a><a href="#h5-0-59" id="h5-0-59" class="i">+    override fun isFileExists(fileType: BridgeFileType): Boolean {
</a><a href="#h5-0-60" id="h5-0-60" class="i">+        return File(MOD_FOLDER, fileType.fileName).exists()
</a><a href="#h5-0-61" id="h5-0-61" class="i">+    }
</a><a href="#h5-0-62" id="h5-0-62" class="i">+
</a><a href="#h5-0-63" id="h5-0-63" class="i">+    override fun downloadContent(url: String, path: String): Boolean {
</a><a href="#h5-0-64" id="h5-0-64" class="i">+        return true
</a><a href="#h5-0-65" id="h5-0-65" class="i">+    }
</a><a href="#h5-0-66" id="h5-0-66" class="i">+
</a><a href="#h5-0-67" id="h5-0-67" class="i">+    override fun getMessageLoggerMessage(id: Long): ByteArray? {
</a><a href="#h5-0-68" id="h5-0-68" class="i">+        val (state, messageData) = messageLoggerWrapper.getMessage(id)
</a><a href="#h5-0-69" id="h5-0-69" class="i">+        if (state) {
</a><a href="#h5-0-70" id="h5-0-70" class="i">+            return messageData
</a><a href="#h5-0-71" id="h5-0-71" class="i">+        }
</a><a href="#h5-0-72" id="h5-0-72" class="i">+        return null
</a><a href="#h5-0-73" id="h5-0-73" class="i">+    }
</a><a href="#h5-0-74" id="h5-0-74" class="i">+
</a><a href="#h5-0-75" id="h5-0-75" class="i">+    override fun addMessageLoggerMessage(id: Long, message: ByteArray) {
</a><a href="#h5-0-76" id="h5-0-76" class="i">+        messageLoggerWrapper.addMessage(id, message)
</a><a href="#h5-0-77" id="h5-0-77" class="i">+    }
</a><a href="#h5-0-78" id="h5-0-78" class="i">+
</a><a href="#h5-0-79" id="h5-0-79" class="i">+    override fun clearMessageLogger() {
</a><a href="#h5-0-80" id="h5-0-80" class="i">+        messageLoggerWrapper.clearMessages()
</a><a href="#h5-0-81" id="h5-0-81" class="i">+    }
</a><a href="#h5-0-82" id="h5-0-82" class="i">+
</a><a href="#h5-0-83" id="h5-0-83" class="i">+    override fun fetchTranslations(): LocaleResult {
</a><a href="#h5-0-84" id="h5-0-84" class="i">+        val locale = &quot;en_US&quot;//Locale.getDefault().toString()
</a><a href="#h5-0-85" id="h5-0-85" class="i">+
</a><a href="#h5-0-86" id="h5-0-86" class="i">+        //https://github.com/LSPosed/LSPosed/blob/master/core/src/main/java/org/lsposed/lspd/util/LspModuleClassLoader.java#L36
</a><a href="#h5-0-87" id="h5-0-87" class="i">+        val moduleApk = javaClass.classLoader.javaClass.declaredFields.first { it.type == String::class.java }.let {
</a><a href="#h5-0-88" id="h5-0-88" class="i">+            it.isAccessible = true
</a><a href="#h5-0-89" id="h5-0-89" class="i">+            it.get(javaClass.classLoader) as String
</a><a href="#h5-0-90" id="h5-0-90" class="i">+        }
</a><a href="#h5-0-91" id="h5-0-91" class="i">+
</a><a href="#h5-0-92" id="h5-0-92" class="i">+        val langJsonData: ByteArray? = ZipInputStream(FileInputStream(moduleApk)).let { zip -&gt;
</a><a href="#h5-0-93" id="h5-0-93" class="i">+            while (true) {
</a><a href="#h5-0-94" id="h5-0-94" class="i">+                val entry = zip.nextEntry ?: break
</a><a href="#h5-0-95" id="h5-0-95" class="i">+                if (entry.name == &quot;assets/lang/$locale.json&quot;) {
</a><a href="#h5-0-96" id="h5-0-96" class="i">+                    return@let zip.readBytes()
</a><a href="#h5-0-97" id="h5-0-97" class="i">+                }
</a><a href="#h5-0-98" id="h5-0-98" class="i">+            }
</a><a href="#h5-0-99" id="h5-0-99" class="i">+            return@let null
</a><a href="#h5-0-100" id="h5-0-100" class="i">+        }
</a><a href="#h5-0-101" id="h5-0-101" class="i">+
</a><a href="#h5-0-102" id="h5-0-102" class="i">+        if (langJsonData != null) {
</a><a href="#h5-0-103" id="h5-0-103" class="i">+            Logger.debug(&quot;Fetched translations for $locale&quot;)
</a><a href="#h5-0-104" id="h5-0-104" class="i">+            return LocaleResult(locale, langJsonData)
</a><a href="#h5-0-105" id="h5-0-105" class="i">+        }
</a><a href="#h5-0-106" id="h5-0-106" class="i">+
</a><a href="#h5-0-107" id="h5-0-107" class="i">+        throw Throwable(&quot;Failed to fetch translations for $locale&quot;)
</a><a href="#h5-0-108" id="h5-0-108" class="i">+    }
</a><a href="#h5-0-109" id="h5-0-109" class="i">+
</a><a href="#h5-0-110" id="h5-0-110" class="i">+    private fun rootOperation(command: String): String {
</a><a href="#h5-0-111" id="h5-0-111" class="i">+        val process = Runtime.getRuntime().exec(&quot;su -c $command&quot;)
</a><a href="#h5-0-112" id="h5-0-112" class="i">+        process.waitFor()
</a><a href="#h5-0-113" id="h5-0-113" class="i">+        process.errorStream?.bufferedReader()?.let {
</a><a href="#h5-0-114" id="h5-0-114" class="i">+            val error = it.readText()
</a><a href="#h5-0-115" id="h5-0-115" class="i">+            if (error.isNotEmpty()) {
</a><a href="#h5-0-116" id="h5-0-116" class="i">+                throw Throwable(&quot;Failed to execute root operation: $error&quot;)
</a><a href="#h5-0-117" id="h5-0-117" class="i">+            }
</a><a href="#h5-0-118" id="h5-0-118" class="i">+        }
</a><a href="#h5-0-119" id="h5-0-119" class="i">+        Logger.debug(&quot;Root operation executed: $command&quot;)
</a><a href="#h5-0-120" id="h5-0-120" class="i">+        return process.inputStream.bufferedReader().readText()
</a><a href="#h5-0-121" id="h5-0-121" class="i">+    }
</a><a href="#h5-0-122" id="h5-0-122" class="i">+
</a><a href="#h5-0-123" id="h5-0-123" class="i">+    private fun openFileWritable(file: File): OutputStream {
</a><a href="#h5-0-124" id="h5-0-124" class="i">+        runCatching {
</a><a href="#h5-0-125" id="h5-0-125" class="i">+            if (!file.exists()) rootOperation(&quot;touch ${file.absolutePath}&quot;)
</a><a href="#h5-0-126" id="h5-0-126" class="i">+        }.onFailure {
</a><a href="#h5-0-127" id="h5-0-127" class="i">+            Logger.error(&quot;Failed to set file permissions: ${it.message}&quot;)
</a><a href="#h5-0-128" id="h5-0-128" class="i">+        }
</a><a href="#h5-0-129" id="h5-0-129" class="i">+
</a><a href="#h5-0-130" id="h5-0-130" class="i">+        return FileOutputStream(file)
</a><a href="#h5-0-131" id="h5-0-131" class="i">+    }
</a><a href="#h5-0-132" id="h5-0-132" class="i">+}</a><a href="#h5-0-133" id="h5-0-133" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,226 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+package me.rhunk.snapenhance.bridge.client
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+
</a><a href="#h6-0-3" id="h6-0-3" class="i">+import android.content.ComponentName
</a><a href="#h6-0-4" id="h6-0-4" class="i">+import android.content.Context
</a><a href="#h6-0-5" id="h6-0-5" class="i">+import android.content.Intent
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import android.content.ServiceConnection
</a><a href="#h6-0-7" id="h6-0-7" class="i">+import android.os.Bundle
</a><a href="#h6-0-8" id="h6-0-8" class="i">+import android.os.Handler
</a><a href="#h6-0-9" id="h6-0-9" class="i">+import android.os.HandlerThread
</a><a href="#h6-0-10" id="h6-0-10" class="i">+import android.os.IBinder
</a><a href="#h6-0-11" id="h6-0-11" class="i">+import android.os.Message
</a><a href="#h6-0-12" id="h6-0-12" class="i">+import android.os.Messenger
</a><a href="#h6-0-13" id="h6-0-13" class="i">+import me.rhunk.snapenhance.BuildConfig
</a><a href="#h6-0-14" id="h6-0-14" class="i">+import me.rhunk.snapenhance.Logger.xposedLog
</a><a href="#h6-0-15" id="h6-0-15" class="i">+import me.rhunk.snapenhance.bridge.AbstractBridgeClient
</a><a href="#h6-0-16" id="h6-0-16" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h6-0-17" id="h6-0-17" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessageType
</a><a href="#h6-0-18" id="h6-0-18" class="i">+import me.rhunk.snapenhance.bridge.common.impl.download.DownloadContentRequest
</a><a href="#h6-0-19" id="h6-0-19" class="i">+import me.rhunk.snapenhance.bridge.common.impl.download.DownloadContentResult
</a><a href="#h6-0-20" id="h6-0-20" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h6-0-21" id="h6-0-21" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.FileAccessRequest
</a><a href="#h6-0-22" id="h6-0-22" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.FileAccessResult
</a><a href="#h6-0-23" id="h6-0-23" class="i">+import me.rhunk.snapenhance.bridge.common.impl.locale.LocaleRequest
</a><a href="#h6-0-24" id="h6-0-24" class="i">+import me.rhunk.snapenhance.bridge.common.impl.locale.LocaleResult
</a><a href="#h6-0-25" id="h6-0-25" class="i">+import me.rhunk.snapenhance.bridge.common.impl.messagelogger.MessageLoggerRequest
</a><a href="#h6-0-26" id="h6-0-26" class="i">+import me.rhunk.snapenhance.bridge.common.impl.messagelogger.MessageLoggerResult
</a><a href="#h6-0-27" id="h6-0-27" class="i">+import me.rhunk.snapenhance.bridge.service.BridgeService
</a><a href="#h6-0-28" id="h6-0-28" class="i">+import java.util.concurrent.CompletableFuture
</a><a href="#h6-0-29" id="h6-0-29" class="i">+import java.util.concurrent.Executors
</a><a href="#h6-0-30" id="h6-0-30" class="i">+import kotlin.reflect.KClass
</a><a href="#h6-0-31" id="h6-0-31" class="i">+import kotlin.system.exitProcess
</a><a href="#h6-0-32" id="h6-0-32" class="i">+
</a><a href="#h6-0-33" id="h6-0-33" class="i">+
</a><a href="#h6-0-34" id="h6-0-34" class="i">+class ServiceBridgeClient: AbstractBridgeClient(), ServiceConnection {
</a><a href="#h6-0-35" id="h6-0-35" class="i">+    private val handlerThread = HandlerThread(&quot;BridgeClient&quot;)
</a><a href="#h6-0-36" id="h6-0-36" class="i">+
</a><a href="#h6-0-37" id="h6-0-37" class="i">+    private lateinit var messenger: Messenger
</a><a href="#h6-0-38" id="h6-0-38" class="i">+    private lateinit var future: CompletableFuture&lt;Boolean&gt;
</a><a href="#h6-0-39" id="h6-0-39" class="i">+
</a><a href="#h6-0-40" id="h6-0-40" class="i">+    override fun start(callback: (Boolean) -&gt; Unit) {
</a><a href="#h6-0-41" id="h6-0-41" class="i">+        this.future = CompletableFuture()
</a><a href="#h6-0-42" id="h6-0-42" class="i">+        this.handlerThread.start()
</a><a href="#h6-0-43" id="h6-0-43" class="i">+
</a><a href="#h6-0-44" id="h6-0-44" class="i">+        with(context.androidContext) {
</a><a href="#h6-0-45" id="h6-0-45" class="i">+            val intent = Intent()
</a><a href="#h6-0-46" id="h6-0-46" class="i">+                .setClassName(BuildConfig.APPLICATION_ID, BridgeService::class.java.name)
</a><a href="#h6-0-47" id="h6-0-47" class="i">+            bindService(
</a><a href="#h6-0-48" id="h6-0-48" class="i">+                intent,
</a><a href="#h6-0-49" id="h6-0-49" class="i">+                Context.BIND_AUTO_CREATE,
</a><a href="#h6-0-50" id="h6-0-50" class="i">+                Executors.newSingleThreadExecutor(),
</a><a href="#h6-0-51" id="h6-0-51" class="i">+                this@ServiceBridgeClient
</a><a href="#h6-0-52" id="h6-0-52" class="i">+            )
</a><a href="#h6-0-53" id="h6-0-53" class="i">+        }
</a><a href="#h6-0-54" id="h6-0-54" class="i">+        callback(future.get())
</a><a href="#h6-0-55" id="h6-0-55" class="i">+    }
</a><a href="#h6-0-56" id="h6-0-56" class="i">+
</a><a href="#h6-0-57" id="h6-0-57" class="i">+    private fun handleResponseMessage(
</a><a href="#h6-0-58" id="h6-0-58" class="i">+        msg: Message,
</a><a href="#h6-0-59" id="h6-0-59" class="i">+        future: CompletableFuture&lt;BridgeMessage&gt;
</a><a href="#h6-0-60" id="h6-0-60" class="i">+    ) {
</a><a href="#h6-0-61" id="h6-0-61" class="i">+        val message: BridgeMessage = when (BridgeMessageType.fromValue(msg.what)) {
</a><a href="#h6-0-62" id="h6-0-62" class="i">+            BridgeMessageType.FILE_ACCESS_RESULT -&gt; FileAccessResult()
</a><a href="#h6-0-63" id="h6-0-63" class="i">+            BridgeMessageType.DOWNLOAD_CONTENT_RESULT -&gt; DownloadContentResult()
</a><a href="#h6-0-64" id="h6-0-64" class="i">+            BridgeMessageType.MESSAGE_LOGGER_RESULT -&gt; MessageLoggerResult()
</a><a href="#h6-0-65" id="h6-0-65" class="i">+            BridgeMessageType.LOCALE_RESULT -&gt; LocaleResult()
</a><a href="#h6-0-66" id="h6-0-66" class="i">+            else -&gt; {
</a><a href="#h6-0-67" id="h6-0-67" class="i">+                future.completeExceptionally(IllegalStateException(&quot;Unknown message type: ${msg.what}&quot;))
</a><a href="#h6-0-68" id="h6-0-68" class="i">+                return
</a><a href="#h6-0-69" id="h6-0-69" class="i">+            }
</a><a href="#h6-0-70" id="h6-0-70" class="i">+        }
</a><a href="#h6-0-71" id="h6-0-71" class="i">+
</a><a href="#h6-0-72" id="h6-0-72" class="i">+        with(message) {
</a><a href="#h6-0-73" id="h6-0-73" class="i">+            read(msg.data)
</a><a href="#h6-0-74" id="h6-0-74" class="i">+            future.complete(this)
</a><a href="#h6-0-75" id="h6-0-75" class="i">+        }
</a><a href="#h6-0-76" id="h6-0-76" class="i">+    }
</a><a href="#h6-0-77" id="h6-0-77" class="i">+
</a><a href="#h6-0-78" id="h6-0-78" class="i">+    @Suppress(&quot;UNCHECKED_CAST&quot;, &quot;UNUSED_PARAMETER&quot;)
</a><a href="#h6-0-79" id="h6-0-79" class="i">+    private fun &lt;T : BridgeMessage&gt; sendMessage(
</a><a href="#h6-0-80" id="h6-0-80" class="i">+        messageType: BridgeMessageType,
</a><a href="#h6-0-81" id="h6-0-81" class="i">+        message: BridgeMessage,
</a><a href="#h6-0-82" id="h6-0-82" class="i">+        resultType: KClass&lt;T&gt;? = null
</a><a href="#h6-0-83" id="h6-0-83" class="i">+    ): T {
</a><a href="#h6-0-84" id="h6-0-84" class="i">+        val future = CompletableFuture&lt;BridgeMessage&gt;()
</a><a href="#h6-0-85" id="h6-0-85" class="i">+
</a><a href="#h6-0-86" id="h6-0-86" class="i">+        val replyMessenger = Messenger(object : Handler(handlerThread.looper) {
</a><a href="#h6-0-87" id="h6-0-87" class="i">+            override fun handleMessage(msg: Message) {
</a><a href="#h6-0-88" id="h6-0-88" class="i">+                handleResponseMessage(msg, future)
</a><a href="#h6-0-89" id="h6-0-89" class="i">+            }
</a><a href="#h6-0-90" id="h6-0-90" class="i">+        })
</a><a href="#h6-0-91" id="h6-0-91" class="i">+
</a><a href="#h6-0-92" id="h6-0-92" class="i">+        runCatching {
</a><a href="#h6-0-93" id="h6-0-93" class="i">+            with(Message.obtain()) {
</a><a href="#h6-0-94" id="h6-0-94" class="i">+                what = messageType.value
</a><a href="#h6-0-95" id="h6-0-95" class="i">+                replyTo = replyMessenger
</a><a href="#h6-0-96" id="h6-0-96" class="i">+                data = Bundle()
</a><a href="#h6-0-97" id="h6-0-97" class="i">+                message.write(data)
</a><a href="#h6-0-98" id="h6-0-98" class="i">+                messenger.send(this)
</a><a href="#h6-0-99" id="h6-0-99" class="i">+            }
</a><a href="#h6-0-100" id="h6-0-100" class="i">+        }
</a><a href="#h6-0-101" id="h6-0-101" class="i">+
</a><a href="#h6-0-102" id="h6-0-102" class="i">+        return future.get() as T
</a><a href="#h6-0-103" id="h6-0-103" class="i">+    }
</a><a href="#h6-0-104" id="h6-0-104" class="i">+
</a><a href="#h6-0-105" id="h6-0-105" class="i">+    override fun createAndReadFile(
</a><a href="#h6-0-106" id="h6-0-106" class="i">+        fileType: BridgeFileType,
</a><a href="#h6-0-107" id="h6-0-107" class="i">+        defaultContent: ByteArray
</a><a href="#h6-0-108" id="h6-0-108" class="i">+    ): ByteArray {
</a><a href="#h6-0-109" id="h6-0-109" class="i">+        sendMessage(
</a><a href="#h6-0-110" id="h6-0-110" class="i">+            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h6-0-111" id="h6-0-111" class="i">+            FileAccessRequest(FileAccessRequest.FileAccessAction.EXISTS, fileType, null),
</a><a href="#h6-0-112" id="h6-0-112" class="i">+            FileAccessResult::class
</a><a href="#h6-0-113" id="h6-0-113" class="i">+        ).run {
</a><a href="#h6-0-114" id="h6-0-114" class="i">+            if (state!!) {
</a><a href="#h6-0-115" id="h6-0-115" class="i">+                return readFile(fileType)
</a><a href="#h6-0-116" id="h6-0-116" class="i">+            }
</a><a href="#h6-0-117" id="h6-0-117" class="i">+            writeFile(fileType, defaultContent)
</a><a href="#h6-0-118" id="h6-0-118" class="i">+            return defaultContent
</a><a href="#h6-0-119" id="h6-0-119" class="i">+        }
</a><a href="#h6-0-120" id="h6-0-120" class="i">+    }
</a><a href="#h6-0-121" id="h6-0-121" class="i">+
</a><a href="#h6-0-122" id="h6-0-122" class="i">+    override fun readFile(fileType: BridgeFileType): ByteArray {
</a><a href="#h6-0-123" id="h6-0-123" class="i">+        sendMessage(
</a><a href="#h6-0-124" id="h6-0-124" class="i">+            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h6-0-125" id="h6-0-125" class="i">+            FileAccessRequest(FileAccessRequest.FileAccessAction.READ, fileType, null),
</a><a href="#h6-0-126" id="h6-0-126" class="i">+            FileAccessResult::class
</a><a href="#h6-0-127" id="h6-0-127" class="i">+        ).run {
</a><a href="#h6-0-128" id="h6-0-128" class="i">+            return content!!
</a><a href="#h6-0-129" id="h6-0-129" class="i">+        }
</a><a href="#h6-0-130" id="h6-0-130" class="i">+    }
</a><a href="#h6-0-131" id="h6-0-131" class="i">+
</a><a href="#h6-0-132" id="h6-0-132" class="i">+    override fun writeFile(
</a><a href="#h6-0-133" id="h6-0-133" class="i">+        fileType: BridgeFileType,
</a><a href="#h6-0-134" id="h6-0-134" class="i">+        content: ByteArray?
</a><a href="#h6-0-135" id="h6-0-135" class="i">+    ): Boolean {
</a><a href="#h6-0-136" id="h6-0-136" class="i">+        sendMessage(
</a><a href="#h6-0-137" id="h6-0-137" class="i">+            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h6-0-138" id="h6-0-138" class="i">+            FileAccessRequest(FileAccessRequest.FileAccessAction.WRITE, fileType, content),
</a><a href="#h6-0-139" id="h6-0-139" class="i">+            FileAccessResult::class
</a><a href="#h6-0-140" id="h6-0-140" class="i">+        ).run {
</a><a href="#h6-0-141" id="h6-0-141" class="i">+            return state!!
</a><a href="#h6-0-142" id="h6-0-142" class="i">+        }
</a><a href="#h6-0-143" id="h6-0-143" class="i">+    }
</a><a href="#h6-0-144" id="h6-0-144" class="i">+
</a><a href="#h6-0-145" id="h6-0-145" class="i">+    override fun deleteFile(fileType: BridgeFileType): Boolean {
</a><a href="#h6-0-146" id="h6-0-146" class="i">+        sendMessage(
</a><a href="#h6-0-147" id="h6-0-147" class="i">+            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h6-0-148" id="h6-0-148" class="i">+            FileAccessRequest(FileAccessRequest.FileAccessAction.DELETE, fileType, null),
</a><a href="#h6-0-149" id="h6-0-149" class="i">+            FileAccessResult::class
</a><a href="#h6-0-150" id="h6-0-150" class="i">+        ).run {
</a><a href="#h6-0-151" id="h6-0-151" class="i">+            return state!!
</a><a href="#h6-0-152" id="h6-0-152" class="i">+        }
</a><a href="#h6-0-153" id="h6-0-153" class="i">+    }
</a><a href="#h6-0-154" id="h6-0-154" class="i">+
</a><a href="#h6-0-155" id="h6-0-155" class="i">+
</a><a href="#h6-0-156" id="h6-0-156" class="i">+    override fun isFileExists(fileType: BridgeFileType): Boolean {
</a><a href="#h6-0-157" id="h6-0-157" class="i">+        sendMessage(
</a><a href="#h6-0-158" id="h6-0-158" class="i">+            BridgeMessageType.FILE_ACCESS_REQUEST,
</a><a href="#h6-0-159" id="h6-0-159" class="i">+            FileAccessRequest(FileAccessRequest.FileAccessAction.EXISTS, fileType, null),
</a><a href="#h6-0-160" id="h6-0-160" class="i">+            FileAccessResult::class
</a><a href="#h6-0-161" id="h6-0-161" class="i">+        ).run {
</a><a href="#h6-0-162" id="h6-0-162" class="i">+            return state!!
</a><a href="#h6-0-163" id="h6-0-163" class="i">+        }
</a><a href="#h6-0-164" id="h6-0-164" class="i">+    }
</a><a href="#h6-0-165" id="h6-0-165" class="i">+
</a><a href="#h6-0-166" id="h6-0-166" class="i">+    override fun downloadContent(url: String, path: String): Boolean {
</a><a href="#h6-0-167" id="h6-0-167" class="i">+        sendMessage(
</a><a href="#h6-0-168" id="h6-0-168" class="i">+            BridgeMessageType.DOWNLOAD_CONTENT_REQUEST,
</a><a href="#h6-0-169" id="h6-0-169" class="i">+            DownloadContentRequest(url, path),
</a><a href="#h6-0-170" id="h6-0-170" class="i">+            DownloadContentResult::class
</a><a href="#h6-0-171" id="h6-0-171" class="i">+        ).run {
</a><a href="#h6-0-172" id="h6-0-172" class="i">+            return state!!
</a><a href="#h6-0-173" id="h6-0-173" class="i">+        }
</a><a href="#h6-0-174" id="h6-0-174" class="i">+    }
</a><a href="#h6-0-175" id="h6-0-175" class="i">+
</a><a href="#h6-0-176" id="h6-0-176" class="i">+    override fun getMessageLoggerMessage(id: Long): ByteArray? {
</a><a href="#h6-0-177" id="h6-0-177" class="i">+        sendMessage(
</a><a href="#h6-0-178" id="h6-0-178" class="i">+            BridgeMessageType.MESSAGE_LOGGER_REQUEST,
</a><a href="#h6-0-179" id="h6-0-179" class="i">+            MessageLoggerRequest(MessageLoggerRequest.Action.GET, id),
</a><a href="#h6-0-180" id="h6-0-180" class="i">+            MessageLoggerResult::class
</a><a href="#h6-0-181" id="h6-0-181" class="i">+        ).run {
</a><a href="#h6-0-182" id="h6-0-182" class="i">+            return message
</a><a href="#h6-0-183" id="h6-0-183" class="i">+        }
</a><a href="#h6-0-184" id="h6-0-184" class="i">+    }
</a><a href="#h6-0-185" id="h6-0-185" class="i">+
</a><a href="#h6-0-186" id="h6-0-186" class="i">+    override fun addMessageLoggerMessage(id: Long, message: ByteArray) {
</a><a href="#h6-0-187" id="h6-0-187" class="i">+        sendMessage(
</a><a href="#h6-0-188" id="h6-0-188" class="i">+            BridgeMessageType.MESSAGE_LOGGER_REQUEST,
</a><a href="#h6-0-189" id="h6-0-189" class="i">+            MessageLoggerRequest(MessageLoggerRequest.Action.ADD, id, message),
</a><a href="#h6-0-190" id="h6-0-190" class="i">+            MessageLoggerResult::class
</a><a href="#h6-0-191" id="h6-0-191" class="i">+        )
</a><a href="#h6-0-192" id="h6-0-192" class="i">+    }
</a><a href="#h6-0-193" id="h6-0-193" class="i">+
</a><a href="#h6-0-194" id="h6-0-194" class="i">+    override fun clearMessageLogger() {
</a><a href="#h6-0-195" id="h6-0-195" class="i">+        sendMessage(
</a><a href="#h6-0-196" id="h6-0-196" class="i">+            BridgeMessageType.MESSAGE_LOGGER_REQUEST,
</a><a href="#h6-0-197" id="h6-0-197" class="i">+            MessageLoggerRequest(MessageLoggerRequest.Action.CLEAR, 0),
</a><a href="#h6-0-198" id="h6-0-198" class="i">+            MessageLoggerResult::class
</a><a href="#h6-0-199" id="h6-0-199" class="i">+        )
</a><a href="#h6-0-200" id="h6-0-200" class="i">+    }
</a><a href="#h6-0-201" id="h6-0-201" class="i">+
</a><a href="#h6-0-202" id="h6-0-202" class="i">+    override fun fetchTranslations(): LocaleResult {
</a><a href="#h6-0-203" id="h6-0-203" class="i">+        sendMessage(
</a><a href="#h6-0-204" id="h6-0-204" class="i">+            BridgeMessageType.LOCALE_REQUEST,
</a><a href="#h6-0-205" id="h6-0-205" class="i">+            LocaleRequest(),
</a><a href="#h6-0-206" id="h6-0-206" class="i">+            LocaleResult::class
</a><a href="#h6-0-207" id="h6-0-207" class="i">+        ).run {
</a><a href="#h6-0-208" id="h6-0-208" class="i">+            return this
</a><a href="#h6-0-209" id="h6-0-209" class="i">+        }
</a><a href="#h6-0-210" id="h6-0-210" class="i">+    }
</a><a href="#h6-0-211" id="h6-0-211" class="i">+
</a><a href="#h6-0-212" id="h6-0-212" class="i">+    override fun onServiceConnected(name: ComponentName, service: IBinder) {
</a><a href="#h6-0-213" id="h6-0-213" class="i">+        messenger = Messenger(service)
</a><a href="#h6-0-214" id="h6-0-214" class="i">+        future.complete(true)
</a><a href="#h6-0-215" id="h6-0-215" class="i">+    }
</a><a href="#h6-0-216" id="h6-0-216" class="i">+
</a><a href="#h6-0-217" id="h6-0-217" class="i">+    override fun onNullBinding(name: ComponentName) {
</a><a href="#h6-0-218" id="h6-0-218" class="i">+        xposedLog(&quot;failed to connect to bridge service&quot;)
</a><a href="#h6-0-219" id="h6-0-219" class="i">+        future.complete(false)
</a><a href="#h6-0-220" id="h6-0-220" class="i">+    }
</a><a href="#h6-0-221" id="h6-0-221" class="i">+
</a><a href="#h6-0-222" id="h6-0-222" class="i">+    override fun onServiceDisconnected(name: ComponentName) {
</a><a href="#h6-0-223" id="h6-0-223" class="i">+        exitProcess(0)
</a><a href="#h6-0-224" id="h6-0-224" class="i">+    }
</a><a href="#h6-0-225" id="h6-0-225" class="i">+}
</a><b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentRequest.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,20 +0,0 @@
</a><a href="#h7-0-0" id="h7-0-0" class="d">-package me.rhunk.snapenhance.bridge.common.impl
</a><a href="#h7-0-1" id="h7-0-1" class="d">-
</a><a href="#h7-0-2" id="h7-0-2" class="d">-import android.os.Bundle
</a><a href="#h7-0-3" id="h7-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h7-0-4" id="h7-0-4" class="d">-
</a><a href="#h7-0-5" id="h7-0-5" class="d">-class DownloadContentRequest(
</a><a href="#h7-0-6" id="h7-0-6" class="d">-    var url: String? = null,
</a><a href="#h7-0-7" id="h7-0-7" class="d">-    var path: String? = null
</a><a href="#h7-0-8" id="h7-0-8" class="d">-) : BridgeMessage() {
</a><a href="#h7-0-9" id="h7-0-9" class="d">-
</a><a href="#h7-0-10" id="h7-0-10" class="d">-    override fun write(bundle: Bundle) {
</a><a href="#h7-0-11" id="h7-0-11" class="d">-        bundle.putString(&quot;url&quot;, url)
</a><a href="#h7-0-12" id="h7-0-12" class="d">-        bundle.putString(&quot;path&quot;, path)
</a><a href="#h7-0-13" id="h7-0-13" class="d">-    }
</a><a href="#h7-0-14" id="h7-0-14" class="d">-
</a><a href="#h7-0-15" id="h7-0-15" class="d">-    override fun read(bundle: Bundle) {
</a><a href="#h7-0-16" id="h7-0-16" class="d">-        url = bundle.getString(&quot;url&quot;)
</a><a href="#h7-0-17" id="h7-0-17" class="d">-        path = bundle.getString(&quot;path&quot;)
</a><a href="#h7-0-18" id="h7-0-18" class="d">-    }
</a><a href="#h7-0-19" id="h7-0-19" class="d">-}
</a><b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentResult.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/DownloadContentResult.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,17 +0,0 @@
</a><a href="#h8-0-0" id="h8-0-0" class="d">-package me.rhunk.snapenhance.bridge.common.impl
</a><a href="#h8-0-1" id="h8-0-1" class="d">-
</a><a href="#h8-0-2" id="h8-0-2" class="d">-import android.os.Bundle
</a><a href="#h8-0-3" id="h8-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h8-0-4" id="h8-0-4" class="d">-
</a><a href="#h8-0-5" id="h8-0-5" class="d">-class DownloadContentResult(
</a><a href="#h8-0-6" id="h8-0-6" class="d">-    var state: Boolean? = null
</a><a href="#h8-0-7" id="h8-0-7" class="d">-) : BridgeMessage() {
</a><a href="#h8-0-8" id="h8-0-8" class="d">-
</a><a href="#h8-0-9" id="h8-0-9" class="d">-    override fun write(bundle: Bundle) {
</a><a href="#h8-0-10" id="h8-0-10" class="d">-        bundle.putBoolean(&quot;state&quot;, state!!)
</a><a href="#h8-0-11" id="h8-0-11" class="d">-    }
</a><a href="#h8-0-12" id="h8-0-12" class="d">-
</a><a href="#h8-0-13" id="h8-0-13" class="d">-    override fun read(bundle: Bundle) {
</a><a href="#h8-0-14" id="h8-0-14" class="d">-        state = bundle.getBoolean(&quot;state&quot;)
</a><a href="#h8-0-15" id="h8-0-15" class="d">-    }
</a><a href="#h8-0-16" id="h8-0-16" class="d">-}
</a><b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessRequest.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,43 +0,0 @@
</a><a href="#h9-0-0" id="h9-0-0" class="d">-package me.rhunk.snapenhance.bridge.common.impl
</a><a href="#h9-0-1" id="h9-0-1" class="d">-
</a><a href="#h9-0-2" id="h9-0-2" class="d">-import android.os.Bundle
</a><a href="#h9-0-3" id="h9-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h9-0-4" id="h9-0-4" class="d">-
</a><a href="#h9-0-5" id="h9-0-5" class="d">-class FileAccessRequest(
</a><a href="#h9-0-6" id="h9-0-6" class="d">-    var action: FileAccessAction? = null,
</a><a href="#h9-0-7" id="h9-0-7" class="d">-    var fileType: FileType? = null,
</a><a href="#h9-0-8" id="h9-0-8" class="d">-    var content: ByteArray? = null
</a><a href="#h9-0-9" id="h9-0-9" class="d">-) : BridgeMessage() {
</a><a href="#h9-0-10" id="h9-0-10" class="d">-
</a><a href="#h9-0-11" id="h9-0-11" class="d">-    override fun write(bundle: Bundle) {
</a><a href="#h9-0-12" id="h9-0-12" class="d">-        bundle.putInt(&quot;action&quot;, action!!.value)
</a><a href="#h9-0-13" id="h9-0-13" class="d">-        bundle.putInt(&quot;fileType&quot;, fileType!!.value)
</a><a href="#h9-0-14" id="h9-0-14" class="d">-        bundle.putByteArray(&quot;content&quot;, content)
</a><a href="#h9-0-15" id="h9-0-15" class="d">-    }
</a><a href="#h9-0-16" id="h9-0-16" class="d">-
</a><a href="#h9-0-17" id="h9-0-17" class="d">-    override fun read(bundle: Bundle) {
</a><a href="#h9-0-18" id="h9-0-18" class="d">-        action = FileAccessAction.fromValue(bundle.getInt(&quot;action&quot;))
</a><a href="#h9-0-19" id="h9-0-19" class="d">-        fileType = FileType.fromValue(bundle.getInt(&quot;fileType&quot;))
</a><a href="#h9-0-20" id="h9-0-20" class="d">-        content = bundle.getByteArray(&quot;content&quot;)
</a><a href="#h9-0-21" id="h9-0-21" class="d">-    }
</a><a href="#h9-0-22" id="h9-0-22" class="d">-
</a><a href="#h9-0-23" id="h9-0-23" class="d">-    enum class FileType(val value: Int) {
</a><a href="#h9-0-24" id="h9-0-24" class="d">-        CONFIG(0), MAPPINGS(1), STEALTH(2), ANTI_AUTO_DOWNLOAD(3);
</a><a href="#h9-0-25" id="h9-0-25" class="d">-
</a><a href="#h9-0-26" id="h9-0-26" class="d">-        companion object {
</a><a href="#h9-0-27" id="h9-0-27" class="d">-            fun fromValue(value: Int): FileType? {
</a><a href="#h9-0-28" id="h9-0-28" class="d">-                return values().firstOrNull { it.value == value }
</a><a href="#h9-0-29" id="h9-0-29" class="d">-            }
</a><a href="#h9-0-30" id="h9-0-30" class="d">-        }
</a><a href="#h9-0-31" id="h9-0-31" class="d">-    }
</a><a href="#h9-0-32" id="h9-0-32" class="d">-
</a><a href="#h9-0-33" id="h9-0-33" class="d">-    enum class FileAccessAction(val value: Int) {
</a><a href="#h9-0-34" id="h9-0-34" class="d">-        READ(0), WRITE(1), DELETE(2), EXISTS(3);
</a><a href="#h9-0-35" id="h9-0-35" class="d">-
</a><a href="#h9-0-36" id="h9-0-36" class="d">-        companion object {
</a><a href="#h9-0-37" id="h9-0-37" class="d">-            fun fromValue(value: Int): FileAccessAction? {
</a><a href="#h9-0-38" id="h9-0-38" class="d">-                return values().firstOrNull { it.value == value }
</a><a href="#h9-0-39" id="h9-0-39" class="d">-            }
</a><a href="#h9-0-40" id="h9-0-40" class="d">-        }
</a><a href="#h9-0-41" id="h9-0-41" class="d">-    }
</a><a href="#h9-0-42" id="h9-0-42" class="d">-}
</a><b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessResult.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/FileAccessResult.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,20 +0,0 @@
</a><a href="#h10-0-0" id="h10-0-0" class="d">-package me.rhunk.snapenhance.bridge.common.impl
</a><a href="#h10-0-1" id="h10-0-1" class="d">-
</a><a href="#h10-0-2" id="h10-0-2" class="d">-import android.os.Bundle
</a><a href="#h10-0-3" id="h10-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h10-0-4" id="h10-0-4" class="d">-
</a><a href="#h10-0-5" id="h10-0-5" class="d">-class FileAccessResult(
</a><a href="#h10-0-6" id="h10-0-6" class="d">-    var state: Boolean? = null,
</a><a href="#h10-0-7" id="h10-0-7" class="d">-    var content: ByteArray? = null
</a><a href="#h10-0-8" id="h10-0-8" class="d">-) : BridgeMessage() {
</a><a href="#h10-0-9" id="h10-0-9" class="d">-
</a><a href="#h10-0-10" id="h10-0-10" class="d">-    override fun write(bundle: Bundle) {
</a><a href="#h10-0-11" id="h10-0-11" class="d">-        bundle.putBoolean(&quot;state&quot;, state!!)
</a><a href="#h10-0-12" id="h10-0-12" class="d">-        bundle.putByteArray(&quot;content&quot;, content)
</a><a href="#h10-0-13" id="h10-0-13" class="d">-    }
</a><a href="#h10-0-14" id="h10-0-14" class="d">-
</a><a href="#h10-0-15" id="h10-0-15" class="d">-    override fun read(bundle: Bundle) {
</a><a href="#h10-0-16" id="h10-0-16" class="d">-        state = bundle.getBoolean(&quot;state&quot;)
</a><a href="#h10-0-17" id="h10-0-17" class="d">-        content = bundle.getByteArray(&quot;content&quot;)
</a><a href="#h10-0-18" id="h10-0-18" class="d">-    }
</a><a href="#h10-0-19" id="h10-0-19" class="d">-}
</a><b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleRequest.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,12 +0,0 @@
</a><a href="#h11-0-0" id="h11-0-0" class="d">-package me.rhunk.snapenhance.bridge.common.impl
</a><a href="#h11-0-1" id="h11-0-1" class="d">-
</a><a href="#h11-0-2" id="h11-0-2" class="d">-import android.os.Bundle
</a><a href="#h11-0-3" id="h11-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h11-0-4" id="h11-0-4" class="d">-
</a><a href="#h11-0-5" id="h11-0-5" class="d">-class LocaleRequest() : BridgeMessage() {
</a><a href="#h11-0-6" id="h11-0-6" class="d">-    override fun write(bundle: Bundle) {
</a><a href="#h11-0-7" id="h11-0-7" class="d">-    }
</a><a href="#h11-0-8" id="h11-0-8" class="d">-
</a><a href="#h11-0-9" id="h11-0-9" class="d">-    override fun read(bundle: Bundle) {
</a><a href="#h11-0-10" id="h11-0-10" class="d">-    }
</a><a href="#h11-0-11" id="h11-0-11" class="d">-}</a><a href="#h11-0-12" id="h11-0-12" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleResult.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/LocaleResult.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,19 +0,0 @@
</a><a href="#h12-0-0" id="h12-0-0" class="d">-package me.rhunk.snapenhance.bridge.common.impl
</a><a href="#h12-0-1" id="h12-0-1" class="d">-
</a><a href="#h12-0-2" id="h12-0-2" class="d">-import android.os.Bundle
</a><a href="#h12-0-3" id="h12-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h12-0-4" id="h12-0-4" class="d">-
</a><a href="#h12-0-5" id="h12-0-5" class="d">-class LocaleResult(
</a><a href="#h12-0-6" id="h12-0-6" class="d">-    var locale: String? = null,
</a><a href="#h12-0-7" id="h12-0-7" class="d">-    var content: ByteArray? = null
</a><a href="#h12-0-8" id="h12-0-8" class="d">-) : BridgeMessage(){
</a><a href="#h12-0-9" id="h12-0-9" class="d">-    override fun write(bundle: Bundle) {
</a><a href="#h12-0-10" id="h12-0-10" class="d">-        bundle.putString(&quot;locale&quot;, locale)
</a><a href="#h12-0-11" id="h12-0-11" class="d">-        bundle.putByteArray(&quot;content&quot;, content)
</a><a href="#h12-0-12" id="h12-0-12" class="d">-    }
</a><a href="#h12-0-13" id="h12-0-13" class="d">-
</a><a href="#h12-0-14" id="h12-0-14" class="d">-    override fun read(bundle: Bundle) {
</a><a href="#h12-0-15" id="h12-0-15" class="d">-        locale = bundle.getString(&quot;locale&quot;)
</a><a href="#h12-0-16" id="h12-0-16" class="d">-        content = bundle.getByteArray(&quot;content&quot;)
</a><a href="#h12-0-17" id="h12-0-17" class="d">-    }
</a><a href="#h12-0-18" id="h12-0-18" class="d">-}</a><a href="#h12-0-19" id="h12-0-19" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h13" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerRequest.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,29 +0,0 @@
</a><a href="#h13-0-0" id="h13-0-0" class="d">-package me.rhunk.snapenhance.bridge.common.impl
</a><a href="#h13-0-1" id="h13-0-1" class="d">-
</a><a href="#h13-0-2" id="h13-0-2" class="d">-import android.os.Bundle
</a><a href="#h13-0-3" id="h13-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h13-0-4" id="h13-0-4" class="d">-
</a><a href="#h13-0-5" id="h13-0-5" class="d">-class MessageLoggerRequest(
</a><a href="#h13-0-6" id="h13-0-6" class="d">-    var action: Action? = null,
</a><a href="#h13-0-7" id="h13-0-7" class="d">-    var messageId: Long? = null,
</a><a href="#h13-0-8" id="h13-0-8" class="d">-    var message: ByteArray? = null
</a><a href="#h13-0-9" id="h13-0-9" class="d">-) : BridgeMessage(){
</a><a href="#h13-0-10" id="h13-0-10" class="d">-
</a><a href="#h13-0-11" id="h13-0-11" class="d">-    override fun write(bundle: Bundle) {
</a><a href="#h13-0-12" id="h13-0-12" class="d">-        bundle.putString(&quot;action&quot;, action!!.name)
</a><a href="#h13-0-13" id="h13-0-13" class="d">-        bundle.putLong(&quot;messageId&quot;, messageId!!)
</a><a href="#h13-0-14" id="h13-0-14" class="d">-        bundle.putByteArray(&quot;message&quot;, message)
</a><a href="#h13-0-15" id="h13-0-15" class="d">-    }
</a><a href="#h13-0-16" id="h13-0-16" class="d">-
</a><a href="#h13-0-17" id="h13-0-17" class="d">-    override fun read(bundle: Bundle) {
</a><a href="#h13-0-18" id="h13-0-18" class="d">-        action = Action.valueOf(bundle.getString(&quot;action&quot;)!!)
</a><a href="#h13-0-19" id="h13-0-19" class="d">-        messageId = bundle.getLong(&quot;messageId&quot;)
</a><a href="#h13-0-20" id="h13-0-20" class="d">-        message = bundle.getByteArray(&quot;message&quot;)
</a><a href="#h13-0-21" id="h13-0-21" class="d">-    }
</a><a href="#h13-0-22" id="h13-0-22" class="d">-
</a><a href="#h13-0-23" id="h13-0-23" class="d">-    enum class Action {
</a><a href="#h13-0-24" id="h13-0-24" class="d">-        ADD,
</a><a href="#h13-0-25" id="h13-0-25" class="d">-        GET,
</a><a href="#h13-0-26" id="h13-0-26" class="d">-        CLEAR
</a><a href="#h13-0-27" id="h13-0-27" class="d">-    }
</a><a href="#h13-0-28" id="h13-0-28" class="d">-}</a><a href="#h13-0-29" id="h13-0-29" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerResult.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/MessageLoggerResult.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,20 +0,0 @@
</a><a href="#h14-0-0" id="h14-0-0" class="d">-package me.rhunk.snapenhance.bridge.common.impl
</a><a href="#h14-0-1" id="h14-0-1" class="d">-
</a><a href="#h14-0-2" id="h14-0-2" class="d">-import android.os.Bundle
</a><a href="#h14-0-3" id="h14-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h14-0-4" id="h14-0-4" class="d">-
</a><a href="#h14-0-5" id="h14-0-5" class="d">-class MessageLoggerResult(
</a><a href="#h14-0-6" id="h14-0-6" class="d">-    var state: Boolean? = null,
</a><a href="#h14-0-7" id="h14-0-7" class="d">-    var message: ByteArray? = null
</a><a href="#h14-0-8" id="h14-0-8" class="d">-) : BridgeMessage() {
</a><a href="#h14-0-9" id="h14-0-9" class="d">-
</a><a href="#h14-0-10" id="h14-0-10" class="d">-    override fun write(bundle: Bundle) {
</a><a href="#h14-0-11" id="h14-0-11" class="d">-        bundle.putBoolean(&quot;state&quot;, state!!)
</a><a href="#h14-0-12" id="h14-0-12" class="d">-        bundle.putByteArray(&quot;message&quot;, message)
</a><a href="#h14-0-13" id="h14-0-13" class="d">-    }
</a><a href="#h14-0-14" id="h14-0-14" class="d">-
</a><a href="#h14-0-15" id="h14-0-15" class="d">-    override fun read(bundle: Bundle) {
</a><a href="#h14-0-16" id="h14-0-16" class="d">-        state = bundle.getBoolean(&quot;state&quot;)
</a><a href="#h14-0-17" id="h14-0-17" class="d">-        message = bundle.getByteArray(&quot;message&quot;)
</a><a href="#h14-0-18" id="h14-0-18" class="d">-    }
</a><a href="#h14-0-19" id="h14-0-19" class="d">-}</a><a href="#h14-0-20" id="h14-0-20" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentRequest.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.download
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+import android.os.Bundle
</a><a href="#h15-0-3" id="h15-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h15-0-4" id="h15-0-4" class="i">+
</a><a href="#h15-0-5" id="h15-0-5" class="i">+class DownloadContentRequest(
</a><a href="#h15-0-6" id="h15-0-6" class="i">+    var url: String? = null,
</a><a href="#h15-0-7" id="h15-0-7" class="i">+    var path: String? = null
</a><a href="#h15-0-8" id="h15-0-8" class="i">+) : BridgeMessage() {
</a><a href="#h15-0-9" id="h15-0-9" class="i">+
</a><a href="#h15-0-10" id="h15-0-10" class="i">+    override fun write(bundle: Bundle) {
</a><a href="#h15-0-11" id="h15-0-11" class="i">+        bundle.putString(&quot;url&quot;, url)
</a><a href="#h15-0-12" id="h15-0-12" class="i">+        bundle.putString(&quot;path&quot;, path)
</a><a href="#h15-0-13" id="h15-0-13" class="i">+    }
</a><a href="#h15-0-14" id="h15-0-14" class="i">+
</a><a href="#h15-0-15" id="h15-0-15" class="i">+    override fun read(bundle: Bundle) {
</a><a href="#h15-0-16" id="h15-0-16" class="i">+        url = bundle.getString(&quot;url&quot;)
</a><a href="#h15-0-17" id="h15-0-17" class="i">+        path = bundle.getString(&quot;path&quot;)
</a><a href="#h15-0-18" id="h15-0-18" class="i">+    }
</a><a href="#h15-0-19" id="h15-0-19" class="i">+}
</a><b>diff --git a/<a id="h16" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentResult.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/download/DownloadContentResult.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h16-0-0" id="h16-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.download
</a><a href="#h16-0-1" id="h16-0-1" class="i">+
</a><a href="#h16-0-2" id="h16-0-2" class="i">+import android.os.Bundle
</a><a href="#h16-0-3" id="h16-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h16-0-4" id="h16-0-4" class="i">+
</a><a href="#h16-0-5" id="h16-0-5" class="i">+class DownloadContentResult(
</a><a href="#h16-0-6" id="h16-0-6" class="i">+    var state: Boolean? = null
</a><a href="#h16-0-7" id="h16-0-7" class="i">+) : BridgeMessage() {
</a><a href="#h16-0-8" id="h16-0-8" class="i">+
</a><a href="#h16-0-9" id="h16-0-9" class="i">+    override fun write(bundle: Bundle) {
</a><a href="#h16-0-10" id="h16-0-10" class="i">+        bundle.putBoolean(&quot;state&quot;, state!!)
</a><a href="#h16-0-11" id="h16-0-11" class="i">+    }
</a><a href="#h16-0-12" id="h16-0-12" class="i">+
</a><a href="#h16-0-13" id="h16-0-13" class="i">+    override fun read(bundle: Bundle) {
</a><a href="#h16-0-14" id="h16-0-14" class="i">+        state = bundle.getBoolean(&quot;state&quot;)
</a><a href="#h16-0-15" id="h16-0-15" class="i">+    }
</a><a href="#h16-0-16" id="h16-0-16" class="i">+}
</a><b>diff --git a/<a id="h17" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h17-0-0" id="h17-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.file
</a><a href="#h17-0-1" id="h17-0-1" class="i">+
</a><a href="#h17-0-2" id="h17-0-2" class="i">+
</a><a href="#h17-0-3" id="h17-0-3" class="i">+enum class BridgeFileType(val value: Int, val fileName: String, val isDatabase: Boolean = false) {
</a><a href="#h17-0-4" id="h17-0-4" class="i">+    CONFIG(0, &quot;config.json&quot;),
</a><a href="#h17-0-5" id="h17-0-5" class="i">+    MAPPINGS(1, &quot;mappings.json&quot;),
</a><a href="#h17-0-6" id="h17-0-6" class="i">+    MESSAGE_LOGGER_DATABASE(2, &quot;message_logger.db&quot;, true),
</a><a href="#h17-0-7" id="h17-0-7" class="i">+    STEALTH(3, &quot;stealth.txt&quot;),
</a><a href="#h17-0-8" id="h17-0-8" class="i">+    ANTI_AUTO_DOWNLOAD(4, &quot;anti_auto_download.txt&quot;),
</a><a href="#h17-0-9" id="h17-0-9" class="i">+    ANTI_AUTO_SAVE(5, &quot;anti_auto_save.txt&quot;);
</a><a href="#h17-0-10" id="h17-0-10" class="i">+
</a><a href="#h17-0-11" id="h17-0-11" class="i">+    companion object {
</a><a href="#h17-0-12" id="h17-0-12" class="i">+        fun fromValue(value: Int): BridgeFileType? {
</a><a href="#h17-0-13" id="h17-0-13" class="i">+            return values().firstOrNull { it.value == value }
</a><a href="#h17-0-14" id="h17-0-14" class="i">+        }
</a><a href="#h17-0-15" id="h17-0-15" class="i">+    }
</a><a href="#h17-0-16" id="h17-0-16" class="i">+}</a><a href="#h17-0-17" id="h17-0-17" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessRequest.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -0,0 +1,33 @@
</a><a href="#h18-0-0" id="h18-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.file
</a><a href="#h18-0-1" id="h18-0-1" class="i">+
</a><a href="#h18-0-2" id="h18-0-2" class="i">+import android.os.Bundle
</a><a href="#h18-0-3" id="h18-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h18-0-4" id="h18-0-4" class="i">+
</a><a href="#h18-0-5" id="h18-0-5" class="i">+class FileAccessRequest(
</a><a href="#h18-0-6" id="h18-0-6" class="i">+    var action: FileAccessAction? = null,
</a><a href="#h18-0-7" id="h18-0-7" class="i">+    var fileType: BridgeFileType? = null,
</a><a href="#h18-0-8" id="h18-0-8" class="i">+    var content: ByteArray? = null
</a><a href="#h18-0-9" id="h18-0-9" class="i">+) : BridgeMessage() {
</a><a href="#h18-0-10" id="h18-0-10" class="i">+
</a><a href="#h18-0-11" id="h18-0-11" class="i">+    override fun write(bundle: Bundle) {
</a><a href="#h18-0-12" id="h18-0-12" class="i">+        bundle.putInt(&quot;action&quot;, action!!.value)
</a><a href="#h18-0-13" id="h18-0-13" class="i">+        bundle.putInt(&quot;fileType&quot;, fileType!!.value)
</a><a href="#h18-0-14" id="h18-0-14" class="i">+        bundle.putByteArray(&quot;content&quot;, content)
</a><a href="#h18-0-15" id="h18-0-15" class="i">+    }
</a><a href="#h18-0-16" id="h18-0-16" class="i">+
</a><a href="#h18-0-17" id="h18-0-17" class="i">+    override fun read(bundle: Bundle) {
</a><a href="#h18-0-18" id="h18-0-18" class="i">+        action = FileAccessAction.fromValue(bundle.getInt(&quot;action&quot;))
</a><a href="#h18-0-19" id="h18-0-19" class="i">+        fileType = BridgeFileType.fromValue(bundle.getInt(&quot;fileType&quot;))
</a><a href="#h18-0-20" id="h18-0-20" class="i">+        content = bundle.getByteArray(&quot;content&quot;)
</a><a href="#h18-0-21" id="h18-0-21" class="i">+    }
</a><a href="#h18-0-22" id="h18-0-22" class="i">+
</a><a href="#h18-0-23" id="h18-0-23" class="i">+    enum class FileAccessAction(val value: Int) {
</a><a href="#h18-0-24" id="h18-0-24" class="i">+        READ(0), WRITE(1), DELETE(2), EXISTS(3);
</a><a href="#h18-0-25" id="h18-0-25" class="i">+
</a><a href="#h18-0-26" id="h18-0-26" class="i">+        companion object {
</a><a href="#h18-0-27" id="h18-0-27" class="i">+            fun fromValue(value: Int): FileAccessAction? {
</a><a href="#h18-0-28" id="h18-0-28" class="i">+                return values().firstOrNull { it.value == value }
</a><a href="#h18-0-29" id="h18-0-29" class="i">+            }
</a><a href="#h18-0-30" id="h18-0-30" class="i">+        }
</a><a href="#h18-0-31" id="h18-0-31" class="i">+    }
</a><a href="#h18-0-32" id="h18-0-32" class="i">+}
</a><b>diff --git a/<a id="h19" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessResult.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/FileAccessResult.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.file
</a><a href="#h19-0-1" id="h19-0-1" class="i">+
</a><a href="#h19-0-2" id="h19-0-2" class="i">+import android.os.Bundle
</a><a href="#h19-0-3" id="h19-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h19-0-4" id="h19-0-4" class="i">+
</a><a href="#h19-0-5" id="h19-0-5" class="i">+class FileAccessResult(
</a><a href="#h19-0-6" id="h19-0-6" class="i">+    var state: Boolean? = null,
</a><a href="#h19-0-7" id="h19-0-7" class="i">+    var content: ByteArray? = null
</a><a href="#h19-0-8" id="h19-0-8" class="i">+) : BridgeMessage() {
</a><a href="#h19-0-9" id="h19-0-9" class="i">+
</a><a href="#h19-0-10" id="h19-0-10" class="i">+    override fun write(bundle: Bundle) {
</a><a href="#h19-0-11" id="h19-0-11" class="i">+        bundle.putBoolean(&quot;state&quot;, state!!)
</a><a href="#h19-0-12" id="h19-0-12" class="i">+        bundle.putByteArray(&quot;content&quot;, content)
</a><a href="#h19-0-13" id="h19-0-13" class="i">+    }
</a><a href="#h19-0-14" id="h19-0-14" class="i">+
</a><a href="#h19-0-15" id="h19-0-15" class="i">+    override fun read(bundle: Bundle) {
</a><a href="#h19-0-16" id="h19-0-16" class="i">+        state = bundle.getBoolean(&quot;state&quot;)
</a><a href="#h19-0-17" id="h19-0-17" class="i">+        content = bundle.getByteArray(&quot;content&quot;)
</a><a href="#h19-0-18" id="h19-0-18" class="i">+    }
</a><a href="#h19-0-19" id="h19-0-19" class="i">+}
</a><b>diff --git a/<a id="h20" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleRequest.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -0,0 +1,12 @@
</a><a href="#h20-0-0" id="h20-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.locale
</a><a href="#h20-0-1" id="h20-0-1" class="i">+
</a><a href="#h20-0-2" id="h20-0-2" class="i">+import android.os.Bundle
</a><a href="#h20-0-3" id="h20-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h20-0-4" id="h20-0-4" class="i">+
</a><a href="#h20-0-5" id="h20-0-5" class="i">+class LocaleRequest() : BridgeMessage() {
</a><a href="#h20-0-6" id="h20-0-6" class="i">+    override fun write(bundle: Bundle) {
</a><a href="#h20-0-7" id="h20-0-7" class="i">+    }
</a><a href="#h20-0-8" id="h20-0-8" class="i">+
</a><a href="#h20-0-9" id="h20-0-9" class="i">+    override fun read(bundle: Bundle) {
</a><a href="#h20-0-10" id="h20-0-10" class="i">+    }
</a><a href="#h20-0-11" id="h20-0-11" class="i">+}</a><a href="#h20-0-12" id="h20-0-12" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h21" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleResult.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/locale/LocaleResult.kt</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -0,0 +1,19 @@
</a><a href="#h21-0-0" id="h21-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.locale
</a><a href="#h21-0-1" id="h21-0-1" class="i">+
</a><a href="#h21-0-2" id="h21-0-2" class="i">+import android.os.Bundle
</a><a href="#h21-0-3" id="h21-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h21-0-4" id="h21-0-4" class="i">+
</a><a href="#h21-0-5" id="h21-0-5" class="i">+class LocaleResult(
</a><a href="#h21-0-6" id="h21-0-6" class="i">+    var locale: String? = null,
</a><a href="#h21-0-7" id="h21-0-7" class="i">+    var content: ByteArray? = null
</a><a href="#h21-0-8" id="h21-0-8" class="i">+) : BridgeMessage(){
</a><a href="#h21-0-9" id="h21-0-9" class="i">+    override fun write(bundle: Bundle) {
</a><a href="#h21-0-10" id="h21-0-10" class="i">+        bundle.putString(&quot;locale&quot;, locale)
</a><a href="#h21-0-11" id="h21-0-11" class="i">+        bundle.putByteArray(&quot;content&quot;, content)
</a><a href="#h21-0-12" id="h21-0-12" class="i">+    }
</a><a href="#h21-0-13" id="h21-0-13" class="i">+
</a><a href="#h21-0-14" id="h21-0-14" class="i">+    override fun read(bundle: Bundle) {
</a><a href="#h21-0-15" id="h21-0-15" class="i">+        locale = bundle.getString(&quot;locale&quot;)
</a><a href="#h21-0-16" id="h21-0-16" class="i">+        content = bundle.getByteArray(&quot;content&quot;)
</a><a href="#h21-0-17" id="h21-0-17" class="i">+    }
</a><a href="#h21-0-18" id="h21-0-18" class="i">+}</a><a href="#h21-0-19" id="h21-0-19" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h22" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -0,0 +1,29 @@
</a><a href="#h22-0-0" id="h22-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.messagelogger
</a><a href="#h22-0-1" id="h22-0-1" class="i">+
</a><a href="#h22-0-2" id="h22-0-2" class="i">+import android.os.Bundle
</a><a href="#h22-0-3" id="h22-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h22-0-4" id="h22-0-4" class="i">+
</a><a href="#h22-0-5" id="h22-0-5" class="i">+class MessageLoggerRequest(
</a><a href="#h22-0-6" id="h22-0-6" class="i">+    var action: Action? = null,
</a><a href="#h22-0-7" id="h22-0-7" class="i">+    var messageId: Long? = null,
</a><a href="#h22-0-8" id="h22-0-8" class="i">+    var message: ByteArray? = null
</a><a href="#h22-0-9" id="h22-0-9" class="i">+) : BridgeMessage(){
</a><a href="#h22-0-10" id="h22-0-10" class="i">+
</a><a href="#h22-0-11" id="h22-0-11" class="i">+    override fun write(bundle: Bundle) {
</a><a href="#h22-0-12" id="h22-0-12" class="i">+        bundle.putString(&quot;action&quot;, action!!.name)
</a><a href="#h22-0-13" id="h22-0-13" class="i">+        bundle.putLong(&quot;messageId&quot;, messageId!!)
</a><a href="#h22-0-14" id="h22-0-14" class="i">+        bundle.putByteArray(&quot;message&quot;, message)
</a><a href="#h22-0-15" id="h22-0-15" class="i">+    }
</a><a href="#h22-0-16" id="h22-0-16" class="i">+
</a><a href="#h22-0-17" id="h22-0-17" class="i">+    override fun read(bundle: Bundle) {
</a><a href="#h22-0-18" id="h22-0-18" class="i">+        action = Action.valueOf(bundle.getString(&quot;action&quot;)!!)
</a><a href="#h22-0-19" id="h22-0-19" class="i">+        messageId = bundle.getLong(&quot;messageId&quot;)
</a><a href="#h22-0-20" id="h22-0-20" class="i">+        message = bundle.getByteArray(&quot;message&quot;)
</a><a href="#h22-0-21" id="h22-0-21" class="i">+    }
</a><a href="#h22-0-22" id="h22-0-22" class="i">+
</a><a href="#h22-0-23" id="h22-0-23" class="i">+    enum class Action {
</a><a href="#h22-0-24" id="h22-0-24" class="i">+        ADD,
</a><a href="#h22-0-25" id="h22-0-25" class="i">+        GET,
</a><a href="#h22-0-26" id="h22-0-26" class="i">+        CLEAR
</a><a href="#h22-0-27" id="h22-0-27" class="i">+    }
</a><a href="#h22-0-28" id="h22-0-28" class="i">+}</a><a href="#h22-0-29" id="h22-0-29" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h23" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerResult.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerResult.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerResult.kt</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h23-0-0" id="h23-0-0" class="i">+package me.rhunk.snapenhance.bridge.common.impl.messagelogger
</a><a href="#h23-0-1" id="h23-0-1" class="i">+
</a><a href="#h23-0-2" id="h23-0-2" class="i">+import android.os.Bundle
</a><a href="#h23-0-3" id="h23-0-3" class="i">+import me.rhunk.snapenhance.bridge.common.BridgeMessage
</a><a href="#h23-0-4" id="h23-0-4" class="i">+
</a><a href="#h23-0-5" id="h23-0-5" class="i">+class MessageLoggerResult(
</a><a href="#h23-0-6" id="h23-0-6" class="i">+    var state: Boolean? = null,
</a><a href="#h23-0-7" id="h23-0-7" class="i">+    var message: ByteArray? = null
</a><a href="#h23-0-8" id="h23-0-8" class="i">+) : BridgeMessage() {
</a><a href="#h23-0-9" id="h23-0-9" class="i">+
</a><a href="#h23-0-10" id="h23-0-10" class="i">+    override fun write(bundle: Bundle) {
</a><a href="#h23-0-11" id="h23-0-11" class="i">+        bundle.putBoolean(&quot;state&quot;, state!!)
</a><a href="#h23-0-12" id="h23-0-12" class="i">+        bundle.putByteArray(&quot;message&quot;, message)
</a><a href="#h23-0-13" id="h23-0-13" class="i">+    }
</a><a href="#h23-0-14" id="h23-0-14" class="i">+
</a><a href="#h23-0-15" id="h23-0-15" class="i">+    override fun read(bundle: Bundle) {
</a><a href="#h23-0-16" id="h23-0-16" class="i">+        state = bundle.getBoolean(&quot;state&quot;)
</a><a href="#h23-0-17" id="h23-0-17" class="i">+        message = bundle.getByteArray(&quot;message&quot;)
</a><a href="#h23-0-18" id="h23-0-18" class="i">+    }
</a><a href="#h23-0-19" id="h23-0-19" class="i">+}</a><a href="#h23-0-20" id="h23-0-20" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h24" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/service/BridgeService.kt</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -4,31 +4,29 @@ import android.annotation.SuppressLint
</a> import android.app.DownloadManager
 import android.app.Service
 import android.content.*
<a href="#h24-0-3" id="h24-0-3" class="d">-import android.database.sqlite.SQLiteDatabase
</a> import android.net.Uri
 import android.os.*
 import me.rhunk.snapenhance.Logger
<a href="#h24-0-7" id="h24-0-7" class="i">+import me.rhunk.snapenhance.bridge.MessageLoggerWrapper
</a> import me.rhunk.snapenhance.bridge.common.BridgeMessageType
 import me.rhunk.snapenhance.bridge.common.impl.*
<a href="#h24-0-10" id="h24-0-10" class="i">+import me.rhunk.snapenhance.bridge.common.impl.download.DownloadContentRequest
</a><a href="#h24-0-11" id="h24-0-11" class="i">+import me.rhunk.snapenhance.bridge.common.impl.download.DownloadContentResult
</a><a href="#h24-0-12" id="h24-0-12" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h24-0-13" id="h24-0-13" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.FileAccessRequest
</a><a href="#h24-0-14" id="h24-0-14" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.FileAccessResult
</a><a href="#h24-0-15" id="h24-0-15" class="i">+import me.rhunk.snapenhance.bridge.common.impl.locale.LocaleRequest
</a><a href="#h24-0-16" id="h24-0-16" class="i">+import me.rhunk.snapenhance.bridge.common.impl.locale.LocaleResult
</a><a href="#h24-0-17" id="h24-0-17" class="i">+import me.rhunk.snapenhance.bridge.common.impl.messagelogger.MessageLoggerRequest
</a><a href="#h24-0-18" id="h24-0-18" class="i">+import me.rhunk.snapenhance.bridge.common.impl.messagelogger.MessageLoggerResult
</a> import java.io.File
 import java.util.*
 
 class BridgeService : Service() {
<a href="#h24-0-23" id="h24-0-23" class="d">-    companion object {
</a><a href="#h24-0-24" id="h24-0-24" class="d">-        const val CONFIG_FILE = &quot;config.json&quot;
</a><a href="#h24-0-25" id="h24-0-25" class="d">-        const val MAPPINGS_FILE = &quot;mappings.json&quot;
</a><a href="#h24-0-26" id="h24-0-26" class="d">-        const val STEALTH_FILE = &quot;stealth.txt&quot;
</a><a href="#h24-0-27" id="h24-0-27" class="d">-        const val MESSAGE_LOGGER_DATABASE = &quot;message_logger&quot;
</a><a href="#h24-0-28" id="h24-0-28" class="d">-        const val ANTI_AUTO_DOWNLOAD_FILE = &quot;anti_auto_download.txt&quot;
</a><a href="#h24-0-29" id="h24-0-29" class="d">-    }
</a><a href="#h24-0-30" id="h24-0-30" class="d">-
</a><a href="#h24-0-31" id="h24-0-31" class="d">-    lateinit var messageLoggerDatabase: SQLiteDatabase
</a><a href="#h24-0-32" id="h24-0-32" class="i">+    private lateinit var messageLoggerWrapper: MessageLoggerWrapper
</a> 
     override fun onBind(intent: Intent): IBinder {
<a href="#h24-0-35" id="h24-0-35" class="d">-        with(openOrCreateDatabase(MESSAGE_LOGGER_DATABASE, Context.MODE_PRIVATE, null)) {
</a><a href="#h24-0-36" id="h24-0-36" class="d">-            messageLoggerDatabase = this
</a><a href="#h24-0-37" id="h24-0-37" class="d">-            execSQL(&quot;CREATE TABLE IF NOT EXISTS messages (message_id INTEGER PRIMARY KEY, serialized_message BLOB)&quot;)
</a><a href="#h24-0-38" id="h24-0-38" class="d">-        }
</a><a href="#h24-0-39" id="h24-0-39" class="i">+        messageLoggerWrapper = MessageLoggerWrapper(getDatabasePath(BridgeFileType.MESSAGE_LOGGER_DATABASE.fileName)).also { it.init() }
</a> 
         return Messenger(object : Handler(Looper.getMainLooper()) {
             override fun handleMessage(msg: Message) {
<a href="#h24-1" id="h24-1" class="h">@@ -84,33 +82,16 @@ class BridgeService : Service() {
</a>     private fun handleMessageLoggerRequest(msg: MessageLoggerRequest, reply: (Message) -&gt; Unit) {
         when (msg.action) {
             MessageLoggerRequest.Action.ADD  -&gt; {
<a href="#h24-1-3" id="h24-1-3" class="d">-                //check if message already exists
</a><a href="#h24-1-4" id="h24-1-4" class="d">-                val cursor = messageLoggerDatabase.rawQuery(&quot;SELECT message_id FROM messages WHERE message_id = ?&quot;, arrayOf(msg.messageId.toString()))
</a><a href="#h24-1-5" id="h24-1-5" class="d">-                val state = cursor.moveToFirst()
</a><a href="#h24-1-6" id="h24-1-6" class="d">-                cursor.close()
</a><a href="#h24-1-7" id="h24-1-7" class="d">-                if (state) {
</a><a href="#h24-1-8" id="h24-1-8" class="d">-                    reply(MessageLoggerResult(false).toMessage(BridgeMessageType.MESSAGE_LOGGER_RESULT.value))
</a><a href="#h24-1-9" id="h24-1-9" class="d">-                    return
</a><a href="#h24-1-10" id="h24-1-10" class="d">-                }
</a><a href="#h24-1-11" id="h24-1-11" class="d">-                messageLoggerDatabase.insert(&quot;messages&quot;, null, ContentValues().apply {
</a><a href="#h24-1-12" id="h24-1-12" class="d">-                    put(&quot;message_id&quot;, msg.messageId)
</a><a href="#h24-1-13" id="h24-1-13" class="d">-                    put(&quot;serialized_message&quot;, msg.message)
</a><a href="#h24-1-14" id="h24-1-14" class="d">-                })
</a><a href="#h24-1-15" id="h24-1-15" class="i">+                val isSuccess = messageLoggerWrapper.addMessage(msg.messageId!!, msg.message!!)
</a><a href="#h24-1-16" id="h24-1-16" class="i">+                reply(MessageLoggerResult(isSuccess).toMessage(BridgeMessageType.MESSAGE_LOGGER_RESULT.value))
</a><a href="#h24-1-17" id="h24-1-17" class="i">+                return
</a>             }
             MessageLoggerRequest.Action.CLEAR -&gt; {
<a href="#h24-1-20" id="h24-1-20" class="d">-                messageLoggerDatabase.execSQL(&quot;DELETE FROM messages&quot;)
</a><a href="#h24-1-21" id="h24-1-21" class="i">+                messageLoggerWrapper.clearMessages()
</a>             }
             MessageLoggerRequest.Action.GET -&gt; {
<a href="#h24-1-24" id="h24-1-24" class="d">-                val messageId = msg.messageId
</a><a href="#h24-1-25" id="h24-1-25" class="d">-                val cursor = messageLoggerDatabase.rawQuery(&quot;SELECT serialized_message FROM messages WHERE message_id = ?&quot;, arrayOf(messageId.toString()))
</a><a href="#h24-1-26" id="h24-1-26" class="d">-                val state = cursor.moveToFirst()
</a><a href="#h24-1-27" id="h24-1-27" class="d">-                val message: ByteArray? = if (state) {
</a><a href="#h24-1-28" id="h24-1-28" class="d">-                    cursor.getBlob(0)
</a><a href="#h24-1-29" id="h24-1-29" class="d">-                } else {
</a><a href="#h24-1-30" id="h24-1-30" class="d">-                    null
</a><a href="#h24-1-31" id="h24-1-31" class="d">-                }
</a><a href="#h24-1-32" id="h24-1-32" class="d">-                cursor.close()
</a><a href="#h24-1-33" id="h24-1-33" class="d">-                reply(MessageLoggerResult(state, message).toMessage(BridgeMessageType.MESSAGE_LOGGER_RESULT.value))
</a><a href="#h24-1-34" id="h24-1-34" class="i">+                val (state, messageData) = messageLoggerWrapper.getMessage(msg.messageId!!)
</a><a href="#h24-1-35" id="h24-1-35" class="i">+                reply(MessageLoggerResult(state, messageData).toMessage(BridgeMessageType.MESSAGE_LOGGER_RESULT.value))
</a>             }
             else -&gt; {
                 Logger.log(Exception(&quot;Unknown message logger action: ${msg.action}&quot;))
<a href="#h24-2" id="h24-2" class="h">@@ -155,38 +136,37 @@ class BridgeService : Service() {
</a>     }
 
     private fun handleFileAccess(msg: FileAccessRequest, reply: (Message) -&gt; Unit) {
<a href="#h24-2-3" id="h24-2-3" class="d">-        val file = when (msg.fileType) {
</a><a href="#h24-2-4" id="h24-2-4" class="d">-            FileAccessRequest.FileType.CONFIG -&gt; CONFIG_FILE
</a><a href="#h24-2-5" id="h24-2-5" class="d">-            FileAccessRequest.FileType.MAPPINGS -&gt; MAPPINGS_FILE
</a><a href="#h24-2-6" id="h24-2-6" class="d">-            FileAccessRequest.FileType.STEALTH -&gt; STEALTH_FILE
</a><a href="#h24-2-7" id="h24-2-7" class="d">-            FileAccessRequest.FileType.ANTI_AUTO_DOWNLOAD -&gt; ANTI_AUTO_DOWNLOAD_FILE
</a><a href="#h24-2-8" id="h24-2-8" class="d">-            else -&gt; throw Exception(&quot;Unknown file type: &quot; + msg.fileType)
</a><a href="#h24-2-9" id="h24-2-9" class="d">-        }.let { File(filesDir, it) }
</a><a href="#h24-2-10" id="h24-2-10" class="i">+        val fileFolder = if (msg.fileType!!.isDatabase) {
</a><a href="#h24-2-11" id="h24-2-11" class="i">+            File(dataDir, &quot;databases&quot;)
</a><a href="#h24-2-12" id="h24-2-12" class="i">+        } else {
</a><a href="#h24-2-13" id="h24-2-13" class="i">+            File(filesDir.absolutePath)
</a><a href="#h24-2-14" id="h24-2-14" class="i">+        }
</a><a href="#h24-2-15" id="h24-2-15" class="i">+        val requestFile =  File(fileFolder, msg.fileType!!.fileName)
</a> 
         val result: FileAccessResult = when (msg.action) {
             FileAccessRequest.FileAccessAction.READ -&gt; {
<a href="#h24-2-19" id="h24-2-19" class="d">-                if (!file.exists()) {
</a><a href="#h24-2-20" id="h24-2-20" class="i">+                if (!requestFile.exists()) {
</a>                     FileAccessResult(false, null)
                 } else {
<a href="#h24-2-23" id="h24-2-23" class="d">-                    FileAccessResult(true, file.readBytes())
</a><a href="#h24-2-24" id="h24-2-24" class="i">+                    FileAccessResult(true, requestFile.readBytes())
</a>                 }
             }
             FileAccessRequest.FileAccessAction.WRITE -&gt; {
<a href="#h24-2-28" id="h24-2-28" class="d">-                if (!file.exists()) {
</a><a href="#h24-2-29" id="h24-2-29" class="d">-                    file.createNewFile()
</a><a href="#h24-2-30" id="h24-2-30" class="i">+                if (!requestFile.exists()) {
</a><a href="#h24-2-31" id="h24-2-31" class="i">+                    requestFile.createNewFile()
</a>                 }
<a href="#h24-2-33" id="h24-2-33" class="d">-                file.writeBytes(msg.content!!)
</a><a href="#h24-2-34" id="h24-2-34" class="i">+                requestFile.writeBytes(msg.content!!)
</a>                 FileAccessResult(true, null)
             }
             FileAccessRequest.FileAccessAction.DELETE -&gt; {
<a href="#h24-2-38" id="h24-2-38" class="d">-                if (!file.exists()) {
</a><a href="#h24-2-39" id="h24-2-39" class="i">+                if (!requestFile.exists()) {
</a>                     FileAccessResult(false, null)
                 } else {
<a href="#h24-2-42" id="h24-2-42" class="d">-                    file.delete()
</a><a href="#h24-2-43" id="h24-2-43" class="i">+                    requestFile.delete()
</a>                     FileAccessResult(true, null)
                 }
             }
<a href="#h24-2-47" id="h24-2-47" class="d">-            FileAccessRequest.FileAccessAction.EXISTS -&gt; FileAccessResult(file.exists(), null)
</a><a href="#h24-2-48" id="h24-2-48" class="i">+            FileAccessRequest.FileAccessAction.EXISTS -&gt; FileAccessResult(requestFile.exists(), null)
</a>             else -&gt; throw Exception(&quot;Unknown action: &quot; + msg.action)
         }
 
<b>diff --git a/<a id="h25" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -4,7 +4,7 @@ import me.rhunk.snapenhance.SnapEnhance
</a> import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
 import me.rhunk.snapenhance.util.getObjectField
 import java.nio.ByteBuffer
<a href="#h25-0-3" id="h25-0-3" class="d">-import java.util.*
</a><a href="#h25-0-4" id="h25-0-4" class="i">+import java.util.UUID
</a> 
 class SnapUUID(obj: Any?) : AbstractWrapper(obj) {
     private val uuidString by lazy { toUUID().toString() }
<b>diff --git a/<a id="h26" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -0,0 +1,54 @@
</a><a href="#h26-0-0" id="h26-0-0" class="i">+package me.rhunk.snapenhance.features
</a><a href="#h26-0-1" id="h26-0-1" class="i">+
</a><a href="#h26-0-2" id="h26-0-2" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h26-0-3" id="h26-0-3" class="i">+import java.io.BufferedReader
</a><a href="#h26-0-4" id="h26-0-4" class="i">+import java.io.ByteArrayInputStream
</a><a href="#h26-0-5" id="h26-0-5" class="i">+import java.io.InputStreamReader
</a><a href="#h26-0-6" id="h26-0-6" class="i">+import java.nio.charset.StandardCharsets
</a><a href="#h26-0-7" id="h26-0-7" class="i">+
</a><a href="#h26-0-8" id="h26-0-8" class="i">+abstract class BridgeFileFeature(name: String, private val bridgeFileType: BridgeFileType, loadParams: Int) : Feature(name, loadParams) {
</a><a href="#h26-0-9" id="h26-0-9" class="i">+    private val fileLines = mutableListOf&lt;String&gt;()
</a><a href="#h26-0-10" id="h26-0-10" class="i">+
</a><a href="#h26-0-11" id="h26-0-11" class="i">+    protected fun readFile() {
</a><a href="#h26-0-12" id="h26-0-12" class="i">+        val temporaryLines = mutableListOf&lt;String&gt;()
</a><a href="#h26-0-13" id="h26-0-13" class="i">+        val fileData: ByteArray = context.bridgeClient.createAndReadFile(bridgeFileType, ByteArray(0))
</a><a href="#h26-0-14" id="h26-0-14" class="i">+        with(BufferedReader(InputStreamReader(ByteArrayInputStream(fileData), StandardCharsets.UTF_8))) {
</a><a href="#h26-0-15" id="h26-0-15" class="i">+            var line = &quot;&quot;
</a><a href="#h26-0-16" id="h26-0-16" class="i">+            while (readLine()?.also { line = it } != null) temporaryLines.add(line)
</a><a href="#h26-0-17" id="h26-0-17" class="i">+            close()
</a><a href="#h26-0-18" id="h26-0-18" class="i">+        }
</a><a href="#h26-0-19" id="h26-0-19" class="i">+        fileLines.clear()
</a><a href="#h26-0-20" id="h26-0-20" class="i">+        fileLines.addAll(temporaryLines)
</a><a href="#h26-0-21" id="h26-0-21" class="i">+    }
</a><a href="#h26-0-22" id="h26-0-22" class="i">+
</a><a href="#h26-0-23" id="h26-0-23" class="i">+    private fun updateFile() {
</a><a href="#h26-0-24" id="h26-0-24" class="i">+        val sb = StringBuilder()
</a><a href="#h26-0-25" id="h26-0-25" class="i">+        fileLines.forEach {
</a><a href="#h26-0-26" id="h26-0-26" class="i">+            sb.append(it).append(&quot;\n&quot;)
</a><a href="#h26-0-27" id="h26-0-27" class="i">+        }
</a><a href="#h26-0-28" id="h26-0-28" class="i">+        context.bridgeClient.writeFile(bridgeFileType, sb.toString().toByteArray(Charsets.UTF_8))
</a><a href="#h26-0-29" id="h26-0-29" class="i">+    }
</a><a href="#h26-0-30" id="h26-0-30" class="i">+
</a><a href="#h26-0-31" id="h26-0-31" class="i">+    protected fun exists(line: String) = fileLines.contains(line)
</a><a href="#h26-0-32" id="h26-0-32" class="i">+
</a><a href="#h26-0-33" id="h26-0-33" class="i">+    protected fun toggle(line: String) {
</a><a href="#h26-0-34" id="h26-0-34" class="i">+        if (exists(line)) fileLines.remove(line) else fileLines.add(line)
</a><a href="#h26-0-35" id="h26-0-35" class="i">+        updateFile()
</a><a href="#h26-0-36" id="h26-0-36" class="i">+    }
</a><a href="#h26-0-37" id="h26-0-37" class="i">+
</a><a href="#h26-0-38" id="h26-0-38" class="i">+    protected fun setState(line: String, state: Boolean) {
</a><a href="#h26-0-39" id="h26-0-39" class="i">+        if (state) {
</a><a href="#h26-0-40" id="h26-0-40" class="i">+            if (!exists(line)) fileLines.add(line)
</a><a href="#h26-0-41" id="h26-0-41" class="i">+        } else {
</a><a href="#h26-0-42" id="h26-0-42" class="i">+            if (exists(line)) fileLines.remove(line)
</a><a href="#h26-0-43" id="h26-0-43" class="i">+        }
</a><a href="#h26-0-44" id="h26-0-44" class="i">+        updateFile()
</a><a href="#h26-0-45" id="h26-0-45" class="i">+    }
</a><a href="#h26-0-46" id="h26-0-46" class="i">+
</a><a href="#h26-0-47" id="h26-0-47" class="i">+    protected fun reload() = readFile()
</a><a href="#h26-0-48" id="h26-0-48" class="i">+
</a><a href="#h26-0-49" id="h26-0-49" class="i">+    protected fun put(line: String) {
</a><a href="#h26-0-50" id="h26-0-50" class="i">+        fileLines.add(line)
</a><a href="#h26-0-51" id="h26-0-51" class="i">+        updateFile()
</a><a href="#h26-0-52" id="h26-0-52" class="i">+    }
</a><a href="#h26-0-53" id="h26-0-53" class="i">+}</a><a href="#h26-0-54" id="h26-0-54" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h27" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -1,55 +1,19 @@
</a> package me.rhunk.snapenhance.features.impl.downloader
 
<a href="#h27-0-2" id="h27-0-2" class="d">-import me.rhunk.snapenhance.bridge.common.impl.FileAccessRequest
</a><a href="#h27-0-3" id="h27-0-3" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h27-0-4" id="h27-0-4" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h27-0-5" id="h27-0-5" class="i">+import me.rhunk.snapenhance.features.BridgeFileFeature
</a> import me.rhunk.snapenhance.features.FeatureLoadParams
<a href="#h27-0-7" id="h27-0-7" class="d">-import java.io.BufferedReader
</a><a href="#h27-0-8" id="h27-0-8" class="d">-import java.io.ByteArrayInputStream
</a><a href="#h27-0-9" id="h27-0-9" class="d">-import java.io.InputStreamReader
</a><a href="#h27-0-10" id="h27-0-10" class="d">-import java.nio.charset.StandardCharsets
</a><a href="#h27-0-11" id="h27-0-11" class="d">-
</a><a href="#h27-0-12" id="h27-0-12" class="d">-class AntiAutoDownload : Feature(&quot;AntiAutoDownload&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h27-0-13" id="h27-0-13" class="d">-    private val excludedUsers = mutableListOf&lt;String&gt;()
</a> 
<a href="#h27-0-15" id="h27-0-15" class="i">+class AntiAutoDownload : BridgeFileFeature(&quot;AntiAutoDownload&quot;, BridgeFileType.ANTI_AUTO_DOWNLOAD, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a>     override fun onActivityCreate() {
<a href="#h27-0-17" id="h27-0-17" class="d">-        readExclusionFile()
</a><a href="#h27-0-18" id="h27-0-18" class="d">-    }
</a><a href="#h27-0-19" id="h27-0-19" class="d">-
</a><a href="#h27-0-20" id="h27-0-20" class="d">-    private fun readExclusionFile() {
</a><a href="#h27-0-21" id="h27-0-21" class="d">-        val userIds = mutableListOf&lt;String&gt;()
</a><a href="#h27-0-22" id="h27-0-22" class="d">-        val exclusionFileData: ByteArray = context.bridgeClient.createAndReadFile(FileAccessRequest.FileType.ANTI_AUTO_DOWNLOAD, ByteArray(0))
</a><a href="#h27-0-23" id="h27-0-23" class="d">-        with(BufferedReader(InputStreamReader(ByteArrayInputStream(exclusionFileData), StandardCharsets.UTF_8))) {
</a><a href="#h27-0-24" id="h27-0-24" class="d">-            var line = &quot;&quot;
</a><a href="#h27-0-25" id="h27-0-25" class="d">-            while (readLine()?.also { line = it } != null) userIds.add(line)
</a><a href="#h27-0-26" id="h27-0-26" class="d">-            close()
</a><a href="#h27-0-27" id="h27-0-27" class="d">-        }
</a><a href="#h27-0-28" id="h27-0-28" class="d">-        excludedUsers.clear()
</a><a href="#h27-0-29" id="h27-0-29" class="d">-        excludedUsers.addAll(userIds)
</a><a href="#h27-0-30" id="h27-0-30" class="d">-    }
</a><a href="#h27-0-31" id="h27-0-31" class="d">-
</a><a href="#h27-0-32" id="h27-0-32" class="d">-    private fun writeExclusionFile() {
</a><a href="#h27-0-33" id="h27-0-33" class="d">-        val sb = StringBuilder()
</a><a href="#h27-0-34" id="h27-0-34" class="d">-        excludedUsers.forEach {
</a><a href="#h27-0-35" id="h27-0-35" class="d">-            sb.append(it).append(&quot;\n&quot;)
</a><a href="#h27-0-36" id="h27-0-36" class="d">-        }
</a><a href="#h27-0-37" id="h27-0-37" class="d">-        context.bridgeClient.writeFile(
</a><a href="#h27-0-38" id="h27-0-38" class="d">-            FileAccessRequest.FileType.ANTI_AUTO_DOWNLOAD,
</a><a href="#h27-0-39" id="h27-0-39" class="d">-            sb.toString().toByteArray(Charsets.UTF_8)
</a><a href="#h27-0-40" id="h27-0-40" class="d">-        )
</a><a href="#h27-0-41" id="h27-0-41" class="i">+        readFile()
</a>     }
 
     fun setUserIgnored(userId: String, state: Boolean) {
<a href="#h27-0-45" id="h27-0-45" class="d">-        userId.hashCode().toLong().toString(16).let {
</a><a href="#h27-0-46" id="h27-0-46" class="d">-            if (state) {
</a><a href="#h27-0-47" id="h27-0-47" class="d">-                excludedUsers.add(it)
</a><a href="#h27-0-48" id="h27-0-48" class="d">-            } else {
</a><a href="#h27-0-49" id="h27-0-49" class="d">-                excludedUsers.remove(it)
</a><a href="#h27-0-50" id="h27-0-50" class="d">-            }
</a><a href="#h27-0-51" id="h27-0-51" class="d">-        }
</a><a href="#h27-0-52" id="h27-0-52" class="d">-        writeExclusionFile()
</a><a href="#h27-0-53" id="h27-0-53" class="i">+        setState(userId.hashCode().toLong().toString(16), state)
</a>     }
 
     fun isUserIgnored(userId: String): Boolean {
<a href="#h27-0-57" id="h27-0-57" class="d">-        return excludedUsers.contains(userId.hashCode().toLong().toString(16))
</a><a href="#h27-0-58" id="h27-0-58" class="i">+        return exists(userId.hashCode().toLong().toString(16))
</a>     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h28" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -9,7 +9,7 @@ import me.rhunk.snapenhance.hook.HookAdapter
</a> import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
 import java.nio.charset.StandardCharsets
<a href="#h28-0-3" id="h28-0-3" class="d">-import java.util.*
</a><a href="#h28-0-4" id="h28-0-4" class="i">+import java.util.Base64
</a> 
 class DisableMetrics : Feature(&quot;DisableMetrics&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
     override fun init() {
<b>diff --git a/<a id="h29" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spy/StealthMode.kt</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -1,62 +1,20 @@
</a> package me.rhunk.snapenhance.features.impl.spy
 
<a href="#h29-0-2" id="h29-0-2" class="d">-import me.rhunk.snapenhance.bridge.common.impl.FileAccessRequest
</a><a href="#h29-0-3" id="h29-0-3" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h29-0-4" id="h29-0-4" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h29-0-5" id="h29-0-5" class="i">+import me.rhunk.snapenhance.features.BridgeFileFeature
</a> import me.rhunk.snapenhance.features.FeatureLoadParams
<a href="#h29-0-7" id="h29-0-7" class="d">-import java.io.BufferedReader
</a><a href="#h29-0-8" id="h29-0-8" class="d">-import java.io.ByteArrayInputStream
</a><a href="#h29-0-9" id="h29-0-9" class="d">-import java.io.InputStreamReader
</a><a href="#h29-0-10" id="h29-0-10" class="d">-import java.nio.charset.StandardCharsets
</a> 
 
<a href="#h29-0-13" id="h29-0-13" class="d">-class StealthMode : Feature(&quot;StealthMode&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h29-0-14" id="h29-0-14" class="d">-    private val stealthConversations = mutableListOf&lt;String&gt;()
</a><a href="#h29-0-15" id="h29-0-15" class="d">-
</a><a href="#h29-0-16" id="h29-0-16" class="i">+class StealthMode : BridgeFileFeature(&quot;StealthMode&quot;, BridgeFileType.STEALTH, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a>     override fun onActivityCreate() {
<a href="#h29-0-18" id="h29-0-18" class="d">-        readStealthFile()
</a><a href="#h29-0-19" id="h29-0-19" class="d">-    }
</a><a href="#h29-0-20" id="h29-0-20" class="d">-
</a><a href="#h29-0-21" id="h29-0-21" class="d">-    private fun writeStealthFile() {
</a><a href="#h29-0-22" id="h29-0-22" class="d">-        val sb = StringBuilder()
</a><a href="#h29-0-23" id="h29-0-23" class="d">-        for (stealthConversation in stealthConversations) {
</a><a href="#h29-0-24" id="h29-0-24" class="d">-            sb.append(stealthConversation).append(&quot;\n&quot;)
</a><a href="#h29-0-25" id="h29-0-25" class="d">-        }
</a><a href="#h29-0-26" id="h29-0-26" class="d">-        context.bridgeClient.writeFile(
</a><a href="#h29-0-27" id="h29-0-27" class="d">-            FileAccessRequest.FileType.STEALTH,
</a><a href="#h29-0-28" id="h29-0-28" class="d">-            sb.toString().toByteArray(StandardCharsets.UTF_8)
</a><a href="#h29-0-29" id="h29-0-29" class="d">-        )
</a><a href="#h29-0-30" id="h29-0-30" class="d">-    }
</a><a href="#h29-0-31" id="h29-0-31" class="d">-
</a><a href="#h29-0-32" id="h29-0-32" class="d">-    private fun readStealthFile() {
</a><a href="#h29-0-33" id="h29-0-33" class="d">-        val conversations = mutableListOf&lt;String&gt;()
</a><a href="#h29-0-34" id="h29-0-34" class="d">-        val stealthFileData: ByteArray = context.bridgeClient.createAndReadFile(FileAccessRequest.FileType.STEALTH, ByteArray(0))
</a><a href="#h29-0-35" id="h29-0-35" class="d">-        //read conversations
</a><a href="#h29-0-36" id="h29-0-36" class="d">-        with(BufferedReader(InputStreamReader(
</a><a href="#h29-0-37" id="h29-0-37" class="d">-                ByteArrayInputStream(stealthFileData),
</a><a href="#h29-0-38" id="h29-0-38" class="d">-                StandardCharsets.UTF_8
</a><a href="#h29-0-39" id="h29-0-39" class="d">-        ))) {
</a><a href="#h29-0-40" id="h29-0-40" class="d">-            var line: String = &quot;&quot;
</a><a href="#h29-0-41" id="h29-0-41" class="d">-            while (readLine()?.also { line = it } != null) {
</a><a href="#h29-0-42" id="h29-0-42" class="d">-                conversations.add(line)
</a><a href="#h29-0-43" id="h29-0-43" class="d">-            }
</a><a href="#h29-0-44" id="h29-0-44" class="d">-            close()
</a><a href="#h29-0-45" id="h29-0-45" class="d">-        }
</a><a href="#h29-0-46" id="h29-0-46" class="d">-        stealthConversations.clear()
</a><a href="#h29-0-47" id="h29-0-47" class="d">-        stealthConversations.addAll(conversations)
</a><a href="#h29-0-48" id="h29-0-48" class="i">+        readFile()
</a>     }
 
     fun setStealth(conversationId: String, stealth: Boolean) {
<a href="#h29-0-52" id="h29-0-52" class="d">-        conversationId.hashCode().toLong().toString(16).let {
</a><a href="#h29-0-53" id="h29-0-53" class="d">-            if (stealth) {
</a><a href="#h29-0-54" id="h29-0-54" class="d">-                stealthConversations.add(it)
</a><a href="#h29-0-55" id="h29-0-55" class="d">-            } else {
</a><a href="#h29-0-56" id="h29-0-56" class="d">-                stealthConversations.remove(it)
</a><a href="#h29-0-57" id="h29-0-57" class="d">-            }
</a><a href="#h29-0-58" id="h29-0-58" class="d">-        }
</a><a href="#h29-0-59" id="h29-0-59" class="d">-        writeStealthFile()
</a><a href="#h29-0-60" id="h29-0-60" class="i">+        setState(conversationId.hashCode().toLong().toString(16), stealth)
</a>     }
 
     fun isStealth(conversationId: String): Boolean {
<a href="#h29-0-64" id="h29-0-64" class="d">-        return stealthConversations.contains(conversationId.hashCode().toLong().toString(16))
</a><a href="#h29-0-65" id="h29-0-65" class="i">+        return exists(conversationId.hashCode().toLong().toString(16))
</a>     }
 }
<b>diff --git a/<a id="h30" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -28,7 +28,9 @@ import java.net.HttpURLConnection
</a> import java.net.URL
 import java.text.DateFormat
 import java.text.SimpleDateFormat
<a href="#h30-0-3" id="h30-0-3" class="d">-import java.util.*
</a><a href="#h30-0-4" id="h30-0-4" class="i">+import java.util.Calendar
</a><a href="#h30-0-5" id="h30-0-5" class="i">+import java.util.Date
</a><a href="#h30-0-6" id="h30-0-6" class="i">+import java.util.Locale
</a> 
 class FriendFeedInfoMenu : AbstractMenu() {
     private fun getImageDrawable(url: String): Drawable {
<b>diff --git a/<a id="h31" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -3,7 +3,7 @@ package me.rhunk.snapenhance.manager.impl
</a> import com.google.gson.JsonObject
 import me.rhunk.snapenhance.Logger
 import me.rhunk.snapenhance.ModContext
<a href="#h31-0-3" id="h31-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.impl.FileAccessRequest
</a><a href="#h31-0-4" id="h31-0-4" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a> import me.rhunk.snapenhance.config.ConfigAccessor
 import me.rhunk.snapenhance.config.ConfigProperty
 import me.rhunk.snapenhance.manager.Manager
<a href="#h31-1" id="h31-1" class="h">@@ -22,7 +22,7 @@ class ConfigManager(
</a>             set(key, key.defaultValue)
         }
 
<a href="#h31-1-3" id="h31-1-3" class="d">-        if (!context.bridgeClient.isFileExists(FileAccessRequest.FileType.CONFIG)) {
</a><a href="#h31-1-4" id="h31-1-4" class="i">+        if (!context.bridgeClient.isFileExists(BridgeFileType.CONFIG)) {
</a>             writeConfig()
             return
         }
<a href="#h31-2" id="h31-2" class="h">@@ -37,7 +37,7 @@ class ConfigManager(
</a> 
     private fun loadConfig() {
         val configContent = context.bridgeClient.createAndReadFile(
<a href="#h31-2-3" id="h31-2-3" class="d">-            FileAccessRequest.FileType.CONFIG,
</a><a href="#h31-2-4" id="h31-2-4" class="i">+            BridgeFileType.CONFIG,
</a>             &quot;{}&quot;.toByteArray(Charsets.UTF_8)
         )
         val configObject: JsonObject = context.gson.fromJson(
<a href="#h31-3" id="h31-3" class="h">@@ -56,7 +56,7 @@ class ConfigManager(
</a>             configObject.add(key.name, context.gson.toJsonTree(get(key)))
         }
         context.bridgeClient.writeFile(
<a href="#h31-3-3" id="h31-3-3" class="d">-            FileAccessRequest.FileType.CONFIG,
</a><a href="#h31-3-4" id="h31-3-4" class="i">+            BridgeFileType.CONFIG,
</a>             context.gson.toJson(configObject).toByteArray(Charsets.UTF_8)
         )
     }
<b>diff --git a/<a id="h32" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -9,7 +9,7 @@ import kotlinx.coroutines.runBlocking
</a> import me.rhunk.snapenhance.Constants
 import me.rhunk.snapenhance.Logger
 import me.rhunk.snapenhance.ModContext
<a href="#h32-0-3" id="h32-0-3" class="d">-import me.rhunk.snapenhance.bridge.common.impl.FileAccessRequest
</a><a href="#h32-0-4" id="h32-0-4" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a> import me.rhunk.snapenhance.manager.Manager
 import me.rhunk.snapenhance.mapping.Mapper
 import me.rhunk.snapenhance.mapping.impl.CallbackMapper
<a href="#h32-1" id="h32-1" class="h">@@ -40,7 +40,7 @@ class MappingManager(private val context: ModContext) : Manager {
</a>         ).longVersionCode.toInt()
         snapBuildNumber = currentBuildNumber
 
<a href="#h32-1-3" id="h32-1-3" class="d">-        if (context.bridgeClient.isFileExists(FileAccessRequest.FileType.MAPPINGS)) {
</a><a href="#h32-1-4" id="h32-1-4" class="i">+        if (context.bridgeClient.isFileExists(BridgeFileType.MAPPINGS)) {
</a>             runCatching {
                 loadCached()
             }.onFailure {
<a href="#h32-2" id="h32-2" class="h">@@ -48,7 +48,7 @@ class MappingManager(private val context: ModContext) : Manager {
</a>             }
 
             if (snapBuildNumber != currentBuildNumber) {
<a href="#h32-2-3" id="h32-2-3" class="d">-                context.bridgeClient.deleteFile(FileAccessRequest.FileType.MAPPINGS)
</a><a href="#h32-2-4" id="h32-2-4" class="i">+                context.bridgeClient.deleteFile(BridgeFileType.MAPPINGS)
</a>                 context.softRestartApp()
             }
             return
<a href="#h32-3" id="h32-3" class="h">@@ -63,13 +63,13 @@ class MappingManager(private val context: ModContext) : Manager {
</a>     }
 
     private fun loadCached() {
<a href="#h32-3-3" id="h32-3-3" class="d">-        if (!context.bridgeClient.isFileExists(FileAccessRequest.FileType.MAPPINGS)) {
</a><a href="#h32-3-4" id="h32-3-4" class="i">+        if (!context.bridgeClient.isFileExists(BridgeFileType.MAPPINGS)) {
</a>             Logger.xposedLog(&quot;Mappings file does not exist&quot;)
             return
         }
         val mappingsObject = JsonParser.parseString(
             String(
<a href="#h32-3-10" id="h32-3-10" class="d">-                context.bridgeClient.readFile(FileAccessRequest.FileType.MAPPINGS),
</a><a href="#h32-3-11" id="h32-3-11" class="i">+                context.bridgeClient.readFile(BridgeFileType.MAPPINGS),
</a>                 StandardCharsets.UTF_8
             )
         ).asJsonObject.also {
<a href="#h32-4" id="h32-4" class="h">@@ -146,7 +146,7 @@ class MappingManager(private val context: ModContext) : Manager {
</a>         }
 
         context.bridgeClient.writeFile(
<a href="#h32-4-3" id="h32-4-3" class="d">-            FileAccessRequest.FileType.MAPPINGS,
</a><a href="#h32-4-4" id="h32-4-4" class="i">+            BridgeFileType.MAPPINGS,
</a>             mappingsObject.toString().toByteArray()
         )
     }
<b>diff --git a/<a id="h33" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/TranslationManager.kt</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -4,7 +4,7 @@ import com.google.gson.JsonParser
</a> import me.rhunk.snapenhance.Logger
 import me.rhunk.snapenhance.ModContext
 import me.rhunk.snapenhance.manager.Manager
<a href="#h33-0-3" id="h33-0-3" class="d">-import java.util.*
</a><a href="#h33-0-4" id="h33-0-4" class="i">+import java.util.Locale
</a> 
 class TranslationManager(
     private val context: ModContext
<b>diff --git a/<a id="h34" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/EnumMapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/EnumMapper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/EnumMapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/EnumMapper.kt</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -3,7 +3,7 @@ package me.rhunk.snapenhance.mapping.impl
</a> import me.rhunk.snapenhance.Logger.debug
 import me.rhunk.snapenhance.mapping.Mapper
 import java.lang.reflect.Method
<a href="#h34-0-3" id="h34-0-3" class="d">-import java.util.*
</a><a href="#h34-0-4" id="h34-0-4" class="i">+import java.util.Objects
</a> 
 
 class EnumMapper : Mapper() {
<b>diff --git a/<a id="h35" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/OperaPageViewControllerMapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/OperaPageViewControllerMapper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/OperaPageViewControllerMapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/mapping/impl/OperaPageViewControllerMapper.kt</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -5,7 +5,7 @@ import me.rhunk.snapenhance.util.ReflectionHelper
</a> import java.lang.reflect.Field
 import java.lang.reflect.Method
 import java.lang.reflect.Modifier
<a href="#h35-0-3" id="h35-0-3" class="d">-import java.util.*
</a><a href="#h35-0-4" id="h35-0-4" class="i">+import java.util.Arrays
</a> 
 
 class OperaPageViewControllerMapper : Mapper() {
<b>diff --git a/<a id="h36" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/EncryptionHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/EncryptionHelper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/EncryptionHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/EncryptionHelper.kt</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -4,7 +4,7 @@ import me.rhunk.snapenhance.Constants
</a> import me.rhunk.snapenhance.data.ContentType
 import me.rhunk.snapenhance.util.protobuf.ProtoReader
 import java.io.InputStream
<a href="#h36-0-3" id="h36-0-3" class="d">-import java.util.*
</a><a href="#h36-0-4" id="h36-0-4" class="i">+import java.util.Base64
</a> import javax.crypto.Cipher
 import javax.crypto.CipherInputStream
 import javax.crypto.spec.IvParameterSpec
<b>diff --git a/<a id="h37" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -2,7 +2,8 @@ package me.rhunk.snapenhance.util
</a> 
 import java.lang.reflect.Field
 import java.lang.reflect.Method
<a href="#h37-0-3" id="h37-0-3" class="d">-import java.util.*
</a><a href="#h37-0-4" id="h37-0-4" class="i">+import java.util.Arrays
</a><a href="#h37-0-5" id="h37-0-5" class="i">+import java.util.Objects
</a> 
 object ReflectionHelper {
     /**
<b>diff --git a/<a id="h38" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -9,7 +9,8 @@ import java.io.InputStreamReader
</a> import java.io.PrintWriter
 import java.net.ServerSocket
 import java.net.Socket
<a href="#h38-0-3" id="h38-0-3" class="d">-import java.util.*
</a><a href="#h38-0-4" id="h38-0-4" class="i">+import java.util.Locale
</a><a href="#h38-0-5" id="h38-0-5" class="i">+import java.util.StringTokenizer
</a> import java.util.concurrent.ConcurrentHashMap
 import java.util.concurrent.ThreadLocalRandom
 import java.util.function.Consumer
</pre>
</div>
</body>
</html>
