<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>refactor: config system - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/1e02e0a61cd8db04fc729840c22c33ae1f0c188d.html">1e02e0a61cd8db04fc729840c22c33ae1f0c188d</a>
<b>parent</b> <a href="../commit/5d4e2aacb1dfc682e8fa0f9adbd9183c7b023104.html">5d4e2aacb1dfc682e8fa0f9adbd9183c7b023104</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Tue,  1 Aug 2023 01:14:04 +0200

refactor: config system

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/manager/data/ManagerContext.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/manager/sections/FeaturesSection.kt</a></td><td> | </td><td class="num">35</td><td><span class="i">+++++++++++++++++++++</span><span class="d">--------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/manager/util/SaveFolderChecker.kt</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">build.gradle.kts</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">core/build.gradle.kts</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></td><td> | </td><td class="num">13</td><td><span class="i">++++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt</a></td><td> | </td><td class="num">79</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigObjects.kt</a></td><td> | </td><td class="num">40</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">core/src/main/kotlin/me/rhunk/snapenhance/core/config/DataProcessors.kt</a></td><td> | </td><td class="num">95</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ModConfig.kt</a></td><td> | </td><td class="num">58</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Camera.kt</a></td><td> | </td><td class="num">15</td><td><span class="i">+++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/DownloaderConfig.kt</a></td><td> | </td><td class="num">25</td><td><span class="i">+++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Experimental.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h16">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h17">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt</a></td><td> | </td><td class="num">26</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h18">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h20">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/UserInterfaceTweaks.kt</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h21">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h23">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">+++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></td><td> | </td><td class="num">31</td><td><span class="i">+++++++++++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h26">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h28">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++</span><span class="d">----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h29">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h30">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a></td><td> | </td><td class="num">10</td><td><span class="i">+++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">+++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a></td><td> | </td><td class="num">10</td><td><span class="i">++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h38">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h39">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h40">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h41">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h42">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a></td><td> | </td><td class="num">54</td><td><span class="i">++++++++++++++++</span><span class="d">--------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h43">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">+++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h44">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a></td><td> | </td><td class="num">16</td><td><span class="i">+++++++++</span><span class="d">-------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h45">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h46">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h47">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">+</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h48">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a></td><td> | </td><td class="num">32</td><td><span class="i">++++++++++++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h49">core/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt</a></td><td> | </td><td class="num">49</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d">-----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h50">core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h51">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h52">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++</span><span class="d">------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h53">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
</table></pre><pre>54 files changed, 722 insertions(+), 240 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -1,21 +1,37 @@
</a> package me.rhunk.snapenhance.manager
 
 import android.annotation.SuppressLint
<a href="#h0-0-3" id="h0-0-3" class="i">+import android.content.Intent
</a> import android.os.Bundle
 import androidx.activity.ComponentActivity
 import androidx.activity.compose.setContent
<a href="#h0-0-7" id="h0-0-7" class="i">+import androidx.activity.result.contract.ActivityResultContracts
</a> import androidx.compose.material3.MaterialTheme
 import androidx.compose.material3.Scaffold
 import androidx.navigation.compose.rememberNavController
<a href="#h0-0-11" id="h0-0-11" class="i">+import me.rhunk.snapenhance.Logger
</a> import me.rhunk.snapenhance.manager.data.ManagerContext
<a href="#h0-0-13" id="h0-0-13" class="i">+import me.rhunk.snapenhance.manager.util.SaveFolderChecker
</a><a href="#h0-0-14" id="h0-0-14" class="i">+import me.rhunk.snapenhance.util.ActivityResultCallback
</a> 
 class MainActivity : ComponentActivity() {
<a href="#h0-0-17" id="h0-0-17" class="i">+    private val activityResultCallbacks = mutableMapOf&lt;Int, ActivityResultCallback&gt;()
</a><a href="#h0-0-18" id="h0-0-18" class="i">+
</a>     @SuppressLint(&quot;UnusedMaterialScaffoldPaddingParameter&quot;)
     override fun onCreate(savedInstanceState: Bundle?) {
         super.onCreate(savedInstanceState)
<a href="#h0-0-22" id="h0-0-22" class="i">+
</a>         val startDestination = intent.getStringExtra(&quot;route&quot;)?.let { EnumSection.fromRoute(it) } ?: EnumSection.HOME
         val managerContext = ManagerContext(this)
 
<a href="#h0-0-26" id="h0-0-26" class="i">+        //FIXME: temporary save folder
</a><a href="#h0-0-27" id="h0-0-27" class="i">+        SaveFolderChecker.askForFolder(
</a><a href="#h0-0-28" id="h0-0-28" class="i">+            this,
</a><a href="#h0-0-29" id="h0-0-29" class="i">+            managerContext.config.root.downloader.saveFolder)
</a><a href="#h0-0-30" id="h0-0-30" class="i">+        {
</a><a href="#h0-0-31" id="h0-0-31" class="i">+            managerContext.config.writeConfig()
</a><a href="#h0-0-32" id="h0-0-32" class="i">+        }
</a><a href="#h0-0-33" id="h0-0-33" class="i">+
</a>         setContent {
             val navController = rememberNavController()
             val navigation = Navigation(managerContext)
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/data/ManagerContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/data/ManagerContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/data/ManagerContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/data/ManagerContext.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -4,11 +4,12 @@ import android.content.Context
</a> import me.rhunk.snapenhance.bridge.wrapper.ConfigWrapper
 import me.rhunk.snapenhance.bridge.wrapper.MappingsWrapper
 import me.rhunk.snapenhance.bridge.wrapper.TranslationWrapper
<a href="#h1-0-3" id="h1-0-3" class="i">+import me.rhunk.snapenhance.core.config.ModConfig
</a> 
 class ManagerContext(
     private val context: Context
 ) {
<a href="#h1-0-8" id="h1-0-8" class="d">-    val config = ConfigWrapper()
</a><a href="#h1-0-9" id="h1-0-9" class="i">+    val config = ModConfig()
</a>     val translation = TranslationWrapper()
     val mappings = MappingsWrapper(context)
 
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/sections/FeaturesSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/sections/FeaturesSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/sections/FeaturesSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/sections/FeaturesSection.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -41,6 +41,7 @@ import androidx.compose.ui.unit.sp
</a> import androidx.compose.ui.window.Dialog
 import androidx.compose.ui.window.DialogProperties
 import kotlinx.coroutines.launch
<a href="#h2-0-3" id="h2-0-3" class="i">+import me.rhunk.snapenhance.Logger
</a> import me.rhunk.snapenhance.config.ConfigProperty
 import me.rhunk.snapenhance.config.impl.ConfigIntegerValue
 import me.rhunk.snapenhance.config.impl.ConfigStateListValue
<a href="#h2-1" id="h2-1" class="h">@@ -170,13 +171,28 @@ class FeaturesSection : Section() {
</a>         }
     }
 
<a href="#h2-1-3" id="h2-1-3" class="i">+    @Composable
</a><a href="#h2-1-4" id="h2-1-4" class="i">+    private fun PropertyContainer() {
</a><a href="#h2-1-5" id="h2-1-5" class="i">+        val properties = remember {
</a><a href="#h2-1-6" id="h2-1-6" class="i">+            val items by manager.config
</a><a href="#h2-1-7" id="h2-1-7" class="i">+            items.properties.map { it.key to it.value }
</a><a href="#h2-1-8" id="h2-1-8" class="i">+        }
</a><a href="#h2-1-9" id="h2-1-9" class="i">+
</a><a href="#h2-1-10" id="h2-1-10" class="i">+        LazyColumn(
</a><a href="#h2-1-11" id="h2-1-11" class="i">+            modifier = Modifier
</a><a href="#h2-1-12" id="h2-1-12" class="i">+                .fillMaxHeight(),
</a><a href="#h2-1-13" id="h2-1-13" class="i">+            verticalArrangement = Arrangement.Center
</a><a href="#h2-1-14" id="h2-1-14" class="i">+        ) {
</a><a href="#h2-1-15" id="h2-1-15" class="i">+            items(properties) { (key, value) -&gt;
</a><a href="#h2-1-16" id="h2-1-16" class="i">+               // Logger.debug(&quot;key: $key, value: $value&quot;)
</a><a href="#h2-1-17" id="h2-1-17" class="i">+            }
</a><a href="#h2-1-18" id="h2-1-18" class="i">+        }
</a><a href="#h2-1-19" id="h2-1-19" class="i">+    }
</a><a href="#h2-1-20" id="h2-1-20" class="i">+
</a> 
     @Composable
     @Preview
     override fun Content() {
<a href="#h2-1-25" id="h2-1-25" class="d">-        val configItems = remember {
</a><a href="#h2-1-26" id="h2-1-26" class="d">-            ConfigProperty.sortedByCategory()
</a><a href="#h2-1-27" id="h2-1-27" class="d">-        }
</a>         val scope = rememberCoroutineScope()
         val scaffoldState = rememberScaffoldState()
         Scaffold(
<a href="#h2-2" id="h2-2" class="h">@@ -184,7 +200,7 @@ class FeaturesSection : Section() {
</a>             floatingActionButton = {
                 FloatingActionButton(
                     onClick = {
<a href="#h2-2-3" id="h2-2-3" class="d">-                        manager.config.save()
</a><a href="#h2-2-4" id="h2-2-4" class="i">+                        //manager.config.writeConfig()
</a>                         scope.launch {
                             scaffoldState.snackbarHostState.showSnackbar(&quot;Saved&quot;)
                         }
<a href="#h2-3" id="h2-3" class="h">@@ -211,16 +227,7 @@ class FeaturesSection : Section() {
</a>                         modifier = Modifier.padding(all = 10.dp),
                         fontSize = 20.sp
                     )
<a href="#h2-3-3" id="h2-3-3" class="d">-                    LazyColumn(
</a><a href="#h2-3-4" id="h2-3-4" class="d">-                        modifier = Modifier
</a><a href="#h2-3-5" id="h2-3-5" class="d">-                            .fillMaxHeight(),
</a><a href="#h2-3-6" id="h2-3-6" class="d">-                        verticalArrangement = Arrangement.Center
</a><a href="#h2-3-7" id="h2-3-7" class="d">-                    ) {
</a><a href="#h2-3-8" id="h2-3-8" class="d">-                        items(configItems) { item -&gt;
</a><a href="#h2-3-9" id="h2-3-9" class="d">-                            if (item.shouldAppearInSettings.not()) return@items
</a><a href="#h2-3-10" id="h2-3-10" class="d">-                            PropertyCard(item)
</a><a href="#h2-3-11" id="h2-3-11" class="d">-                        }
</a><a href="#h2-3-12" id="h2-3-12" class="d">-                    }
</a><a href="#h2-3-13" id="h2-3-13" class="i">+                    PropertyContainer()
</a>                 }
             }
         )
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/util/SaveFolderChecker.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/util/SaveFolderChecker.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/util/SaveFolderChecker.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/util/SaveFolderChecker.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,43 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+package me.rhunk.snapenhance.manager.util
</a><a href="#h3-0-1" id="h3-0-1" class="i">+
</a><a href="#h3-0-2" id="h3-0-2" class="i">+import android.app.Activity
</a><a href="#h3-0-3" id="h3-0-3" class="i">+import android.app.AlertDialog
</a><a href="#h3-0-4" id="h3-0-4" class="i">+import android.content.Intent
</a><a href="#h3-0-5" id="h3-0-5" class="i">+import android.widget.Toast
</a><a href="#h3-0-6" id="h3-0-6" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h3-0-7" id="h3-0-7" class="i">+import androidx.activity.result.contract.ActivityResultContracts
</a><a href="#h3-0-8" id="h3-0-8" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h3-0-9" id="h3-0-9" class="i">+import me.rhunk.snapenhance.core.config.PropertyValue
</a><a href="#h3-0-10" id="h3-0-10" class="i">+import kotlin.system.exitProcess
</a><a href="#h3-0-11" id="h3-0-11" class="i">+
</a><a href="#h3-0-12" id="h3-0-12" class="i">+object SaveFolderChecker {
</a><a href="#h3-0-13" id="h3-0-13" class="i">+    fun askForFolder(activity: ComponentActivity, property: PropertyValue&lt;String&gt;, saveConfig: () -&gt; Unit) {
</a><a href="#h3-0-14" id="h3-0-14" class="i">+        if (property.get().isEmpty() || !property.get().startsWith(&quot;content://&quot;)) {
</a><a href="#h3-0-15" id="h3-0-15" class="i">+            val startActivity = activity.registerForActivityResult(ActivityResultContracts.StartActivityForResult()) result@{
</a><a href="#h3-0-16" id="h3-0-16" class="i">+                if (it.resultCode != Activity.RESULT_OK) return@result
</a><a href="#h3-0-17" id="h3-0-17" class="i">+                val uri = it.data?.data ?: return@result
</a><a href="#h3-0-18" id="h3-0-18" class="i">+                val value = uri.toString()
</a><a href="#h3-0-19" id="h3-0-19" class="i">+                activity.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
</a><a href="#h3-0-20" id="h3-0-20" class="i">+                property.set(value)
</a><a href="#h3-0-21" id="h3-0-21" class="i">+                saveConfig()
</a><a href="#h3-0-22" id="h3-0-22" class="i">+                Toast.makeText(activity, &quot;save folder set!&quot;, Toast.LENGTH_SHORT).show()
</a><a href="#h3-0-23" id="h3-0-23" class="i">+                activity.finish()
</a><a href="#h3-0-24" id="h3-0-24" class="i">+            }
</a><a href="#h3-0-25" id="h3-0-25" class="i">+
</a><a href="#h3-0-26" id="h3-0-26" class="i">+            AlertDialog.Builder(activity)
</a><a href="#h3-0-27" id="h3-0-27" class="i">+                .setTitle(&quot;Save folder&quot;)
</a><a href="#h3-0-28" id="h3-0-28" class="i">+                .setMessage(&quot;Please select a folder where you want to save downloaded files.&quot;)
</a><a href="#h3-0-29" id="h3-0-29" class="i">+                .setPositiveButton(&quot;Select&quot;) { _, _ -&gt;
</a><a href="#h3-0-30" id="h3-0-30" class="i">+                    startActivity.launch(
</a><a href="#h3-0-31" id="h3-0-31" class="i">+                        Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)
</a><a href="#h3-0-32" id="h3-0-32" class="i">+                        .addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
</a><a href="#h3-0-33" id="h3-0-33" class="i">+                        .addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
</a><a href="#h3-0-34" id="h3-0-34" class="i">+                    )
</a><a href="#h3-0-35" id="h3-0-35" class="i">+                }
</a><a href="#h3-0-36" id="h3-0-36" class="i">+                .setNegativeButton(&quot;Cancel&quot;) { _, _ -&gt;
</a><a href="#h3-0-37" id="h3-0-37" class="i">+                    exitProcess(0)
</a><a href="#h3-0-38" id="h3-0-38" class="i">+                }
</a><a href="#h3-0-39" id="h3-0-39" class="i">+                .show()
</a><a href="#h3-0-40" id="h3-0-40" class="i">+        }
</a><a href="#h3-0-41" id="h3-0-41" class="i">+    }
</a><a href="#h3-0-42" id="h3-0-42" class="i">+}</a><a href="#h3-0-43" id="h3-0-43" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h4" href="../file/build.gradle.kts.html">build.gradle.kts</a> b/<a href="../file/build.gradle.kts.html">build.gradle.kts</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -2,6 +2,7 @@
</a> @Suppress(&quot;DSL_SCOPE_VIOLATION&quot;) // TODO: Remove once KTIJ-19369 is fixed
 plugins {
     alias(libs.plugins.androidApplication) apply false
<a href="#h4-0-3" id="h4-0-3" class="i">+    alias(libs.plugins.androidLibrary) apply false
</a>     alias(libs.plugins.kotlinAndroid) apply false
 }
 
<b>diff --git a/<a id="h5" href="../file/core/build.gradle.kts.html">core/build.gradle.kts</a> b/<a href="../file/core/build.gradle.kts.html">core/build.gradle.kts</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,6 +1,6 @@
</a> @Suppress(&quot;DSL_SCOPE_VIOLATION&quot;) // TODO: Remove once KTIJ-19369 is fixed
 plugins {
<a href="#h5-0-2" id="h5-0-2" class="d">-    id(&quot;com.android.library&quot;)
</a><a href="#h5-0-3" id="h5-0-3" class="i">+    alias(libs.plugins.androidLibrary)
</a>     alias(libs.plugins.kotlinAndroid)
 }
 android {
<b>diff --git a/<a id="h6" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -12,8 +12,9 @@ import com.google.gson.Gson
</a> import com.google.gson.GsonBuilder
 import kotlinx.coroutines.asCoroutineDispatcher
 import me.rhunk.snapenhance.bridge.BridgeClient
<a href="#h6-0-3" id="h6-0-3" class="d">-import me.rhunk.snapenhance.bridge.wrapper.ConfigWrapper
</a> import me.rhunk.snapenhance.bridge.wrapper.TranslationWrapper
<a href="#h6-0-5" id="h6-0-5" class="i">+import me.rhunk.snapenhance.core.config.ModConfig
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import me.rhunk.snapenhance.core.config.impl.RootConfig
</a> import me.rhunk.snapenhance.data.MessageSender
 import me.rhunk.snapenhance.database.DatabaseAccess
 import me.rhunk.snapenhance.features.Feature
<a href="#h6-1" id="h6-1" class="h">@@ -39,8 +40,10 @@ class ModContext {
</a> 
     val gson: Gson = GsonBuilder().create()
 
<a href="#h6-1-3" id="h6-1-3" class="i">+    private val modConfig = ModConfig()
</a><a href="#h6-1-4" id="h6-1-4" class="i">+    val config by modConfig
</a><a href="#h6-1-5" id="h6-1-5" class="i">+
</a>     val translation = TranslationWrapper()
<a href="#h6-1-7" id="h6-1-7" class="d">-    val config = ConfigWrapper()
</a>     val features = FeatureManager(this)
     val mappings = MappingManager(this)
     val actionManager = ActionManager(this)
<a href="#h6-2" id="h6-2" class="h">@@ -87,7 +90,7 @@ class ModContext {
</a> 
     fun softRestartApp(saveSettings: Boolean = false) {
         if (saveSettings) {
<a href="#h6-2-3" id="h6-2-3" class="d">-            config.writeConfig()
</a><a href="#h6-2-4" id="h6-2-4" class="i">+            modConfig.writeConfig()
</a>         }
         val intent: Intent? = androidContext.packageManager.getLaunchIntentForPackage(
             Constants.SNAPCHAT_PACKAGE_NAME
<a href="#h6-3" id="h6-3" class="h">@@ -113,4 +116,8 @@ class ModContext {
</a>         Process.killProcess(Process.myPid())
         exitProcess(1)
     }
<a href="#h6-3-3" id="h6-3-3" class="i">+
</a><a href="#h6-3-4" id="h6-3-4" class="i">+    fun reloadConfig() {
</a><a href="#h6-3-5" id="h6-3-5" class="i">+        modConfig.loadFromBridge(bridgeClient)
</a><a href="#h6-3-6" id="h6-3-6" class="i">+    }
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h7" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -84,7 +84,7 @@ class SnapEnhance {
</a>             }
 
             Logger.debug(&quot;Reloading config&quot;)
<a href="#h7-0-3" id="h7-0-3" class="d">-            appContext.config.loadFromBridge(appContext.bridgeClient)
</a><a href="#h7-0-4" id="h7-0-4" class="i">+            appContext.reloadConfig()
</a>         }
     }
 
<a href="#h7-1" id="h7-1" class="h">@@ -97,7 +97,7 @@ class SnapEnhance {
</a> 
         measureTime {
             with(appContext) {
<a href="#h7-1-3" id="h7-1-3" class="d">-                config.loadFromBridge(bridgeClient)
</a><a href="#h7-1-4" id="h7-1-4" class="i">+                reloadConfig()
</a>                 mappings.init()
                 //if mappings aren&#39;t loaded, we can&#39;t initialize features
                 if (!mappings.areMappingsLoaded) return
<b>diff --git a/<a id="h8" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -13,8 +13,8 @@ class OpenMap: AbstractAction(&quot;action.open_map&quot;, dependsOnProperty = ConfigPrope
</a>             val mapActivityIntent = Intent()
             mapActivityIntent.setClassName(BuildConfig.APPLICATION_ID, MapActivity::class.java.name)
             mapActivityIntent.putExtra(&quot;location&quot;, Bundle().apply {
<a href="#h8-0-3" id="h8-0-3" class="d">-                putDouble(&quot;latitude&quot;, context.config.string(ConfigProperty.LATITUDE).toDouble())
</a><a href="#h8-0-4" id="h8-0-4" class="d">-                putDouble(&quot;longitude&quot;, context.config.string(ConfigProperty.LONGITUDE).toDouble())
</a><a href="#h8-0-5" id="h8-0-5" class="i">+                putDouble(&quot;latitude&quot;, context.config.spoof.location.latitude.get().toDouble())
</a><a href="#h8-0-6" id="h8-0-6" class="i">+                putDouble(&quot;longitude&quot;, context.config.spoof.location.longitude.get().toDouble())
</a>             })
 
             context.mainActivity!!.startActivityForResult(mapActivityIntent, 0x1337)
<b>diff --git a/<a id="h9" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigContainer.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,78 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+package me.rhunk.snapenhance.core.config
</a><a href="#h9-0-1" id="h9-0-1" class="i">+
</a><a href="#h9-0-2" id="h9-0-2" class="i">+import com.google.gson.JsonObject
</a><a href="#h9-0-3" id="h9-0-3" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h9-0-4" id="h9-0-4" class="i">+import kotlin.reflect.KProperty
</a><a href="#h9-0-5" id="h9-0-5" class="i">+
</a><a href="#h9-0-6" id="h9-0-6" class="i">+typealias ConfigParamsBuilder = ConfigParams.() -&gt; Unit
</a><a href="#h9-0-7" id="h9-0-7" class="i">+
</a><a href="#h9-0-8" id="h9-0-8" class="i">+open class ConfigContainer(
</a><a href="#h9-0-9" id="h9-0-9" class="i">+    var globalState: Boolean? = null
</a><a href="#h9-0-10" id="h9-0-10" class="i">+) {
</a><a href="#h9-0-11" id="h9-0-11" class="i">+    val properties = mutableMapOf&lt;PropertyKey&lt;*&gt;, PropertyValue&lt;*&gt;&gt;()
</a><a href="#h9-0-12" id="h9-0-12" class="i">+
</a><a href="#h9-0-13" id="h9-0-13" class="i">+    private inline fun &lt;T&gt; registerProperty(
</a><a href="#h9-0-14" id="h9-0-14" class="i">+        key: String,
</a><a href="#h9-0-15" id="h9-0-15" class="i">+        type: DataProcessors.PropertyDataProcessor&lt;*&gt;,
</a><a href="#h9-0-16" id="h9-0-16" class="i">+        defaultValue: PropertyValue&lt;T&gt;,
</a><a href="#h9-0-17" id="h9-0-17" class="i">+        params: ConfigParams.() -&gt; Unit = {}
</a><a href="#h9-0-18" id="h9-0-18" class="i">+    ): PropertyValue&lt;T&gt; {
</a><a href="#h9-0-19" id="h9-0-19" class="i">+        val propertyKey = PropertyKey(key, type, ConfigParams().also { it.params() })
</a><a href="#h9-0-20" id="h9-0-20" class="i">+        properties[propertyKey] = defaultValue
</a><a href="#h9-0-21" id="h9-0-21" class="i">+        return defaultValue
</a><a href="#h9-0-22" id="h9-0-22" class="i">+    }
</a><a href="#h9-0-23" id="h9-0-23" class="i">+
</a><a href="#h9-0-24" id="h9-0-24" class="i">+    protected fun boolean(key: String, defaultValue: Boolean = false, params: ConfigParamsBuilder = {}) =
</a><a href="#h9-0-25" id="h9-0-25" class="i">+        registerProperty(key, DataProcessors.BOOLEAN, PropertyValue(defaultValue), params)
</a><a href="#h9-0-26" id="h9-0-26" class="i">+
</a><a href="#h9-0-27" id="h9-0-27" class="i">+    protected fun integer(key: String, defaultValue: Int = 0, params: ConfigParamsBuilder = {}) =
</a><a href="#h9-0-28" id="h9-0-28" class="i">+        registerProperty(key, DataProcessors.INTEGER, PropertyValue(defaultValue), params)
</a><a href="#h9-0-29" id="h9-0-29" class="i">+
</a><a href="#h9-0-30" id="h9-0-30" class="i">+    protected fun float(key: String, defaultValue: Float = 0f, params: ConfigParamsBuilder = {}) =
</a><a href="#h9-0-31" id="h9-0-31" class="i">+        registerProperty(key, DataProcessors.FLOAT, PropertyValue(defaultValue), params)
</a><a href="#h9-0-32" id="h9-0-32" class="i">+
</a><a href="#h9-0-33" id="h9-0-33" class="i">+    protected fun string(key: String, defaultValue: String = &quot;&quot;, params: ConfigParamsBuilder = {}) =
</a><a href="#h9-0-34" id="h9-0-34" class="i">+        registerProperty(key, DataProcessors.STRING, PropertyValue(defaultValue), params)
</a><a href="#h9-0-35" id="h9-0-35" class="i">+
</a><a href="#h9-0-36" id="h9-0-36" class="i">+    protected fun multiple(
</a><a href="#h9-0-37" id="h9-0-37" class="i">+        key: String,
</a><a href="#h9-0-38" id="h9-0-38" class="i">+        vararg values: String = emptyArray(),
</a><a href="#h9-0-39" id="h9-0-39" class="i">+        params: ConfigParamsBuilder = {}
</a><a href="#h9-0-40" id="h9-0-40" class="i">+    ) = registerProperty(key,
</a><a href="#h9-0-41" id="h9-0-41" class="i">+        DataProcessors.STRING_MULTIPLE_SELECTION, PropertyValue(emptyList&lt;String&gt;(), defaultValues = values.toList()), params)
</a><a href="#h9-0-42" id="h9-0-42" class="i">+
</a><a href="#h9-0-43" id="h9-0-43" class="i">+    //null value is considered as Off/Disabled
</a><a href="#h9-0-44" id="h9-0-44" class="i">+    protected fun unique(
</a><a href="#h9-0-45" id="h9-0-45" class="i">+        key: String,
</a><a href="#h9-0-46" id="h9-0-46" class="i">+        vararg values: String = emptyArray(),
</a><a href="#h9-0-47" id="h9-0-47" class="i">+        params: ConfigParamsBuilder = {}
</a><a href="#h9-0-48" id="h9-0-48" class="i">+    ) = registerProperty(key,
</a><a href="#h9-0-49" id="h9-0-49" class="i">+        DataProcessors.STRING_UNIQUE_SELECTION, PropertyValue(&quot;null&quot;, defaultValues = values.toList()), params)
</a><a href="#h9-0-50" id="h9-0-50" class="i">+
</a><a href="#h9-0-51" id="h9-0-51" class="i">+    protected fun &lt;T : ConfigContainer&gt; container(
</a><a href="#h9-0-52" id="h9-0-52" class="i">+        key: String,
</a><a href="#h9-0-53" id="h9-0-53" class="i">+        container: T
</a><a href="#h9-0-54" id="h9-0-54" class="i">+    ) = registerProperty(key, DataProcessors.container(container), PropertyValue(container)).get()
</a><a href="#h9-0-55" id="h9-0-55" class="i">+
</a><a href="#h9-0-56" id="h9-0-56" class="i">+    fun toJson(): JsonObject {
</a><a href="#h9-0-57" id="h9-0-57" class="i">+        val json = JsonObject()
</a><a href="#h9-0-58" id="h9-0-58" class="i">+        properties.forEach { (propertyKey, propertyValue) -&gt;
</a><a href="#h9-0-59" id="h9-0-59" class="i">+            Logger.debug(&quot;${propertyKey.name} =&gt; $propertyValue&quot;)
</a><a href="#h9-0-60" id="h9-0-60" class="i">+            val serializedValue = propertyValue.getNullable()?.let { propertyKey.dataProcessor.serializeAny(it) }
</a><a href="#h9-0-61" id="h9-0-61" class="i">+            json.add(propertyKey.name, serializedValue)
</a><a href="#h9-0-62" id="h9-0-62" class="i">+        }
</a><a href="#h9-0-63" id="h9-0-63" class="i">+        return json
</a><a href="#h9-0-64" id="h9-0-64" class="i">+    }
</a><a href="#h9-0-65" id="h9-0-65" class="i">+
</a><a href="#h9-0-66" id="h9-0-66" class="i">+    fun fromJson(json: JsonObject) {
</a><a href="#h9-0-67" id="h9-0-67" class="i">+        properties.forEach { (key, _) -&gt;
</a><a href="#h9-0-68" id="h9-0-68" class="i">+            val jsonElement = json.get(key.name) ?: return@forEach
</a><a href="#h9-0-69" id="h9-0-69" class="i">+            key.dataProcessor.deserializeAny(jsonElement)?.let {
</a><a href="#h9-0-70" id="h9-0-70" class="i">+                properties[key]?.setAny(it)
</a><a href="#h9-0-71" id="h9-0-71" class="i">+            }
</a><a href="#h9-0-72" id="h9-0-72" class="i">+        }
</a><a href="#h9-0-73" id="h9-0-73" class="i">+    }
</a><a href="#h9-0-74" id="h9-0-74" class="i">+
</a><a href="#h9-0-75" id="h9-0-75" class="i">+    operator fun getValue(t: Any?, property: KProperty&lt;*&gt;) = this.globalState
</a><a href="#h9-0-76" id="h9-0-76" class="i">+    operator fun setValue(t: Any?, property: KProperty&lt;*&gt;, t1: Boolean?) { this.globalState = t1 }
</a><a href="#h9-0-77" id="h9-0-77" class="i">+}</a><a href="#h9-0-78" id="h9-0-78" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigObjects.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ConfigObjects.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,40 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+package me.rhunk.snapenhance.core.config
</a><a href="#h10-0-1" id="h10-0-1" class="i">+
</a><a href="#h10-0-2" id="h10-0-2" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h10-0-3" id="h10-0-3" class="i">+import kotlin.reflect.KProperty
</a><a href="#h10-0-4" id="h10-0-4" class="i">+
</a><a href="#h10-0-5" id="h10-0-5" class="i">+class ConfigParams(
</a><a href="#h10-0-6" id="h10-0-6" class="i">+    var shouldTranslate: Boolean = false,
</a><a href="#h10-0-7" id="h10-0-7" class="i">+    var hidden: Boolean = false,
</a><a href="#h10-0-8" id="h10-0-8" class="i">+    var isFolder: Boolean = false
</a><a href="#h10-0-9" id="h10-0-9" class="i">+)
</a><a href="#h10-0-10" id="h10-0-10" class="i">+
</a><a href="#h10-0-11" id="h10-0-11" class="i">+class PropertyValue&lt;T&gt;(
</a><a href="#h10-0-12" id="h10-0-12" class="i">+    private var value: T? = null,
</a><a href="#h10-0-13" id="h10-0-13" class="i">+    val defaultValues: List&lt;*&gt;? = null
</a><a href="#h10-0-14" id="h10-0-14" class="i">+) {
</a><a href="#h10-0-15" id="h10-0-15" class="i">+    inner class PropertyValueNullable {
</a><a href="#h10-0-16" id="h10-0-16" class="i">+        fun get() = value
</a><a href="#h10-0-17" id="h10-0-17" class="i">+        operator fun getValue(t: Any?, property: KProperty&lt;*&gt;): T? = getNullable()
</a><a href="#h10-0-18" id="h10-0-18" class="i">+        operator fun setValue(t: Any?, property: KProperty&lt;*&gt;, t1: T?) = set(t1)
</a><a href="#h10-0-19" id="h10-0-19" class="i">+    }
</a><a href="#h10-0-20" id="h10-0-20" class="i">+
</a><a href="#h10-0-21" id="h10-0-21" class="i">+    fun nullable() = PropertyValueNullable()
</a><a href="#h10-0-22" id="h10-0-22" class="i">+
</a><a href="#h10-0-23" id="h10-0-23" class="i">+    fun isSet() = value != null
</a><a href="#h10-0-24" id="h10-0-24" class="i">+    fun getNullable() = value?.takeIf { it != &quot;null&quot; }
</a><a href="#h10-0-25" id="h10-0-25" class="i">+    fun get() = getNullable() ?: throw IllegalStateException(&quot;Property is not set&quot;)
</a><a href="#h10-0-26" id="h10-0-26" class="i">+    fun set(value: T?) { this.value = value }
</a><a href="#h10-0-27" id="h10-0-27" class="i">+    @Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h10-0-28" id="h10-0-28" class="i">+    fun setAny(value: Any?) { this.value = value as T? }
</a><a href="#h10-0-29" id="h10-0-29" class="i">+
</a><a href="#h10-0-30" id="h10-0-30" class="i">+    operator fun getValue(t: Any?, property: KProperty&lt;*&gt;): T = get()
</a><a href="#h10-0-31" id="h10-0-31" class="i">+    operator fun setValue(t: Any?, property: KProperty&lt;*&gt;, t1: T?) = set(t1)
</a><a href="#h10-0-32" id="h10-0-32" class="i">+}
</a><a href="#h10-0-33" id="h10-0-33" class="i">+
</a><a href="#h10-0-34" id="h10-0-34" class="i">+class PropertyKey&lt;T&gt;(
</a><a href="#h10-0-35" id="h10-0-35" class="i">+    val name: String,
</a><a href="#h10-0-36" id="h10-0-36" class="i">+    val dataProcessor: DataProcessors.PropertyDataProcessor&lt;T&gt;,
</a><a href="#h10-0-37" id="h10-0-37" class="i">+    val params: ConfigParams = ConfigParams(),
</a><a href="#h10-0-38" id="h10-0-38" class="i">+)
</a><a href="#h10-0-39" id="h10-0-39" class="i">+
</a><b>diff --git a/<a id="h11" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/DataProcessors.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/DataProcessors.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/DataProcessors.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/DataProcessors.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,94 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+package me.rhunk.snapenhance.core.config
</a><a href="#h11-0-1" id="h11-0-1" class="i">+
</a><a href="#h11-0-2" id="h11-0-2" class="i">+import com.google.gson.JsonArray
</a><a href="#h11-0-3" id="h11-0-3" class="i">+import com.google.gson.JsonElement
</a><a href="#h11-0-4" id="h11-0-4" class="i">+import com.google.gson.JsonNull
</a><a href="#h11-0-5" id="h11-0-5" class="i">+import com.google.gson.JsonObject
</a><a href="#h11-0-6" id="h11-0-6" class="i">+import com.google.gson.JsonPrimitive
</a><a href="#h11-0-7" id="h11-0-7" class="i">+
</a><a href="#h11-0-8" id="h11-0-8" class="i">+object DataProcessors {
</a><a href="#h11-0-9" id="h11-0-9" class="i">+    enum class Type {
</a><a href="#h11-0-10" id="h11-0-10" class="i">+        STRING,
</a><a href="#h11-0-11" id="h11-0-11" class="i">+        BOOLEAN,
</a><a href="#h11-0-12" id="h11-0-12" class="i">+        INTEGER,
</a><a href="#h11-0-13" id="h11-0-13" class="i">+        FLOAT,
</a><a href="#h11-0-14" id="h11-0-14" class="i">+        STRING_MULTIPLE_SELECTION,
</a><a href="#h11-0-15" id="h11-0-15" class="i">+        STRING_UNIQUE_SELECTION,
</a><a href="#h11-0-16" id="h11-0-16" class="i">+        CONTAINER,
</a><a href="#h11-0-17" id="h11-0-17" class="i">+    }
</a><a href="#h11-0-18" id="h11-0-18" class="i">+
</a><a href="#h11-0-19" id="h11-0-19" class="i">+    data class PropertyDataProcessor&lt;T&gt;
</a><a href="#h11-0-20" id="h11-0-20" class="i">+    internal constructor(
</a><a href="#h11-0-21" id="h11-0-21" class="i">+        val type: Type,
</a><a href="#h11-0-22" id="h11-0-22" class="i">+        private val serialize: (T) -&gt; JsonElement,
</a><a href="#h11-0-23" id="h11-0-23" class="i">+        private val deserialize: (JsonElement) -&gt; T
</a><a href="#h11-0-24" id="h11-0-24" class="i">+    ) {
</a><a href="#h11-0-25" id="h11-0-25" class="i">+        @Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h11-0-26" id="h11-0-26" class="i">+        fun serializeAny(value: Any) = serialize(value as T)
</a><a href="#h11-0-27" id="h11-0-27" class="i">+        fun deserializeAny(value: JsonElement) = deserialize(value)
</a><a href="#h11-0-28" id="h11-0-28" class="i">+    }
</a><a href="#h11-0-29" id="h11-0-29" class="i">+
</a><a href="#h11-0-30" id="h11-0-30" class="i">+    val STRING = PropertyDataProcessor(
</a><a href="#h11-0-31" id="h11-0-31" class="i">+        type = Type.STRING,
</a><a href="#h11-0-32" id="h11-0-32" class="i">+        serialize = {
</a><a href="#h11-0-33" id="h11-0-33" class="i">+            if (it != null) JsonPrimitive(it)
</a><a href="#h11-0-34" id="h11-0-34" class="i">+            else JsonNull.INSTANCE
</a><a href="#h11-0-35" id="h11-0-35" class="i">+        },
</a><a href="#h11-0-36" id="h11-0-36" class="i">+        deserialize = {
</a><a href="#h11-0-37" id="h11-0-37" class="i">+            if (it.isJsonNull) null
</a><a href="#h11-0-38" id="h11-0-38" class="i">+            else it.asString
</a><a href="#h11-0-39" id="h11-0-39" class="i">+        },
</a><a href="#h11-0-40" id="h11-0-40" class="i">+    )
</a><a href="#h11-0-41" id="h11-0-41" class="i">+
</a><a href="#h11-0-42" id="h11-0-42" class="i">+    val BOOLEAN = PropertyDataProcessor(
</a><a href="#h11-0-43" id="h11-0-43" class="i">+        type = Type.BOOLEAN,
</a><a href="#h11-0-44" id="h11-0-44" class="i">+        serialize = {
</a><a href="#h11-0-45" id="h11-0-45" class="i">+            if (it) JsonPrimitive(true)
</a><a href="#h11-0-46" id="h11-0-46" class="i">+            else JsonPrimitive(false)
</a><a href="#h11-0-47" id="h11-0-47" class="i">+        },
</a><a href="#h11-0-48" id="h11-0-48" class="i">+        deserialize = { it.asBoolean },
</a><a href="#h11-0-49" id="h11-0-49" class="i">+    )
</a><a href="#h11-0-50" id="h11-0-50" class="i">+
</a><a href="#h11-0-51" id="h11-0-51" class="i">+    val INTEGER = PropertyDataProcessor(
</a><a href="#h11-0-52" id="h11-0-52" class="i">+        type = Type.INTEGER,
</a><a href="#h11-0-53" id="h11-0-53" class="i">+        serialize = { JsonPrimitive(it) },
</a><a href="#h11-0-54" id="h11-0-54" class="i">+        deserialize = { it.asInt },
</a><a href="#h11-0-55" id="h11-0-55" class="i">+    )
</a><a href="#h11-0-56" id="h11-0-56" class="i">+
</a><a href="#h11-0-57" id="h11-0-57" class="i">+    val FLOAT = PropertyDataProcessor(
</a><a href="#h11-0-58" id="h11-0-58" class="i">+        type = Type.FLOAT,
</a><a href="#h11-0-59" id="h11-0-59" class="i">+        serialize = { JsonPrimitive(it) },
</a><a href="#h11-0-60" id="h11-0-60" class="i">+        deserialize = { it.asFloat },
</a><a href="#h11-0-61" id="h11-0-61" class="i">+    )
</a><a href="#h11-0-62" id="h11-0-62" class="i">+
</a><a href="#h11-0-63" id="h11-0-63" class="i">+    val STRING_MULTIPLE_SELECTION = PropertyDataProcessor(
</a><a href="#h11-0-64" id="h11-0-64" class="i">+        type = Type.STRING_MULTIPLE_SELECTION,
</a><a href="#h11-0-65" id="h11-0-65" class="i">+        serialize = { JsonArray().apply { it.forEach { add(it) } } },
</a><a href="#h11-0-66" id="h11-0-66" class="i">+        deserialize = { obj -&gt;
</a><a href="#h11-0-67" id="h11-0-67" class="i">+            obj.asJsonArray.map { it.asString }
</a><a href="#h11-0-68" id="h11-0-68" class="i">+        },
</a><a href="#h11-0-69" id="h11-0-69" class="i">+    )
</a><a href="#h11-0-70" id="h11-0-70" class="i">+
</a><a href="#h11-0-71" id="h11-0-71" class="i">+    val STRING_UNIQUE_SELECTION = PropertyDataProcessor(
</a><a href="#h11-0-72" id="h11-0-72" class="i">+        type = Type.STRING_UNIQUE_SELECTION,
</a><a href="#h11-0-73" id="h11-0-73" class="i">+        serialize = { JsonPrimitive(it) },
</a><a href="#h11-0-74" id="h11-0-74" class="i">+        deserialize = { obj -&gt; obj.takeIf { !it.isJsonNull }?.asString }
</a><a href="#h11-0-75" id="h11-0-75" class="i">+    )
</a><a href="#h11-0-76" id="h11-0-76" class="i">+
</a><a href="#h11-0-77" id="h11-0-77" class="i">+    fun &lt;T : ConfigContainer&gt; container(container: T) = PropertyDataProcessor(
</a><a href="#h11-0-78" id="h11-0-78" class="i">+        type = Type.CONTAINER,
</a><a href="#h11-0-79" id="h11-0-79" class="i">+        serialize = {
</a><a href="#h11-0-80" id="h11-0-80" class="i">+            JsonObject().apply {
</a><a href="#h11-0-81" id="h11-0-81" class="i">+                addProperty(&quot;state&quot;, it.globalState)
</a><a href="#h11-0-82" id="h11-0-82" class="i">+                add(&quot;properties&quot;, it.toJson())
</a><a href="#h11-0-83" id="h11-0-83" class="i">+            }
</a><a href="#h11-0-84" id="h11-0-84" class="i">+        },
</a><a href="#h11-0-85" id="h11-0-85" class="i">+        deserialize = { obj -&gt;
</a><a href="#h11-0-86" id="h11-0-86" class="i">+            val jsonObject = obj.asJsonObject
</a><a href="#h11-0-87" id="h11-0-87" class="i">+            container.apply {
</a><a href="#h11-0-88" id="h11-0-88" class="i">+                globalState = jsonObject[&quot;state&quot;].takeIf { !it.isJsonNull }?.asBoolean
</a><a href="#h11-0-89" id="h11-0-89" class="i">+                fromJson(jsonObject[&quot;properties&quot;].asJsonObject)
</a><a href="#h11-0-90" id="h11-0-90" class="i">+            }
</a><a href="#h11-0-91" id="h11-0-91" class="i">+        },
</a><a href="#h11-0-92" id="h11-0-92" class="i">+    )
</a><a href="#h11-0-93" id="h11-0-93" class="i">+}</a><a href="#h11-0-94" id="h11-0-94" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h12" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/ModConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ModConfig.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/ModConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/ModConfig.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,57 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+package me.rhunk.snapenhance.core.config
</a><a href="#h12-0-1" id="h12-0-1" class="i">+
</a><a href="#h12-0-2" id="h12-0-2" class="i">+import android.content.Context
</a><a href="#h12-0-3" id="h12-0-3" class="i">+import com.google.gson.Gson
</a><a href="#h12-0-4" id="h12-0-4" class="i">+import com.google.gson.GsonBuilder
</a><a href="#h12-0-5" id="h12-0-5" class="i">+import com.google.gson.JsonObject
</a><a href="#h12-0-6" id="h12-0-6" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h12-0-7" id="h12-0-7" class="i">+import me.rhunk.snapenhance.bridge.BridgeClient
</a><a href="#h12-0-8" id="h12-0-8" class="i">+import me.rhunk.snapenhance.bridge.FileLoaderWrapper
</a><a href="#h12-0-9" id="h12-0-9" class="i">+import me.rhunk.snapenhance.bridge.types.BridgeFileType
</a><a href="#h12-0-10" id="h12-0-10" class="i">+import me.rhunk.snapenhance.core.config.impl.RootConfig
</a><a href="#h12-0-11" id="h12-0-11" class="i">+
</a><a href="#h12-0-12" id="h12-0-12" class="i">+class ModConfig() {
</a><a href="#h12-0-13" id="h12-0-13" class="i">+    val root = RootConfig()
</a><a href="#h12-0-14" id="h12-0-14" class="i">+
</a><a href="#h12-0-15" id="h12-0-15" class="i">+    companion object {
</a><a href="#h12-0-16" id="h12-0-16" class="i">+        val gson: Gson = GsonBuilder().setPrettyPrinting().create()
</a><a href="#h12-0-17" id="h12-0-17" class="i">+    }
</a><a href="#h12-0-18" id="h12-0-18" class="i">+
</a><a href="#h12-0-19" id="h12-0-19" class="i">+    private val file = FileLoaderWrapper(BridgeFileType.CONFIG, &quot;{}&quot;.toByteArray(Charsets.UTF_8))
</a><a href="#h12-0-20" id="h12-0-20" class="i">+
</a><a href="#h12-0-21" id="h12-0-21" class="i">+    operator fun getValue(thisRef: Any?, property: Any?) = root
</a><a href="#h12-0-22" id="h12-0-22" class="i">+
</a><a href="#h12-0-23" id="h12-0-23" class="i">+    private fun load() {
</a><a href="#h12-0-24" id="h12-0-24" class="i">+        if (!file.isFileExists()) {
</a><a href="#h12-0-25" id="h12-0-25" class="i">+            writeConfig()
</a><a href="#h12-0-26" id="h12-0-26" class="i">+            return
</a><a href="#h12-0-27" id="h12-0-27" class="i">+        }
</a><a href="#h12-0-28" id="h12-0-28" class="i">+
</a><a href="#h12-0-29" id="h12-0-29" class="i">+        runCatching {
</a><a href="#h12-0-30" id="h12-0-30" class="i">+            loadConfig()
</a><a href="#h12-0-31" id="h12-0-31" class="i">+        }.onFailure {
</a><a href="#h12-0-32" id="h12-0-32" class="i">+            Logger.error(&quot;Failed to load config&quot;, it)
</a><a href="#h12-0-33" id="h12-0-33" class="i">+            writeConfig()
</a><a href="#h12-0-34" id="h12-0-34" class="i">+        }
</a><a href="#h12-0-35" id="h12-0-35" class="i">+    }
</a><a href="#h12-0-36" id="h12-0-36" class="i">+
</a><a href="#h12-0-37" id="h12-0-37" class="i">+    private fun loadConfig() {
</a><a href="#h12-0-38" id="h12-0-38" class="i">+        val configContent = file.read()
</a><a href="#h12-0-39" id="h12-0-39" class="i">+        root.fromJson(gson.fromJson(configContent.toString(Charsets.UTF_8), JsonObject::class.java))
</a><a href="#h12-0-40" id="h12-0-40" class="i">+    }
</a><a href="#h12-0-41" id="h12-0-41" class="i">+
</a><a href="#h12-0-42" id="h12-0-42" class="i">+    fun writeConfig() {
</a><a href="#h12-0-43" id="h12-0-43" class="i">+        val configObject = root.toJson()
</a><a href="#h12-0-44" id="h12-0-44" class="i">+        file.write(configObject.toString().toByteArray(Charsets.UTF_8))
</a><a href="#h12-0-45" id="h12-0-45" class="i">+    }
</a><a href="#h12-0-46" id="h12-0-46" class="i">+
</a><a href="#h12-0-47" id="h12-0-47" class="i">+    fun loadFromContext(context: Context) {
</a><a href="#h12-0-48" id="h12-0-48" class="i">+        file.loadFromContext(context)
</a><a href="#h12-0-49" id="h12-0-49" class="i">+        load()
</a><a href="#h12-0-50" id="h12-0-50" class="i">+    }
</a><a href="#h12-0-51" id="h12-0-51" class="i">+
</a><a href="#h12-0-52" id="h12-0-52" class="i">+    fun loadFromBridge(bridgeClient: BridgeClient) {
</a><a href="#h12-0-53" id="h12-0-53" class="i">+        file.loadFromBridge(bridgeClient)
</a><a href="#h12-0-54" id="h12-0-54" class="i">+        load()
</a><a href="#h12-0-55" id="h12-0-55" class="i">+    }
</a><a href="#h12-0-56" id="h12-0-56" class="i">+}</a><a href="#h12-0-57" id="h12-0-57" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h13" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Camera.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Camera.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Camera.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Camera.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,15 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h13-0-1" id="h13-0-1" class="i">+
</a><a href="#h13-0-2" id="h13-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h13-0-3" id="h13-0-3" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.CameraTweaks
</a><a href="#h13-0-4" id="h13-0-4" class="i">+
</a><a href="#h13-0-5" id="h13-0-5" class="i">+class Camera : ConfigContainer() {
</a><a href="#h13-0-6" id="h13-0-6" class="i">+    val disable = boolean(&quot;disable_camera&quot;)
</a><a href="#h13-0-7" id="h13-0-7" class="i">+    val immersiveCameraPreview = boolean(&quot;immersive_camera_preview&quot;)
</a><a href="#h13-0-8" id="h13-0-8" class="i">+    val overridePreviewResolution = unique(&quot;override_preview_resolution&quot;, *CameraTweaks.resolutions.toTypedArray())
</a><a href="#h13-0-9" id="h13-0-9" class="i">+        { shouldTranslate = false }
</a><a href="#h13-0-10" id="h13-0-10" class="i">+    val overridePictureResolution = unique(&quot;override_picture_resolution&quot;, *CameraTweaks.resolutions.toTypedArray())
</a><a href="#h13-0-11" id="h13-0-11" class="i">+        { shouldTranslate = false }
</a><a href="#h13-0-12" id="h13-0-12" class="i">+    val forceHighestFrameRate = boolean(&quot;force_highest_frame_rate&quot;)
</a><a href="#h13-0-13" id="h13-0-13" class="i">+    val forceCameraSourceEncoding = boolean(&quot;force_camera_source_encoding&quot;)
</a><a href="#h13-0-14" id="h13-0-14" class="i">+}
</a><b>diff --git a/<a id="h14" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/DownloaderConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/DownloaderConfig.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/DownloaderConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/DownloaderConfig.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,24 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h14-0-1" id="h14-0-1" class="i">+
</a><a href="#h14-0-2" id="h14-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h14-0-3" id="h14-0-3" class="i">+
</a><a href="#h14-0-4" id="h14-0-4" class="i">+class DownloaderConfig : ConfigContainer() {
</a><a href="#h14-0-5" id="h14-0-5" class="i">+    val saveFolder = string(&quot;save_folder&quot;) { isFolder = true }
</a><a href="#h14-0-6" id="h14-0-6" class="i">+    val autoDownloadOptions = multiple(&quot;auto_download_options&quot;,
</a><a href="#h14-0-7" id="h14-0-7" class="i">+        &quot;friend_snaps&quot;,
</a><a href="#h14-0-8" id="h14-0-8" class="i">+        &quot;friend_stories&quot;,
</a><a href="#h14-0-9" id="h14-0-9" class="i">+        &quot;public_stories&quot;,
</a><a href="#h14-0-10" id="h14-0-10" class="i">+        &quot;spotlight&quot;
</a><a href="#h14-0-11" id="h14-0-11" class="i">+    )
</a><a href="#h14-0-12" id="h14-0-12" class="i">+    val pathFormat = multiple(&quot;path_format&quot;,
</a><a href="#h14-0-13" id="h14-0-13" class="i">+        &quot;create_user_folder&quot;,
</a><a href="#h14-0-14" id="h14-0-14" class="i">+        &quot;append_hash&quot;,
</a><a href="#h14-0-15" id="h14-0-15" class="i">+        &quot;append_date_time&quot;,
</a><a href="#h14-0-16" id="h14-0-16" class="i">+        &quot;append_type&quot;,
</a><a href="#h14-0-17" id="h14-0-17" class="i">+        &quot;append_username&quot;
</a><a href="#h14-0-18" id="h14-0-18" class="i">+    )
</a><a href="#h14-0-19" id="h14-0-19" class="i">+    val allowDuplicate = boolean(&quot;allow_duplicate&quot;)
</a><a href="#h14-0-20" id="h14-0-20" class="i">+    val mergeOverlays = boolean(&quot;merge_overlays&quot;)
</a><a href="#h14-0-21" id="h14-0-21" class="i">+    val chatDownloadContextMenu = boolean(&quot;chat_download_context_menu&quot;)
</a><a href="#h14-0-22" id="h14-0-22" class="i">+    val logging = multiple(&quot;logging&quot;, &quot;started&quot;, &quot;success&quot;, &quot;progress&quot;, &quot;failure&quot;)
</a><a href="#h14-0-23" id="h14-0-23" class="i">+}</a><a href="#h14-0-24" id="h14-0-24" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Experimental.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Experimental.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Experimental.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Experimental.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,11 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h15-0-3" id="h15-0-3" class="i">+
</a><a href="#h15-0-4" id="h15-0-4" class="i">+class Experimental : ConfigContainer() {
</a><a href="#h15-0-5" id="h15-0-5" class="i">+    val appPasscode = string(&quot;app_passcode&quot;)
</a><a href="#h15-0-6" id="h15-0-6" class="i">+    val appLockOnResume = boolean(&quot;app_lock_on_resume&quot;)
</a><a href="#h15-0-7" id="h15-0-7" class="i">+    val infiniteStoryBoost = boolean(&quot;infinite_story_boost&quot;)
</a><a href="#h15-0-8" id="h15-0-8" class="i">+    val meoPasscodeBypass = boolean(&quot;meo_passcode_bypass&quot;)
</a><a href="#h15-0-9" id="h15-0-9" class="i">+    val unlimitedMultiSnap = boolean(&quot;unlimited_multi_snap&quot;)
</a><a href="#h15-0-10" id="h15-0-10" class="i">+}</a><a href="#h15-0-11" id="h15-0-11" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Global.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -0,0 +1,16 @@
</a><a href="#h16-0-0" id="h16-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h16-0-1" id="h16-0-1" class="i">+
</a><a href="#h16-0-2" id="h16-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h16-0-3" id="h16-0-3" class="i">+import me.rhunk.snapenhance.data.NotificationType
</a><a href="#h16-0-4" id="h16-0-4" class="i">+
</a><a href="#h16-0-5" id="h16-0-5" class="i">+class Global : ConfigContainer() {
</a><a href="#h16-0-6" id="h16-0-6" class="i">+    val snapchatPlus = boolean(&quot;snapchat_plus&quot;)
</a><a href="#h16-0-7" id="h16-0-7" class="i">+    val autoUpdater = unique(&quot;auto_updater&quot;, &quot;DAILY&quot;,&quot;EVERY_LAUNCH&quot;, &quot;DAILY&quot;, &quot;WEEKLY&quot;)
</a><a href="#h16-0-8" id="h16-0-8" class="i">+    val disableMetrics = boolean(&quot;disable_metrics&quot;)
</a><a href="#h16-0-9" id="h16-0-9" class="i">+    val disableVideoLengthRestrictions = boolean(&quot;disable_video_length_restrictions&quot;)
</a><a href="#h16-0-10" id="h16-0-10" class="i">+    val disableGooglePlayDialogs = boolean(&quot;disable_google_play_dialogs&quot;)
</a><a href="#h16-0-11" id="h16-0-11" class="i">+    val forceMediaSourceQuality = boolean(&quot;force_media_source_quality&quot;)
</a><a href="#h16-0-12" id="h16-0-12" class="i">+    val betterNotifications = multiple(&quot;better_notifications&quot;, &quot;snap&quot;, &quot;chat&quot;, &quot;reply_button&quot;, &quot;download_button&quot;)
</a><a href="#h16-0-13" id="h16-0-13" class="i">+    val notificationBlacklist = multiple(&quot;notification_blacklist&quot;, *NotificationType.getIncomingValues().map { it.key }.toTypedArray())
</a><a href="#h16-0-14" id="h16-0-14" class="i">+    val disableSnapSplitting = boolean(&quot;disable_snap_splitting&quot;)
</a><a href="#h16-0-15" id="h16-0-15" class="i">+}</a><a href="#h16-0-16" id="h16-0-16" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h17" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/MessagingTweaks.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -0,0 +1,25 @@
</a><a href="#h17-0-0" id="h17-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h17-0-1" id="h17-0-1" class="i">+
</a><a href="#h17-0-2" id="h17-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h17-0-3" id="h17-0-3" class="i">+import me.rhunk.snapenhance.data.NotificationType
</a><a href="#h17-0-4" id="h17-0-4" class="i">+
</a><a href="#h17-0-5" id="h17-0-5" class="i">+class MessagingTweaks : ConfigContainer() {
</a><a href="#h17-0-6" id="h17-0-6" class="i">+    val anonymousStoryViewing = boolean(&quot;annonymous_story_viewing&quot;)
</a><a href="#h17-0-7" id="h17-0-7" class="i">+    val preventReadReceipts = boolean(&quot;prevent_read_receipts&quot;)
</a><a href="#h17-0-8" id="h17-0-8" class="i">+    val hideBitmojiPresence = boolean(&quot;hide_bitmoji_presence&quot;)
</a><a href="#h17-0-9" id="h17-0-9" class="i">+    val hideTypingNotifications = boolean(&quot;hide_typing_notifications&quot;)
</a><a href="#h17-0-10" id="h17-0-10" class="i">+    val unlimitedSnapViewTime = boolean(&quot;unlimited_snap_view_time&quot;)
</a><a href="#h17-0-11" id="h17-0-11" class="i">+    val preventMessageSending = multiple(&quot;prevent_message_sending&quot;, *NotificationType.getOutgoingValues().map { it.key }.toTypedArray())
</a><a href="#h17-0-12" id="h17-0-12" class="i">+    val messageLogger = boolean(&quot;message_logger&quot;)
</a><a href="#h17-0-13" id="h17-0-13" class="i">+    val autoSaveMessagesInConversations = multiple(&quot;auto_save_messages_in_conversations&quot;,
</a><a href="#h17-0-14" id="h17-0-14" class="i">+        &quot;CHAT&quot;,
</a><a href="#h17-0-15" id="h17-0-15" class="i">+        &quot;SNAP&quot;,
</a><a href="#h17-0-16" id="h17-0-16" class="i">+        &quot;NOTE&quot;,
</a><a href="#h17-0-17" id="h17-0-17" class="i">+        &quot;EXTERNAL_MEDIA&quot;,
</a><a href="#h17-0-18" id="h17-0-18" class="i">+        &quot;STICKER&quot;
</a><a href="#h17-0-19" id="h17-0-19" class="i">+    )
</a><a href="#h17-0-20" id="h17-0-20" class="i">+
</a><a href="#h17-0-21" id="h17-0-21" class="i">+    val galleryMediaSendOverride = unique(&quot;gallery_media_send_override&quot;,  &quot;NOTE&quot;, &quot;SNAP&quot;, &quot;LIVE_SNAP&quot;)
</a><a href="#h17-0-22" id="h17-0-22" class="i">+    val messagePreviewLength = integer(&quot;message_preview_length&quot;, defaultValue = 20)
</a><a href="#h17-0-23" id="h17-0-23" class="i">+
</a><a href="#h17-0-24" id="h17-0-24" class="i">+}</a><a href="#h17-0-25" id="h17-0-25" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/RootConfig.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -0,0 +1,15 @@
</a><a href="#h18-0-0" id="h18-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h18-0-1" id="h18-0-1" class="i">+
</a><a href="#h18-0-2" id="h18-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h18-0-3" id="h18-0-3" class="i">+import me.rhunk.snapenhance.data.NotificationType
</a><a href="#h18-0-4" id="h18-0-4" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.CameraTweaks
</a><a href="#h18-0-5" id="h18-0-5" class="i">+
</a><a href="#h18-0-6" id="h18-0-6" class="i">+class RootConfig : ConfigContainer() {
</a><a href="#h18-0-7" id="h18-0-7" class="i">+    val downloader = container(&quot;downloader&quot;, DownloaderConfig())
</a><a href="#h18-0-8" id="h18-0-8" class="i">+    val userInterface = container(&quot;user_interface&quot;, UserInterfaceTweaks())
</a><a href="#h18-0-9" id="h18-0-9" class="i">+    val messaging = container(&quot;messaging&quot;, MessagingTweaks())
</a><a href="#h18-0-10" id="h18-0-10" class="i">+    val global = container(&quot;global&quot;, Global())
</a><a href="#h18-0-11" id="h18-0-11" class="i">+    val camera = container(&quot;camera&quot;, Camera())
</a><a href="#h18-0-12" id="h18-0-12" class="i">+    val experimental = container(&quot;experimental&quot;, Experimental())
</a><a href="#h18-0-13" id="h18-0-13" class="i">+    val spoof = container(&quot;spoof&quot;, Spoof())
</a><a href="#h18-0-14" id="h18-0-14" class="i">+}</a><a href="#h18-0-15" id="h18-0-15" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h19" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/Spoof.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h19-0-1" id="h19-0-1" class="i">+
</a><a href="#h19-0-2" id="h19-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h19-0-3" id="h19-0-3" class="i">+
</a><a href="#h19-0-4" id="h19-0-4" class="i">+class Spoof : ConfigContainer() {
</a><a href="#h19-0-5" id="h19-0-5" class="i">+    inner class Location : ConfigContainer(globalState = false) {
</a><a href="#h19-0-6" id="h19-0-6" class="i">+        val latitude = float(&quot;location_latitude&quot;)
</a><a href="#h19-0-7" id="h19-0-7" class="i">+        val longitude = float(&quot;location_longitude&quot;)
</a><a href="#h19-0-8" id="h19-0-8" class="i">+    }
</a><a href="#h19-0-9" id="h19-0-9" class="i">+    val location = container(&quot;location&quot;, Location())
</a><a href="#h19-0-10" id="h19-0-10" class="i">+
</a><a href="#h19-0-11" id="h19-0-11" class="i">+    inner class Device : ConfigContainer(globalState = false) {
</a><a href="#h19-0-12" id="h19-0-12" class="i">+        val fingerprint = string(&quot;device_fingerprint&quot;)
</a><a href="#h19-0-13" id="h19-0-13" class="i">+        val androidId = string(&quot;device_android_id&quot;)
</a><a href="#h19-0-14" id="h19-0-14" class="i">+    }
</a><a href="#h19-0-15" id="h19-0-15" class="i">+    val device = container(&quot;device&quot;, Device())
</a><a href="#h19-0-16" id="h19-0-16" class="i">+}</a><a href="#h19-0-17" id="h19-0-17" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/UserInterfaceTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/UserInterfaceTweaks.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/UserInterfaceTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/config/impl/UserInterfaceTweaks.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -0,0 +1,34 @@
</a><a href="#h20-0-0" id="h20-0-0" class="i">+package me.rhunk.snapenhance.core.config.impl
</a><a href="#h20-0-1" id="h20-0-1" class="i">+
</a><a href="#h20-0-2" id="h20-0-2" class="i">+import me.rhunk.snapenhance.core.config.ConfigContainer
</a><a href="#h20-0-3" id="h20-0-3" class="i">+
</a><a href="#h20-0-4" id="h20-0-4" class="i">+class UserInterfaceTweaks : ConfigContainer() {
</a><a href="#h20-0-5" id="h20-0-5" class="i">+    val enableAppAppearance = boolean(&quot;enable_app_appearance&quot;)
</a><a href="#h20-0-6" id="h20-0-6" class="i">+    val amoledDarkMode = boolean(&quot;amoled_dark_mode&quot;)
</a><a href="#h20-0-7" id="h20-0-7" class="i">+    val blockAds = boolean(&quot;block_ads&quot;)
</a><a href="#h20-0-8" id="h20-0-8" class="i">+    val mapFriendNameTags = boolean(&quot;map_friend_nametags&quot;)
</a><a href="#h20-0-9" id="h20-0-9" class="i">+    val streakExpirationInfo = boolean(&quot;streak_expiration_info&quot;)
</a><a href="#h20-0-10" id="h20-0-10" class="i">+    val hideStorySections = multiple(&quot;hide_story_sections&quot;, &quot;hide_friend_suggestions&quot;, &quot;hide_friends&quot;, &quot;hide_following&quot;, &quot;hide_for_you&quot;)
</a><a href="#h20-0-11" id="h20-0-11" class="i">+    val hideUiComponents = multiple(
</a><a href="#h20-0-12" id="h20-0-12" class="i">+        &quot;hide_ui_components&quot;,
</a><a href="#h20-0-13" id="h20-0-13" class="i">+        &quot;hide_voice_record_button&quot;,
</a><a href="#h20-0-14" id="h20-0-14" class="i">+        &quot;hide_stickers_button&quot;,
</a><a href="#h20-0-15" id="h20-0-15" class="i">+        &quot;hide_cognac_button&quot;,
</a><a href="#h20-0-16" id="h20-0-16" class="i">+        &quot;hide_live_location_share_button&quot;,
</a><a href="#h20-0-17" id="h20-0-17" class="i">+        &quot;hide_call_buttons&quot;
</a><a href="#h20-0-18" id="h20-0-18" class="i">+    )
</a><a href="#h20-0-19" id="h20-0-19" class="i">+    val disableSpotlight = boolean(&quot;disable_spotlight&quot;)
</a><a href="#h20-0-20" id="h20-0-20" class="i">+    val startupTab = unique(&quot;startup_tab&quot;, &quot;ngs_map_icon_container&quot;,
</a><a href="#h20-0-21" id="h20-0-21" class="i">+        &quot;ngs_map_icon_container&quot;,
</a><a href="#h20-0-22" id="h20-0-22" class="i">+        &quot;ngs_chat_icon_container&quot;,
</a><a href="#h20-0-23" id="h20-0-23" class="i">+        &quot;ngs_camera_icon_container&quot;,
</a><a href="#h20-0-24" id="h20-0-24" class="i">+        &quot;ngs_community_icon_container&quot;,
</a><a href="#h20-0-25" id="h20-0-25" class="i">+        &quot;ngs_spotlight_icon_container&quot;,
</a><a href="#h20-0-26" id="h20-0-26" class="i">+        &quot;ngs_search_icon_container&quot;
</a><a href="#h20-0-27" id="h20-0-27" class="i">+    )
</a><a href="#h20-0-28" id="h20-0-28" class="i">+    val storyViewerOverride = unique(&quot;story_viewer_override&quot;, &quot;DISCOVER_PLAYBACK_SEEKBAR&quot;, &quot;VERTICAL_STORY_VIEWER&quot;)
</a><a href="#h20-0-29" id="h20-0-29" class="i">+
</a><a href="#h20-0-30" id="h20-0-30" class="i">+    val friendFeedMenuButtons = multiple(&quot;friend_feed_menu_buttons&quot;, &quot;auto_download_blacklist&quot;, &quot;anti_auto_save&quot;, &quot;stealth_mode&quot;, &quot;conversation_info&quot;)
</a><a href="#h20-0-31" id="h20-0-31" class="i">+    val enableFriendFeedMenuBar = boolean(&quot;enable_friend_feed_menu_bar&quot;)
</a><a href="#h20-0-32" id="h20-0-32" class="i">+    val friendFeedMenuPosition = integer(&quot;friend_feed_menu_position&quot;, defaultValue = 1)
</a><a href="#h20-0-33" id="h20-0-33" class="i">+}
</a><b>diff --git a/<a id="h21" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -20,6 +20,7 @@ import me.rhunk.snapenhance.SharedContext
</a> import me.rhunk.snapenhance.bridge.DownloadCallback
 import me.rhunk.snapenhance.bridge.wrapper.ConfigWrapper
 import me.rhunk.snapenhance.config.ConfigProperty
<a href="#h21-0-3" id="h21-0-3" class="i">+import me.rhunk.snapenhance.core.config.ModConfig
</a> import me.rhunk.snapenhance.data.FileType
 import me.rhunk.snapenhance.download.data.DownloadMetadata
 import me.rhunk.snapenhance.download.data.DownloadRequest
<a href="#h21-1" id="h21-1" class="h">@@ -117,7 +118,7 @@ class DownloadProcessor (
</a>     private suspend fun saveMediaToGallery(inputFile: File, pendingDownload: PendingDownload) {
         if (coroutineContext.job.isCancelled) return
 
<a href="#h21-1-3" id="h21-1-3" class="d">-        val config = ConfigWrapper().apply { loadFromContext(context) }
</a><a href="#h21-1-4" id="h21-1-4" class="i">+        val config by ModConfig().apply { loadFromContext(context) }
</a> 
         runCatching {
             val fileType = FileType.fromFile(inputFile)
<a href="#h21-2" id="h21-2" class="h">@@ -128,7 +129,7 @@ class DownloadProcessor (
</a> 
             val fileName = pendingDownload.metadata.outputPath.substringAfterLast(&quot;/&quot;) + &quot;.&quot; + fileType.fileExtension
 
<a href="#h21-2-3" id="h21-2-3" class="d">-            val outputFolder = DocumentFile.fromTreeUri(context, Uri.parse(config.string(ConfigProperty.SAVE_FOLDER)))
</a><a href="#h21-2-4" id="h21-2-4" class="i">+            val outputFolder = DocumentFile.fromTreeUri(context, Uri.parse(config.downloader.saveFolder.get()))
</a>                 ?: throw Exception(&quot;Failed to open output folder&quot;)
 
             val outputFileFolder = pendingDownload.metadata.outputPath.let {
<b>diff --git a/<a id="h22" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -1,7 +1,6 @@
</a> package me.rhunk.snapenhance.features.impl
 
 import android.annotation.SuppressLint
<a href="#h22-0-3" id="h22-0-3" class="d">-import android.app.AlertDialog
</a> import android.app.DownloadManager
 import android.content.BroadcastReceiver
 import android.content.Context
<a href="#h22-1" id="h22-1" class="h">@@ -9,23 +8,22 @@ import android.content.Intent
</a> import android.content.IntentFilter
 import android.net.Uri
 import android.os.Environment
<a href="#h22-1-3" id="h22-1-3" class="d">-import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h22-1-4" id="h22-1-4" class="i">+import com.google.gson.JsonParser
</a> import me.rhunk.snapenhance.Logger
<a href="#h22-1-6" id="h22-1-6" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h22-1-7" id="h22-1-7" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a> import me.rhunk.snapenhance.features.Feature
 import me.rhunk.snapenhance.features.FeatureLoadParams
 import me.rhunk.snapenhance.ui.ViewAppearanceHelper
 import okhttp3.OkHttpClient
 import okhttp3.Request
<a href="#h22-1-13" id="h22-1-13" class="d">-import org.json.JSONArray
</a> 
 class AutoUpdater : Feature(&quot;AutoUpdater&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
<a href="#h22-1-17" id="h22-1-17" class="d">-        val checkForUpdateMode = context.config.state(ConfigProperty.AUTO_UPDATER)
</a><a href="#h22-1-18" id="h22-1-18" class="i">+        val autoUpdaterTime = context.config.global.autoUpdater.getNullable() ?: return
</a>         val currentTimeMillis = System.currentTimeMillis()
         val checkForUpdatesTimestamp = context.bridgeClient.getAutoUpdaterTime()
 
<a href="#h22-1-22" id="h22-1-22" class="d">-        val delayTimestamp = when (checkForUpdateMode) {
</a><a href="#h22-1-23" id="h22-1-23" class="i">+        val delayTimestamp = when (autoUpdaterTime) {
</a>             &quot;EVERY_LAUNCH&quot; -&gt; currentTimeMillis - checkForUpdatesTimestamp
             &quot;DAILY&quot; -&gt; 86400000L
             &quot;WEEKLY&quot; -&gt; 604800000L
<a href="#h22-2" id="h22-2" class="h">@@ -50,16 +48,16 @@ class AutoUpdater : Feature(&quot;AutoUpdater&quot;, loadParams = FeatureLoadParams.ACTIVI
</a> 
         if (!response.isSuccessful) throw Throwable(&quot;Failed to fetch releases: ${response.code}&quot;)
 
<a href="#h22-2-3" id="h22-2-3" class="d">-        val releases = JSONArray(response.body.string()).also {
</a><a href="#h22-2-4" id="h22-2-4" class="d">-            if (it.length() == 0) throw Throwable(&quot;No releases found&quot;)
</a><a href="#h22-2-5" id="h22-2-5" class="i">+        val releases = JsonParser.parseString(response.body.string()).asJsonArray.also {
</a><a href="#h22-2-6" id="h22-2-6" class="i">+            if (it.size() == 0) throw Throwable(&quot;No releases found&quot;)
</a>         }
 
<a href="#h22-2-9" id="h22-2-9" class="d">-        val latestRelease = releases.getJSONObject(0)
</a><a href="#h22-2-10" id="h22-2-10" class="d">-        val latestVersion = latestRelease.getString(&quot;tag_name&quot;)
</a><a href="#h22-2-11" id="h22-2-11" class="i">+        val latestRelease = releases.get(0).asJsonObject
</a><a href="#h22-2-12" id="h22-2-12" class="i">+        val latestVersion = latestRelease.getAsJsonPrimitive(&quot;tag_name&quot;).asString
</a>         if (latestVersion.removePrefix(&quot;v&quot;) == BuildConfig.VERSION_NAME) return null
 
<a href="#h22-2-15" id="h22-2-15" class="d">-        val releaseContentBody = latestRelease.getString(&quot;body&quot;)
</a><a href="#h22-2-16" id="h22-2-16" class="d">-        val downloadEndpoint = latestRelease.getJSONArray(&quot;assets&quot;).getJSONObject(0).getString(&quot;browser_download_url&quot;)
</a><a href="#h22-2-17" id="h22-2-17" class="i">+        val releaseContentBody = latestRelease.getAsJsonPrimitive(&quot;body&quot;).asString
</a><a href="#h22-2-18" id="h22-2-18" class="i">+        val downloadEndpoint = latestRelease.getAsJsonArray(&quot;assets&quot;).get(0).asJsonObject.getAsJsonPrimitive(&quot;browser_download_url&quot;).asString
</a> 
         context.runOnUiThread {
             ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
<b>diff --git a/<a id="h23" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -55,7 +55,7 @@ class ConfigEnumKeys : Feature(&quot;Config enum keys&quot;, loadParams = FeatureLoadParam
</a> 
     @SuppressLint(&quot;PrivateApi&quot;)
     override fun onActivityCreate() {
<a href="#h23-0-3" id="h23-0-3" class="d">-        if (context.config.bool(ConfigProperty.NEW_MAP_UI)) {
</a><a href="#h23-0-4" id="h23-0-4" class="i">+        if (context.config.userInterface.mapFriendNameTags.get()) {
</a>             hookAllEnums(context.mappings.getMappedClass(&quot;enums&quot;, &quot;PLUS&quot;)) {
                 if (key == &quot;REDUCE_MY_PROFILE_UI_COMPLEXITY&quot;) set(true)
             }
<a href="#h23-1" id="h23-1" class="h">@@ -63,17 +63,17 @@ class ConfigEnumKeys : Feature(&quot;Config enum keys&quot;, loadParams = FeatureLoadParam
</a> 
         hookAllEnums(context.mappings.getMappedClass(&quot;enums&quot;, &quot;ARROYO&quot;)) {
             if (key == &quot;ENABLE_LONG_SNAP_SENDING&quot;) {
<a href="#h23-1-3" id="h23-1-3" class="d">-                if (context.config.bool(ConfigProperty.DISABLE_SNAP_SPLITTING)) set(true)
</a><a href="#h23-1-4" id="h23-1-4" class="i">+                if (context.config.global.disableSnapSplitting.get()) set(true)
</a>             }
         }
 
<a href="#h23-1-8" id="h23-1-8" class="d">-        if (context.config.bool(ConfigProperty.STREAK_EXPIRATION_INFO)) {
</a><a href="#h23-1-9" id="h23-1-9" class="i">+        if (context.config.userInterface.streakExpirationInfo.get()) {
</a>             hookAllEnums(context.mappings.getMappedClass(&quot;enums&quot;, &quot;FRIENDS_FEED&quot;)) {
                 if (key == &quot;STREAK_EXPIRATION_INFO&quot;) set(true)
             }
         }
 
<a href="#h23-1-15" id="h23-1-15" class="d">-        if (context.config.bool(ConfigProperty.BLOCK_ADS)) {
</a><a href="#h23-1-16" id="h23-1-16" class="i">+        if (context.config.userInterface.blockAds.get()) {
</a>             hookAllEnums(context.mappings.getMappedClass(&quot;enums&quot;, &quot;SNAPADS&quot;)) {
                 if (key == &quot;BYPASS_AD_FEATURE_GATE&quot;) {
                     set(true)
<a href="#h23-2" id="h23-2" class="h">@@ -84,14 +84,12 @@ class ConfigEnumKeys : Feature(&quot;Config enum keys&quot;, loadParams = FeatureLoadParam
</a>             }
         }
 
<a href="#h23-2-3" id="h23-2-3" class="d">-        context.config.state(ConfigProperty.STORY_VIEWER_OVERRIDE).let { state -&gt;
</a><a href="#h23-2-4" id="h23-2-4" class="d">-            if (state == &quot;OFF&quot;) return@let
</a><a href="#h23-2-5" id="h23-2-5" class="d">-
</a><a href="#h23-2-6" id="h23-2-6" class="i">+        context.config.userInterface.storyViewerOverride.getNullable()?.let { value -&gt;
</a>             hookAllEnums(context.mappings.getMappedClass(&quot;enums&quot;, &quot;DISCOVER_FEED&quot;)) {
<a href="#h23-2-8" id="h23-2-8" class="d">-                if (key == &quot;DF_ENABLE_SHOWS_PAGE_CONTROLS&quot; &amp;&amp; state == &quot;DISCOVER_PLAYBACK_SEEKBAR&quot;) {
</a><a href="#h23-2-9" id="h23-2-9" class="i">+                if (key == &quot;DF_ENABLE_SHOWS_PAGE_CONTROLS&quot; &amp;&amp; value == &quot;DISCOVER_PLAYBACK_SEEKBAR&quot;) {
</a>                     set(true)
                 }
<a href="#h23-2-12" id="h23-2-12" class="d">-                if (key == &quot;DF_VOPERA_FOR_STORIES&quot; &amp;&amp; state == &quot;VERTICAL_STORY_VIEWER&quot;) {
</a><a href="#h23-2-13" id="h23-2-13" class="i">+                if (key == &quot;DF_VOPERA_FOR_STORIES&quot; &amp;&amp; value == &quot;VERTICAL_STORY_VIEWER&quot;) {
</a>                     set(true)
                 }
             }
<a href="#h23-3" id="h23-3" class="h">@@ -105,8 +103,8 @@ class ConfigEnumKeys : Feature(&quot;Config enum keys&quot;, loadParams = FeatureLoadParam
</a> 
         sharedPreferencesImpl.methods.first { it.name == &quot;getBoolean&quot; }.hook(HookStage.BEFORE) { param -&gt;
             when (param.arg&lt;String&gt;(0)) {
<a href="#h23-3-3" id="h23-3-3" class="d">-                &quot;SIG_APP_APPEARANCE_SETTING&quot; -&gt; if (context.config.bool(ConfigProperty.ENABLE_APP_APPEARANCE)) param.setResult(true)
</a><a href="#h23-3-4" id="h23-3-4" class="d">-                &quot;SPOTLIGHT_5TH_TAB_ENABLED&quot; -&gt; if (context.config.bool(ConfigProperty.DISABLE_SPOTLIGHT)) param.setResult(false)
</a><a href="#h23-3-5" id="h23-3-5" class="i">+                &quot;SIG_APP_APPEARANCE_SETTING&quot; -&gt; if (context.config.userInterface.enableAppAppearance.get()) param.setResult(true)
</a><a href="#h23-3-6" id="h23-3-6" class="i">+                &quot;SPOTLIGHT_5TH_TAB_ENABLED&quot; -&gt; if (context.config.userInterface.disableSpotlight.get()) param.setResult(false)
</a>             }
         }
     }
<b>diff --git a/<a id="h24" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -61,9 +61,12 @@ class Messaging : Feature(&quot;Messaging&quot;, loadParams = FeatureLoadParams.ACTIVITY_C
</a>     override fun asyncInit() {
         val stealthMode = context.feature(StealthMode::class)
 
<a href="#h24-0-3" id="h24-0-3" class="i">+        val hideBitmojiPresence by context.config.messaging.hideBitmojiPresence
</a><a href="#h24-0-4" id="h24-0-4" class="i">+        val hideTypingNotification by context.config.messaging.hideTypingNotifications
</a><a href="#h24-0-5" id="h24-0-5" class="i">+
</a>         arrayOf(&quot;activate&quot;, &quot;deactivate&quot;, &quot;processTypingActivity&quot;).forEach { hook -&gt;
             Hooker.hook(context.classCache.presenceSession, hook, HookStage.BEFORE, {
<a href="#h24-0-8" id="h24-0-8" class="d">-                context.config.bool(ConfigProperty.HIDE_BITMOJI_PRESENCE) || stealthMode.isStealth(openedConversationUUID.toString())
</a><a href="#h24-0-9" id="h24-0-9" class="i">+                hideBitmojiPresence || stealthMode.isStealth(openedConversationUUID.toString())
</a>             }) {
                 it.setResult(null)
             }
<a href="#h24-1" id="h24-1" class="h">@@ -81,7 +84,7 @@ class Messaging : Feature(&quot;Messaging&quot;, loadParams = FeatureLoadParams.ACTIVITY_C
</a>         }
 
         Hooker.hook(context.classCache.conversationManager, &quot;sendTypingNotification&quot;, HookStage.BEFORE, {
<a href="#h24-1-3" id="h24-1-3" class="d">-            context.config.bool(ConfigProperty.HIDE_TYPING_NOTIFICATION) || stealthMode.isStealth(openedConversationUUID.toString())
</a><a href="#h24-1-4" id="h24-1-4" class="i">+            hideTypingNotification || stealthMode.isStealth(openedConversationUUID.toString())
</a>         }) {
             it.setResult(null)
         }
<b>diff --git a/<a id="h25" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -14,7 +14,6 @@ import me.rhunk.snapenhance.bridge.DownloadCallback
</a> import me.rhunk.snapenhance.config.ConfigProperty
 import me.rhunk.snapenhance.data.ContentType
 import me.rhunk.snapenhance.data.FileType
<a href="#h25-0-3" id="h25-0-3" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a> import me.rhunk.snapenhance.data.wrapper.impl.media.MediaInfo
 import me.rhunk.snapenhance.data.wrapper.impl.media.dash.LongformVideoPlaylistItem
 import me.rhunk.snapenhance.data.wrapper.impl.media.dash.SnapPlaylistItem
<a href="#h25-1" id="h25-1" class="h">@@ -73,8 +72,8 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>             BitmojiSelfie.getBitmojiSelfie(it.bitmojiSelfieId!!, it.bitmojiAvatarId!!, BitmojiSelfie.BitmojiSelfieType.THREE_D)
         }
 
<a href="#h25-1-3" id="h25-1-3" class="d">-        val downloadLogging = context.config.options(ConfigProperty.DOWNLOAD_LOGGING)
</a><a href="#h25-1-4" id="h25-1-4" class="d">-        if (downloadLogging[&quot;started&quot;] == true) {
</a><a href="#h25-1-5" id="h25-1-5" class="i">+        val downloadLogging by context.config.downloader.logging
</a><a href="#h25-1-6" id="h25-1-6" class="i">+        if (downloadLogging.contains(&quot;started&quot;)) {
</a>             context.shortToast(context.translation[&quot;download_processor.download_started_toast&quot;])
         }
 
<a href="#h25-2" id="h25-2" class="h">@@ -83,7 +82,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>         return DownloadManagerClient(
             context = context,
             metadata = DownloadMetadata(
<a href="#h25-2-3" id="h25-2-3" class="d">-                mediaIdentifier = if (context.config.options(ConfigProperty.DOWNLOAD_OPTIONS)[&quot;allow_duplicate&quot;] == false) {
</a><a href="#h25-2-4" id="h25-2-4" class="i">+                mediaIdentifier = if (!context.config.downloader.allowDuplicate.get()) {
</a>                     generatedHash
                 } else null,
                 mediaDisplaySource = mediaDisplaySource,
<a href="#h25-3" id="h25-3" class="h">@@ -93,19 +92,19 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>             ),
             callback = object: DownloadCallback.Stub() {
                 override fun onSuccess(outputFile: String) {
<a href="#h25-3-3" id="h25-3-3" class="d">-                    if (downloadLogging[&quot;success&quot;] != true) return
</a><a href="#h25-3-4" id="h25-3-4" class="i">+                    if (!downloadLogging.contains(&quot;success&quot;)) return
</a>                     Logger.debug(&quot;onSuccess: outputFile=$outputFile&quot;)
                     context.shortToast(context.translation.format(&quot;download_processor.saved_toast&quot;, &quot;path&quot; to outputFile.split(&quot;/&quot;).takeLast(2).joinToString(&quot;/&quot;)))
                 }
 
                 override fun onProgress(message: String) {
<a href="#h25-3-10" id="h25-3-10" class="d">-                    if (downloadLogging[&quot;progress&quot;] != true) return
</a><a href="#h25-3-11" id="h25-3-11" class="i">+                    if (!downloadLogging.contains(&quot;progress&quot;)) return
</a>                     Logger.debug(&quot;onProgress: message=$message&quot;)
                     context.shortToast(message)
                 }
 
                 override fun onFailure(message: String, throwable: String?) {
<a href="#h25-3-17" id="h25-3-17" class="d">-                    if (downloadLogging[&quot;failure&quot;] != true) return
</a><a href="#h25-3-18" id="h25-3-18" class="i">+                    if (!downloadLogging.contains(&quot;failure&quot;)) return
</a>                     Logger.debug(&quot;onFailure: message=$message, throwable=$throwable&quot;)
                     throwable?.let {
                         context.longToast((message + it.takeIf { it.isNotEmpty() }.orEmpty()))
<a href="#h25-4" id="h25-4" class="h">@@ -118,13 +117,13 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>     }
 
     private fun canMergeOverlay(): Boolean {
<a href="#h25-4-3" id="h25-4-3" class="d">-        if (context.config.options(ConfigProperty.DOWNLOAD_OPTIONS)[&quot;merge_overlay&quot;] == false) return false
</a><a href="#h25-4-4" id="h25-4-4" class="i">+        if (!context.config.downloader.autoDownloadOptions.get().contains(&quot;merge_overlay&quot;)) return false
</a>         return isFFmpegPresent
     }
 
     //TODO: implement subfolder argument
     private fun createNewFilePath(hexHash: String, mediaDisplayType: String?, pathPrefix: String): String {
<a href="#h25-4-10" id="h25-4-10" class="d">-        val downloadOptions = context.config.options(ConfigProperty.DOWNLOAD_OPTIONS)
</a><a href="#h25-4-11" id="h25-4-11" class="i">+        val pathFormat by context.config.downloader.pathFormat
</a>         val sanitizedPathPrefix = pathPrefix
             .replace(&quot; &quot;, &quot;_&quot;)
             .replace(Regex(&quot;[\\\\:*?\&quot;&lt;&gt;|]&quot;), &quot;&quot;)
<a href="#h25-5" id="h25-5" class="h">@@ -142,21 +141,21 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>             }
         }
 
<a href="#h25-5-3" id="h25-5-3" class="d">-        if (downloadOptions[&quot;create_user_folder&quot;] == true) {
</a><a href="#h25-5-4" id="h25-5-4" class="i">+        if (pathFormat.contains(&quot;create_user_folder&quot;)) {
</a>             finalPath.append(sanitizedPathPrefix).append(&quot;/&quot;)
         }
<a href="#h25-5-7" id="h25-5-7" class="d">-        if (downloadOptions[&quot;append_hash&quot;] == true) {
</a><a href="#h25-5-8" id="h25-5-8" class="i">+        if (pathFormat.contains(&quot;append_hash&quot;)) {
</a>             appendFileName(hexHash)
         }
         mediaDisplayType?.let {
<a href="#h25-5-12" id="h25-5-12" class="d">-            if (downloadOptions[&quot;append_type&quot;] == true) {
</a><a href="#h25-5-13" id="h25-5-13" class="i">+            if (pathFormat.contains(&quot;append_type&quot;)) {
</a>                 appendFileName(it.lowercase().replace(&quot; &quot;, &quot;-&quot;))
             }
         }
<a href="#h25-5-17" id="h25-5-17" class="d">-        if (downloadOptions[&quot;append_username&quot;] == true) {
</a><a href="#h25-5-18" id="h25-5-18" class="i">+        if (pathFormat.contains(&quot;append_username&quot;)) {
</a>             appendFileName(sanitizedPathPrefix)
         }
<a href="#h25-5-21" id="h25-5-21" class="d">-        if (downloadOptions[&quot;append_date_time&quot;] == true) {
</a><a href="#h25-5-22" id="h25-5-22" class="i">+        if (pathFormat.contains(&quot;append_date_time&quot;)) {
</a>             appendFileName(currentDateTime)
         }
 
<a href="#h25-6" id="h25-6" class="h">@@ -377,8 +376,8 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>     }
 
     private fun canAutoDownload(keyFilter: String? = null): Boolean {
<a href="#h25-6-3" id="h25-6-3" class="d">-        val options = context.config.options(ConfigProperty.AUTO_DOWNLOAD_OPTIONS)
</a><a href="#h25-6-4" id="h25-6-4" class="d">-        return options.filter { it.value }.any { keyFilter == null || it.key.contains(keyFilter, true) }
</a><a href="#h25-6-5" id="h25-6-5" class="i">+        val options by context.config.downloader.autoDownloadOptions
</a><a href="#h25-6-6" id="h25-6-6" class="i">+        return options.any { keyFilter == null || it.contains(keyFilter, true) }
</a>     }
 
     override fun asyncOnActivityCreate() {
<b>diff --git a/<a id="h26" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -14,7 +14,7 @@ import me.rhunk.snapenhance.hook.hook
</a> class AmoledDarkMode : Feature(&quot;Amoled Dark Mode&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
     @SuppressLint(&quot;DiscouragedApi&quot;)
     override fun onActivityCreate() {
<a href="#h26-0-3" id="h26-0-3" class="d">-        if (!context.config.bool(ConfigProperty.AMOLED_DARK_MODE)) return
</a><a href="#h26-0-4" id="h26-0-4" class="i">+        if (!context.config.userInterface.amoledDarkMode.get()) return
</a>         val attributeCache = mutableMapOf&lt;String, Int&gt;()
 
         fun getAttribute(name: String): Int {
<b>diff --git a/<a id="h27" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -27,7 +27,9 @@ class AppPasscode : Feature(&quot;App Passcode&quot;, loadParams = FeatureLoadParams.ACTIV
</a>     fun lock() {
         if (isLocked) return
         isLocked = true
<a href="#h27-0-3" id="h27-0-3" class="d">-        val passcode = context.config.string(ConfigProperty.APP_PASSCODE).also { if (it.isEmpty()) return }
</a><a href="#h27-0-4" id="h27-0-4" class="i">+        val passcode by context.config.experimental.appPasscode.also {
</a><a href="#h27-0-5" id="h27-0-5" class="i">+            if (it.getNullable()?.isEmpty() != false) return
</a><a href="#h27-0-6" id="h27-0-6" class="i">+        }
</a>         val isDigitPasscode = passcode.all { it.isDigit() }
 
         val mainActivity = context.mainActivity!!
<a href="#h27-1" id="h27-1" class="h">@@ -89,7 +91,7 @@ class AppPasscode : Feature(&quot;App Passcode&quot;, loadParams = FeatureLoadParams.ACTIV
</a>             lock()
         }
 
<a href="#h27-1-3" id="h27-1-3" class="d">-        if (!context.config.bool(ConfigProperty.APP_LOCK_ON_RESUME)) return
</a><a href="#h27-1-4" id="h27-1-4" class="i">+        if (!context.config.experimental.appLockOnResume.get()) return
</a> 
         if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) {
             context.mainActivity?.registerActivityLifecycleCallbacks(object: android.app.Application.ActivityLifecycleCallbacks {
<b>diff --git a/<a id="h28" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -9,39 +9,29 @@ import me.rhunk.snapenhance.hook.Hooker
</a> 
 class DeviceSpooferHook: Feature(&quot;device_spoofer&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC)  {
 	override fun asyncOnActivityCreate() {
<a href="#h28-0-3" id="h28-0-3" class="d">-		//FINGERPRINT
</a><a href="#h28-0-4" id="h28-0-4" class="d">-		if(getFingerprint().isNotEmpty()) {
</a><a href="#h28-0-5" id="h28-0-5" class="i">+		val fingerprint by context.config.spoof.device.fingerprint
</a><a href="#h28-0-6" id="h28-0-6" class="i">+		val androidId by context.config.spoof.device.androidId
</a><a href="#h28-0-7" id="h28-0-7" class="i">+
</a><a href="#h28-0-8" id="h28-0-8" class="i">+		if (fingerprint.isNotEmpty()) {
</a> 			val fingerprintClass = android.os.Build::class.java
 			Hooker.hook(fingerprintClass, &quot;FINGERPRINT&quot;, HookStage.BEFORE) { hookAdapter -&gt;
<a href="#h28-0-11" id="h28-0-11" class="d">-				hookAdapter.setResult(getFingerprint())
</a><a href="#h28-0-12" id="h28-0-12" class="i">+				hookAdapter.setResult(fingerprint)
</a><a href="#h28-0-13" id="h28-0-13" class="i">+				Logger.debug(&quot;Fingerprint spoofed to $fingerprint&quot;)
</a> 			}
 			Hooker.hook(fingerprintClass, &quot;deriveFingerprint&quot;, HookStage.BEFORE) { hookAdapter -&gt;
<a href="#h28-0-16" id="h28-0-16" class="d">-				hookAdapter.setResult(getFingerprint())
</a><a href="#h28-0-17" id="h28-0-17" class="i">+				hookAdapter.setResult(fingerprint)
</a><a href="#h28-0-18" id="h28-0-18" class="i">+				Logger.debug(&quot;Fingerprint spoofed to $fingerprint&quot;)
</a> 			}
 		}
<a href="#h28-0-21" id="h28-0-21" class="d">-		else {
</a><a href="#h28-0-22" id="h28-0-22" class="d">-			Logger.xposedLog(&quot;Fingerprint is null, not spoofing&quot;)
</a><a href="#h28-0-23" id="h28-0-23" class="d">-		}
</a><a href="#h28-0-24" id="h28-0-24" class="d">-		
</a><a href="#h28-0-25" id="h28-0-25" class="d">-		//ANDROID ID
</a><a href="#h28-0-26" id="h28-0-26" class="d">-		if(getAndroidId().isNotEmpty()) {
</a><a href="#h28-0-27" id="h28-0-27" class="i">+
</a><a href="#h28-0-28" id="h28-0-28" class="i">+		if (androidId.isNotEmpty()) {
</a> 			val settingsSecureClass = android.provider.Settings.Secure::class.java
 			Hooker.hook(settingsSecureClass, &quot;getString&quot;, HookStage.BEFORE) { hookAdapter -&gt;
 				if(hookAdapter.args()[1] == &quot;android_id&quot;) {
<a href="#h28-0-32" id="h28-0-32" class="d">-					hookAdapter.setResult(getAndroidId())
</a><a href="#h28-0-33" id="h28-0-33" class="i">+					hookAdapter.setResult(androidId)
</a><a href="#h28-0-34" id="h28-0-34" class="i">+					Logger.debug(&quot;Android ID spoofed to $androidId&quot;)
</a> 				}
 			}
 		}
<a href="#h28-0-38" id="h28-0-38" class="d">-		else {
</a><a href="#h28-0-39" id="h28-0-39" class="d">-			Logger.xposedLog(&quot;Android ID is null, not spoofing&quot;)
</a><a href="#h28-0-40" id="h28-0-40" class="d">-		}
</a><a href="#h28-0-41" id="h28-0-41" class="d">-	}
</a><a href="#h28-0-42" id="h28-0-42" class="d">-	private fun getFingerprint():String {
</a><a href="#h28-0-43" id="h28-0-43" class="d">-		return context.config.string(ConfigProperty.FINGERPRINT)
</a><a href="#h28-0-44" id="h28-0-44" class="d">-	}
</a><a href="#h28-0-45" id="h28-0-45" class="d">-	
</a><a href="#h28-0-46" id="h28-0-46" class="d">-	private fun getAndroidId():String {
</a><a href="#h28-0-47" id="h28-0-47" class="d">-		return context.config.string(ConfigProperty.ANDROID_ID)
</a> 	}
<a href="#h28-0-49" id="h28-0-49" class="d">-	
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h29" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -11,7 +11,7 @@ class InfiniteStoryBoost : Feature(&quot;InfiniteStoryBoost&quot;, loadParams = FeatureLoa
</a>         val storyBoostStateClass = context.mappings.getMappedClass(&quot;StoryBoostStateClass&quot;)
 
         storyBoostStateClass.hookConstructor(HookStage.BEFORE, {
<a href="#h29-0-3" id="h29-0-3" class="d">-            context.config.bool(ConfigProperty.INFINITE_STORY_BOOST)
</a><a href="#h29-0-4" id="h29-0-4" class="i">+            context.config.experimental.infiniteStoryBoost.get()
</a>         }) { param -&gt;
             val startTimeMillis = param.arg&lt;Long&gt;(1)
             //reset timestamp if it&#39;s more than 24 hours
<b>diff --git a/<a id="h30" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -14,7 +14,7 @@ class MeoPasscodeBypass : Feature(&quot;Meo Passcode Bypass&quot;, loadParams = FeatureLoa
</a>             context.androidContext.classLoader.loadClass(bcrypt[&quot;class&quot;].toString()),
             bcrypt[&quot;hashMethod&quot;].toString(),
             HookStage.BEFORE,
<a href="#h30-0-3" id="h30-0-3" class="d">-            { context.config.bool(ConfigProperty.MEO_PASSCODE_BYPASS) },
</a><a href="#h30-0-4" id="h30-0-4" class="i">+            { context.config.experimental.meoPasscodeBypass.get() },
</a>         ) { param -&gt;
             //set the hash to the result of the method
             param.setResult(param.arg(1))
<b>diff --git a/<a id="h31" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -10,7 +10,7 @@ import me.rhunk.snapenhance.util.setObjectField
</a> class UnlimitedMultiSnap : Feature(&quot;UnlimitedMultiSnap&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
         android.util.Pair::class.java.hookConstructor(HookStage.AFTER, {
<a href="#h31-0-3" id="h31-0-3" class="d">-            context.config.bool(ConfigProperty.UNLIMITED_MULTI_SNAP)
</a><a href="#h31-0-4" id="h31-0-4" class="i">+            context.config.experimental.unlimitedMultiSnap.get()
</a>         }) { param -&gt;
             val first = param.arg&lt;Any&gt;(0)
             val second = param.arg&lt;Any&gt;(1)
<b>diff --git a/<a id="h32" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -10,11 +10,10 @@ import me.rhunk.snapenhance.hook.Hooker
</a> 
 class DisableMetrics : Feature(&quot;DisableMetrics&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
     override fun init() {
<a href="#h32-0-3" id="h32-0-3" class="d">-        val disableMetricsFilter: (HookAdapter) -&gt; Boolean = {
</a><a href="#h32-0-4" id="h32-0-4" class="d">-            context.config.bool(ConfigProperty.DISABLE_METRICS)
</a><a href="#h32-0-5" id="h32-0-5" class="d">-        }
</a><a href="#h32-0-6" id="h32-0-6" class="i">+        val disableMetrics by context.config.global.disableMetrics
</a> 
<a href="#h32-0-8" id="h32-0-8" class="d">-        Hooker.hook(context.classCache.unifiedGrpcService, &quot;unaryCall&quot;, HookStage.BEFORE, disableMetricsFilter) { param -&gt;
</a><a href="#h32-0-9" id="h32-0-9" class="i">+        Hooker.hook(context.classCache.unifiedGrpcService, &quot;unaryCall&quot;, HookStage.BEFORE,
</a><a href="#h32-0-10" id="h32-0-10" class="i">+            {  disableMetrics }) { param -&gt;
</a>             val url: String = param.arg(0)
             if (url.endsWith(&quot;snapchat.valis.Valis/SendClientUpdate&quot;) ||
                 url.endsWith(&quot;targetingQuery&quot;)
<a href="#h32-1" id="h32-1" class="h">@@ -23,7 +22,8 @@ class DisableMetrics : Feature(&quot;DisableMetrics&quot;, loadParams = FeatureLoadParams.
</a>             }
         }
 
<a href="#h32-1-3" id="h32-1-3" class="d">-        Hooker.hook(context.classCache.networkApi, &quot;submit&quot;, HookStage.BEFORE, disableMetricsFilter) { param -&gt;
</a><a href="#h32-1-4" id="h32-1-4" class="i">+        Hooker.hook(context.classCache.networkApi, &quot;submit&quot;, HookStage.BEFORE,
</a><a href="#h32-1-5" id="h32-1-5" class="i">+            { disableMetrics }) { param -&gt;
</a>             val httpRequest: Any = param.arg(0)
             val url = XposedHelpers.getObjectField(httpRequest, &quot;mUrl&quot;).toString()
             /*if (url.contains(&quot;resolve?co=&quot;)) {
<b>diff --git a/<a id="h33" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -11,16 +11,15 @@ import me.rhunk.snapenhance.hook.hook
</a> 
 class PreventMessageSending : Feature(&quot;Prevent message sending&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
<a href="#h33-0-3" id="h33-0-3" class="i">+        val preventMessageSending by context.config.messaging.preventMessageSending
</a><a href="#h33-0-4" id="h33-0-4" class="i">+
</a>         context.classCache.conversationManager.hook(&quot;updateMessage&quot;, HookStage.BEFORE) { param -&gt;
             val messageUpdate = param.arg&lt;Any&gt;(2).toString();
<a href="#h33-0-7" id="h33-0-7" class="d">-            val options by lazy {
</a><a href="#h33-0-8" id="h33-0-8" class="d">-                context.config.options(ConfigProperty.PREVENT_SENDING_MESSAGES)
</a><a href="#h33-0-9" id="h33-0-9" class="d">-            }
</a><a href="#h33-0-10" id="h33-0-10" class="d">-            if (messageUpdate == &quot;SCREENSHOT&quot; &amp;&amp; options[&quot;chat_screenshot&quot;] == true) {
</a><a href="#h33-0-11" id="h33-0-11" class="i">+            if (messageUpdate == &quot;SCREENSHOT&quot; &amp;&amp; preventMessageSending.contains(&quot;chat_screenshot&quot;)) {
</a>                 param.setResult(null)
             }
 
<a href="#h33-0-15" id="h33-0-15" class="d">-            if (messageUpdate == &quot;SCREEN_RECORD&quot; &amp;&amp; options[&quot;chat_screen_record&quot;] == true) {
</a><a href="#h33-0-16" id="h33-0-16" class="i">+            if (messageUpdate == &quot;SCREEN_RECORD&quot; &amp;&amp; preventMessageSending.contains(&quot;chat_screen_record&quot;)) {
</a>                 param.setResult(null)
             }
         }
<a href="#h33-1" id="h33-1" class="h">@@ -29,9 +28,8 @@ class PreventMessageSending : Feature(&quot;Prevent message sending&quot;, loadParams = Fe
</a>             val message = MessageContent(param.arg(1))
             val contentType = message.contentType
             val associatedType = NotificationType.fromContentType(contentType) ?: return@hook
<a href="#h33-1-3" id="h33-1-3" class="d">-            val options = context.config.options(ConfigProperty.PREVENT_SENDING_MESSAGES)
</a> 
<a href="#h33-1-5" id="h33-1-5" class="d">-            if (options[associatedType.key] == true) {
</a><a href="#h33-1-6" id="h33-1-6" class="i">+            if (preventMessageSending.contains(associatedType.key)) {
</a>                 Logger.debug(&quot;Preventing message sending for $associatedType&quot;)
                 param.setResult(null)
             }
<b>diff --git a/<a id="h34" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -9,7 +9,8 @@ import me.rhunk.snapenhance.util.getObjectField
</a> 
 class AnonymousStoryViewing : Feature(&quot;Anonymous Story Viewing&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
<a href="#h34-0-3" id="h34-0-3" class="d">-        Hooker.hook(context.classCache.networkApi,&quot;submit&quot;, HookStage.BEFORE, { context.config.bool(ConfigProperty.ANONYMOUS_STORY_VIEW) }) {
</a><a href="#h34-0-4" id="h34-0-4" class="i">+        val anonymousStoryViewProperty by context.config.messaging.anonymousStoryViewing
</a><a href="#h34-0-5" id="h34-0-5" class="i">+        Hooker.hook(context.classCache.networkApi,&quot;submit&quot;, HookStage.BEFORE, { anonymousStoryViewProperty }) {
</a>             val httpRequest: Any = it.arg(0)
             val url = httpRequest.getObjectField(&quot;mUrl&quot;) as String
             if (url.endsWith(&quot;readreceipt-indexer/batchuploadreadreceipts&quot;) || url.endsWith(&quot;v2/batch_cta&quot;)) {
<b>diff --git a/<a id="h35" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -52,11 +52,6 @@ class MessageLogger : Feature(&quot;MessageLogger&quot;,
</a> 
     @OptIn(ExperimentalTime::class)
     override fun asyncOnActivityCreate() {
<a href="#h35-0-3" id="h35-0-3" class="d">-        ConfigProperty.MESSAGE_LOGGER.valueContainer.addPropertyChangeListener {
</a><a href="#h35-0-4" id="h35-0-4" class="d">-            context.config.writeConfig()
</a><a href="#h35-0-5" id="h35-0-5" class="d">-            context.softRestartApp()
</a><a href="#h35-0-6" id="h35-0-6" class="d">-        }
</a><a href="#h35-0-7" id="h35-0-7" class="d">-
</a>         if (!context.database.hasArroyo()) {
             return
         }
<a href="#h35-1" id="h35-1" class="h">@@ -130,9 +125,8 @@ class MessageLogger : Feature(&quot;MessageLogger&quot;,
</a>     }
 
     override fun init() {
<a href="#h35-1-3" id="h35-1-3" class="d">-        Hooker.hookConstructor(context.classCache.message, HookStage.AFTER, {
</a><a href="#h35-1-4" id="h35-1-4" class="d">-            context.config.bool(ConfigProperty.MESSAGE_LOGGER)
</a><a href="#h35-1-5" id="h35-1-5" class="d">-        }) { param -&gt;
</a><a href="#h35-1-6" id="h35-1-6" class="i">+        val messageLogger by context.config.messaging.messageLogger
</a><a href="#h35-1-7" id="h35-1-7" class="i">+        Hooker.hookConstructor(context.classCache.message, HookStage.AFTER, { messageLogger }) { param -&gt;
</a>             processSnapMessage(param.thisObject())
         }
     }
<b>diff --git a/<a id="h36" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -9,8 +9,9 @@ import me.rhunk.snapenhance.hook.Hooker
</a> 
 class PreventReadReceipts : Feature(&quot;PreventReadReceipts&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
     override fun onActivityCreate() {
<a href="#h36-0-3" id="h36-0-3" class="i">+        val preventReadReceipts by context.config.messaging.preventReadReceipts
</a>         val isConversationInStealthMode: (SnapUUID) -&gt; Boolean = hook@{
<a href="#h36-0-5" id="h36-0-5" class="d">-            if (context.config.bool(ConfigProperty.PREVENT_READ_RECEIPTS)) return@hook true
</a><a href="#h36-0-6" id="h36-0-6" class="i">+            if (preventReadReceipts) return@hook true
</a>             context.feature(StealthMode::class).isStealth(it.toString())
         }
 
<b>diff --git a/<a id="h37" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -32,6 +32,10 @@ class AutoSave : Feature(&quot;Auto Save&quot;, loadParams = FeatureLoadParams.ACTIVITY_CR
</a>         context.classCache.conversationManager.methods.first { it.name == &quot;fetchConversationWithMessagesPaginated&quot; }
     }
 
<a href="#h37-0-3" id="h37-0-3" class="i">+    private val autoSaveFilter by lazy {
</a><a href="#h37-0-4" id="h37-0-4" class="i">+        context.config.messaging.autoSaveMessagesInConversations.get()
</a><a href="#h37-0-5" id="h37-0-5" class="i">+    }
</a><a href="#h37-0-6" id="h37-0-6" class="i">+
</a>     private fun saveMessage(conversationId: SnapUUID, message: Message) {
         val messageId = message.messageDescriptor.messageId
         if (messageLogger.isMessageRemoved(messageId)) return
<a href="#h37-1" id="h37-1" class="h">@@ -62,11 +66,11 @@ class AutoSave : Feature(&quot;Auto Save&quot;, loadParams = FeatureLoadParams.ACTIVITY_CR
</a>         if (message.messageMetadata.savedBy.any { uuid -&gt; uuid.toString() == myUserId }) return false
         val contentType = message.messageContent.contentType.toString()
 
<a href="#h37-1-3" id="h37-1-3" class="d">-        return context.config.options(ConfigProperty.AUTO_SAVE_MESSAGES).filter { it.value }.any { it.key == contentType }
</a><a href="#h37-1-4" id="h37-1-4" class="i">+        return autoSaveFilter.any { it == contentType }
</a>     }
 
     private fun canSave(): Boolean {
<a href="#h37-1-8" id="h37-1-8" class="d">-        if (context.config.options(ConfigProperty.AUTO_SAVE_MESSAGES).none { it.value }) return false
</a><a href="#h37-1-9" id="h37-1-9" class="i">+        if (autoSaveFilter.isEmpty()) return false
</a> 
         with(context.feature(Messaging::class)) {
             if (openedConversationUUID == null) return@canSave false
<b>diff --git a/<a id="h38" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -16,16 +16,16 @@ import me.rhunk.snapenhance.hook.hookConstructor
</a> 
 class CameraTweaks : Feature(&quot;Camera Tweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
     companion object {
<a href="#h38-0-3" id="h38-0-3" class="d">-        val resolutions = listOf(&quot;OFF&quot;, &quot;3264x2448&quot;, &quot;3264x1840&quot;, &quot;3264x1504&quot;, &quot;2688x1512&quot;, &quot;2560x1920&quot;, &quot;2448x2448&quot;, &quot;2340x1080&quot;, &quot;2160x1080&quot;, &quot;1920x1440&quot;, &quot;1920x1080&quot;, &quot;1600x1200&quot;, &quot;1600x960&quot;, &quot;1600x900&quot;, &quot;1600x736&quot;, &quot;1600x720&quot;, &quot;1560x720&quot;, &quot;1520x720&quot;, &quot;1440x1080&quot;, &quot;1440x720&quot;, &quot;1280x720&quot;, &quot;1080x1080&quot;, &quot;1080x720&quot;, &quot;960x720&quot;, &quot;720x720&quot;, &quot;720x480&quot;, &quot;640x480&quot;, &quot;352x288&quot;, &quot;320x240&quot;, &quot;176x144&quot;)
</a><a href="#h38-0-4" id="h38-0-4" class="i">+        val resolutions = listOf(&quot;3264x2448&quot;, &quot;3264x1840&quot;, &quot;3264x1504&quot;, &quot;2688x1512&quot;, &quot;2560x1920&quot;, &quot;2448x2448&quot;, &quot;2340x1080&quot;, &quot;2160x1080&quot;, &quot;1920x1440&quot;, &quot;1920x1080&quot;, &quot;1600x1200&quot;, &quot;1600x960&quot;, &quot;1600x900&quot;, &quot;1600x736&quot;, &quot;1600x720&quot;, &quot;1560x720&quot;, &quot;1520x720&quot;, &quot;1440x1080&quot;, &quot;1440x720&quot;, &quot;1280x720&quot;, &quot;1080x1080&quot;, &quot;1080x720&quot;, &quot;960x720&quot;, &quot;720x720&quot;, &quot;720x480&quot;, &quot;640x480&quot;, &quot;352x288&quot;, &quot;320x240&quot;, &quot;176x144&quot;)
</a>     }
 
<a href="#h38-0-7" id="h38-0-7" class="d">-    private fun parseResolution(resolution: String): IntArray? {
</a><a href="#h38-0-8" id="h38-0-8" class="d">-        return resolution.takeIf { resolution != &quot;OFF&quot; }?.split(&quot;x&quot;)?.map { it.toInt() }?.toIntArray()
</a><a href="#h38-0-9" id="h38-0-9" class="i">+    private fun parseResolution(resolution: String): IntArray {
</a><a href="#h38-0-10" id="h38-0-10" class="i">+        return resolution.split(&quot;x&quot;).map { it.toInt() }.toIntArray()
</a>     }
 
     @SuppressLint(&quot;MissingPermission&quot;, &quot;DiscouragedApi&quot;)
     override fun onActivityCreate() {
<a href="#h38-0-15" id="h38-0-15" class="d">-        if (context.config.bool(ConfigProperty.CAMERA_DISABLE)) {
</a><a href="#h38-0-16" id="h38-0-16" class="i">+        if (context.config.camera.disable.get()) {
</a>             ContextWrapper::class.java.hook(&quot;checkPermission&quot;, HookStage.BEFORE) { param -&gt;
                 val permission = param.arg&lt;String&gt;(0)
                 if (permission == Manifest.permission.CAMERA) {
<a href="#h38-1" id="h38-1" class="h">@@ -39,16 +39,16 @@ class CameraTweaks : Feature(&quot;Camera Tweaks&quot;, loadParams = FeatureLoadParams.ACT
</a>         }
 
         ConfigEnumKeys.hookAllEnums(context.mappings.getMappedClass(&quot;enums&quot;, &quot;CAMERA&quot;)) {
<a href="#h38-1-3" id="h38-1-3" class="d">-            if (key == &quot;FORCE_CAMERA_HIGHEST_FPS&quot; &amp;&amp; context.config.bool(ConfigProperty.FORCE_HIGHEST_FRAME_RATE)) {
</a><a href="#h38-1-4" id="h38-1-4" class="i">+            if (key == &quot;FORCE_CAMERA_HIGHEST_FPS&quot; &amp;&amp; context.config.camera.forceHighestFrameRate.get()) {
</a>                 set(true)
             }
<a href="#h38-1-7" id="h38-1-7" class="d">-            if (key == &quot;MEDIA_RECORDER_MAX_QUALITY_LEVEL&quot; &amp;&amp; context.config.bool(ConfigProperty.FORCE_CAMERA_SOURCE_ENCODING)) {
</a><a href="#h38-1-8" id="h38-1-8" class="i">+            if (key == &quot;MEDIA_RECORDER_MAX_QUALITY_LEVEL&quot; &amp;&amp; context.config.camera.forceCameraSourceEncoding.get()) {
</a>                 value!!.javaClass.enumConstants?.let { enumData -&gt; set(enumData.filter { it.toString() == &quot;LEVEL_MAX&quot; }) }
             }
         }
 
<a href="#h38-1-13" id="h38-1-13" class="d">-        val previewResolutionConfig = parseResolution(context.config.state(ConfigProperty.OVERRIDE_PREVIEW_RESOLUTION))
</a><a href="#h38-1-14" id="h38-1-14" class="d">-        val captureResolutionConfig = parseResolution(context.config.state(ConfigProperty.OVERRIDE_PICTURE_RESOLUTION))
</a><a href="#h38-1-15" id="h38-1-15" class="i">+        val previewResolutionConfig = context.config.camera.overridePreviewResolution.getNullable()?.let { parseResolution(it) }
</a><a href="#h38-1-16" id="h38-1-16" class="i">+        val captureResolutionConfig = context.config.camera.overridePictureResolution.getNullable()?.let { parseResolution(it) }
</a> 
         context.mappings.getMappedClass(&quot;ScCameraSettings&quot;).hookConstructor(HookStage.BEFORE) { param -&gt;
             val previewResolution = ScSize(param.argNullable(2))
<b>diff --git a/<a id="h39" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -9,10 +9,9 @@ import me.rhunk.snapenhance.hook.Hooker
</a> class DisableVideoLengthRestriction : Feature(&quot;DisableVideoLengthRestriction&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
         val defaultMediaItem = context.mappings.getMappedClass(&quot;DefaultMediaItem&quot;)
<a href="#h39-0-3" id="h39-0-3" class="i">+        val isState by context.config.global.disableVideoLengthRestrictions
</a> 
<a href="#h39-0-5" id="h39-0-5" class="d">-        Hooker.hookConstructor(defaultMediaItem, HookStage.BEFORE, {
</a><a href="#h39-0-6" id="h39-0-6" class="d">-            context.config.bool(ConfigProperty.DISABLE_VIDEO_LENGTH_RESTRICTION)
</a><a href="#h39-0-7" id="h39-0-7" class="d">-        }) { param -&gt;
</a><a href="#h39-0-8" id="h39-0-8" class="i">+        Hooker.hookConstructor(defaultMediaItem, HookStage.BEFORE, { isState }) { param -&gt;
</a>             //set the video length argument
             param.setArg(5, -1L)
         }
<b>diff --git a/<a id="h40" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -15,7 +15,7 @@ import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a> class GalleryMediaSendOverride : Feature(&quot;Gallery Media Send Override&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
     override fun init() {
         Hooker.hook(context.classCache.conversationManager, &quot;sendMessageWithContent&quot;, HookStage.BEFORE) { param -&gt;
<a href="#h40-0-3" id="h40-0-3" class="d">-            val overrideType = context.config.state(ConfigProperty.GALLERY_MEDIA_SEND_OVERRIDE).also { if (it == &quot;OFF&quot;) return@hook }
</a><a href="#h40-0-4" id="h40-0-4" class="i">+            val overrideType = context.config.messaging.galleryMediaSendOverride.getNullable() ?: return@hook
</a> 
             val localMessageContent = MessageContent(param.arg(1))
             if (localMessageContent.contentType != ContentType.EXTERNAL_MEDIA) return@hook
<b>diff --git a/<a id="h41" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -11,7 +11,7 @@ import java.lang.reflect.Modifier
</a> 
 class GooglePlayServicesDialogs : Feature(&quot;Disable GMS Dialogs&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
<a href="#h41-0-3" id="h41-0-3" class="d">-        if (!context.config.bool(ConfigProperty.DISABLE_GOOGLE_PLAY_DIALOGS)) return
</a><a href="#h41-0-4" id="h41-0-4" class="i">+        if (!context.config.global.disableGooglePlayDialogs.get()) return
</a> 
         findClass(&quot;com.google.android.gms.common.GoogleApiAvailability&quot;).methods
             .first { Modifier.isStatic(it.modifiers) &amp;&amp; it.returnType == AlertDialog::class.java }.let { method -&gt;
<b>diff --git a/<a id="h42" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a></b>
<a href="#h42-0" id="h42-0" class="h">@@ -6,6 +6,7 @@ import me.rhunk.snapenhance.features.Feature
</a> import me.rhunk.snapenhance.features.FeatureLoadParams
 import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
<a href="#h42-0-3" id="h42-0-3" class="i">+import me.rhunk.snapenhance.hook.hook
</a> 
 class LocationSpoofer: Feature(&quot;LocationSpoof&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
<a href="#h42-1" id="h42-1" class="h">@@ -13,52 +14,29 @@ class LocationSpoofer: Feature(&quot;LocationSpoof&quot;, loadParams = FeatureLoadParams.A
</a>             val intent = param.argNullable&lt;Intent&gt;(2) ?: return@hook
             val bundle = intent.getBundleExtra(&quot;location&quot;) ?: return@hook
             param.setResult(null)
<a href="#h42-1-3" id="h42-1-3" class="d">-            val latitude = bundle.getFloat(&quot;latitude&quot;)
</a><a href="#h42-1-4" id="h42-1-4" class="d">-            val longitude = bundle.getFloat(&quot;longitude&quot;)
</a> 
<a href="#h42-1-6" id="h42-1-6" class="d">-            with(context.config) {
</a><a href="#h42-1-7" id="h42-1-7" class="d">-                get(ConfigProperty.LATITUDE).writeFrom(latitude.toString())
</a><a href="#h42-1-8" id="h42-1-8" class="d">-                get(ConfigProperty.LONGITUDE).writeFrom(longitude.toString())
</a><a href="#h42-1-9" id="h42-1-9" class="d">-                writeConfig()
</a><a href="#h42-1-10" id="h42-1-10" class="i">+            with(context.config.spoof.location) {
</a><a href="#h42-1-11" id="h42-1-11" class="i">+                latitude.set(bundle.getFloat(&quot;latitude&quot;))
</a><a href="#h42-1-12" id="h42-1-12" class="i">+                longitude.set(bundle.getFloat(&quot;longitude&quot;))
</a><a href="#h42-1-13" id="h42-1-13" class="i">+
</a><a href="#h42-1-14" id="h42-1-14" class="i">+                context.longToast(&quot;Location set to $latitude, $longitude&quot;)
</a>             }
<a href="#h42-1-16" id="h42-1-16" class="d">-            context.longToast(&quot;Location set to $latitude, $longitude&quot;)
</a>         }
 
<a href="#h42-1-19" id="h42-1-19" class="d">-        if (!context.config.bool(ConfigProperty.LOCATION_SPOOF)) return
</a><a href="#h42-1-20" id="h42-1-20" class="d">-        val locationClass = android.location.Location::class.java
</a><a href="#h42-1-21" id="h42-1-21" class="d">-        val locationManagerClass = android.location.LocationManager::class.java
</a><a href="#h42-1-22" id="h42-1-22" class="i">+        if (context.config.spoof.location.globalState != true) return
</a> 
<a href="#h42-1-24" id="h42-1-24" class="d">-        Hooker.hook(locationClass, &quot;getLatitude&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h42-1-25" id="h42-1-25" class="d">-            hookAdapter.setResult(getLatitude())
</a><a href="#h42-1-26" id="h42-1-26" class="d">-        }
</a><a href="#h42-1-27" id="h42-1-27" class="i">+        val latitude by context.config.spoof.location.latitude
</a><a href="#h42-1-28" id="h42-1-28" class="i">+        val longitude by context.config.spoof.location.longitude
</a> 
<a href="#h42-1-30" id="h42-1-30" class="d">-        Hooker.hook(locationClass, &quot;getLongitude&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h42-1-31" id="h42-1-31" class="d">-            hookAdapter.setResult(getLongitude())
</a><a href="#h42-1-32" id="h42-1-32" class="d">-        }
</a><a href="#h42-1-33" id="h42-1-33" class="i">+        val locationClass = android.location.Location::class.java
</a><a href="#h42-1-34" id="h42-1-34" class="i">+        val locationManagerClass = android.location.LocationManager::class.java
</a> 
<a href="#h42-1-36" id="h42-1-36" class="d">-        Hooker.hook(locationClass, &quot;getAccuracy&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h42-1-37" id="h42-1-37" class="d">-            hookAdapter.setResult(getAccuracy())
</a><a href="#h42-1-38" id="h42-1-38" class="d">-        }
</a><a href="#h42-1-39" id="h42-1-39" class="i">+        locationClass.hook(&quot;getLatitude&quot;, HookStage.BEFORE) { it.setResult(latitude) }
</a><a href="#h42-1-40" id="h42-1-40" class="i">+        locationClass.hook(&quot;getLongitude&quot;, HookStage.BEFORE) { it.setResult(longitude) }
</a><a href="#h42-1-41" id="h42-1-41" class="i">+        locationClass.hook(&quot;getAccuracy&quot;, HookStage.BEFORE) { it.setResult(0.0F) }
</a> 
         //Might be redundant because it calls isProviderEnabledForUser which we also hook, meaning if isProviderEnabledForUser returns true this will also return true
<a href="#h42-1-44" id="h42-1-44" class="d">-        Hooker.hook(locationManagerClass, &quot;isProviderEnabled&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h42-1-45" id="h42-1-45" class="d">-            hookAdapter.setResult(true)
</a><a href="#h42-1-46" id="h42-1-46" class="d">-        }
</a><a href="#h42-1-47" id="h42-1-47" class="d">-        
</a><a href="#h42-1-48" id="h42-1-48" class="d">-        Hooker.hook(locationManagerClass, &quot;isProviderEnabledForUser&quot;, HookStage.BEFORE) {hookAdapter -&gt;
</a><a href="#h42-1-49" id="h42-1-49" class="d">-            hookAdapter.setResult(true)
</a><a href="#h42-1-50" id="h42-1-50" class="d">-        }
</a><a href="#h42-1-51" id="h42-1-51" class="d">-    }
</a><a href="#h42-1-52" id="h42-1-52" class="d">-
</a><a href="#h42-1-53" id="h42-1-53" class="d">-    private fun getLatitude():Double {
</a><a href="#h42-1-54" id="h42-1-54" class="d">-        return context.config.string(ConfigProperty.LATITUDE).toDouble()
</a><a href="#h42-1-55" id="h42-1-55" class="d">-    }
</a><a href="#h42-1-56" id="h42-1-56" class="d">-
</a><a href="#h42-1-57" id="h42-1-57" class="d">-    private fun getLongitude():Double {
</a><a href="#h42-1-58" id="h42-1-58" class="d">-        return context.config.string(ConfigProperty.LONGITUDE).toDouble()
</a><a href="#h42-1-59" id="h42-1-59" class="d">-    }
</a><a href="#h42-1-60" id="h42-1-60" class="d">-
</a><a href="#h42-1-61" id="h42-1-61" class="d">-    private fun getAccuracy():Float {
</a><a href="#h42-1-62" id="h42-1-62" class="d">-        return 0.0f
</a><a href="#h42-1-63" id="h42-1-63" class="i">+        locationManagerClass.hook(&quot;isProviderEnabled&quot;, HookStage.BEFORE) { it.setResult(true) }
</a><a href="#h42-1-64" id="h42-1-64" class="i">+        locationManagerClass.hook(&quot;isProviderEnabledForUser&quot;, HookStage.BEFORE) { it.setResult(true) }
</a>     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h43" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a></b>
<a href="#h43-0" id="h43-0" class="h">@@ -11,10 +11,12 @@ class MediaQualityLevelOverride : Feature(&quot;MediaQualityLevelOverride&quot;, loadParam
</a>         val enumQualityLevel = context.mappings.getMappedClass(&quot;EnumQualityLevel&quot;)
         val mediaQualityLevelProvider = context.mappings.getMappedMap(&quot;MediaQualityLevelProvider&quot;)
 
<a href="#h43-0-3" id="h43-0-3" class="i">+        val forceMediaSourceQuality by context.config.global.forceMediaSourceQuality
</a><a href="#h43-0-4" id="h43-0-4" class="i">+
</a>         context.androidContext.classLoader.loadClass(mediaQualityLevelProvider[&quot;class&quot;].toString()).hook(
             mediaQualityLevelProvider[&quot;method&quot;].toString(),
             HookStage.BEFORE,
<a href="#h43-0-8" id="h43-0-8" class="d">-            { context.config.bool(ConfigProperty.FORCE_MEDIA_SOURCE_QUALITY) }
</a><a href="#h43-0-9" id="h43-0-9" class="i">+            { forceMediaSourceQuality }
</a>         ) { param -&gt;
             param.setResult(enumQualityLevel.enumConstants.firstOrNull { it.toString() == &quot;LEVEL_MAX&quot; } )
         }
<b>diff --git a/<a id="h44" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a></b>
<a href="#h44-0" id="h44-0" class="h">@@ -65,6 +65,10 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>         context.androidContext.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
     }
 
<a href="#h44-0-3" id="h44-0-3" class="i">+    private val betterNotificationFilter by lazy {
</a><a href="#h44-0-4" id="h44-0-4" class="i">+        context.config.global.betterNotifications.get()
</a><a href="#h44-0-5" id="h44-0-5" class="i">+    }
</a><a href="#h44-0-6" id="h44-0-6" class="i">+
</a>     private fun setNotificationText(notification: Notification, conversationId: String) {
         val messageText = StringBuilder().apply {
             cachedMessages.computeIfAbsent(conversationId) { mutableListOf() }.forEach {
<a href="#h44-1" id="h44-1" class="h">@@ -87,7 +91,6 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>     }
 
     private fun setupNotificationActionButtons(contentType: ContentType, conversationId: String, messageId: Long, notificationData: NotificationData) {
<a href="#h44-1-3" id="h44-1-3" class="d">-        val betterNotifications = context.config.options(ConfigProperty.BETTER_NOTIFICATIONS)
</a> 
         val notificationBuilder = XposedHelpers.newInstance(
             Notification.Builder::class.java,
<a href="#h44-2" id="h44-2" class="h">@@ -115,7 +118,7 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>         }
 
         newAction(&quot;Reply&quot;, ACTION_REPLY, {
<a href="#h44-2-3" id="h44-2-3" class="d">-            betterNotifications[&quot;reply_button&quot;] == true &amp;&amp; contentType == ContentType.CHAT
</a><a href="#h44-2-4" id="h44-2-4" class="i">+            betterNotificationFilter.contains(&quot;reply_button&quot;) &amp;&amp; contentType == ContentType.CHAT
</a>         }) {
             val chatReplyInput = RemoteInput.Builder(&quot;chat_reply_input&quot;)
                 .setLabel(&quot;Reply&quot;)
<a href="#h44-3" id="h44-3" class="h">@@ -124,7 +127,7 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>         }
 
         newAction(&quot;Download&quot;, ACTION_DOWNLOAD, {
<a href="#h44-3-3" id="h44-3-3" class="d">-            betterNotifications[&quot;download_button&quot;] == true &amp;&amp; (contentType == ContentType.EXTERNAL_MEDIA || contentType == ContentType.SNAP)
</a><a href="#h44-3-4" id="h44-3-4" class="i">+            betterNotificationFilter.contains(&quot;download_button&quot;) &amp;&amp; (contentType == ContentType.EXTERNAL_MEDIA || contentType == ContentType.SNAP)
</a>         }) {}
 
         notificationBuilder.setActions(*actions.toTypedArray())
<a href="#h44-4" id="h44-4" class="h">@@ -282,8 +285,7 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>             val notificationType = extras.getString(&quot;notification_type&quot;) ?: return@hook
             val conversationId = extras.getString(&quot;conversation_id&quot;) ?: return@hook
 
<a href="#h44-4-3" id="h44-4-3" class="d">-            if (context.config.options(ConfigProperty.BETTER_NOTIFICATIONS)
</a><a href="#h44-4-4" id="h44-4-4" class="d">-                .filter { it.value }.map { it.key.uppercase() }.none {
</a><a href="#h44-4-5" id="h44-4-5" class="i">+            if (betterNotificationFilter.map { it.uppercase() }.none {
</a>                     notificationType.contains(it)
                 }) return@hook
 
<a href="#h44-5" id="h44-5" class="h">@@ -319,15 +321,15 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>         }
 
         findClass(&quot;com.google.firebase.messaging.FirebaseMessagingService&quot;).run {
<a href="#h44-5-3" id="h44-5-3" class="i">+            val states by context.config.global.notificationBlacklist
</a>             methods.first { it.declaringClass == this &amp;&amp; it.returnType == Void::class.javaPrimitiveType &amp;&amp; it.parameterCount == 1 &amp;&amp; it.parameterTypes[0] == Intent::class.java }
                 .hook(HookStage.BEFORE) { param -&gt;
                     val intent = param.argNullable&lt;Intent&gt;(0) ?: return@hook
                     val messageType = intent.getStringExtra(&quot;type&quot;) ?: return@hook
<a href="#h44-5-8" id="h44-5-8" class="d">-                    val states = context.config.options(ConfigProperty.NOTIFICATION_BLACKLIST)
</a> 
                     Logger.xposedLog(&quot;received message type: $messageType&quot;)
 
<a href="#h44-5-12" id="h44-5-12" class="d">-                    if (states[messageType.replaceFirst(&quot;mischief_&quot;, &quot;&quot;)] == true) {
</a><a href="#h44-5-13" id="h44-5-13" class="i">+                    if (states.contains(messageType.replaceFirst(&quot;mischief_&quot;, &quot;&quot;))) {
</a>                         param.setResult(null)
                     }
                 }
<b>diff --git a/<a id="h45" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a></b>
<a href="#h45-0" id="h45-0" class="h">@@ -11,7 +11,7 @@ class SnapchatPlus: Feature(&quot;SnapchatPlus&quot;, loadParams = FeatureLoadParams.ACTIV
</a>     private val expirationTimeMillis = (System.currentTimeMillis() + 15552000000L)
 
     override fun asyncOnActivityCreate() {
<a href="#h45-0-3" id="h45-0-3" class="d">-        if (!context.config.bool(ConfigProperty.SNAPCHAT_PLUS)) return
</a><a href="#h45-0-4" id="h45-0-4" class="i">+        if (!context.config.global.snapchatPlus.get()) return
</a> 
         val subscriptionInfoClass = context.mappings.getMappedClass(&quot;SubscriptionInfoClass&quot;)
 
<b>diff --git a/<a id="h46" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a></b>
<a href="#h46-0" id="h46-0" class="h">@@ -14,9 +14,8 @@ import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a> class UnlimitedSnapViewTime :
     Feature(&quot;UnlimitedSnapViewTime&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
     override fun onActivityCreate() {
<a href="#h46-0-3" id="h46-0-3" class="d">-        Hooker.hookConstructor(context.classCache.message, HookStage.AFTER, {
</a><a href="#h46-0-4" id="h46-0-4" class="d">-            context.config.bool(ConfigProperty.UNLIMITED_SNAP_VIEW_TIME)
</a><a href="#h46-0-5" id="h46-0-5" class="d">-        }) { param -&gt;
</a><a href="#h46-0-6" id="h46-0-6" class="i">+        val state by context.config.messaging.unlimitedSnapViewTime
</a><a href="#h46-0-7" id="h46-0-7" class="i">+        Hooker.hookConstructor(context.classCache.message, HookStage.AFTER, { state }) { param -&gt;
</a>             val message = Message(param.thisObject())
             if (message.messageState != MessageState.COMMITTED) return@hookConstructor
             if (message.messageContent.contentType != ContentType.SNAP) return@hookConstructor
<b>diff --git a/<a id="h47" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt</a></b>
<a href="#h47-0" id="h47-0" class="h">@@ -25,9 +25,7 @@ class StartupPageOverride : Feature(&quot;StartupPageOverride&quot;, loadParams = FeatureL
</a>      */
 
     override fun onActivityCreate() {
<a href="#h47-0-3" id="h47-0-3" class="d">-        val ngsIconName = context.config.state(ConfigProperty.STARTUP_PAGE_OVERRIDE).also {
</a><a href="#h47-0-4" id="h47-0-4" class="d">-            if (it == &quot;OFF&quot;) return
</a><a href="#h47-0-5" id="h47-0-5" class="d">-        }
</a><a href="#h47-0-6" id="h47-0-6" class="i">+        val ngsIconName = context.config.userInterface.startupTab.getNullable() ?: return
</a> 
         context.androidContext.classLoader.loadClass(&quot;com.snap.mushroom.MainActivity&quot;).apply {
             hook(&quot;onPostCreate&quot;, HookStage.AFTER) {
<b>diff --git a/<a id="h48" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a></b>
<a href="#h48-0" id="h48-0" class="h">@@ -36,10 +36,10 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a> 
     @SuppressLint(&quot;DiscouragedApi&quot;, &quot;InternalInsetResource&quot;)
     override fun onActivityCreate() {
<a href="#h48-0-3" id="h48-0-3" class="d">-        val blockAds = context.config.bool(ConfigProperty.BLOCK_ADS)
</a><a href="#h48-0-4" id="h48-0-4" class="d">-        val hiddenElements = context.config.options(ConfigProperty.HIDE_UI_ELEMENTS)
</a><a href="#h48-0-5" id="h48-0-5" class="d">-        val hideStorySection = context.config.options(ConfigProperty.HIDE_STORY_SECTION)
</a><a href="#h48-0-6" id="h48-0-6" class="d">-        val isImmersiveCamera = context.config.bool(ConfigProperty.IMMERSIVE_CAMERA_PREVIEW)
</a><a href="#h48-0-7" id="h48-0-7" class="i">+        val blockAds by context.config.userInterface.blockAds
</a><a href="#h48-0-8" id="h48-0-8" class="i">+        val hiddenElements by context.config.userInterface.hideUiComponents
</a><a href="#h48-0-9" id="h48-0-9" class="i">+        val hideStorySections by context.config.userInterface.hideStorySections
</a><a href="#h48-0-10" id="h48-0-10" class="i">+        val isImmersiveCamera by context.config.camera.immersiveCameraPreview
</a> 
         val displayMetrics = context.resources.displayMetrics
 
<a href="#h48-1" id="h48-1" class="h">@@ -61,11 +61,11 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a> 
         Hooker.hook(View::class.java, &quot;setVisibility&quot;, HookStage.BEFORE) { methodParam -&gt;
             val viewId = (methodParam.thisObject() as View).id
<a href="#h48-1-3" id="h48-1-3" class="d">-            if (viewId == chatNoteRecordButton &amp;&amp; hiddenElements[&quot;remove_voice_record_button&quot;] == true) {
</a><a href="#h48-1-4" id="h48-1-4" class="i">+            if (viewId == chatNoteRecordButton &amp;&amp; hiddenElements.contains(&quot;hide_voice_record_button&quot;)) {
</a>                 methodParam.setArg(0, View.GONE)
             }
             if (viewId == callButton1 || viewId == callButton2) {
<a href="#h48-1-8" id="h48-1-8" class="d">-                if (hiddenElements[&quot;remove_call_buttons&quot;] == false) return@hook
</a><a href="#h48-1-9" id="h48-1-9" class="i">+                if (!hiddenElements.contains(&quot;hide_call_buttons&quot;)) return@hook
</a>                 methodParam.setArg(0, View.GONE)
             }
         }
<a href="#h48-2" id="h48-2" class="h">@@ -79,7 +79,7 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a>             val view: View = param.arg(0)
             val viewId = view.id
 
<a href="#h48-2-3" id="h48-2-3" class="d">-            if (hideStorySection[&quot;hide_for_you&quot;] == true) {
</a><a href="#h48-2-4" id="h48-2-4" class="i">+            if (hideStorySections.contains(&quot;hide_for_you&quot;)) {
</a>                 if (viewId == getIdentifier(&quot;df_large_story&quot;, &quot;id&quot;) ||
                             viewId == getIdentifier(&quot;df_promoted_story&quot;, &quot;id&quot;)) {
                     hideStorySection(param)
<a href="#h48-3" id="h48-3" class="h">@@ -90,12 +90,12 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a>                 }
             }
 
<a href="#h48-3-3" id="h48-3-3" class="d">-            if (hideStorySection[&quot;hide_friends&quot;] == true &amp;&amp; viewId == getIdentifier(&quot;friend_card_frame&quot;, &quot;id&quot;)) {
</a><a href="#h48-3-4" id="h48-3-4" class="i">+            if (hideStorySections.contains(&quot;hide_friends&quot;) &amp;&amp; viewId == getIdentifier(&quot;friend_card_frame&quot;, &quot;id&quot;)) {
</a>                 hideStorySection(param)
             }
 
             //mappings?
<a href="#h48-3-9" id="h48-3-9" class="d">-            if (hideStorySection[&quot;hide_friend_suggestions&quot;] == true &amp;&amp; view.javaClass.superclass?.name?.endsWith(&quot;StackDrawLayout&quot;) == true) {
</a><a href="#h48-3-10" id="h48-3-10" class="i">+            if (hideStorySections.contains(&quot;hide_friend_suggestions&quot;) &amp;&amp; view.javaClass.superclass?.name?.endsWith(&quot;StackDrawLayout&quot;) == true) {
</a>                 val layoutParams = view.layoutParams as? FrameLayout.LayoutParams ?: return@hook
                 if (layoutParams.width == -1 &amp;&amp;
                     layoutParams.height == -2 &amp;&amp;
<a href="#h48-4" id="h48-4" class="h">@@ -108,7 +108,7 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a>                 }
             }
 
<a href="#h48-4-3" id="h48-4-3" class="d">-            if (hideStorySection[&quot;hide_following&quot;] == true &amp;&amp; (viewId == getIdentifier(&quot;df_small_story&quot;, &quot;id&quot;))
</a><a href="#h48-4-4" id="h48-4-4" class="i">+            if (hideStorySections.contains(&quot;hide_following&quot;) &amp;&amp; (viewId == getIdentifier(&quot;df_small_story&quot;, &quot;id&quot;))
</a>             ) {
                 hideStorySection(param)
             }
<a href="#h48-5" id="h48-5" class="h">@@ -134,26 +134,26 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a>                 }
             }
 
<a href="#h48-5-3" id="h48-5-3" class="d">-            if (viewId == chatNoteRecordButton &amp;&amp; hiddenElements[&quot;remove_voice_record_button&quot;] == true) {
</a><a href="#h48-5-4" id="h48-5-4" class="i">+            if (viewId == chatNoteRecordButton &amp;&amp; hiddenElements.contains(&quot;hide_voice_record_button&quot;)) {
</a>                 view.isEnabled = false
                 view.setWillNotDraw(true)
             }
 
<a href="#h48-5-9" id="h48-5-9" class="d">-            if (getIdentifier(&quot;chat_input_bar_cognac&quot;, &quot;id&quot;) == viewId &amp;&amp; hiddenElements[&quot;remove_cognac_button&quot;] == true) {
</a><a href="#h48-5-10" id="h48-5-10" class="i">+            if (getIdentifier(&quot;chat_input_bar_cognac&quot;, &quot;id&quot;) == viewId &amp;&amp; hiddenElements.contains(&quot;hide_cognac_button&quot;)) {
</a>                 view.visibility = View.GONE
             }
<a href="#h48-5-13" id="h48-5-13" class="d">-            if (getIdentifier(&quot;chat_input_bar_sticker&quot;, &quot;id&quot;) == viewId &amp;&amp; hiddenElements[&quot;remove_stickers_button&quot;] == true) {
</a><a href="#h48-5-14" id="h48-5-14" class="i">+            if (getIdentifier(&quot;chat_input_bar_sticker&quot;, &quot;id&quot;) == viewId &amp;&amp; hiddenElements.contains(&quot;hide_stickers_button&quot;)) {
</a>                 view.visibility = View.GONE
             }
<a href="#h48-5-17" id="h48-5-17" class="d">-            if (getIdentifier(&quot;chat_input_bar_sharing_drawer_button&quot;, &quot;id&quot;) == viewId &amp;&amp; hiddenElements[&quot;remove_live_location_share_button&quot;] == true) {
</a><a href="#h48-5-18" id="h48-5-18" class="i">+            if (getIdentifier(&quot;chat_input_bar_sharing_drawer_button&quot;, &quot;id&quot;) == viewId &amp;&amp; hiddenElements.contains(&quot;hide_live_location_share_button&quot;)) {
</a>                 param.setResult(null)
             }
             if (viewId == callButton1 || viewId == callButton2) {
<a href="#h48-5-22" id="h48-5-22" class="d">-                if (hiddenElements[&quot;remove_call_buttons&quot;] == false) return@hook
</a><a href="#h48-5-23" id="h48-5-23" class="i">+                if (!hiddenElements.contains(&quot;hide_call_buttons&quot;)) return@hook
</a>                 if (view.visibility == View.GONE) return@hook
             }
             if (viewId == callButtonsStub) {
<a href="#h48-5-27" id="h48-5-27" class="d">-                if (hiddenElements[&quot;remove_call_buttons&quot;] == false) return@hook
</a><a href="#h48-5-28" id="h48-5-28" class="i">+                if (!hiddenElements.contains(&quot;hide_call_buttons&quot;)) return@hook
</a>                 param.setResult(null)
             }
         }
<b>diff --git a/<a id="h49" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt</a></b>
<a href="#h49-0" id="h49-0" class="h">@@ -4,11 +4,14 @@ import de.robv.android.xposed.XC_MethodHook
</a> import de.robv.android.xposed.XposedBridge
 import java.lang.reflect.Member
 
<a href="#h49-0-3" id="h49-0-3" class="i">+typealias HookFilter = (HookAdapter) -&gt; Boolean
</a><a href="#h49-0-4" id="h49-0-4" class="i">+typealias HookConsumer = (HookAdapter) -&gt; Unit
</a><a href="#h49-0-5" id="h49-0-5" class="i">+
</a> object Hooker {
     inline fun newMethodHook(
         stage: HookStage,
<a href="#h49-0-9" id="h49-0-9" class="d">-        crossinline consumer: (HookAdapter) -&gt; Unit,
</a><a href="#h49-0-10" id="h49-0-10" class="d">-        crossinline filter: ((HookAdapter) -&gt; Boolean) = { true }
</a><a href="#h49-0-11" id="h49-0-11" class="i">+        crossinline consumer: HookConsumer,
</a><a href="#h49-0-12" id="h49-0-12" class="i">+        crossinline filter: HookFilter = { true }
</a>     ): XC_MethodHook {
         return if (stage == HookStage.BEFORE) object : XC_MethodHook() {
             override fun beforeHookedMethod(param: MethodHookParam&lt;*&gt;) {
<a href="#h49-1" id="h49-1" class="h">@@ -25,21 +28,21 @@ object Hooker {
</a>         clazz: Class&lt;*&gt;,
         methodName: String,
         stage: HookStage,
<a href="#h49-1-3" id="h49-1-3" class="d">-        crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-1-4" id="h49-1-4" class="i">+        crossinline consumer: HookConsumer
</a>     ): Set&lt;XC_MethodHook.Unhook&gt; = hook(clazz, methodName, stage, { true }, consumer)
 
     inline fun hook(
         clazz: Class&lt;*&gt;,
         methodName: String,
         stage: HookStage,
<a href="#h49-1-11" id="h49-1-11" class="d">-        crossinline filter: (HookAdapter) -&gt; Boolean,
</a><a href="#h49-1-12" id="h49-1-12" class="d">-        crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-1-13" id="h49-1-13" class="i">+        crossinline filter: HookFilter,
</a><a href="#h49-1-14" id="h49-1-14" class="i">+        crossinline consumer: HookConsumer
</a>     ): Set&lt;XC_MethodHook.Unhook&gt; = XposedBridge.hookAllMethods(clazz, methodName, newMethodHook(stage, consumer, filter))
 
     inline fun hook(
         member: Member,
         stage: HookStage,
<a href="#h49-1-20" id="h49-1-20" class="d">-        crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-1-21" id="h49-1-21" class="i">+        crossinline consumer: HookConsumer
</a>     ): XC_MethodHook.Unhook {
         return hook(member, stage, { true }, consumer)
     }
<a href="#h49-2" id="h49-2" class="h">@@ -47,8 +50,8 @@ object Hooker {
</a>     inline fun hook(
         member: Member,
         stage: HookStage,
<a href="#h49-2-3" id="h49-2-3" class="d">-        crossinline filter: ((HookAdapter) -&gt; Boolean),
</a><a href="#h49-2-4" id="h49-2-4" class="d">-        crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-2-5" id="h49-2-5" class="i">+        crossinline filter: HookFilter,
</a><a href="#h49-2-6" id="h49-2-6" class="i">+        crossinline consumer: HookConsumer
</a>     ): XC_MethodHook.Unhook {
         return XposedBridge.hookMethod(member, newMethodHook(stage, consumer, filter))
     }
<a href="#h49-3" id="h49-3" class="h">@@ -57,7 +60,7 @@ object Hooker {
</a>     inline fun hookConstructor(
         clazz: Class&lt;*&gt;,
         stage: HookStage,
<a href="#h49-3-3" id="h49-3-3" class="d">-        crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-3-4" id="h49-3-4" class="i">+        crossinline consumer: HookConsumer
</a>     ) {
         XposedBridge.hookAllConstructors(clazz, newMethodHook(stage, consumer))
     }
<a href="#h49-4" id="h49-4" class="h">@@ -65,8 +68,8 @@ object Hooker {
</a>     inline fun hookConstructor(
         clazz: Class&lt;*&gt;,
         stage: HookStage,
<a href="#h49-4-3" id="h49-4-3" class="d">-        crossinline filter: ((HookAdapter) -&gt; Boolean),
</a><a href="#h49-4-4" id="h49-4-4" class="d">-        crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-4-5" id="h49-4-5" class="i">+        crossinline filter: HookFilter,
</a><a href="#h49-4-6" id="h49-4-6" class="i">+        crossinline consumer: HookConsumer
</a>     ) {
         XposedBridge.hookAllConstructors(clazz, newMethodHook(stage, consumer, filter))
     }
<a href="#h49-5" id="h49-5" class="h">@@ -76,7 +79,7 @@ object Hooker {
</a>         instance: Any,
         methodName: String,
         stage: HookStage,
<a href="#h49-5-3" id="h49-5-3" class="d">-        crossinline hookConsumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-5-4" id="h49-5-4" class="i">+        crossinline hookConsumer: HookConsumer
</a>     ) {
         val unhooks: MutableSet&lt;XC_MethodHook.Unhook&gt; = HashSet()
         hook(clazz, methodName, stage) { param-&gt;
<a href="#h49-6" id="h49-6" class="h">@@ -92,7 +95,7 @@ object Hooker {
</a>         clazz: Class&lt;*&gt;,
         methodName: String,
         stage: HookStage,
<a href="#h49-6-3" id="h49-6-3" class="d">-        crossinline hookConsumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-6-4" id="h49-6-4" class="i">+        crossinline hookConsumer: HookConsumer
</a>     ) {
         val unhooks: MutableSet&lt;XC_MethodHook.Unhook&gt; = HashSet()
         hook(clazz, methodName, stage) { param-&gt;
<a href="#h49-7" id="h49-7" class="h">@@ -106,7 +109,7 @@ object Hooker {
</a>         instance: Any,
         methodName: String,
         stage: HookStage,
<a href="#h49-7-3" id="h49-7-3" class="d">-        crossinline hookConsumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-7-4" id="h49-7-4" class="i">+        crossinline hookConsumer: HookConsumer
</a>     ) {
         val unhooks: MutableSet&lt;XC_MethodHook.Unhook&gt; = HashSet()
         hook(clazz, methodName, stage) { param-&gt;
<a href="#h49-8" id="h49-8" class="h">@@ -119,35 +122,35 @@ object Hooker {
</a> 
 inline fun Class&lt;*&gt;.hookConstructor(
     stage: HookStage,
<a href="#h49-8-3" id="h49-8-3" class="d">-    crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-8-4" id="h49-8-4" class="i">+    crossinline consumer: HookConsumer
</a> ) = Hooker.hookConstructor(this, stage, consumer)
 
 inline fun Class&lt;*&gt;.hookConstructor(
     stage: HookStage,
<a href="#h49-8-9" id="h49-8-9" class="d">-    crossinline filter: ((HookAdapter) -&gt; Boolean),
</a><a href="#h49-8-10" id="h49-8-10" class="d">-    crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-8-11" id="h49-8-11" class="i">+    crossinline filter: HookFilter,
</a><a href="#h49-8-12" id="h49-8-12" class="i">+    crossinline consumer: HookConsumer
</a> ) = Hooker.hookConstructor(this, stage, filter, consumer)
 
 inline fun Class&lt;*&gt;.hook(
     methodName: String,
     stage: HookStage,
<a href="#h49-8-18" id="h49-8-18" class="d">-    crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-8-19" id="h49-8-19" class="i">+    crossinline consumer: HookConsumer
</a> ): Set&lt;XC_MethodHook.Unhook&gt; = Hooker.hook(this, methodName, stage, consumer)
 
 inline fun Class&lt;*&gt;.hook(
     methodName: String,
     stage: HookStage,
<a href="#h49-8-25" id="h49-8-25" class="d">-    crossinline filter: (HookAdapter) -&gt; Boolean,
</a><a href="#h49-8-26" id="h49-8-26" class="d">-    crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-8-27" id="h49-8-27" class="i">+    crossinline filter: HookFilter,
</a><a href="#h49-8-28" id="h49-8-28" class="i">+    crossinline consumer: HookConsumer
</a> ): Set&lt;XC_MethodHook.Unhook&gt; = Hooker.hook(this, methodName, stage, filter, consumer)
 
 inline fun Member.hook(
     stage: HookStage,
<a href="#h49-8-33" id="h49-8-33" class="d">-    crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-8-34" id="h49-8-34" class="i">+    crossinline consumer: HookConsumer
</a> ): XC_MethodHook.Unhook = Hooker.hook(this, stage, consumer)
 
 inline fun Member.hook(
     stage: HookStage,
<a href="#h49-8-39" id="h49-8-39" class="d">-    crossinline filter: ((HookAdapter) -&gt; Boolean),
</a><a href="#h49-8-40" id="h49-8-40" class="d">-    crossinline consumer: (HookAdapter) -&gt; Unit
</a><a href="#h49-8-41" id="h49-8-41" class="i">+    crossinline filter: HookFilter,
</a><a href="#h49-8-42" id="h49-8-42" class="i">+    crossinline consumer: HookConsumer
</a> ): XC_MethodHook.Unhook = Hooker.hook(this, stage, filter, consumer) 
\ No newline at end of file
<b>diff --git a/<a id="h50" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a></b>
<a href="#h50-0" id="h50-0" class="h">@@ -82,4 +82,6 @@ class ItemHelper(
</a>             callback(value)
         }
     }
<a href="#h50-0-3" id="h50-0-3" class="i">+
</a><a href="#h50-0-4" id="h50-0-4" class="i">+
</a> }
<b>diff --git a/<a id="h51" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt</a></b>
<a href="#h51-0" id="h51-0" class="h">@@ -104,7 +104,7 @@ class ChatActionMenu : AbstractMenu() {
</a>             }
         }
 
<a href="#h51-0-3" id="h51-0-3" class="d">-        if (context.config.bool(ConfigProperty.CHAT_DOWNLOAD_CONTEXT_MENU)) {
</a><a href="#h51-0-4" id="h51-0-4" class="i">+        if (context.config.downloader.chatDownloadContextMenu.get()) {
</a>             injectButton(Button(viewGroup.context).apply {
                 text = this@ChatActionMenu.context.translation[&quot;chat_action_menu.preview_button&quot;]
                 setOnClickListener {
<a href="#h51-1" id="h51-1" class="h">@@ -127,7 +127,7 @@ class ChatActionMenu : AbstractMenu() {
</a>         }
 
         //delete logged message button
<a href="#h51-1-3" id="h51-1-3" class="d">-        if (context.config.bool(ConfigProperty.MESSAGE_LOGGER)) {
</a><a href="#h51-1-4" id="h51-1-4" class="i">+        if (context.config.messaging.messageLogger.get()) {
</a>             injectButton(Button(viewGroup.context).apply {
                 text = this@ChatActionMenu.context.translation[&quot;chat_action_menu.delete_logged_message_button&quot;]
                 setOnClickListener {
<b>diff --git a/<a id="h52" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h52-0" id="h52-0" class="h">@@ -104,7 +104,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>         //query message
         val messages: List&lt;ConversationMessage&gt;? = context.database.getMessagesFromConversationId(
             conversationId,
<a href="#h52-0-3" id="h52-0-3" class="d">-            context.config.int(ConfigProperty.MESSAGE_PREVIEW_LENGTH)
</a><a href="#h52-0-4" id="h52-0-4" class="i">+            context.config.messaging.messagePreviewLength.get()
</a>         )?.reversed()
 
         if (messages.isNullOrEmpty()) {
<a href="#h52-1" id="h52-1" class="h">@@ -240,12 +240,12 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>     fun inject(viewModel: View, viewConsumer: ((View) -&gt; Unit)) {
         val modContext = context
 
<a href="#h52-1-3" id="h52-1-3" class="d">-        val friendFeedMenuOptions = context.config.options(ConfigProperty.FRIEND_FEED_MENU_BUTTONS)
</a><a href="#h52-1-4" id="h52-1-4" class="d">-        if (friendFeedMenuOptions.none { it.value }) return
</a><a href="#h52-1-5" id="h52-1-5" class="i">+        val friendFeedMenuOptions by context.config.userInterface.friendFeedMenuButtons
</a><a href="#h52-1-6" id="h52-1-6" class="i">+        if (friendFeedMenuOptions.isEmpty()) return
</a> 
         val (conversationId, targetUser) = getCurrentConversationInfo()
 
<a href="#h52-1-10" id="h52-1-10" class="d">-        if (!context.config.bool(ConfigProperty.ENABLE_FRIEND_FEED_MENU_BAR)) {
</a><a href="#h52-1-11" id="h52-1-11" class="i">+        if (!context.config.userInterface.enableFriendFeedMenuBar.get()) {
</a>             //preview button
             val previewButton = Button(viewModel.context).apply {
                 text = modContext.translation[&quot;friend_menu_option.preview&quot;]
<a href="#h52-2" id="h52-2" class="h">@@ -272,7 +272,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>                 }
             }
 
<a href="#h52-2-3" id="h52-2-3" class="d">-            if (friendFeedMenuOptions[&quot;anti_auto_save&quot;] == true) {
</a><a href="#h52-2-4" id="h52-2-4" class="i">+            if (friendFeedMenuOptions.contains(&quot;anti_auto_save&quot;)) {
</a>                 createToggleFeature(viewConsumer,
                     &quot;friend_menu_option.anti_auto_save&quot;,
                     { context.feature(AntiAutoSave::class).isConversationIgnored(conversationId) },
<a href="#h52-3" id="h52-3" class="h">@@ -282,7 +282,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a> 
             run {
                 val userId = context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId ?: return@run
<a href="#h52-3-3" id="h52-3-3" class="d">-                if (friendFeedMenuOptions[&quot;auto_download_blacklist&quot;] == true) {
</a><a href="#h52-3-4" id="h52-3-4" class="i">+                if (friendFeedMenuOptions.contains(&quot;auto_download_blacklist&quot;)) {
</a>                     createToggleFeature(viewConsumer,
                         &quot;friend_menu_option.auto_download_blacklist&quot;,
                         { context.feature(AntiAutoDownload::class).isUserIgnored(userId) },
<a href="#h52-4" id="h52-4" class="h">@@ -291,10 +291,10 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>                 }
             }
 
<a href="#h52-4-3" id="h52-4-3" class="d">-            if (friendFeedMenuOptions[&quot;stealth_mode&quot;] == true) {
</a><a href="#h52-4-4" id="h52-4-4" class="i">+            if (friendFeedMenuOptions.contains(&quot;stealth_mode&quot;)) {
</a>                 viewConsumer(stealthSwitch)
             }
<a href="#h52-4-7" id="h52-4-7" class="d">-            if (friendFeedMenuOptions[&quot;conversation_info&quot;] == true) {
</a><a href="#h52-4-8" id="h52-4-8" class="i">+            if (friendFeedMenuOptions.contains(&quot;conversation_info&quot;)) {
</a>                 viewConsumer(previewButton)
             }
             return
<a href="#h52-5" id="h52-5" class="h">@@ -338,7 +338,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>             })
         }
 
<a href="#h52-5-3" id="h52-5-3" class="d">-        if (friendFeedMenuOptions[&quot;auto_download_blacklist&quot;] == true) {
</a><a href="#h52-5-4" id="h52-5-4" class="i">+        if (friendFeedMenuOptions.contains(&quot;auto_download_blacklist&quot;)) {
</a>             run {
                 val userId =
                     context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId
<a href="#h52-6" id="h52-6" class="h">@@ -352,7 +352,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>             }
         }
 
<a href="#h52-6-3" id="h52-6-3" class="d">-        if (friendFeedMenuOptions[&quot;anti_auto_save&quot;] == true) {
</a><a href="#h52-6-4" id="h52-6-4" class="i">+        if (friendFeedMenuOptions.contains(&quot;anti_auto_save&quot;)) {
</a>             //diskette
             createActionButton(&quot;\uD83D\uDCAC&quot;,
                 isDisabled = !context.feature(AntiAutoSave::class)
<a href="#h52-7" id="h52-7" class="h">@@ -363,7 +363,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>         }
 
 
<a href="#h52-7-3" id="h52-7-3" class="d">-        if (friendFeedMenuOptions[&quot;stealth_mode&quot;] == true) {
</a><a href="#h52-7-4" id="h52-7-4" class="i">+        if (friendFeedMenuOptions.contains(&quot;stealth_mode&quot;)) {
</a>             //eyes
             createActionButton(
                 &quot;\uD83D\uDC7B&quot;,
<a href="#h52-8" id="h52-8" class="h">@@ -376,7 +376,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>             }
         }
 
<a href="#h52-8-3" id="h52-8-3" class="d">-        if (friendFeedMenuOptions[&quot;conversation_info&quot;] == true) {
</a><a href="#h52-8-4" id="h52-8-4" class="i">+        if (friendFeedMenuOptions.contains(&quot;conversation_info&quot;)) {
</a>             //user
             createActionButton(&quot;\uD83D\uDC64&quot;) {
                 showPreview(
<b>diff --git a/<a id="h53" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt</a></b>
<a href="#h53-0" id="h53-0" class="h">@@ -124,7 +124,7 @@ class MenuViewInjector : Feature(&quot;MenuViewInjector&quot;, loadParams = FeatureLoadPar
</a>                     viewGroup.addOnAttachStateChangeListener(object: View.OnAttachStateChangeListener {
                         override fun onViewAttachedToWindow(v: View) {}
                         override fun onViewDetachedFromWindow(v: View) {
<a href="#h53-0-3" id="h53-0-3" class="d">-                            context.config.writeConfig()
</a><a href="#h53-0-4" id="h53-0-4" class="i">+                            //context.config.writeConfig()
</a>                         }
                     })
                     return@hook
<a href="#h53-1" id="h53-1" class="h">@@ -132,10 +132,9 @@ class MenuViewInjector : Feature(&quot;MenuViewInjector&quot;, loadParams = FeatureLoadPar
</a>                 if (messaging.lastFetchConversationUUID == null || messaging.lastFetchConversationUserUUID == null) return@hook
 
                 //filter by the slot index
<a href="#h53-1-3" id="h53-1-3" class="d">-                if (viewGroup.getChildCount() != context.config.int(ConfigProperty.FRIEND_FEED_MENU_POSITION)) return@hook
</a><a href="#h53-1-4" id="h53-1-4" class="i">+                if (viewGroup.getChildCount() != context.config.userInterface.friendFeedMenuPosition.get()) return@hook
</a>                 friendFeedInfoMenu.inject(viewGroup, originalAddView)
             }
         }
     }
<a href="#h53-1-9" id="h53-1-9" class="d">-
</a> } 
\ No newline at end of file
</pre>
</div>
</body>
</html>
