<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Merge branch &#39;refs/heads/refactor_ex&#39; into refactor - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/12ad30ffd804e86aa4f6b12726be35d4efc7a8a1.html">12ad30ffd804e86aa4f6b12726be35d4efc7a8a1</a>
<b>parent</b> <a href="../commit/fb3d7af9cc101bc96d809ffde288f54315eb34d4.html">fb3d7af9cc101bc96d809ffde288f54315eb34d4</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Wed, 17 Jul 2024 12:55:25 +0200

Merge branch &#39;refs/heads/refactor_ex&#39; into refactor

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSharedLibraryManager.kt</a></td><td> | </td><td class="num">81</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/storage/AppDatabase.kt</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/storage/Repositories.kt</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt</a></td><td> | </td><td class="num">126</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a></td><td> | </td><td class="num">7</td><td><span class="i">+++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/LoggerHistoryRoot.kt</a></td><td> | </td><td class="num">10</td><td><span class="i">++</span><span class="d">--------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/ManageReposSection.kt</a></td><td> | </td><td class="num">188</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt</a></td><td> | </td><td class="num">43</td><td><span class="i">+++++++++++++++++</span><span class="d">--------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">+++++++</span><span class="d">-----</span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt</a></td><td> | </td><td class="num">394</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt</a></td><td> | </td><td class="num">273</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt</a></td><td> | </td><td class="num">464</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/tracker/LogsTab.kt</a></td><td> | </td><td class="num">9</td><td><span class="i">++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt</a></td><td> | </td><td class="num">22</td><td><span class="i">++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SecurityScreen.kt</a></td><td> | </td><td class="num">87</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h21">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ColorPicker.kt</a></td><td> | </td><td class="num">28</td><td><span class="i">++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">common/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">136</td><td><span class="i">+++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h23">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a></td><td> | </td><td class="num">7</td><td><span class="i">++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h24">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LoggerWrapper.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h25">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">+</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h26">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a></td><td> | </td><td class="num">40</td><td><span class="i">++++++</span><span class="d">----------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h27">common/src/main/kotlin/me/rhunk/snapenhance/common/data/ThemingObjects.kt</a></td><td> | </td><td class="num">120</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h28">common/src/main/kotlin/me/rhunk/snapenhance/common/ui/TextFieldColors.kt</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h29">common/src/main/kotlin/me/rhunk/snapenhance/common/util/ktx/AndroidCompatExtensions.kt</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++++++++++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h30">core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt</a></td><td> | </td><td class="num">2</td><td><span class="i"></span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a></td><td> | </td><td class="num">81</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/DeviceSpooferHook.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h34">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt</a></td><td> | </td><td class="num">131</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h35">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomizeUI.kt</a></td><td> | </td><td class="num">211</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">native/jni/src/common.h</a></td><td> | </td><td class="num">1</td><td><span class="i"></span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">native/jni/src/dobby_helper.h</a></td><td> | </td><td class="num">3</td><td><span class="i"></span><span class="d">---</span></td></tr>
<tr><td class="A">A</td><td><a href="#h38">native/jni/src/hooks/linker_hook.h</a></td><td> | </td><td class="num">55</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h39">native/jni/src/library.cpp</a></td><td> | </td><td class="num">18</td><td><span class="i">++++</span><span class="d">--------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h40">native/jni/src/util.h</a></td><td> | </td><td class="num">40</td><td><span class="i"></span><span class="d">----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h41">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeConfig.kt</a></td><td> | </td><td class="num">2</td><td><span class="i"></span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h42">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt</a></td><td> | </td><td class="num">25</td><td><span class="i">+++++++++++++++++++</span><span class="d">------</span></td></tr>
</table></pre><pre>43 files changed, 2300 insertions(+), 491 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteFileHandleManager.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -8,10 +8,28 @@ import me.rhunk.snapenhance.common.bridge.InternalFileHandleType
</a> import me.rhunk.snapenhance.common.bridge.wrapper.LocaleWrapper
 import me.rhunk.snapenhance.common.logger.AbstractLogger
 import me.rhunk.snapenhance.common.util.ktx.toParcelFileDescriptor
<a href="#h0-0-3" id="h0-0-3" class="i">+import me.rhunk.snapenhance.storage.getEnabledThemesContent
</a> import java.io.File
 import java.io.OutputStream
 
 
<a href="#h0-0-8" id="h0-0-8" class="i">+class ByteArrayFileHandle(
</a><a href="#h0-0-9" id="h0-0-9" class="i">+    private val context: RemoteSideContext,
</a><a href="#h0-0-10" id="h0-0-10" class="i">+    private val data: ByteArray
</a><a href="#h0-0-11" id="h0-0-11" class="i">+): FileHandle.Stub() {
</a><a href="#h0-0-12" id="h0-0-12" class="i">+    override fun exists() = true
</a><a href="#h0-0-13" id="h0-0-13" class="i">+    override fun create() = false
</a><a href="#h0-0-14" id="h0-0-14" class="i">+    override fun delete() = false
</a><a href="#h0-0-15" id="h0-0-15" class="i">+
</a><a href="#h0-0-16" id="h0-0-16" class="i">+    override fun open(mode: Int): ParcelFileDescriptor? {
</a><a href="#h0-0-17" id="h0-0-17" class="i">+        return runCatching {
</a><a href="#h0-0-18" id="h0-0-18" class="i">+            data.inputStream().toParcelFileDescriptor(context.coroutineScope)
</a><a href="#h0-0-19" id="h0-0-19" class="i">+        }.onFailure {
</a><a href="#h0-0-20" id="h0-0-20" class="i">+            context.log.error(&quot;Failed to open byte array file handle: ${it.message}&quot;, it)
</a><a href="#h0-0-21" id="h0-0-21" class="i">+        }.getOrNull()
</a><a href="#h0-0-22" id="h0-0-22" class="i">+    }
</a><a href="#h0-0-23" id="h0-0-23" class="i">+}
</a><a href="#h0-0-24" id="h0-0-24" class="i">+
</a> class LocalFileHandle(
     private val file: File
 ): FileHandle.Stub() {
<a href="#h0-1" id="h0-1" class="h">@@ -97,6 +115,12 @@ class RemoteFileHandleManager(
</a>                     &quot;composer/${name.substringAfterLast(&quot;/&quot;)}&quot;
                 )
             }
<a href="#h0-1-3" id="h0-1-3" class="i">+            FileHandleScope.THEME -&gt; {
</a><a href="#h0-1-4" id="h0-1-4" class="i">+                return ByteArrayFileHandle(
</a><a href="#h0-1-5" id="h0-1-5" class="i">+                    context,
</a><a href="#h0-1-6" id="h0-1-6" class="i">+                    context.gson.toJson(context.database.getEnabledThemesContent()).toByteArray(Charsets.UTF_8)
</a><a href="#h0-1-7" id="h0-1-7" class="i">+                )
</a><a href="#h0-1-8" id="h0-1-8" class="i">+            }
</a>             else -&gt; return null
         }
     }
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSharedLibraryManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSharedLibraryManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSharedLibraryManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSharedLibraryManager.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -0,0 +1,80 @@
</a><a href="#h1-0-0" id="h1-0-0" class="i">+package me.rhunk.snapenhance
</a><a href="#h1-0-1" id="h1-0-1" class="i">+
</a><a href="#h1-0-2" id="h1-0-2" class="i">+import android.os.Build
</a><a href="#h1-0-3" id="h1-0-3" class="i">+import me.rhunk.snapenhance.common.bridge.InternalFileHandleType
</a><a href="#h1-0-4" id="h1-0-4" class="i">+import okhttp3.OkHttpClient
</a><a href="#h1-0-5" id="h1-0-5" class="i">+import okhttp3.Request
</a><a href="#h1-0-6" id="h1-0-6" class="i">+import java.io.File
</a><a href="#h1-0-7" id="h1-0-7" class="i">+
</a><a href="#h1-0-8" id="h1-0-8" class="i">+class RemoteSharedLibraryManager(
</a><a href="#h1-0-9" id="h1-0-9" class="i">+    private val remoteSideContext: RemoteSideContext
</a><a href="#h1-0-10" id="h1-0-10" class="i">+) {
</a><a href="#h1-0-11" id="h1-0-11" class="i">+    private val okHttpClient = OkHttpClient()
</a><a href="#h1-0-12" id="h1-0-12" class="i">+
</a><a href="#h1-0-13" id="h1-0-13" class="i">+    private fun getVersion(): String? {
</a><a href="#h1-0-14" id="h1-0-14" class="i">+        return runCatching {
</a><a href="#h1-0-15" id="h1-0-15" class="i">+            okHttpClient.newCall(
</a><a href="#h1-0-16" id="h1-0-16" class="i">+                Request.Builder()
</a><a href="#h1-0-17" id="h1-0-17" class="i">+                    .url(&quot;https://raw.githubusercontent.com/SnapEnhance/resources/main/sif/version&quot;)
</a><a href="#h1-0-18" id="h1-0-18" class="i">+                    .build()
</a><a href="#h1-0-19" id="h1-0-19" class="i">+            ).execute().use { response -&gt;
</a><a href="#h1-0-20" id="h1-0-20" class="i">+                if (!response.isSuccessful) {
</a><a href="#h1-0-21" id="h1-0-21" class="i">+                    return null
</a><a href="#h1-0-22" id="h1-0-22" class="i">+                }
</a><a href="#h1-0-23" id="h1-0-23" class="i">+                response.body.string()
</a><a href="#h1-0-24" id="h1-0-24" class="i">+            }
</a><a href="#h1-0-25" id="h1-0-25" class="i">+        }.getOrNull()
</a><a href="#h1-0-26" id="h1-0-26" class="i">+    }
</a><a href="#h1-0-27" id="h1-0-27" class="i">+
</a><a href="#h1-0-28" id="h1-0-28" class="i">+    private fun downloadLatest(outputFile: File): Boolean {
</a><a href="#h1-0-29" id="h1-0-29" class="i">+        val abi = Build.SUPPORTED_ABIS.firstOrNull() ?: return false
</a><a href="#h1-0-30" id="h1-0-30" class="i">+        val request = Request.Builder()
</a><a href="#h1-0-31" id="h1-0-31" class="i">+            .url(&quot;https://raw.githubusercontent.com/SnapEnhance/resources/main/sif/$abi.so&quot;)
</a><a href="#h1-0-32" id="h1-0-32" class="i">+            .build()
</a><a href="#h1-0-33" id="h1-0-33" class="i">+        runCatching {
</a><a href="#h1-0-34" id="h1-0-34" class="i">+            okHttpClient.newCall(request).execute().use { response -&gt;
</a><a href="#h1-0-35" id="h1-0-35" class="i">+                if (!response.isSuccessful) {
</a><a href="#h1-0-36" id="h1-0-36" class="i">+                    return false
</a><a href="#h1-0-37" id="h1-0-37" class="i">+                }
</a><a href="#h1-0-38" id="h1-0-38" class="i">+                response.body.byteStream().use { input -&gt;
</a><a href="#h1-0-39" id="h1-0-39" class="i">+                    outputFile.outputStream().use { output -&gt;
</a><a href="#h1-0-40" id="h1-0-40" class="i">+                        input.copyTo(output)
</a><a href="#h1-0-41" id="h1-0-41" class="i">+                    }
</a><a href="#h1-0-42" id="h1-0-42" class="i">+                }
</a><a href="#h1-0-43" id="h1-0-43" class="i">+                return true
</a><a href="#h1-0-44" id="h1-0-44" class="i">+            }
</a><a href="#h1-0-45" id="h1-0-45" class="i">+        }.onFailure {
</a><a href="#h1-0-46" id="h1-0-46" class="i">+            remoteSideContext.log.error(&quot;Failed to download latest sif&quot;, it)
</a><a href="#h1-0-47" id="h1-0-47" class="i">+        }
</a><a href="#h1-0-48" id="h1-0-48" class="i">+        return false
</a><a href="#h1-0-49" id="h1-0-49" class="i">+    }
</a><a href="#h1-0-50" id="h1-0-50" class="i">+
</a><a href="#h1-0-51" id="h1-0-51" class="i">+    fun init() {
</a><a href="#h1-0-52" id="h1-0-52" class="i">+        val libraryFile = InternalFileHandleType.SIF.resolve(remoteSideContext.androidContext)
</a><a href="#h1-0-53" id="h1-0-53" class="i">+        val currentVersion = remoteSideContext.sharedPreferences.getString(&quot;sif&quot;, null)?.trim()
</a><a href="#h1-0-54" id="h1-0-54" class="i">+        if (currentVersion == null || currentVersion == &quot;false&quot;) {
</a><a href="#h1-0-55" id="h1-0-55" class="i">+            libraryFile.takeIf { it.exists() }?.delete()
</a><a href="#h1-0-56" id="h1-0-56" class="i">+            remoteSideContext.log.info(&quot;sif can&#39;t be loaded due to user preference&quot;)
</a><a href="#h1-0-57" id="h1-0-57" class="i">+            return
</a><a href="#h1-0-58" id="h1-0-58" class="i">+        }
</a><a href="#h1-0-59" id="h1-0-59" class="i">+        val latestVersion = getVersion()?.trim() ?: run {
</a><a href="#h1-0-60" id="h1-0-60" class="i">+            remoteSideContext.log.warn(&quot;Failed to get latest sif version&quot;)
</a><a href="#h1-0-61" id="h1-0-61" class="i">+            return
</a><a href="#h1-0-62" id="h1-0-62" class="i">+        }
</a><a href="#h1-0-63" id="h1-0-63" class="i">+
</a><a href="#h1-0-64" id="h1-0-64" class="i">+        if (currentVersion == latestVersion) {
</a><a href="#h1-0-65" id="h1-0-65" class="i">+            remoteSideContext.log.info(&quot;sif is up to date ($currentVersion)&quot;)
</a><a href="#h1-0-66" id="h1-0-66" class="i">+            return
</a><a href="#h1-0-67" id="h1-0-67" class="i">+        }
</a><a href="#h1-0-68" id="h1-0-68" class="i">+
</a><a href="#h1-0-69" id="h1-0-69" class="i">+        remoteSideContext.log.info(&quot;Updating sif from $currentVersion to $latestVersion&quot;)
</a><a href="#h1-0-70" id="h1-0-70" class="i">+        if (downloadLatest(libraryFile)) {
</a><a href="#h1-0-71" id="h1-0-71" class="i">+            remoteSideContext.sharedPreferences.edit().putString(&quot;sif&quot;, latestVersion).commit()
</a><a href="#h1-0-72" id="h1-0-72" class="i">+            remoteSideContext.shortToast(&quot;SIF updated to $latestVersion!&quot;)
</a><a href="#h1-0-73" id="h1-0-73" class="i">+            // force restart snapchat
</a><a href="#h1-0-74" id="h1-0-74" class="i">+            remoteSideContext.bridgeService?.stopSelf()
</a><a href="#h1-0-75" id="h1-0-75" class="i">+        } else {
</a><a href="#h1-0-76" id="h1-0-76" class="i">+            remoteSideContext.log.warn(&quot;Failed to download latest sif&quot;)
</a><a href="#h1-0-77" id="h1-0-77" class="i">+        }
</a><a href="#h1-0-78" id="h1-0-78" class="i">+    }
</a><a href="#h1-0-79" id="h1-0-79" class="i">+}</a><a href="#h1-0-80" id="h1-0-80" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -78,6 +78,7 @@ class RemoteSideContext(
</a>     val tracker = RemoteTracker(this)
     val accountStorage = RemoteAccountStorage(this)
     val locationManager = RemoteLocationManager(this)
<a href="#h2-0-3" id="h2-0-3" class="i">+    val remoteSharedLibraryManager = RemoteSharedLibraryManager(this)
</a> 
     //used to load bitmoji selfies and download previews
     val imageLoader by lazy {
<a href="#h2-1" id="h2-1" class="h">@@ -131,6 +132,9 @@ class RemoteSideContext(
</a>                         messageLogger.purgeTrackerLogs(it)
                     }
                 }
<a href="#h2-1-3" id="h2-1-3" class="i">+                coroutineScope.launch {
</a><a href="#h2-1-4" id="h2-1-4" class="i">+                    remoteSharedLibraryManager.init()
</a><a href="#h2-1-5" id="h2-1-5" class="i">+                }
</a>             }
         }.onFailure {
             log.error(&quot;Failed to load RemoteSideContext&quot;, it)
<a href="#h2-2" id="h2-2" class="h">@@ -212,6 +216,10 @@ class RemoteSideContext(
</a>             requirements = requirements or Requirements.MAPPINGS
         }
 
<a href="#h2-2-3" id="h2-2-3" class="i">+        if (sharedPreferences.getString(&quot;sif&quot;, null) == null) {
</a><a href="#h2-2-4" id="h2-2-4" class="i">+            requirements = requirements or Requirements.SIF
</a><a href="#h2-2-5" id="h2-2-5" class="i">+        }
</a><a href="#h2-2-6" id="h2-2-6" class="i">+
</a>         if (requirements == 0) return false
 
         val currentContext = activity ?: androidContext
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/EnumQuickActions.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -3,6 +3,7 @@ package me.rhunk.snapenhance.action
</a> import androidx.compose.material.icons.Icons
 import androidx.compose.material.icons.filled.FolderOpen
 import androidx.compose.material.icons.filled.History
<a href="#h3-0-3" id="h3-0-3" class="i">+import androidx.compose.material.icons.filled.Palette
</a> import androidx.compose.material.icons.filled.PersonSearch
 import androidx.compose.ui.graphics.vector.ImageVector
 import me.rhunk.snapenhance.ui.manager.Routes
<a href="#h3-1" id="h3-1" class="h">@@ -21,4 +22,7 @@ enum class EnumQuickActions(
</a>     LOGGER_HISTORY(&quot;logger_history&quot;, Icons.Default.History, {
         loggerHistory.navigateReset()
     }),
<a href="#h3-1-3" id="h3-1-3" class="i">+    THEMING(&quot;theming&quot;, Icons.Default.Palette, {
</a><a href="#h3-1-4" id="h3-1-4" class="i">+        theming.navigateReset()
</a><a href="#h3-1-5" id="h3-1-5" class="i">+    })
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/storage/AppDatabase.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/storage/AppDatabase.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/storage/AppDatabase.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/storage/AppDatabase.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -89,6 +89,19 @@ class AppDatabase(
</a>                 &quot;longitude DOUBLE&quot;,
                 &quot;radius DOUBLE&quot;,
             ),
<a href="#h4-0-3" id="h4-0-3" class="i">+            &quot;themes&quot; to listOf(
</a><a href="#h4-0-4" id="h4-0-4" class="i">+                &quot;id INTEGER PRIMARY KEY AUTOINCREMENT&quot;,
</a><a href="#h4-0-5" id="h4-0-5" class="i">+                &quot;enabled BOOLEAN DEFAULT 0&quot;,
</a><a href="#h4-0-6" id="h4-0-6" class="i">+                &quot;name VARCHAR&quot;,
</a><a href="#h4-0-7" id="h4-0-7" class="i">+                &quot;description TEXT&quot;,
</a><a href="#h4-0-8" id="h4-0-8" class="i">+                &quot;version VARCHAR&quot;,
</a><a href="#h4-0-9" id="h4-0-9" class="i">+                &quot;author VARCHAR&quot;,
</a><a href="#h4-0-10" id="h4-0-10" class="i">+                &quot;updateUrl VARCHAR&quot;,
</a><a href="#h4-0-11" id="h4-0-11" class="i">+                &quot;content TEXT&quot;,
</a><a href="#h4-0-12" id="h4-0-12" class="i">+            ),
</a><a href="#h4-0-13" id="h4-0-13" class="i">+            &quot;repositories&quot; to listOf(
</a><a href="#h4-0-14" id="h4-0-14" class="i">+                &quot;url VARCHAR PRIMARY KEY&quot;,
</a><a href="#h4-0-15" id="h4-0-15" class="i">+            ),
</a>         ))
     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/storage/Repositories.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/storage/Repositories.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/storage/Repositories.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/storage/Repositories.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,34 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+package me.rhunk.snapenhance.storage
</a><a href="#h5-0-1" id="h5-0-1" class="i">+
</a><a href="#h5-0-2" id="h5-0-2" class="i">+import android.content.ContentValues
</a><a href="#h5-0-3" id="h5-0-3" class="i">+import kotlinx.coroutines.asCoroutineDispatcher
</a><a href="#h5-0-4" id="h5-0-4" class="i">+import kotlinx.coroutines.runBlocking
</a><a href="#h5-0-5" id="h5-0-5" class="i">+import me.rhunk.snapenhance.common.util.ktx.getStringOrNull
</a><a href="#h5-0-6" id="h5-0-6" class="i">+
</a><a href="#h5-0-7" id="h5-0-7" class="i">+
</a><a href="#h5-0-8" id="h5-0-8" class="i">+fun AppDatabase.getRepositories(): List&lt;String&gt; {
</a><a href="#h5-0-9" id="h5-0-9" class="i">+    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h5-0-10" id="h5-0-10" class="i">+        database.rawQuery(&quot;SELECT url FROM repositories&quot;, null).use { cursor -&gt;
</a><a href="#h5-0-11" id="h5-0-11" class="i">+            val repos = mutableListOf&lt;String&gt;()
</a><a href="#h5-0-12" id="h5-0-12" class="i">+            while (cursor.moveToNext()) {
</a><a href="#h5-0-13" id="h5-0-13" class="i">+                repos.add(cursor.getStringOrNull(&quot;url&quot;) ?: continue)
</a><a href="#h5-0-14" id="h5-0-14" class="i">+            }
</a><a href="#h5-0-15" id="h5-0-15" class="i">+            repos
</a><a href="#h5-0-16" id="h5-0-16" class="i">+        }
</a><a href="#h5-0-17" id="h5-0-17" class="i">+    }
</a><a href="#h5-0-18" id="h5-0-18" class="i">+}
</a><a href="#h5-0-19" id="h5-0-19" class="i">+
</a><a href="#h5-0-20" id="h5-0-20" class="i">+fun AppDatabase.removeRepo(url: String) {
</a><a href="#h5-0-21" id="h5-0-21" class="i">+    runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h5-0-22" id="h5-0-22" class="i">+        database.delete(&quot;repositories&quot;, &quot;url = ?&quot;, arrayOf(url))
</a><a href="#h5-0-23" id="h5-0-23" class="i">+    }
</a><a href="#h5-0-24" id="h5-0-24" class="i">+}
</a><a href="#h5-0-25" id="h5-0-25" class="i">+
</a><a href="#h5-0-26" id="h5-0-26" class="i">+fun AppDatabase.addRepo(url: String) {
</a><a href="#h5-0-27" id="h5-0-27" class="i">+    runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h5-0-28" id="h5-0-28" class="i">+        database.insert(&quot;repositories&quot;, null, ContentValues().apply {
</a><a href="#h5-0-29" id="h5-0-29" class="i">+            put(&quot;url&quot;, url)
</a><a href="#h5-0-30" id="h5-0-30" class="i">+        })
</a><a href="#h5-0-31" id="h5-0-31" class="i">+    }
</a><a href="#h5-0-32" id="h5-0-32" class="i">+}
</a><a href="#h5-0-33" id="h5-0-33" class="i">+
</a><b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/storage/Theming.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,126 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+package me.rhunk.snapenhance.storage
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+import android.content.ContentValues
</a><a href="#h6-0-3" id="h6-0-3" class="i">+import kotlinx.coroutines.asCoroutineDispatcher
</a><a href="#h6-0-4" id="h6-0-4" class="i">+import kotlinx.coroutines.runBlocking
</a><a href="#h6-0-5" id="h6-0-5" class="i">+import me.rhunk.snapenhance.common.data.DatabaseTheme
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import me.rhunk.snapenhance.common.data.DatabaseThemeContent
</a><a href="#h6-0-7" id="h6-0-7" class="i">+import me.rhunk.snapenhance.common.util.ktx.getIntOrNull
</a><a href="#h6-0-8" id="h6-0-8" class="i">+import me.rhunk.snapenhance.common.util.ktx.getStringOrNull
</a><a href="#h6-0-9" id="h6-0-9" class="i">+
</a><a href="#h6-0-10" id="h6-0-10" class="i">+
</a><a href="#h6-0-11" id="h6-0-11" class="i">+fun AppDatabase.getThemeList(): List&lt;DatabaseTheme&gt; {
</a><a href="#h6-0-12" id="h6-0-12" class="i">+    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-13" id="h6-0-13" class="i">+        database.rawQuery(&quot;SELECT * FROM themes ORDER BY id DESC&quot;, null).use { cursor -&gt;
</a><a href="#h6-0-14" id="h6-0-14" class="i">+            val themes = mutableListOf&lt;DatabaseTheme&gt;()
</a><a href="#h6-0-15" id="h6-0-15" class="i">+            while (cursor.moveToNext()) {
</a><a href="#h6-0-16" id="h6-0-16" class="i">+                themes.add(
</a><a href="#h6-0-17" id="h6-0-17" class="i">+                    DatabaseTheme(
</a><a href="#h6-0-18" id="h6-0-18" class="i">+                        id = cursor.getIntOrNull(&quot;id&quot;) ?: continue,
</a><a href="#h6-0-19" id="h6-0-19" class="i">+                        enabled = cursor.getIntOrNull(&quot;enabled&quot;) == 1,
</a><a href="#h6-0-20" id="h6-0-20" class="i">+                        name = cursor.getStringOrNull(&quot;name&quot;) ?: continue,
</a><a href="#h6-0-21" id="h6-0-21" class="i">+                        description = cursor.getStringOrNull(&quot;description&quot;),
</a><a href="#h6-0-22" id="h6-0-22" class="i">+                        version = cursor.getStringOrNull(&quot;version&quot;),
</a><a href="#h6-0-23" id="h6-0-23" class="i">+                        author = cursor.getStringOrNull(&quot;author&quot;),
</a><a href="#h6-0-24" id="h6-0-24" class="i">+                        updateUrl = cursor.getStringOrNull(&quot;updateUrl&quot;)
</a><a href="#h6-0-25" id="h6-0-25" class="i">+                    )
</a><a href="#h6-0-26" id="h6-0-26" class="i">+                )
</a><a href="#h6-0-27" id="h6-0-27" class="i">+            }
</a><a href="#h6-0-28" id="h6-0-28" class="i">+            themes
</a><a href="#h6-0-29" id="h6-0-29" class="i">+        }
</a><a href="#h6-0-30" id="h6-0-30" class="i">+    }
</a><a href="#h6-0-31" id="h6-0-31" class="i">+}
</a><a href="#h6-0-32" id="h6-0-32" class="i">+
</a><a href="#h6-0-33" id="h6-0-33" class="i">+fun AppDatabase.getThemeInfo(id: Int): DatabaseTheme? {
</a><a href="#h6-0-34" id="h6-0-34" class="i">+    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-35" id="h6-0-35" class="i">+        database.rawQuery(&quot;SELECT * FROM themes WHERE id = ?&quot;, arrayOf(id.toString())).use { cursor -&gt;
</a><a href="#h6-0-36" id="h6-0-36" class="i">+            if (!cursor.moveToFirst()) return@use null
</a><a href="#h6-0-37" id="h6-0-37" class="i">+            DatabaseTheme(
</a><a href="#h6-0-38" id="h6-0-38" class="i">+                id = cursor.getIntOrNull(&quot;id&quot;) ?: return@use null,
</a><a href="#h6-0-39" id="h6-0-39" class="i">+                enabled = cursor.getIntOrNull(&quot;enabled&quot;) == 1,
</a><a href="#h6-0-40" id="h6-0-40" class="i">+                name = cursor.getStringOrNull(&quot;name&quot;) ?: return@use null,
</a><a href="#h6-0-41" id="h6-0-41" class="i">+                description = cursor.getStringOrNull(&quot;description&quot;),
</a><a href="#h6-0-42" id="h6-0-42" class="i">+                version = cursor.getStringOrNull(&quot;version&quot;),
</a><a href="#h6-0-43" id="h6-0-43" class="i">+                author = cursor.getStringOrNull(&quot;author&quot;),
</a><a href="#h6-0-44" id="h6-0-44" class="i">+                updateUrl = cursor.getStringOrNull(&quot;updateUrl&quot;)
</a><a href="#h6-0-45" id="h6-0-45" class="i">+            )
</a><a href="#h6-0-46" id="h6-0-46" class="i">+        }
</a><a href="#h6-0-47" id="h6-0-47" class="i">+    }
</a><a href="#h6-0-48" id="h6-0-48" class="i">+}
</a><a href="#h6-0-49" id="h6-0-49" class="i">+
</a><a href="#h6-0-50" id="h6-0-50" class="i">+fun AppDatabase.getThemeIdByUpdateUrl(updateUrl: String): Int? {
</a><a href="#h6-0-51" id="h6-0-51" class="i">+    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-52" id="h6-0-52" class="i">+        database.rawQuery(&quot;SELECT id FROM themes WHERE updateUrl = ?&quot;, arrayOf(updateUrl)).use { cursor -&gt;
</a><a href="#h6-0-53" id="h6-0-53" class="i">+            if (!cursor.moveToFirst()) return@use null
</a><a href="#h6-0-54" id="h6-0-54" class="i">+            cursor.getIntOrNull(&quot;id&quot;)
</a><a href="#h6-0-55" id="h6-0-55" class="i">+        }
</a><a href="#h6-0-56" id="h6-0-56" class="i">+    }
</a><a href="#h6-0-57" id="h6-0-57" class="i">+}
</a><a href="#h6-0-58" id="h6-0-58" class="i">+
</a><a href="#h6-0-59" id="h6-0-59" class="i">+fun AppDatabase.addOrUpdateTheme(theme: DatabaseTheme, themeId: Int? = null): Int {
</a><a href="#h6-0-60" id="h6-0-60" class="i">+    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-61" id="h6-0-61" class="i">+        val contentValues = ContentValues().apply {
</a><a href="#h6-0-62" id="h6-0-62" class="i">+            put(&quot;enabled&quot;, if (theme.enabled) 1 else 0)
</a><a href="#h6-0-63" id="h6-0-63" class="i">+            put(&quot;name&quot;, theme.name)
</a><a href="#h6-0-64" id="h6-0-64" class="i">+            put(&quot;description&quot;, theme.description)
</a><a href="#h6-0-65" id="h6-0-65" class="i">+            put(&quot;version&quot;, theme.version)
</a><a href="#h6-0-66" id="h6-0-66" class="i">+            put(&quot;author&quot;, theme.author)
</a><a href="#h6-0-67" id="h6-0-67" class="i">+            put(&quot;updateUrl&quot;, theme.updateUrl)
</a><a href="#h6-0-68" id="h6-0-68" class="i">+        }
</a><a href="#h6-0-69" id="h6-0-69" class="i">+        if (themeId != null) {
</a><a href="#h6-0-70" id="h6-0-70" class="i">+            database.update(&quot;themes&quot;, contentValues, &quot;id = ?&quot;, arrayOf(themeId.toString()))
</a><a href="#h6-0-71" id="h6-0-71" class="i">+            return@runBlocking themeId
</a><a href="#h6-0-72" id="h6-0-72" class="i">+        }
</a><a href="#h6-0-73" id="h6-0-73" class="i">+        database.insert(&quot;themes&quot;, null, contentValues).toInt()
</a><a href="#h6-0-74" id="h6-0-74" class="i">+    }
</a><a href="#h6-0-75" id="h6-0-75" class="i">+}
</a><a href="#h6-0-76" id="h6-0-76" class="i">+
</a><a href="#h6-0-77" id="h6-0-77" class="i">+fun AppDatabase.setThemeState(id: Int, enabled: Boolean) {
</a><a href="#h6-0-78" id="h6-0-78" class="i">+    runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-79" id="h6-0-79" class="i">+        database.update(&quot;themes&quot;, ContentValues().apply {
</a><a href="#h6-0-80" id="h6-0-80" class="i">+            put(&quot;enabled&quot;, if (enabled) 1 else 0)
</a><a href="#h6-0-81" id="h6-0-81" class="i">+        }, &quot;id = ?&quot;, arrayOf(id.toString()))
</a><a href="#h6-0-82" id="h6-0-82" class="i">+    }
</a><a href="#h6-0-83" id="h6-0-83" class="i">+}
</a><a href="#h6-0-84" id="h6-0-84" class="i">+
</a><a href="#h6-0-85" id="h6-0-85" class="i">+fun AppDatabase.deleteTheme(id: Int) {
</a><a href="#h6-0-86" id="h6-0-86" class="i">+    runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-87" id="h6-0-87" class="i">+        database.delete(&quot;themes&quot;, &quot;id = ?&quot;, arrayOf(id.toString()))
</a><a href="#h6-0-88" id="h6-0-88" class="i">+    }
</a><a href="#h6-0-89" id="h6-0-89" class="i">+}
</a><a href="#h6-0-90" id="h6-0-90" class="i">+
</a><a href="#h6-0-91" id="h6-0-91" class="i">+
</a><a href="#h6-0-92" id="h6-0-92" class="i">+fun AppDatabase.getThemeContent(id: Int): DatabaseThemeContent? {
</a><a href="#h6-0-93" id="h6-0-93" class="i">+    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-94" id="h6-0-94" class="i">+        database.rawQuery(&quot;SELECT content FROM themes WHERE id = ?&quot;, arrayOf(id.toString())).use { cursor -&gt;
</a><a href="#h6-0-95" id="h6-0-95" class="i">+            if (!cursor.moveToFirst()) return@use null
</a><a href="#h6-0-96" id="h6-0-96" class="i">+            runCatching {
</a><a href="#h6-0-97" id="h6-0-97" class="i">+                context.gson.fromJson(cursor.getStringOrNull(&quot;content&quot;), DatabaseThemeContent::class.java)
</a><a href="#h6-0-98" id="h6-0-98" class="i">+            }.getOrNull()
</a><a href="#h6-0-99" id="h6-0-99" class="i">+        }
</a><a href="#h6-0-100" id="h6-0-100" class="i">+    }
</a><a href="#h6-0-101" id="h6-0-101" class="i">+}
</a><a href="#h6-0-102" id="h6-0-102" class="i">+
</a><a href="#h6-0-103" id="h6-0-103" class="i">+
</a><a href="#h6-0-104" id="h6-0-104" class="i">+fun AppDatabase.getEnabledThemesContent(): List&lt;DatabaseThemeContent&gt; {
</a><a href="#h6-0-105" id="h6-0-105" class="i">+    return runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-106" id="h6-0-106" class="i">+        database.rawQuery(&quot;SELECT content FROM themes WHERE enabled = 1&quot;, null).use { cursor -&gt;
</a><a href="#h6-0-107" id="h6-0-107" class="i">+            val themes = mutableListOf&lt;DatabaseThemeContent&gt;()
</a><a href="#h6-0-108" id="h6-0-108" class="i">+            while (cursor.moveToNext()) {
</a><a href="#h6-0-109" id="h6-0-109" class="i">+                runCatching {
</a><a href="#h6-0-110" id="h6-0-110" class="i">+                    themes.add(context.gson.fromJson(cursor.getStringOrNull(&quot;content&quot;), DatabaseThemeContent::class.java))
</a><a href="#h6-0-111" id="h6-0-111" class="i">+                }
</a><a href="#h6-0-112" id="h6-0-112" class="i">+            }
</a><a href="#h6-0-113" id="h6-0-113" class="i">+            themes
</a><a href="#h6-0-114" id="h6-0-114" class="i">+        }
</a><a href="#h6-0-115" id="h6-0-115" class="i">+    }
</a><a href="#h6-0-116" id="h6-0-116" class="i">+}
</a><a href="#h6-0-117" id="h6-0-117" class="i">+
</a><a href="#h6-0-118" id="h6-0-118" class="i">+
</a><a href="#h6-0-119" id="h6-0-119" class="i">+fun AppDatabase.setThemeContent(id: Int, content: DatabaseThemeContent) {
</a><a href="#h6-0-120" id="h6-0-120" class="i">+    runBlocking(executor.asCoroutineDispatcher()) {
</a><a href="#h6-0-121" id="h6-0-121" class="i">+        database.update(&quot;themes&quot;, ContentValues().apply {
</a><a href="#h6-0-122" id="h6-0-122" class="i">+            put(&quot;content&quot;, context.gson.toJson(content))
</a><a href="#h6-0-123" id="h6-0-123" class="i">+        }, &quot;id = ?&quot;, arrayOf(id.toString()))
</a><a href="#h6-0-124" id="h6-0-124" class="i">+    }
</a><a href="#h6-0-125" id="h6-0-125" class="i">+}
</a><b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -24,6 +24,9 @@ import me.rhunk.snapenhance.ui.manager.pages.social.LoggedStories
</a> import me.rhunk.snapenhance.ui.manager.pages.social.ManageScope
 import me.rhunk.snapenhance.ui.manager.pages.social.MessagingPreview
 import me.rhunk.snapenhance.ui.manager.pages.social.SocialRootSection
<a href="#h7-0-3" id="h7-0-3" class="i">+import me.rhunk.snapenhance.ui.manager.pages.theming.EditThemeSection
</a><a href="#h7-0-4" id="h7-0-4" class="i">+import me.rhunk.snapenhance.ui.manager.pages.ManageReposSection
</a><a href="#h7-0-5" id="h7-0-5" class="i">+import me.rhunk.snapenhance.ui.manager.pages.theming.ThemingRoot
</a> import me.rhunk.snapenhance.ui.manager.pages.tracker.EditRule
 import me.rhunk.snapenhance.ui.manager.pages.tracker.FriendTrackerManagerRoot
 
<a href="#h7-1" id="h7-1" class="h">@@ -58,6 +61,10 @@ class Routes(
</a>     val editRule = route(RouteInfo(&quot;edit_rule/?rule_id={rule_id}&quot;), EditRule())
 
     val fileImports = route(RouteInfo(&quot;file_imports&quot;), FileImportsRoot()).parent(home)
<a href="#h7-1-3" id="h7-1-3" class="i">+    val theming = route(RouteInfo(&quot;theming&quot;), ThemingRoot()).parent(home)
</a><a href="#h7-1-4" id="h7-1-4" class="i">+    val editTheme = route(RouteInfo(&quot;edit_theme/?theme_id={theme_id}&quot;), EditThemeSection())
</a><a href="#h7-1-5" id="h7-1-5" class="i">+    val manageRepos = route(RouteInfo(&quot;manage_repos&quot;), ManageReposSection())
</a><a href="#h7-1-6" id="h7-1-6" class="i">+
</a>     val social = route(RouteInfo(&quot;social&quot;, icon = Icons.Default.Group, primary = true), SocialRootSection())
     val manageScope = route(RouteInfo(&quot;manage_scope/?scope={scope}&amp;id={id}&quot;), ManageScope()).parent(social)
     val messagingPreview = route(RouteInfo(&quot;messaging_preview/?scope={scope}&amp;id={id}&quot;), MessagingPreview()).parent(social)
<b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/LoggerHistoryRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/LoggerHistoryRoot.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/LoggerHistoryRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/LoggerHistoryRoot.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -38,6 +38,7 @@ import me.rhunk.snapenhance.common.data.download.DownloadRequest
</a> import me.rhunk.snapenhance.common.data.download.MediaDownloadSource
 import me.rhunk.snapenhance.common.data.download.createNewFilePath
 import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
<a href="#h8-0-3" id="h8-0-3" class="i">+import me.rhunk.snapenhance.common.ui.transparentTextFieldColors
</a> import me.rhunk.snapenhance.common.util.ktx.copyToClipboard
 import me.rhunk.snapenhance.common.util.ktx.longHashCode
 import me.rhunk.snapenhance.common.util.protobuf.ProtoReader
<a href="#h8-1" id="h8-1" class="h">@@ -373,14 +374,7 @@ class LoggerHistoryRoot : Routes.Route() {
</a>                     .padding(end = 10.dp)
                     .height(70.dp),
                 singleLine = true,
<a href="#h8-1-3" id="h8-1-3" class="d">-                colors = TextFieldDefaults.colors(
</a><a href="#h8-1-4" id="h8-1-4" class="d">-                    unfocusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h8-1-5" id="h8-1-5" class="d">-                    focusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h8-1-6" id="h8-1-6" class="d">-                    focusedIndicatorColor = Color.Transparent,
</a><a href="#h8-1-7" id="h8-1-7" class="d">-                    unfocusedIndicatorColor = Color.Transparent,
</a><a href="#h8-1-8" id="h8-1-8" class="d">-                    disabledIndicatorColor = Color.Transparent,
</a><a href="#h8-1-9" id="h8-1-9" class="d">-                    cursorColor = MaterialTheme.colorScheme.primary
</a><a href="#h8-1-10" id="h8-1-10" class="d">-                )
</a><a href="#h8-1-11" id="h8-1-11" class="i">+                colors = transparentTextFieldColors()
</a>             )
 
             LaunchedEffect(Unit) {
<b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/ManageReposSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/ManageReposSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/ManageReposSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/ManageReposSection.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,187 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages
</a><a href="#h9-0-1" id="h9-0-1" class="i">+
</a><a href="#h9-0-2" id="h9-0-2" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h9-0-3" id="h9-0-3" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h9-0-4" id="h9-0-4" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h9-0-5" id="h9-0-5" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h9-0-6" id="h9-0-6" class="i">+import androidx.compose.material.icons.filled.Public
</a><a href="#h9-0-7" id="h9-0-7" class="i">+import androidx.compose.material3.*
</a><a href="#h9-0-8" id="h9-0-8" class="i">+import androidx.compose.runtime.*
</a><a href="#h9-0-9" id="h9-0-9" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h9-0-10" id="h9-0-10" class="i">+import androidx.compose.ui.focus.FocusRequester
</a><a href="#h9-0-11" id="h9-0-11" class="i">+import androidx.compose.ui.focus.focusRequester
</a><a href="#h9-0-12" id="h9-0-12" class="i">+import androidx.compose.ui.layout.onGloballyPositioned
</a><a href="#h9-0-13" id="h9-0-13" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h9-0-14" id="h9-0-14" class="i">+import androidx.compose.ui.text.style.TextAlign
</a><a href="#h9-0-15" id="h9-0-15" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h9-0-16" id="h9-0-16" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h9-0-17" id="h9-0-17" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h9-0-18" id="h9-0-18" class="i">+import androidx.core.net.toUri
</a><a href="#h9-0-19" id="h9-0-19" class="i">+import androidx.navigation.NavBackStackEntry
</a><a href="#h9-0-20" id="h9-0-20" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h9-0-21" id="h9-0-21" class="i">+import kotlinx.coroutines.launch
</a><a href="#h9-0-22" id="h9-0-22" class="i">+import me.rhunk.snapenhance.common.data.RepositoryIndex
</a><a href="#h9-0-23" id="h9-0-23" class="i">+import me.rhunk.snapenhance.common.ui.AsyncUpdateDispatcher
</a><a href="#h9-0-24" id="h9-0-24" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h9-0-25" id="h9-0-25" class="i">+import me.rhunk.snapenhance.common.util.ktx.getUrlFromClipboard
</a><a href="#h9-0-26" id="h9-0-26" class="i">+import me.rhunk.snapenhance.storage.addRepo
</a><a href="#h9-0-27" id="h9-0-27" class="i">+import me.rhunk.snapenhance.storage.getRepositories
</a><a href="#h9-0-28" id="h9-0-28" class="i">+import me.rhunk.snapenhance.storage.removeRepo
</a><a href="#h9-0-29" id="h9-0-29" class="i">+import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h9-0-30" id="h9-0-30" class="i">+import okhttp3.OkHttpClient
</a><a href="#h9-0-31" id="h9-0-31" class="i">+
</a><a href="#h9-0-32" id="h9-0-32" class="i">+class ManageReposSection: Routes.Route() {
</a><a href="#h9-0-33" id="h9-0-33" class="i">+    private val updateDispatcher = AsyncUpdateDispatcher()
</a><a href="#h9-0-34" id="h9-0-34" class="i">+    private val okHttpClient by lazy { OkHttpClient() }
</a><a href="#h9-0-35" id="h9-0-35" class="i">+
</a><a href="#h9-0-36" id="h9-0-36" class="i">+    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h9-0-37" id="h9-0-37" class="i">+        var showAddDialog by remember { mutableStateOf(false) }
</a><a href="#h9-0-38" id="h9-0-38" class="i">+        ExtendedFloatingActionButton(onClick = {
</a><a href="#h9-0-39" id="h9-0-39" class="i">+            showAddDialog = true
</a><a href="#h9-0-40" id="h9-0-40" class="i">+        }) {
</a><a href="#h9-0-41" id="h9-0-41" class="i">+            Text(&quot;Add Repository&quot;)
</a><a href="#h9-0-42" id="h9-0-42" class="i">+        }
</a><a href="#h9-0-43" id="h9-0-43" class="i">+
</a><a href="#h9-0-44" id="h9-0-44" class="i">+        if (showAddDialog) {
</a><a href="#h9-0-45" id="h9-0-45" class="i">+            val coroutineScope = rememberCoroutineScope { Dispatchers.IO }
</a><a href="#h9-0-46" id="h9-0-46" class="i">+
</a><a href="#h9-0-47" id="h9-0-47" class="i">+            suspend fun addRepo(url: String) {
</a><a href="#h9-0-48" id="h9-0-48" class="i">+                var modifiedUrl = url;
</a><a href="#h9-0-49" id="h9-0-49" class="i">+
</a><a href="#h9-0-50" id="h9-0-50" class="i">+                if (url.startsWith(&quot;https://github.com/&quot;)) {
</a><a href="#h9-0-51" id="h9-0-51" class="i">+                    val splitUrl = modifiedUrl.removePrefix(&quot;https://github.com/&quot;).split(&quot;/&quot;)
</a><a href="#h9-0-52" id="h9-0-52" class="i">+                    val repoName = splitUrl[0] + &quot;/&quot; + splitUrl[1]
</a><a href="#h9-0-53" id="h9-0-53" class="i">+                    // fetch default branch
</a><a href="#h9-0-54" id="h9-0-54" class="i">+                    okHttpClient.newCall(
</a><a href="#h9-0-55" id="h9-0-55" class="i">+                        okhttp3.Request.Builder().url(&quot;https://api.github.com/repos/$repoName&quot;).build()
</a><a href="#h9-0-56" id="h9-0-56" class="i">+                    ).execute().use { response -&gt;
</a><a href="#h9-0-57" id="h9-0-57" class="i">+                        if (!response.isSuccessful) {
</a><a href="#h9-0-58" id="h9-0-58" class="i">+                            throw Exception(&quot;Failed to fetch default branch: ${response.code}&quot;)
</a><a href="#h9-0-59" id="h9-0-59" class="i">+                        }
</a><a href="#h9-0-60" id="h9-0-60" class="i">+                        val json = response.body.string()
</a><a href="#h9-0-61" id="h9-0-61" class="i">+                        val defaultBranch = context.gson.fromJson(json, Map::class.java)[&quot;default_branch&quot;] as String
</a><a href="#h9-0-62" id="h9-0-62" class="i">+                        context.log.info(&quot;Default branch for $repoName is $defaultBranch&quot;)
</a><a href="#h9-0-63" id="h9-0-63" class="i">+                        modifiedUrl = &quot;https://raw.githubusercontent.com/$repoName/$defaultBranch/&quot;
</a><a href="#h9-0-64" id="h9-0-64" class="i">+                    }
</a><a href="#h9-0-65" id="h9-0-65" class="i">+                }
</a><a href="#h9-0-66" id="h9-0-66" class="i">+
</a><a href="#h9-0-67" id="h9-0-67" class="i">+                val indexUri = modifiedUrl.toUri().buildUpon().appendPath(&quot;index.json&quot;).build()
</a><a href="#h9-0-68" id="h9-0-68" class="i">+                okHttpClient.newCall(
</a><a href="#h9-0-69" id="h9-0-69" class="i">+                    okhttp3.Request.Builder().url(indexUri.toString()).build()
</a><a href="#h9-0-70" id="h9-0-70" class="i">+                ).execute().use { response -&gt;
</a><a href="#h9-0-71" id="h9-0-71" class="i">+                    if (!response.isSuccessful) {
</a><a href="#h9-0-72" id="h9-0-72" class="i">+                        throw Exception(&quot;Failed to fetch index from $indexUri: ${response.code}&quot;)
</a><a href="#h9-0-73" id="h9-0-73" class="i">+                    }
</a><a href="#h9-0-74" id="h9-0-74" class="i">+                    runCatching {
</a><a href="#h9-0-75" id="h9-0-75" class="i">+                        val repoIndex = context.gson.fromJson(response.body.charStream(), RepositoryIndex::class.java).also {
</a><a href="#h9-0-76" id="h9-0-76" class="i">+                            context.log.info(&quot;repository index: $it&quot;)
</a><a href="#h9-0-77" id="h9-0-77" class="i">+                        }
</a><a href="#h9-0-78" id="h9-0-78" class="i">+
</a><a href="#h9-0-79" id="h9-0-79" class="i">+                        context.database.addRepo(modifiedUrl)
</a><a href="#h9-0-80" id="h9-0-80" class="i">+                        context.shortToast(&quot;Repository added successfully! $repoIndex&quot;)
</a><a href="#h9-0-81" id="h9-0-81" class="i">+                        showAddDialog = false
</a><a href="#h9-0-82" id="h9-0-82" class="i">+                        updateDispatcher.dispatch()
</a><a href="#h9-0-83" id="h9-0-83" class="i">+                    }.onFailure {
</a><a href="#h9-0-84" id="h9-0-84" class="i">+                        throw Exception(&quot;Failed to parse index from $indexUri&quot;)
</a><a href="#h9-0-85" id="h9-0-85" class="i">+                    }
</a><a href="#h9-0-86" id="h9-0-86" class="i">+                }
</a><a href="#h9-0-87" id="h9-0-87" class="i">+            }
</a><a href="#h9-0-88" id="h9-0-88" class="i">+
</a><a href="#h9-0-89" id="h9-0-89" class="i">+            var url by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h9-0-90" id="h9-0-90" class="i">+            var loading by remember { mutableStateOf(false) }
</a><a href="#h9-0-91" id="h9-0-91" class="i">+
</a><a href="#h9-0-92" id="h9-0-92" class="i">+            AlertDialog(onDismissRequest = {
</a><a href="#h9-0-93" id="h9-0-93" class="i">+                showAddDialog = false
</a><a href="#h9-0-94" id="h9-0-94" class="i">+            }, title = {
</a><a href="#h9-0-95" id="h9-0-95" class="i">+                Text(&quot;Add Repository URL&quot;)
</a><a href="#h9-0-96" id="h9-0-96" class="i">+            }, text = {
</a><a href="#h9-0-97" id="h9-0-97" class="i">+                val focusRequester = remember { FocusRequester() }
</a><a href="#h9-0-98" id="h9-0-98" class="i">+                OutlinedTextField(
</a><a href="#h9-0-99" id="h9-0-99" class="i">+                    modifier = Modifier
</a><a href="#h9-0-100" id="h9-0-100" class="i">+                        .fillMaxWidth()
</a><a href="#h9-0-101" id="h9-0-101" class="i">+                        .focusRequester(focusRequester)
</a><a href="#h9-0-102" id="h9-0-102" class="i">+                        .onGloballyPositioned {
</a><a href="#h9-0-103" id="h9-0-103" class="i">+                            focusRequester.requestFocus()
</a><a href="#h9-0-104" id="h9-0-104" class="i">+                        },
</a><a href="#h9-0-105" id="h9-0-105" class="i">+                    value = url,
</a><a href="#h9-0-106" id="h9-0-106" class="i">+                    onValueChange = {
</a><a href="#h9-0-107" id="h9-0-107" class="i">+                        url = it
</a><a href="#h9-0-108" id="h9-0-108" class="i">+                    }, label = {
</a><a href="#h9-0-109" id="h9-0-109" class="i">+                        Text(&quot;Repository URL&quot;)
</a><a href="#h9-0-110" id="h9-0-110" class="i">+                    }
</a><a href="#h9-0-111" id="h9-0-111" class="i">+                )
</a><a href="#h9-0-112" id="h9-0-112" class="i">+                LaunchedEffect(Unit) {
</a><a href="#h9-0-113" id="h9-0-113" class="i">+                    context.androidContext.getUrlFromClipboard()?.let {
</a><a href="#h9-0-114" id="h9-0-114" class="i">+                        url = it
</a><a href="#h9-0-115" id="h9-0-115" class="i">+                    }
</a><a href="#h9-0-116" id="h9-0-116" class="i">+                }
</a><a href="#h9-0-117" id="h9-0-117" class="i">+            }, confirmButton = {
</a><a href="#h9-0-118" id="h9-0-118" class="i">+                Button(
</a><a href="#h9-0-119" id="h9-0-119" class="i">+                    enabled = !loading,
</a><a href="#h9-0-120" id="h9-0-120" class="i">+                    onClick = {
</a><a href="#h9-0-121" id="h9-0-121" class="i">+                        loading = true;
</a><a href="#h9-0-122" id="h9-0-122" class="i">+                        coroutineScope.launch {
</a><a href="#h9-0-123" id="h9-0-123" class="i">+                            runCatching {
</a><a href="#h9-0-124" id="h9-0-124" class="i">+                                addRepo(url)
</a><a href="#h9-0-125" id="h9-0-125" class="i">+                            }.onFailure {
</a><a href="#h9-0-126" id="h9-0-126" class="i">+                                context.log.error(&quot;Failed to add repository&quot;, it)
</a><a href="#h9-0-127" id="h9-0-127" class="i">+                                context.shortToast(&quot;Failed to add repository: ${it.message}&quot;)
</a><a href="#h9-0-128" id="h9-0-128" class="i">+                            }
</a><a href="#h9-0-129" id="h9-0-129" class="i">+                            loading = false
</a><a href="#h9-0-130" id="h9-0-130" class="i">+                        }
</a><a href="#h9-0-131" id="h9-0-131" class="i">+                    }
</a><a href="#h9-0-132" id="h9-0-132" class="i">+                ) {
</a><a href="#h9-0-133" id="h9-0-133" class="i">+                    if (loading) {
</a><a href="#h9-0-134" id="h9-0-134" class="i">+                        CircularProgressIndicator(modifier = Modifier.size(24.dp))
</a><a href="#h9-0-135" id="h9-0-135" class="i">+                    } else {
</a><a href="#h9-0-136" id="h9-0-136" class="i">+                        Text(&quot;Add&quot;)
</a><a href="#h9-0-137" id="h9-0-137" class="i">+                    }
</a><a href="#h9-0-138" id="h9-0-138" class="i">+                }
</a><a href="#h9-0-139" id="h9-0-139" class="i">+            })
</a><a href="#h9-0-140" id="h9-0-140" class="i">+        }
</a><a href="#h9-0-141" id="h9-0-141" class="i">+    }
</a><a href="#h9-0-142" id="h9-0-142" class="i">+
</a><a href="#h9-0-143" id="h9-0-143" class="i">+    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h9-0-144" id="h9-0-144" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h9-0-145" id="h9-0-145" class="i">+        val repositories = rememberAsyncMutableStateList(defaultValue = listOf(), updateDispatcher = updateDispatcher) {
</a><a href="#h9-0-146" id="h9-0-146" class="i">+            context.database.getRepositories()
</a><a href="#h9-0-147" id="h9-0-147" class="i">+        }
</a><a href="#h9-0-148" id="h9-0-148" class="i">+
</a><a href="#h9-0-149" id="h9-0-149" class="i">+        LazyColumn(
</a><a href="#h9-0-150" id="h9-0-150" class="i">+            modifier = Modifier.fillMaxSize(),
</a><a href="#h9-0-151" id="h9-0-151" class="i">+            contentPadding = PaddingValues(8.dp),
</a><a href="#h9-0-152" id="h9-0-152" class="i">+        ) {
</a><a href="#h9-0-153" id="h9-0-153" class="i">+            item {
</a><a href="#h9-0-154" id="h9-0-154" class="i">+                if (repositories.isEmpty()) {
</a><a href="#h9-0-155" id="h9-0-155" class="i">+                    Text(&quot;No repositories added&quot;, modifier = Modifier
</a><a href="#h9-0-156" id="h9-0-156" class="i">+                        .padding(16.dp)
</a><a href="#h9-0-157" id="h9-0-157" class="i">+                        .fillMaxWidth(), fontSize = 15.sp, fontWeight = FontWeight.Light, textAlign = TextAlign.Center)
</a><a href="#h9-0-158" id="h9-0-158" class="i">+                }
</a><a href="#h9-0-159" id="h9-0-159" class="i">+            }
</a><a href="#h9-0-160" id="h9-0-160" class="i">+            items(repositories) { url -&gt;
</a><a href="#h9-0-161" id="h9-0-161" class="i">+                ElevatedCard(onClick = {}) {
</a><a href="#h9-0-162" id="h9-0-162" class="i">+                    Row(
</a><a href="#h9-0-163" id="h9-0-163" class="i">+                        modifier = Modifier
</a><a href="#h9-0-164" id="h9-0-164" class="i">+                            .fillMaxWidth()
</a><a href="#h9-0-165" id="h9-0-165" class="i">+                            .padding(8.dp),
</a><a href="#h9-0-166" id="h9-0-166" class="i">+                        horizontalArrangement = Arrangement.spacedBy(4.dp),
</a><a href="#h9-0-167" id="h9-0-167" class="i">+                        verticalAlignment = androidx.compose.ui.Alignment.CenterVertically
</a><a href="#h9-0-168" id="h9-0-168" class="i">+                    ) {
</a><a href="#h9-0-169" id="h9-0-169" class="i">+                        Icon(Icons.Default.Public, contentDescription = null)
</a><a href="#h9-0-170" id="h9-0-170" class="i">+                        Text(text = url, modifier = Modifier.weight(1f), overflow = TextOverflow.Ellipsis, maxLines = 1)
</a><a href="#h9-0-171" id="h9-0-171" class="i">+                        Button(
</a><a href="#h9-0-172" id="h9-0-172" class="i">+                            onClick = {
</a><a href="#h9-0-173" id="h9-0-173" class="i">+                                context.database.removeRepo(url)
</a><a href="#h9-0-174" id="h9-0-174" class="i">+                                coroutineScope.launch {
</a><a href="#h9-0-175" id="h9-0-175" class="i">+                                    updateDispatcher.dispatch()
</a><a href="#h9-0-176" id="h9-0-176" class="i">+                                }
</a><a href="#h9-0-177" id="h9-0-177" class="i">+                            }
</a><a href="#h9-0-178" id="h9-0-178" class="i">+                        ) {
</a><a href="#h9-0-179" id="h9-0-179" class="i">+                            Text(&quot;Remove&quot;)
</a><a href="#h9-0-180" id="h9-0-180" class="i">+                        }
</a><a href="#h9-0-181" id="h9-0-181" class="i">+                    }
</a><a href="#h9-0-182" id="h9-0-182" class="i">+                }
</a><a href="#h9-0-183" id="h9-0-183" class="i">+            }
</a><a href="#h9-0-184" id="h9-0-184" class="i">+        }
</a><a href="#h9-0-185" id="h9-0-185" class="i">+    }
</a><a href="#h9-0-186" id="h9-0-186" class="i">+}</a><a href="#h9-0-187" id="h9-0-187" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -40,6 +40,7 @@ import kotlinx.coroutines.delay
</a> import kotlinx.coroutines.launch
 import me.rhunk.snapenhance.common.config.*
 import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
<a href="#h10-0-3" id="h10-0-3" class="i">+import me.rhunk.snapenhance.common.ui.transparentTextFieldColors
</a> import me.rhunk.snapenhance.ui.manager.MainActivity
 import me.rhunk.snapenhance.ui.manager.Routes
 import me.rhunk.snapenhance.ui.util.*
<a href="#h10-1" id="h10-1" class="h">@@ -177,11 +178,15 @@ class FeaturesRootSection : Routes.Route() {
</a>                         .fillMaxWidth(),
                 ) {
                     LazyColumn(
<a href="#h10-1-3" id="h10-1-3" class="d">-                        modifier = Modifier.fillMaxWidth().padding(4.dp),
</a><a href="#h10-1-4" id="h10-1-4" class="i">+                        modifier = Modifier
</a><a href="#h10-1-5" id="h10-1-5" class="i">+                            .fillMaxWidth()
</a><a href="#h10-1-6" id="h10-1-6" class="i">+                            .padding(4.dp),
</a>                     ) {
                         item {
                             Column(
<a href="#h10-1-10" id="h10-1-10" class="d">-                                modifier = Modifier.fillMaxWidth().padding(16.dp),
</a><a href="#h10-1-11" id="h10-1-11" class="i">+                                modifier = Modifier
</a><a href="#h10-1-12" id="h10-1-12" class="i">+                                    .fillMaxWidth()
</a><a href="#h10-1-13" id="h10-1-13" class="i">+                                    .padding(16.dp),
</a>                                 horizontalAlignment = Alignment.CenterHorizontally
                             ) {
                                 Text(
<a href="#h10-2" id="h10-2" class="h">@@ -200,10 +205,13 @@ class FeaturesRootSection : Routes.Route() {
</a>                         }
                         items(files, key = { it.name }) { file -&gt;
                             Row(
<a href="#h10-2-3" id="h10-2-3" class="d">-                                modifier = Modifier.clickable {
</a><a href="#h10-2-4" id="h10-2-4" class="d">-                                    selectedFile = if (selectedFile == file.name) null else file.name
</a><a href="#h10-2-5" id="h10-2-5" class="d">-                                    propertyValue.setAny(selectedFile)
</a><a href="#h10-2-6" id="h10-2-6" class="d">-                                }.padding(5.dp),
</a><a href="#h10-2-7" id="h10-2-7" class="i">+                                modifier = Modifier
</a><a href="#h10-2-8" id="h10-2-8" class="i">+                                    .clickable {
</a><a href="#h10-2-9" id="h10-2-9" class="i">+                                        selectedFile =
</a><a href="#h10-2-10" id="h10-2-10" class="i">+                                            if (selectedFile == file.name) null else file.name
</a><a href="#h10-2-11" id="h10-2-11" class="i">+                                        propertyValue.setAny(selectedFile)
</a><a href="#h10-2-12" id="h10-2-12" class="i">+                                    }
</a><a href="#h10-2-13" id="h10-2-13" class="i">+                                    .padding(5.dp),
</a>                                 verticalAlignment = Alignment.CenterVertically
                             ) {
                                 Icon(Icons.Filled.AttachFile, contentDescription = null, modifier = Modifier.padding(5.dp))
<a href="#h10-3" id="h10-3" class="h">@@ -321,23 +329,13 @@ class FeaturesRootSection : Routes.Route() {
</a> 
             DataProcessors.Type.INT_COLOR -&gt; {
                 dialogComposable = {
<a href="#h10-3-3" id="h10-3-3" class="d">-                    alertDialogs.ColorPickerDialog(property) {
</a><a href="#h10-3-4" id="h10-3-4" class="i">+                    alertDialogs.ColorPickerPropertyDialog(property) {
</a>                         showDialog = false
                     }
                 }
 
                 registerDialogOnClickCallback().let { { it.invoke(true) } }.also {
<a href="#h10-3-10" id="h10-3-10" class="d">-                    val selectedColor = (propertyValue.getNullable() as? Int)?.let { Color(it) }
</a><a href="#h10-3-11" id="h10-3-11" class="d">-                    AlphaTile(
</a><a href="#h10-3-12" id="h10-3-12" class="d">-                        modifier = Modifier
</a><a href="#h10-3-13" id="h10-3-13" class="d">-                            .size(30.dp)
</a><a href="#h10-3-14" id="h10-3-14" class="d">-                            .border(2.dp, Color.White, shape = RoundedCornerShape(15.dp))
</a><a href="#h10-3-15" id="h10-3-15" class="d">-                            .clip(RoundedCornerShape(15.dp)),
</a><a href="#h10-3-16" id="h10-3-16" class="d">-                        selectedColor = selectedColor ?: Color.Transparent,
</a><a href="#h10-3-17" id="h10-3-17" class="d">-                        tileEvenColor = selectedColor?.let { Color(0xFFCBCBCB) } ?: Color.Transparent,
</a><a href="#h10-3-18" id="h10-3-18" class="d">-                        tileOddColor = selectedColor?.let { Color.White } ?: Color.Transparent,
</a><a href="#h10-3-19" id="h10-3-19" class="d">-                        tileSize = 8.dp,
</a><a href="#h10-3-20" id="h10-3-20" class="d">-                    )
</a><a href="#h10-3-21" id="h10-3-21" class="i">+                    CircularAlphaTile(selectedColor = (propertyValue.getNullable() as? Int)?.let { Color(it) })
</a>                 }
             }
 
<a href="#h10-4" id="h10-4" class="h">@@ -489,14 +487,7 @@ class FeaturesRootSection : Routes.Route() {
</a>                     .padding(end = 10.dp)
                     .height(70.dp),
                 singleLine = true,
<a href="#h10-4-3" id="h10-4-3" class="d">-                colors = TextFieldDefaults.colors(
</a><a href="#h10-4-4" id="h10-4-4" class="d">-                    unfocusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h10-4-5" id="h10-4-5" class="d">-                    focusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h10-4-6" id="h10-4-6" class="d">-                    focusedIndicatorColor = Color.Transparent,
</a><a href="#h10-4-7" id="h10-4-7" class="d">-                    unfocusedIndicatorColor = Color.Transparent,
</a><a href="#h10-4-8" id="h10-4-8" class="d">-                    disabledIndicatorColor = Color.Transparent,
</a><a href="#h10-4-9" id="h10-4-9" class="d">-                    cursorColor = MaterialTheme.colorScheme.primary
</a><a href="#h10-4-10" id="h10-4-10" class="d">-                )
</a><a href="#h10-4-11" id="h10-4-11" class="i">+                colors = transparentTextFieldColors()
</a>             )
         }
     }
<b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeSettings.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -154,6 +154,9 @@ class HomeSettings : Routes.Route() {
</a>             RowAction(key = &quot;change_language&quot;) {
                 context.checkForRequirements(Requirements.LANGUAGE)
             }
<a href="#h11-0-3" id="h11-0-3" class="i">+            RowAction(key = &quot;security_features&quot;) {
</a><a href="#h11-0-4" id="h11-0-4" class="i">+                context.checkForRequirements(Requirements.SIF)
</a><a href="#h11-0-5" id="h11-0-5" class="i">+            }
</a>             RowTitle(title = translation[&quot;message_logger_title&quot;])
             ShiftedRow {
                 Column(
<a href="#h11-1" id="h11-1" class="h">@@ -284,7 +287,7 @@ class HomeSettings : Routes.Route() {
</a>                 ) {
                     PreferenceToggle(context.sharedPreferences, key = &quot;disable_feature_loading&quot;, text = &quot;Disable Feature Loading&quot;)
                     PreferenceToggle(context.sharedPreferences, key = &quot;disable_mapper&quot;, text = &quot;Disable Auto Mapper&quot;)
<a href="#h11-1-3" id="h11-1-3" class="d">-                    PreferenceToggle(context.sharedPreferences, key = &quot;force_native_load&quot;, text = &quot;Force Native Load&quot;)
</a><a href="#h11-1-4" id="h11-1-4" class="i">+                    PreferenceToggle(context.sharedPreferences, key = &quot;disable_sif&quot;, text = &quot;Disable Security Features&quot;)
</a>                 }
             }
             Spacer(modifier = Modifier.height(50.dp))
<b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -22,11 +22,7 @@ import androidx.compose.ui.unit.dp
</a> import androidx.compose.ui.unit.sp
 import androidx.core.net.toUri
 import androidx.navigation.NavBackStackEntry
<a href="#h12-0-3" id="h12-0-3" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h12-0-4" id="h12-0-4" class="d">-import kotlinx.coroutines.asCoroutineDispatcher
</a><a href="#h12-0-5" id="h12-0-5" class="d">-import kotlinx.coroutines.delay
</a><a href="#h12-0-6" id="h12-0-6" class="d">-import kotlinx.coroutines.launch
</a><a href="#h12-0-7" id="h12-0-7" class="d">-import kotlinx.coroutines.withContext
</a><a href="#h12-0-8" id="h12-0-8" class="i">+import kotlinx.coroutines.*
</a> import me.rhunk.snapenhance.common.scripting.type.ModuleInfo
 import me.rhunk.snapenhance.common.scripting.ui.EnumScriptInterface
 import me.rhunk.snapenhance.common.scripting.ui.InterfaceManager
<a href="#h12-1" id="h12-1" class="h">@@ -34,6 +30,7 @@ import me.rhunk.snapenhance.common.scripting.ui.ScriptInterface
</a> import me.rhunk.snapenhance.common.ui.AsyncUpdateDispatcher
 import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
 import me.rhunk.snapenhance.common.ui.rememberAsyncUpdateDispatcher
<a href="#h12-1-3" id="h12-1-3" class="i">+import me.rhunk.snapenhance.common.util.ktx.getUrlFromClipboard
</a> import me.rhunk.snapenhance.storage.isScriptEnabled
 import me.rhunk.snapenhance.storage.setScriptEnabled
 import me.rhunk.snapenhance.ui.manager.Routes
<a href="#h12-2" id="h12-2" class="h">@@ -101,6 +98,11 @@ class ScriptingRootSection : Routes.Route() {
</a>                                 focusRequester.requestFocus()
                             }
                     )
<a href="#h12-2-3" id="h12-2-3" class="i">+                    LaunchedEffect(Unit) {
</a><a href="#h12-2-4" id="h12-2-4" class="i">+                        context.androidContext.getUrlFromClipboard()?.let {
</a><a href="#h12-2-5" id="h12-2-5" class="i">+                            url = it
</a><a href="#h12-2-6" id="h12-2-6" class="i">+                        }
</a><a href="#h12-2-7" id="h12-2-7" class="i">+                    }
</a>                     Spacer(modifier = Modifier.height(8.dp))
                     Button(
                         enabled = url.isNotBlank(),
<b>diff --git a/<a id="h13" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/EditThemeSection.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,393 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages.theming
</a><a href="#h13-0-1" id="h13-0-1" class="i">+
</a><a href="#h13-0-2" id="h13-0-2" class="i">+import androidx.compose.foundation.ExperimentalFoundationApi
</a><a href="#h13-0-3" id="h13-0-3" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h13-0-4" id="h13-0-4" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h13-0-5" id="h13-0-5" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h13-0-6" id="h13-0-6" class="i">+import androidx.compose.foundation.lazy.rememberLazyListState
</a><a href="#h13-0-7" id="h13-0-7" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h13-0-8" id="h13-0-8" class="i">+import androidx.compose.material.icons.filled.*
</a><a href="#h13-0-9" id="h13-0-9" class="i">+import androidx.compose.material3.*
</a><a href="#h13-0-10" id="h13-0-10" class="i">+import androidx.compose.runtime.*
</a><a href="#h13-0-11" id="h13-0-11" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h13-0-12" id="h13-0-12" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h13-0-13" id="h13-0-13" class="i">+import androidx.compose.ui.focus.FocusRequester
</a><a href="#h13-0-14" id="h13-0-14" class="i">+import androidx.compose.ui.focus.focusRequester
</a><a href="#h13-0-15" id="h13-0-15" class="i">+import androidx.compose.ui.graphics.Color
</a><a href="#h13-0-16" id="h13-0-16" class="i">+import androidx.compose.ui.graphics.toArgb
</a><a href="#h13-0-17" id="h13-0-17" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h13-0-18" id="h13-0-18" class="i">+import androidx.compose.ui.text.style.TextAlign
</a><a href="#h13-0-19" id="h13-0-19" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h13-0-20" id="h13-0-20" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h13-0-21" id="h13-0-21" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h13-0-22" id="h13-0-22" class="i">+import androidx.navigation.NavBackStackEntry
</a><a href="#h13-0-23" id="h13-0-23" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h13-0-24" id="h13-0-24" class="i">+import kotlinx.coroutines.delay
</a><a href="#h13-0-25" id="h13-0-25" class="i">+import kotlinx.coroutines.launch
</a><a href="#h13-0-26" id="h13-0-26" class="i">+import kotlinx.coroutines.withContext
</a><a href="#h13-0-27" id="h13-0-27" class="i">+import me.rhunk.snapenhance.common.data.*
</a><a href="#h13-0-28" id="h13-0-28" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h13-0-29" id="h13-0-29" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h13-0-30" id="h13-0-30" class="i">+import me.rhunk.snapenhance.common.ui.transparentTextFieldColors
</a><a href="#h13-0-31" id="h13-0-31" class="i">+import me.rhunk.snapenhance.storage.*
</a><a href="#h13-0-32" id="h13-0-32" class="i">+import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h13-0-33" id="h13-0-33" class="i">+import me.rhunk.snapenhance.ui.util.AlertDialogs
</a><a href="#h13-0-34" id="h13-0-34" class="i">+import me.rhunk.snapenhance.ui.util.CircularAlphaTile
</a><a href="#h13-0-35" id="h13-0-35" class="i">+import me.rhunk.snapenhance.ui.util.Dialog
</a><a href="#h13-0-36" id="h13-0-36" class="i">+
</a><a href="#h13-0-37" id="h13-0-37" class="i">+class EditThemeSection: Routes.Route() {
</a><a href="#h13-0-38" id="h13-0-38" class="i">+    private var saveCallback by mutableStateOf&lt;(() -&gt; Unit)?&gt;(null)
</a><a href="#h13-0-39" id="h13-0-39" class="i">+    private var addEntryCallback by mutableStateOf&lt;(key: String, initialColor: Int) -&gt; Unit&gt;({ _, _ -&gt; })
</a><a href="#h13-0-40" id="h13-0-40" class="i">+    private var deleteCallback by mutableStateOf&lt;(() -&gt; Unit)?&gt;(null)
</a><a href="#h13-0-41" id="h13-0-41" class="i">+    private var themeColors = mutableStateListOf&lt;ThemeColorEntry&gt;()
</a><a href="#h13-0-42" id="h13-0-42" class="i">+
</a><a href="#h13-0-43" id="h13-0-43" class="i">+    private val alertDialogs by lazy {
</a><a href="#h13-0-44" id="h13-0-44" class="i">+        AlertDialogs(context.translation)
</a><a href="#h13-0-45" id="h13-0-45" class="i">+    }
</a><a href="#h13-0-46" id="h13-0-46" class="i">+
</a><a href="#h13-0-47" id="h13-0-47" class="i">+    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = {
</a><a href="#h13-0-48" id="h13-0-48" class="i">+        var deleteConfirmationDialog by remember { mutableStateOf(false) }
</a><a href="#h13-0-49" id="h13-0-49" class="i">+
</a><a href="#h13-0-50" id="h13-0-50" class="i">+        if (deleteConfirmationDialog) {
</a><a href="#h13-0-51" id="h13-0-51" class="i">+            Dialog(onDismissRequest = {
</a><a href="#h13-0-52" id="h13-0-52" class="i">+                deleteConfirmationDialog = false
</a><a href="#h13-0-53" id="h13-0-53" class="i">+            }) {
</a><a href="#h13-0-54" id="h13-0-54" class="i">+                alertDialogs.ConfirmDialog(
</a><a href="#h13-0-55" id="h13-0-55" class="i">+                    title = &quot;Delete Theme&quot;,
</a><a href="#h13-0-56" id="h13-0-56" class="i">+                    message = &quot;Are you sure you want to delete this theme?&quot;,
</a><a href="#h13-0-57" id="h13-0-57" class="i">+                    onConfirm = {
</a><a href="#h13-0-58" id="h13-0-58" class="i">+                        deleteCallback?.invoke()
</a><a href="#h13-0-59" id="h13-0-59" class="i">+                        deleteConfirmationDialog = false
</a><a href="#h13-0-60" id="h13-0-60" class="i">+                    },
</a><a href="#h13-0-61" id="h13-0-61" class="i">+                    onDismiss = {
</a><a href="#h13-0-62" id="h13-0-62" class="i">+                        deleteConfirmationDialog = false
</a><a href="#h13-0-63" id="h13-0-63" class="i">+                    }
</a><a href="#h13-0-64" id="h13-0-64" class="i">+                )
</a><a href="#h13-0-65" id="h13-0-65" class="i">+            }
</a><a href="#h13-0-66" id="h13-0-66" class="i">+        }
</a><a href="#h13-0-67" id="h13-0-67" class="i">+
</a><a href="#h13-0-68" id="h13-0-68" class="i">+        deleteCallback?.let {
</a><a href="#h13-0-69" id="h13-0-69" class="i">+            IconButton(onClick = {
</a><a href="#h13-0-70" id="h13-0-70" class="i">+                deleteConfirmationDialog = true
</a><a href="#h13-0-71" id="h13-0-71" class="i">+            }) {
</a><a href="#h13-0-72" id="h13-0-72" class="i">+                Icon(Icons.Default.Delete, contentDescription = null)
</a><a href="#h13-0-73" id="h13-0-73" class="i">+            }
</a><a href="#h13-0-74" id="h13-0-74" class="i">+        }
</a><a href="#h13-0-75" id="h13-0-75" class="i">+    }
</a><a href="#h13-0-76" id="h13-0-76" class="i">+
</a><a href="#h13-0-77" id="h13-0-77" class="i">+    @OptIn(ExperimentalFoundationApi::class)
</a><a href="#h13-0-78" id="h13-0-78" class="i">+    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h13-0-79" id="h13-0-79" class="i">+        Column(
</a><a href="#h13-0-80" id="h13-0-80" class="i">+            horizontalAlignment = Alignment.End,
</a><a href="#h13-0-81" id="h13-0-81" class="i">+            verticalArrangement = Arrangement.spacedBy(5.dp),
</a><a href="#h13-0-82" id="h13-0-82" class="i">+        ) {
</a><a href="#h13-0-83" id="h13-0-83" class="i">+            var addAttributeDialog by remember { mutableStateOf(false) }
</a><a href="#h13-0-84" id="h13-0-84" class="i">+            val attributesTranslation = remember { context.translation.getCategory(&quot;theming_attributes&quot;) }
</a><a href="#h13-0-85" id="h13-0-85" class="i">+
</a><a href="#h13-0-86" id="h13-0-86" class="i">+            if (addAttributeDialog) {
</a><a href="#h13-0-87" id="h13-0-87" class="i">+                AlertDialog(
</a><a href="#h13-0-88" id="h13-0-88" class="i">+                    title = { Text(&quot;Select an attribute to add&quot;) },
</a><a href="#h13-0-89" id="h13-0-89" class="i">+                    onDismissRequest = {
</a><a href="#h13-0-90" id="h13-0-90" class="i">+                        addAttributeDialog = false
</a><a href="#h13-0-91" id="h13-0-91" class="i">+                    },
</a><a href="#h13-0-92" id="h13-0-92" class="i">+                    confirmButton = {},
</a><a href="#h13-0-93" id="h13-0-93" class="i">+                    text = {
</a><a href="#h13-0-94" id="h13-0-94" class="i">+                        var filter by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h13-0-95" id="h13-0-95" class="i">+                        val attributes = rememberAsyncMutableStateList(defaultValue = listOf(), keys = arrayOf(filter)) {
</a><a href="#h13-0-96" id="h13-0-96" class="i">+                            AvailableThemingAttributes[ThemingAttributeType.COLOR]?.filter { key -&gt;
</a><a href="#h13-0-97" id="h13-0-97" class="i">+                                themeColors.none { it.key == key } &amp;&amp; (key.contains(filter, ignoreCase = true) || attributesTranslation.getOrNull(key)?.contains(filter, ignoreCase = true) == true)
</a><a href="#h13-0-98" id="h13-0-98" class="i">+                            } ?: emptyList()
</a><a href="#h13-0-99" id="h13-0-99" class="i">+                        }
</a><a href="#h13-0-100" id="h13-0-100" class="i">+
</a><a href="#h13-0-101" id="h13-0-101" class="i">+                        LazyColumn(
</a><a href="#h13-0-102" id="h13-0-102" class="i">+                            modifier = Modifier
</a><a href="#h13-0-103" id="h13-0-103" class="i">+                                .fillMaxHeight(0.7f)
</a><a href="#h13-0-104" id="h13-0-104" class="i">+                                .fillMaxWidth(),
</a><a href="#h13-0-105" id="h13-0-105" class="i">+                        ) {
</a><a href="#h13-0-106" id="h13-0-106" class="i">+                            stickyHeader {
</a><a href="#h13-0-107" id="h13-0-107" class="i">+                                TextField(
</a><a href="#h13-0-108" id="h13-0-108" class="i">+                                    modifier = Modifier.fillMaxWidth().padding(bottom = 5.dp),
</a><a href="#h13-0-109" id="h13-0-109" class="i">+                                    value = filter,
</a><a href="#h13-0-110" id="h13-0-110" class="i">+                                    onValueChange = { filter = it },
</a><a href="#h13-0-111" id="h13-0-111" class="i">+                                    label = { Text(&quot;Search&quot;) },
</a><a href="#h13-0-112" id="h13-0-112" class="i">+                                    colors = transparentTextFieldColors().copy(
</a><a href="#h13-0-113" id="h13-0-113" class="i">+                                        focusedContainerColor = MaterialTheme.colorScheme.surfaceBright,
</a><a href="#h13-0-114" id="h13-0-114" class="i">+                                        unfocusedContainerColor = MaterialTheme.colorScheme.surfaceBright
</a><a href="#h13-0-115" id="h13-0-115" class="i">+                                    )
</a><a href="#h13-0-116" id="h13-0-116" class="i">+                                )
</a><a href="#h13-0-117" id="h13-0-117" class="i">+                            }
</a><a href="#h13-0-118" id="h13-0-118" class="i">+                            item {
</a><a href="#h13-0-119" id="h13-0-119" class="i">+                                if (attributes.isEmpty()) {
</a><a href="#h13-0-120" id="h13-0-120" class="i">+                                    Text(&quot;No attributes&quot;)
</a><a href="#h13-0-121" id="h13-0-121" class="i">+                                }
</a><a href="#h13-0-122" id="h13-0-122" class="i">+                            }
</a><a href="#h13-0-123" id="h13-0-123" class="i">+                            items(attributes) { attribute -&gt;
</a><a href="#h13-0-124" id="h13-0-124" class="i">+                                Card(
</a><a href="#h13-0-125" id="h13-0-125" class="i">+                                    modifier = Modifier.padding(5.dp).fillMaxWidth(),
</a><a href="#h13-0-126" id="h13-0-126" class="i">+                                    onClick = {
</a><a href="#h13-0-127" id="h13-0-127" class="i">+                                        addEntryCallback(attribute, Color.White.toArgb())
</a><a href="#h13-0-128" id="h13-0-128" class="i">+                                        addAttributeDialog = false
</a><a href="#h13-0-129" id="h13-0-129" class="i">+                                    }
</a><a href="#h13-0-130" id="h13-0-130" class="i">+                                ) {
</a><a href="#h13-0-131" id="h13-0-131" class="i">+                                    val attributeTranslation = remember(attribute) {
</a><a href="#h13-0-132" id="h13-0-132" class="i">+                                        attributesTranslation.getOrNull(attribute)
</a><a href="#h13-0-133" id="h13-0-133" class="i">+                                    }
</a><a href="#h13-0-134" id="h13-0-134" class="i">+
</a><a href="#h13-0-135" id="h13-0-135" class="i">+                                    Column(
</a><a href="#h13-0-136" id="h13-0-136" class="i">+                                        modifier = Modifier.padding(8.dp)
</a><a href="#h13-0-137" id="h13-0-137" class="i">+                                    ) {
</a><a href="#h13-0-138" id="h13-0-138" class="i">+                                        Text(attributeTranslation ?: attribute, lineHeight = 15.sp)
</a><a href="#h13-0-139" id="h13-0-139" class="i">+                                        attributeTranslation?.let {
</a><a href="#h13-0-140" id="h13-0-140" class="i">+                                            Text(attribute, fontWeight = FontWeight.Light, fontSize = 10.sp, lineHeight = 15.sp)
</a><a href="#h13-0-141" id="h13-0-141" class="i">+                                        }
</a><a href="#h13-0-142" id="h13-0-142" class="i">+                                    }
</a><a href="#h13-0-143" id="h13-0-143" class="i">+                                }
</a><a href="#h13-0-144" id="h13-0-144" class="i">+                            }
</a><a href="#h13-0-145" id="h13-0-145" class="i">+                        }
</a><a href="#h13-0-146" id="h13-0-146" class="i">+                    }
</a><a href="#h13-0-147" id="h13-0-147" class="i">+                )
</a><a href="#h13-0-148" id="h13-0-148" class="i">+            }
</a><a href="#h13-0-149" id="h13-0-149" class="i">+
</a><a href="#h13-0-150" id="h13-0-150" class="i">+            FloatingActionButton(onClick = {
</a><a href="#h13-0-151" id="h13-0-151" class="i">+                addAttributeDialog = true
</a><a href="#h13-0-152" id="h13-0-152" class="i">+            }) {
</a><a href="#h13-0-153" id="h13-0-153" class="i">+                Icon(Icons.Default.Add, contentDescription = null)
</a><a href="#h13-0-154" id="h13-0-154" class="i">+            }
</a><a href="#h13-0-155" id="h13-0-155" class="i">+
</a><a href="#h13-0-156" id="h13-0-156" class="i">+            saveCallback?.let {
</a><a href="#h13-0-157" id="h13-0-157" class="i">+                FloatingActionButton(onClick = {
</a><a href="#h13-0-158" id="h13-0-158" class="i">+                    it()
</a><a href="#h13-0-159" id="h13-0-159" class="i">+                }) {
</a><a href="#h13-0-160" id="h13-0-160" class="i">+                    Icon(Icons.Default.Save, contentDescription = null)
</a><a href="#h13-0-161" id="h13-0-161" class="i">+                }
</a><a href="#h13-0-162" id="h13-0-162" class="i">+            }
</a><a href="#h13-0-163" id="h13-0-163" class="i">+        }
</a><a href="#h13-0-164" id="h13-0-164" class="i">+    }
</a><a href="#h13-0-165" id="h13-0-165" class="i">+
</a><a href="#h13-0-166" id="h13-0-166" class="i">+    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h13-0-167" id="h13-0-167" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h13-0-168" id="h13-0-168" class="i">+        val currentThemeId = remember { it.arguments?.getString(&quot;theme_id&quot;)?.toIntOrNull() }
</a><a href="#h13-0-169" id="h13-0-169" class="i">+
</a><a href="#h13-0-170" id="h13-0-170" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h13-0-171" id="h13-0-171" class="i">+            themeColors.clear()
</a><a href="#h13-0-172" id="h13-0-172" class="i">+        }
</a><a href="#h13-0-173" id="h13-0-173" class="i">+
</a><a href="#h13-0-174" id="h13-0-174" class="i">+        var themeName by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h13-0-175" id="h13-0-175" class="i">+        var themeDescription by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h13-0-176" id="h13-0-176" class="i">+        var themeVersion by remember { mutableStateOf(&quot;1.0.0&quot;) }
</a><a href="#h13-0-177" id="h13-0-177" class="i">+        var themeAuthor by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h13-0-178" id="h13-0-178" class="i">+        var themeUpdateUrl by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h13-0-179" id="h13-0-179" class="i">+
</a><a href="#h13-0-180" id="h13-0-180" class="i">+        val themeInfo by rememberAsyncMutableState(defaultValue = null) {
</a><a href="#h13-0-181" id="h13-0-181" class="i">+            currentThemeId?.let { themeId -&gt;
</a><a href="#h13-0-182" id="h13-0-182" class="i">+                context.database.getThemeInfo(themeId)?.also { theme -&gt;
</a><a href="#h13-0-183" id="h13-0-183" class="i">+                    themeName = theme.name
</a><a href="#h13-0-184" id="h13-0-184" class="i">+                    themeDescription = theme.description ?: &quot;&quot;
</a><a href="#h13-0-185" id="h13-0-185" class="i">+                    theme.version?.let { themeVersion = it }
</a><a href="#h13-0-186" id="h13-0-186" class="i">+                    themeAuthor = theme.author ?: &quot;&quot;
</a><a href="#h13-0-187" id="h13-0-187" class="i">+                    themeUpdateUrl = theme.updateUrl ?: &quot;&quot;
</a><a href="#h13-0-188" id="h13-0-188" class="i">+                }
</a><a href="#h13-0-189" id="h13-0-189" class="i">+            }
</a><a href="#h13-0-190" id="h13-0-190" class="i">+        }
</a><a href="#h13-0-191" id="h13-0-191" class="i">+
</a><a href="#h13-0-192" id="h13-0-192" class="i">+        val lazyListState = rememberLazyListState()
</a><a href="#h13-0-193" id="h13-0-193" class="i">+
</a><a href="#h13-0-194" id="h13-0-194" class="i">+        rememberAsyncMutableState(defaultValue = DatabaseThemeContent(), keys = arrayOf(themeInfo)) {
</a><a href="#h13-0-195" id="h13-0-195" class="i">+            currentThemeId?.let {
</a><a href="#h13-0-196" id="h13-0-196" class="i">+                context.database.getThemeContent(it)?.also { content -&gt;
</a><a href="#h13-0-197" id="h13-0-197" class="i">+                    themeColors.clear()
</a><a href="#h13-0-198" id="h13-0-198" class="i">+                    themeColors.addAll(content.colors)
</a><a href="#h13-0-199" id="h13-0-199" class="i">+                    withContext(Dispatchers.Main) {
</a><a href="#h13-0-200" id="h13-0-200" class="i">+                        lazyListState.scrollToItem(themeColors.size)
</a><a href="#h13-0-201" id="h13-0-201" class="i">+                    }
</a><a href="#h13-0-202" id="h13-0-202" class="i">+                }
</a><a href="#h13-0-203" id="h13-0-203" class="i">+            } ?: DatabaseThemeContent()
</a><a href="#h13-0-204" id="h13-0-204" class="i">+        }
</a><a href="#h13-0-205" id="h13-0-205" class="i">+
</a><a href="#h13-0-206" id="h13-0-206" class="i">+        if (themeName.isNotBlank()) {
</a><a href="#h13-0-207" id="h13-0-207" class="i">+            saveCallback = {
</a><a href="#h13-0-208" id="h13-0-208" class="i">+                coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h13-0-209" id="h13-0-209" class="i">+                    val theme = DatabaseTheme(
</a><a href="#h13-0-210" id="h13-0-210" class="i">+                        id = currentThemeId ?: -1,
</a><a href="#h13-0-211" id="h13-0-211" class="i">+                        enabled = themeInfo?.enabled ?: false,
</a><a href="#h13-0-212" id="h13-0-212" class="i">+                        name = themeName,
</a><a href="#h13-0-213" id="h13-0-213" class="i">+                        description = themeDescription,
</a><a href="#h13-0-214" id="h13-0-214" class="i">+                        version = themeVersion,
</a><a href="#h13-0-215" id="h13-0-215" class="i">+                        author = themeAuthor,
</a><a href="#h13-0-216" id="h13-0-216" class="i">+                        updateUrl = themeUpdateUrl
</a><a href="#h13-0-217" id="h13-0-217" class="i">+                    )
</a><a href="#h13-0-218" id="h13-0-218" class="i">+                    val themeId = context.database.addOrUpdateTheme(theme, currentThemeId)
</a><a href="#h13-0-219" id="h13-0-219" class="i">+                    context.database.setThemeContent(themeId, DatabaseThemeContent(
</a><a href="#h13-0-220" id="h13-0-220" class="i">+                        colors = themeColors
</a><a href="#h13-0-221" id="h13-0-221" class="i">+                    ))
</a><a href="#h13-0-222" id="h13-0-222" class="i">+                    withContext(Dispatchers.Main) {
</a><a href="#h13-0-223" id="h13-0-223" class="i">+                        routes.theming.navigateReload()
</a><a href="#h13-0-224" id="h13-0-224" class="i">+                    }
</a><a href="#h13-0-225" id="h13-0-225" class="i">+                }
</a><a href="#h13-0-226" id="h13-0-226" class="i">+            }
</a><a href="#h13-0-227" id="h13-0-227" class="i">+        } else {
</a><a href="#h13-0-228" id="h13-0-228" class="i">+            saveCallback = null
</a><a href="#h13-0-229" id="h13-0-229" class="i">+        }
</a><a href="#h13-0-230" id="h13-0-230" class="i">+
</a><a href="#h13-0-231" id="h13-0-231" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h13-0-232" id="h13-0-232" class="i">+            deleteCallback = null
</a><a href="#h13-0-233" id="h13-0-233" class="i">+            if (currentThemeId != null) {
</a><a href="#h13-0-234" id="h13-0-234" class="i">+                deleteCallback = {
</a><a href="#h13-0-235" id="h13-0-235" class="i">+                    coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h13-0-236" id="h13-0-236" class="i">+                        context.database.deleteTheme(currentThemeId)
</a><a href="#h13-0-237" id="h13-0-237" class="i">+                        withContext(Dispatchers.Main) {
</a><a href="#h13-0-238" id="h13-0-238" class="i">+                            routes.theming.navigateReload()
</a><a href="#h13-0-239" id="h13-0-239" class="i">+                        }
</a><a href="#h13-0-240" id="h13-0-240" class="i">+                    }
</a><a href="#h13-0-241" id="h13-0-241" class="i">+                }
</a><a href="#h13-0-242" id="h13-0-242" class="i">+            }
</a><a href="#h13-0-243" id="h13-0-243" class="i">+            addEntryCallback = { key, initialColor -&gt;
</a><a href="#h13-0-244" id="h13-0-244" class="i">+                coroutineScope.launch(Dispatchers.Main) {
</a><a href="#h13-0-245" id="h13-0-245" class="i">+                    themeColors.add(ThemeColorEntry(key, initialColor))
</a><a href="#h13-0-246" id="h13-0-246" class="i">+                    delay(100)
</a><a href="#h13-0-247" id="h13-0-247" class="i">+                    lazyListState.scrollToItem(themeColors.size)
</a><a href="#h13-0-248" id="h13-0-248" class="i">+                }
</a><a href="#h13-0-249" id="h13-0-249" class="i">+            }
</a><a href="#h13-0-250" id="h13-0-250" class="i">+        }
</a><a href="#h13-0-251" id="h13-0-251" class="i">+
</a><a href="#h13-0-252" id="h13-0-252" class="i">+        var moreOptionsExpanded by remember { mutableStateOf(false) }
</a><a href="#h13-0-253" id="h13-0-253" class="i">+
</a><a href="#h13-0-254" id="h13-0-254" class="i">+        Column(
</a><a href="#h13-0-255" id="h13-0-255" class="i">+            modifier = Modifier.fillMaxSize(),
</a><a href="#h13-0-256" id="h13-0-256" class="i">+            verticalArrangement = Arrangement.spacedBy(8.dp)
</a><a href="#h13-0-257" id="h13-0-257" class="i">+        ) {
</a><a href="#h13-0-258" id="h13-0-258" class="i">+            Row(
</a><a href="#h13-0-259" id="h13-0-259" class="i">+                verticalAlignment = Alignment.CenterVertically,
</a><a href="#h13-0-260" id="h13-0-260" class="i">+            ) {
</a><a href="#h13-0-261" id="h13-0-261" class="i">+                val focusRequester = remember { FocusRequester() }
</a><a href="#h13-0-262" id="h13-0-262" class="i">+
</a><a href="#h13-0-263" id="h13-0-263" class="i">+                TextField(
</a><a href="#h13-0-264" id="h13-0-264" class="i">+                    modifier = Modifier.weight(1f).focusRequester(focusRequester),
</a><a href="#h13-0-265" id="h13-0-265" class="i">+                    value = themeName,
</a><a href="#h13-0-266" id="h13-0-266" class="i">+                    onValueChange = { themeName = it },
</a><a href="#h13-0-267" id="h13-0-267" class="i">+                    label = { Text(&quot;Theme Name&quot;) },
</a><a href="#h13-0-268" id="h13-0-268" class="i">+                    colors = transparentTextFieldColors(),
</a><a href="#h13-0-269" id="h13-0-269" class="i">+                    singleLine = true,
</a><a href="#h13-0-270" id="h13-0-270" class="i">+                )
</a><a href="#h13-0-271" id="h13-0-271" class="i">+                LaunchedEffect(Unit) {
</a><a href="#h13-0-272" id="h13-0-272" class="i">+                    if (currentThemeId == null) {
</a><a href="#h13-0-273" id="h13-0-273" class="i">+                        delay(200)
</a><a href="#h13-0-274" id="h13-0-274" class="i">+                        focusRequester.requestFocus()
</a><a href="#h13-0-275" id="h13-0-275" class="i">+                    }
</a><a href="#h13-0-276" id="h13-0-276" class="i">+                }
</a><a href="#h13-0-277" id="h13-0-277" class="i">+                IconButton(
</a><a href="#h13-0-278" id="h13-0-278" class="i">+                    modifier = Modifier.padding(4.dp),
</a><a href="#h13-0-279" id="h13-0-279" class="i">+                    onClick = {
</a><a href="#h13-0-280" id="h13-0-280" class="i">+                        moreOptionsExpanded = !moreOptionsExpanded
</a><a href="#h13-0-281" id="h13-0-281" class="i">+                    }
</a><a href="#h13-0-282" id="h13-0-282" class="i">+                ) {
</a><a href="#h13-0-283" id="h13-0-283" class="i">+                    Icon(if (moreOptionsExpanded) Icons.Default.KeyboardArrowUp else Icons.Default.KeyboardArrowDown, contentDescription = null)
</a><a href="#h13-0-284" id="h13-0-284" class="i">+                }
</a><a href="#h13-0-285" id="h13-0-285" class="i">+            }
</a><a href="#h13-0-286" id="h13-0-286" class="i">+
</a><a href="#h13-0-287" id="h13-0-287" class="i">+            if (moreOptionsExpanded) {
</a><a href="#h13-0-288" id="h13-0-288" class="i">+                TextField(
</a><a href="#h13-0-289" id="h13-0-289" class="i">+                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h13-0-290" id="h13-0-290" class="i">+                    maxLines = 3,
</a><a href="#h13-0-291" id="h13-0-291" class="i">+                    value = themeDescription,
</a><a href="#h13-0-292" id="h13-0-292" class="i">+                    onValueChange = { themeDescription = it },
</a><a href="#h13-0-293" id="h13-0-293" class="i">+                    label = { Text(&quot;Description&quot;) },
</a><a href="#h13-0-294" id="h13-0-294" class="i">+                    colors = transparentTextFieldColors()
</a><a href="#h13-0-295" id="h13-0-295" class="i">+                )
</a><a href="#h13-0-296" id="h13-0-296" class="i">+                TextField(
</a><a href="#h13-0-297" id="h13-0-297" class="i">+                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h13-0-298" id="h13-0-298" class="i">+                    singleLine = true,
</a><a href="#h13-0-299" id="h13-0-299" class="i">+                    value = themeVersion,
</a><a href="#h13-0-300" id="h13-0-300" class="i">+                    onValueChange = { themeVersion = it },
</a><a href="#h13-0-301" id="h13-0-301" class="i">+                    label = { Text(&quot;Version&quot;) },
</a><a href="#h13-0-302" id="h13-0-302" class="i">+                    colors = transparentTextFieldColors()
</a><a href="#h13-0-303" id="h13-0-303" class="i">+                )
</a><a href="#h13-0-304" id="h13-0-304" class="i">+                TextField(
</a><a href="#h13-0-305" id="h13-0-305" class="i">+                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h13-0-306" id="h13-0-306" class="i">+                    singleLine = true,
</a><a href="#h13-0-307" id="h13-0-307" class="i">+                    value = themeAuthor,
</a><a href="#h13-0-308" id="h13-0-308" class="i">+                    onValueChange = { themeAuthor = it },
</a><a href="#h13-0-309" id="h13-0-309" class="i">+                    label = { Text(&quot;Author&quot;) },
</a><a href="#h13-0-310" id="h13-0-310" class="i">+                    colors = transparentTextFieldColors()
</a><a href="#h13-0-311" id="h13-0-311" class="i">+                )
</a><a href="#h13-0-312" id="h13-0-312" class="i">+                TextField(
</a><a href="#h13-0-313" id="h13-0-313" class="i">+                    modifier = Modifier.fillMaxWidth(),
</a><a href="#h13-0-314" id="h13-0-314" class="i">+                    singleLine = true,
</a><a href="#h13-0-315" id="h13-0-315" class="i">+                    value = themeUpdateUrl,
</a><a href="#h13-0-316" id="h13-0-316" class="i">+                    onValueChange = { themeUpdateUrl = it },
</a><a href="#h13-0-317" id="h13-0-317" class="i">+                    label = { Text(&quot;Update URL&quot;) },
</a><a href="#h13-0-318" id="h13-0-318" class="i">+                    colors = transparentTextFieldColors()
</a><a href="#h13-0-319" id="h13-0-319" class="i">+                )
</a><a href="#h13-0-320" id="h13-0-320" class="i">+            }
</a><a href="#h13-0-321" id="h13-0-321" class="i">+
</a><a href="#h13-0-322" id="h13-0-322" class="i">+            LazyColumn(
</a><a href="#h13-0-323" id="h13-0-323" class="i">+                modifier = Modifier.fillMaxWidth(),
</a><a href="#h13-0-324" id="h13-0-324" class="i">+                state = lazyListState,
</a><a href="#h13-0-325" id="h13-0-325" class="i">+                contentPadding = PaddingValues(10.dp),
</a><a href="#h13-0-326" id="h13-0-326" class="i">+                verticalArrangement = Arrangement.spacedBy(4.dp),
</a><a href="#h13-0-327" id="h13-0-327" class="i">+                reverseLayout = true,
</a><a href="#h13-0-328" id="h13-0-328" class="i">+            ) {
</a><a href="#h13-0-329" id="h13-0-329" class="i">+                item {
</a><a href="#h13-0-330" id="h13-0-330" class="i">+                    Spacer(modifier = Modifier.height(150.dp))
</a><a href="#h13-0-331" id="h13-0-331" class="i">+                }
</a><a href="#h13-0-332" id="h13-0-332" class="i">+                items(themeColors) { colorEntry -&gt;
</a><a href="#h13-0-333" id="h13-0-333" class="i">+                    var showEditColorDialog by remember { mutableStateOf(false) }
</a><a href="#h13-0-334" id="h13-0-334" class="i">+                    var currentColor by remember { mutableIntStateOf(colorEntry.value) }
</a><a href="#h13-0-335" id="h13-0-335" class="i">+
</a><a href="#h13-0-336" id="h13-0-336" class="i">+                    ElevatedCard(
</a><a href="#h13-0-337" id="h13-0-337" class="i">+                        modifier = Modifier
</a><a href="#h13-0-338" id="h13-0-338" class="i">+                            .fillMaxWidth(),
</a><a href="#h13-0-339" id="h13-0-339" class="i">+                        onClick = {
</a><a href="#h13-0-340" id="h13-0-340" class="i">+                            showEditColorDialog = true
</a><a href="#h13-0-341" id="h13-0-341" class="i">+                        }
</a><a href="#h13-0-342" id="h13-0-342" class="i">+                    ) {
</a><a href="#h13-0-343" id="h13-0-343" class="i">+                        Row(
</a><a href="#h13-0-344" id="h13-0-344" class="i">+                            modifier = Modifier
</a><a href="#h13-0-345" id="h13-0-345" class="i">+                                .padding(4.dp)
</a><a href="#h13-0-346" id="h13-0-346" class="i">+                                .fillMaxWidth(),
</a><a href="#h13-0-347" id="h13-0-347" class="i">+                            verticalAlignment = Alignment.CenterVertically
</a><a href="#h13-0-348" id="h13-0-348" class="i">+                        ) {
</a><a href="#h13-0-349" id="h13-0-349" class="i">+                            Icon(Icons.Default.Colorize, contentDescription = null, modifier = Modifier.padding(8.dp))
</a><a href="#h13-0-350" id="h13-0-350" class="i">+                            Column(
</a><a href="#h13-0-351" id="h13-0-351" class="i">+                                modifier = Modifier.weight(1f)
</a><a href="#h13-0-352" id="h13-0-352" class="i">+                            ) {
</a><a href="#h13-0-353" id="h13-0-353" class="i">+                                val translation = remember(colorEntry.key) { context.translation.getOrNull(&quot;theming_attributes.${colorEntry.key}&quot;) }
</a><a href="#h13-0-354" id="h13-0-354" class="i">+                                Text(text = translation ?: colorEntry.key, overflow = TextOverflow.Ellipsis, maxLines = 1, lineHeight = 15.sp)
</a><a href="#h13-0-355" id="h13-0-355" class="i">+                                translation?.let {
</a><a href="#h13-0-356" id="h13-0-356" class="i">+                                    Text(text = colorEntry.key, fontSize = 10.sp, fontWeight = FontWeight.Light, overflow = TextOverflow.Ellipsis, maxLines = 1, lineHeight = 15.sp)
</a><a href="#h13-0-357" id="h13-0-357" class="i">+                                }
</a><a href="#h13-0-358" id="h13-0-358" class="i">+                            }
</a><a href="#h13-0-359" id="h13-0-359" class="i">+                            CircularAlphaTile(selectedColor = Color(currentColor))
</a><a href="#h13-0-360" id="h13-0-360" class="i">+                        }
</a><a href="#h13-0-361" id="h13-0-361" class="i">+                    }
</a><a href="#h13-0-362" id="h13-0-362" class="i">+
</a><a href="#h13-0-363" id="h13-0-363" class="i">+                    if (showEditColorDialog) {
</a><a href="#h13-0-364" id="h13-0-364" class="i">+                        Dialog(onDismissRequest = { showEditColorDialog = false }) {
</a><a href="#h13-0-365" id="h13-0-365" class="i">+                            alertDialogs.ColorPickerDialog(
</a><a href="#h13-0-366" id="h13-0-366" class="i">+                                initialColor = Color(currentColor),
</a><a href="#h13-0-367" id="h13-0-367" class="i">+                                setProperty = {
</a><a href="#h13-0-368" id="h13-0-368" class="i">+                                    if (it == null) {
</a><a href="#h13-0-369" id="h13-0-369" class="i">+                                        themeColors.remove(colorEntry)
</a><a href="#h13-0-370" id="h13-0-370" class="i">+                                        return@ColorPickerDialog
</a><a href="#h13-0-371" id="h13-0-371" class="i">+                                    }
</a><a href="#h13-0-372" id="h13-0-372" class="i">+                                    currentColor = it.toArgb()
</a><a href="#h13-0-373" id="h13-0-373" class="i">+                                    colorEntry.value = currentColor
</a><a href="#h13-0-374" id="h13-0-374" class="i">+                                },
</a><a href="#h13-0-375" id="h13-0-375" class="i">+                                dismiss = {
</a><a href="#h13-0-376" id="h13-0-376" class="i">+                                    showEditColorDialog = false
</a><a href="#h13-0-377" id="h13-0-377" class="i">+                                }
</a><a href="#h13-0-378" id="h13-0-378" class="i">+                            )
</a><a href="#h13-0-379" id="h13-0-379" class="i">+                        }
</a><a href="#h13-0-380" id="h13-0-380" class="i">+                    }
</a><a href="#h13-0-381" id="h13-0-381" class="i">+                }
</a><a href="#h13-0-382" id="h13-0-382" class="i">+                item {
</a><a href="#h13-0-383" id="h13-0-383" class="i">+                    if (themeColors.isEmpty()) {
</a><a href="#h13-0-384" id="h13-0-384" class="i">+                        Text(&quot;No colors added yet&quot;, modifier = Modifier
</a><a href="#h13-0-385" id="h13-0-385" class="i">+                            .fillMaxWidth()
</a><a href="#h13-0-386" id="h13-0-386" class="i">+                            .padding(8.dp), fontWeight = FontWeight.Light, textAlign = TextAlign.Center)
</a><a href="#h13-0-387" id="h13-0-387" class="i">+                    }
</a><a href="#h13-0-388" id="h13-0-388" class="i">+                }
</a><a href="#h13-0-389" id="h13-0-389" class="i">+            }
</a><a href="#h13-0-390" id="h13-0-390" class="i">+        }
</a><a href="#h13-0-391" id="h13-0-391" class="i">+    }
</a><a href="#h13-0-392" id="h13-0-392" class="i">+}</a><a href="#h13-0-393" id="h13-0-393" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemeCatalog.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1,272 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages.theming
</a><a href="#h14-0-1" id="h14-0-1" class="i">+
</a><a href="#h14-0-2" id="h14-0-2" class="i">+import android.net.Uri
</a><a href="#h14-0-3" id="h14-0-3" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h14-0-4" id="h14-0-4" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h14-0-5" id="h14-0-5" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h14-0-6" id="h14-0-6" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h14-0-7" id="h14-0-7" class="i">+import androidx.compose.material.icons.filled.Palette
</a><a href="#h14-0-8" id="h14-0-8" class="i">+import androidx.compose.material3.*
</a><a href="#h14-0-9" id="h14-0-9" class="i">+import androidx.compose.runtime.*
</a><a href="#h14-0-10" id="h14-0-10" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h14-0-11" id="h14-0-11" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h14-0-12" id="h14-0-12" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h14-0-13" id="h14-0-13" class="i">+import androidx.compose.ui.text.style.TextAlign
</a><a href="#h14-0-14" id="h14-0-14" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h14-0-15" id="h14-0-15" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h14-0-16" id="h14-0-16" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h14-0-17" id="h14-0-17" class="i">+import androidx.core.net.toUri
</a><a href="#h14-0-18" id="h14-0-18" class="i">+import kotlinx.coroutines.*
</a><a href="#h14-0-19" id="h14-0-19" class="i">+import me.rhunk.snapenhance.common.data.RepositoryIndex
</a><a href="#h14-0-20" id="h14-0-20" class="i">+import me.rhunk.snapenhance.common.ui.AsyncUpdateDispatcher
</a><a href="#h14-0-21" id="h14-0-21" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h14-0-22" id="h14-0-22" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h14-0-23" id="h14-0-23" class="i">+import me.rhunk.snapenhance.storage.getThemeList
</a><a href="#h14-0-24" id="h14-0-24" class="i">+import me.rhunk.snapenhance.storage.getRepositories
</a><a href="#h14-0-25" id="h14-0-25" class="i">+import me.rhunk.snapenhance.storage.getThemeIdByUpdateUrl
</a><a href="#h14-0-26" id="h14-0-26" class="i">+import me.rhunk.snapenhance.ui.util.pullrefresh.PullRefreshIndicator
</a><a href="#h14-0-27" id="h14-0-27" class="i">+import me.rhunk.snapenhance.ui.util.pullrefresh.pullRefresh
</a><a href="#h14-0-28" id="h14-0-28" class="i">+import me.rhunk.snapenhance.ui.util.pullrefresh.rememberPullRefreshState
</a><a href="#h14-0-29" id="h14-0-29" class="i">+import okhttp3.Request
</a><a href="#h14-0-30" id="h14-0-30" class="i">+
</a><a href="#h14-0-31" id="h14-0-31" class="i">+
</a><a href="#h14-0-32" id="h14-0-32" class="i">+private val cachedRepoIndexes = mutableStateMapOf&lt;String, RepositoryIndex&gt;()
</a><a href="#h14-0-33" id="h14-0-33" class="i">+private val cacheReloadDispatcher = AsyncUpdateDispatcher()
</a><a href="#h14-0-34" id="h14-0-34" class="i">+
</a><a href="#h14-0-35" id="h14-0-35" class="i">+@Composable
</a><a href="#h14-0-36" id="h14-0-36" class="i">+fun ThemeCatalog(root: ThemingRoot) {
</a><a href="#h14-0-37" id="h14-0-37" class="i">+    val context = remember { root.context }
</a><a href="#h14-0-38" id="h14-0-38" class="i">+    val coroutineScope = rememberCoroutineScope { Dispatchers.IO }
</a><a href="#h14-0-39" id="h14-0-39" class="i">+
</a><a href="#h14-0-40" id="h14-0-40" class="i">+    fun fetchRepoIndexes(): Map&lt;String, RepositoryIndex&gt;? {
</a><a href="#h14-0-41" id="h14-0-41" class="i">+        val indexes = mutableMapOf&lt;String, RepositoryIndex&gt;()
</a><a href="#h14-0-42" id="h14-0-42" class="i">+
</a><a href="#h14-0-43" id="h14-0-43" class="i">+        context.database.getRepositories().forEach { rootUri -&gt;
</a><a href="#h14-0-44" id="h14-0-44" class="i">+            val indexUri = rootUri.toUri().buildUpon().appendPath(&quot;index.json&quot;).build()
</a><a href="#h14-0-45" id="h14-0-45" class="i">+
</a><a href="#h14-0-46" id="h14-0-46" class="i">+            runCatching {
</a><a href="#h14-0-47" id="h14-0-47" class="i">+                root.okHttpClient.newCall(
</a><a href="#h14-0-48" id="h14-0-48" class="i">+                    Request.Builder().url(indexUri.toString()).build()
</a><a href="#h14-0-49" id="h14-0-49" class="i">+                ).execute().use { response -&gt;
</a><a href="#h14-0-50" id="h14-0-50" class="i">+                    if (!response.isSuccessful) {
</a><a href="#h14-0-51" id="h14-0-51" class="i">+                        context.log.error(&quot;Failed to fetch theme index from $indexUri: ${response.code}&quot;)
</a><a href="#h14-0-52" id="h14-0-52" class="i">+                        context.shortToast(&quot;Failed to fetch index of $indexUri&quot;)
</a><a href="#h14-0-53" id="h14-0-53" class="i">+                        return@forEach
</a><a href="#h14-0-54" id="h14-0-54" class="i">+                    }
</a><a href="#h14-0-55" id="h14-0-55" class="i">+
</a><a href="#h14-0-56" id="h14-0-56" class="i">+                    runCatching {
</a><a href="#h14-0-57" id="h14-0-57" class="i">+                        indexes[rootUri] = context.gson.fromJson(response.body.charStream(), RepositoryIndex::class.java)
</a><a href="#h14-0-58" id="h14-0-58" class="i">+                    }.onFailure {
</a><a href="#h14-0-59" id="h14-0-59" class="i">+                        context.log.error(&quot;Failed to parse theme index from $indexUri&quot;, it)
</a><a href="#h14-0-60" id="h14-0-60" class="i">+                        context.shortToast(&quot;Failed to parse index of $indexUri&quot;)
</a><a href="#h14-0-61" id="h14-0-61" class="i">+                    }
</a><a href="#h14-0-62" id="h14-0-62" class="i">+                }
</a><a href="#h14-0-63" id="h14-0-63" class="i">+            }.onFailure {
</a><a href="#h14-0-64" id="h14-0-64" class="i">+                context.log.error(&quot;Failed to fetch theme index from $indexUri&quot;, it)
</a><a href="#h14-0-65" id="h14-0-65" class="i">+                context.shortToast(&quot;Failed to fetch index of $indexUri&quot;)
</a><a href="#h14-0-66" id="h14-0-66" class="i">+            }
</a><a href="#h14-0-67" id="h14-0-67" class="i">+        }
</a><a href="#h14-0-68" id="h14-0-68" class="i">+
</a><a href="#h14-0-69" id="h14-0-69" class="i">+        return indexes
</a><a href="#h14-0-70" id="h14-0-70" class="i">+    }
</a><a href="#h14-0-71" id="h14-0-71" class="i">+
</a><a href="#h14-0-72" id="h14-0-72" class="i">+    suspend fun installTheme(themeUri: Uri) {
</a><a href="#h14-0-73" id="h14-0-73" class="i">+        root.okHttpClient.newCall(
</a><a href="#h14-0-74" id="h14-0-74" class="i">+            Request.Builder().url(themeUri.toString()).build()
</a><a href="#h14-0-75" id="h14-0-75" class="i">+        ).execute().use { response -&gt;
</a><a href="#h14-0-76" id="h14-0-76" class="i">+            if (!response.isSuccessful) {
</a><a href="#h14-0-77" id="h14-0-77" class="i">+                context.log.error(&quot;Failed to fetch theme from $themeUri: ${response.code}&quot;)
</a><a href="#h14-0-78" id="h14-0-78" class="i">+                context.shortToast(&quot;Failed to fetch theme from $themeUri&quot;)
</a><a href="#h14-0-79" id="h14-0-79" class="i">+                return
</a><a href="#h14-0-80" id="h14-0-80" class="i">+            }
</a><a href="#h14-0-81" id="h14-0-81" class="i">+
</a><a href="#h14-0-82" id="h14-0-82" class="i">+            val themeContent = response.body.bytes().toString(Charsets.UTF_8)
</a><a href="#h14-0-83" id="h14-0-83" class="i">+            root.importTheme(themeContent, themeUri.toString())
</a><a href="#h14-0-84" id="h14-0-84" class="i">+        }
</a><a href="#h14-0-85" id="h14-0-85" class="i">+    }
</a><a href="#h14-0-86" id="h14-0-86" class="i">+
</a><a href="#h14-0-87" id="h14-0-87" class="i">+    var isRefreshing by remember { mutableStateOf(false) }
</a><a href="#h14-0-88" id="h14-0-88" class="i">+
</a><a href="#h14-0-89" id="h14-0-89" class="i">+    suspend fun refreshCachedIndexes() {
</a><a href="#h14-0-90" id="h14-0-90" class="i">+        isRefreshing = true
</a><a href="#h14-0-91" id="h14-0-91" class="i">+        coroutineScope {
</a><a href="#h14-0-92" id="h14-0-92" class="i">+            launch(Dispatchers.IO) {
</a><a href="#h14-0-93" id="h14-0-93" class="i">+                fetchRepoIndexes()?.let {
</a><a href="#h14-0-94" id="h14-0-94" class="i">+                    context.log.verbose(&quot;Fetched ${it.size} theme indexes&quot;)
</a><a href="#h14-0-95" id="h14-0-95" class="i">+                    it.forEach { (t, u) -&gt;
</a><a href="#h14-0-96" id="h14-0-96" class="i">+                        context.log.verbose(&quot;Fetched theme index from $t with ${u.themes.size} themes&quot;)
</a><a href="#h14-0-97" id="h14-0-97" class="i">+                    }
</a><a href="#h14-0-98" id="h14-0-98" class="i">+                    synchronized(cachedRepoIndexes) {
</a><a href="#h14-0-99" id="h14-0-99" class="i">+                        cachedRepoIndexes.clear()
</a><a href="#h14-0-100" id="h14-0-100" class="i">+                        cachedRepoIndexes += it
</a><a href="#h14-0-101" id="h14-0-101" class="i">+                    }
</a><a href="#h14-0-102" id="h14-0-102" class="i">+                    cacheReloadDispatcher.dispatch()
</a><a href="#h14-0-103" id="h14-0-103" class="i">+                    delay(600)
</a><a href="#h14-0-104" id="h14-0-104" class="i">+                    isRefreshing = false
</a><a href="#h14-0-105" id="h14-0-105" class="i">+                }
</a><a href="#h14-0-106" id="h14-0-106" class="i">+            }
</a><a href="#h14-0-107" id="h14-0-107" class="i">+        }
</a><a href="#h14-0-108" id="h14-0-108" class="i">+    }
</a><a href="#h14-0-109" id="h14-0-109" class="i">+
</a><a href="#h14-0-110" id="h14-0-110" class="i">+    val installedThemes = rememberAsyncMutableStateList(defaultValue = listOf(), updateDispatcher = root.localReloadDispatcher, keys = arrayOf(cachedRepoIndexes)) {
</a><a href="#h14-0-111" id="h14-0-111" class="i">+        context.database.getThemeList()
</a><a href="#h14-0-112" id="h14-0-112" class="i">+    }
</a><a href="#h14-0-113" id="h14-0-113" class="i">+
</a><a href="#h14-0-114" id="h14-0-114" class="i">+    val remoteThemes by rememberAsyncMutableState(defaultValue = listOf(), updateDispatcher = cacheReloadDispatcher, keys = arrayOf(root.searchFilter.value)) {
</a><a href="#h14-0-115" id="h14-0-115" class="i">+        cachedRepoIndexes.entries.flatMap {
</a><a href="#h14-0-116" id="h14-0-116" class="i">+            it.value.themes.map { theme -&gt; it.key to theme }
</a><a href="#h14-0-117" id="h14-0-117" class="i">+        }.let {
</a><a href="#h14-0-118" id="h14-0-118" class="i">+            val filter = root.searchFilter.value
</a><a href="#h14-0-119" id="h14-0-119" class="i">+            if (filter.isNotBlank()) {
</a><a href="#h14-0-120" id="h14-0-120" class="i">+                it.filter { (_, theme) -&gt;
</a><a href="#h14-0-121" id="h14-0-121" class="i">+                    theme.name.contains(filter, ignoreCase = true) || theme.description?.contains(filter, ignoreCase = true) == true
</a><a href="#h14-0-122" id="h14-0-122" class="i">+                }
</a><a href="#h14-0-123" id="h14-0-123" class="i">+            } else it
</a><a href="#h14-0-124" id="h14-0-124" class="i">+        }
</a><a href="#h14-0-125" id="h14-0-125" class="i">+    }
</a><a href="#h14-0-126" id="h14-0-126" class="i">+
</a><a href="#h14-0-127" id="h14-0-127" class="i">+    LaunchedEffect(Unit) {
</a><a href="#h14-0-128" id="h14-0-128" class="i">+        if (cachedRepoIndexes.isNotEmpty()) return@LaunchedEffect
</a><a href="#h14-0-129" id="h14-0-129" class="i">+        isRefreshing = true
</a><a href="#h14-0-130" id="h14-0-130" class="i">+        coroutineScope.launch {
</a><a href="#h14-0-131" id="h14-0-131" class="i">+            refreshCachedIndexes()
</a><a href="#h14-0-132" id="h14-0-132" class="i">+        }
</a><a href="#h14-0-133" id="h14-0-133" class="i">+    }
</a><a href="#h14-0-134" id="h14-0-134" class="i">+
</a><a href="#h14-0-135" id="h14-0-135" class="i">+    val pullRefreshState = rememberPullRefreshState(isRefreshing, onRefresh = {
</a><a href="#h14-0-136" id="h14-0-136" class="i">+        coroutineScope.launch {
</a><a href="#h14-0-137" id="h14-0-137" class="i">+            refreshCachedIndexes()
</a><a href="#h14-0-138" id="h14-0-138" class="i">+        }
</a><a href="#h14-0-139" id="h14-0-139" class="i">+    })
</a><a href="#h14-0-140" id="h14-0-140" class="i">+
</a><a href="#h14-0-141" id="h14-0-141" class="i">+    Box(
</a><a href="#h14-0-142" id="h14-0-142" class="i">+        modifier = Modifier.fillMaxSize()
</a><a href="#h14-0-143" id="h14-0-143" class="i">+    ) {
</a><a href="#h14-0-144" id="h14-0-144" class="i">+        LazyColumn(
</a><a href="#h14-0-145" id="h14-0-145" class="i">+            modifier = Modifier
</a><a href="#h14-0-146" id="h14-0-146" class="i">+                .fillMaxSize()
</a><a href="#h14-0-147" id="h14-0-147" class="i">+                .pullRefresh(pullRefreshState),
</a><a href="#h14-0-148" id="h14-0-148" class="i">+            contentPadding = PaddingValues(8.dp)
</a><a href="#h14-0-149" id="h14-0-149" class="i">+        ) {
</a><a href="#h14-0-150" id="h14-0-150" class="i">+            item {
</a><a href="#h14-0-151" id="h14-0-151" class="i">+                if (remoteThemes.isEmpty()) {
</a><a href="#h14-0-152" id="h14-0-152" class="i">+                    Text(
</a><a href="#h14-0-153" id="h14-0-153" class="i">+                        text = &quot;No themes available&quot;,
</a><a href="#h14-0-154" id="h14-0-154" class="i">+                        modifier = Modifier
</a><a href="#h14-0-155" id="h14-0-155" class="i">+                            .padding(16.dp)
</a><a href="#h14-0-156" id="h14-0-156" class="i">+                            .fillMaxWidth(),
</a><a href="#h14-0-157" id="h14-0-157" class="i">+                        textAlign = TextAlign.Center,
</a><a href="#h14-0-158" id="h14-0-158" class="i">+                        fontSize = 15.sp,
</a><a href="#h14-0-159" id="h14-0-159" class="i">+                        fontWeight = FontWeight.Light
</a><a href="#h14-0-160" id="h14-0-160" class="i">+                    )
</a><a href="#h14-0-161" id="h14-0-161" class="i">+                }
</a><a href="#h14-0-162" id="h14-0-162" class="i">+            }
</a><a href="#h14-0-163" id="h14-0-163" class="i">+            items(remoteThemes, key = { it.first + it.second.hashCode() }) { (_, themeManifest) -&gt;
</a><a href="#h14-0-164" id="h14-0-164" class="i">+                val themeUri = remember {
</a><a href="#h14-0-165" id="h14-0-165" class="i">+                    cachedRepoIndexes.entries.find { it.value.themes.contains(themeManifest) }?.key?.toUri()?.buildUpon()?.appendPath(themeManifest.filepath)?.build()
</a><a href="#h14-0-166" id="h14-0-166" class="i">+                }
</a><a href="#h14-0-167" id="h14-0-167" class="i">+
</a><a href="#h14-0-168" id="h14-0-168" class="i">+                val hasUpdate by rememberAsyncMutableState(defaultValue = false, keys = arrayOf(themeManifest)) {
</a><a href="#h14-0-169" id="h14-0-169" class="i">+                    installedThemes.takeIf { themeUri != null }?.find { it.updateUrl == themeUri.toString() }?.let { installedTheme -&gt;
</a><a href="#h14-0-170" id="h14-0-170" class="i">+                        installedTheme.version != themeManifest.version
</a><a href="#h14-0-171" id="h14-0-171" class="i">+                    } ?: false
</a><a href="#h14-0-172" id="h14-0-172" class="i">+                }
</a><a href="#h14-0-173" id="h14-0-173" class="i">+
</a><a href="#h14-0-174" id="h14-0-174" class="i">+                var isInstalling by rememberAsyncMutableState(defaultValue = false, keys = arrayOf(themeManifest)) {
</a><a href="#h14-0-175" id="h14-0-175" class="i">+                    false
</a><a href="#h14-0-176" id="h14-0-176" class="i">+                }
</a><a href="#h14-0-177" id="h14-0-177" class="i">+
</a><a href="#h14-0-178" id="h14-0-178" class="i">+                var isInstalled by rememberAsyncMutableState(defaultValue = true, keys = arrayOf(themeManifest)) {
</a><a href="#h14-0-179" id="h14-0-179" class="i">+                    context.database.getThemeIdByUpdateUrl(themeUri.toString()) != null
</a><a href="#h14-0-180" id="h14-0-180" class="i">+                }
</a><a href="#h14-0-181" id="h14-0-181" class="i">+
</a><a href="#h14-0-182" id="h14-0-182" class="i">+                ElevatedCard(onClick = {
</a><a href="#h14-0-183" id="h14-0-183" class="i">+                    //TODO: Show theme details
</a><a href="#h14-0-184" id="h14-0-184" class="i">+                }) {
</a><a href="#h14-0-185" id="h14-0-185" class="i">+                    Row(
</a><a href="#h14-0-186" id="h14-0-186" class="i">+                        modifier = Modifier
</a><a href="#h14-0-187" id="h14-0-187" class="i">+                            .fillMaxWidth()
</a><a href="#h14-0-188" id="h14-0-188" class="i">+                            .padding(8.dp),
</a><a href="#h14-0-189" id="h14-0-189" class="i">+                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h14-0-190" id="h14-0-190" class="i">+                    ) {
</a><a href="#h14-0-191" id="h14-0-191" class="i">+                        Icon(Icons.Default.Palette, contentDescription = null, modifier = Modifier.padding(16.dp))
</a><a href="#h14-0-192" id="h14-0-192" class="i">+                        Column(
</a><a href="#h14-0-193" id="h14-0-193" class="i">+                            modifier = Modifier.weight(1f),
</a><a href="#h14-0-194" id="h14-0-194" class="i">+                            verticalArrangement = Arrangement.Center
</a><a href="#h14-0-195" id="h14-0-195" class="i">+                        ) {
</a><a href="#h14-0-196" id="h14-0-196" class="i">+                            Row(
</a><a href="#h14-0-197" id="h14-0-197" class="i">+                                horizontalArrangement = Arrangement.spacedBy(4.dp),
</a><a href="#h14-0-198" id="h14-0-198" class="i">+                                verticalAlignment = Alignment.Bottom
</a><a href="#h14-0-199" id="h14-0-199" class="i">+                            ) {
</a><a href="#h14-0-200" id="h14-0-200" class="i">+                                Text(
</a><a href="#h14-0-201" id="h14-0-201" class="i">+                                    text = themeManifest.name,
</a><a href="#h14-0-202" id="h14-0-202" class="i">+                                    maxLines = 1,
</a><a href="#h14-0-203" id="h14-0-203" class="i">+                                    overflow = TextOverflow.Ellipsis,
</a><a href="#h14-0-204" id="h14-0-204" class="i">+                                )
</a><a href="#h14-0-205" id="h14-0-205" class="i">+                                themeManifest.author?.let {
</a><a href="#h14-0-206" id="h14-0-206" class="i">+                                    Text(
</a><a href="#h14-0-207" id="h14-0-207" class="i">+                                        text = &quot;by $it&quot;,
</a><a href="#h14-0-208" id="h14-0-208" class="i">+                                        maxLines = 1,
</a><a href="#h14-0-209" id="h14-0-209" class="i">+                                        fontSize = 10.sp,
</a><a href="#h14-0-210" id="h14-0-210" class="i">+                                        fontWeight = FontWeight.Light,
</a><a href="#h14-0-211" id="h14-0-211" class="i">+                                        overflow = TextOverflow.Ellipsis,
</a><a href="#h14-0-212" id="h14-0-212" class="i">+                                    )
</a><a href="#h14-0-213" id="h14-0-213" class="i">+                                }
</a><a href="#h14-0-214" id="h14-0-214" class="i">+                            }
</a><a href="#h14-0-215" id="h14-0-215" class="i">+                            themeManifest.description?.let {
</a><a href="#h14-0-216" id="h14-0-216" class="i">+                                Text(
</a><a href="#h14-0-217" id="h14-0-217" class="i">+                                    text = it,
</a><a href="#h14-0-218" id="h14-0-218" class="i">+                                    fontSize = 12.sp,
</a><a href="#h14-0-219" id="h14-0-219" class="i">+                                    maxLines = 3,
</a><a href="#h14-0-220" id="h14-0-220" class="i">+                                    overflow = TextOverflow.Ellipsis,
</a><a href="#h14-0-221" id="h14-0-221" class="i">+                                )
</a><a href="#h14-0-222" id="h14-0-222" class="i">+                            }
</a><a href="#h14-0-223" id="h14-0-223" class="i">+                            if (hasUpdate) {
</a><a href="#h14-0-224" id="h14-0-224" class="i">+                                Text(
</a><a href="#h14-0-225" id="h14-0-225" class="i">+                                    text = &quot;Version ${themeManifest.version} available&quot;,
</a><a href="#h14-0-226" id="h14-0-226" class="i">+                                    fontWeight = FontWeight.Bold
</a><a href="#h14-0-227" id="h14-0-227" class="i">+                                )
</a><a href="#h14-0-228" id="h14-0-228" class="i">+                            }
</a><a href="#h14-0-229" id="h14-0-229" class="i">+                        }
</a><a href="#h14-0-230" id="h14-0-230" class="i">+                        Row(
</a><a href="#h14-0-231" id="h14-0-231" class="i">+                            verticalAlignment = Alignment.CenterVertically
</a><a href="#h14-0-232" id="h14-0-232" class="i">+                        ) {
</a><a href="#h14-0-233" id="h14-0-233" class="i">+                            if (isInstalling) {
</a><a href="#h14-0-234" id="h14-0-234" class="i">+                                CircularProgressIndicator(modifier = Modifier.size(24.dp), strokeWidth = 2.dp)
</a><a href="#h14-0-235" id="h14-0-235" class="i">+                            } else {
</a><a href="#h14-0-236" id="h14-0-236" class="i">+                                Button(
</a><a href="#h14-0-237" id="h14-0-237" class="i">+                                    enabled = !isInstalled || hasUpdate,
</a><a href="#h14-0-238" id="h14-0-238" class="i">+                                    onClick = {
</a><a href="#h14-0-239" id="h14-0-239" class="i">+                                        isInstalling = true
</a><a href="#h14-0-240" id="h14-0-240" class="i">+                                        context.coroutineScope.launch {
</a><a href="#h14-0-241" id="h14-0-241" class="i">+                                            runCatching {
</a><a href="#h14-0-242" id="h14-0-242" class="i">+                                                installTheme(themeUri ?: throw IllegalStateException(&quot;Failed to get theme URI&quot;))
</a><a href="#h14-0-243" id="h14-0-243" class="i">+                                                isInstalled = true
</a><a href="#h14-0-244" id="h14-0-244" class="i">+                                            }.onFailure {
</a><a href="#h14-0-245" id="h14-0-245" class="i">+                                                context.log.error(&quot;Failed to install theme ${themeManifest.name}&quot;, it)
</a><a href="#h14-0-246" id="h14-0-246" class="i">+                                                context.shortToast(&quot;Failed to install theme ${themeManifest.name}. ${it.message}&quot;)
</a><a href="#h14-0-247" id="h14-0-247" class="i">+                                            }
</a><a href="#h14-0-248" id="h14-0-248" class="i">+                                            isInstalling = false
</a><a href="#h14-0-249" id="h14-0-249" class="i">+                                        }
</a><a href="#h14-0-250" id="h14-0-250" class="i">+                                    }
</a><a href="#h14-0-251" id="h14-0-251" class="i">+                                ) {
</a><a href="#h14-0-252" id="h14-0-252" class="i">+                                    if (hasUpdate) {
</a><a href="#h14-0-253" id="h14-0-253" class="i">+                                        Text(&quot;Update&quot;)
</a><a href="#h14-0-254" id="h14-0-254" class="i">+                                    } else {
</a><a href="#h14-0-255" id="h14-0-255" class="i">+                                        Text(if (isInstalled) &quot;Installed&quot; else &quot;Install&quot;)
</a><a href="#h14-0-256" id="h14-0-256" class="i">+                                    }
</a><a href="#h14-0-257" id="h14-0-257" class="i">+                                }
</a><a href="#h14-0-258" id="h14-0-258" class="i">+                            }
</a><a href="#h14-0-259" id="h14-0-259" class="i">+                        }
</a><a href="#h14-0-260" id="h14-0-260" class="i">+                    }
</a><a href="#h14-0-261" id="h14-0-261" class="i">+                }
</a><a href="#h14-0-262" id="h14-0-262" class="i">+            }
</a><a href="#h14-0-263" id="h14-0-263" class="i">+        }
</a><a href="#h14-0-264" id="h14-0-264" class="i">+
</a><a href="#h14-0-265" id="h14-0-265" class="i">+        PullRefreshIndicator(
</a><a href="#h14-0-266" id="h14-0-266" class="i">+            refreshing = isRefreshing,
</a><a href="#h14-0-267" id="h14-0-267" class="i">+            state = pullRefreshState,
</a><a href="#h14-0-268" id="h14-0-268" class="i">+            modifier = Modifier.align(Alignment.TopCenter)
</a><a href="#h14-0-269" id="h14-0-269" class="i">+        )
</a><a href="#h14-0-270" id="h14-0-270" class="i">+    }
</a><a href="#h14-0-271" id="h14-0-271" class="i">+}</a><a href="#h14-0-272" id="h14-0-272" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/theming/ThemingRoot.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,463 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages.theming
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+import androidx.compose.foundation.ExperimentalFoundationApi
</a><a href="#h15-0-3" id="h15-0-3" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h15-0-4" id="h15-0-4" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h15-0-5" id="h15-0-5" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h15-0-6" id="h15-0-6" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h15-0-7" id="h15-0-7" class="i">+import androidx.compose.foundation.pager.HorizontalPager
</a><a href="#h15-0-8" id="h15-0-8" class="i">+import androidx.compose.foundation.pager.rememberPagerState
</a><a href="#h15-0-9" id="h15-0-9" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h15-0-10" id="h15-0-10" class="i">+import androidx.compose.material.icons.filled.*
</a><a href="#h15-0-11" id="h15-0-11" class="i">+import androidx.compose.material3.*
</a><a href="#h15-0-12" id="h15-0-12" class="i">+import androidx.compose.runtime.*
</a><a href="#h15-0-13" id="h15-0-13" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h15-0-14" id="h15-0-14" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h15-0-15" id="h15-0-15" class="i">+import androidx.compose.ui.focus.FocusRequester
</a><a href="#h15-0-16" id="h15-0-16" class="i">+import androidx.compose.ui.focus.focusRequester
</a><a href="#h15-0-17" id="h15-0-17" class="i">+import androidx.compose.ui.layout.onGloballyPositioned
</a><a href="#h15-0-18" id="h15-0-18" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h15-0-19" id="h15-0-19" class="i">+import androidx.compose.ui.text.style.TextAlign
</a><a href="#h15-0-20" id="h15-0-20" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h15-0-21" id="h15-0-21" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h15-0-22" id="h15-0-22" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h15-0-23" id="h15-0-23" class="i">+import androidx.core.net.toUri
</a><a href="#h15-0-24" id="h15-0-24" class="i">+import androidx.navigation.NavBackStackEntry
</a><a href="#h15-0-25" id="h15-0-25" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h15-0-26" id="h15-0-26" class="i">+import kotlinx.coroutines.launch
</a><a href="#h15-0-27" id="h15-0-27" class="i">+import kotlinx.coroutines.withContext
</a><a href="#h15-0-28" id="h15-0-28" class="i">+import me.rhunk.snapenhance.common.data.DatabaseTheme
</a><a href="#h15-0-29" id="h15-0-29" class="i">+import me.rhunk.snapenhance.common.data.DatabaseThemeContent
</a><a href="#h15-0-30" id="h15-0-30" class="i">+import me.rhunk.snapenhance.common.data.ExportedTheme
</a><a href="#h15-0-31" id="h15-0-31" class="i">+import me.rhunk.snapenhance.common.ui.AsyncUpdateDispatcher
</a><a href="#h15-0-32" id="h15-0-32" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h15-0-33" id="h15-0-33" class="i">+import me.rhunk.snapenhance.common.ui.transparentTextFieldColors
</a><a href="#h15-0-34" id="h15-0-34" class="i">+import me.rhunk.snapenhance.common.util.ktx.getUrlFromClipboard
</a><a href="#h15-0-35" id="h15-0-35" class="i">+import me.rhunk.snapenhance.storage.*
</a><a href="#h15-0-36" id="h15-0-36" class="i">+import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h15-0-37" id="h15-0-37" class="i">+import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
</a><a href="#h15-0-38" id="h15-0-38" class="i">+import me.rhunk.snapenhance.ui.util.openFile
</a><a href="#h15-0-39" id="h15-0-39" class="i">+import me.rhunk.snapenhance.ui.util.pagerTabIndicatorOffset
</a><a href="#h15-0-40" id="h15-0-40" class="i">+import me.rhunk.snapenhance.ui.util.saveFile
</a><a href="#h15-0-41" id="h15-0-41" class="i">+import okhttp3.OkHttpClient
</a><a href="#h15-0-42" id="h15-0-42" class="i">+
</a><a href="#h15-0-43" id="h15-0-43" class="i">+class ThemingRoot: Routes.Route() {
</a><a href="#h15-0-44" id="h15-0-44" class="i">+    val localReloadDispatcher = AsyncUpdateDispatcher()
</a><a href="#h15-0-45" id="h15-0-45" class="i">+    private lateinit var activityLauncherHelper: ActivityLauncherHelper
</a><a href="#h15-0-46" id="h15-0-46" class="i">+
</a><a href="#h15-0-47" id="h15-0-47" class="i">+    private var currentPage by mutableIntStateOf(0)
</a><a href="#h15-0-48" id="h15-0-48" class="i">+    val okHttpClient by lazy { OkHttpClient() }
</a><a href="#h15-0-49" id="h15-0-49" class="i">+    val searchFilter = mutableStateOf(&quot;&quot;)
</a><a href="#h15-0-50" id="h15-0-50" class="i">+
</a><a href="#h15-0-51" id="h15-0-51" class="i">+
</a><a href="#h15-0-52" id="h15-0-52" class="i">+    private fun exportTheme(theme: DatabaseTheme) {
</a><a href="#h15-0-53" id="h15-0-53" class="i">+        context.coroutineScope.launch {
</a><a href="#h15-0-54" id="h15-0-54" class="i">+            val exportedTheme = theme.toExportedTheme(context.database.getThemeContent(theme.id) ?: DatabaseThemeContent())
</a><a href="#h15-0-55" id="h15-0-55" class="i">+
</a><a href="#h15-0-56" id="h15-0-56" class="i">+            activityLauncherHelper.saveFile(theme.name.replace(&quot; &quot;, &quot;_&quot;).lowercase() + &quot;.json&quot;) { uri -&gt;
</a><a href="#h15-0-57" id="h15-0-57" class="i">+                runCatching {
</a><a href="#h15-0-58" id="h15-0-58" class="i">+                    context.androidContext.contentResolver.openOutputStream(uri.toUri())?.use { outputStream -&gt;
</a><a href="#h15-0-59" id="h15-0-59" class="i">+                        outputStream.write(context.gson.toJson(exportedTheme).toByteArray())
</a><a href="#h15-0-60" id="h15-0-60" class="i">+                        outputStream.flush()
</a><a href="#h15-0-61" id="h15-0-61" class="i">+                    }
</a><a href="#h15-0-62" id="h15-0-62" class="i">+                    context.shortToast(&quot;Theme exported successfully&quot;)
</a><a href="#h15-0-63" id="h15-0-63" class="i">+                }.onFailure {
</a><a href="#h15-0-64" id="h15-0-64" class="i">+                    context.log.error(&quot;Failed to save theme&quot;, it)
</a><a href="#h15-0-65" id="h15-0-65" class="i">+                    context.longToast(&quot;Failed to export theme! Check logs for more details&quot;)
</a><a href="#h15-0-66" id="h15-0-66" class="i">+                }
</a><a href="#h15-0-67" id="h15-0-67" class="i">+            }
</a><a href="#h15-0-68" id="h15-0-68" class="i">+        }
</a><a href="#h15-0-69" id="h15-0-69" class="i">+    }
</a><a href="#h15-0-70" id="h15-0-70" class="i">+
</a><a href="#h15-0-71" id="h15-0-71" class="i">+    private fun duplicateTheme(theme: DatabaseTheme) {
</a><a href="#h15-0-72" id="h15-0-72" class="i">+        context.coroutineScope.launch {
</a><a href="#h15-0-73" id="h15-0-73" class="i">+            val themeId = context.database.addOrUpdateTheme(theme.copy(
</a><a href="#h15-0-74" id="h15-0-74" class="i">+                updateUrl = null
</a><a href="#h15-0-75" id="h15-0-75" class="i">+            ))
</a><a href="#h15-0-76" id="h15-0-76" class="i">+            context.database.setThemeContent(themeId, context.database.getThemeContent(theme.id) ?: DatabaseThemeContent())
</a><a href="#h15-0-77" id="h15-0-77" class="i">+            context.shortToast(&quot;Theme duplicated successfully&quot;)
</a><a href="#h15-0-78" id="h15-0-78" class="i">+            withContext(Dispatchers.Main) {
</a><a href="#h15-0-79" id="h15-0-79" class="i">+                localReloadDispatcher.dispatch()
</a><a href="#h15-0-80" id="h15-0-80" class="i">+            }
</a><a href="#h15-0-81" id="h15-0-81" class="i">+        }
</a><a href="#h15-0-82" id="h15-0-82" class="i">+    }
</a><a href="#h15-0-83" id="h15-0-83" class="i">+
</a><a href="#h15-0-84" id="h15-0-84" class="i">+    suspend fun importTheme(content: String, updateUrl: String? = null) {
</a><a href="#h15-0-85" id="h15-0-85" class="i">+        val theme = context.gson.fromJson(content, ExportedTheme::class.java)
</a><a href="#h15-0-86" id="h15-0-86" class="i">+        val existingTheme = updateUrl?.let {
</a><a href="#h15-0-87" id="h15-0-87" class="i">+            context.database.getThemeIdByUpdateUrl(it)
</a><a href="#h15-0-88" id="h15-0-88" class="i">+        }?.let {
</a><a href="#h15-0-89" id="h15-0-89" class="i">+            context.database.getThemeInfo(it)
</a><a href="#h15-0-90" id="h15-0-90" class="i">+        }
</a><a href="#h15-0-91" id="h15-0-91" class="i">+        val databaseTheme = theme.toDatabaseTheme(
</a><a href="#h15-0-92" id="h15-0-92" class="i">+            updateUrl = updateUrl,
</a><a href="#h15-0-93" id="h15-0-93" class="i">+            enabled = existingTheme?.enabled ?: false
</a><a href="#h15-0-94" id="h15-0-94" class="i">+        )
</a><a href="#h15-0-95" id="h15-0-95" class="i">+
</a><a href="#h15-0-96" id="h15-0-96" class="i">+        val themeId = context.database.addOrUpdateTheme(
</a><a href="#h15-0-97" id="h15-0-97" class="i">+            themeId = existingTheme?.id,
</a><a href="#h15-0-98" id="h15-0-98" class="i">+            theme = databaseTheme
</a><a href="#h15-0-99" id="h15-0-99" class="i">+        )
</a><a href="#h15-0-100" id="h15-0-100" class="i">+
</a><a href="#h15-0-101" id="h15-0-101" class="i">+        context.database.setThemeContent(themeId, theme.content)
</a><a href="#h15-0-102" id="h15-0-102" class="i">+        context.shortToast(&quot;Theme imported successfully&quot;)
</a><a href="#h15-0-103" id="h15-0-103" class="i">+        withContext(Dispatchers.Main) {
</a><a href="#h15-0-104" id="h15-0-104" class="i">+            localReloadDispatcher.dispatch()
</a><a href="#h15-0-105" id="h15-0-105" class="i">+        }
</a><a href="#h15-0-106" id="h15-0-106" class="i">+    }
</a><a href="#h15-0-107" id="h15-0-107" class="i">+
</a><a href="#h15-0-108" id="h15-0-108" class="i">+    private fun importTheme() {
</a><a href="#h15-0-109" id="h15-0-109" class="i">+        activityLauncherHelper.openFile { uri -&gt;
</a><a href="#h15-0-110" id="h15-0-110" class="i">+            context.coroutineScope.launch {
</a><a href="#h15-0-111" id="h15-0-111" class="i">+                runCatching {
</a><a href="#h15-0-112" id="h15-0-112" class="i">+                    val themeJson = context.androidContext.contentResolver.openInputStream(uri.toUri())?.bufferedReader().use {
</a><a href="#h15-0-113" id="h15-0-113" class="i">+                        it?.readText()
</a><a href="#h15-0-114" id="h15-0-114" class="i">+                    } ?: throw Exception(&quot;Failed to read file&quot;)
</a><a href="#h15-0-115" id="h15-0-115" class="i">+
</a><a href="#h15-0-116" id="h15-0-116" class="i">+                    importTheme(themeJson)
</a><a href="#h15-0-117" id="h15-0-117" class="i">+                }.onFailure {
</a><a href="#h15-0-118" id="h15-0-118" class="i">+                    context.log.error(&quot;Failed to import theme&quot;, it)
</a><a href="#h15-0-119" id="h15-0-119" class="i">+                    context.longToast(&quot;Failed to import theme! Check logs for more details&quot;)
</a><a href="#h15-0-120" id="h15-0-120" class="i">+                }
</a><a href="#h15-0-121" id="h15-0-121" class="i">+            }
</a><a href="#h15-0-122" id="h15-0-122" class="i">+        }
</a><a href="#h15-0-123" id="h15-0-123" class="i">+    }
</a><a href="#h15-0-124" id="h15-0-124" class="i">+
</a><a href="#h15-0-125" id="h15-0-125" class="i">+    private suspend fun importFromURL(url: String) {
</a><a href="#h15-0-126" id="h15-0-126" class="i">+        val result = okHttpClient.newCall(
</a><a href="#h15-0-127" id="h15-0-127" class="i">+            okhttp3.Request.Builder()
</a><a href="#h15-0-128" id="h15-0-128" class="i">+                .url(url)
</a><a href="#h15-0-129" id="h15-0-129" class="i">+                .build()
</a><a href="#h15-0-130" id="h15-0-130" class="i">+        ).execute()
</a><a href="#h15-0-131" id="h15-0-131" class="i">+
</a><a href="#h15-0-132" id="h15-0-132" class="i">+        if (!result.isSuccessful) {
</a><a href="#h15-0-133" id="h15-0-133" class="i">+            throw Exception(&quot;Failed to fetch theme from URL ${result.message}&quot;)
</a><a href="#h15-0-134" id="h15-0-134" class="i">+        }
</a><a href="#h15-0-135" id="h15-0-135" class="i">+
</a><a href="#h15-0-136" id="h15-0-136" class="i">+        importTheme(result.body.string(), url)
</a><a href="#h15-0-137" id="h15-0-137" class="i">+    }
</a><a href="#h15-0-138" id="h15-0-138" class="i">+
</a><a href="#h15-0-139" id="h15-0-139" class="i">+    override val init: () -&gt; Unit = {
</a><a href="#h15-0-140" id="h15-0-140" class="i">+        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h15-0-141" id="h15-0-141" class="i">+    }
</a><a href="#h15-0-142" id="h15-0-142" class="i">+
</a><a href="#h15-0-143" id="h15-0-143" class="i">+    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = {
</a><a href="#h15-0-144" id="h15-0-144" class="i">+        var showSearchBar by remember { mutableStateOf(false) }
</a><a href="#h15-0-145" id="h15-0-145" class="i">+        val focusRequester = remember { FocusRequester() }
</a><a href="#h15-0-146" id="h15-0-146" class="i">+
</a><a href="#h15-0-147" id="h15-0-147" class="i">+        Row(
</a><a href="#h15-0-148" id="h15-0-148" class="i">+            verticalAlignment = Alignment.CenterVertically
</a><a href="#h15-0-149" id="h15-0-149" class="i">+        ) {
</a><a href="#h15-0-150" id="h15-0-150" class="i">+            if (showSearchBar) {
</a><a href="#h15-0-151" id="h15-0-151" class="i">+                OutlinedTextField(
</a><a href="#h15-0-152" id="h15-0-152" class="i">+                    value = searchFilter.value,
</a><a href="#h15-0-153" id="h15-0-153" class="i">+                    onValueChange = { searchFilter.value = it },
</a><a href="#h15-0-154" id="h15-0-154" class="i">+                    placeholder = { Text(&quot;Search&quot;) },
</a><a href="#h15-0-155" id="h15-0-155" class="i">+                    modifier = Modifier
</a><a href="#h15-0-156" id="h15-0-156" class="i">+                        .weight(1f)
</a><a href="#h15-0-157" id="h15-0-157" class="i">+                        .focusRequester(focusRequester)
</a><a href="#h15-0-158" id="h15-0-158" class="i">+                        .onGloballyPositioned {
</a><a href="#h15-0-159" id="h15-0-159" class="i">+                            focusRequester.requestFocus()
</a><a href="#h15-0-160" id="h15-0-160" class="i">+                        },
</a><a href="#h15-0-161" id="h15-0-161" class="i">+                    colors = transparentTextFieldColors()
</a><a href="#h15-0-162" id="h15-0-162" class="i">+                )
</a><a href="#h15-0-163" id="h15-0-163" class="i">+                DisposableEffect(Unit) {
</a><a href="#h15-0-164" id="h15-0-164" class="i">+                    onDispose {
</a><a href="#h15-0-165" id="h15-0-165" class="i">+                        searchFilter.value = &quot;&quot;
</a><a href="#h15-0-166" id="h15-0-166" class="i">+                    }
</a><a href="#h15-0-167" id="h15-0-167" class="i">+                }
</a><a href="#h15-0-168" id="h15-0-168" class="i">+            }
</a><a href="#h15-0-169" id="h15-0-169" class="i">+            IconButton(onClick = {
</a><a href="#h15-0-170" id="h15-0-170" class="i">+                showSearchBar = !showSearchBar
</a><a href="#h15-0-171" id="h15-0-171" class="i">+            }) {
</a><a href="#h15-0-172" id="h15-0-172" class="i">+                Icon(if (showSearchBar) Icons.Default.Close else Icons.Default.Search, contentDescription = null)
</a><a href="#h15-0-173" id="h15-0-173" class="i">+            }
</a><a href="#h15-0-174" id="h15-0-174" class="i">+        }
</a><a href="#h15-0-175" id="h15-0-175" class="i">+    }
</a><a href="#h15-0-176" id="h15-0-176" class="i">+
</a><a href="#h15-0-177" id="h15-0-177" class="i">+    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h15-0-178" id="h15-0-178" class="i">+        var showImportFromUrlDialog by remember { mutableStateOf(false) }
</a><a href="#h15-0-179" id="h15-0-179" class="i">+
</a><a href="#h15-0-180" id="h15-0-180" class="i">+        if (showImportFromUrlDialog) {
</a><a href="#h15-0-181" id="h15-0-181" class="i">+            var url by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h15-0-182" id="h15-0-182" class="i">+            var loading by remember { mutableStateOf(false) }
</a><a href="#h15-0-183" id="h15-0-183" class="i">+
</a><a href="#h15-0-184" id="h15-0-184" class="i">+            AlertDialog(
</a><a href="#h15-0-185" id="h15-0-185" class="i">+                onDismissRequest = { showImportFromUrlDialog = false },
</a><a href="#h15-0-186" id="h15-0-186" class="i">+                title = { Text(&quot;Import theme from URL&quot;) },
</a><a href="#h15-0-187" id="h15-0-187" class="i">+                text = {
</a><a href="#h15-0-188" id="h15-0-188" class="i">+                    val focusRequester = remember { FocusRequester() }
</a><a href="#h15-0-189" id="h15-0-189" class="i">+                    TextField(
</a><a href="#h15-0-190" id="h15-0-190" class="i">+                        value = url,
</a><a href="#h15-0-191" id="h15-0-191" class="i">+                        onValueChange = { url = it },
</a><a href="#h15-0-192" id="h15-0-192" class="i">+                        label = { Text(&quot;URL&quot;) },
</a><a href="#h15-0-193" id="h15-0-193" class="i">+                        modifier = Modifier
</a><a href="#h15-0-194" id="h15-0-194" class="i">+                            .fillMaxWidth()
</a><a href="#h15-0-195" id="h15-0-195" class="i">+                            .focusRequester(focusRequester)
</a><a href="#h15-0-196" id="h15-0-196" class="i">+                            .onGloballyPositioned {
</a><a href="#h15-0-197" id="h15-0-197" class="i">+                                focusRequester.requestFocus()
</a><a href="#h15-0-198" id="h15-0-198" class="i">+                            }
</a><a href="#h15-0-199" id="h15-0-199" class="i">+                    )
</a><a href="#h15-0-200" id="h15-0-200" class="i">+                    LaunchedEffect(Unit) {
</a><a href="#h15-0-201" id="h15-0-201" class="i">+                        context.androidContext.getUrlFromClipboard()?.let {
</a><a href="#h15-0-202" id="h15-0-202" class="i">+                            url = it
</a><a href="#h15-0-203" id="h15-0-203" class="i">+                        }
</a><a href="#h15-0-204" id="h15-0-204" class="i">+                    }
</a><a href="#h15-0-205" id="h15-0-205" class="i">+                },
</a><a href="#h15-0-206" id="h15-0-206" class="i">+                confirmButton = {
</a><a href="#h15-0-207" id="h15-0-207" class="i">+                    Button(
</a><a href="#h15-0-208" id="h15-0-208" class="i">+                        enabled = url.isNotBlank() &amp;&amp; !loading,
</a><a href="#h15-0-209" id="h15-0-209" class="i">+                        onClick = {
</a><a href="#h15-0-210" id="h15-0-210" class="i">+                            loading = true
</a><a href="#h15-0-211" id="h15-0-211" class="i">+                            context.coroutineScope.launch {
</a><a href="#h15-0-212" id="h15-0-212" class="i">+                                runCatching {
</a><a href="#h15-0-213" id="h15-0-213" class="i">+                                    importFromURL(url)
</a><a href="#h15-0-214" id="h15-0-214" class="i">+                                    withContext(Dispatchers.Main) {
</a><a href="#h15-0-215" id="h15-0-215" class="i">+                                        showImportFromUrlDialog = false
</a><a href="#h15-0-216" id="h15-0-216" class="i">+                                    }
</a><a href="#h15-0-217" id="h15-0-217" class="i">+                                }.onFailure {
</a><a href="#h15-0-218" id="h15-0-218" class="i">+                                    context.log.error(&quot;Failed to import theme&quot;, it)
</a><a href="#h15-0-219" id="h15-0-219" class="i">+                                    context.longToast(&quot;Failed to import theme! ${it.message}&quot;)
</a><a href="#h15-0-220" id="h15-0-220" class="i">+                                }
</a><a href="#h15-0-221" id="h15-0-221" class="i">+                                withContext(Dispatchers.Main) {
</a><a href="#h15-0-222" id="h15-0-222" class="i">+                                    loading = false
</a><a href="#h15-0-223" id="h15-0-223" class="i">+                                }
</a><a href="#h15-0-224" id="h15-0-224" class="i">+                            }
</a><a href="#h15-0-225" id="h15-0-225" class="i">+                        },
</a><a href="#h15-0-226" id="h15-0-226" class="i">+                        modifier = Modifier.fillMaxWidth()
</a><a href="#h15-0-227" id="h15-0-227" class="i">+                    ) {
</a><a href="#h15-0-228" id="h15-0-228" class="i">+                        Text(&quot;Import&quot;)
</a><a href="#h15-0-229" id="h15-0-229" class="i">+                    }
</a><a href="#h15-0-230" id="h15-0-230" class="i">+                }
</a><a href="#h15-0-231" id="h15-0-231" class="i">+            )
</a><a href="#h15-0-232" id="h15-0-232" class="i">+        }
</a><a href="#h15-0-233" id="h15-0-233" class="i">+        Column(
</a><a href="#h15-0-234" id="h15-0-234" class="i">+            horizontalAlignment = Alignment.End
</a><a href="#h15-0-235" id="h15-0-235" class="i">+        ) {
</a><a href="#h15-0-236" id="h15-0-236" class="i">+            when (currentPage) {
</a><a href="#h15-0-237" id="h15-0-237" class="i">+                0 -&gt; {
</a><a href="#h15-0-238" id="h15-0-238" class="i">+                    ExtendedFloatingActionButton(
</a><a href="#h15-0-239" id="h15-0-239" class="i">+                        onClick = {
</a><a href="#h15-0-240" id="h15-0-240" class="i">+                            routes.editTheme.navigate()
</a><a href="#h15-0-241" id="h15-0-241" class="i">+                        },
</a><a href="#h15-0-242" id="h15-0-242" class="i">+                        icon = {
</a><a href="#h15-0-243" id="h15-0-243" class="i">+                            Icon(Icons.Default.Add, contentDescription = null)
</a><a href="#h15-0-244" id="h15-0-244" class="i">+                        },
</a><a href="#h15-0-245" id="h15-0-245" class="i">+                        text = {
</a><a href="#h15-0-246" id="h15-0-246" class="i">+                            Text(&quot;New theme&quot;)
</a><a href="#h15-0-247" id="h15-0-247" class="i">+                        }
</a><a href="#h15-0-248" id="h15-0-248" class="i">+                    )
</a><a href="#h15-0-249" id="h15-0-249" class="i">+                    Spacer(modifier = Modifier.height(8.dp))
</a><a href="#h15-0-250" id="h15-0-250" class="i">+                    ExtendedFloatingActionButton(
</a><a href="#h15-0-251" id="h15-0-251" class="i">+                        onClick = {
</a><a href="#h15-0-252" id="h15-0-252" class="i">+                            importTheme()
</a><a href="#h15-0-253" id="h15-0-253" class="i">+                        },
</a><a href="#h15-0-254" id="h15-0-254" class="i">+                        icon = {
</a><a href="#h15-0-255" id="h15-0-255" class="i">+                            Icon(Icons.Default.Upload, contentDescription = null)
</a><a href="#h15-0-256" id="h15-0-256" class="i">+                        },
</a><a href="#h15-0-257" id="h15-0-257" class="i">+                        text = {
</a><a href="#h15-0-258" id="h15-0-258" class="i">+                            Text(&quot;Import from file&quot;)
</a><a href="#h15-0-259" id="h15-0-259" class="i">+                        }
</a><a href="#h15-0-260" id="h15-0-260" class="i">+                    )
</a><a href="#h15-0-261" id="h15-0-261" class="i">+                    Spacer(modifier = Modifier.height(8.dp))
</a><a href="#h15-0-262" id="h15-0-262" class="i">+                    ExtendedFloatingActionButton(
</a><a href="#h15-0-263" id="h15-0-263" class="i">+                        onClick = { showImportFromUrlDialog = true },
</a><a href="#h15-0-264" id="h15-0-264" class="i">+                        icon = {
</a><a href="#h15-0-265" id="h15-0-265" class="i">+                            Icon(Icons.Default.Link, contentDescription = null)
</a><a href="#h15-0-266" id="h15-0-266" class="i">+                        },
</a><a href="#h15-0-267" id="h15-0-267" class="i">+                        text = {
</a><a href="#h15-0-268" id="h15-0-268" class="i">+                            Text(&quot;Import from URL&quot;)
</a><a href="#h15-0-269" id="h15-0-269" class="i">+                        }
</a><a href="#h15-0-270" id="h15-0-270" class="i">+                    )
</a><a href="#h15-0-271" id="h15-0-271" class="i">+                }
</a><a href="#h15-0-272" id="h15-0-272" class="i">+                1 -&gt; {
</a><a href="#h15-0-273" id="h15-0-273" class="i">+                    ExtendedFloatingActionButton(
</a><a href="#h15-0-274" id="h15-0-274" class="i">+                        onClick = {
</a><a href="#h15-0-275" id="h15-0-275" class="i">+                            routes.manageRepos.navigate()
</a><a href="#h15-0-276" id="h15-0-276" class="i">+                        },
</a><a href="#h15-0-277" id="h15-0-277" class="i">+                        icon = {
</a><a href="#h15-0-278" id="h15-0-278" class="i">+                            Icon(Icons.Default.Public, contentDescription = null)
</a><a href="#h15-0-279" id="h15-0-279" class="i">+                        },
</a><a href="#h15-0-280" id="h15-0-280" class="i">+                        text = {
</a><a href="#h15-0-281" id="h15-0-281" class="i">+                            Text(&quot;Manage repositories&quot;)
</a><a href="#h15-0-282" id="h15-0-282" class="i">+                        }
</a><a href="#h15-0-283" id="h15-0-283" class="i">+                    )
</a><a href="#h15-0-284" id="h15-0-284" class="i">+                }
</a><a href="#h15-0-285" id="h15-0-285" class="i">+            }
</a><a href="#h15-0-286" id="h15-0-286" class="i">+        }
</a><a href="#h15-0-287" id="h15-0-287" class="i">+    }
</a><a href="#h15-0-288" id="h15-0-288" class="i">+
</a><a href="#h15-0-289" id="h15-0-289" class="i">+    @Composable
</a><a href="#h15-0-290" id="h15-0-290" class="i">+    private fun InstalledThemes() {
</a><a href="#h15-0-291" id="h15-0-291" class="i">+        val themes = rememberAsyncMutableStateList(defaultValue = listOf(), updateDispatcher = localReloadDispatcher, keys = arrayOf(searchFilter.value)) {
</a><a href="#h15-0-292" id="h15-0-292" class="i">+            context.database.getThemeList().let {
</a><a href="#h15-0-293" id="h15-0-293" class="i">+                val filter = searchFilter.value
</a><a href="#h15-0-294" id="h15-0-294" class="i">+                if (filter.isNotBlank()) {
</a><a href="#h15-0-295" id="h15-0-295" class="i">+                    it.filter { theme -&gt;
</a><a href="#h15-0-296" id="h15-0-296" class="i">+                        theme.name.contains(filter, ignoreCase = true) ||
</a><a href="#h15-0-297" id="h15-0-297" class="i">+                        theme.author?.contains(filter, ignoreCase = true) == true ||
</a><a href="#h15-0-298" id="h15-0-298" class="i">+                        theme.description?.contains(filter, ignoreCase = true) == true
</a><a href="#h15-0-299" id="h15-0-299" class="i">+                    }
</a><a href="#h15-0-300" id="h15-0-300" class="i">+                } else it
</a><a href="#h15-0-301" id="h15-0-301" class="i">+            }
</a><a href="#h15-0-302" id="h15-0-302" class="i">+        }
</a><a href="#h15-0-303" id="h15-0-303" class="i">+
</a><a href="#h15-0-304" id="h15-0-304" class="i">+        LazyColumn(
</a><a href="#h15-0-305" id="h15-0-305" class="i">+            modifier = Modifier
</a><a href="#h15-0-306" id="h15-0-306" class="i">+                .fillMaxSize()
</a><a href="#h15-0-307" id="h15-0-307" class="i">+                .padding(2.dp),
</a><a href="#h15-0-308" id="h15-0-308" class="i">+            verticalArrangement = Arrangement.spacedBy(5.dp)
</a><a href="#h15-0-309" id="h15-0-309" class="i">+        ) {
</a><a href="#h15-0-310" id="h15-0-310" class="i">+            item {
</a><a href="#h15-0-311" id="h15-0-311" class="i">+                if (themes.isEmpty()) {
</a><a href="#h15-0-312" id="h15-0-312" class="i">+                    Text(
</a><a href="#h15-0-313" id="h15-0-313" class="i">+                        text = translation[&quot;no_themes_hint&quot;],
</a><a href="#h15-0-314" id="h15-0-314" class="i">+                        modifier = Modifier
</a><a href="#h15-0-315" id="h15-0-315" class="i">+                            .padding(16.dp)
</a><a href="#h15-0-316" id="h15-0-316" class="i">+                            .fillMaxWidth(),
</a><a href="#h15-0-317" id="h15-0-317" class="i">+                        textAlign = TextAlign.Center,
</a><a href="#h15-0-318" id="h15-0-318" class="i">+                        fontSize = 15.sp,
</a><a href="#h15-0-319" id="h15-0-319" class="i">+                        fontWeight = FontWeight.Light
</a><a href="#h15-0-320" id="h15-0-320" class="i">+                    )
</a><a href="#h15-0-321" id="h15-0-321" class="i">+                }
</a><a href="#h15-0-322" id="h15-0-322" class="i">+            }
</a><a href="#h15-0-323" id="h15-0-323" class="i">+            items(themes, key = { it.id }) { theme -&gt;
</a><a href="#h15-0-324" id="h15-0-324" class="i">+                var showSettings by remember(theme) { mutableStateOf(false) }
</a><a href="#h15-0-325" id="h15-0-325" class="i">+
</a><a href="#h15-0-326" id="h15-0-326" class="i">+                ElevatedCard(
</a><a href="#h15-0-327" id="h15-0-327" class="i">+                    modifier = Modifier
</a><a href="#h15-0-328" id="h15-0-328" class="i">+                        .fillMaxWidth()
</a><a href="#h15-0-329" id="h15-0-329" class="i">+                        .clickable {
</a><a href="#h15-0-330" id="h15-0-330" class="i">+                            routes.editTheme.navigate {
</a><a href="#h15-0-331" id="h15-0-331" class="i">+                                this[&quot;theme_id&quot;] = theme.id.toString()
</a><a href="#h15-0-332" id="h15-0-332" class="i">+                            }
</a><a href="#h15-0-333" id="h15-0-333" class="i">+                        }
</a><a href="#h15-0-334" id="h15-0-334" class="i">+                        .padding(8.dp)
</a><a href="#h15-0-335" id="h15-0-335" class="i">+                ) {
</a><a href="#h15-0-336" id="h15-0-336" class="i">+                    Row(
</a><a href="#h15-0-337" id="h15-0-337" class="i">+                        modifier = Modifier
</a><a href="#h15-0-338" id="h15-0-338" class="i">+                            .padding(8.dp)
</a><a href="#h15-0-339" id="h15-0-339" class="i">+                            .fillMaxWidth(),
</a><a href="#h15-0-340" id="h15-0-340" class="i">+                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h15-0-341" id="h15-0-341" class="i">+                    ) {
</a><a href="#h15-0-342" id="h15-0-342" class="i">+                        Icon(
</a><a href="#h15-0-343" id="h15-0-343" class="i">+                            Icons.Default.Palette, contentDescription = null, modifier = Modifier.padding(5.dp))
</a><a href="#h15-0-344" id="h15-0-344" class="i">+                        Column(
</a><a href="#h15-0-345" id="h15-0-345" class="i">+                            modifier = Modifier
</a><a href="#h15-0-346" id="h15-0-346" class="i">+                                .weight(1f)
</a><a href="#h15-0-347" id="h15-0-347" class="i">+                                .padding(8.dp),
</a><a href="#h15-0-348" id="h15-0-348" class="i">+                        ) {
</a><a href="#h15-0-349" id="h15-0-349" class="i">+                            Text(text = theme.name, fontWeight = FontWeight.Bold, fontSize = 18.sp, lineHeight = 20.sp)
</a><a href="#h15-0-350" id="h15-0-350" class="i">+                            theme.author?.takeIf { it.isNotBlank() }?.let {
</a><a href="#h15-0-351" id="h15-0-351" class="i">+                                Text(text = &quot;by $it&quot;, lineHeight = 15.sp, fontWeight = FontWeight.Light, fontSize = 12.sp)
</a><a href="#h15-0-352" id="h15-0-352" class="i">+                            }
</a><a href="#h15-0-353" id="h15-0-353" class="i">+                        }
</a><a href="#h15-0-354" id="h15-0-354" class="i">+
</a><a href="#h15-0-355" id="h15-0-355" class="i">+                        Row(
</a><a href="#h15-0-356" id="h15-0-356" class="i">+                            horizontalArrangement = Arrangement.spacedBy(5.dp),
</a><a href="#h15-0-357" id="h15-0-357" class="i">+                        ) {
</a><a href="#h15-0-358" id="h15-0-358" class="i">+                            var state by remember { mutableStateOf(theme.enabled) }
</a><a href="#h15-0-359" id="h15-0-359" class="i">+
</a><a href="#h15-0-360" id="h15-0-360" class="i">+                            IconButton(onClick = {
</a><a href="#h15-0-361" id="h15-0-361" class="i">+                                showSettings = true
</a><a href="#h15-0-362" id="h15-0-362" class="i">+                            }) {
</a><a href="#h15-0-363" id="h15-0-363" class="i">+                                Icon(Icons.Default.Settings, contentDescription = null)
</a><a href="#h15-0-364" id="h15-0-364" class="i">+                            }
</a><a href="#h15-0-365" id="h15-0-365" class="i">+
</a><a href="#h15-0-366" id="h15-0-366" class="i">+                            Switch(checked = state, onCheckedChange = {
</a><a href="#h15-0-367" id="h15-0-367" class="i">+                                state = it
</a><a href="#h15-0-368" id="h15-0-368" class="i">+                                context.database.setThemeState(theme.id, it)
</a><a href="#h15-0-369" id="h15-0-369" class="i">+                            })
</a><a href="#h15-0-370" id="h15-0-370" class="i">+                        }
</a><a href="#h15-0-371" id="h15-0-371" class="i">+                    }
</a><a href="#h15-0-372" id="h15-0-372" class="i">+                }
</a><a href="#h15-0-373" id="h15-0-373" class="i">+
</a><a href="#h15-0-374" id="h15-0-374" class="i">+                if (showSettings) {
</a><a href="#h15-0-375" id="h15-0-375" class="i">+                    val actionsRow = remember {
</a><a href="#h15-0-376" id="h15-0-376" class="i">+                        mapOf(
</a><a href="#h15-0-377" id="h15-0-377" class="i">+                            (&quot;Duplicate&quot; to Icons.Default.ContentCopy) to { duplicateTheme(theme) },
</a><a href="#h15-0-378" id="h15-0-378" class="i">+                            (&quot;Export&quot; to Icons.Default.Download) to { exportTheme(theme) }
</a><a href="#h15-0-379" id="h15-0-379" class="i">+                        )
</a><a href="#h15-0-380" id="h15-0-380" class="i">+                    }
</a><a href="#h15-0-381" id="h15-0-381" class="i">+                    AlertDialog(
</a><a href="#h15-0-382" id="h15-0-382" class="i">+                        onDismissRequest = { showSettings = false },
</a><a href="#h15-0-383" id="h15-0-383" class="i">+                        title = { Text(&quot;Theme settings&quot;) },
</a><a href="#h15-0-384" id="h15-0-384" class="i">+                        text = {
</a><a href="#h15-0-385" id="h15-0-385" class="i">+                            Column(
</a><a href="#h15-0-386" id="h15-0-386" class="i">+                                modifier = Modifier.fillMaxWidth(),
</a><a href="#h15-0-387" id="h15-0-387" class="i">+                            ) {
</a><a href="#h15-0-388" id="h15-0-388" class="i">+                                actionsRow.forEach { entry -&gt;
</a><a href="#h15-0-389" id="h15-0-389" class="i">+                                    Row(
</a><a href="#h15-0-390" id="h15-0-390" class="i">+                                        modifier = Modifier
</a><a href="#h15-0-391" id="h15-0-391" class="i">+                                            .fillMaxWidth()
</a><a href="#h15-0-392" id="h15-0-392" class="i">+                                            .clickable {
</a><a href="#h15-0-393" id="h15-0-393" class="i">+                                                showSettings = false
</a><a href="#h15-0-394" id="h15-0-394" class="i">+                                                entry.value()
</a><a href="#h15-0-395" id="h15-0-395" class="i">+                                            },
</a><a href="#h15-0-396" id="h15-0-396" class="i">+                                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h15-0-397" id="h15-0-397" class="i">+                                    ) {
</a><a href="#h15-0-398" id="h15-0-398" class="i">+                                        Icon(entry.key.second, contentDescription = null, modifier = Modifier.padding(16.dp))
</a><a href="#h15-0-399" id="h15-0-399" class="i">+                                        Spacer(modifier = Modifier.width(5.dp))
</a><a href="#h15-0-400" id="h15-0-400" class="i">+                                        Text(entry.key.first)
</a><a href="#h15-0-401" id="h15-0-401" class="i">+                                    }
</a><a href="#h15-0-402" id="h15-0-402" class="i">+                                }
</a><a href="#h15-0-403" id="h15-0-403" class="i">+                            }
</a><a href="#h15-0-404" id="h15-0-404" class="i">+                        },
</a><a href="#h15-0-405" id="h15-0-405" class="i">+                        confirmButton = {}
</a><a href="#h15-0-406" id="h15-0-406" class="i">+                    )
</a><a href="#h15-0-407" id="h15-0-407" class="i">+                }
</a><a href="#h15-0-408" id="h15-0-408" class="i">+            }
</a><a href="#h15-0-409" id="h15-0-409" class="i">+            item {
</a><a href="#h15-0-410" id="h15-0-410" class="i">+                Spacer(modifier = Modifier.height(100.dp))
</a><a href="#h15-0-411" id="h15-0-411" class="i">+            }
</a><a href="#h15-0-412" id="h15-0-412" class="i">+        }
</a><a href="#h15-0-413" id="h15-0-413" class="i">+    }
</a><a href="#h15-0-414" id="h15-0-414" class="i">+
</a><a href="#h15-0-415" id="h15-0-415" class="i">+
</a><a href="#h15-0-416" id="h15-0-416" class="i">+    @OptIn(ExperimentalFoundationApi::class)
</a><a href="#h15-0-417" id="h15-0-417" class="i">+    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h15-0-418" id="h15-0-418" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h15-0-419" id="h15-0-419" class="i">+        val titles = remember { listOf(&quot;Installed Themes&quot;, &quot;Catalog&quot;) }
</a><a href="#h15-0-420" id="h15-0-420" class="i">+        val pagerState = rememberPagerState { titles.size }
</a><a href="#h15-0-421" id="h15-0-421" class="i">+        currentPage = pagerState.currentPage
</a><a href="#h15-0-422" id="h15-0-422" class="i">+
</a><a href="#h15-0-423" id="h15-0-423" class="i">+        Column {
</a><a href="#h15-0-424" id="h15-0-424" class="i">+            TabRow(selectedTabIndex = pagerState.currentPage, indicator = { tabPositions -&gt;
</a><a href="#h15-0-425" id="h15-0-425" class="i">+                TabRowDefaults.SecondaryIndicator(
</a><a href="#h15-0-426" id="h15-0-426" class="i">+                    Modifier.pagerTabIndicatorOffset(
</a><a href="#h15-0-427" id="h15-0-427" class="i">+                        pagerState = pagerState,
</a><a href="#h15-0-428" id="h15-0-428" class="i">+                        tabPositions = tabPositions
</a><a href="#h15-0-429" id="h15-0-429" class="i">+                    )
</a><a href="#h15-0-430" id="h15-0-430" class="i">+                )
</a><a href="#h15-0-431" id="h15-0-431" class="i">+            }) {
</a><a href="#h15-0-432" id="h15-0-432" class="i">+                titles.forEachIndexed { index, title -&gt;
</a><a href="#h15-0-433" id="h15-0-433" class="i">+                    Tab(
</a><a href="#h15-0-434" id="h15-0-434" class="i">+                        selected = pagerState.currentPage == index,
</a><a href="#h15-0-435" id="h15-0-435" class="i">+                        onClick = {
</a><a href="#h15-0-436" id="h15-0-436" class="i">+                            coroutineScope.launch {
</a><a href="#h15-0-437" id="h15-0-437" class="i">+                                pagerState.animateScrollToPage(index)
</a><a href="#h15-0-438" id="h15-0-438" class="i">+                            }
</a><a href="#h15-0-439" id="h15-0-439" class="i">+                        },
</a><a href="#h15-0-440" id="h15-0-440" class="i">+                        text = {
</a><a href="#h15-0-441" id="h15-0-441" class="i">+                            Text(
</a><a href="#h15-0-442" id="h15-0-442" class="i">+                                text = title,
</a><a href="#h15-0-443" id="h15-0-443" class="i">+                                maxLines = 2,
</a><a href="#h15-0-444" id="h15-0-444" class="i">+                                overflow = TextOverflow.Ellipsis
</a><a href="#h15-0-445" id="h15-0-445" class="i">+                            )
</a><a href="#h15-0-446" id="h15-0-446" class="i">+                        }
</a><a href="#h15-0-447" id="h15-0-447" class="i">+                    )
</a><a href="#h15-0-448" id="h15-0-448" class="i">+                }
</a><a href="#h15-0-449" id="h15-0-449" class="i">+            }
</a><a href="#h15-0-450" id="h15-0-450" class="i">+
</a><a href="#h15-0-451" id="h15-0-451" class="i">+            HorizontalPager(
</a><a href="#h15-0-452" id="h15-0-452" class="i">+                modifier = Modifier.weight(1f),
</a><a href="#h15-0-453" id="h15-0-453" class="i">+                state = pagerState
</a><a href="#h15-0-454" id="h15-0-454" class="i">+            ) { page -&gt;
</a><a href="#h15-0-455" id="h15-0-455" class="i">+                when (page) {
</a><a href="#h15-0-456" id="h15-0-456" class="i">+                    0 -&gt; InstalledThemes()
</a><a href="#h15-0-457" id="h15-0-457" class="i">+                    1 -&gt; ThemeCatalog(this@ThemingRoot)
</a><a href="#h15-0-458" id="h15-0-458" class="i">+                }
</a><a href="#h15-0-459" id="h15-0-459" class="i">+            }
</a><a href="#h15-0-460" id="h15-0-460" class="i">+        }
</a><a href="#h15-0-461" id="h15-0-461" class="i">+    }
</a><a href="#h15-0-462" id="h15-0-462" class="i">+}</a><a href="#h15-0-463" id="h15-0-463" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/tracker/LogsTab.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/tracker/LogsTab.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/tracker/LogsTab.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/tracker/LogsTab.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -74,9 +74,12 @@ fun LogsTab(
</a> 
     suspend fun loadNewLogs() {
         withContext(Dispatchers.IO) {
<a href="#h16-0-3" id="h16-0-3" class="d">-            logs.addAll(getPaginatedLogs(pageIndex).apply {
</a><a href="#h16-0-4" id="h16-0-4" class="d">-                pageIndex += 1
</a><a href="#h16-0-5" id="h16-0-5" class="d">-            })
</a><a href="#h16-0-6" id="h16-0-6" class="i">+            getPaginatedLogs(pageIndex).let {
</a><a href="#h16-0-7" id="h16-0-7" class="i">+                withContext(Dispatchers.Main) {
</a><a href="#h16-0-8" id="h16-0-8" class="i">+                    logs.addAll(it)
</a><a href="#h16-0-9" id="h16-0-9" class="i">+                    pageIndex += 1
</a><a href="#h16-0-10" id="h16-0-10" class="i">+                }
</a><a href="#h16-0-11" id="h16-0-11" class="i">+            }
</a>         }
     }
 
<b>diff --git a/<a id="h17" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/Requirements.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -1,21 +1,11 @@
</a> package me.rhunk.snapenhance.ui.setup
 
 object Requirements {
<a href="#h17-0-3" id="h17-0-3" class="d">-    const val FIRST_RUN = 0b00001
</a><a href="#h17-0-4" id="h17-0-4" class="d">-    const val LANGUAGE = 0b00010
</a><a href="#h17-0-5" id="h17-0-5" class="d">-    const val MAPPINGS = 0b00100
</a><a href="#h17-0-6" id="h17-0-6" class="d">-    const val SAVE_FOLDER = 0b01000
</a><a href="#h17-0-7" id="h17-0-7" class="d">-    const val GRANT_PERMISSIONS = 0b10000
</a><a href="#h17-0-8" id="h17-0-8" class="d">-
</a><a href="#h17-0-9" id="h17-0-9" class="d">-    fun getName(requirement: Int): String {
</a><a href="#h17-0-10" id="h17-0-10" class="d">-        return when (requirement) {
</a><a href="#h17-0-11" id="h17-0-11" class="d">-            FIRST_RUN -&gt; &quot;FIRST_RUN&quot;
</a><a href="#h17-0-12" id="h17-0-12" class="d">-            LANGUAGE -&gt; &quot;LANGUAGE&quot;
</a><a href="#h17-0-13" id="h17-0-13" class="d">-            MAPPINGS -&gt; &quot;MAPPINGS&quot;
</a><a href="#h17-0-14" id="h17-0-14" class="d">-            SAVE_FOLDER -&gt; &quot;SAVE_FOLDER&quot;
</a><a href="#h17-0-15" id="h17-0-15" class="d">-            GRANT_PERMISSIONS -&gt; &quot;GRANT_PERMISSIONS&quot;
</a><a href="#h17-0-16" id="h17-0-16" class="d">-            else -&gt; &quot;UNKNOWN&quot;
</a><a href="#h17-0-17" id="h17-0-17" class="d">-        }
</a><a href="#h17-0-18" id="h17-0-18" class="d">-    }
</a><a href="#h17-0-19" id="h17-0-19" class="i">+    const val FIRST_RUN = 0b000001
</a><a href="#h17-0-20" id="h17-0-20" class="i">+    const val LANGUAGE = 0b000010
</a><a href="#h17-0-21" id="h17-0-21" class="i">+    const val MAPPINGS = 0b000100
</a><a href="#h17-0-22" id="h17-0-22" class="i">+    const val SAVE_FOLDER = 0b001000
</a><a href="#h17-0-23" id="h17-0-23" class="i">+    const val GRANT_PERMISSIONS = 0b010000
</a><a href="#h17-0-24" id="h17-0-24" class="i">+    const val SIF = 0b100000
</a> }
 
<b>diff --git a/<a id="h18" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -29,10 +29,7 @@ import androidx.navigation.compose.rememberNavController
</a> import me.rhunk.snapenhance.SharedContextHolder
 import me.rhunk.snapenhance.common.ui.AppMaterialTheme
 import me.rhunk.snapenhance.ui.setup.screens.SetupScreen
<a href="#h18-0-3" id="h18-0-3" class="d">-import me.rhunk.snapenhance.ui.setup.screens.impl.MappingsScreen
</a><a href="#h18-0-4" id="h18-0-4" class="d">-import me.rhunk.snapenhance.ui.setup.screens.impl.PermissionsScreen
</a><a href="#h18-0-5" id="h18-0-5" class="d">-import me.rhunk.snapenhance.ui.setup.screens.impl.PickLanguageScreen
</a><a href="#h18-0-6" id="h18-0-6" class="d">-import me.rhunk.snapenhance.ui.setup.screens.impl.SaveFolderScreen
</a><a href="#h18-0-7" id="h18-0-7" class="i">+import me.rhunk.snapenhance.ui.setup.screens.impl.*
</a> 
 
 class SetupActivity : ComponentActivity() {
<a href="#h18-1" id="h18-1" class="h">@@ -69,6 +66,9 @@ class SetupActivity : ComponentActivity() {
</a>             if (isFirstRun || hasRequirement(Requirements.MAPPINGS)) {
                 add(MappingsScreen().apply { route = &quot;mappings&quot; })
             }
<a href="#h18-1-3" id="h18-1-3" class="i">+            if (isFirstRun || hasRequirement(Requirements.SIF)) {
</a><a href="#h18-1-4" id="h18-1-4" class="i">+                add(SecurityScreen().apply { route = &quot;security&quot; })
</a><a href="#h18-1-5" id="h18-1-5" class="i">+            }
</a>         }
 
         // If there are no required screens, we can just finish the activity
<b>diff --git a/<a id="h19" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SecurityScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SecurityScreen.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SecurityScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SecurityScreen.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,86 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+package me.rhunk.snapenhance.ui.setup.screens.impl
</a><a href="#h19-0-1" id="h19-0-1" class="i">+
</a><a href="#h19-0-2" id="h19-0-2" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h19-0-3" id="h19-0-3" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h19-0-4" id="h19-0-4" class="i">+import androidx.compose.material.icons.filled.WarningAmber
</a><a href="#h19-0-5" id="h19-0-5" class="i">+import androidx.compose.material3.*
</a><a href="#h19-0-6" id="h19-0-6" class="i">+import androidx.compose.runtime.*
</a><a href="#h19-0-7" id="h19-0-7" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h19-0-8" id="h19-0-8" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h19-0-9" id="h19-0-9" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h19-0-10" id="h19-0-10" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h19-0-11" id="h19-0-11" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h19-0-12" id="h19-0-12" class="i">+import kotlinx.coroutines.launch
</a><a href="#h19-0-13" id="h19-0-13" class="i">+import me.rhunk.snapenhance.ui.setup.screens.SetupScreen
</a><a href="#h19-0-14" id="h19-0-14" class="i">+
</a><a href="#h19-0-15" id="h19-0-15" class="i">+class SecurityScreen : SetupScreen() {
</a><a href="#h19-0-16" id="h19-0-16" class="i">+    @Composable
</a><a href="#h19-0-17" id="h19-0-17" class="i">+    override fun Content() {
</a><a href="#h19-0-18" id="h19-0-18" class="i">+        Icon(
</a><a href="#h19-0-19" id="h19-0-19" class="i">+            imageVector = Icons.Default.WarningAmber,
</a><a href="#h19-0-20" id="h19-0-20" class="i">+            contentDescription = null,
</a><a href="#h19-0-21" id="h19-0-21" class="i">+            modifier = Modifier.padding(16.dp).size(30.dp),
</a><a href="#h19-0-22" id="h19-0-22" class="i">+        )
</a><a href="#h19-0-23" id="h19-0-23" class="i">+
</a><a href="#h19-0-24" id="h19-0-24" class="i">+        DialogText(
</a><a href="#h19-0-25" id="h19-0-25" class="i">+            &quot;Since Snapchat has implemented additional security measures against third-party applications such as SnapEnhance, we offer a non-opensource solution that reduces the risk of banning and prevents Snapchat from detecting SnapEnhance. &quot; +
</a><a href="#h19-0-26" id="h19-0-26" class="i">+                    &quot;\nPlease note that this solution does not provide a ban bypass or spoofer for anything, and does not take any personal data or communicate with the network.&quot; +
</a><a href="#h19-0-27" id="h19-0-27" class="i">+                    &quot;\nWe also encourage you to use official signed builds to avoid compromising the security of your account.&quot; +
</a><a href="#h19-0-28" id="h19-0-28" class="i">+            &quot;\nIf you&#39;re having trouble using the solution, or are experiencing crashes, join the Telegram Group for help: https://t.me/snapenhance_chat&quot;
</a><a href="#h19-0-29" id="h19-0-29" class="i">+        )
</a><a href="#h19-0-30" id="h19-0-30" class="i">+
</a><a href="#h19-0-31" id="h19-0-31" class="i">+        var denyDialog by remember { mutableStateOf(false) }
</a><a href="#h19-0-32" id="h19-0-32" class="i">+
</a><a href="#h19-0-33" id="h19-0-33" class="i">+        if (denyDialog) {
</a><a href="#h19-0-34" id="h19-0-34" class="i">+            AlertDialog(
</a><a href="#h19-0-35" id="h19-0-35" class="i">+                onDismissRequest = {
</a><a href="#h19-0-36" id="h19-0-36" class="i">+                    denyDialog = false
</a><a href="#h19-0-37" id="h19-0-37" class="i">+                },
</a><a href="#h19-0-38" id="h19-0-38" class="i">+                text = {
</a><a href="#h19-0-39" id="h19-0-39" class="i">+                    Text(&quot;Are you sure you don&#39;t want to use this solution? You can always change this later in the settings in the SnapEnhance app.&quot;)
</a><a href="#h19-0-40" id="h19-0-40" class="i">+                },
</a><a href="#h19-0-41" id="h19-0-41" class="i">+                dismissButton = {
</a><a href="#h19-0-42" id="h19-0-42" class="i">+                    Button(onClick = {
</a><a href="#h19-0-43" id="h19-0-43" class="i">+                        denyDialog = false
</a><a href="#h19-0-44" id="h19-0-44" class="i">+                    }) {
</a><a href="#h19-0-45" id="h19-0-45" class="i">+                        Text(&quot;Go back&quot;)
</a><a href="#h19-0-46" id="h19-0-46" class="i">+                    }
</a><a href="#h19-0-47" id="h19-0-47" class="i">+                },
</a><a href="#h19-0-48" id="h19-0-48" class="i">+                confirmButton = {
</a><a href="#h19-0-49" id="h19-0-49" class="i">+                    Button(onClick = {
</a><a href="#h19-0-50" id="h19-0-50" class="i">+                        context.sharedPreferences.edit().putString(&quot;sif&quot;, &quot;false&quot;).apply()
</a><a href="#h19-0-51" id="h19-0-51" class="i">+                        goNext()
</a><a href="#h19-0-52" id="h19-0-52" class="i">+                    }) {
</a><a href="#h19-0-53" id="h19-0-53" class="i">+                        Text(&quot;Yes, I&#39;m sure&quot;)
</a><a href="#h19-0-54" id="h19-0-54" class="i">+                    }
</a><a href="#h19-0-55" id="h19-0-55" class="i">+                }
</a><a href="#h19-0-56" id="h19-0-56" class="i">+            )
</a><a href="#h19-0-57" id="h19-0-57" class="i">+        }
</a><a href="#h19-0-58" id="h19-0-58" class="i">+
</a><a href="#h19-0-59" id="h19-0-59" class="i">+        Column (
</a><a href="#h19-0-60" id="h19-0-60" class="i">+            modifier = Modifier.padding(16.dp),
</a><a href="#h19-0-61" id="h19-0-61" class="i">+            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h19-0-62" id="h19-0-62" class="i">+            verticalArrangement = Arrangement.spacedBy(10.dp)
</a><a href="#h19-0-63" id="h19-0-63" class="i">+        ) {
</a><a href="#h19-0-64" id="h19-0-64" class="i">+            Button(
</a><a href="#h19-0-65" id="h19-0-65" class="i">+                onClick = {
</a><a href="#h19-0-66" id="h19-0-66" class="i">+                    context.coroutineScope.launch {
</a><a href="#h19-0-67" id="h19-0-67" class="i">+                        context.sharedPreferences.edit().putString(&quot;sif&quot;, &quot;&quot;).commit()
</a><a href="#h19-0-68" id="h19-0-68" class="i">+                        context.remoteSharedLibraryManager.init()
</a><a href="#h19-0-69" id="h19-0-69" class="i">+                    }
</a><a href="#h19-0-70" id="h19-0-70" class="i">+                    goNext()
</a><a href="#h19-0-71" id="h19-0-71" class="i">+                }
</a><a href="#h19-0-72" id="h19-0-72" class="i">+            ) {
</a><a href="#h19-0-73" id="h19-0-73" class="i">+                Text(&quot;Accept and continue&quot;, fontSize = 18.sp, fontWeight = FontWeight.Bold)
</a><a href="#h19-0-74" id="h19-0-74" class="i">+            }
</a><a href="#h19-0-75" id="h19-0-75" class="i">+            Button(
</a><a href="#h19-0-76" id="h19-0-76" class="i">+                colors = ButtonDefaults.buttonColors(containerColor = MaterialTheme.colorScheme.error),
</a><a href="#h19-0-77" id="h19-0-77" class="i">+                onClick = {
</a><a href="#h19-0-78" id="h19-0-78" class="i">+                    denyDialog = true
</a><a href="#h19-0-79" id="h19-0-79" class="i">+                }
</a><a href="#h19-0-80" id="h19-0-80" class="i">+            ) {
</a><a href="#h19-0-81" id="h19-0-81" class="i">+                Text(&quot;I don&#39;t want to use this solution&quot;)
</a><a href="#h19-0-82" id="h19-0-82" class="i">+            }
</a><a href="#h19-0-83" id="h19-0-83" class="i">+        }
</a><a href="#h19-0-84" id="h19-0-84" class="i">+    }
</a><a href="#h19-0-85" id="h19-0-85" class="i">+}</a><a href="#h19-0-86" id="h19-0-86" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AlertDialogs.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -360,12 +360,11 @@ class AlertDialogs(
</a> 
     @Composable
     fun ColorPickerDialog(
<a href="#h20-0-3" id="h20-0-3" class="d">-        property: PropertyPair&lt;*&gt;,
</a><a href="#h20-0-4" id="h20-0-4" class="d">-        dismiss: () -&gt; Unit = {},
</a><a href="#h20-0-5" id="h20-0-5" class="i">+        initialColor: Color?,
</a><a href="#h20-0-6" id="h20-0-6" class="i">+        setProperty: (Color?) -&gt; Unit,
</a><a href="#h20-0-7" id="h20-0-7" class="i">+        dismiss: () -&gt; Unit
</a>     ) {
<a href="#h20-0-9" id="h20-0-9" class="d">-        var currentColor by remember {
</a><a href="#h20-0-10" id="h20-0-10" class="d">-            mutableStateOf((property.value.getNullable() as? Int)?.let { Color(it) })
</a><a href="#h20-0-11" id="h20-0-11" class="d">-        }
</a><a href="#h20-0-12" id="h20-0-12" class="i">+        var currentColor by remember { mutableStateOf(initialColor) }
</a> 
         DefaultDialogCard {
             val controller = remember { ColorPickerController().apply {
<a href="#h20-1" id="h20-1" class="h">@@ -389,7 +388,7 @@ class AlertDialogs(
</a>                         runCatching {
                             currentColor = Color(android.graphics.Color.parseColor(&quot;#$value&quot;)).also {
                                 controller.selectByColor(it, true)
<a href="#h20-1-3" id="h20-1-3" class="d">-                                property.value.setAny(it.toArgb())
</a><a href="#h20-1-4" id="h20-1-4" class="i">+                                setProperty(it)
</a>                             }
                         }.onFailure {
                             currentColor = null
<a href="#h20-2" id="h20-2" class="h">@@ -417,7 +416,7 @@ class AlertDialogs(
</a>                     if (!it.fromUser) return@HsvColorPicker
                     currentColor = it.color
                     colorHexValue = Integer.toHexString(it.color.toArgb())
<a href="#h20-2-3" id="h20-2-3" class="d">-                    property.value.setAny(it.color.toArgb())
</a><a href="#h20-2-4" id="h20-2-4" class="i">+                    setProperty(it.color)
</a>                 }
             )
             AlphaSlider(
<a href="#h20-3" id="h20-3" class="h">@@ -450,7 +449,7 @@ class AlertDialogs(
</a>                     controller = controller
                 )
                 IconButton(onClick = {
<a href="#h20-3-3" id="h20-3-3" class="d">-                    property.value.setAny(null)
</a><a href="#h20-3-4" id="h20-3-4" class="i">+                    setProperty(null)
</a>                     dismiss()
                 }) {
                     Icon(
<a href="#h20-4" id="h20-4" class="h">@@ -464,6 +463,25 @@ class AlertDialogs(
</a>     }
 
     @Composable
<a href="#h20-4-3" id="h20-4-3" class="i">+    fun ColorPickerPropertyDialog(
</a><a href="#h20-4-4" id="h20-4-4" class="i">+        property: PropertyPair&lt;*&gt;,
</a><a href="#h20-4-5" id="h20-4-5" class="i">+        dismiss: () -&gt; Unit = {},
</a><a href="#h20-4-6" id="h20-4-6" class="i">+    ) {
</a><a href="#h20-4-7" id="h20-4-7" class="i">+        var currentColor by remember {
</a><a href="#h20-4-8" id="h20-4-8" class="i">+            mutableStateOf((property.value.getNullable() as? Int)?.let { Color(it) })
</a><a href="#h20-4-9" id="h20-4-9" class="i">+        }
</a><a href="#h20-4-10" id="h20-4-10" class="i">+
</a><a href="#h20-4-11" id="h20-4-11" class="i">+        ColorPickerDialog(
</a><a href="#h20-4-12" id="h20-4-12" class="i">+            initialColor = currentColor,
</a><a href="#h20-4-13" id="h20-4-13" class="i">+            setProperty = {
</a><a href="#h20-4-14" id="h20-4-14" class="i">+                currentColor = it
</a><a href="#h20-4-15" id="h20-4-15" class="i">+                property.value.setAny(it?.toArgb())
</a><a href="#h20-4-16" id="h20-4-16" class="i">+            },
</a><a href="#h20-4-17" id="h20-4-17" class="i">+            dismiss = dismiss
</a><a href="#h20-4-18" id="h20-4-18" class="i">+        )
</a><a href="#h20-4-19" id="h20-4-19" class="i">+    }
</a><a href="#h20-4-20" id="h20-4-20" class="i">+
</a><a href="#h20-4-21" id="h20-4-21" class="i">+    @Composable
</a>     fun ChooseLocationDialog(
         property: PropertyPair&lt;*&gt;,
         marker: MutableState&lt;Marker?&gt; = remember { mutableStateOf(null) },
<b>diff --git a/<a id="h21" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ColorPicker.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ColorPicker.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ColorPicker.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/ColorPicker.kt</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -0,0 +1,27 @@
</a><a href="#h21-0-0" id="h21-0-0" class="i">+package me.rhunk.snapenhance.ui.util
</a><a href="#h21-0-1" id="h21-0-1" class="i">+
</a><a href="#h21-0-2" id="h21-0-2" class="i">+import androidx.compose.foundation.border
</a><a href="#h21-0-3" id="h21-0-3" class="i">+import androidx.compose.foundation.layout.size
</a><a href="#h21-0-4" id="h21-0-4" class="i">+import androidx.compose.foundation.shape.RoundedCornerShape
</a><a href="#h21-0-5" id="h21-0-5" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h21-0-6" id="h21-0-6" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h21-0-7" id="h21-0-7" class="i">+import androidx.compose.ui.draw.clip
</a><a href="#h21-0-8" id="h21-0-8" class="i">+import androidx.compose.ui.graphics.Color
</a><a href="#h21-0-9" id="h21-0-9" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h21-0-10" id="h21-0-10" class="i">+import com.github.skydoves.colorpicker.compose.AlphaTile
</a><a href="#h21-0-11" id="h21-0-11" class="i">+
</a><a href="#h21-0-12" id="h21-0-12" class="i">+@Composable
</a><a href="#h21-0-13" id="h21-0-13" class="i">+fun CircularAlphaTile(
</a><a href="#h21-0-14" id="h21-0-14" class="i">+    selectedColor: Color?,
</a><a href="#h21-0-15" id="h21-0-15" class="i">+) {
</a><a href="#h21-0-16" id="h21-0-16" class="i">+    AlphaTile(
</a><a href="#h21-0-17" id="h21-0-17" class="i">+        modifier = Modifier
</a><a href="#h21-0-18" id="h21-0-18" class="i">+            .size(30.dp)
</a><a href="#h21-0-19" id="h21-0-19" class="i">+            .border(2.dp, Color.White, shape = RoundedCornerShape(15.dp))
</a><a href="#h21-0-20" id="h21-0-20" class="i">+            .clip(RoundedCornerShape(15.dp)),
</a><a href="#h21-0-21" id="h21-0-21" class="i">+        selectedColor = selectedColor ?: Color.Transparent,
</a><a href="#h21-0-22" id="h21-0-22" class="i">+        tileEvenColor = selectedColor?.let { Color(0xFFCBCBCB) } ?: Color.Transparent,
</a><a href="#h21-0-23" id="h21-0-23" class="i">+        tileOddColor = selectedColor?.let { Color.White } ?: Color.Transparent,
</a><a href="#h21-0-24" id="h21-0-24" class="i">+        tileSize = 8.dp,
</a><a href="#h21-0-25" id="h21-0-25" class="i">+    )
</a><a href="#h21-0-26" id="h21-0-26" class="i">+}</a><a href="#h21-0-27" id="h21-0-27" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h22" href="../file/common/src/main/assets/lang/en_US.json.html">common/src/main/assets/lang/en_US.json</a> b/<a href="../file/common/src/main/assets/lang/en_US.json.html">common/src/main/assets/lang/en_US.json</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -36,6 +36,9 @@
</a>             &quot;friend_tracker&quot;: &quot;Friend Tracker&quot;,
             &quot;edit_rule&quot;: &quot;Edit Rule&quot;,
             &quot;file_imports&quot;: &quot;File Imports&quot;,
<a href="#h22-0-3" id="h22-0-3" class="i">+            &quot;theming&quot;: &quot;Theming&quot;,
</a><a href="#h22-0-4" id="h22-0-4" class="i">+            &quot;edit_theme&quot;: &quot;Edit Theme&quot;,
</a><a href="#h22-0-5" id="h22-0-5" class="i">+            &quot;manage_repos&quot;: &quot;Manage Repositories&quot;,
</a>             &quot;social&quot;: &quot;Social&quot;,
             &quot;manage_scope&quot;: &quot;Manage Scope&quot;,
             &quot;messaging_preview&quot;: &quot;Preview&quot;,
<a href="#h22-1" id="h22-1" class="h">@@ -168,6 +171,9 @@
</a>                 &quot;search_bar&quot;: &quot;Search&quot;,
                 &quot;no_friends_map&quot;: &quot;No friends on the map&quot;,
                 &quot;no_friends_found&quot;: &quot;No friends found&quot;
<a href="#h22-1-3" id="h22-1-3" class="i">+            },
</a><a href="#h22-1-4" id="h22-1-4" class="i">+            &quot;theming&quot;: {
</a><a href="#h22-1-5" id="h22-1-5" class="i">+                &quot;no_themes_hint&quot;: &quot;No themes found&quot;
</a>             }
         },
         &quot;dialogs&quot;: {
<a href="#h22-2" id="h22-2" class="h">@@ -293,6 +299,10 @@
</a>             &quot;name&quot;: &quot;Change Language&quot;,
             &quot;description&quot;: &quot;Change the language of SnapEnhance&quot;
         },
<a href="#h22-2-3" id="h22-2-3" class="i">+        &quot;security_features&quot;: {
</a><a href="#h22-2-4" id="h22-2-4" class="i">+            &quot;name&quot;: &quot;Security Features&quot;,
</a><a href="#h22-2-5" id="h22-2-5" class="i">+            &quot;description&quot;: &quot;Access security features&quot;
</a><a href="#h22-2-6" id="h22-2-6" class="i">+        },
</a>         &quot;file_imports&quot;: {
             &quot;name&quot;: &quot;File Imports&quot;,
             &quot;description&quot;: &quot;Import files for use in Snapchat&quot;
<a href="#h22-3" id="h22-3" class="h">@@ -304,6 +314,10 @@
</a>         &quot;logger_history&quot;: {
             &quot;name&quot;: &quot;Logger History&quot;,
             &quot;description&quot;: &quot;View the history of logged messages&quot;
<a href="#h22-3-3" id="h22-3-3" class="i">+        },
</a><a href="#h22-3-4" id="h22-3-4" class="i">+        &quot;theming&quot;: {
</a><a href="#h22-3-5" id="h22-3-5" class="i">+            &quot;name&quot;: &quot;Theming&quot;,
</a><a href="#h22-3-6" id="h22-3-6" class="i">+            &quot;description&quot;: &quot;Customize the look and feel of Snapchat&quot;
</a>         }
     },
 
<a href="#h22-4" id="h22-4" class="h">@@ -415,65 +429,9 @@
</a>                         &quot;name&quot;: &quot;Enable App Appearance Settings&quot;,
                         &quot;description&quot;: &quot;Enables the hidden App Appearance Setting\nMay not be required on newer Snapchat versions&quot;
                     },
<a href="#h22-4-3" id="h22-4-3" class="d">-                    &quot;customize_ui&quot;: {
</a><a href="#h22-4-4" id="h22-4-4" class="d">-                        &quot;name&quot;: &quot;Colors&quot;,
</a><a href="#h22-4-5" id="h22-4-5" class="d">-                        &quot;description&quot;: &quot;Customize Snapchats Colors&quot;,
</a><a href="#h22-4-6" id="h22-4-6" class="d">-                        &quot;properties&quot;: {
</a><a href="#h22-4-7" id="h22-4-7" class="d">-                            &quot;theme_picker&quot;: {
</a><a href="#h22-4-8" id="h22-4-8" class="d">-                                &quot;name&quot;: &quot;Theme Picker&quot;,
</a><a href="#h22-4-9" id="h22-4-9" class="d">-                                &quot;description&quot;: &quot;Preset Snapchat Themes&quot;
</a><a href="#h22-4-10" id="h22-4-10" class="d">-                            },
</a><a href="#h22-4-11" id="h22-4-11" class="d">-                            &quot;colors&quot;: {
</a><a href="#h22-4-12" id="h22-4-12" class="d">-                                &quot;name&quot;: &quot;Custom Colors&quot;,
</a><a href="#h22-4-13" id="h22-4-13" class="d">-                                &quot;description&quot;: &quot;Customize Individual colors\nNote: Select Custom Colors on Theme Picker to use&quot;,
</a><a href="#h22-4-14" id="h22-4-14" class="d">-                                &quot;properties&quot;: {
</a><a href="#h22-4-15" id="h22-4-15" class="d">-                                    &quot;text_color&quot;: {
</a><a href="#h22-4-16" id="h22-4-16" class="d">-                                        &quot;name&quot;: &quot;Main Text Color&quot;,
</a><a href="#h22-4-17" id="h22-4-17" class="d">-                                        &quot;description&quot;: &quot;Changes Snapchats main text color&quot;
</a><a href="#h22-4-18" id="h22-4-18" class="d">-                                    },
</a><a href="#h22-4-19" id="h22-4-19" class="d">-                                    &quot;chat_chat_text_color&quot;: {
</a><a href="#h22-4-20" id="h22-4-20" class="d">-                                        &quot;name&quot;: &quot;Main Friend Feed Text Color&quot;,
</a><a href="#h22-4-21" id="h22-4-21" class="d">-                                        &quot;description&quot;: &quot;Changes the text color of ( New Chat / New Snap And Chats / Typing / Calling / Missed call / Speaking / New Voice Note ) on the friend feed&quot;
</a><a href="#h22-4-22" id="h22-4-22" class="d">-                                    },
</a><a href="#h22-4-23" id="h22-4-23" class="d">-                                    &quot;pending_sending_text_color&quot;: {
</a><a href="#h22-4-24" id="h22-4-24" class="d">-                                        &quot;name&quot;: &quot;Secondary Friend Feed Text Color&quot;,
</a><a href="#h22-4-25" id="h22-4-25" class="d">-                                        &quot;description&quot;: &quot;Changes the text color of ( Delivered / Received / Sending / Opened / Tap To Chat / Hold To Replay / Replayed / Saved In Chat / Called ) on the friend feed&quot;
</a><a href="#h22-4-26" id="h22-4-26" class="d">-                                    },
</a><a href="#h22-4-27" id="h22-4-27" class="d">-                                    &quot;snap_with_sound_text_color&quot;: {
</a><a href="#h22-4-28" id="h22-4-28" class="d">-                                        &quot;name&quot;: &quot;Snaps With Sound Text Color&quot;,
</a><a href="#h22-4-29" id="h22-4-29" class="d">-                                        &quot;description&quot;: &quot;Changes the text color of ( New Snap ) on the friend feed\nNote: Video Snaps Only&quot;
</a><a href="#h22-4-30" id="h22-4-30" class="d">-                                    },
</a><a href="#h22-4-31" id="h22-4-31" class="d">-                                    &quot;snap_without_sound_text_color&quot;: {
</a><a href="#h22-4-32" id="h22-4-32" class="d">-                                        &quot;name&quot;: &quot;Snaps Without Sound Text Color&quot;,
</a><a href="#h22-4-33" id="h22-4-33" class="d">-                                        &quot;description&quot;: &quot;Changes the text color of ( New Snap ) on the friend feed\nNote: Video Snaps Only&quot;
</a><a href="#h22-4-34" id="h22-4-34" class="d">-                                    },
</a><a href="#h22-4-35" id="h22-4-35" class="d">-                                    &quot;background_color&quot;: {
</a><a href="#h22-4-36" id="h22-4-36" class="d">-                                        &quot;name&quot;: &quot;Background Color&quot;,
</a><a href="#h22-4-37" id="h22-4-37" class="d">-                                        &quot;description&quot;: &quot;Changes Snapchats background color&quot;
</a><a href="#h22-4-38" id="h22-4-38" class="d">-                                    },
</a><a href="#h22-4-39" id="h22-4-39" class="d">-                                    &quot;background_color_surface&quot;: {
</a><a href="#h22-4-40" id="h22-4-40" class="d">-                                        &quot;name&quot;: &quot;Background Surface Color&quot;,
</a><a href="#h22-4-41" id="h22-4-41" class="d">-                                        &quot;description&quot;: &quot;Changes Snapchats background surface color&quot;
</a><a href="#h22-4-42" id="h22-4-42" class="d">-                                    },
</a><a href="#h22-4-43" id="h22-4-43" class="d">-                                    &quot;friend_feed_conversations_line_color&quot;: {
</a><a href="#h22-4-44" id="h22-4-44" class="d">-                                        &quot;name&quot;: &quot;Conversations Line Color&quot;,
</a><a href="#h22-4-45" id="h22-4-45" class="d">-                                        &quot;description&quot;: &quot;Changes the line divider color that splits Conversations on the friend feed &quot;
</a><a href="#h22-4-46" id="h22-4-46" class="d">-                                    },
</a><a href="#h22-4-47" id="h22-4-47" class="d">-                                    &quot;action_menu_background_color&quot;: {
</a><a href="#h22-4-48" id="h22-4-48" class="d">-                                        &quot;name&quot;: &quot;Action Menu Background Color&quot;,
</a><a href="#h22-4-49" id="h22-4-49" class="d">-                                        &quot;description&quot;: &quot;Changes Snapchats chat action menu background color&quot;
</a><a href="#h22-4-50" id="h22-4-50" class="d">-                                    },
</a><a href="#h22-4-51" id="h22-4-51" class="d">-                                    &quot;action_menu_round_background_color&quot;: {
</a><a href="#h22-4-52" id="h22-4-52" class="d">-                                        &quot;name&quot;: &quot;Action Menu Round Background Color&quot;,
</a><a href="#h22-4-53" id="h22-4-53" class="d">-                                        &quot;description&quot;: &quot;Changes Snapchats chat action menu round background color&quot;
</a><a href="#h22-4-54" id="h22-4-54" class="d">-                                    },
</a><a href="#h22-4-55" id="h22-4-55" class="d">-                                    &quot;camera_grid_lines&quot;: {
</a><a href="#h22-4-56" id="h22-4-56" class="d">-                                        &quot;name&quot;: &quot;Camera Gridlines Color&quot;,
</a><a href="#h22-4-57" id="h22-4-57" class="d">-                                        &quot;description&quot;: &quot;Changes Snapchats Gridlines color on the Camera Preview\nNote: Enable the grid on the my camera settings&quot;
</a><a href="#h22-4-58" id="h22-4-58" class="d">-                                    }
</a><a href="#h22-4-59" id="h22-4-59" class="d">-                                }
</a><a href="#h22-4-60" id="h22-4-60" class="d">-                            }
</a><a href="#h22-4-61" id="h22-4-61" class="d">-                        }
</a><a href="#h22-4-62" id="h22-4-62" class="i">+                    &quot;custom_theme&quot;: {
</a><a href="#h22-4-63" id="h22-4-63" class="i">+                        &quot;name&quot;: &quot;Custom Theme&quot;,
</a><a href="#h22-4-64" id="h22-4-64" class="i">+                        &quot;description&quot;: &quot;Customize Snapchat&#39;s Colors\nNote: if you choose a dark theme (like Amoled), you may need to enable the dark mode in Snapchat settings for better results&quot;
</a>                     },
                     &quot;friend_feed_message_preview&quot;: {
                         &quot;name&quot;: &quot;Friend Feed Message Preview&quot;,
<a href="#h22-5" id="h22-5" class="h">@@ -1201,20 +1159,11 @@
</a>                 &quot;always_light&quot;: &quot;Always Light&quot;,
                 &quot;always_dark&quot;: &quot;Always Dark&quot;
             },
<a href="#h22-5-3" id="h22-5-3" class="d">-            &quot;theme_picker&quot;: {
</a><a href="#h22-5-4" id="h22-5-4" class="d">-                &quot;amoled_dark_mode&quot;: &quot;AMOLED Dark Mode&quot;,
</a><a href="#h22-5-5" id="h22-5-5" class="d">-                &quot;custom&quot;: &quot;Custom Colors&quot;,
</a><a href="#h22-5-6" id="h22-5-6" class="i">+            &quot;custom_theme&quot;: {
</a><a href="#h22-5-7" id="h22-5-7" class="i">+                &quot;amoled_dark_mode&quot;: &quot;Amoled Dark Mode&quot;,
</a><a href="#h22-5-8" id="h22-5-8" class="i">+                &quot;custom&quot;: &quot;Custom Themes (Use the Quick Actions to manage themes)&quot;,
</a>                 &quot;material_you_light&quot;: &quot;Material You Light (Android 12+)&quot;,
<a href="#h22-5-10" id="h22-5-10" class="d">-                &quot;material_you_dark&quot;: &quot;Material You Dark (Android 12+)&quot;,
</a><a href="#h22-5-11" id="h22-5-11" class="d">-                &quot;light_blue&quot;: &quot;Light Blue&quot;,
</a><a href="#h22-5-12" id="h22-5-12" class="d">-                &quot;dark_blue&quot;: &quot;Dark Blue&quot;,
</a><a href="#h22-5-13" id="h22-5-13" class="d">-                &quot;earthy_autumn&quot;: &quot;Earthy Autumn&quot;,
</a><a href="#h22-5-14" id="h22-5-14" class="d">-                &quot;mint_chocolate&quot;: &quot;Mint Chocolate&quot;,
</a><a href="#h22-5-15" id="h22-5-15" class="d">-                &quot;ginger_snap&quot;: &quot;Ginger Snap&quot;,
</a><a href="#h22-5-16" id="h22-5-16" class="d">-                &quot;lemon_meringue&quot;: &quot;Lemon Meringue&quot;,
</a><a href="#h22-5-17" id="h22-5-17" class="d">-                &quot;lava_flow&quot;: &quot;Lava Flow&quot;,
</a><a href="#h22-5-18" id="h22-5-18" class="d">-                &quot;ocean_fog&quot;: &quot;Ocean Fog&quot;,
</a><a href="#h22-5-19" id="h22-5-19" class="d">-                &quot;alien_landscape&quot;: &quot;Alien Landscape&quot;
</a><a href="#h22-5-20" id="h22-5-20" class="i">+                &quot;material_you_dark&quot;: &quot;Material You Dark (Android 12+)&quot;
</a>             },
             &quot;friend_feed_menu_buttons&quot;: {
                 &quot;auto_download&quot;: &quot;\u2B07\uFE0F Auto Download&quot;,
<a href="#h22-6" id="h22-6" class="h">@@ -1681,5 +1630,48 @@
</a>         &quot;date_input_invalid_year_range&quot;: &quot;Invalid year&quot;,
         &quot;date_input_invalid_not_allowed&quot;: &quot;Invalid date&quot;,
         &quot;date_range_input_invalid_range_input&quot;: &quot;Invalid date range&quot;
<a href="#h22-6-3" id="h22-6-3" class="i">+    },
</a><a href="#h22-6-4" id="h22-6-4" class="i">+
</a><a href="#h22-6-5" id="h22-6-5" class="i">+    &quot;theming_attributes&quot;: {
</a><a href="#h22-6-6" id="h22-6-6" class="i">+        &quot;sigColorTextPrimary&quot;: &quot;Main Text Color&quot;,
</a><a href="#h22-6-7" id="h22-6-7" class="i">+        &quot;sigColorChatChat&quot;: &quot;Main Friend Feed Text Color&quot;,
</a><a href="#h22-6-8" id="h22-6-8" class="i">+        &quot;sigColorBackgroundSurface&quot;: &quot;Background Surface Color&quot;,
</a><a href="#h22-6-9" id="h22-6-9" class="i">+        &quot;sigColorChatPendingSending&quot;: &quot;Secondary Friend Feed Text Color&quot;,
</a><a href="#h22-6-10" id="h22-6-10" class="i">+        &quot;sigColorChatSnapWithSound&quot;: &quot;Snaps With Sound Text Color&quot;,
</a><a href="#h22-6-11" id="h22-6-11" class="i">+        &quot;sigColorChatSnapWithoutSound&quot;: &quot;Snaps Without Sound Text Color&quot;,
</a><a href="#h22-6-12" id="h22-6-12" class="i">+        &quot;actionSheetDescriptionTextColor&quot;: &quot;Action Menu Description Text Color&quot;,
</a><a href="#h22-6-13" id="h22-6-13" class="i">+        &quot;sigColorBackgroundMain&quot;: &quot;Background Color&quot;,
</a><a href="#h22-6-14" id="h22-6-14" class="i">+        &quot;listBackgroundDrawable&quot;: &quot;Conversation list Background&quot;,
</a><a href="#h22-6-15" id="h22-6-15" class="i">+        &quot;sigColorChatConversationsLine&quot;: &quot;Conversations Line Color&quot;,
</a><a href="#h22-6-16" id="h22-6-16" class="i">+        &quot;actionSheetBackgroundDrawable&quot;: &quot;Action Menu Background Color&quot;,
</a><a href="#h22-6-17" id="h22-6-17" class="i">+        &quot;actionSheetRoundedBackgroundDrawable&quot;: &quot;Action Menu Round Background Color&quot;,
</a><a href="#h22-6-18" id="h22-6-18" class="i">+        &quot;sigColorIconPrimary&quot;: &quot;Action Menu Icon Color&quot;,
</a><a href="#h22-6-19" id="h22-6-19" class="i">+        &quot;sigExceptionColorCameraGridLines&quot;: &quot;Camera Gridlines Color&quot;,
</a><a href="#h22-6-20" id="h22-6-20" class="i">+        &quot;listDivider&quot;: &quot;List Divider Color&quot;,
</a><a href="#h22-6-21" id="h22-6-21" class="i">+        &quot;sigColorIconSecondary&quot;: &quot;Secondary Icon Color&quot;,
</a><a href="#h22-6-22" id="h22-6-22" class="i">+        &quot;itemShapeFillColor&quot;: &quot;Item Shape Fill Color&quot;,
</a><a href="#h22-6-23" id="h22-6-23" class="i">+        &quot;ringColor&quot;: &quot;Ring Color&quot;,
</a><a href="#h22-6-24" id="h22-6-24" class="i">+        &quot;ringStartColor&quot;: &quot;Ring Start Color&quot;,
</a><a href="#h22-6-25" id="h22-6-25" class="i">+        &quot;sigColorLayoutPlaceholder&quot;: &quot;Layout Placeholder Color&quot;,
</a><a href="#h22-6-26" id="h22-6-26" class="i">+        &quot;scButtonColor&quot;: &quot;Snapchat Button Color&quot;,
</a><a href="#h22-6-27" id="h22-6-27" class="i">+        &quot;recipientPillBackgroundDrawable&quot;: &quot;Recipient Pill Background&quot;,
</a><a href="#h22-6-28" id="h22-6-28" class="i">+        &quot;boxBackgroundColor&quot;: &quot;Box Background Color&quot;,
</a><a href="#h22-6-29" id="h22-6-29" class="i">+        &quot;editTextColor&quot;: &quot;Edit Text Color&quot;,
</a><a href="#h22-6-30" id="h22-6-30" class="i">+        &quot;chipBackgroundColor&quot;: &quot;Chip Background Color&quot;,
</a><a href="#h22-6-31" id="h22-6-31" class="i">+        &quot;recipientInputStyle&quot;: &quot;Recipient Input Style&quot;,
</a><a href="#h22-6-32" id="h22-6-32" class="i">+        &quot;rangeFillColor&quot;: &quot;Range Fill Color&quot;,
</a><a href="#h22-6-33" id="h22-6-33" class="i">+        &quot;pstsIndicatorColor&quot;: &quot;PSTS Indicator Color&quot;,
</a><a href="#h22-6-34" id="h22-6-34" class="i">+        &quot;pstsTabBackground&quot;: &quot;PSTS Tab Background&quot;,
</a><a href="#h22-6-35" id="h22-6-35" class="i">+        &quot;pstsDividerColor&quot;: &quot;PSTS Divider Color&quot;,
</a><a href="#h22-6-36" id="h22-6-36" class="i">+        &quot;tabTextColor&quot;: &quot;Tab Text Color&quot;,
</a><a href="#h22-6-37" id="h22-6-37" class="i">+        &quot;statusBarForeground&quot;: &quot;Status Bar Foreground Color&quot;,
</a><a href="#h22-6-38" id="h22-6-38" class="i">+        &quot;statusBarBackground&quot;: &quot;Status Bar Background Color&quot;,
</a><a href="#h22-6-39" id="h22-6-39" class="i">+        &quot;strokeColor&quot;: &quot;Stroke Color&quot;,
</a><a href="#h22-6-40" id="h22-6-40" class="i">+        &quot;storyReplayViewRingColor&quot;: &quot;Story Replay View Ring Color&quot;,
</a><a href="#h22-6-41" id="h22-6-41" class="i">+        &quot;sigColorButtonPrimary&quot;: &quot;Primary Button Color&quot;,
</a><a href="#h22-6-42" id="h22-6-42" class="i">+        &quot;sigColorBaseAppYellow&quot;: &quot;Base App Yellow Color&quot;,
</a><a href="#h22-6-43" id="h22-6-43" class="i">+        &quot;sigColorBackgroundSurfaceTranslucent&quot;: &quot;Translucent Background Surface Color&quot;,
</a><a href="#h22-6-44" id="h22-6-44" class="i">+        &quot;sigColorStoryRingFriendsFeedStoryRing&quot;: &quot;Story Ring Friends Feed Story Ring Color&quot;,
</a><a href="#h22-6-45" id="h22-6-45" class="i">+        &quot;sigColorStoryRingDiscoverTabThumbnailStoryRing&quot;: &quot;Story Ring Discover Tab Thumbnail Story Ring Color&quot;
</a>     }
 }
<b>diff --git a/<a id="h23" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/BridgeFiles.kt</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -16,7 +16,8 @@ enum class FileHandleScope(
</a>     INTERNAL(&quot;internal&quot;),
     LOCALE(&quot;locale&quot;),
     USER_IMPORT(&quot;user_import&quot;),
<a href="#h23-0-3" id="h23-0-3" class="d">-    COMPOSER(&quot;composer&quot;);
</a><a href="#h23-0-4" id="h23-0-4" class="i">+    COMPOSER(&quot;composer&quot;),
</a><a href="#h23-0-5" id="h23-0-5" class="i">+    THEME(&quot;theme&quot;);
</a> 
     companion object {
         fun fromValue(name: String): FileHandleScope? = entries.find { it.key == name }
<a href="#h23-1" id="h23-1" class="h">@@ -31,8 +32,8 @@ enum class InternalFileHandleType(
</a>     CONFIG(&quot;config&quot;, &quot;config.json&quot;),
     MAPPINGS(&quot;mappings&quot;, &quot;mappings.json&quot;),
     MESSAGE_LOGGER(&quot;message_logger&quot;, &quot;message_logger.db&quot;, isDatabase = true),
<a href="#h23-1-3" id="h23-1-3" class="d">-    PINNED_BEST_FRIEND(&quot;pinned_best_friend&quot;, &quot;pinned_best_friend.txt&quot;);
</a><a href="#h23-1-4" id="h23-1-4" class="d">-
</a><a href="#h23-1-5" id="h23-1-5" class="i">+    PINNED_BEST_FRIEND(&quot;pinned_best_friend&quot;, &quot;pinned_best_friend.txt&quot;),
</a><a href="#h23-1-6" id="h23-1-6" class="i">+    SIF(&quot;sif&quot;, &quot;libsif.so&quot;);
</a> 
     fun resolve(context: Context): File = if (isDatabase) {
         context.getDatabasePath(fileName)
<b>diff --git a/<a id="h24" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LoggerWrapper.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LoggerWrapper.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LoggerWrapper.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LoggerWrapper.kt</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -39,7 +39,7 @@ class ConversationInfo(
</a>     val usernames: List&lt;String&gt;
 )
 
<a href="#h24-0-3" id="h24-0-3" class="d">-class TrackerLog(
</a><a href="#h24-0-4" id="h24-0-4" class="i">+data class TrackerLog(
</a>     val id: Int,
     val timestamp: Long,
     val conversationId: String,
<b>diff --git a/<a id="h25" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/Experimental.kt</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -31,7 +31,7 @@ class Experimental : ConfigContainer() {
</a>         val composerLogs = boolean(&quot;composer_logs&quot;)
     }
 
<a href="#h25-0-3" id="h25-0-3" class="d">-    class NativeHooks : ConfigContainer(hasGlobalState = true) {
</a><a href="#h25-0-4" id="h25-0-4" class="i">+    class NativeHooks : ConfigContainer() {
</a>         val composerHooks = container(&quot;composer_hooks&quot;, ComposerHooksConfig()) { requireRestart() }
         val disableBitmoji = boolean(&quot;disable_bitmoji&quot;)
         val customEmojiFont = string(&quot;custom_emoji_font&quot;) {
<a href="#h25-1" id="h25-1" class="h">@@ -40,7 +40,6 @@ class Experimental : ConfigContainer() {
</a>             addFlags(ConfigFlag.USER_IMPORT)
             filenameFilter = { it.endsWith(&quot;.ttf&quot;) }
         }
<a href="#h25-1-3" id="h25-1-3" class="d">-        val remapExecutable = boolean(&quot;remap_executable&quot;) { requireRestart(); addNotices(FeatureNotice.INTERNAL_BEHAVIOR, FeatureNotice.UNSTABLE) }
</a>     }
 
     class E2EEConfig : ConfigContainer(hasGlobalState = true) {
<b>diff --git a/<a id="h26" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/config/impl/UserInterfaceTweaks.kt</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -19,46 +19,18 @@ class UserInterfaceTweaks : ConfigContainer() {
</a>     }
 
 
<a href="#h26-0-3" id="h26-0-3" class="d">-    class ColorsConfig : ConfigContainer() {
</a><a href="#h26-0-4" id="h26-0-4" class="d">-        val textColor = color(&quot;text_color&quot;)
</a><a href="#h26-0-5" id="h26-0-5" class="d">-        val chatChatTextColor = color(&quot;chat_chat_text_color&quot;)
</a><a href="#h26-0-6" id="h26-0-6" class="d">-        val pendingSendingTextColor = color(&quot;pending_sending_text_color&quot;)
</a><a href="#h26-0-7" id="h26-0-7" class="d">-        val snapWithSoundTextColor = color(&quot;snap_with_sound_text_color&quot;)
</a><a href="#h26-0-8" id="h26-0-8" class="d">-        val snapWithoutSoundTextColor = color(&quot;snap_without_sound_text_color&quot;)
</a><a href="#h26-0-9" id="h26-0-9" class="d">-        val backgroundColor = color(&quot;background_color&quot;)
</a><a href="#h26-0-10" id="h26-0-10" class="d">-        val backgroundColorSurface = color(&quot;background_color_surface&quot;)
</a><a href="#h26-0-11" id="h26-0-11" class="d">-        val friendFeedConversationsLineColor = color(&quot;friend_feed_conversations_line_color&quot;)
</a><a href="#h26-0-12" id="h26-0-12" class="d">-        val actionMenuBackgroundColor = color(&quot;action_menu_background_color&quot;)
</a><a href="#h26-0-13" id="h26-0-13" class="d">-        val actionMenuRoundBackgroundColor = color(&quot;action_menu_round_background_color&quot;)
</a><a href="#h26-0-14" id="h26-0-14" class="d">-        val cameraGridLines = color(&quot;camera_grid_lines&quot;)
</a><a href="#h26-0-15" id="h26-0-15" class="d">-    }
</a><a href="#h26-0-16" id="h26-0-16" class="d">-
</a><a href="#h26-0-17" id="h26-0-17" class="d">-    inner class CustomizeUIConfig : ConfigContainer() {
</a><a href="#h26-0-18" id="h26-0-18" class="d">-        val themePicker = unique(&quot;theme_picker&quot;,
</a><a href="#h26-0-19" id="h26-0-19" class="d">-            &quot;custom&quot;,
</a><a href="#h26-0-20" id="h26-0-20" class="d">-            &quot;amoled_dark_mode&quot;,
</a><a href="#h26-0-21" id="h26-0-21" class="d">-            &quot;material_you_light&quot;,
</a><a href="#h26-0-22" id="h26-0-22" class="d">-            &quot;material_you_dark&quot;,
</a><a href="#h26-0-23" id="h26-0-23" class="d">-            &quot;light_blue&quot;,
</a><a href="#h26-0-24" id="h26-0-24" class="d">-            &quot;dark_blue&quot;,
</a><a href="#h26-0-25" id="h26-0-25" class="d">-            &quot;earthy_autumn&quot;,
</a><a href="#h26-0-26" id="h26-0-26" class="d">-            &quot;mint_chocolate&quot;,
</a><a href="#h26-0-27" id="h26-0-27" class="d">-            &quot;ginger_snap&quot;,
</a><a href="#h26-0-28" id="h26-0-28" class="d">-            &quot;lemon_meringue&quot;,
</a><a href="#h26-0-29" id="h26-0-29" class="d">-            &quot;lava_flow&quot;,
</a><a href="#h26-0-30" id="h26-0-30" class="d">-            &quot;ocean_fog&quot;,
</a><a href="#h26-0-31" id="h26-0-31" class="d">-            &quot;alien_landscape&quot;,
</a><a href="#h26-0-32" id="h26-0-32" class="d">-        )
</a><a href="#h26-0-33" id="h26-0-33" class="d">-        val colors = container(&quot;colors&quot;, ColorsConfig()) { requireRestart() }
</a><a href="#h26-0-34" id="h26-0-34" class="d">-    }
</a><a href="#h26-0-35" id="h26-0-35" class="d">-
</a>     val friendFeedMenuButtons = multiple(
         &quot;friend_feed_menu_buttons&quot;,&quot;conversation_info&quot;, &quot;mark_snaps_as_seen&quot;, &quot;mark_stories_as_seen_locally&quot;, *MessagingRuleType.entries.filter { it.showInFriendMenu }.map { it.key }.toTypedArray()
     ).apply {
         set(mutableListOf(&quot;conversation_info&quot;, MessagingRuleType.STEALTH.key))
     }
     val autoCloseFriendFeedMenu = boolean(&quot;auto_close_friend_feed_menu&quot;)
<a href="#h26-0-42" id="h26-0-42" class="d">-    val customizeUi = container(&quot;customize_ui&quot;, CustomizeUIConfig()) { addNotices(FeatureNotice.UNSTABLE); requireRestart() }
</a><a href="#h26-0-43" id="h26-0-43" class="i">+    val customTheme = unique(&quot;custom_theme&quot;,
</a><a href="#h26-0-44" id="h26-0-44" class="i">+        &quot;amoled_dark_mode&quot;,
</a><a href="#h26-0-45" id="h26-0-45" class="i">+        &quot;material_you_light&quot;,
</a><a href="#h26-0-46" id="h26-0-46" class="i">+        &quot;material_you_dark&quot;,
</a><a href="#h26-0-47" id="h26-0-47" class="i">+        &quot;custom&quot;,
</a><a href="#h26-0-48" id="h26-0-48" class="i">+    ) { addNotices(FeatureNotice.UNSTABLE); requireRestart() }
</a>     val friendFeedMessagePreview = container(&quot;friend_feed_message_preview&quot;, FriendFeedMessagePreview()) { requireRestart() }
     val snapPreview = boolean(&quot;snap_preview&quot;) { addNotices(FeatureNotice.UNSTABLE); requireRestart() }
     val bootstrapOverride = container(&quot;bootstrap_override&quot;, BootstrapOverride()) { requireRestart() }
<b>diff --git a/<a id="h27" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/data/ThemingObjects.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/data/ThemingObjects.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/data/ThemingObjects.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/data/ThemingObjects.kt</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -0,0 +1,120 @@
</a><a href="#h27-0-0" id="h27-0-0" class="i">+package me.rhunk.snapenhance.common.data
</a><a href="#h27-0-1" id="h27-0-1" class="i">+
</a><a href="#h27-0-2" id="h27-0-2" class="i">+import android.os.Parcelable
</a><a href="#h27-0-3" id="h27-0-3" class="i">+import com.google.gson.annotations.SerializedName
</a><a href="#h27-0-4" id="h27-0-4" class="i">+import kotlinx.parcelize.Parcelize
</a><a href="#h27-0-5" id="h27-0-5" class="i">+
</a><a href="#h27-0-6" id="h27-0-6" class="i">+
</a><a href="#h27-0-7" id="h27-0-7" class="i">+@Parcelize
</a><a href="#h27-0-8" id="h27-0-8" class="i">+data class ThemeColorEntry(
</a><a href="#h27-0-9" id="h27-0-9" class="i">+    @SerializedName(&quot;key&quot;)
</a><a href="#h27-0-10" id="h27-0-10" class="i">+    val key: String,
</a><a href="#h27-0-11" id="h27-0-11" class="i">+    @SerializedName(&quot;value&quot;)
</a><a href="#h27-0-12" id="h27-0-12" class="i">+    var value: Int,
</a><a href="#h27-0-13" id="h27-0-13" class="i">+): Parcelable
</a><a href="#h27-0-14" id="h27-0-14" class="i">+
</a><a href="#h27-0-15" id="h27-0-15" class="i">+@Parcelize
</a><a href="#h27-0-16" id="h27-0-16" class="i">+data class DatabaseThemeContent(
</a><a href="#h27-0-17" id="h27-0-17" class="i">+    @SerializedName(&quot;colors&quot;)
</a><a href="#h27-0-18" id="h27-0-18" class="i">+    val colors: List&lt;ThemeColorEntry&gt; = emptyList(),
</a><a href="#h27-0-19" id="h27-0-19" class="i">+): Parcelable
</a><a href="#h27-0-20" id="h27-0-20" class="i">+
</a><a href="#h27-0-21" id="h27-0-21" class="i">+data class DatabaseTheme(
</a><a href="#h27-0-22" id="h27-0-22" class="i">+    val id: Int,
</a><a href="#h27-0-23" id="h27-0-23" class="i">+    val enabled: Boolean,
</a><a href="#h27-0-24" id="h27-0-24" class="i">+    val name: String,
</a><a href="#h27-0-25" id="h27-0-25" class="i">+    val description: String?,
</a><a href="#h27-0-26" id="h27-0-26" class="i">+    val version: String?,
</a><a href="#h27-0-27" id="h27-0-27" class="i">+    val author: String?,
</a><a href="#h27-0-28" id="h27-0-28" class="i">+    val updateUrl: String?,
</a><a href="#h27-0-29" id="h27-0-29" class="i">+) {
</a><a href="#h27-0-30" id="h27-0-30" class="i">+    fun toExportedTheme(content: DatabaseThemeContent): ExportedTheme {
</a><a href="#h27-0-31" id="h27-0-31" class="i">+        return ExportedTheme(
</a><a href="#h27-0-32" id="h27-0-32" class="i">+            name = name,
</a><a href="#h27-0-33" id="h27-0-33" class="i">+            description = description,
</a><a href="#h27-0-34" id="h27-0-34" class="i">+            version = version,
</a><a href="#h27-0-35" id="h27-0-35" class="i">+            author = author,
</a><a href="#h27-0-36" id="h27-0-36" class="i">+            content = content,
</a><a href="#h27-0-37" id="h27-0-37" class="i">+        )
</a><a href="#h27-0-38" id="h27-0-38" class="i">+    }
</a><a href="#h27-0-39" id="h27-0-39" class="i">+}
</a><a href="#h27-0-40" id="h27-0-40" class="i">+
</a><a href="#h27-0-41" id="h27-0-41" class="i">+data class ExportedTheme(
</a><a href="#h27-0-42" id="h27-0-42" class="i">+    val name: String,
</a><a href="#h27-0-43" id="h27-0-43" class="i">+    val description: String?,
</a><a href="#h27-0-44" id="h27-0-44" class="i">+    val version: String?,
</a><a href="#h27-0-45" id="h27-0-45" class="i">+    val author: String?,
</a><a href="#h27-0-46" id="h27-0-46" class="i">+    val content: DatabaseThemeContent,
</a><a href="#h27-0-47" id="h27-0-47" class="i">+) {
</a><a href="#h27-0-48" id="h27-0-48" class="i">+    fun toDatabaseTheme(id: Int = -1, updateUrl: String? = null, enabled: Boolean = false): DatabaseTheme {
</a><a href="#h27-0-49" id="h27-0-49" class="i">+        return DatabaseTheme(
</a><a href="#h27-0-50" id="h27-0-50" class="i">+            id = id,
</a><a href="#h27-0-51" id="h27-0-51" class="i">+            enabled = enabled,
</a><a href="#h27-0-52" id="h27-0-52" class="i">+            name = name,
</a><a href="#h27-0-53" id="h27-0-53" class="i">+            description = description,
</a><a href="#h27-0-54" id="h27-0-54" class="i">+            version = version,
</a><a href="#h27-0-55" id="h27-0-55" class="i">+            author = author,
</a><a href="#h27-0-56" id="h27-0-56" class="i">+            updateUrl = updateUrl,
</a><a href="#h27-0-57" id="h27-0-57" class="i">+        )
</a><a href="#h27-0-58" id="h27-0-58" class="i">+    }
</a><a href="#h27-0-59" id="h27-0-59" class="i">+}
</a><a href="#h27-0-60" id="h27-0-60" class="i">+
</a><a href="#h27-0-61" id="h27-0-61" class="i">+data class RepositoryThemeManifest(
</a><a href="#h27-0-62" id="h27-0-62" class="i">+    val name: String,
</a><a href="#h27-0-63" id="h27-0-63" class="i">+    val author: String?,
</a><a href="#h27-0-64" id="h27-0-64" class="i">+    val description: String?,
</a><a href="#h27-0-65" id="h27-0-65" class="i">+    val version: String?,
</a><a href="#h27-0-66" id="h27-0-66" class="i">+    val filepath: String,
</a><a href="#h27-0-67" id="h27-0-67" class="i">+)
</a><a href="#h27-0-68" id="h27-0-68" class="i">+
</a><a href="#h27-0-69" id="h27-0-69" class="i">+data class RepositoryIndex(
</a><a href="#h27-0-70" id="h27-0-70" class="i">+    val themes: List&lt;RepositoryThemeManifest&gt; = emptyList(),
</a><a href="#h27-0-71" id="h27-0-71" class="i">+)
</a><a href="#h27-0-72" id="h27-0-72" class="i">+
</a><a href="#h27-0-73" id="h27-0-73" class="i">+enum class ThemingAttributeType {
</a><a href="#h27-0-74" id="h27-0-74" class="i">+    COLOR
</a><a href="#h27-0-75" id="h27-0-75" class="i">+}
</a><a href="#h27-0-76" id="h27-0-76" class="i">+
</a><a href="#h27-0-77" id="h27-0-77" class="i">+val AvailableThemingAttributes = mapOf(
</a><a href="#h27-0-78" id="h27-0-78" class="i">+    ThemingAttributeType.COLOR to listOf(
</a><a href="#h27-0-79" id="h27-0-79" class="i">+        &quot;sigColorTextPrimary&quot;,
</a><a href="#h27-0-80" id="h27-0-80" class="i">+        &quot;sigColorBackgroundSurface&quot;,
</a><a href="#h27-0-81" id="h27-0-81" class="i">+        &quot;sigColorBackgroundMain&quot;,
</a><a href="#h27-0-82" id="h27-0-82" class="i">+        &quot;actionSheetBackgroundDrawable&quot;,
</a><a href="#h27-0-83" id="h27-0-83" class="i">+        &quot;actionSheetRoundedBackgroundDrawable&quot;,
</a><a href="#h27-0-84" id="h27-0-84" class="i">+        &quot;sigColorChatChat&quot;,
</a><a href="#h27-0-85" id="h27-0-85" class="i">+        &quot;sigColorChatPendingSending&quot;,
</a><a href="#h27-0-86" id="h27-0-86" class="i">+        &quot;sigColorChatSnapWithSound&quot;,
</a><a href="#h27-0-87" id="h27-0-87" class="i">+        &quot;sigColorChatSnapWithoutSound&quot;,
</a><a href="#h27-0-88" id="h27-0-88" class="i">+        &quot;sigExceptionColorCameraGridLines&quot;,
</a><a href="#h27-0-89" id="h27-0-89" class="i">+        &quot;listDivider&quot;,
</a><a href="#h27-0-90" id="h27-0-90" class="i">+        &quot;listBackgroundDrawable&quot;,
</a><a href="#h27-0-91" id="h27-0-91" class="i">+        &quot;sigColorIconPrimary&quot;,
</a><a href="#h27-0-92" id="h27-0-92" class="i">+        &quot;actionSheetDescriptionTextColor&quot;,
</a><a href="#h27-0-93" id="h27-0-93" class="i">+        &quot;ringColor&quot;,
</a><a href="#h27-0-94" id="h27-0-94" class="i">+        &quot;sigColorIconSecondary&quot;,
</a><a href="#h27-0-95" id="h27-0-95" class="i">+        &quot;itemShapeFillColor&quot;,
</a><a href="#h27-0-96" id="h27-0-96" class="i">+        &quot;ringStartColor&quot;,
</a><a href="#h27-0-97" id="h27-0-97" class="i">+        &quot;sigColorLayoutPlaceholder&quot;,
</a><a href="#h27-0-98" id="h27-0-98" class="i">+        &quot;scButtonColor&quot;,
</a><a href="#h27-0-99" id="h27-0-99" class="i">+        &quot;recipientPillBackgroundDrawable&quot;,
</a><a href="#h27-0-100" id="h27-0-100" class="i">+        &quot;boxBackgroundColor&quot;,
</a><a href="#h27-0-101" id="h27-0-101" class="i">+        &quot;editTextColor&quot;,
</a><a href="#h27-0-102" id="h27-0-102" class="i">+        &quot;chipBackgroundColor&quot;,
</a><a href="#h27-0-103" id="h27-0-103" class="i">+        &quot;recipientInputStyle&quot;,
</a><a href="#h27-0-104" id="h27-0-104" class="i">+        &quot;rangeFillColor&quot;,
</a><a href="#h27-0-105" id="h27-0-105" class="i">+        &quot;pstsIndicatorColor&quot;,
</a><a href="#h27-0-106" id="h27-0-106" class="i">+        &quot;pstsTabBackground&quot;,
</a><a href="#h27-0-107" id="h27-0-107" class="i">+        &quot;pstsDividerColor&quot;,
</a><a href="#h27-0-108" id="h27-0-108" class="i">+        &quot;tabTextColor&quot;,
</a><a href="#h27-0-109" id="h27-0-109" class="i">+        &quot;statusBarForeground&quot;,
</a><a href="#h27-0-110" id="h27-0-110" class="i">+        &quot;statusBarBackground&quot;,
</a><a href="#h27-0-111" id="h27-0-111" class="i">+        &quot;strokeColor&quot;,
</a><a href="#h27-0-112" id="h27-0-112" class="i">+        &quot;storyReplayViewRingColor&quot;,
</a><a href="#h27-0-113" id="h27-0-113" class="i">+        &quot;sigColorButtonPrimary&quot;,
</a><a href="#h27-0-114" id="h27-0-114" class="i">+        &quot;sigColorBaseAppYellow&quot;,
</a><a href="#h27-0-115" id="h27-0-115" class="i">+        &quot;sigColorBackgroundSurfaceTranslucent&quot;,
</a><a href="#h27-0-116" id="h27-0-116" class="i">+        &quot;sigColorStoryRingFriendsFeedStoryRing&quot;,
</a><a href="#h27-0-117" id="h27-0-117" class="i">+        &quot;sigColorStoryRingDiscoverTabThumbnailStoryRing&quot;,
</a><a href="#h27-0-118" id="h27-0-118" class="i">+    )
</a><a href="#h27-0-119" id="h27-0-119" class="i">+)
</a><b>diff --git a/<a id="h28" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/ui/TextFieldColors.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/ui/TextFieldColors.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/ui/TextFieldColors.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/ui/TextFieldColors.kt</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h28-0-0" id="h28-0-0" class="i">+package me.rhunk.snapenhance.common.ui
</a><a href="#h28-0-1" id="h28-0-1" class="i">+
</a><a href="#h28-0-2" id="h28-0-2" class="i">+import androidx.compose.material3.MaterialTheme
</a><a href="#h28-0-3" id="h28-0-3" class="i">+import androidx.compose.material3.TextFieldDefaults
</a><a href="#h28-0-4" id="h28-0-4" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h28-0-5" id="h28-0-5" class="i">+import androidx.compose.ui.graphics.Color
</a><a href="#h28-0-6" id="h28-0-6" class="i">+
</a><a href="#h28-0-7" id="h28-0-7" class="i">+
</a><a href="#h28-0-8" id="h28-0-8" class="i">+@Composable
</a><a href="#h28-0-9" id="h28-0-9" class="i">+fun transparentTextFieldColors() = TextFieldDefaults.colors(
</a><a href="#h28-0-10" id="h28-0-10" class="i">+    unfocusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h28-0-11" id="h28-0-11" class="i">+    focusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h28-0-12" id="h28-0-12" class="i">+    focusedIndicatorColor = Color.Transparent,
</a><a href="#h28-0-13" id="h28-0-13" class="i">+    unfocusedIndicatorColor = Color.Transparent,
</a><a href="#h28-0-14" id="h28-0-14" class="i">+    disabledIndicatorColor = Color.Transparent,
</a><a href="#h28-0-15" id="h28-0-15" class="i">+    cursorColor = MaterialTheme.colorScheme.primary
</a><a href="#h28-0-16" id="h28-0-16" class="i">+)
</a><b>diff --git a/<a id="h29" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/util/ktx/AndroidCompatExtensions.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/util/ktx/AndroidCompatExtensions.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/util/ktx/AndroidCompatExtensions.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/util/ktx/AndroidCompatExtensions.kt</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -20,8 +20,23 @@ fun PackageManager.getApplicationInfoCompat(packageName: String, flags: Int) =
</a>     }
 
 fun Context.copyToClipboard(data: String, label: String = &quot;Copied Text&quot;) {
<a href="#h29-0-3" id="h29-0-3" class="d">-    getSystemService(android.content.ClipboardManager::class.java).setPrimaryClip(
</a><a href="#h29-0-4" id="h29-0-4" class="d">-        ClipData.newPlainText(label, data))
</a><a href="#h29-0-5" id="h29-0-5" class="i">+    runCatching {
</a><a href="#h29-0-6" id="h29-0-6" class="i">+        getSystemService(android.content.ClipboardManager::class.java).setPrimaryClip(
</a><a href="#h29-0-7" id="h29-0-7" class="i">+            ClipData.newPlainText(label, data))
</a><a href="#h29-0-8" id="h29-0-8" class="i">+    }
</a><a href="#h29-0-9" id="h29-0-9" class="i">+}
</a><a href="#h29-0-10" id="h29-0-10" class="i">+
</a><a href="#h29-0-11" id="h29-0-11" class="i">+fun Context.getTextFromClipboard(): String? {
</a><a href="#h29-0-12" id="h29-0-12" class="i">+    return runCatching {
</a><a href="#h29-0-13" id="h29-0-13" class="i">+        getSystemService(android.content.ClipboardManager::class.java).primaryClip
</a><a href="#h29-0-14" id="h29-0-14" class="i">+            ?.takeIf { it.itemCount &gt; 0 }
</a><a href="#h29-0-15" id="h29-0-15" class="i">+            ?.getItemAt(0)
</a><a href="#h29-0-16" id="h29-0-16" class="i">+            ?.text?.toString()
</a><a href="#h29-0-17" id="h29-0-17" class="i">+    }.getOrNull()
</a><a href="#h29-0-18" id="h29-0-18" class="i">+}
</a><a href="#h29-0-19" id="h29-0-19" class="i">+
</a><a href="#h29-0-20" id="h29-0-20" class="i">+fun Context.getUrlFromClipboard(): String? {
</a><a href="#h29-0-21" id="h29-0-21" class="i">+    return getTextFromClipboard()?.takeIf { it.startsWith(&quot;http&quot;) }
</a> }
 
 fun InputStream.toParcelFileDescriptor(coroutineScope: CoroutineScope): ParcelFileDescriptor {
<b>diff --git a/<a id="h30" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/ModContext.kt</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -153,13 +153,11 @@ class ModContext(
</a>     }
 
     fun reloadNativeConfig() {
<a href="#h30-0-3" id="h30-0-3" class="d">-        if (config.experimental.nativeHooks.globalState != true) return
</a>         native.loadNativeConfig(
             NativeConfig(
                 disableBitmoji = config.experimental.nativeHooks.disableBitmoji.get(),
                 disableMetrics = config.global.disableMetrics.get(),
                 composerHooks = config.experimental.nativeHooks.composerHooks.globalState == true,
<a href="#h30-0-9" id="h30-0-9" class="d">-                remapExecutable = config.experimental.nativeHooks.remapExecutable.get(),
</a>                 customEmojiFontPath = getCustomEmojiFontPath(this)
             )
         )
<b>diff --git a/<a id="h31" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/SnapEnhance.kt</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -4,7 +4,8 @@ import android.app.Activity
</a> import android.content.Context
 import android.content.res.Resources
 import android.os.Build
<a href="#h31-0-3" id="h31-0-3" class="d">-import dalvik.system.BaseDexClassLoader
</a><a href="#h31-0-4" id="h31-0-4" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h31-0-5" id="h31-0-5" class="i">+import androidx.compose.material.icons.outlined.Cancel
</a> import kotlinx.coroutines.CoroutineScope
 import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.launch
<a href="#h31-1" id="h31-1" class="h">@@ -14,6 +15,9 @@ import me.rhunk.snapenhance.bridge.SyncCallback
</a> import me.rhunk.snapenhance.common.Constants
 import me.rhunk.snapenhance.common.ReceiversConfig
 import me.rhunk.snapenhance.common.action.EnumAction
<a href="#h31-1-3" id="h31-1-3" class="i">+import me.rhunk.snapenhance.common.bridge.FileHandleScope
</a><a href="#h31-1-4" id="h31-1-4" class="i">+import me.rhunk.snapenhance.common.bridge.InternalFileHandleType
</a><a href="#h31-1-5" id="h31-1-5" class="i">+import me.rhunk.snapenhance.common.bridge.toWrapper
</a> import me.rhunk.snapenhance.common.data.FriendStreaks
 import me.rhunk.snapenhance.common.data.MessagingFriendInfo
 import me.rhunk.snapenhance.common.data.MessagingGroupInfo
<a href="#h31-2" id="h31-2" class="h">@@ -27,7 +31,6 @@ import me.rhunk.snapenhance.core.util.LSPatchUpdater
</a> import me.rhunk.snapenhance.core.util.hook.HookAdapter
 import me.rhunk.snapenhance.core.util.hook.HookStage
 import me.rhunk.snapenhance.core.util.hook.hook
<a href="#h31-2-3" id="h31-2-3" class="d">-import me.rhunk.snapenhance.core.util.hook.hookConstructor
</a> import kotlin.reflect.KClass
 import kotlin.system.exitProcess
 import kotlin.system.measureTimeMillis
<a href="#h31-3" id="h31-3" class="h">@@ -166,6 +169,8 @@ class SnapEnhance {
</a>         }
     }
 
<a href="#h31-3-3" id="h31-3-3" class="i">+    private var safeMode = false
</a><a href="#h31-3-4" id="h31-3-4" class="i">+
</a>     private fun onActivityCreate(activity: Activity) {
         measureTimeMillis {
             with(appContext) {
<a href="#h31-4" id="h31-4" class="h">@@ -173,6 +178,10 @@ class SnapEnhance {
</a>                 inAppOverlay.onActivityCreate(activity)
                 scriptRuntime.eachModule { callFunction(&quot;module.onSnapMainActivityCreate&quot;, activity) }
                 actionManager.onActivityCreate()
<a href="#h31-4-3" id="h31-4-3" class="i">+
</a><a href="#h31-4-4" id="h31-4-4" class="i">+                if (safeMode) {
</a><a href="#h31-4-5" id="h31-4-5" class="i">+                    appContext.inAppOverlay.showStatusToast(Icons.Outlined.Cancel, &quot;Failed to load security features! Snapchat may not work properly.&quot;, durationMs = 5000)
</a><a href="#h31-4-6" id="h31-4-6" class="i">+                }
</a>             }
         }.also { time -&gt;
             appContext.log.verbose(&quot;onActivityCreate took $time&quot;)
<a href="#h31-5" id="h31-5" class="h">@@ -180,36 +189,58 @@ class SnapEnhance {
</a>     }
 
     private fun initNative() {
<a href="#h31-5-3" id="h31-5-3" class="d">-        // don&#39;t initialize native when not logged in
</a><a href="#h31-5-4" id="h31-5-4" class="d">-        if (
</a><a href="#h31-5-5" id="h31-5-5" class="d">-            !appContext.isLoggedIn() &amp;&amp;
</a><a href="#h31-5-6" id="h31-5-6" class="d">-            appContext.bridgeClient.getDebugProp(&quot;force_native_load&quot;, null) != &quot;true&quot;
</a><a href="#h31-5-7" id="h31-5-7" class="d">-        ) return
</a><a href="#h31-5-8" id="h31-5-8" class="d">-        if (appContext.config.experimental.nativeHooks.globalState != true) return
</a><a href="#h31-5-9" id="h31-5-9" class="d">-
</a><a href="#h31-5-10" id="h31-5-10" class="d">-        lateinit var unhook: () -&gt; Unit
</a><a href="#h31-5-11" id="h31-5-11" class="i">+        val lateInit = appContext.native.initOnce {
</a><a href="#h31-5-12" id="h31-5-12" class="i">+            nativeUnaryCallCallback = { request -&gt;
</a><a href="#h31-5-13" id="h31-5-13" class="i">+                appContext.event.post(NativeUnaryCallEvent(request.uri, request.buffer)) {
</a><a href="#h31-5-14" id="h31-5-14" class="i">+                    request.buffer = buffer
</a><a href="#h31-5-15" id="h31-5-15" class="i">+                    request.canceled = canceled
</a><a href="#h31-5-16" id="h31-5-16" class="i">+                }
</a><a href="#h31-5-17" id="h31-5-17" class="i">+            }
</a><a href="#h31-5-18" id="h31-5-18" class="i">+            appContext.reloadNativeConfig()
</a><a href="#h31-5-19" id="h31-5-19" class="i">+        }
</a><a href="#h31-5-20" id="h31-5-20" class="i">+
</a><a href="#h31-5-21" id="h31-5-21" class="i">+        if (appContext.bridgeClient.getDebugProp(&quot;disable_sif&quot;, &quot;false&quot;) != &quot;true&quot;) {
</a><a href="#h31-5-22" id="h31-5-22" class="i">+            runCatching {
</a><a href="#h31-5-23" id="h31-5-23" class="i">+                appContext.native.loadSharedLibrary(
</a><a href="#h31-5-24" id="h31-5-24" class="i">+                    appContext.fileHandlerManager.getFileHandle(FileHandleScope.INTERNAL.key, InternalFileHandleType.SIF.key)
</a><a href="#h31-5-25" id="h31-5-25" class="i">+                        .toWrapper()
</a><a href="#h31-5-26" id="h31-5-26" class="i">+                        .readBytes()
</a><a href="#h31-5-27" id="h31-5-27" class="i">+                        .takeIf {
</a><a href="#h31-5-28" id="h31-5-28" class="i">+                            it.isNotEmpty()
</a><a href="#h31-5-29" id="h31-5-29" class="i">+                        } ?: throw IllegalStateException(&quot;buffer is empty&quot;)
</a><a href="#h31-5-30" id="h31-5-30" class="i">+                )
</a><a href="#h31-5-31" id="h31-5-31" class="i">+                appContext.log.verbose(&quot;loaded sif&quot;)
</a><a href="#h31-5-32" id="h31-5-32" class="i">+            }.onFailure {
</a><a href="#h31-5-33" id="h31-5-33" class="i">+                safeMode = true
</a><a href="#h31-5-34" id="h31-5-34" class="i">+                appContext.log.error(&quot;Failed to load sif&quot;, it)
</a><a href="#h31-5-35" id="h31-5-35" class="i">+            }
</a><a href="#h31-5-36" id="h31-5-36" class="i">+        } else {
</a><a href="#h31-5-37" id="h31-5-37" class="i">+            appContext.log.warn(&quot;sif is disabled&quot;)
</a><a href="#h31-5-38" id="h31-5-38" class="i">+        }
</a><a href="#h31-5-39" id="h31-5-39" class="i">+
</a>         Runtime::class.java.declaredMethods.first {
             it.name == &quot;loadLibrary0&quot; &amp;&amp; it.parameterTypes.contentEquals(
                 if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) arrayOf(Class::class.java, String::class.java)
                 else arrayOf(ClassLoader::class.java, String::class.java)
             )
<a href="#h31-5-45" id="h31-5-45" class="d">-        }.hook(HookStage.AFTER) { param -&gt;
</a><a href="#h31-5-46" id="h31-5-46" class="d">-            val libName = param.arg&lt;String&gt;(1)
</a><a href="#h31-5-47" id="h31-5-47" class="d">-            if (libName != &quot;client&quot;) return@hook
</a><a href="#h31-5-48" id="h31-5-48" class="d">-            unhook()
</a><a href="#h31-5-49" id="h31-5-49" class="d">-            appContext.native.initOnce {
</a><a href="#h31-5-50" id="h31-5-50" class="d">-                nativeUnaryCallCallback = { request -&gt;
</a><a href="#h31-5-51" id="h31-5-51" class="d">-                    appContext.event.post(NativeUnaryCallEvent(request.uri, request.buffer)) {
</a><a href="#h31-5-52" id="h31-5-52" class="d">-                        request.buffer = buffer
</a><a href="#h31-5-53" id="h31-5-53" class="d">-                        request.canceled = canceled
</a><a href="#h31-5-54" id="h31-5-54" class="d">-                    }
</a><a href="#h31-5-55" id="h31-5-55" class="i">+        }.apply {
</a><a href="#h31-5-56" id="h31-5-56" class="i">+            if (safeMode) {
</a><a href="#h31-5-57" id="h31-5-57" class="i">+                hook(HookStage.BEFORE) { param -&gt;
</a><a href="#h31-5-58" id="h31-5-58" class="i">+                    if (param.arg&lt;String&gt;(1) != &quot;scplugin&quot;) return@hook
</a><a href="#h31-5-59" id="h31-5-59" class="i">+                    appContext.log.warn(&quot;Can&#39;t load scplugin in safe mode&quot;)
</a><a href="#h31-5-60" id="h31-5-60" class="i">+                    Thread.sleep(Long.MAX_VALUE)
</a>                 }
<a href="#h31-5-62" id="h31-5-62" class="d">-                appContext.reloadNativeConfig()
</a><a href="#h31-5-63" id="h31-5-63" class="d">-            }
</a><a href="#h31-5-64" id="h31-5-64" class="d">-            BaseDexClassLoader::class.java.hookConstructor(HookStage.AFTER) {
</a><a href="#h31-5-65" id="h31-5-65" class="d">-                appContext.native.hideAnonymousDexFiles()
</a>             }
<a href="#h31-5-67" id="h31-5-67" class="d">-        }.also { unhook = { it.unhook() } }
</a><a href="#h31-5-68" id="h31-5-68" class="i">+
</a><a href="#h31-5-69" id="h31-5-69" class="i">+            lateinit var unhook: () -&gt; Unit
</a><a href="#h31-5-70" id="h31-5-70" class="i">+            hook(HookStage.AFTER) { param -&gt;
</a><a href="#h31-5-71" id="h31-5-71" class="i">+                val libName = param.arg&lt;String&gt;(1)
</a><a href="#h31-5-72" id="h31-5-72" class="i">+                if (libName != &quot;client&quot;) return@hook
</a><a href="#h31-5-73" id="h31-5-73" class="i">+                unhook()
</a><a href="#h31-5-74" id="h31-5-74" class="i">+                appContext.log.verbose(&quot;libclient lateInit&quot;)
</a><a href="#h31-5-75" id="h31-5-75" class="i">+                lateInit()
</a><a href="#h31-5-76" id="h31-5-76" class="i">+            }.also { unhook = { it.unhook() } }
</a><a href="#h31-5-77" id="h31-5-77" class="i">+        }
</a>     }
 
     private fun initConfigListener() {
<b>diff --git a/<a id="h32" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/FeatureManager.kt</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -122,7 +122,7 @@ class FeatureManager(
</a>             AccountSwitcher(),
             RemoveGroupsLockedStatus(),
             BypassMessageActionRestrictions(),
<a href="#h32-0-3" id="h32-0-3" class="d">-            CustomizeUI(),
</a><a href="#h32-0-4" id="h32-0-4" class="i">+            CustomTheming(),
</a>             BetterLocation(),
             MediaFilePicker(),
             HideActiveMusic(),
<b>diff --git a/<a id="h33" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/DeviceSpooferHook.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/DeviceSpooferHook.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/DeviceSpooferHook.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/DeviceSpooferHook.kt</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -11,7 +11,7 @@ import me.rhunk.snapenhance.core.util.LSPatchUpdater
</a> import me.rhunk.snapenhance.core.util.hook.HookStage
 import me.rhunk.snapenhance.core.util.hook.hook
 
<a href="#h33-0-3" id="h33-0-3" class="d">-class DeviceSpooferHook: Feature(&quot;device_spoofer&quot;)  {
</a><a href="#h33-0-4" id="h33-0-4" class="i">+class DeviceSpooferHook: Feature(&quot;Device Spoofer&quot;)  {
</a> 	private fun hookInstallerPackageName() {
 		context.androidContext.packageManager::class.java.hook(&quot;getInstallerPackageName&quot;, HookStage.BEFORE) { param -&gt;
 			param.setResult(&quot;com.android.vending&quot;)
<b>diff --git a/<a id="h34" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomTheming.kt</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -0,0 +1,130 @@
</a><a href="#h34-0-0" id="h34-0-0" class="i">+package me.rhunk.snapenhance.core.features.impl.ui
</a><a href="#h34-0-1" id="h34-0-1" class="i">+
</a><a href="#h34-0-2" id="h34-0-2" class="i">+import android.content.res.TypedArray
</a><a href="#h34-0-3" id="h34-0-3" class="i">+import android.os.Build
</a><a href="#h34-0-4" id="h34-0-4" class="i">+import android.os.ParcelFileDescriptor
</a><a href="#h34-0-5" id="h34-0-5" class="i">+import android.os.ParcelFileDescriptor.AutoCloseInputStream
</a><a href="#h34-0-6" id="h34-0-6" class="i">+import android.util.TypedValue
</a><a href="#h34-0-7" id="h34-0-7" class="i">+import androidx.compose.material3.dynamicDarkColorScheme
</a><a href="#h34-0-8" id="h34-0-8" class="i">+import androidx.compose.ui.graphics.toArgb
</a><a href="#h34-0-9" id="h34-0-9" class="i">+import com.google.gson.reflect.TypeToken
</a><a href="#h34-0-10" id="h34-0-10" class="i">+import me.rhunk.snapenhance.common.bridge.FileHandleScope
</a><a href="#h34-0-11" id="h34-0-11" class="i">+import me.rhunk.snapenhance.common.data.DatabaseThemeContent
</a><a href="#h34-0-12" id="h34-0-12" class="i">+import me.rhunk.snapenhance.core.features.Feature
</a><a href="#h34-0-13" id="h34-0-13" class="i">+import me.rhunk.snapenhance.core.util.hook.HookStage
</a><a href="#h34-0-14" id="h34-0-14" class="i">+import me.rhunk.snapenhance.core.util.hook.hook
</a><a href="#h34-0-15" id="h34-0-15" class="i">+import me.rhunk.snapenhance.core.util.ktx.getIdentifier
</a><a href="#h34-0-16" id="h34-0-16" class="i">+import me.rhunk.snapenhance.core.util.ktx.getObjectField
</a><a href="#h34-0-17" id="h34-0-17" class="i">+
</a><a href="#h34-0-18" id="h34-0-18" class="i">+class CustomTheming: Feature(&quot;Custom Theming&quot;) {
</a><a href="#h34-0-19" id="h34-0-19" class="i">+    private fun getAttribute(name: String): Int {
</a><a href="#h34-0-20" id="h34-0-20" class="i">+        return context.resources.getIdentifier(name, &quot;attr&quot;)
</a><a href="#h34-0-21" id="h34-0-21" class="i">+    }
</a><a href="#h34-0-22" id="h34-0-22" class="i">+
</a><a href="#h34-0-23" id="h34-0-23" class="i">+    private fun parseAttributeList(vararg attributes: Pair&lt;String, Number&gt;): Map&lt;Int, Int&gt; {
</a><a href="#h34-0-24" id="h34-0-24" class="i">+        return attributes.toMap().mapKeys {
</a><a href="#h34-0-25" id="h34-0-25" class="i">+            getAttribute(it.key)
</a><a href="#h34-0-26" id="h34-0-26" class="i">+        }.filterKeys { it != 0 }.mapValues {
</a><a href="#h34-0-27" id="h34-0-27" class="i">+            it.value.toInt()
</a><a href="#h34-0-28" id="h34-0-28" class="i">+        }
</a><a href="#h34-0-29" id="h34-0-29" class="i">+    }
</a><a href="#h34-0-30" id="h34-0-30" class="i">+
</a><a href="#h34-0-31" id="h34-0-31" class="i">+    override fun init() {
</a><a href="#h34-0-32" id="h34-0-32" class="i">+        val customThemeName = context.config.userInterface.customTheme.getNullable() ?: return
</a><a href="#h34-0-33" id="h34-0-33" class="i">+        var currentTheme = mapOf&lt;Int, Int&gt;() // resource id -&gt; color
</a><a href="#h34-0-34" id="h34-0-34" class="i">+
</a><a href="#h34-0-35" id="h34-0-35" class="i">+        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {
</a><a href="#h34-0-36" id="h34-0-36" class="i">+            val colorScheme = dynamicDarkColorScheme(context.androidContext)
</a><a href="#h34-0-37" id="h34-0-37" class="i">+            val light = customThemeName == &quot;material_you_light&quot;
</a><a href="#h34-0-38" id="h34-0-38" class="i">+            val surfaceVariant = (if (light) colorScheme.surfaceVariant else colorScheme.onSurfaceVariant).toArgb()
</a><a href="#h34-0-39" id="h34-0-39" class="i">+            val background = (if (light) colorScheme.onBackground else colorScheme.background).toArgb()
</a><a href="#h34-0-40" id="h34-0-40" class="i">+
</a><a href="#h34-0-41" id="h34-0-41" class="i">+            currentTheme = parseAttributeList(
</a><a href="#h34-0-42" id="h34-0-42" class="i">+                &quot;sigColorTextPrimary&quot; to surfaceVariant,
</a><a href="#h34-0-43" id="h34-0-43" class="i">+                &quot;sigColorChatChat&quot; to surfaceVariant,
</a><a href="#h34-0-44" id="h34-0-44" class="i">+                &quot;sigColorChatPendingSending&quot; to surfaceVariant,
</a><a href="#h34-0-45" id="h34-0-45" class="i">+                &quot;sigColorChatSnapWithSound&quot; to surfaceVariant,
</a><a href="#h34-0-46" id="h34-0-46" class="i">+                &quot;sigColorChatSnapWithoutSound&quot; to surfaceVariant,
</a><a href="#h34-0-47" id="h34-0-47" class="i">+                &quot;sigColorBackgroundMain&quot; to background,
</a><a href="#h34-0-48" id="h34-0-48" class="i">+                &quot;sigColorBackgroundSurface&quot; to background,
</a><a href="#h34-0-49" id="h34-0-49" class="i">+                &quot;listDivider&quot; to colorScheme.onPrimary.copy(alpha = 0.12f).toArgb(),
</a><a href="#h34-0-50" id="h34-0-50" class="i">+                &quot;actionSheetBackgroundDrawable&quot; to background,
</a><a href="#h34-0-51" id="h34-0-51" class="i">+                &quot;actionSheetRoundedBackgroundDrawable&quot; to background,
</a><a href="#h34-0-52" id="h34-0-52" class="i">+                &quot;sigExceptionColorCameraGridLines&quot; to background,
</a><a href="#h34-0-53" id="h34-0-53" class="i">+            )
</a><a href="#h34-0-54" id="h34-0-54" class="i">+        }
</a><a href="#h34-0-55" id="h34-0-55" class="i">+
</a><a href="#h34-0-56" id="h34-0-56" class="i">+        if (customThemeName == &quot;amoled_dark_mode&quot;) {
</a><a href="#h34-0-57" id="h34-0-57" class="i">+            currentTheme = parseAttributeList(
</a><a href="#h34-0-58" id="h34-0-58" class="i">+                &quot;sigColorTextPrimary&quot; to 0xFFFFFFFF,
</a><a href="#h34-0-59" id="h34-0-59" class="i">+                &quot;sigColorChatChat&quot; to 0xFFFFFFFF,
</a><a href="#h34-0-60" id="h34-0-60" class="i">+                &quot;sigColorChatPendingSending&quot; to 0xFFFFFFFF,
</a><a href="#h34-0-61" id="h34-0-61" class="i">+                &quot;sigColorChatSnapWithSound&quot; to 0xFFFFFFFF,
</a><a href="#h34-0-62" id="h34-0-62" class="i">+                &quot;sigColorChatSnapWithoutSound&quot; to 0xFFFFFFFF,
</a><a href="#h34-0-63" id="h34-0-63" class="i">+                &quot;sigColorBackgroundMain&quot; to 0xFF000000,
</a><a href="#h34-0-64" id="h34-0-64" class="i">+                &quot;sigColorBackgroundSurface&quot; to 0xFF000000,
</a><a href="#h34-0-65" id="h34-0-65" class="i">+                &quot;listDivider&quot; to 0xFF000000,
</a><a href="#h34-0-66" id="h34-0-66" class="i">+                &quot;actionSheetBackgroundDrawable&quot; to 0xFF000000,
</a><a href="#h34-0-67" id="h34-0-67" class="i">+                &quot;actionSheetRoundedBackgroundDrawable&quot; to 0xFF000000,
</a><a href="#h34-0-68" id="h34-0-68" class="i">+                &quot;sigExceptionColorCameraGridLines&quot; to 0xFF000000,
</a><a href="#h34-0-69" id="h34-0-69" class="i">+            )
</a><a href="#h34-0-70" id="h34-0-70" class="i">+        }
</a><a href="#h34-0-71" id="h34-0-71" class="i">+
</a><a href="#h34-0-72" id="h34-0-72" class="i">+        if (customThemeName == &quot;custom&quot;) {
</a><a href="#h34-0-73" id="h34-0-73" class="i">+            val availableThemes = context.fileHandlerManager.getFileHandle(FileHandleScope.THEME.key, &quot;&quot;)?.open(ParcelFileDescriptor.MODE_READ_ONLY)?.use { pfd -&gt;
</a><a href="#h34-0-74" id="h34-0-74" class="i">+                AutoCloseInputStream(pfd).use { it.readBytes() }
</a><a href="#h34-0-75" id="h34-0-75" class="i">+            }?.let {
</a><a href="#h34-0-76" id="h34-0-76" class="i">+                context.gson.fromJson(it.toString(Charsets.UTF_8), object: TypeToken&lt;List&lt;DatabaseThemeContent&gt;&gt;() {})
</a><a href="#h34-0-77" id="h34-0-77" class="i">+            } ?: run {
</a><a href="#h34-0-78" id="h34-0-78" class="i">+                context.log.verbose(&quot;no custom themes found&quot;)
</a><a href="#h34-0-79" id="h34-0-79" class="i">+                return
</a><a href="#h34-0-80" id="h34-0-80" class="i">+            }
</a><a href="#h34-0-81" id="h34-0-81" class="i">+
</a><a href="#h34-0-82" id="h34-0-82" class="i">+            val customThemeColors = mutableMapOf&lt;Int, Int&gt;()
</a><a href="#h34-0-83" id="h34-0-83" class="i">+
</a><a href="#h34-0-84" id="h34-0-84" class="i">+            context.log.verbose(&quot;loading ${availableThemes.size} custom themes&quot;)
</a><a href="#h34-0-85" id="h34-0-85" class="i">+
</a><a href="#h34-0-86" id="h34-0-86" class="i">+            availableThemes.forEach { themeContent -&gt;
</a><a href="#h34-0-87" id="h34-0-87" class="i">+                themeContent.colors.forEach colors@{ colorEntry -&gt;
</a><a href="#h34-0-88" id="h34-0-88" class="i">+                    customThemeColors[getAttribute(colorEntry.key).takeIf { it != 0 }.also {
</a><a href="#h34-0-89" id="h34-0-89" class="i">+                        if (it == null) {
</a><a href="#h34-0-90" id="h34-0-90" class="i">+                            context.log.warn(&quot;unknown color attribute: ${colorEntry.key}&quot;)
</a><a href="#h34-0-91" id="h34-0-91" class="i">+                        }
</a><a href="#h34-0-92" id="h34-0-92" class="i">+                    } ?: return@colors] = colorEntry.value
</a><a href="#h34-0-93" id="h34-0-93" class="i">+                }
</a><a href="#h34-0-94" id="h34-0-94" class="i">+            }
</a><a href="#h34-0-95" id="h34-0-95" class="i">+
</a><a href="#h34-0-96" id="h34-0-96" class="i">+            currentTheme = customThemeColors
</a><a href="#h34-0-97" id="h34-0-97" class="i">+
</a><a href="#h34-0-98" id="h34-0-98" class="i">+            context.log.verbose(&quot;loaded ${customThemeColors.size} custom theme colors&quot;)
</a><a href="#h34-0-99" id="h34-0-99" class="i">+        }
</a><a href="#h34-0-100" id="h34-0-100" class="i">+
</a><a href="#h34-0-101" id="h34-0-101" class="i">+        onNextActivityCreate {
</a><a href="#h34-0-102" id="h34-0-102" class="i">+            if (currentTheme.isEmpty()) return@onNextActivityCreate
</a><a href="#h34-0-103" id="h34-0-103" class="i">+
</a><a href="#h34-0-104" id="h34-0-104" class="i">+            context.androidContext.theme.javaClass.getMethod(&quot;obtainStyledAttributes&quot;, IntArray::class.java).hook(
</a><a href="#h34-0-105" id="h34-0-105" class="i">+                HookStage.AFTER) { param -&gt;
</a><a href="#h34-0-106" id="h34-0-106" class="i">+                val array = param.arg&lt;IntArray&gt;(0)
</a><a href="#h34-0-107" id="h34-0-107" class="i">+                val customColor = (currentTheme[array[0]] as? Number)?.toInt() ?: return@hook
</a><a href="#h34-0-108" id="h34-0-108" class="i">+
</a><a href="#h34-0-109" id="h34-0-109" class="i">+                val result = param.getResult() as TypedArray
</a><a href="#h34-0-110" id="h34-0-110" class="i">+                val typedArrayData = result.getObjectField(&quot;mData&quot;) as IntArray
</a><a href="#h34-0-111" id="h34-0-111" class="i">+
</a><a href="#h34-0-112" id="h34-0-112" class="i">+                when (val attributeType = result.getType(0)) {
</a><a href="#h34-0-113" id="h34-0-113" class="i">+                    TypedValue.TYPE_INT_COLOR_ARGB8, TypedValue.TYPE_INT_COLOR_RGB8, TypedValue.TYPE_INT_COLOR_ARGB4, TypedValue.TYPE_INT_COLOR_RGB4 -&gt; {
</a><a href="#h34-0-114" id="h34-0-114" class="i">+                        typedArrayData[1] = customColor // index + STYLE_DATA
</a><a href="#h34-0-115" id="h34-0-115" class="i">+                    }
</a><a href="#h34-0-116" id="h34-0-116" class="i">+                    TypedValue.TYPE_STRING -&gt; {
</a><a href="#h34-0-117" id="h34-0-117" class="i">+                        val stringValue = result.getString(0)
</a><a href="#h34-0-118" id="h34-0-118" class="i">+                        if (stringValue?.endsWith(&quot;.xml&quot;) == true) {
</a><a href="#h34-0-119" id="h34-0-119" class="i">+                            typedArrayData[0] = TypedValue.TYPE_INT_COLOR_ARGB4 // STYLE_TYPE
</a><a href="#h34-0-120" id="h34-0-120" class="i">+                            typedArrayData[1] = customColor // STYLE_DATA
</a><a href="#h34-0-121" id="h34-0-121" class="i">+                            typedArrayData[5] = 0; // STYLE_DENSITY
</a><a href="#h34-0-122" id="h34-0-122" class="i">+                        }
</a><a href="#h34-0-123" id="h34-0-123" class="i">+                    }
</a><a href="#h34-0-124" id="h34-0-124" class="i">+                    else -&gt; context.log.warn(&quot;unknown attribute type: ${attributeType.toString(16)}&quot;)
</a><a href="#h34-0-125" id="h34-0-125" class="i">+                }
</a><a href="#h34-0-126" id="h34-0-126" class="i">+            }
</a><a href="#h34-0-127" id="h34-0-127" class="i">+        }
</a><a href="#h34-0-128" id="h34-0-128" class="i">+    }
</a><a href="#h34-0-129" id="h34-0-129" class="i">+}</a><a href="#h34-0-130" id="h34-0-130" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h35" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomizeUI.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomizeUI.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomizeUI.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/ui/CustomizeUI.kt</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -1,211 +0,0 @@
</a><a href="#h35-0-0" id="h35-0-0" class="d">-package me.rhunk.snapenhance.core.features.impl.ui
</a><a href="#h35-0-1" id="h35-0-1" class="d">-
</a><a href="#h35-0-2" id="h35-0-2" class="d">-import android.content.res.TypedArray
</a><a href="#h35-0-3" id="h35-0-3" class="d">-import android.graphics.drawable.ColorDrawable
</a><a href="#h35-0-4" id="h35-0-4" class="d">-import android.os.Build
</a><a href="#h35-0-5" id="h35-0-5" class="d">-import android.util.TypedValue
</a><a href="#h35-0-6" id="h35-0-6" class="d">-import androidx.compose.material3.dynamicDarkColorScheme
</a><a href="#h35-0-7" id="h35-0-7" class="d">-import androidx.compose.ui.graphics.toArgb
</a><a href="#h35-0-8" id="h35-0-8" class="d">-import me.rhunk.snapenhance.core.features.Feature
</a><a href="#h35-0-9" id="h35-0-9" class="d">-import me.rhunk.snapenhance.core.util.hook.HookStage
</a><a href="#h35-0-10" id="h35-0-10" class="d">-import me.rhunk.snapenhance.core.util.hook.Hooker
</a><a href="#h35-0-11" id="h35-0-11" class="d">-import me.rhunk.snapenhance.core.util.hook.hook
</a><a href="#h35-0-12" id="h35-0-12" class="d">-import me.rhunk.snapenhance.core.util.ktx.getIdentifier
</a><a href="#h35-0-13" id="h35-0-13" class="d">-
</a><a href="#h35-0-14" id="h35-0-14" class="d">-class CustomizeUI: Feature(&quot;Customize UI&quot;) {
</a><a href="#h35-0-15" id="h35-0-15" class="d">-    private fun getAttribute(name: String): Int {
</a><a href="#h35-0-16" id="h35-0-16" class="d">-        return context.resources.getIdentifier(name, &quot;attr&quot;)
</a><a href="#h35-0-17" id="h35-0-17" class="d">-    }
</a><a href="#h35-0-18" id="h35-0-18" class="d">-
</a><a href="#h35-0-19" id="h35-0-19" class="d">-    override fun init() {
</a><a href="#h35-0-20" id="h35-0-20" class="d">-        val customizeUIConfig = context.config.userInterface.customizeUi
</a><a href="#h35-0-21" id="h35-0-21" class="d">-        val themePicker = customizeUIConfig.themePicker.getNullable() ?: return
</a><a href="#h35-0-22" id="h35-0-22" class="d">-        val colorsConfig = context.config.userInterface.customizeUi.colors
</a><a href="#h35-0-23" id="h35-0-23" class="d">-
</a><a href="#h35-0-24" id="h35-0-24" class="d">-        if (themePicker == &quot;custom&quot;) {
</a><a href="#h35-0-25" id="h35-0-25" class="d">-            themes.clear()
</a><a href="#h35-0-26" id="h35-0-26" class="d">-            themes[themePicker] = mapOf(
</a><a href="#h35-0-27" id="h35-0-27" class="d">-                &quot;sigColorTextPrimary&quot; to colorsConfig.textColor.getNullable(),
</a><a href="#h35-0-28" id="h35-0-28" class="d">-                &quot;sigColorChatChat&quot; to colorsConfig.chatChatTextColor.getNullable(),
</a><a href="#h35-0-29" id="h35-0-29" class="d">-                &quot;sigColorChatPendingSending&quot; to  colorsConfig.pendingSendingTextColor.getNullable(),
</a><a href="#h35-0-30" id="h35-0-30" class="d">-                &quot;sigColorChatSnapWithSound&quot; to colorsConfig.snapWithSoundTextColor.getNullable(),
</a><a href="#h35-0-31" id="h35-0-31" class="d">-                &quot;sigColorChatSnapWithoutSound&quot; to colorsConfig.snapWithoutSoundTextColor.getNullable(),
</a><a href="#h35-0-32" id="h35-0-32" class="d">-                &quot;sigColorBackgroundMain&quot; to colorsConfig.backgroundColor.getNullable(),
</a><a href="#h35-0-33" id="h35-0-33" class="d">-                &quot;listDivider&quot; to colorsConfig.friendFeedConversationsLineColor.getNullable(),
</a><a href="#h35-0-34" id="h35-0-34" class="d">-                &quot;sigColorBackgroundSurface&quot; to colorsConfig.backgroundColorSurface.getNullable(),
</a><a href="#h35-0-35" id="h35-0-35" class="d">-                &quot;actionSheetBackgroundDrawable&quot; to colorsConfig.actionMenuBackgroundColor.getNullable(),
</a><a href="#h35-0-36" id="h35-0-36" class="d">-                &quot;actionSheetRoundedBackgroundDrawable&quot; to colorsConfig.actionMenuRoundBackgroundColor.getNullable(),
</a><a href="#h35-0-37" id="h35-0-37" class="d">-                &quot;sigExceptionColorCameraGridLines&quot; to colorsConfig.cameraGridLines.getNullable(),
</a><a href="#h35-0-38" id="h35-0-38" class="d">-            ).filterValues { it != null }.map { (key, value) -&gt;
</a><a href="#h35-0-39" id="h35-0-39" class="d">-                getAttribute(key) to value!!
</a><a href="#h35-0-40" id="h35-0-40" class="d">-            }.toMap()
</a><a href="#h35-0-41" id="h35-0-41" class="d">-        } 
</a><a href="#h35-0-42" id="h35-0-42" class="d">-        if (themePicker == &quot;material_you_light&quot; || themePicker == &quot;material_you_dark&quot;) {
</a><a href="#h35-0-43" id="h35-0-43" class="d">-            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {
</a><a href="#h35-0-44" id="h35-0-44" class="d">-                val colorScheme = dynamicDarkColorScheme(context.androidContext)
</a><a href="#h35-0-45" id="h35-0-45" class="d">-                val light = themePicker == &quot;material_you_light&quot;
</a><a href="#h35-0-46" id="h35-0-46" class="d">-                themes.clear()
</a><a href="#h35-0-47" id="h35-0-47" class="d">-                val surfaceVariant = (if (light) colorScheme.surfaceVariant else colorScheme.onSurfaceVariant).toArgb()
</a><a href="#h35-0-48" id="h35-0-48" class="d">-                val background = (if (light) colorScheme.onBackground else colorScheme.background).toArgb()
</a><a href="#h35-0-49" id="h35-0-49" class="d">-
</a><a href="#h35-0-50" id="h35-0-50" class="d">-                themes[themePicker] = mapOf(
</a><a href="#h35-0-51" id="h35-0-51" class="d">-                    &quot;sigColorTextPrimary&quot; to surfaceVariant,
</a><a href="#h35-0-52" id="h35-0-52" class="d">-                    &quot;sigColorChatChat&quot; to surfaceVariant,
</a><a href="#h35-0-53" id="h35-0-53" class="d">-                    &quot;sigColorChatPendingSending&quot; to surfaceVariant,
</a><a href="#h35-0-54" id="h35-0-54" class="d">-                    &quot;sigColorChatSnapWithSound&quot; to surfaceVariant,
</a><a href="#h35-0-55" id="h35-0-55" class="d">-                    &quot;sigColorChatSnapWithoutSound&quot; to surfaceVariant,
</a><a href="#h35-0-56" id="h35-0-56" class="d">-                    &quot;sigColorBackgroundMain&quot; to background,
</a><a href="#h35-0-57" id="h35-0-57" class="d">-                    &quot;sigColorBackgroundSurface&quot; to background,
</a><a href="#h35-0-58" id="h35-0-58" class="d">-                    &quot;listDivider&quot; to colorScheme.onPrimary.copy(alpha = 0.12f).toArgb(),
</a><a href="#h35-0-59" id="h35-0-59" class="d">-                    &quot;actionSheetBackgroundDrawable&quot; to background,
</a><a href="#h35-0-60" id="h35-0-60" class="d">-                    &quot;actionSheetRoundedBackgroundDrawable&quot; to background,
</a><a href="#h35-0-61" id="h35-0-61" class="d">-                    &quot;sigExceptionColorCameraGridLines&quot; to background,
</a><a href="#h35-0-62" id="h35-0-62" class="d">-                ).map { getAttribute(it.key) to it.value }.toMap()
</a><a href="#h35-0-63" id="h35-0-63" class="d">-            }
</a><a href="#h35-0-64" id="h35-0-64" class="d">-        }
</a><a href="#h35-0-65" id="h35-0-65" class="d">-
</a><a href="#h35-0-66" id="h35-0-66" class="d">-        context.androidContext.theme.javaClass.getMethod(&quot;obtainStyledAttributes&quot;, IntArray::class.java).hook(
</a><a href="#h35-0-67" id="h35-0-67" class="d">-            HookStage.AFTER) { param -&gt;
</a><a href="#h35-0-68" id="h35-0-68" class="d">-            val array = param.arg&lt;IntArray&gt;(0)
</a><a href="#h35-0-69" id="h35-0-69" class="d">-            val result = param.getResult() as TypedArray
</a><a href="#h35-0-70" id="h35-0-70" class="d">-
</a><a href="#h35-0-71" id="h35-0-71" class="d">-            fun ephemeralHook(methodName: String, content: Any) {
</a><a href="#h35-0-72" id="h35-0-72" class="d">-                Hooker.ephemeralHookObjectMethod(result::class.java, result, methodName, HookStage.BEFORE) {
</a><a href="#h35-0-73" id="h35-0-73" class="d">-                    it.setResult(content)
</a><a href="#h35-0-74" id="h35-0-74" class="d">-                }
</a><a href="#h35-0-75" id="h35-0-75" class="d">-            }
</a><a href="#h35-0-76" id="h35-0-76" class="d">-
</a><a href="#h35-0-77" id="h35-0-77" class="d">-            themes[themePicker]?.get(array[0])?.let { value -&gt;
</a><a href="#h35-0-78" id="h35-0-78" class="d">-                when (val attributeType = result.getType(0)) {
</a><a href="#h35-0-79" id="h35-0-79" class="d">-                    TypedValue.TYPE_INT_COLOR_ARGB8, TypedValue.TYPE_INT_COLOR_RGB8, TypedValue.TYPE_INT_COLOR_ARGB4, TypedValue.TYPE_INT_COLOR_RGB4 -&gt; {
</a><a href="#h35-0-80" id="h35-0-80" class="d">-                        ephemeralHook(&quot;getColor&quot;, (value as Number).toInt())
</a><a href="#h35-0-81" id="h35-0-81" class="d">-                    }
</a><a href="#h35-0-82" id="h35-0-82" class="d">-                    TypedValue.TYPE_STRING -&gt; {
</a><a href="#h35-0-83" id="h35-0-83" class="d">-                        val stringValue = result.getString(0)
</a><a href="#h35-0-84" id="h35-0-84" class="d">-                        if (stringValue?.endsWith(&quot;.xml&quot;) == true) {
</a><a href="#h35-0-85" id="h35-0-85" class="d">-                            ephemeralHook(&quot;getDrawable&quot;, ColorDrawable((value as Number).toInt()))
</a><a href="#h35-0-86" id="h35-0-86" class="d">-                        }
</a><a href="#h35-0-87" id="h35-0-87" class="d">-                    }
</a><a href="#h35-0-88" id="h35-0-88" class="d">-                    else -&gt; context.log.warn(&quot;unknown attribute type: ${attributeType.toString(16)}&quot;)
</a><a href="#h35-0-89" id="h35-0-89" class="d">-                }
</a><a href="#h35-0-90" id="h35-0-90" class="d">-            }
</a><a href="#h35-0-91" id="h35-0-91" class="d">-        }
</a><a href="#h35-0-92" id="h35-0-92" class="d">-    }
</a><a href="#h35-0-93" id="h35-0-93" class="d">-
</a><a href="#h35-0-94" id="h35-0-94" class="d">-    private val themes by lazy {
</a><a href="#h35-0-95" id="h35-0-95" class="d">-       mapOf(
</a><a href="#h35-0-96" id="h35-0-96" class="d">-           &quot;amoled_dark_mode&quot; to mapOf(
</a><a href="#h35-0-97" id="h35-0-97" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-98" id="h35-0-98" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFF000000,
</a><a href="#h35-0-99" id="h35-0-99" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFF000000,
</a><a href="#h35-0-100" id="h35-0-100" class="d">-               &quot;listDivider&quot; to 0xFF000000,
</a><a href="#h35-0-101" id="h35-0-101" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFF000000,
</a><a href="#h35-0-102" id="h35-0-102" class="d">-               &quot;actionSheetRoundedBackgroundDrawable&quot; to 0xFF000000
</a><a href="#h35-0-103" id="h35-0-103" class="d">-           ),
</a><a href="#h35-0-104" id="h35-0-104" class="d">-           &quot;light_blue&quot; to mapOf(
</a><a href="#h35-0-105" id="h35-0-105" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFF03BAFC,
</a><a href="#h35-0-106" id="h35-0-106" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFFBDE6FF,
</a><a href="#h35-0-107" id="h35-0-107" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFF78DBFF,
</a><a href="#h35-0-108" id="h35-0-108" class="d">-               &quot;listDivider&quot; to 0xFFBDE6FF,
</a><a href="#h35-0-109" id="h35-0-109" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFF78DBFF,
</a><a href="#h35-0-110" id="h35-0-110" class="d">-               &quot;sigColorChatChat&quot; to 0xFF08D6FF,
</a><a href="#h35-0-111" id="h35-0-111" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFF08D6FF,
</a><a href="#h35-0-112" id="h35-0-112" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFF08D6FF,
</a><a href="#h35-0-113" id="h35-0-113" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFF08D6FF,
</a><a href="#h35-0-114" id="h35-0-114" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFF08D6FF
</a><a href="#h35-0-115" id="h35-0-115" class="d">-           ),
</a><a href="#h35-0-116" id="h35-0-116" class="d">-           &quot;dark_blue&quot; to mapOf(
</a><a href="#h35-0-117" id="h35-0-117" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFF98C2FD,
</a><a href="#h35-0-118" id="h35-0-118" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFF192744,
</a><a href="#h35-0-119" id="h35-0-119" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFF192744,
</a><a href="#h35-0-120" id="h35-0-120" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFF192744,
</a><a href="#h35-0-121" id="h35-0-121" class="d">-               &quot;sigColorChatChat&quot; to 0xFF98C2FD,
</a><a href="#h35-0-122" id="h35-0-122" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFF98C2FD,
</a><a href="#h35-0-123" id="h35-0-123" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFF98C2FD,
</a><a href="#h35-0-124" id="h35-0-124" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFF98C2FD,
</a><a href="#h35-0-125" id="h35-0-125" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFF192744
</a><a href="#h35-0-126" id="h35-0-126" class="d">-           ),
</a><a href="#h35-0-127" id="h35-0-127" class="d">-           &quot;earthy_autumn&quot; to mapOf(
</a><a href="#h35-0-128" id="h35-0-128" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFFF7CAC9,
</a><a href="#h35-0-129" id="h35-0-129" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFF800000,
</a><a href="#h35-0-130" id="h35-0-130" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFF800000,
</a><a href="#h35-0-131" id="h35-0-131" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFF800000,
</a><a href="#h35-0-132" id="h35-0-132" class="d">-               &quot;sigColorChatChat&quot; to 0xFFF7CAC9,
</a><a href="#h35-0-133" id="h35-0-133" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFFF7CAC9,
</a><a href="#h35-0-134" id="h35-0-134" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFFF7CAC9,
</a><a href="#h35-0-135" id="h35-0-135" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFFF7CAC9,
</a><a href="#h35-0-136" id="h35-0-136" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFF800000
</a><a href="#h35-0-137" id="h35-0-137" class="d">-           ),
</a><a href="#h35-0-138" id="h35-0-138" class="d">-           &quot;mint_chocolate&quot; to mapOf(
</a><a href="#h35-0-139" id="h35-0-139" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-140" id="h35-0-140" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFF98FF98,
</a><a href="#h35-0-141" id="h35-0-141" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFF98FF98,
</a><a href="#h35-0-142" id="h35-0-142" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFF98FF98,
</a><a href="#h35-0-143" id="h35-0-143" class="d">-               &quot;sigColorChatChat&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-144" id="h35-0-144" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-145" id="h35-0-145" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-146" id="h35-0-146" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-147" id="h35-0-147" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFF98FF98
</a><a href="#h35-0-148" id="h35-0-148" class="d">-           ),
</a><a href="#h35-0-149" id="h35-0-149" class="d">-           &quot;ginger_snap&quot; to mapOf(
</a><a href="#h35-0-150" id="h35-0-150" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-151" id="h35-0-151" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFFC6893A,
</a><a href="#h35-0-152" id="h35-0-152" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFFC6893A,
</a><a href="#h35-0-153" id="h35-0-153" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFFC6893A,
</a><a href="#h35-0-154" id="h35-0-154" class="d">-               &quot;sigColorChatChat&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-155" id="h35-0-155" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-156" id="h35-0-156" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-157" id="h35-0-157" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-158" id="h35-0-158" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFFC6893A
</a><a href="#h35-0-159" id="h35-0-159" class="d">-           ),
</a><a href="#h35-0-160" id="h35-0-160" class="d">-           &quot;lemon_meringue&quot; to mapOf(
</a><a href="#h35-0-161" id="h35-0-161" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFF000000,
</a><a href="#h35-0-162" id="h35-0-162" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFFFCFFE7,
</a><a href="#h35-0-163" id="h35-0-163" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFFFCFFE7,
</a><a href="#h35-0-164" id="h35-0-164" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFFFCFFE7,
</a><a href="#h35-0-165" id="h35-0-165" class="d">-               &quot;sigColorChatChat&quot; to 0xFF000000,
</a><a href="#h35-0-166" id="h35-0-166" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFF000000,
</a><a href="#h35-0-167" id="h35-0-167" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFF000000,
</a><a href="#h35-0-168" id="h35-0-168" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFF000000,
</a><a href="#h35-0-169" id="h35-0-169" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFFFCFFE7
</a><a href="#h35-0-170" id="h35-0-170" class="d">-           ),
</a><a href="#h35-0-171" id="h35-0-171" class="d">-           &quot;lava_flow&quot; to mapOf(
</a><a href="#h35-0-172" id="h35-0-172" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFFFFCC00,
</a><a href="#h35-0-173" id="h35-0-173" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFFC70039,
</a><a href="#h35-0-174" id="h35-0-174" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFFC70039,
</a><a href="#h35-0-175" id="h35-0-175" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFFC70039,
</a><a href="#h35-0-176" id="h35-0-176" class="d">-               &quot;sigColorChatChat&quot; to 0xFFFFCC00,
</a><a href="#h35-0-177" id="h35-0-177" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFFFFCC00,
</a><a href="#h35-0-178" id="h35-0-178" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFFFFCC00,
</a><a href="#h35-0-179" id="h35-0-179" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFFFFCC00,
</a><a href="#h35-0-180" id="h35-0-180" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFFC70039
</a><a href="#h35-0-181" id="h35-0-181" class="d">-           ),
</a><a href="#h35-0-182" id="h35-0-182" class="d">-           &quot;ocean_fog&quot; to mapOf(
</a><a href="#h35-0-183" id="h35-0-183" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFF333333,
</a><a href="#h35-0-184" id="h35-0-184" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFFB0C4DE,
</a><a href="#h35-0-185" id="h35-0-185" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFFB0C4DE,
</a><a href="#h35-0-186" id="h35-0-186" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFFB0C4DE,
</a><a href="#h35-0-187" id="h35-0-187" class="d">-               &quot;sigColorChatChat&quot; to 0xFF333333,
</a><a href="#h35-0-188" id="h35-0-188" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFF333333,
</a><a href="#h35-0-189" id="h35-0-189" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFF333333,
</a><a href="#h35-0-190" id="h35-0-190" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFF333333,
</a><a href="#h35-0-191" id="h35-0-191" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFFB0C4DE
</a><a href="#h35-0-192" id="h35-0-192" class="d">-           ),
</a><a href="#h35-0-193" id="h35-0-193" class="d">-           &quot;alien_landscape&quot; to mapOf(
</a><a href="#h35-0-194" id="h35-0-194" class="d">-               &quot;sigColorTextPrimary&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-195" id="h35-0-195" class="d">-               &quot;sigColorBackgroundMain&quot; to 0xFF9B59B6,
</a><a href="#h35-0-196" id="h35-0-196" class="d">-               &quot;sigColorBackgroundSurface&quot; to 0xFF9B59B6,
</a><a href="#h35-0-197" id="h35-0-197" class="d">-               &quot;actionSheetBackgroundDrawable&quot; to 0xFF9B59B6,
</a><a href="#h35-0-198" id="h35-0-198" class="d">-               &quot;sigColorChatChat&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-199" id="h35-0-199" class="d">-               &quot;sigColorChatPendingSending&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-200" id="h35-0-200" class="d">-               &quot;sigColorChatSnapWithSound&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-201" id="h35-0-201" class="d">-               &quot;sigColorChatSnapWithoutSound&quot; to 0xFFFFFFFF,
</a><a href="#h35-0-202" id="h35-0-202" class="d">-               &quot;sigExceptionColorCameraGridLines&quot; to 0xFF9B59B6
</a><a href="#h35-0-203" id="h35-0-203" class="d">-           )
</a><a href="#h35-0-204" id="h35-0-204" class="d">-       ).mapValues { (_, attributes) -&gt;
</a><a href="#h35-0-205" id="h35-0-205" class="d">-            attributes.map { (key, value) -&gt;
</a><a href="#h35-0-206" id="h35-0-206" class="d">-                getAttribute(key) to value as Any
</a><a href="#h35-0-207" id="h35-0-207" class="d">-            }.toMap()
</a><a href="#h35-0-208" id="h35-0-208" class="d">-        }.toMutableMap()
</a><a href="#h35-0-209" id="h35-0-209" class="d">-    }
</a><a href="#h35-0-210" id="h35-0-210" class="d">-}
</a><b>diff --git a/<a id="h36" href="../file/native/jni/src/common.h.html">native/jni/src/common.h</a> b/<a href="../file/native/jni/src/common.h.html">native/jni/src/common.h</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -13,7 +13,6 @@ typedef struct {
</a>     bool disable_bitmoji;
     bool disable_metrics;
     bool composer_hooks;
<a href="#h36-0-3" id="h36-0-3" class="d">-    bool remap_executable;
</a>     char custom_emoji_font_path[256];
 } native_config_t;
 
<b>diff --git a/<a id="h37" href="../file/native/jni/src/dobby_helper.h.html">native/jni/src/dobby_helper.h</a> b/<a href="../file/native/jni/src/dobby_helper.h.html">native/jni/src/dobby_helper.h</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -9,8 +9,5 @@ static pthread_mutex_t hook_mutex = PTHREAD_MUTEX_INITIALIZER;
</a> static void inline SafeHook(void *addr, void *hook, void **original) {
     pthread_mutex_lock(&amp;hook_mutex);
     DobbyHook(addr, hook, original);
<a href="#h37-0-3" id="h37-0-3" class="d">-    if (common::native_config-&gt;remap_executable) {
</a><a href="#h37-0-4" id="h37-0-4" class="d">-        mprotect((void *)((uintptr_t) *original &amp; PAGE_MASK), PAGE_SIZE, PROT_EXEC);
</a><a href="#h37-0-5" id="h37-0-5" class="d">-    }
</a>     pthread_mutex_unlock(&amp;hook_mutex);
 } 
\ No newline at end of file
<b>diff --git a/<a id="h38" href="../file/native/jni/src/hooks/linker_hook.h.html">native/jni/src/hooks/linker_hook.h</a> b/<a href="../file/native/jni/src/hooks/linker_hook.h.html">native/jni/src/hooks/linker_hook.h</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -0,0 +1,54 @@
</a><a href="#h38-0-0" id="h38-0-0" class="i">+#pragma once
</a><a href="#h38-0-1" id="h38-0-1" class="i">+
</a><a href="#h38-0-2" id="h38-0-2" class="i">+#include &lt;map&gt;
</a><a href="#h38-0-3" id="h38-0-3" class="i">+
</a><a href="#h38-0-4" id="h38-0-4" class="i">+namespace LinkerHook {
</a><a href="#h38-0-5" id="h38-0-5" class="i">+    static auto linker_openat_hooks = std::map&lt;std::string, std::pair&lt;uintptr_t, size_t&gt;&gt;();
</a><a href="#h38-0-6" id="h38-0-6" class="i">+
</a><a href="#h38-0-7" id="h38-0-7" class="i">+    void JNICALL addLinkerSharedLibrary(JNIEnv *env, jobject, jstring path, jbyteArray content) {
</a><a href="#h38-0-8" id="h38-0-8" class="i">+        const char *path_str = env-&gt;GetStringUTFChars(path, nullptr);
</a><a href="#h38-0-9" id="h38-0-9" class="i">+        jsize content_len = env-&gt;GetArrayLength(content);
</a><a href="#h38-0-10" id="h38-0-10" class="i">+        jbyte *content_ptr = env-&gt;GetByteArrayElements(content, nullptr);
</a><a href="#h38-0-11" id="h38-0-11" class="i">+
</a><a href="#h38-0-12" id="h38-0-12" class="i">+        auto allocated_content = (jbyte *) malloc(content_len);
</a><a href="#h38-0-13" id="h38-0-13" class="i">+        memcpy(allocated_content, content_ptr, content_len);
</a><a href="#h38-0-14" id="h38-0-14" class="i">+        linker_openat_hooks[path_str] = std::make_pair((uintptr_t) allocated_content, content_len);
</a><a href="#h38-0-15" id="h38-0-15" class="i">+
</a><a href="#h38-0-16" id="h38-0-16" class="i">+        LOGD(&quot;added linker hook for %s, size=%d&quot;, path_str, content_len);
</a><a href="#h38-0-17" id="h38-0-17" class="i">+
</a><a href="#h38-0-18" id="h38-0-18" class="i">+        env-&gt;ReleaseStringUTFChars(path, path_str);
</a><a href="#h38-0-19" id="h38-0-19" class="i">+        env-&gt;ReleaseByteArrayElements(content, content_ptr, JNI_ABORT);
</a><a href="#h38-0-20" id="h38-0-20" class="i">+    }
</a><a href="#h38-0-21" id="h38-0-21" class="i">+
</a><a href="#h38-0-22" id="h38-0-22" class="i">+    HOOK_DEF(int, linker_openat, int dirfd, const char *pathname, int flags, mode_t mode) {
</a><a href="#h38-0-23" id="h38-0-23" class="i">+        for (const auto &amp;item: linker_openat_hooks) {
</a><a href="#h38-0-24" id="h38-0-24" class="i">+            if (strstr(pathname, item.first.c_str())) {
</a><a href="#h38-0-25" id="h38-0-25" class="i">+                LOGD(&quot;found openat hook for %s&quot;, pathname);
</a><a href="#h38-0-26" id="h38-0-26" class="i">+                static auto memfd_create = (int (*)(const char *, unsigned int)) DobbySymbolResolver(&quot;libc.so&quot;, &quot;memfd_create&quot;);
</a><a href="#h38-0-27" id="h38-0-27" class="i">+                auto fd = memfd_create(&quot;me.rhunk.snapenhance&quot;, 0);
</a><a href="#h38-0-28" id="h38-0-28" class="i">+                LOGD(&quot;memfd created: %d&quot;, fd);
</a><a href="#h38-0-29" id="h38-0-29" class="i">+
</a><a href="#h38-0-30" id="h38-0-30" class="i">+                if (fd == -1) {
</a><a href="#h38-0-31" id="h38-0-31" class="i">+                    LOGE(&quot;memfd_create failed: %d&quot;, errno);
</a><a href="#h38-0-32" id="h38-0-32" class="i">+                    return -1;
</a><a href="#h38-0-33" id="h38-0-33" class="i">+                }
</a><a href="#h38-0-34" id="h38-0-34" class="i">+                if (write(fd, (void *) item.second.first, item.second.second) == -1) {
</a><a href="#h38-0-35" id="h38-0-35" class="i">+                    LOGE(&quot;write failed: %d&quot;, errno);
</a><a href="#h38-0-36" id="h38-0-36" class="i">+                    return -1;
</a><a href="#h38-0-37" id="h38-0-37" class="i">+                }
</a><a href="#h38-0-38" id="h38-0-38" class="i">+                lseek(fd, 0, SEEK_SET);
</a><a href="#h38-0-39" id="h38-0-39" class="i">+
</a><a href="#h38-0-40" id="h38-0-40" class="i">+                free((void *) item.second.first);
</a><a href="#h38-0-41" id="h38-0-41" class="i">+                linker_openat_hooks.erase(item.first);
</a><a href="#h38-0-42" id="h38-0-42" class="i">+
</a><a href="#h38-0-43" id="h38-0-43" class="i">+                LOGD(&quot;memfd written&quot;);
</a><a href="#h38-0-44" id="h38-0-44" class="i">+                return fd;
</a><a href="#h38-0-45" id="h38-0-45" class="i">+            }
</a><a href="#h38-0-46" id="h38-0-46" class="i">+        }
</a><a href="#h38-0-47" id="h38-0-47" class="i">+        return linker_openat_original(dirfd, pathname, flags, mode);
</a><a href="#h38-0-48" id="h38-0-48" class="i">+    }
</a><a href="#h38-0-49" id="h38-0-49" class="i">+
</a><a href="#h38-0-50" id="h38-0-50" class="i">+    void init() {
</a><a href="#h38-0-51" id="h38-0-51" class="i">+        DobbyHook((void *) DobbySymbolResolver(ARM64 ? &quot;linker64&quot; : &quot;linker&quot;, &quot;__dl___openat&quot;), (void *) linker_openat, (void **) &amp;linker_openat_original);
</a><a href="#h38-0-52" id="h38-0-52" class="i">+    }
</a><a href="#h38-0-53" id="h38-0-53" class="i">+}</a><a href="#h38-0-54" id="h38-0-54" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h39" href="../file/native/jni/src/library.cpp.html">native/jni/src/library.cpp</a> b/<a href="../file/native/jni/src/library.cpp.html">native/jni/src/library.cpp</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -7,6 +7,7 @@
</a> #include &quot;logger.h&quot;
 #include &quot;common.h&quot;
 #include &quot;dobby_helper.h&quot;
<a href="#h39-0-3" id="h39-0-3" class="i">+#include &quot;hooks/linker_hook.h&quot;
</a> #include &quot;hooks/unary_call.h&quot;
 #include &quot;hooks/fstat_hook.h&quot;
 #include &quot;hooks/sqlite_mutex.h&quot;
<a href="#h39-1" id="h39-1" class="h">@@ -17,9 +18,6 @@
</a> bool JNICALL init(JNIEnv *env, jobject clazz) {
     LOGD(&quot;Initializing native&quot;);
     using namespace common;
<a href="#h39-1-3" id="h39-1-3" class="d">-    util::remap_sections([](const std::string &amp;line, size_t size) {
</a><a href="#h39-1-4" id="h39-1-4" class="d">-        return line.find(BUILD_PACKAGE) != std::string::npos;
</a><a href="#h39-1-5" id="h39-1-5" class="d">-    }, native_config-&gt;remap_executable);
</a> 
     native_lib_object = env-&gt;NewGlobalRef(clazz);
     client_module = util::get_module(&quot;libclient.so&quot;);
<a href="#h39-2" id="h39-2" class="h">@@ -66,7 +64,6 @@ void JNICALL load_config(JNIEnv *env, jobject, jobject config_object) {
</a>     native_config-&gt;disable_bitmoji = GET_CONFIG_BOOL(&quot;disableBitmoji&quot;);
     native_config-&gt;disable_metrics = GET_CONFIG_BOOL(&quot;disableMetrics&quot;);
     native_config-&gt;composer_hooks = GET_CONFIG_BOOL(&quot;composerHooks&quot;);
<a href="#h39-2-3" id="h39-2-3" class="d">-    native_config-&gt;remap_executable = GET_CONFIG_BOOL(&quot;remapExecutable&quot;);
</a> 
     memset(native_config-&gt;custom_emoji_font_path, 0, sizeof(native_config-&gt;custom_emoji_font_path));
     auto custom_emoji_font_path = env-&gt;GetObjectField(config_object, env-&gt;GetFieldID(native_config_clazz, &quot;customEmojiFontPath&quot;, &quot;Ljava/lang/String;&quot;));
<a href="#h39-3" id="h39-3" class="h">@@ -97,15 +94,6 @@ void JNICALL lock_database(JNIEnv *env, jobject, jstring database_name, jobject 
</a>     }
 }
 
<a href="#h39-3-3" id="h39-3-3" class="d">-void JNICALL hide_anonymous_dex_files(JNIEnv *, jobject) {
</a><a href="#h39-3-4" id="h39-3-4" class="d">-    util::remap_sections([](const std::string &amp;line, size_t size) {
</a><a href="#h39-3-5" id="h39-3-5" class="d">-        return (
</a><a href="#h39-3-6" id="h39-3-6" class="d">-            (common::native_config-&gt;remap_executable &amp;&amp; size == PAGE_SIZE &amp;&amp; line.find(&quot;r-xp 00000000 00&quot;) != std::string::npos &amp;&amp; line.find(&quot;[v&quot;) == std::string::npos) ||
</a><a href="#h39-3-7" id="h39-3-7" class="d">-            line.find(&quot;dalvik-DEX&quot;) != std::string::npos ||
</a><a href="#h39-3-8" id="h39-3-8" class="d">-            line.find(&quot;dalvik-classes&quot;) != std::string::npos
</a><a href="#h39-3-9" id="h39-3-9" class="d">-        );
</a><a href="#h39-3-10" id="h39-3-10" class="d">-    }, common::native_config-&gt;remap_executable);
</a><a href="#h39-3-11" id="h39-3-11" class="d">-}
</a> 
 extern &quot;C&quot; JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void *_) {
     common::java_vm = vm;
<a href="#h39-4" id="h39-4" class="h">@@ -118,7 +106,9 @@ extern &quot;C&quot; JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM *vm, void *_) {
</a>     methods.push_back({&quot;lockDatabase&quot;, &quot;(Ljava/lang/String;Ljava/lang/Runnable;)V&quot;, (void *)lock_database});
     methods.push_back({&quot;setComposerLoader&quot;, &quot;(Ljava/lang/String;)V&quot;, (void *) ComposerHook::setComposerLoader});
     methods.push_back({&quot;composerEval&quot;, &quot;(Ljava/lang/String;)Ljava/lang/String;&quot;,(void *) ComposerHook::composerEval});
<a href="#h39-4-3" id="h39-4-3" class="d">-    methods.push_back({&quot;hideAnonymousDexFiles&quot;, &quot;()V&quot;, (void *)hide_anonymous_dex_files});
</a><a href="#h39-4-4" id="h39-4-4" class="i">+    methods.push_back({&quot;addLinkerSharedLibrary&quot;, &quot;(Ljava/lang/String;[B)V&quot;, (void *) LinkerHook::addLinkerSharedLibrary});
</a><a href="#h39-4-5" id="h39-4-5" class="i">+
</a><a href="#h39-4-6" id="h39-4-6" class="i">+    LinkerHook::init();
</a> 
     env-&gt;RegisterNatives(env-&gt;FindClass(std::string(BUILD_NAMESPACE &quot;/NativeLib&quot;).c_str()), methods.data(), methods.size());
     return JNI_VERSION_1_6;
<b>diff --git a/<a id="h40" href="../file/native/jni/src/util.h.html">native/jni/src/util.h</a> b/<a href="../file/native/jni/src/util.h.html">native/jni/src/util.h</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -52,46 +52,6 @@ namespace util {
</a>         return { start_offset, end_offset - start_offset };
     }
 
<a href="#h40-0-3" id="h40-0-3" class="d">-    static void remap_sections(std::function&lt;bool(const std::string &amp;, size_t)&gt; filter, bool remove_read_permission) {
</a><a href="#h40-0-4" id="h40-0-4" class="d">-        char buff[256];
</a><a href="#h40-0-5" id="h40-0-5" class="d">-        auto maps = fopen(&quot;/proc/self/maps&quot;, &quot;rt&quot;);
</a><a href="#h40-0-6" id="h40-0-6" class="d">-
</a><a href="#h40-0-7" id="h40-0-7" class="d">-        while (fgets(buff, sizeof buff, maps) != NULL) {
</a><a href="#h40-0-8" id="h40-0-8" class="d">-            int len = strlen(buff);
</a><a href="#h40-0-9" id="h40-0-9" class="d">-            if (len &gt; 0 &amp;&amp; buff[len - 1] == &#39;\n&#39;) buff[--len] = &#39;\0&#39;;
</a><a href="#h40-0-10" id="h40-0-10" class="d">-
</a><a href="#h40-0-11" id="h40-0-11" class="d">-            size_t start, end, offset;
</a><a href="#h40-0-12" id="h40-0-12" class="d">-            char flags[4];
</a><a href="#h40-0-13" id="h40-0-13" class="d">-
</a><a href="#h40-0-14" id="h40-0-14" class="d">-            if (sscanf(buff, &quot;%zx-%zx %c%c%c%c %zx&quot;, &amp;start, &amp;end,
</a><a href="#h40-0-15" id="h40-0-15" class="d">-                       &amp;flags[0], &amp;flags[1], &amp;flags[2], &amp;flags[3], &amp;offset) != 7) continue;
</a><a href="#h40-0-16" id="h40-0-16" class="d">-
</a><a href="#h40-0-17" id="h40-0-17" class="d">-            if (!filter(buff, end - start)) continue;
</a><a href="#h40-0-18" id="h40-0-18" class="d">-
</a><a href="#h40-0-19" id="h40-0-19" class="d">-            auto section_size = end - start;
</a><a href="#h40-0-20" id="h40-0-20" class="d">-            auto section_ptr = mmap(0, section_size, PROT_READ | PROT_EXEC | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);
</a><a href="#h40-0-21" id="h40-0-21" class="d">-
</a><a href="#h40-0-22" id="h40-0-22" class="d">-            if (section_ptr == MAP_FAILED) {
</a><a href="#h40-0-23" id="h40-0-23" class="d">-                LOGE(&quot;mmap failed: %s&quot;, strerror(errno));
</a><a href="#h40-0-24" id="h40-0-24" class="d">-                break;
</a><a href="#h40-0-25" id="h40-0-25" class="d">-            }
</a><a href="#h40-0-26" id="h40-0-26" class="d">-
</a><a href="#h40-0-27" id="h40-0-27" class="d">-            memcpy(section_ptr, (void *)start, section_size);
</a><a href="#h40-0-28" id="h40-0-28" class="d">-
</a><a href="#h40-0-29" id="h40-0-29" class="d">-            if (mremap(section_ptr, section_size, section_size, MREMAP_MAYMOVE | MREMAP_FIXED, start) == MAP_FAILED) {
</a><a href="#h40-0-30" id="h40-0-30" class="d">-                LOGE(&quot;mremap failed: %s&quot;, strerror(errno));
</a><a href="#h40-0-31" id="h40-0-31" class="d">-                break;
</a><a href="#h40-0-32" id="h40-0-32" class="d">-            }
</a><a href="#h40-0-33" id="h40-0-33" class="d">-
</a><a href="#h40-0-34" id="h40-0-34" class="d">-            auto new_prot = (flags[0] == &#39;r&#39; ? PROT_READ : 0) | (flags[1] == &#39;w&#39; ? PROT_WRITE : 0) | (flags[2] == &#39;x&#39; ? PROT_EXEC : 0);
</a><a href="#h40-0-35" id="h40-0-35" class="d">-            if (remove_read_permission &amp;&amp; flags[0] == &#39;r&#39; &amp;&amp; flags[2] == &#39;x&#39;) {
</a><a href="#h40-0-36" id="h40-0-36" class="d">-                new_prot &amp;= ~PROT_READ;
</a><a href="#h40-0-37" id="h40-0-37" class="d">-            }
</a><a href="#h40-0-38" id="h40-0-38" class="d">-            mprotect((void *)start, section_size, new_prot);
</a><a href="#h40-0-39" id="h40-0-39" class="d">-        }
</a><a href="#h40-0-40" id="h40-0-40" class="d">-        fclose(maps);
</a><a href="#h40-0-41" id="h40-0-41" class="d">-    }
</a><a href="#h40-0-42" id="h40-0-42" class="d">-
</a>     static uintptr_t find_signature(uintptr_t module_base, uintptr_t size, const std::string &amp;pattern, int offset = 0) {
         std::vector&lt;char&gt; bytes;
         std::vector&lt;char&gt; mask;
<b>diff --git a/<a id="h41" href="../file/native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeConfig.kt.html">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeConfig.kt</a> b/<a href="../file/native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeConfig.kt.html">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeConfig.kt</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -8,7 +8,5 @@ data class NativeConfig(
</a>     @JvmField
     val composerHooks: Boolean = false,
     @JvmField
<a href="#h41-0-3" id="h41-0-3" class="d">-    val remapExecutable: Boolean = false,
</a><a href="#h41-0-4" id="h41-0-4" class="d">-    @JvmField
</a>     val customEmojiFontPath: String? = null,
 ) 
\ No newline at end of file
<b>diff --git a/<a id="h42" href="../file/native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt.html">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt</a> b/<a href="../file/native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt.html">native/src/main/kotlin/me/rhunk/snapenhance/nativelib/NativeLib.kt</a></b>
<a href="#h42-0" id="h42-0" class="h">@@ -1,6 +1,9 @@
</a> package me.rhunk.snapenhance.nativelib
 
<a href="#h42-0-2" id="h42-0-2" class="i">+import android.annotation.SuppressLint
</a> import android.util.Log
<a href="#h42-0-4" id="h42-0-4" class="i">+import kotlin.math.absoluteValue
</a><a href="#h42-0-5" id="h42-0-5" class="i">+import kotlin.random.Random
</a> 
 @Suppress(&quot;KotlinJniMissingFunction&quot;)
 class NativeLib {
<a href="#h42-1" id="h42-1" class="h">@@ -11,19 +14,21 @@ class NativeLib {
</a>             private set
     }
 
<a href="#h42-1-3" id="h42-1-3" class="d">-    fun initOnce(callback: NativeLib.() -&gt; Unit) {
</a><a href="#h42-1-4" id="h42-1-4" class="i">+    fun initOnce(callback: NativeLib.() -&gt; Unit): () -&gt; Unit {
</a>         if (initialized) throw IllegalStateException(&quot;NativeLib already initialized&quot;)
<a href="#h42-1-6" id="h42-1-6" class="d">-        runCatching {
</a><a href="#h42-1-7" id="h42-1-7" class="i">+        return runCatching {
</a>             System.loadLibrary(BuildConfig.NATIVE_NAME)
             initialized = true
             callback(this)
<a href="#h42-1-11" id="h42-1-11" class="d">-            if (!init()) {
</a><a href="#h42-1-12" id="h42-1-12" class="d">-                throw IllegalStateException(&quot;NativeLib init failed. Check logcat for more info&quot;)
</a><a href="#h42-1-13" id="h42-1-13" class="i">+            return@runCatching {
</a><a href="#h42-1-14" id="h42-1-14" class="i">+                if (!init()) {
</a><a href="#h42-1-15" id="h42-1-15" class="i">+                    throw IllegalStateException(&quot;NativeLib init failed. Check logcat for more info&quot;)
</a><a href="#h42-1-16" id="h42-1-16" class="i">+                }
</a>             }
         }.onFailure {
             initialized = false
             Log.e(&quot;SnapEnhance&quot;, &quot;NativeLib init failed&quot;, it)
<a href="#h42-1-21" id="h42-1-21" class="d">-        }
</a><a href="#h42-1-22" id="h42-1-22" class="i">+        }.getOrThrow()
</a>     }
 
     @Suppress(&quot;unused&quot;)
<a href="#h42-2" id="h42-2" class="h">@@ -54,10 +59,18 @@ class NativeLib {
</a>         }
     }
 
<a href="#h42-2-3" id="h42-2-3" class="i">+    @SuppressLint(&quot;UnsafeDynamicallyLoadedCode&quot;)
</a><a href="#h42-2-4" id="h42-2-4" class="i">+    fun loadSharedLibrary(content: ByteArray) {
</a><a href="#h42-2-5" id="h42-2-5" class="i">+        if (!initialized) throw IllegalStateException(&quot;NativeLib not initialized&quot;)
</a><a href="#h42-2-6" id="h42-2-6" class="i">+        val generatedPath = &quot;/data/app/${Random.nextLong().absoluteValue.toString(16)}.so&quot;
</a><a href="#h42-2-7" id="h42-2-7" class="i">+        addLinkerSharedLibrary(generatedPath, content)
</a><a href="#h42-2-8" id="h42-2-8" class="i">+        System.load(generatedPath)
</a><a href="#h42-2-9" id="h42-2-9" class="i">+    }
</a><a href="#h42-2-10" id="h42-2-10" class="i">+
</a>     private external fun init(): Boolean
     private external fun loadConfig(config: NativeConfig)
     private external fun lockDatabase(name: String, callback: Runnable)
     external fun setComposerLoader(code: String)
     external fun composerEval(code: String): String?
<a href="#h42-2-16" id="h42-2-16" class="d">-    external fun hideAnonymousDexFiles()
</a><a href="#h42-2-17" id="h42-2-17" class="i">+    private external fun addLinkerSharedLibrary(path: String, content: ByteArray)
</a> } 
\ No newline at end of file
</pre>
</div>
</body>
</html>
