<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: features overlay - rename debug section to settings - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/258b10fd728e5d471df8347710e44d062100f857.html">258b10fd728e5d471df8347710e44d062100f857</a>
<b>parent</b> <a href="../commit/f2e49e93fbd3df5b1a9e70601b33c38b9256445f.html">f2e49e93fbd3df5b1a9e70601b33c38b9256445f</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Fri, 22 Sep 2023 00:52:56 +0200

feat: features overlay
- rename debug section to settings

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/AndroidManifest.xml</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></td><td> | </td><td class="num">15</td><td><span class="i">+++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a></td><td> | </td><td class="num">57</td><td><span class="i">+++++++++++++++++++++++++++++++++++</span><span class="d">----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a></td><td> | </td><td class="num">39</td><td><span class="i">+++++++++</span><span class="d">------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt</a></td><td> | </td><td class="num">121</td><td><span class="i">+++</span><span class="d">----------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/SettingsSection.kt</a></td><td> | </td><td class="num">118</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/ComposeOverlay.kt</a></td><td> | </td><td class="num">72</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/SettingsOverlay.kt</a></td><td> | </td><td class="num">134</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AndroidDialogCustom.kt</a></td><td> | </td><td class="num">360</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">app/src/main/res/values/styles.xml</a></td><td> | </td><td class="num">14</td><td><span class="i">++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">core/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h13">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></td><td> | </td><td class="num">43</td><td><span class="i">++++++++++++++++++++++++++++</span><span class="d">---------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
</table></pre><pre>16 files changed, 803 insertions(+), 187 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/AndroidManifest.xml.html">app/src/main/AndroidManifest.xml</a> b/<a href="../file/app/src/main/AndroidManifest.xml.html">app/src/main/AndroidManifest.xml</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -5,6 +5,7 @@
</a>     &lt;uses-permission android:name=&quot;android.permission.POST_NOTIFICATIONS&quot; /&gt;
     &lt;uses-permission android:name=&quot;android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS&quot; /&gt;
     &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
<a href="#h0-0-3" id="h0-0-3" class="i">+    &lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot; /&gt;
</a> 
     &lt;queries&gt;
         &lt;package android:name=&quot;com.snapchat.android&quot; /&gt;
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/RemoteSideContext.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -25,6 +25,7 @@ import me.rhunk.snapenhance.download.DownloadTaskManager
</a> import me.rhunk.snapenhance.messaging.ModDatabase
 import me.rhunk.snapenhance.messaging.StreaksReminder
 import me.rhunk.snapenhance.scripting.RemoteScriptManager
<a href="#h1-0-3" id="h1-0-3" class="i">+import me.rhunk.snapenhance.ui.overlay.SettingsOverlay
</a> import me.rhunk.snapenhance.ui.manager.MainActivity
 import me.rhunk.snapenhance.ui.manager.data.InstallationSummary
 import me.rhunk.snapenhance.ui.manager.data.ModInfo
<a href="#h1-1" id="h1-1" class="h">@@ -56,6 +57,7 @@ class RemoteSideContext(
</a>     val streaksReminder = StreaksReminder(this)
     val log = LogManager(this)
     val scriptManager = RemoteScriptManager(this)
<a href="#h1-1-3" id="h1-1-3" class="i">+    val settingsOverlay = SettingsOverlay(this)
</a> 
     //used to load bitmoji selfies and download previews
     val imageLoader by lazy {
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -187,5 +187,20 @@ class BridgeService : Service() {
</a>         }
 
         override fun getScriptingInterface() = remoteSideContext.scriptManager
<a href="#h2-0-3" id="h2-0-3" class="i">+        override fun openSettingsOverlay() {
</a><a href="#h2-0-4" id="h2-0-4" class="i">+            runCatching {
</a><a href="#h2-0-5" id="h2-0-5" class="i">+                remoteSideContext.settingsOverlay.show()
</a><a href="#h2-0-6" id="h2-0-6" class="i">+            }.onFailure {
</a><a href="#h2-0-7" id="h2-0-7" class="i">+                remoteSideContext.log.error(&quot;Failed to open settings overlay&quot;, it)
</a><a href="#h2-0-8" id="h2-0-8" class="i">+            }
</a><a href="#h2-0-9" id="h2-0-9" class="i">+        }
</a><a href="#h2-0-10" id="h2-0-10" class="i">+
</a><a href="#h2-0-11" id="h2-0-11" class="i">+        override fun closeSettingsOverlay() {
</a><a href="#h2-0-12" id="h2-0-12" class="i">+            runCatching {
</a><a href="#h2-0-13" id="h2-0-13" class="i">+                remoteSideContext.settingsOverlay.close()
</a><a href="#h2-0-14" id="h2-0-14" class="i">+            }.onFailure {
</a><a href="#h2-0-15" id="h2-0-15" class="i">+                remoteSideContext.log.error(&quot;Failed to close settings overlay&quot;, it)
</a><a href="#h2-0-16" id="h2-0-16" class="i">+            }
</a><a href="#h2-0-17" id="h2-0-17" class="i">+        }
</a>     }
 }
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,5 +1,6 @@
</a> package me.rhunk.snapenhance.ui.manager.sections.features
 
<a href="#h3-0-2" id="h3-0-2" class="i">+import android.content.Intent
</a> import android.net.Uri
 import androidx.compose.animation.AnimatedContentTransitionScope
 import androidx.compose.animation.core.tween
<a href="#h3-1" id="h3-1" class="h">@@ -65,7 +66,6 @@ import androidx.compose.ui.text.font.FontWeight
</a> import androidx.compose.ui.text.style.TextOverflow
 import androidx.compose.ui.unit.dp
 import androidx.compose.ui.unit.sp
<a href="#h3-1-3" id="h3-1-3" class="d">-import androidx.compose.ui.window.Dialog
</a> import androidx.navigation.NavGraphBuilder
 import androidx.navigation.NavOptions
 import androidx.navigation.compose.composable
<a href="#h3-2" id="h3-2" class="h">@@ -80,12 +80,9 @@ import me.rhunk.snapenhance.core.config.FeatureNotice
</a> import me.rhunk.snapenhance.core.config.PropertyKey
 import me.rhunk.snapenhance.core.config.PropertyPair
 import me.rhunk.snapenhance.core.config.PropertyValue
<a href="#h3-2-3" id="h3-2-3" class="i">+import me.rhunk.snapenhance.ui.manager.MainActivity
</a> import me.rhunk.snapenhance.ui.manager.Section
<a href="#h3-2-5" id="h3-2-5" class="d">-import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
</a><a href="#h3-2-6" id="h3-2-6" class="d">-import me.rhunk.snapenhance.ui.util.AlertDialogs
</a><a href="#h3-2-7" id="h3-2-7" class="d">-import me.rhunk.snapenhance.ui.util.chooseFolder
</a><a href="#h3-2-8" id="h3-2-8" class="d">-import me.rhunk.snapenhance.ui.util.openFile
</a><a href="#h3-2-9" id="h3-2-9" class="d">-import me.rhunk.snapenhance.ui.util.saveFile
</a><a href="#h3-2-10" id="h3-2-10" class="i">+import me.rhunk.snapenhance.ui.util.*
</a> 
 @OptIn(ExperimentalMaterial3Api::class)
 class FeaturesSection : Section() {
<a href="#h3-3" id="h3-3" class="h">@@ -98,7 +95,7 @@ class FeaturesSection : Section() {
</a>     }
 
 
<a href="#h3-3-3" id="h3-3-3" class="d">-    private lateinit var activityLauncherHelper: ActivityLauncherHelper
</a><a href="#h3-3-4" id="h3-3-4" class="i">+    private var activityLauncherHelper: ActivityLauncherHelper? = null
</a>     private val featuresRouteName by lazy { context.translation[&quot;manager.routes.features&quot;] }
 
     private lateinit var rememberScaffoldState: BottomSheetScaffoldState
<a href="#h3-4" id="h3-4" class="h">@@ -143,6 +140,16 @@ class FeaturesSection : Section() {
</a>         activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
     }
 
<a href="#h3-4-3" id="h3-4-3" class="i">+    private fun activityLauncher(block: ActivityLauncherHelper.() -&gt; Unit) {
</a><a href="#h3-4-4" id="h3-4-4" class="i">+        activityLauncherHelper?.let(block) ?: run {
</a><a href="#h3-4-5" id="h3-4-5" class="i">+            //open manager if activity launcher is null
</a><a href="#h3-4-6" id="h3-4-6" class="i">+            val intent = Intent(context.androidContext, MainActivity::class.java)
</a><a href="#h3-4-7" id="h3-4-7" class="i">+            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
</a><a href="#h3-4-8" id="h3-4-8" class="i">+            intent.putExtra(&quot;route&quot;, enumSection.route)
</a><a href="#h3-4-9" id="h3-4-9" class="i">+            context.androidContext.startActivity(intent)
</a><a href="#h3-4-10" id="h3-4-10" class="i">+        }
</a><a href="#h3-4-11" id="h3-4-11" class="i">+    }
</a><a href="#h3-4-12" id="h3-4-12" class="i">+
</a>     override fun build(navGraphBuilder: NavGraphBuilder) {
         navGraphBuilder.navigation(route = enumSection.route, startDestination = MAIN_ROUTE) {
             composable(MAIN_ROUTE) {
<a href="#h3-5" id="h3-5" class="h">@@ -194,8 +201,10 @@ class FeaturesSection : Section() {
</a> 
         if (property.key.params.flags.contains(ConfigFlag.FOLDER)) {
             IconButton(onClick = registerClickCallback {
<a href="#h3-5-3" id="h3-5-3" class="d">-                activityLauncherHelper.chooseFolder { uri -&gt;
</a><a href="#h3-5-4" id="h3-5-4" class="d">-                    propertyValue.setAny(uri)
</a><a href="#h3-5-5" id="h3-5-5" class="i">+                activityLauncher {
</a><a href="#h3-5-6" id="h3-5-6" class="i">+                    chooseFolder { uri -&gt;
</a><a href="#h3-5-7" id="h3-5-7" class="i">+                        propertyValue.setAny(uri)
</a><a href="#h3-5-8" id="h3-5-8" class="i">+                    }
</a>                 }
             }.let { { it.invoke(true) } }) {
                 Icon(Icons.Filled.FolderOpen, contentDescription = null)
<a href="#h3-6" id="h3-6" class="h">@@ -478,24 +487,28 @@ class FeaturesSection : Section() {
</a>         val actions = remember {
             mapOf(
                 &quot;Export&quot; to {
<a href="#h3-6-3" id="h3-6-3" class="d">-                    activityLauncherHelper.saveFile(&quot;config.json&quot;, &quot;application/json&quot;) { uri -&gt;
</a><a href="#h3-6-4" id="h3-6-4" class="d">-                        context.androidContext.contentResolver.openOutputStream(Uri.parse(uri))?.use {
</a><a href="#h3-6-5" id="h3-6-5" class="d">-                            context.config.writeConfig()
</a><a href="#h3-6-6" id="h3-6-6" class="d">-                            context.config.exportToString().byteInputStream().copyTo(it)
</a><a href="#h3-6-7" id="h3-6-7" class="d">-                            context.shortToast(&quot;Config exported successfully!&quot;)
</a><a href="#h3-6-8" id="h3-6-8" class="i">+                    activityLauncher {
</a><a href="#h3-6-9" id="h3-6-9" class="i">+                        saveFile(&quot;config.json&quot;, &quot;application/json&quot;) { uri -&gt;
</a><a href="#h3-6-10" id="h3-6-10" class="i">+                            context.androidContext.contentResolver.openOutputStream(Uri.parse(uri))?.use {
</a><a href="#h3-6-11" id="h3-6-11" class="i">+                                context.config.writeConfig()
</a><a href="#h3-6-12" id="h3-6-12" class="i">+                                context.config.exportToString().byteInputStream().copyTo(it)
</a><a href="#h3-6-13" id="h3-6-13" class="i">+                                context.shortToast(&quot;Config exported successfully!&quot;)
</a><a href="#h3-6-14" id="h3-6-14" class="i">+                            }
</a>                         }
                     }
                 },
                 &quot;Import&quot; to {
<a href="#h3-6-19" id="h3-6-19" class="d">-                    activityLauncherHelper.openFile(&quot;application/json&quot;) { uri -&gt;
</a><a href="#h3-6-20" id="h3-6-20" class="d">-                        context.androidContext.contentResolver.openInputStream(Uri.parse(uri))?.use {
</a><a href="#h3-6-21" id="h3-6-21" class="d">-                            runCatching {
</a><a href="#h3-6-22" id="h3-6-22" class="d">-                                context.config.loadFromString(it.readBytes().toString(Charsets.UTF_8))
</a><a href="#h3-6-23" id="h3-6-23" class="d">-                            }.onFailure {
</a><a href="#h3-6-24" id="h3-6-24" class="d">-                                context.longToast(&quot;Failed to import config ${it.message}&quot;)
</a><a href="#h3-6-25" id="h3-6-25" class="d">-                                return@use
</a><a href="#h3-6-26" id="h3-6-26" class="i">+                    activityLauncher {
</a><a href="#h3-6-27" id="h3-6-27" class="i">+                        openFile(&quot;application/json&quot;) { uri -&gt;
</a><a href="#h3-6-28" id="h3-6-28" class="i">+                            context.androidContext.contentResolver.openInputStream(Uri.parse(uri))?.use {
</a><a href="#h3-6-29" id="h3-6-29" class="i">+                                runCatching {
</a><a href="#h3-6-30" id="h3-6-30" class="i">+                                    context.config.loadFromString(it.readBytes().toString(Charsets.UTF_8))
</a><a href="#h3-6-31" id="h3-6-31" class="i">+                                }.onFailure {
</a><a href="#h3-6-32" id="h3-6-32" class="i">+                                    context.longToast(&quot;Failed to import config ${it.message}&quot;)
</a><a href="#h3-6-33" id="h3-6-33" class="i">+                                    return@use
</a><a href="#h3-6-34" id="h3-6-34" class="i">+                                }
</a><a href="#h3-6-35" id="h3-6-35" class="i">+                                context.shortToast(&quot;Config successfully loaded!&quot;)
</a>                             }
<a href="#h3-6-37" id="h3-6-37" class="d">-                            context.shortToast(&quot;Config successfully loaded!&quot;)
</a>                         }
                     }
                 },
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -4,32 +4,11 @@ import android.content.Intent
</a> import android.net.Uri
 import androidx.compose.foundation.Image
 import androidx.compose.foundation.ScrollState
<a href="#h4-0-3" id="h4-0-3" class="d">-import androidx.compose.foundation.layout.Arrangement
</a><a href="#h4-0-4" id="h4-0-4" class="d">-import androidx.compose.foundation.layout.Column
</a><a href="#h4-0-5" id="h4-0-5" class="d">-import androidx.compose.foundation.layout.Row
</a><a href="#h4-0-6" id="h4-0-6" class="d">-import androidx.compose.foundation.layout.RowScope
</a><a href="#h4-0-7" id="h4-0-7" class="d">-import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h4-0-8" id="h4-0-8" class="d">-import androidx.compose.foundation.layout.height
</a><a href="#h4-0-9" id="h4-0-9" class="d">-import androidx.compose.foundation.layout.padding
</a><a href="#h4-0-10" id="h4-0-10" class="i">+import androidx.compose.foundation.layout.*
</a> import androidx.compose.foundation.verticalScroll
 import androidx.compose.material.icons.Icons
<a href="#h4-0-13" id="h4-0-13" class="d">-import androidx.compose.material.icons.filled.BugReport
</a><a href="#h4-0-14" id="h4-0-14" class="d">-import androidx.compose.material.icons.filled.Language
</a><a href="#h4-0-15" id="h4-0-15" class="d">-import androidx.compose.material.icons.filled.Map
</a><a href="#h4-0-16" id="h4-0-16" class="d">-import androidx.compose.material.icons.filled.MoreVert
</a><a href="#h4-0-17" id="h4-0-17" class="d">-import androidx.compose.material.icons.filled.OpenInNew
</a><a href="#h4-0-18" id="h4-0-18" class="d">-import androidx.compose.material.icons.filled.ReceiptLong
</a><a href="#h4-0-19" id="h4-0-19" class="d">-import androidx.compose.material.icons.filled.Refresh
</a><a href="#h4-0-20" id="h4-0-20" class="d">-import androidx.compose.material3.Button
</a><a href="#h4-0-21" id="h4-0-21" class="d">-import androidx.compose.material3.Card
</a><a href="#h4-0-22" id="h4-0-22" class="d">-import androidx.compose.material3.CardDefaults
</a><a href="#h4-0-23" id="h4-0-23" class="d">-import androidx.compose.material3.DropdownMenu
</a><a href="#h4-0-24" id="h4-0-24" class="d">-import androidx.compose.material3.DropdownMenuItem
</a><a href="#h4-0-25" id="h4-0-25" class="d">-import androidx.compose.material3.Icon
</a><a href="#h4-0-26" id="h4-0-26" class="d">-import androidx.compose.material3.IconButton
</a><a href="#h4-0-27" id="h4-0-27" class="d">-import androidx.compose.material3.MaterialTheme
</a><a href="#h4-0-28" id="h4-0-28" class="d">-import androidx.compose.material3.OutlinedCard
</a><a href="#h4-0-29" id="h4-0-29" class="d">-import androidx.compose.material3.Text
</a><a href="#h4-0-30" id="h4-0-30" class="i">+import androidx.compose.material.icons.filled.*
</a><a href="#h4-0-31" id="h4-0-31" class="i">+import androidx.compose.material3.*
</a> import androidx.compose.runtime.Composable
 import androidx.compose.runtime.getValue
 import androidx.compose.runtime.mutableStateOf
<a href="#h4-1" id="h4-1" class="h">@@ -63,8 +42,8 @@ class HomeSection : Section() {
</a>     companion object {
         val cardMargin = 10.dp
         const val HOME_ROOT = &quot;home_root&quot;
<a href="#h4-1-3" id="h4-1-3" class="d">-        const val DEBUG_SECTION_ROUTE = &quot;home_debug&quot;
</a>         const val LOGS_SECTION_ROUTE = &quot;home_logs&quot;
<a href="#h4-1-5" id="h4-1-5" class="i">+        const val SETTINGS_SECTION_ROUTE = &quot;home_settings&quot;
</a>     }
 
     private var installationSummary: InstallationSummary? = null
<a href="#h4-2" id="h4-2" class="h">@@ -223,12 +202,12 @@ class HomeSection : Section() {
</a>                     IconButton(onClick = {
                         navController.navigate(LOGS_SECTION_ROUTE)
                     }) {
<a href="#h4-2-3" id="h4-2-3" class="d">-                        Icon(Icons.Filled.ReceiptLong, contentDescription = null)
</a><a href="#h4-2-4" id="h4-2-4" class="i">+                        Icon(Icons.Filled.BugReport, contentDescription = null)
</a>                     }
                     IconButton(onClick = {
<a href="#h4-2-7" id="h4-2-7" class="d">-                        navController.navigate(DEBUG_SECTION_ROUTE)
</a><a href="#h4-2-8" id="h4-2-8" class="i">+                        navController.navigate(SETTINGS_SECTION_ROUTE)
</a>                     }) {
<a href="#h4-2-10" id="h4-2-10" class="d">-                        Icon(Icons.Filled.BugReport, contentDescription = null)
</a><a href="#h4-2-11" id="h4-2-11" class="i">+                        Icon(Icons.Filled.Settings, contentDescription = null)
</a>                     }
                 }
                 LOGS_SECTION_ROUTE -&gt; {
<a href="#h4-3" id="h4-3" class="h">@@ -290,8 +269,8 @@ class HomeSection : Section() {
</a>             composable(LOGS_SECTION_ROUTE) {
                 homeSubSection.LogsSection()
             }
<a href="#h4-3-3" id="h4-3-3" class="d">-            composable(DEBUG_SECTION_ROUTE) {
</a><a href="#h4-3-4" id="h4-3-4" class="d">-                homeSubSection.DebugSection()
</a><a href="#h4-3-5" id="h4-3-5" class="i">+            composable(SETTINGS_SECTION_ROUTE) {
</a><a href="#h4-3-6" id="h4-3-6" class="i">+                SettingsSection().also { it.context = context }.Content()
</a>             }
         }
     }
<b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSubSection.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -2,26 +2,14 @@ package me.rhunk.snapenhance.ui.manager.sections.home
</a> 
 import androidx.compose.foundation.ScrollState
 import androidx.compose.foundation.background
<a href="#h5-0-3" id="h5-0-3" class="d">-import androidx.compose.foundation.clickable
</a> import androidx.compose.foundation.gestures.detectTapGestures
 import androidx.compose.foundation.horizontalScroll
<a href="#h5-0-6" id="h5-0-6" class="d">-import androidx.compose.foundation.layout.Arrangement
</a><a href="#h5-0-7" id="h5-0-7" class="d">-import androidx.compose.foundation.layout.Box
</a><a href="#h5-0-8" id="h5-0-8" class="d">-import androidx.compose.foundation.layout.Column
</a><a href="#h5-0-9" id="h5-0-9" class="d">-import androidx.compose.foundation.layout.Row
</a><a href="#h5-0-10" id="h5-0-10" class="d">-import androidx.compose.foundation.layout.defaultMinSize
</a><a href="#h5-0-11" id="h5-0-11" class="d">-import androidx.compose.foundation.layout.fillMaxSize
</a><a href="#h5-0-12" id="h5-0-12" class="d">-import androidx.compose.foundation.layout.fillMaxWidth
</a><a href="#h5-0-13" id="h5-0-13" class="d">-import androidx.compose.foundation.layout.height
</a><a href="#h5-0-14" id="h5-0-14" class="d">-import androidx.compose.foundation.layout.padding
</a><a href="#h5-0-15" id="h5-0-15" class="d">-import androidx.compose.foundation.layout.size
</a><a href="#h5-0-16" id="h5-0-16" class="i">+import androidx.compose.foundation.layout.*
</a> import androidx.compose.foundation.lazy.LazyColumn
 import androidx.compose.foundation.lazy.LazyListState
<a href="#h5-0-19" id="h5-0-19" class="d">-import androidx.compose.foundation.verticalScroll
</a> import androidx.compose.material.icons.Icons
 import androidx.compose.material.icons.filled.KeyboardDoubleArrowDown
 import androidx.compose.material.icons.filled.KeyboardDoubleArrowUp
<a href="#h5-0-23" id="h5-0-23" class="d">-import androidx.compose.material.icons.filled.OpenInNew
</a> import androidx.compose.material.icons.outlined.BugReport
 import androidx.compose.material.icons.outlined.Info
 import androidx.compose.material.icons.outlined.Report
<a href="#h5-1" id="h5-1" class="h">@@ -29,17 +17,9 @@ import androidx.compose.material.icons.outlined.Warning
</a> import androidx.compose.material3.CircularProgressIndicator
 import androidx.compose.material3.FilledIconButton
 import androidx.compose.material3.Icon
<a href="#h5-1-3" id="h5-1-3" class="d">-import androidx.compose.material3.IconButton
</a> import androidx.compose.material3.MaterialTheme
 import androidx.compose.material3.Text
<a href="#h5-1-6" id="h5-1-6" class="d">-import androidx.compose.runtime.Composable
</a><a href="#h5-1-7" id="h5-1-7" class="d">-import androidx.compose.runtime.LaunchedEffect
</a><a href="#h5-1-8" id="h5-1-8" class="d">-import androidx.compose.runtime.getValue
</a><a href="#h5-1-9" id="h5-1-9" class="d">-import androidx.compose.runtime.mutableIntStateOf
</a><a href="#h5-1-10" id="h5-1-10" class="d">-import androidx.compose.runtime.mutableStateOf
</a><a href="#h5-1-11" id="h5-1-11" class="d">-import androidx.compose.runtime.remember
</a><a href="#h5-1-12" id="h5-1-12" class="d">-import androidx.compose.runtime.rememberCoroutineScope
</a><a href="#h5-1-13" id="h5-1-13" class="d">-import androidx.compose.runtime.setValue
</a><a href="#h5-1-14" id="h5-1-14" class="i">+import androidx.compose.runtime.*
</a> import androidx.compose.ui.Alignment
 import androidx.compose.ui.Modifier
 import androidx.compose.ui.input.pointer.pointerInput
<a href="#h5-2" id="h5-2" class="h">@@ -49,73 +29,19 @@ import androidx.compose.ui.text.font.FontWeight
</a> import androidx.compose.ui.text.style.TextOverflow
 import androidx.compose.ui.unit.dp
 import androidx.compose.ui.unit.sp
<a href="#h5-2-3" id="h5-2-3" class="d">-import androidx.compose.ui.window.Dialog
</a> import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.launch
<a href="#h5-2-6" id="h5-2-6" class="d">-import me.rhunk.snapenhance.Constants
</a><a href="#h5-2-7" id="h5-2-7" class="d">-import me.rhunk.snapenhance.core.logger.LogChannel
</a><a href="#h5-2-8" id="h5-2-8" class="d">-import me.rhunk.snapenhance.core.logger.LogLevel
</a> import me.rhunk.snapenhance.LogReader
 import me.rhunk.snapenhance.RemoteSideContext
<a href="#h5-2-11" id="h5-2-11" class="d">-import me.rhunk.snapenhance.action.EnumAction
</a><a href="#h5-2-12" id="h5-2-12" class="d">-import me.rhunk.snapenhance.core.bridge.types.BridgeFileType
</a><a href="#h5-2-13" id="h5-2-13" class="d">-import me.rhunk.snapenhance.manager.impl.ActionManager
</a><a href="#h5-2-14" id="h5-2-14" class="d">-import me.rhunk.snapenhance.ui.util.AlertDialogs
</a><a href="#h5-2-15" id="h5-2-15" class="i">+import me.rhunk.snapenhance.core.logger.LogChannel
</a><a href="#h5-2-16" id="h5-2-16" class="i">+import me.rhunk.snapenhance.core.logger.LogLevel
</a> 
 class HomeSubSection(
     private val context: RemoteSideContext
 ) {
<a href="#h5-2-21" id="h5-2-21" class="d">-    private val dialogs by lazy { AlertDialogs(context.translation) }
</a><a href="#h5-2-22" id="h5-2-22" class="d">-
</a>     private lateinit var logListState: LazyListState
 
     @Composable
<a href="#h5-2-26" id="h5-2-26" class="d">-    private fun RowAction(title: String, requireConfirmation: Boolean = false, action: () -&gt; Unit) {
</a><a href="#h5-2-27" id="h5-2-27" class="d">-        var confirmationDialog by remember {
</a><a href="#h5-2-28" id="h5-2-28" class="d">-            mutableStateOf(false)
</a><a href="#h5-2-29" id="h5-2-29" class="d">-        }
</a><a href="#h5-2-30" id="h5-2-30" class="d">-
</a><a href="#h5-2-31" id="h5-2-31" class="d">-        fun takeAction() {
</a><a href="#h5-2-32" id="h5-2-32" class="d">-            if (requireConfirmation) {
</a><a href="#h5-2-33" id="h5-2-33" class="d">-                confirmationDialog = true
</a><a href="#h5-2-34" id="h5-2-34" class="d">-            } else {
</a><a href="#h5-2-35" id="h5-2-35" class="d">-                action()
</a><a href="#h5-2-36" id="h5-2-36" class="d">-            }
</a><a href="#h5-2-37" id="h5-2-37" class="d">-        }
</a><a href="#h5-2-38" id="h5-2-38" class="d">-
</a><a href="#h5-2-39" id="h5-2-39" class="d">-        if (requireConfirmation &amp;&amp; confirmationDialog) {
</a><a href="#h5-2-40" id="h5-2-40" class="d">-            Dialog(onDismissRequest = { confirmationDialog = false }) {
</a><a href="#h5-2-41" id="h5-2-41" class="d">-                dialogs.ConfirmDialog(title = &quot;Are you sure?&quot;, onConfirm = {
</a><a href="#h5-2-42" id="h5-2-42" class="d">-                    action()
</a><a href="#h5-2-43" id="h5-2-43" class="d">-                    confirmationDialog = false
</a><a href="#h5-2-44" id="h5-2-44" class="d">-                }, onDismiss = {
</a><a href="#h5-2-45" id="h5-2-45" class="d">-                    confirmationDialog = false
</a><a href="#h5-2-46" id="h5-2-46" class="d">-                })
</a><a href="#h5-2-47" id="h5-2-47" class="d">-            }
</a><a href="#h5-2-48" id="h5-2-48" class="d">-        }
</a><a href="#h5-2-49" id="h5-2-49" class="d">-
</a><a href="#h5-2-50" id="h5-2-50" class="d">-        Row(
</a><a href="#h5-2-51" id="h5-2-51" class="d">-            modifier = Modifier
</a><a href="#h5-2-52" id="h5-2-52" class="d">-                .fillMaxWidth()
</a><a href="#h5-2-53" id="h5-2-53" class="d">-                .height(65.dp)
</a><a href="#h5-2-54" id="h5-2-54" class="d">-                .clickable {
</a><a href="#h5-2-55" id="h5-2-55" class="d">-                    takeAction()
</a><a href="#h5-2-56" id="h5-2-56" class="d">-                },
</a><a href="#h5-2-57" id="h5-2-57" class="d">-            horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h5-2-58" id="h5-2-58" class="d">-            verticalAlignment = Alignment.CenterVertically
</a><a href="#h5-2-59" id="h5-2-59" class="d">-        ) {
</a><a href="#h5-2-60" id="h5-2-60" class="d">-            Text(text = title, modifier = Modifier.padding(start = 26.dp))
</a><a href="#h5-2-61" id="h5-2-61" class="d">-            IconButton(onClick = { takeAction() }) {
</a><a href="#h5-2-62" id="h5-2-62" class="d">-                Icon(
</a><a href="#h5-2-63" id="h5-2-63" class="d">-                    imageVector = Icons.Filled.OpenInNew,
</a><a href="#h5-2-64" id="h5-2-64" class="d">-                    contentDescription = null,
</a><a href="#h5-2-65" id="h5-2-65" class="d">-                    modifier = Modifier.size(24.dp)
</a><a href="#h5-2-66" id="h5-2-66" class="d">-                )
</a><a href="#h5-2-67" id="h5-2-67" class="d">-            }
</a><a href="#h5-2-68" id="h5-2-68" class="d">-        }
</a><a href="#h5-2-69" id="h5-2-69" class="d">-    }
</a><a href="#h5-2-70" id="h5-2-70" class="d">-
</a><a href="#h5-2-71" id="h5-2-71" class="d">-    @Composable
</a>     fun LogsSection() {
         val coroutineScope = rememberCoroutineScope()
         val clipboardManager = LocalClipboardManager.current
<a href="#h5-3" id="h5-3" class="h">@@ -236,43 +162,4 @@ class HomeSubSection(
</a>             }
         }
     }
<a href="#h5-3-3" id="h5-3-3" class="d">-
</a><a href="#h5-3-4" id="h5-3-4" class="d">-    private fun launchActionIntent(action: EnumAction) {
</a><a href="#h5-3-5" id="h5-3-5" class="d">-        val intent = context.androidContext.packageManager.getLaunchIntentForPackage(Constants.SNAPCHAT_PACKAGE_NAME)
</a><a href="#h5-3-6" id="h5-3-6" class="d">-        intent?.putExtra(ActionManager.ACTION_PARAMETER, action.key)
</a><a href="#h5-3-7" id="h5-3-7" class="d">-        context.androidContext.startActivity(intent)
</a><a href="#h5-3-8" id="h5-3-8" class="d">-    }
</a><a href="#h5-3-9" id="h5-3-9" class="d">-
</a><a href="#h5-3-10" id="h5-3-10" class="d">-    @Composable
</a><a href="#h5-3-11" id="h5-3-11" class="d">-    private fun RowTitle(title: String) {
</a><a href="#h5-3-12" id="h5-3-12" class="d">-        Text(text = title, modifier = Modifier.padding(16.dp), fontSize = 20.sp, fontWeight = FontWeight.Bold)
</a><a href="#h5-3-13" id="h5-3-13" class="d">-    }
</a><a href="#h5-3-14" id="h5-3-14" class="d">-
</a><a href="#h5-3-15" id="h5-3-15" class="d">-    @Composable
</a><a href="#h5-3-16" id="h5-3-16" class="d">-    fun DebugSection() {
</a><a href="#h5-3-17" id="h5-3-17" class="d">-        Column(
</a><a href="#h5-3-18" id="h5-3-18" class="d">-            modifier = Modifier
</a><a href="#h5-3-19" id="h5-3-19" class="d">-                .fillMaxSize()
</a><a href="#h5-3-20" id="h5-3-20" class="d">-                .verticalScroll(ScrollState(0))
</a><a href="#h5-3-21" id="h5-3-21" class="d">-        ) {
</a><a href="#h5-3-22" id="h5-3-22" class="d">-            RowTitle(title = &quot;Actions&quot;)
</a><a href="#h5-3-23" id="h5-3-23" class="d">-            EnumAction.values().forEach { enumAction -&gt;
</a><a href="#h5-3-24" id="h5-3-24" class="d">-                RowAction(title = context.translation[&quot;actions.${enumAction.key}&quot;]) {
</a><a href="#h5-3-25" id="h5-3-25" class="d">-                    launchActionIntent(enumAction)
</a><a href="#h5-3-26" id="h5-3-26" class="d">-                }
</a><a href="#h5-3-27" id="h5-3-27" class="d">-            }
</a><a href="#h5-3-28" id="h5-3-28" class="d">-
</a><a href="#h5-3-29" id="h5-3-29" class="d">-            RowTitle(title = &quot;Clear Files&quot;)
</a><a href="#h5-3-30" id="h5-3-30" class="d">-            BridgeFileType.values().forEach { fileType -&gt;
</a><a href="#h5-3-31" id="h5-3-31" class="d">-                RowAction(title = fileType.displayName, requireConfirmation = true) {
</a><a href="#h5-3-32" id="h5-3-32" class="d">-                    runCatching {
</a><a href="#h5-3-33" id="h5-3-33" class="d">-                        fileType.resolve(context.androidContext).delete()
</a><a href="#h5-3-34" id="h5-3-34" class="d">-                        context.longToast(&quot;Deleted ${fileType.displayName}!&quot;)
</a><a href="#h5-3-35" id="h5-3-35" class="d">-                    }.onFailure {
</a><a href="#h5-3-36" id="h5-3-36" class="d">-                        context.longToast(&quot;Failed to delete ${fileType.displayName}!&quot;)
</a><a href="#h5-3-37" id="h5-3-37" class="d">-                    }
</a><a href="#h5-3-38" id="h5-3-38" class="d">-                }
</a><a href="#h5-3-39" id="h5-3-39" class="d">-            }
</a><a href="#h5-3-40" id="h5-3-40" class="d">-        }
</a><a href="#h5-3-41" id="h5-3-41" class="d">-    }
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/SettingsSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/SettingsSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/SettingsSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/SettingsSection.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,117 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.sections.home
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+import androidx.compose.foundation.ScrollState
</a><a href="#h6-0-3" id="h6-0-3" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h6-0-4" id="h6-0-4" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h6-0-5" id="h6-0-5" class="i">+import androidx.compose.foundation.verticalScroll
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h6-0-7" id="h6-0-7" class="i">+import androidx.compose.material.icons.filled.OpenInNew
</a><a href="#h6-0-8" id="h6-0-8" class="i">+import androidx.compose.material3.Icon
</a><a href="#h6-0-9" id="h6-0-9" class="i">+import androidx.compose.material3.IconButton
</a><a href="#h6-0-10" id="h6-0-10" class="i">+import androidx.compose.material3.Text
</a><a href="#h6-0-11" id="h6-0-11" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h6-0-12" id="h6-0-12" class="i">+import androidx.compose.runtime.getValue
</a><a href="#h6-0-13" id="h6-0-13" class="i">+import androidx.compose.runtime.mutableStateOf
</a><a href="#h6-0-14" id="h6-0-14" class="i">+import androidx.compose.runtime.remember
</a><a href="#h6-0-15" id="h6-0-15" class="i">+import androidx.compose.runtime.setValue
</a><a href="#h6-0-16" id="h6-0-16" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h6-0-17" id="h6-0-17" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h6-0-18" id="h6-0-18" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h6-0-19" id="h6-0-19" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h6-0-20" id="h6-0-20" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h6-0-21" id="h6-0-21" class="i">+import androidx.compose.ui.window.Dialog
</a><a href="#h6-0-22" id="h6-0-22" class="i">+import me.rhunk.snapenhance.Constants
</a><a href="#h6-0-23" id="h6-0-23" class="i">+import me.rhunk.snapenhance.action.EnumAction
</a><a href="#h6-0-24" id="h6-0-24" class="i">+import me.rhunk.snapenhance.core.bridge.types.BridgeFileType
</a><a href="#h6-0-25" id="h6-0-25" class="i">+import me.rhunk.snapenhance.manager.impl.ActionManager
</a><a href="#h6-0-26" id="h6-0-26" class="i">+import me.rhunk.snapenhance.ui.manager.Section
</a><a href="#h6-0-27" id="h6-0-27" class="i">+import me.rhunk.snapenhance.ui.util.AlertDialogs
</a><a href="#h6-0-28" id="h6-0-28" class="i">+
</a><a href="#h6-0-29" id="h6-0-29" class="i">+class SettingsSection : Section() {
</a><a href="#h6-0-30" id="h6-0-30" class="i">+    private val dialogs by lazy { AlertDialogs(context.translation) }
</a><a href="#h6-0-31" id="h6-0-31" class="i">+
</a><a href="#h6-0-32" id="h6-0-32" class="i">+    @Composable
</a><a href="#h6-0-33" id="h6-0-33" class="i">+    private fun RowTitle(title: String) {
</a><a href="#h6-0-34" id="h6-0-34" class="i">+        Text(text = title, modifier = Modifier.padding(16.dp), fontSize = 20.sp, fontWeight = FontWeight.Bold)
</a><a href="#h6-0-35" id="h6-0-35" class="i">+    }
</a><a href="#h6-0-36" id="h6-0-36" class="i">+
</a><a href="#h6-0-37" id="h6-0-37" class="i">+    @Composable
</a><a href="#h6-0-38" id="h6-0-38" class="i">+    private fun RowAction(title: String, requireConfirmation: Boolean = false, action: () -&gt; Unit) {
</a><a href="#h6-0-39" id="h6-0-39" class="i">+        var confirmationDialog by remember {
</a><a href="#h6-0-40" id="h6-0-40" class="i">+            mutableStateOf(false)
</a><a href="#h6-0-41" id="h6-0-41" class="i">+        }
</a><a href="#h6-0-42" id="h6-0-42" class="i">+
</a><a href="#h6-0-43" id="h6-0-43" class="i">+        fun takeAction() {
</a><a href="#h6-0-44" id="h6-0-44" class="i">+            if (requireConfirmation) {
</a><a href="#h6-0-45" id="h6-0-45" class="i">+                confirmationDialog = true
</a><a href="#h6-0-46" id="h6-0-46" class="i">+            } else {
</a><a href="#h6-0-47" id="h6-0-47" class="i">+                action()
</a><a href="#h6-0-48" id="h6-0-48" class="i">+            }
</a><a href="#h6-0-49" id="h6-0-49" class="i">+        }
</a><a href="#h6-0-50" id="h6-0-50" class="i">+
</a><a href="#h6-0-51" id="h6-0-51" class="i">+        if (requireConfirmation &amp;&amp; confirmationDialog) {
</a><a href="#h6-0-52" id="h6-0-52" class="i">+            Dialog(onDismissRequest = { confirmationDialog = false }) {
</a><a href="#h6-0-53" id="h6-0-53" class="i">+                dialogs.ConfirmDialog(title = &quot;Are you sure?&quot;, onConfirm = {
</a><a href="#h6-0-54" id="h6-0-54" class="i">+                    action()
</a><a href="#h6-0-55" id="h6-0-55" class="i">+                    confirmationDialog = false
</a><a href="#h6-0-56" id="h6-0-56" class="i">+                }, onDismiss = {
</a><a href="#h6-0-57" id="h6-0-57" class="i">+                    confirmationDialog = false
</a><a href="#h6-0-58" id="h6-0-58" class="i">+                })
</a><a href="#h6-0-59" id="h6-0-59" class="i">+            }
</a><a href="#h6-0-60" id="h6-0-60" class="i">+        }
</a><a href="#h6-0-61" id="h6-0-61" class="i">+
</a><a href="#h6-0-62" id="h6-0-62" class="i">+        Row(
</a><a href="#h6-0-63" id="h6-0-63" class="i">+            modifier = Modifier
</a><a href="#h6-0-64" id="h6-0-64" class="i">+                .fillMaxWidth()
</a><a href="#h6-0-65" id="h6-0-65" class="i">+                .height(65.dp)
</a><a href="#h6-0-66" id="h6-0-66" class="i">+                .clickable {
</a><a href="#h6-0-67" id="h6-0-67" class="i">+                    takeAction()
</a><a href="#h6-0-68" id="h6-0-68" class="i">+                },
</a><a href="#h6-0-69" id="h6-0-69" class="i">+            horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h6-0-70" id="h6-0-70" class="i">+            verticalAlignment = Alignment.CenterVertically
</a><a href="#h6-0-71" id="h6-0-71" class="i">+        ) {
</a><a href="#h6-0-72" id="h6-0-72" class="i">+            Text(text = title, modifier = Modifier.padding(start = 26.dp))
</a><a href="#h6-0-73" id="h6-0-73" class="i">+            IconButton(onClick = { takeAction() }) {
</a><a href="#h6-0-74" id="h6-0-74" class="i">+                Icon(
</a><a href="#h6-0-75" id="h6-0-75" class="i">+                    imageVector = Icons.Filled.OpenInNew,
</a><a href="#h6-0-76" id="h6-0-76" class="i">+                    contentDescription = null,
</a><a href="#h6-0-77" id="h6-0-77" class="i">+                    modifier = Modifier.size(24.dp)
</a><a href="#h6-0-78" id="h6-0-78" class="i">+                )
</a><a href="#h6-0-79" id="h6-0-79" class="i">+            }
</a><a href="#h6-0-80" id="h6-0-80" class="i">+        }
</a><a href="#h6-0-81" id="h6-0-81" class="i">+    }
</a><a href="#h6-0-82" id="h6-0-82" class="i">+
</a><a href="#h6-0-83" id="h6-0-83" class="i">+    private fun launchActionIntent(action: EnumAction) {
</a><a href="#h6-0-84" id="h6-0-84" class="i">+        val intent = context.androidContext.packageManager.getLaunchIntentForPackage(Constants.SNAPCHAT_PACKAGE_NAME)
</a><a href="#h6-0-85" id="h6-0-85" class="i">+        intent?.putExtra(ActionManager.ACTION_PARAMETER, action.key)
</a><a href="#h6-0-86" id="h6-0-86" class="i">+        context.androidContext.startActivity(intent)
</a><a href="#h6-0-87" id="h6-0-87" class="i">+    }
</a><a href="#h6-0-88" id="h6-0-88" class="i">+
</a><a href="#h6-0-89" id="h6-0-89" class="i">+    @Composable
</a><a href="#h6-0-90" id="h6-0-90" class="i">+    override fun Content() {
</a><a href="#h6-0-91" id="h6-0-91" class="i">+        Column(
</a><a href="#h6-0-92" id="h6-0-92" class="i">+            modifier = Modifier
</a><a href="#h6-0-93" id="h6-0-93" class="i">+                .fillMaxSize()
</a><a href="#h6-0-94" id="h6-0-94" class="i">+                .verticalScroll(ScrollState(0))
</a><a href="#h6-0-95" id="h6-0-95" class="i">+        ) {
</a><a href="#h6-0-96" id="h6-0-96" class="i">+            RowTitle(title = &quot;Actions&quot;)
</a><a href="#h6-0-97" id="h6-0-97" class="i">+            EnumAction.values().forEach { enumAction -&gt;
</a><a href="#h6-0-98" id="h6-0-98" class="i">+                RowAction(title = context.translation[&quot;actions.${enumAction.key}&quot;]) {
</a><a href="#h6-0-99" id="h6-0-99" class="i">+                    launchActionIntent(enumAction)
</a><a href="#h6-0-100" id="h6-0-100" class="i">+                }
</a><a href="#h6-0-101" id="h6-0-101" class="i">+            }
</a><a href="#h6-0-102" id="h6-0-102" class="i">+
</a><a href="#h6-0-103" id="h6-0-103" class="i">+            RowTitle(title = &quot;Clear Files&quot;)
</a><a href="#h6-0-104" id="h6-0-104" class="i">+            BridgeFileType.values().forEach { fileType -&gt;
</a><a href="#h6-0-105" id="h6-0-105" class="i">+                RowAction(title = fileType.displayName, requireConfirmation = true) {
</a><a href="#h6-0-106" id="h6-0-106" class="i">+                    runCatching {
</a><a href="#h6-0-107" id="h6-0-107" class="i">+                        fileType.resolve(context.androidContext).delete()
</a><a href="#h6-0-108" id="h6-0-108" class="i">+                        context.longToast(&quot;Deleted ${fileType.displayName}!&quot;)
</a><a href="#h6-0-109" id="h6-0-109" class="i">+                    }.onFailure {
</a><a href="#h6-0-110" id="h6-0-110" class="i">+                        context.longToast(&quot;Failed to delete ${fileType.displayName}!&quot;)
</a><a href="#h6-0-111" id="h6-0-111" class="i">+                    }
</a><a href="#h6-0-112" id="h6-0-112" class="i">+                }
</a><a href="#h6-0-113" id="h6-0-113" class="i">+            }
</a><a href="#h6-0-114" id="h6-0-114" class="i">+        }
</a><a href="#h6-0-115" id="h6-0-115" class="i">+    }
</a><a href="#h6-0-116" id="h6-0-116" class="i">+}</a><a href="#h6-0-117" id="h6-0-117" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/ComposeOverlay.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/ComposeOverlay.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/ComposeOverlay.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/ComposeOverlay.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,71 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+package me.rhunk.snapenhance.ui.overlay
</a><a href="#h7-0-1" id="h7-0-1" class="i">+
</a><a href="#h7-0-2" id="h7-0-2" class="i">+import android.content.Context
</a><a href="#h7-0-3" id="h7-0-3" class="i">+import android.os.Bundle
</a><a href="#h7-0-4" id="h7-0-4" class="i">+import androidx.activity.OnBackPressedDispatcher
</a><a href="#h7-0-5" id="h7-0-5" class="i">+import androidx.activity.OnBackPressedDispatcherOwner
</a><a href="#h7-0-6" id="h7-0-6" class="i">+import androidx.activity.setViewTreeOnBackPressedDispatcherOwner
</a><a href="#h7-0-7" id="h7-0-7" class="i">+import androidx.compose.runtime.Recomposer
</a><a href="#h7-0-8" id="h7-0-8" class="i">+import androidx.compose.ui.platform.AndroidUiDispatcher
</a><a href="#h7-0-9" id="h7-0-9" class="i">+import androidx.compose.ui.platform.ComposeView
</a><a href="#h7-0-10" id="h7-0-10" class="i">+import androidx.compose.ui.platform.ViewCompositionStrategy
</a><a href="#h7-0-11" id="h7-0-11" class="i">+import androidx.compose.ui.platform.compositionContext
</a><a href="#h7-0-12" id="h7-0-12" class="i">+import androidx.lifecycle.*
</a><a href="#h7-0-13" id="h7-0-13" class="i">+import androidx.savedstate.SavedStateRegistry
</a><a href="#h7-0-14" id="h7-0-14" class="i">+import androidx.savedstate.SavedStateRegistryController
</a><a href="#h7-0-15" id="h7-0-15" class="i">+import androidx.savedstate.SavedStateRegistryOwner
</a><a href="#h7-0-16" id="h7-0-16" class="i">+import androidx.savedstate.setViewTreeSavedStateRegistryOwner
</a><a href="#h7-0-17" id="h7-0-17" class="i">+import kotlinx.coroutines.CoroutineScope
</a><a href="#h7-0-18" id="h7-0-18" class="i">+import kotlinx.coroutines.launch
</a><a href="#h7-0-19" id="h7-0-19" class="i">+
</a><a href="#h7-0-20" id="h7-0-20" class="i">+// https://github.com/tberghuis/FloatingCountdownTimer/blob/master/app/src/main/java/xyz/tberghuis/floatingtimer/service/overlayViewFactory.kt
</a><a href="#h7-0-21" id="h7-0-21" class="i">+fun overlayComposeView(service: Context) = ComposeView(service).apply {
</a><a href="#h7-0-22" id="h7-0-22" class="i">+    setViewCompositionStrategy(ViewCompositionStrategy.DisposeOnViewTreeLifecycleDestroyed)
</a><a href="#h7-0-23" id="h7-0-23" class="i">+    val lifecycleOwner = OverlayLifecycleOwner().apply {
</a><a href="#h7-0-24" id="h7-0-24" class="i">+        performRestore(null)
</a><a href="#h7-0-25" id="h7-0-25" class="i">+        handleLifecycleEvent(Lifecycle.Event.ON_CREATE)
</a><a href="#h7-0-26" id="h7-0-26" class="i">+    }
</a><a href="#h7-0-27" id="h7-0-27" class="i">+    setViewTreeLifecycleOwner(lifecycleOwner)
</a><a href="#h7-0-28" id="h7-0-28" class="i">+    setViewTreeSavedStateRegistryOwner(lifecycleOwner)
</a><a href="#h7-0-29" id="h7-0-29" class="i">+
</a><a href="#h7-0-30" id="h7-0-30" class="i">+    val viewModelStore = ViewModelStore()
</a><a href="#h7-0-31" id="h7-0-31" class="i">+    setViewTreeViewModelStoreOwner(object : ViewModelStoreOwner {
</a><a href="#h7-0-32" id="h7-0-32" class="i">+        override val viewModelStore: ViewModelStore
</a><a href="#h7-0-33" id="h7-0-33" class="i">+            get() = viewModelStore
</a><a href="#h7-0-34" id="h7-0-34" class="i">+    })
</a><a href="#h7-0-35" id="h7-0-35" class="i">+
</a><a href="#h7-0-36" id="h7-0-36" class="i">+    val backPressedDispatcherOwner = OnBackPressedDispatcher()
</a><a href="#h7-0-37" id="h7-0-37" class="i">+    setViewTreeOnBackPressedDispatcherOwner(object: OnBackPressedDispatcherOwner {
</a><a href="#h7-0-38" id="h7-0-38" class="i">+        override val lifecycle: Lifecycle
</a><a href="#h7-0-39" id="h7-0-39" class="i">+            get() = lifecycleOwner.lifecycle
</a><a href="#h7-0-40" id="h7-0-40" class="i">+        override val onBackPressedDispatcher: OnBackPressedDispatcher
</a><a href="#h7-0-41" id="h7-0-41" class="i">+            get() = backPressedDispatcherOwner
</a><a href="#h7-0-42" id="h7-0-42" class="i">+    })
</a><a href="#h7-0-43" id="h7-0-43" class="i">+
</a><a href="#h7-0-44" id="h7-0-44" class="i">+    val coroutineContext = AndroidUiDispatcher.CurrentThread
</a><a href="#h7-0-45" id="h7-0-45" class="i">+    val runRecomposeScope = CoroutineScope(coroutineContext)
</a><a href="#h7-0-46" id="h7-0-46" class="i">+    val recomposer = Recomposer(coroutineContext)
</a><a href="#h7-0-47" id="h7-0-47" class="i">+    compositionContext = recomposer
</a><a href="#h7-0-48" id="h7-0-48" class="i">+    runRecomposeScope.launch {
</a><a href="#h7-0-49" id="h7-0-49" class="i">+        recomposer.runRecomposeAndApplyChanges()
</a><a href="#h7-0-50" id="h7-0-50" class="i">+    }
</a><a href="#h7-0-51" id="h7-0-51" class="i">+}
</a><a href="#h7-0-52" id="h7-0-52" class="i">+
</a><a href="#h7-0-53" id="h7-0-53" class="i">+private class OverlayLifecycleOwner : SavedStateRegistryOwner {
</a><a href="#h7-0-54" id="h7-0-54" class="i">+    private var mLifecycleRegistry: LifecycleRegistry = LifecycleRegistry(this)
</a><a href="#h7-0-55" id="h7-0-55" class="i">+    private var mSavedStateRegistryController: SavedStateRegistryController =
</a><a href="#h7-0-56" id="h7-0-56" class="i">+        SavedStateRegistryController.create(this)
</a><a href="#h7-0-57" id="h7-0-57" class="i">+    override val lifecycle: Lifecycle
</a><a href="#h7-0-58" id="h7-0-58" class="i">+        get() = mLifecycleRegistry
</a><a href="#h7-0-59" id="h7-0-59" class="i">+    override val savedStateRegistry: SavedStateRegistry
</a><a href="#h7-0-60" id="h7-0-60" class="i">+        get() = mSavedStateRegistryController.savedStateRegistry
</a><a href="#h7-0-61" id="h7-0-61" class="i">+    fun handleLifecycleEvent(event: Lifecycle.Event) {
</a><a href="#h7-0-62" id="h7-0-62" class="i">+        mLifecycleRegistry.handleLifecycleEvent(event)
</a><a href="#h7-0-63" id="h7-0-63" class="i">+    }
</a><a href="#h7-0-64" id="h7-0-64" class="i">+    fun performRestore(savedState: Bundle?) {
</a><a href="#h7-0-65" id="h7-0-65" class="i">+        mSavedStateRegistryController.performRestore(savedState)
</a><a href="#h7-0-66" id="h7-0-66" class="i">+    }
</a><a href="#h7-0-67" id="h7-0-67" class="i">+    fun performSave(outBundle: Bundle) {
</a><a href="#h7-0-68" id="h7-0-68" class="i">+        mSavedStateRegistryController.performSave(outBundle)
</a><a href="#h7-0-69" id="h7-0-69" class="i">+    }
</a><a href="#h7-0-70" id="h7-0-70" class="i">+}</a><a href="#h7-0-71" id="h7-0-71" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/SettingsOverlay.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/SettingsOverlay.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/SettingsOverlay.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/overlay/SettingsOverlay.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,133 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+package me.rhunk.snapenhance.ui.overlay
</a><a href="#h8-0-1" id="h8-0-1" class="i">+
</a><a href="#h8-0-2" id="h8-0-2" class="i">+import android.app.Dialog
</a><a href="#h8-0-3" id="h8-0-3" class="i">+import android.content.Intent
</a><a href="#h8-0-4" id="h8-0-4" class="i">+import android.graphics.Color
</a><a href="#h8-0-5" id="h8-0-5" class="i">+import android.graphics.drawable.ColorDrawable
</a><a href="#h8-0-6" id="h8-0-6" class="i">+import android.net.Uri
</a><a href="#h8-0-7" id="h8-0-7" class="i">+import android.provider.Settings
</a><a href="#h8-0-8" id="h8-0-8" class="i">+import android.view.WindowManager
</a><a href="#h8-0-9" id="h8-0-9" class="i">+import androidx.compose.foundation.layout.Arrangement
</a><a href="#h8-0-10" id="h8-0-10" class="i">+import androidx.compose.foundation.layout.Column
</a><a href="#h8-0-11" id="h8-0-11" class="i">+import androidx.compose.foundation.layout.fillMaxSize
</a><a href="#h8-0-12" id="h8-0-12" class="i">+import androidx.compose.foundation.layout.padding
</a><a href="#h8-0-13" id="h8-0-13" class="i">+import androidx.compose.material3.MaterialTheme
</a><a href="#h8-0-14" id="h8-0-14" class="i">+import androidx.compose.material3.Scaffold
</a><a href="#h8-0-15" id="h8-0-15" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h8-0-16" id="h8-0-16" class="i">+import androidx.compose.runtime.remember
</a><a href="#h8-0-17" id="h8-0-17" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h8-0-18" id="h8-0-18" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h8-0-19" id="h8-0-19" class="i">+import androidx.compose.ui.draw.clip
</a><a href="#h8-0-20" id="h8-0-20" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h8-0-21" id="h8-0-21" class="i">+import androidx.navigation.compose.rememberNavController
</a><a href="#h8-0-22" id="h8-0-22" class="i">+import com.arthenica.ffmpegkit.Packages.getPackageName
</a><a href="#h8-0-23" id="h8-0-23" class="i">+import me.rhunk.snapenhance.R
</a><a href="#h8-0-24" id="h8-0-24" class="i">+import me.rhunk.snapenhance.RemoteSideContext
</a><a href="#h8-0-25" id="h8-0-25" class="i">+import me.rhunk.snapenhance.ui.AppMaterialTheme
</a><a href="#h8-0-26" id="h8-0-26" class="i">+import me.rhunk.snapenhance.ui.manager.EnumSection
</a><a href="#h8-0-27" id="h8-0-27" class="i">+import me.rhunk.snapenhance.ui.manager.Navigation
</a><a href="#h8-0-28" id="h8-0-28" class="i">+import me.rhunk.snapenhance.ui.manager.sections.features.FeaturesSection
</a><a href="#h8-0-29" id="h8-0-29" class="i">+
</a><a href="#h8-0-30" id="h8-0-30" class="i">+
</a><a href="#h8-0-31" id="h8-0-31" class="i">+class SettingsOverlay(
</a><a href="#h8-0-32" id="h8-0-32" class="i">+    private val context: RemoteSideContext
</a><a href="#h8-0-33" id="h8-0-33" class="i">+) {
</a><a href="#h8-0-34" id="h8-0-34" class="i">+    private lateinit var dialog: Dialog
</a><a href="#h8-0-35" id="h8-0-35" class="i">+    private fun checkForPermissions(): Boolean {
</a><a href="#h8-0-36" id="h8-0-36" class="i">+        if (!Settings.canDrawOverlays(context.androidContext)) {
</a><a href="#h8-0-37" id="h8-0-37" class="i">+            val myIntent = Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION)
</a><a href="#h8-0-38" id="h8-0-38" class="i">+            myIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
</a><a href="#h8-0-39" id="h8-0-39" class="i">+            myIntent.setData(Uri.parse(&quot;package:&quot; + getPackageName()))
</a><a href="#h8-0-40" id="h8-0-40" class="i">+            context.androidContext.startActivity(myIntent)
</a><a href="#h8-0-41" id="h8-0-41" class="i">+            return false
</a><a href="#h8-0-42" id="h8-0-42" class="i">+        }
</a><a href="#h8-0-43" id="h8-0-43" class="i">+        return true
</a><a href="#h8-0-44" id="h8-0-44" class="i">+    }
</a><a href="#h8-0-45" id="h8-0-45" class="i">+
</a><a href="#h8-0-46" id="h8-0-46" class="i">+    @Composable
</a><a href="#h8-0-47" id="h8-0-47" class="i">+    private fun OverlayContent() {
</a><a href="#h8-0-48" id="h8-0-48" class="i">+        val navHostController = rememberNavController()
</a><a href="#h8-0-49" id="h8-0-49" class="i">+
</a><a href="#h8-0-50" id="h8-0-50" class="i">+        /*navHostController.addOnDestinationChangedListener { _, destination, _ -&gt;
</a><a href="#h8-0-51" id="h8-0-51" class="i">+            dialog.setCancelable(destination.route == FeaturesSection.MAIN_ROUTE)
</a><a href="#h8-0-52" id="h8-0-52" class="i">+        }*/
</a><a href="#h8-0-53" id="h8-0-53" class="i">+
</a><a href="#h8-0-54" id="h8-0-54" class="i">+        val navigation = remember {
</a><a href="#h8-0-55" id="h8-0-55" class="i">+            Navigation(
</a><a href="#h8-0-56" id="h8-0-56" class="i">+                context,
</a><a href="#h8-0-57" id="h8-0-57" class="i">+                mapOf(
</a><a href="#h8-0-58" id="h8-0-58" class="i">+                    EnumSection.FEATURES to FeaturesSection().apply {
</a><a href="#h8-0-59" id="h8-0-59" class="i">+                        enumSection = EnumSection.FEATURES
</a><a href="#h8-0-60" id="h8-0-60" class="i">+                        context = this@SettingsOverlay.context
</a><a href="#h8-0-61" id="h8-0-61" class="i">+                    }
</a><a href="#h8-0-62" id="h8-0-62" class="i">+                ),
</a><a href="#h8-0-63" id="h8-0-63" class="i">+                navHostController
</a><a href="#h8-0-64" id="h8-0-64" class="i">+            )
</a><a href="#h8-0-65" id="h8-0-65" class="i">+        }
</a><a href="#h8-0-66" id="h8-0-66" class="i">+
</a><a href="#h8-0-67" id="h8-0-67" class="i">+        Scaffold(
</a><a href="#h8-0-68" id="h8-0-68" class="i">+            containerColor = MaterialTheme.colorScheme.background,
</a><a href="#h8-0-69" id="h8-0-69" class="i">+            topBar = { navigation.TopBar() }
</a><a href="#h8-0-70" id="h8-0-70" class="i">+        ) { innerPadding -&gt;
</a><a href="#h8-0-71" id="h8-0-71" class="i">+            navigation.NavigationHost(
</a><a href="#h8-0-72" id="h8-0-72" class="i">+                startDestination = EnumSection.FEATURES,
</a><a href="#h8-0-73" id="h8-0-73" class="i">+                innerPadding = innerPadding
</a><a href="#h8-0-74" id="h8-0-74" class="i">+            )
</a><a href="#h8-0-75" id="h8-0-75" class="i">+        }
</a><a href="#h8-0-76" id="h8-0-76" class="i">+    }
</a><a href="#h8-0-77" id="h8-0-77" class="i">+
</a><a href="#h8-0-78" id="h8-0-78" class="i">+    fun close() {
</a><a href="#h8-0-79" id="h8-0-79" class="i">+        if (!::dialog.isInitialized || !dialog.isShowing) return
</a><a href="#h8-0-80" id="h8-0-80" class="i">+        context.config.writeConfig()
</a><a href="#h8-0-81" id="h8-0-81" class="i">+        dialog.dismiss()
</a><a href="#h8-0-82" id="h8-0-82" class="i">+    }
</a><a href="#h8-0-83" id="h8-0-83" class="i">+
</a><a href="#h8-0-84" id="h8-0-84" class="i">+    fun show() {
</a><a href="#h8-0-85" id="h8-0-85" class="i">+        if (!checkForPermissions()) {
</a><a href="#h8-0-86" id="h8-0-86" class="i">+            return
</a><a href="#h8-0-87" id="h8-0-87" class="i">+        }
</a><a href="#h8-0-88" id="h8-0-88" class="i">+
</a><a href="#h8-0-89" id="h8-0-89" class="i">+        if (::dialog.isInitialized &amp;&amp; dialog.isShowing) {
</a><a href="#h8-0-90" id="h8-0-90" class="i">+            return
</a><a href="#h8-0-91" id="h8-0-91" class="i">+        }
</a><a href="#h8-0-92" id="h8-0-92" class="i">+
</a><a href="#h8-0-93" id="h8-0-93" class="i">+        context.androidContext.mainExecutor.execute {
</a><a href="#h8-0-94" id="h8-0-94" class="i">+            dialog = Dialog(context.androidContext, R.style.FullscreenOverlayDialog)
</a><a href="#h8-0-95" id="h8-0-95" class="i">+            dialog.window?.apply {
</a><a href="#h8-0-96" id="h8-0-96" class="i">+                setBackgroundDrawable(ColorDrawable(Color.TRANSPARENT))
</a><a href="#h8-0-97" id="h8-0-97" class="i">+                setLayout(
</a><a href="#h8-0-98" id="h8-0-98" class="i">+                    WindowManager.LayoutParams.MATCH_PARENT,
</a><a href="#h8-0-99" id="h8-0-99" class="i">+                    WindowManager.LayoutParams.MATCH_PARENT,
</a><a href="#h8-0-100" id="h8-0-100" class="i">+                )
</a><a href="#h8-0-101" id="h8-0-101" class="i">+                clearFlags(WindowManager.LayoutParams.FLAG_DIM_BEHIND)
</a><a href="#h8-0-102" id="h8-0-102" class="i">+                setType(WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY)
</a><a href="#h8-0-103" id="h8-0-103" class="i">+            }
</a><a href="#h8-0-104" id="h8-0-104" class="i">+
</a><a href="#h8-0-105" id="h8-0-105" class="i">+            dialog.setContentView(
</a><a href="#h8-0-106" id="h8-0-106" class="i">+                overlayComposeView(context.androidContext).apply {
</a><a href="#h8-0-107" id="h8-0-107" class="i">+                    setContent {
</a><a href="#h8-0-108" id="h8-0-108" class="i">+                        Column(
</a><a href="#h8-0-109" id="h8-0-109" class="i">+                            modifier = Modifier
</a><a href="#h8-0-110" id="h8-0-110" class="i">+                                .fillMaxSize()
</a><a href="#h8-0-111" id="h8-0-111" class="i">+                                .padding(10.dp)
</a><a href="#h8-0-112" id="h8-0-112" class="i">+                                .clip(shape = MaterialTheme.shapes.large),
</a><a href="#h8-0-113" id="h8-0-113" class="i">+                            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h8-0-114" id="h8-0-114" class="i">+                            verticalArrangement = Arrangement.Center
</a><a href="#h8-0-115" id="h8-0-115" class="i">+                        ) {
</a><a href="#h8-0-116" id="h8-0-116" class="i">+                            AppMaterialTheme {
</a><a href="#h8-0-117" id="h8-0-117" class="i">+                                OverlayContent()
</a><a href="#h8-0-118" id="h8-0-118" class="i">+                            }
</a><a href="#h8-0-119" id="h8-0-119" class="i">+                        }
</a><a href="#h8-0-120" id="h8-0-120" class="i">+                    }
</a><a href="#h8-0-121" id="h8-0-121" class="i">+                }
</a><a href="#h8-0-122" id="h8-0-122" class="i">+            )
</a><a href="#h8-0-123" id="h8-0-123" class="i">+
</a><a href="#h8-0-124" id="h8-0-124" class="i">+            dialog.setCancelable(true)
</a><a href="#h8-0-125" id="h8-0-125" class="i">+            dialog.setOnDismissListener {
</a><a href="#h8-0-126" id="h8-0-126" class="i">+                close()
</a><a href="#h8-0-127" id="h8-0-127" class="i">+            }
</a><a href="#h8-0-128" id="h8-0-128" class="i">+
</a><a href="#h8-0-129" id="h8-0-129" class="i">+            dialog.show()
</a><a href="#h8-0-130" id="h8-0-130" class="i">+        }
</a><a href="#h8-0-131" id="h8-0-131" class="i">+    }
</a><a href="#h8-0-132" id="h8-0-132" class="i">+}</a><a href="#h8-0-133" id="h8-0-133" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AndroidDialogCustom.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AndroidDialogCustom.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AndroidDialogCustom.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/AndroidDialogCustom.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,360 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+package me.rhunk.snapenhance.ui.util
</a><a href="#h9-0-1" id="h9-0-1" class="i">+
</a><a href="#h9-0-2" id="h9-0-2" class="i">+
</a><a href="#h9-0-3" id="h9-0-3" class="i">+import android.content.Context
</a><a href="#h9-0-4" id="h9-0-4" class="i">+import android.graphics.Outline
</a><a href="#h9-0-5" id="h9-0-5" class="i">+import android.os.Build
</a><a href="#h9-0-6" id="h9-0-6" class="i">+import android.view.*
</a><a href="#h9-0-7" id="h9-0-7" class="i">+import androidx.activity.ComponentDialog
</a><a href="#h9-0-8" id="h9-0-8" class="i">+import androidx.activity.addCallback
</a><a href="#h9-0-9" id="h9-0-9" class="i">+import androidx.compose.runtime.*
</a><a href="#h9-0-10" id="h9-0-10" class="i">+import androidx.compose.runtime.saveable.rememberSaveable
</a><a href="#h9-0-11" id="h9-0-11" class="i">+import androidx.compose.ui.ExperimentalComposeUiApi
</a><a href="#h9-0-12" id="h9-0-12" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h9-0-13" id="h9-0-13" class="i">+import androidx.compose.ui.R
</a><a href="#h9-0-14" id="h9-0-14" class="i">+import androidx.compose.ui.layout.Layout
</a><a href="#h9-0-15" id="h9-0-15" class="i">+import androidx.compose.ui.platform.AbstractComposeView
</a><a href="#h9-0-16" id="h9-0-16" class="i">+import androidx.compose.ui.platform.LocalDensity
</a><a href="#h9-0-17" id="h9-0-17" class="i">+import androidx.compose.ui.platform.LocalLayoutDirection
</a><a href="#h9-0-18" id="h9-0-18" class="i">+import androidx.compose.ui.platform.LocalView
</a><a href="#h9-0-19" id="h9-0-19" class="i">+import androidx.compose.ui.platform.ViewRootForInspector
</a><a href="#h9-0-20" id="h9-0-20" class="i">+import androidx.compose.ui.semantics.dialog
</a><a href="#h9-0-21" id="h9-0-21" class="i">+import androidx.compose.ui.semantics.semantics
</a><a href="#h9-0-22" id="h9-0-22" class="i">+import androidx.compose.ui.unit.Density
</a><a href="#h9-0-23" id="h9-0-23" class="i">+import androidx.compose.ui.unit.LayoutDirection
</a><a href="#h9-0-24" id="h9-0-24" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h9-0-25" id="h9-0-25" class="i">+import androidx.compose.ui.window.SecureFlagPolicy
</a><a href="#h9-0-26" id="h9-0-26" class="i">+import androidx.core.view.WindowCompat
</a><a href="#h9-0-27" id="h9-0-27" class="i">+import androidx.lifecycle.findViewTreeLifecycleOwner
</a><a href="#h9-0-28" id="h9-0-28" class="i">+import androidx.lifecycle.findViewTreeViewModelStoreOwner
</a><a href="#h9-0-29" id="h9-0-29" class="i">+import androidx.lifecycle.setViewTreeLifecycleOwner
</a><a href="#h9-0-30" id="h9-0-30" class="i">+import androidx.lifecycle.setViewTreeViewModelStoreOwner
</a><a href="#h9-0-31" id="h9-0-31" class="i">+import androidx.savedstate.findViewTreeSavedStateRegistryOwner
</a><a href="#h9-0-32" id="h9-0-32" class="i">+import androidx.savedstate.setViewTreeSavedStateRegistryOwner
</a><a href="#h9-0-33" id="h9-0-33" class="i">+import java.util.UUID
</a><a href="#h9-0-34" id="h9-0-34" class="i">+import kotlin.math.roundToInt
</a><a href="#h9-0-35" id="h9-0-35" class="i">+
</a><a href="#h9-0-36" id="h9-0-36" class="i">+class DialogProperties constructor(
</a><a href="#h9-0-37" id="h9-0-37" class="i">+    val dismissOnBackPress: Boolean = true,
</a><a href="#h9-0-38" id="h9-0-38" class="i">+    val dismissOnClickOutside: Boolean = true,
</a><a href="#h9-0-39" id="h9-0-39" class="i">+    val securePolicy: SecureFlagPolicy = SecureFlagPolicy.Inherit,
</a><a href="#h9-0-40" id="h9-0-40" class="i">+    val usePlatformDefaultWidth: Boolean = true,
</a><a href="#h9-0-41" id="h9-0-41" class="i">+    val decorFitsSystemWindows: Boolean = true
</a><a href="#h9-0-42" id="h9-0-42" class="i">+) {
</a><a href="#h9-0-43" id="h9-0-43" class="i">+
</a><a href="#h9-0-44" id="h9-0-44" class="i">+    constructor(
</a><a href="#h9-0-45" id="h9-0-45" class="i">+        dismissOnBackPress: Boolean = true,
</a><a href="#h9-0-46" id="h9-0-46" class="i">+        dismissOnClickOutside: Boolean = true,
</a><a href="#h9-0-47" id="h9-0-47" class="i">+        securePolicy: SecureFlagPolicy = SecureFlagPolicy.Inherit,
</a><a href="#h9-0-48" id="h9-0-48" class="i">+    ) : this(
</a><a href="#h9-0-49" id="h9-0-49" class="i">+        dismissOnBackPress = dismissOnBackPress,
</a><a href="#h9-0-50" id="h9-0-50" class="i">+        dismissOnClickOutside = dismissOnClickOutside,
</a><a href="#h9-0-51" id="h9-0-51" class="i">+        securePolicy = securePolicy,
</a><a href="#h9-0-52" id="h9-0-52" class="i">+        usePlatformDefaultWidth = true,
</a><a href="#h9-0-53" id="h9-0-53" class="i">+        decorFitsSystemWindows = true
</a><a href="#h9-0-54" id="h9-0-54" class="i">+    )
</a><a href="#h9-0-55" id="h9-0-55" class="i">+
</a><a href="#h9-0-56" id="h9-0-56" class="i">+    override fun equals(other: Any?): Boolean {
</a><a href="#h9-0-57" id="h9-0-57" class="i">+        if (this === other) return true
</a><a href="#h9-0-58" id="h9-0-58" class="i">+        if (other !is DialogProperties) return false
</a><a href="#h9-0-59" id="h9-0-59" class="i">+
</a><a href="#h9-0-60" id="h9-0-60" class="i">+        if (dismissOnBackPress != other.dismissOnBackPress) return false
</a><a href="#h9-0-61" id="h9-0-61" class="i">+        if (dismissOnClickOutside != other.dismissOnClickOutside) return false
</a><a href="#h9-0-62" id="h9-0-62" class="i">+        if (securePolicy != other.securePolicy) return false
</a><a href="#h9-0-63" id="h9-0-63" class="i">+        if (usePlatformDefaultWidth != other.usePlatformDefaultWidth) return false
</a><a href="#h9-0-64" id="h9-0-64" class="i">+        if (decorFitsSystemWindows != other.decorFitsSystemWindows) return false
</a><a href="#h9-0-65" id="h9-0-65" class="i">+
</a><a href="#h9-0-66" id="h9-0-66" class="i">+        return true
</a><a href="#h9-0-67" id="h9-0-67" class="i">+    }
</a><a href="#h9-0-68" id="h9-0-68" class="i">+
</a><a href="#h9-0-69" id="h9-0-69" class="i">+    override fun hashCode(): Int {
</a><a href="#h9-0-70" id="h9-0-70" class="i">+        var result = dismissOnBackPress.hashCode()
</a><a href="#h9-0-71" id="h9-0-71" class="i">+        result = 31 * result + dismissOnClickOutside.hashCode()
</a><a href="#h9-0-72" id="h9-0-72" class="i">+        result = 31 * result + securePolicy.hashCode()
</a><a href="#h9-0-73" id="h9-0-73" class="i">+        result = 31 * result + usePlatformDefaultWidth.hashCode()
</a><a href="#h9-0-74" id="h9-0-74" class="i">+        result = 31 * result + decorFitsSystemWindows.hashCode()
</a><a href="#h9-0-75" id="h9-0-75" class="i">+        return result
</a><a href="#h9-0-76" id="h9-0-76" class="i">+    }
</a><a href="#h9-0-77" id="h9-0-77" class="i">+}
</a><a href="#h9-0-78" id="h9-0-78" class="i">+
</a><a href="#h9-0-79" id="h9-0-79" class="i">+@Composable
</a><a href="#h9-0-80" id="h9-0-80" class="i">+fun Dialog(
</a><a href="#h9-0-81" id="h9-0-81" class="i">+    onDismissRequest: () -&gt; Unit,
</a><a href="#h9-0-82" id="h9-0-82" class="i">+    properties: DialogProperties = DialogProperties(),
</a><a href="#h9-0-83" id="h9-0-83" class="i">+    content: @Composable () -&gt; Unit
</a><a href="#h9-0-84" id="h9-0-84" class="i">+) {
</a><a href="#h9-0-85" id="h9-0-85" class="i">+    val view = LocalView.current
</a><a href="#h9-0-86" id="h9-0-86" class="i">+    val density = LocalDensity.current
</a><a href="#h9-0-87" id="h9-0-87" class="i">+    val layoutDirection = LocalLayoutDirection.current
</a><a href="#h9-0-88" id="h9-0-88" class="i">+    val composition = rememberCompositionContext()
</a><a href="#h9-0-89" id="h9-0-89" class="i">+    val currentContent by rememberUpdatedState(content)
</a><a href="#h9-0-90" id="h9-0-90" class="i">+    val dialogId = rememberSaveable { UUID.randomUUID() }
</a><a href="#h9-0-91" id="h9-0-91" class="i">+    val dialog = remember(view, density) {
</a><a href="#h9-0-92" id="h9-0-92" class="i">+        DialogWrapper(
</a><a href="#h9-0-93" id="h9-0-93" class="i">+            onDismissRequest,
</a><a href="#h9-0-94" id="h9-0-94" class="i">+            properties,
</a><a href="#h9-0-95" id="h9-0-95" class="i">+            view,
</a><a href="#h9-0-96" id="h9-0-96" class="i">+            layoutDirection,
</a><a href="#h9-0-97" id="h9-0-97" class="i">+            density,
</a><a href="#h9-0-98" id="h9-0-98" class="i">+            dialogId
</a><a href="#h9-0-99" id="h9-0-99" class="i">+        ).apply {
</a><a href="#h9-0-100" id="h9-0-100" class="i">+            setContent(composition) {
</a><a href="#h9-0-101" id="h9-0-101" class="i">+                // TODO(b/159900354): draw a scrim and add margins around the Compose Dialog, and
</a><a href="#h9-0-102" id="h9-0-102" class="i">+                //  consume clicks so they can&#39;t pass through to the underlying UI
</a><a href="#h9-0-103" id="h9-0-103" class="i">+                DialogLayout(
</a><a href="#h9-0-104" id="h9-0-104" class="i">+                    Modifier.semantics { dialog() },
</a><a href="#h9-0-105" id="h9-0-105" class="i">+                ) {
</a><a href="#h9-0-106" id="h9-0-106" class="i">+                    currentContent()
</a><a href="#h9-0-107" id="h9-0-107" class="i">+                }
</a><a href="#h9-0-108" id="h9-0-108" class="i">+            }
</a><a href="#h9-0-109" id="h9-0-109" class="i">+        }
</a><a href="#h9-0-110" id="h9-0-110" class="i">+    }
</a><a href="#h9-0-111" id="h9-0-111" class="i">+
</a><a href="#h9-0-112" id="h9-0-112" class="i">+    DisposableEffect(dialog) {
</a><a href="#h9-0-113" id="h9-0-113" class="i">+        // Set the dialog&#39;s window type to TYPE_APPLICATION_OVERLAY so it&#39;s compatible with compose overlays
</a><a href="#h9-0-114" id="h9-0-114" class="i">+        dialog.window?.setType(WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY)
</a><a href="#h9-0-115" id="h9-0-115" class="i">+        dialog.show()
</a><a href="#h9-0-116" id="h9-0-116" class="i">+
</a><a href="#h9-0-117" id="h9-0-117" class="i">+        onDispose {
</a><a href="#h9-0-118" id="h9-0-118" class="i">+            dialog.dismiss()
</a><a href="#h9-0-119" id="h9-0-119" class="i">+            dialog.disposeComposition()
</a><a href="#h9-0-120" id="h9-0-120" class="i">+        }
</a><a href="#h9-0-121" id="h9-0-121" class="i">+    }
</a><a href="#h9-0-122" id="h9-0-122" class="i">+
</a><a href="#h9-0-123" id="h9-0-123" class="i">+    SideEffect {
</a><a href="#h9-0-124" id="h9-0-124" class="i">+        dialog.updateParameters(
</a><a href="#h9-0-125" id="h9-0-125" class="i">+            onDismissRequest = onDismissRequest,
</a><a href="#h9-0-126" id="h9-0-126" class="i">+            properties = properties,
</a><a href="#h9-0-127" id="h9-0-127" class="i">+            layoutDirection = layoutDirection
</a><a href="#h9-0-128" id="h9-0-128" class="i">+        )
</a><a href="#h9-0-129" id="h9-0-129" class="i">+    }
</a><a href="#h9-0-130" id="h9-0-130" class="i">+}
</a><a href="#h9-0-131" id="h9-0-131" class="i">+
</a><a href="#h9-0-132" id="h9-0-132" class="i">+interface DialogWindowProvider {
</a><a href="#h9-0-133" id="h9-0-133" class="i">+    val window: Window
</a><a href="#h9-0-134" id="h9-0-134" class="i">+}
</a><a href="#h9-0-135" id="h9-0-135" class="i">+
</a><a href="#h9-0-136" id="h9-0-136" class="i">+@Suppress(&quot;ViewConstructor&quot;)
</a><a href="#h9-0-137" id="h9-0-137" class="i">+private class DialogLayout(
</a><a href="#h9-0-138" id="h9-0-138" class="i">+    context: Context,
</a><a href="#h9-0-139" id="h9-0-139" class="i">+    override val window: Window
</a><a href="#h9-0-140" id="h9-0-140" class="i">+) : AbstractComposeView(context), DialogWindowProvider {
</a><a href="#h9-0-141" id="h9-0-141" class="i">+
</a><a href="#h9-0-142" id="h9-0-142" class="i">+    private var content: @Composable () -&gt; Unit by mutableStateOf({})
</a><a href="#h9-0-143" id="h9-0-143" class="i">+
</a><a href="#h9-0-144" id="h9-0-144" class="i">+    var usePlatformDefaultWidth = false
</a><a href="#h9-0-145" id="h9-0-145" class="i">+
</a><a href="#h9-0-146" id="h9-0-146" class="i">+    override var shouldCreateCompositionOnAttachedToWindow: Boolean = false
</a><a href="#h9-0-147" id="h9-0-147" class="i">+        private set
</a><a href="#h9-0-148" id="h9-0-148" class="i">+
</a><a href="#h9-0-149" id="h9-0-149" class="i">+    fun setContent(parent: CompositionContext, content: @Composable () -&gt; Unit) {
</a><a href="#h9-0-150" id="h9-0-150" class="i">+        setParentCompositionContext(parent)
</a><a href="#h9-0-151" id="h9-0-151" class="i">+        this.content = content
</a><a href="#h9-0-152" id="h9-0-152" class="i">+        shouldCreateCompositionOnAttachedToWindow = true
</a><a href="#h9-0-153" id="h9-0-153" class="i">+        createComposition()
</a><a href="#h9-0-154" id="h9-0-154" class="i">+    }
</a><a href="#h9-0-155" id="h9-0-155" class="i">+
</a><a href="#h9-0-156" id="h9-0-156" class="i">+    override fun measureChild(
</a><a href="#h9-0-157" id="h9-0-157" class="i">+        child: View?,
</a><a href="#h9-0-158" id="h9-0-158" class="i">+        parentWidthMeasureSpec: Int,
</a><a href="#h9-0-159" id="h9-0-159" class="i">+        parentHeightMeasureSpec: Int
</a><a href="#h9-0-160" id="h9-0-160" class="i">+    ) {
</a><a href="#h9-0-161" id="h9-0-161" class="i">+
</a><a href="#h9-0-162" id="h9-0-162" class="i">+        super.measureChild(child, parentWidthMeasureSpec, parentHeightMeasureSpec)
</a><a href="#h9-0-163" id="h9-0-163" class="i">+    }
</a><a href="#h9-0-164" id="h9-0-164" class="i">+
</a><a href="#h9-0-165" id="h9-0-165" class="i">+    private val displayWidth: Int
</a><a href="#h9-0-166" id="h9-0-166" class="i">+        get() {
</a><a href="#h9-0-167" id="h9-0-167" class="i">+            val density = context.resources.displayMetrics.density
</a><a href="#h9-0-168" id="h9-0-168" class="i">+            return (context.resources.configuration.screenWidthDp * density).roundToInt()
</a><a href="#h9-0-169" id="h9-0-169" class="i">+        }
</a><a href="#h9-0-170" id="h9-0-170" class="i">+
</a><a href="#h9-0-171" id="h9-0-171" class="i">+    private val displayHeight: Int
</a><a href="#h9-0-172" id="h9-0-172" class="i">+        get() {
</a><a href="#h9-0-173" id="h9-0-173" class="i">+            val density = context.resources.displayMetrics.density
</a><a href="#h9-0-174" id="h9-0-174" class="i">+            return (context.resources.configuration.screenHeightDp * density).roundToInt()
</a><a href="#h9-0-175" id="h9-0-175" class="i">+        }
</a><a href="#h9-0-176" id="h9-0-176" class="i">+
</a><a href="#h9-0-177" id="h9-0-177" class="i">+    @Composable
</a><a href="#h9-0-178" id="h9-0-178" class="i">+    override fun Content() {
</a><a href="#h9-0-179" id="h9-0-179" class="i">+        content()
</a><a href="#h9-0-180" id="h9-0-180" class="i">+    }
</a><a href="#h9-0-181" id="h9-0-181" class="i">+}
</a><a href="#h9-0-182" id="h9-0-182" class="i">+
</a><a href="#h9-0-183" id="h9-0-183" class="i">+private class DialogWrapper(
</a><a href="#h9-0-184" id="h9-0-184" class="i">+    private var onDismissRequest: () -&gt; Unit,
</a><a href="#h9-0-185" id="h9-0-185" class="i">+    private var properties: DialogProperties,
</a><a href="#h9-0-186" id="h9-0-186" class="i">+    private val composeView: View,
</a><a href="#h9-0-187" id="h9-0-187" class="i">+    layoutDirection: LayoutDirection,
</a><a href="#h9-0-188" id="h9-0-188" class="i">+    density: Density,
</a><a href="#h9-0-189" id="h9-0-189" class="i">+    dialogId: UUID
</a><a href="#h9-0-190" id="h9-0-190" class="i">+) : ComponentDialog(
</a><a href="#h9-0-191" id="h9-0-191" class="i">+    ContextThemeWrapper(
</a><a href="#h9-0-192" id="h9-0-192" class="i">+        composeView.context,
</a><a href="#h9-0-193" id="h9-0-193" class="i">+        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S || properties.decorFitsSystemWindows) {
</a><a href="#h9-0-194" id="h9-0-194" class="i">+            R.style.DialogWindowTheme
</a><a href="#h9-0-195" id="h9-0-195" class="i">+        } else {
</a><a href="#h9-0-196" id="h9-0-196" class="i">+            R.style.FloatingDialogWindowTheme
</a><a href="#h9-0-197" id="h9-0-197" class="i">+        }
</a><a href="#h9-0-198" id="h9-0-198" class="i">+    )
</a><a href="#h9-0-199" id="h9-0-199" class="i">+),
</a><a href="#h9-0-200" id="h9-0-200" class="i">+    ViewRootForInspector {
</a><a href="#h9-0-201" id="h9-0-201" class="i">+
</a><a href="#h9-0-202" id="h9-0-202" class="i">+    private val dialogLayout: DialogLayout
</a><a href="#h9-0-203" id="h9-0-203" class="i">+
</a><a href="#h9-0-204" id="h9-0-204" class="i">+    // On systems older than Android S, there is a bug in the surface insets matrix math used by
</a><a href="#h9-0-205" id="h9-0-205" class="i">+    // elevation, so high values of maxSupportedElevation break accessibility services: b/232788477.
</a><a href="#h9-0-206" id="h9-0-206" class="i">+    private val maxSupportedElevation = 8.dp
</a><a href="#h9-0-207" id="h9-0-207" class="i">+
</a><a href="#h9-0-208" id="h9-0-208" class="i">+    override val subCompositionView: AbstractComposeView get() = dialogLayout
</a><a href="#h9-0-209" id="h9-0-209" class="i">+
</a><a href="#h9-0-210" id="h9-0-210" class="i">+    private val defaultSoftInputMode: Int
</a><a href="#h9-0-211" id="h9-0-211" class="i">+
</a><a href="#h9-0-212" id="h9-0-212" class="i">+    init {
</a><a href="#h9-0-213" id="h9-0-213" class="i">+        val window = window ?: error(&quot;Dialog has no window&quot;)
</a><a href="#h9-0-214" id="h9-0-214" class="i">+        defaultSoftInputMode =
</a><a href="#h9-0-215" id="h9-0-215" class="i">+            window.attributes.softInputMode and WindowManager.LayoutParams.SOFT_INPUT_MASK_ADJUST
</a><a href="#h9-0-216" id="h9-0-216" class="i">+        window.requestFeature(Window.FEATURE_NO_TITLE)
</a><a href="#h9-0-217" id="h9-0-217" class="i">+        window.setBackgroundDrawableResource(android.R.color.transparent)
</a><a href="#h9-0-218" id="h9-0-218" class="i">+        @OptIn(ExperimentalComposeUiApi::class)
</a><a href="#h9-0-219" id="h9-0-219" class="i">+        WindowCompat.setDecorFitsSystemWindows(window, properties.decorFitsSystemWindows)
</a><a href="#h9-0-220" id="h9-0-220" class="i">+        dialogLayout = DialogLayout(context, window).apply {
</a><a href="#h9-0-221" id="h9-0-221" class="i">+            // Set unique id for AbstractComposeView. This allows state restoration for the state
</a><a href="#h9-0-222" id="h9-0-222" class="i">+            // defined inside the Dialog via rememberSaveable()
</a><a href="#h9-0-223" id="h9-0-223" class="i">+            setTag(R.id.compose_view_saveable_id_tag, &quot;Dialog:$dialogId&quot;)
</a><a href="#h9-0-224" id="h9-0-224" class="i">+            // Enable children to draw their shadow by not clipping them
</a><a href="#h9-0-225" id="h9-0-225" class="i">+            clipChildren = false
</a><a href="#h9-0-226" id="h9-0-226" class="i">+            // Allocate space for elevation
</a><a href="#h9-0-227" id="h9-0-227" class="i">+            with(density) { elevation = maxSupportedElevation.toPx() }
</a><a href="#h9-0-228" id="h9-0-228" class="i">+            // Simple outline to force window manager to allocate space for shadow.
</a><a href="#h9-0-229" id="h9-0-229" class="i">+            // Note that the outline affects clickable area for the dismiss listener. In case of
</a><a href="#h9-0-230" id="h9-0-230" class="i">+            // shapes like circle the area for dismiss might be to small (rectangular outline
</a><a href="#h9-0-231" id="h9-0-231" class="i">+            // consuming clicks outside of the circle).
</a><a href="#h9-0-232" id="h9-0-232" class="i">+            outlineProvider = object : ViewOutlineProvider() {
</a><a href="#h9-0-233" id="h9-0-233" class="i">+                override fun getOutline(view: View, result: Outline) {
</a><a href="#h9-0-234" id="h9-0-234" class="i">+                    result.setRect(0, 0, view.width, view.height)
</a><a href="#h9-0-235" id="h9-0-235" class="i">+                    // We set alpha to 0 to hide the view&#39;s shadow and let the composable to draw
</a><a href="#h9-0-236" id="h9-0-236" class="i">+                    // its own shadow. This still enables us to get the extra space needed in the
</a><a href="#h9-0-237" id="h9-0-237" class="i">+                    // surface.
</a><a href="#h9-0-238" id="h9-0-238" class="i">+                    result.alpha = 0f
</a><a href="#h9-0-239" id="h9-0-239" class="i">+                }
</a><a href="#h9-0-240" id="h9-0-240" class="i">+            }
</a><a href="#h9-0-241" id="h9-0-241" class="i">+        }
</a><a href="#h9-0-242" id="h9-0-242" class="i">+
</a><a href="#h9-0-243" id="h9-0-243" class="i">+        /**
</a><a href="#h9-0-244" id="h9-0-244" class="i">+         * Disables clipping for [this] and all its descendant [ViewGroup]s until we reach a
</a><a href="#h9-0-245" id="h9-0-245" class="i">+         * [DialogLayout] (the [ViewGroup] containing the Compose hierarchy).
</a><a href="#h9-0-246" id="h9-0-246" class="i">+         */
</a><a href="#h9-0-247" id="h9-0-247" class="i">+        fun ViewGroup.disableClipping() {
</a><a href="#h9-0-248" id="h9-0-248" class="i">+            clipChildren = false
</a><a href="#h9-0-249" id="h9-0-249" class="i">+            if (this is DialogLayout) return
</a><a href="#h9-0-250" id="h9-0-250" class="i">+            for (i in 0 until childCount) {
</a><a href="#h9-0-251" id="h9-0-251" class="i">+                (getChildAt(i) as? ViewGroup)?.disableClipping()
</a><a href="#h9-0-252" id="h9-0-252" class="i">+            }
</a><a href="#h9-0-253" id="h9-0-253" class="i">+        }
</a><a href="#h9-0-254" id="h9-0-254" class="i">+
</a><a href="#h9-0-255" id="h9-0-255" class="i">+        // Turn of all clipping so shadows can be drawn outside the window
</a><a href="#h9-0-256" id="h9-0-256" class="i">+        (window.decorView as? ViewGroup)?.disableClipping()
</a><a href="#h9-0-257" id="h9-0-257" class="i">+        setContentView(dialogLayout)
</a><a href="#h9-0-258" id="h9-0-258" class="i">+        dialogLayout.setViewTreeLifecycleOwner(composeView.findViewTreeLifecycleOwner())
</a><a href="#h9-0-259" id="h9-0-259" class="i">+        dialogLayout.setViewTreeViewModelStoreOwner(composeView.findViewTreeViewModelStoreOwner())
</a><a href="#h9-0-260" id="h9-0-260" class="i">+        dialogLayout.setViewTreeSavedStateRegistryOwner(
</a><a href="#h9-0-261" id="h9-0-261" class="i">+            composeView.findViewTreeSavedStateRegistryOwner()
</a><a href="#h9-0-262" id="h9-0-262" class="i">+        )
</a><a href="#h9-0-263" id="h9-0-263" class="i">+
</a><a href="#h9-0-264" id="h9-0-264" class="i">+        // Initial setup
</a><a href="#h9-0-265" id="h9-0-265" class="i">+        updateParameters(onDismissRequest, properties, layoutDirection)
</a><a href="#h9-0-266" id="h9-0-266" class="i">+
</a><a href="#h9-0-267" id="h9-0-267" class="i">+        // Due to how the onDismissRequest callback works
</a><a href="#h9-0-268" id="h9-0-268" class="i">+        // (it enforces a just-in-time decision on whether to update the state to hide the dialog)
</a><a href="#h9-0-269" id="h9-0-269" class="i">+        // we need to unconditionally add a callback here that is always enabled,
</a><a href="#h9-0-270" id="h9-0-270" class="i">+        // meaning we&#39;ll never get a system UI controlled predictive back animation
</a><a href="#h9-0-271" id="h9-0-271" class="i">+        // for these dialogs
</a><a href="#h9-0-272" id="h9-0-272" class="i">+        onBackPressedDispatcher.addCallback(this) {
</a><a href="#h9-0-273" id="h9-0-273" class="i">+            if (properties.dismissOnBackPress) {
</a><a href="#h9-0-274" id="h9-0-274" class="i">+                onDismissRequest()
</a><a href="#h9-0-275" id="h9-0-275" class="i">+            }
</a><a href="#h9-0-276" id="h9-0-276" class="i">+        }
</a><a href="#h9-0-277" id="h9-0-277" class="i">+    }
</a><a href="#h9-0-278" id="h9-0-278" class="i">+
</a><a href="#h9-0-279" id="h9-0-279" class="i">+    private fun setLayoutDirection(layoutDirection: LayoutDirection) {
</a><a href="#h9-0-280" id="h9-0-280" class="i">+        dialogLayout.layoutDirection = when (layoutDirection) {
</a><a href="#h9-0-281" id="h9-0-281" class="i">+            LayoutDirection.Ltr -&gt; android.util.LayoutDirection.LTR
</a><a href="#h9-0-282" id="h9-0-282" class="i">+            LayoutDirection.Rtl -&gt; android.util.LayoutDirection.RTL
</a><a href="#h9-0-283" id="h9-0-283" class="i">+        }
</a><a href="#h9-0-284" id="h9-0-284" class="i">+    }
</a><a href="#h9-0-285" id="h9-0-285" class="i">+
</a><a href="#h9-0-286" id="h9-0-286" class="i">+    // TODO(b/159900354): Make the Android Dialog full screen and the scrim fully transparent
</a><a href="#h9-0-287" id="h9-0-287" class="i">+
</a><a href="#h9-0-288" id="h9-0-288" class="i">+    fun setContent(parentComposition: CompositionContext, children: @Composable () -&gt; Unit) {
</a><a href="#h9-0-289" id="h9-0-289" class="i">+        dialogLayout.setContent(parentComposition, children)
</a><a href="#h9-0-290" id="h9-0-290" class="i">+    }
</a><a href="#h9-0-291" id="h9-0-291" class="i">+
</a><a href="#h9-0-292" id="h9-0-292" class="i">+    private fun setSecurePolicy(securePolicy: SecureFlagPolicy) {
</a><a href="#h9-0-293" id="h9-0-293" class="i">+    }
</a><a href="#h9-0-294" id="h9-0-294" class="i">+
</a><a href="#h9-0-295" id="h9-0-295" class="i">+    fun updateParameters(
</a><a href="#h9-0-296" id="h9-0-296" class="i">+        onDismissRequest: () -&gt; Unit,
</a><a href="#h9-0-297" id="h9-0-297" class="i">+        properties: DialogProperties,
</a><a href="#h9-0-298" id="h9-0-298" class="i">+        layoutDirection: LayoutDirection
</a><a href="#h9-0-299" id="h9-0-299" class="i">+    ) {
</a><a href="#h9-0-300" id="h9-0-300" class="i">+        this.onDismissRequest = onDismissRequest
</a><a href="#h9-0-301" id="h9-0-301" class="i">+        this.properties = properties
</a><a href="#h9-0-302" id="h9-0-302" class="i">+        setSecurePolicy(properties.securePolicy)
</a><a href="#h9-0-303" id="h9-0-303" class="i">+        setLayoutDirection(layoutDirection)
</a><a href="#h9-0-304" id="h9-0-304" class="i">+        if (properties.usePlatformDefaultWidth &amp;&amp; !dialogLayout.usePlatformDefaultWidth) {
</a><a href="#h9-0-305" id="h9-0-305" class="i">+            // Undo fixed size in internalOnLayout, which would suppress size changes when
</a><a href="#h9-0-306" id="h9-0-306" class="i">+            // usePlatformDefaultWidth is true.
</a><a href="#h9-0-307" id="h9-0-307" class="i">+            window?.setLayout(
</a><a href="#h9-0-308" id="h9-0-308" class="i">+                WindowManager.LayoutParams.WRAP_CONTENT,
</a><a href="#h9-0-309" id="h9-0-309" class="i">+                WindowManager.LayoutParams.WRAP_CONTENT
</a><a href="#h9-0-310" id="h9-0-310" class="i">+            )
</a><a href="#h9-0-311" id="h9-0-311" class="i">+        }
</a><a href="#h9-0-312" id="h9-0-312" class="i">+        dialogLayout.usePlatformDefaultWidth = properties.usePlatformDefaultWidth
</a><a href="#h9-0-313" id="h9-0-313" class="i">+        if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.S) {
</a><a href="#h9-0-314" id="h9-0-314" class="i">+            @OptIn(ExperimentalComposeUiApi::class)
</a><a href="#h9-0-315" id="h9-0-315" class="i">+            if (properties.decorFitsSystemWindows) {
</a><a href="#h9-0-316" id="h9-0-316" class="i">+                window?.setSoftInputMode(defaultSoftInputMode)
</a><a href="#h9-0-317" id="h9-0-317" class="i">+            } else {
</a><a href="#h9-0-318" id="h9-0-318" class="i">+                @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h9-0-319" id="h9-0-319" class="i">+                window?.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE)
</a><a href="#h9-0-320" id="h9-0-320" class="i">+            }
</a><a href="#h9-0-321" id="h9-0-321" class="i">+        }
</a><a href="#h9-0-322" id="h9-0-322" class="i">+    }
</a><a href="#h9-0-323" id="h9-0-323" class="i">+
</a><a href="#h9-0-324" id="h9-0-324" class="i">+    fun disposeComposition() {
</a><a href="#h9-0-325" id="h9-0-325" class="i">+        dialogLayout.disposeComposition()
</a><a href="#h9-0-326" id="h9-0-326" class="i">+    }
</a><a href="#h9-0-327" id="h9-0-327" class="i">+
</a><a href="#h9-0-328" id="h9-0-328" class="i">+    override fun onTouchEvent(event: MotionEvent): Boolean {
</a><a href="#h9-0-329" id="h9-0-329" class="i">+        val result = super.onTouchEvent(event)
</a><a href="#h9-0-330" id="h9-0-330" class="i">+        if (result &amp;&amp; properties.dismissOnClickOutside) {
</a><a href="#h9-0-331" id="h9-0-331" class="i">+            onDismissRequest()
</a><a href="#h9-0-332" id="h9-0-332" class="i">+        }
</a><a href="#h9-0-333" id="h9-0-333" class="i">+
</a><a href="#h9-0-334" id="h9-0-334" class="i">+        return result
</a><a href="#h9-0-335" id="h9-0-335" class="i">+    }
</a><a href="#h9-0-336" id="h9-0-336" class="i">+
</a><a href="#h9-0-337" id="h9-0-337" class="i">+    override fun cancel() {
</a><a href="#h9-0-338" id="h9-0-338" class="i">+        // Prevents the dialog from dismissing itself
</a><a href="#h9-0-339" id="h9-0-339" class="i">+        return
</a><a href="#h9-0-340" id="h9-0-340" class="i">+    }
</a><a href="#h9-0-341" id="h9-0-341" class="i">+}
</a><a href="#h9-0-342" id="h9-0-342" class="i">+
</a><a href="#h9-0-343" id="h9-0-343" class="i">+@Composable
</a><a href="#h9-0-344" id="h9-0-344" class="i">+private fun DialogLayout(
</a><a href="#h9-0-345" id="h9-0-345" class="i">+    modifier: Modifier = Modifier,
</a><a href="#h9-0-346" id="h9-0-346" class="i">+    content: @Composable () -&gt; Unit
</a><a href="#h9-0-347" id="h9-0-347" class="i">+) {
</a><a href="#h9-0-348" id="h9-0-348" class="i">+    Layout(
</a><a href="#h9-0-349" id="h9-0-349" class="i">+        content = content,
</a><a href="#h9-0-350" id="h9-0-350" class="i">+        modifier = modifier
</a><a href="#h9-0-351" id="h9-0-351" class="i">+    ) { measurables, constraints -&gt;
</a><a href="#h9-0-352" id="h9-0-352" class="i">+        val placeables = measurables.map { it.measure(constraints) }
</a><a href="#h9-0-353" id="h9-0-353" class="i">+        val width = placeables.maxBy { it.width }.width
</a><a href="#h9-0-354" id="h9-0-354" class="i">+        val height = placeables.maxBy { it.height }.height
</a><a href="#h9-0-355" id="h9-0-355" class="i">+        layout(width, height) {
</a><a href="#h9-0-356" id="h9-0-356" class="i">+            placeables.forEach { it.placeRelative(0, 0) }
</a><a href="#h9-0-357" id="h9-0-357" class="i">+        }
</a><a href="#h9-0-358" id="h9-0-358" class="i">+    }
</a><a href="#h9-0-359" id="h9-0-359" class="i">+}
</a><b>diff --git a/<a id="h10" href="../file/app/src/main/res/values/styles.xml.html">app/src/main/res/values/styles.xml</a> b/<a href="../file/app/src/main/res/values/styles.xml.html">app/src/main/res/values/styles.xml</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,14 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
</a><a href="#h10-0-1" id="h10-0-1" class="i">+&lt;resources&gt;
</a><a href="#h10-0-2" id="h10-0-2" class="i">+    &lt;style name=&quot;FullscreenOverlayDialog&quot;&gt;
</a><a href="#h10-0-3" id="h10-0-3" class="i">+        &lt;item name=&quot;android:windowBackground&quot;&gt;@android:color/transparent&lt;/item&gt;
</a><a href="#h10-0-4" id="h10-0-4" class="i">+        &lt;item name=&quot;android:windowFrame&quot;&gt;@null&lt;/item&gt;
</a><a href="#h10-0-5" id="h10-0-5" class="i">+        &lt;item name=&quot;android:windowIsFloating&quot;&gt;false&lt;/item&gt;
</a><a href="#h10-0-6" id="h10-0-6" class="i">+        &lt;item name=&quot;android:windowNoTitle&quot;&gt;true&lt;/item&gt;
</a><a href="#h10-0-7" id="h10-0-7" class="i">+        &lt;item name=&quot;android:windowContentOverlay&quot;&gt;@null&lt;/item&gt;
</a><a href="#h10-0-8" id="h10-0-8" class="i">+        &lt;item name=&quot;android:windowAnimationStyle&quot;&gt;@android:style/Animation.Dialog&lt;/item&gt;
</a><a href="#h10-0-9" id="h10-0-9" class="i">+        &lt;item name=&quot;android:windowSoftInputMode&quot;&gt;stateUnspecified|adjustPan&lt;/item&gt;
</a><a href="#h10-0-10" id="h10-0-10" class="i">+        &lt;item name=&quot;android:windowActionBar&quot;&gt;false&lt;/item&gt;
</a><a href="#h10-0-11" id="h10-0-11" class="i">+        &lt;item name=&quot;android:windowActionModeOverlay&quot;&gt;true&lt;/item&gt;
</a><a href="#h10-0-12" id="h10-0-12" class="i">+    &lt;/style&gt;
</a><a href="#h10-0-13" id="h10-0-13" class="i">+&lt;/resources&gt;
</a><b>diff --git a/<a id="h11" href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a> b/<a href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -93,4 +93,8 @@ interface BridgeInterface {
</a>     oneway void passGroupsAndFriends(in List&lt;String&gt; groups, in List&lt;String&gt; friends);
 
     IScripting getScriptingInterface();
<a href="#h11-0-3" id="h11-0-3" class="i">+
</a><a href="#h11-0-4" id="h11-0-4" class="i">+    void openSettingsOverlay();
</a><a href="#h11-0-5" id="h11-0-5" class="i">+
</a><a href="#h11-0-6" id="h11-0-6" class="i">+    void closeSettingsOverlay();
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h12" href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a> b/<a href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -25,7 +25,7 @@
</a>             &quot;downloads&quot;: &quot;Downloads&quot;,
             &quot;features&quot;: &quot;Features&quot;,
             &quot;home&quot;: &quot;Home&quot;,
<a href="#h12-0-3" id="h12-0-3" class="d">-            &quot;home_debug&quot;: &quot;Debug&quot;,
</a><a href="#h12-0-4" id="h12-0-4" class="i">+            &quot;home_settings&quot;: &quot;Settings&quot;,
</a>             &quot;home_logs&quot;: &quot;Logs&quot;,
             &quot;social&quot;: &quot;Social&quot;,
             &quot;scripts&quot;: &quot;Scripts&quot;
<b>diff --git a/<a id="h13" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -16,12 +16,20 @@ import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
</a> import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
 import me.rhunk.snapenhance.core.util.ktx.getApplicationInfoCompat
 import me.rhunk.snapenhance.data.SnapClassCache
<a href="#h13-0-3" id="h13-0-3" class="i">+import me.rhunk.snapenhance.hook.HookAdapter
</a> import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
 import me.rhunk.snapenhance.hook.hook
 import kotlin.time.ExperimentalTime
 import kotlin.time.measureTime
 
<a href="#h13-0-10" id="h13-0-10" class="i">+private fun useMainActivity(hookAdapter: HookAdapter, block: Activity.() -&gt; Unit) {
</a><a href="#h13-0-11" id="h13-0-11" class="i">+    val activity = hookAdapter.thisObject() as Activity
</a><a href="#h13-0-12" id="h13-0-12" class="i">+    if (!activity.packageName.equals(Constants.SNAPCHAT_PACKAGE_NAME)) return
</a><a href="#h13-0-13" id="h13-0-13" class="i">+    block(activity)
</a><a href="#h13-0-14" id="h13-0-14" class="i">+}
</a><a href="#h13-0-15" id="h13-0-15" class="i">+
</a><a href="#h13-0-16" id="h13-0-16" class="i">+
</a> class SnapEnhance {
     companion object {
         lateinit var classLoader: ClassLoader
<a href="#h13-1" id="h13-1" class="h">@@ -68,12 +76,18 @@ class SnapEnhance {
</a>         }
 
         Activity::class.java.hook( &quot;onCreate&quot;,  HookStage.AFTER, { isBridgeInitialized }) {
<a href="#h13-1-3" id="h13-1-3" class="d">-            val activity = it.thisObject() as Activity
</a><a href="#h13-1-4" id="h13-1-4" class="d">-            if (!activity.packageName.equals(Constants.SNAPCHAT_PACKAGE_NAME)) return@hook
</a><a href="#h13-1-5" id="h13-1-5" class="d">-            val isMainActivityNotNull = appContext.mainActivity != null
</a><a href="#h13-1-6" id="h13-1-6" class="d">-            appContext.mainActivity = activity
</a><a href="#h13-1-7" id="h13-1-7" class="d">-            if (isMainActivityNotNull || !appContext.mappings.isMappingsLoaded()) return@hook
</a><a href="#h13-1-8" id="h13-1-8" class="d">-            onActivityCreate()
</a><a href="#h13-1-9" id="h13-1-9" class="i">+            useMainActivity(it) {
</a><a href="#h13-1-10" id="h13-1-10" class="i">+                val isMainActivityNotNull = appContext.mainActivity != null
</a><a href="#h13-1-11" id="h13-1-11" class="i">+                appContext.mainActivity = this
</a><a href="#h13-1-12" id="h13-1-12" class="i">+                if (isMainActivityNotNull || !appContext.mappings.isMappingsLoaded()) return@useMainActivity
</a><a href="#h13-1-13" id="h13-1-13" class="i">+                onActivityCreate()
</a><a href="#h13-1-14" id="h13-1-14" class="i">+            }
</a><a href="#h13-1-15" id="h13-1-15" class="i">+        }
</a><a href="#h13-1-16" id="h13-1-16" class="i">+
</a><a href="#h13-1-17" id="h13-1-17" class="i">+        Activity::class.java.hook( &quot;onPause&quot;,  HookStage.AFTER, { isBridgeInitialized }) {
</a><a href="#h13-1-18" id="h13-1-18" class="i">+            useMainActivity(it) {
</a><a href="#h13-1-19" id="h13-1-19" class="i">+                appContext.bridgeClient.closeSettingsOverlay()
</a><a href="#h13-1-20" id="h13-1-20" class="i">+            }
</a>         }
 
         var activityWasResumed = false
<a href="#h13-2" id="h13-2" class="h">@@ -81,17 +95,16 @@ class SnapEnhance {
</a>         //we need to reload the config when the app is resumed
         //FIXME: called twice at first launch
         Activity::class.java.hook(&quot;onResume&quot;, HookStage.AFTER, { isBridgeInitialized }) {
<a href="#h13-2-3" id="h13-2-3" class="d">-            val activity = it.thisObject() as Activity
</a><a href="#h13-2-4" id="h13-2-4" class="d">-            if (!activity.packageName.equals(Constants.SNAPCHAT_PACKAGE_NAME)) return@hook
</a><a href="#h13-2-5" id="h13-2-5" class="i">+            useMainActivity(it) {
</a><a href="#h13-2-6" id="h13-2-6" class="i">+                if (!activityWasResumed) {
</a><a href="#h13-2-7" id="h13-2-7" class="i">+                    activityWasResumed = true
</a><a href="#h13-2-8" id="h13-2-8" class="i">+                    return@useMainActivity
</a><a href="#h13-2-9" id="h13-2-9" class="i">+                }
</a> 
<a href="#h13-2-11" id="h13-2-11" class="d">-            if (!activityWasResumed) {
</a><a href="#h13-2-12" id="h13-2-12" class="d">-                activityWasResumed = true
</a><a href="#h13-2-13" id="h13-2-13" class="d">-                return@hook
</a><a href="#h13-2-14" id="h13-2-14" class="i">+                appContext.actionManager.onNewIntent(this.intent)
</a><a href="#h13-2-15" id="h13-2-15" class="i">+                appContext.reloadConfig()
</a><a href="#h13-2-16" id="h13-2-16" class="i">+                syncRemote()
</a>             }
<a href="#h13-2-18" id="h13-2-18" class="d">-
</a><a href="#h13-2-19" id="h13-2-19" class="d">-            appContext.actionManager.onNewIntent(activity.intent)
</a><a href="#h13-2-20" id="h13-2-20" class="d">-            appContext.reloadConfig()
</a><a href="#h13-2-21" id="h13-2-21" class="d">-            syncRemote()
</a>         }
     }
 
<b>diff --git a/<a id="h14" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/bridge/BridgeClient.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -140,4 +140,7 @@ class BridgeClient(
</a>         = service.setRule(targetUuid, type.key, state)
 
     fun getScriptingInterface(): IScripting = service.getScriptingInterface()
<a href="#h14-0-3" id="h14-0-3" class="i">+
</a><a href="#h14-0-4" id="h14-0-4" class="i">+    fun openSettingsOverlay() = service.openSettingsOverlay()
</a><a href="#h14-0-5" id="h14-0-5" class="i">+    fun closeSettingsOverlay() = service.closeSettingsOverlay()
</a> }
<b>diff --git a/<a id="h15" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -45,11 +45,12 @@ class SettingsGearInjector : AbstractMenu() {
</a>             isClickable = true
 
             setOnClickListener {
<a href="#h15-0-3" id="h15-0-3" class="d">-                val intent = Intent().apply {
</a><a href="#h15-0-4" id="h15-0-4" class="i">+               /* val intent = Intent().apply {
</a>                     setClassName(BuildConfig.APPLICATION_ID, &quot;me.rhunk.snapenhance.ui.manager.MainActivity&quot;)
                     putExtra(&quot;route&quot;, &quot;features&quot;)
                 }
<a href="#h15-0-8" id="h15-0-8" class="d">-                context.startActivity(intent)
</a><a href="#h15-0-9" id="h15-0-9" class="i">+                context.startActivity(intent)*/
</a><a href="#h15-0-10" id="h15-0-10" class="i">+                this@SettingsGearInjector.context.bridgeClient.openSettingsOverlay()
</a>             }
 
             parent.setOnTouchListener { _, event -&gt;
</pre>
</div>
</body>
</html>
