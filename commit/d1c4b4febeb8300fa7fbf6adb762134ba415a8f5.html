<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>fix(app): two letters locale - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/d1c4b4febeb8300fa7fbf6adb762134ba415a8f5.html">d1c4b4febeb8300fa7fbf6adb762134ba415a8f5</a>
<b>parent</b> <a href="../commit/49bc15cf1bd0b204a2c232304059c2ea036594a0.html">49bc15cf1bd0b204a2c232304059c2ea036594a0</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Thu,  4 Jan 2024 15:56:27 +0100

fix(app): two letters locale

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">+++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/types/LocalePair.kt</a></td><td> | </td><td class="num">14</td><td><span class="i">++++++++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LocaleWrapper.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
</table></pre><pre>4 files changed, 26 insertions(+), 11 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/home/HomeSection.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -211,7 +211,7 @@ class HomeSection : Section() {
</a>             )
 
             Text(
<a href="#h0-0-3" id="h0-0-3" class="d">-                text = arrayOf(&quot;\u0020&quot;, &quot;\u0065&quot;, &quot;\u0063&quot;, &quot;\u006e&quot;, &quot;\u0061&quot;, &quot;\u0068&quot;, &quot;\u006e&quot;, &quot;\u0045&quot;, &quot;\u0070&quot;, &quot;\u0061&quot;, &quot;\u006e&quot;, &quot;\u0053&quot;).reversed().joinToString(&quot;&quot;),
</a><a href="#h0-0-4" id="h0-0-4" class="i">+                text = remember { intArrayOf(101,99,110,97,104,110,69,112,97,110,83).map { it.toChar() }.joinToString(&quot;&quot;).reversed() },
</a>                 fontSize = 30.sp,
                 fontFamily = avenirNextFontFamily,
                 modifier = Modifier.align(Alignment.CenterHorizontally),
<a href="#h0-1" id="h0-1" class="h">@@ -225,7 +225,7 @@ class HomeSection : Section() {
</a>             )
 
             Text(
<a href="#h0-1-3" id="h0-1-3" class="d">-                text = &quot;An Xposed module made to enhance your Snapchat experience&quot;,
</a><a href="#h0-1-4" id="h0-1-4" class="i">+                text = &quot;An xposed module made to enhance your Snapchat experience&quot;,
</a>                 modifier = Modifier
                     .padding(16.dp)
                     .fillMaxWidth(),
<a href="#h0-2" id="h0-2" class="h">@@ -245,7 +245,9 @@ class HomeSection : Section() {
</a>                     modifier = Modifier.size(32.dp).clickable {
                         context.activity?.startActivity(
                             Intent(Intent.ACTION_VIEW).apply {
<a href="#h0-2-3" id="h0-2-3" class="d">-                                data = Uri.parse(&quot;https://github.com/rhunk/SnapEnhance&quot;)
</a><a href="#h0-2-4" id="h0-2-4" class="i">+                                data = Uri.parse(
</a><a href="#h0-2-5" id="h0-2-5" class="i">+                                    intArrayOf(101,99,110,97,104,110,69,112,97,110,83,47,107,110,117,104,114,47,109,111,99,46,98,117,104,116,105,103,47,47,58,115,112,116,116,104).map { it.toChar() }.joinToString(&quot;&quot;).reversed()
</a><a href="#h0-2-6" id="h0-2-6" class="i">+                                )
</a>                                 flags = Intent.FLAG_ACTIVITY_NEW_TASK
                             }
                         )
<a href="#h0-3" id="h0-3" class="h">@@ -258,7 +260,9 @@ class HomeSection : Section() {
</a>                     modifier = Modifier.size(32.dp).clickable {
                         context.activity?.startActivity(
                             Intent(Intent.ACTION_VIEW).apply {
<a href="#h0-3-3" id="h0-3-3" class="d">-                                data = Uri.parse(&quot;https://t.me/snapenhance&quot;)
</a><a href="#h0-3-4" id="h0-3-4" class="i">+                                data = Uri.parse(
</a><a href="#h0-3-5" id="h0-3-5" class="i">+                                    intArrayOf(101,99,110,97,104,110,101,112,97,110,115,47,101,109,46,116,47,47,58,115,112,116,116,104).map { it.toChar() }.joinToString(&quot;&quot;).reversed()
</a><a href="#h0-3-6" id="h0-3-6" class="i">+                                )
</a>                                 flags = Intent.FLAG_ACTIVITY_NEW_TASK
                             }
                         )
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -40,6 +40,7 @@ class PickLanguageScreen : SetupScreen(){
</a> 
     private fun getLocaleDisplayName(locale: String): String {
         locale.split(&quot;_&quot;).let {
<a href="#h1-0-3" id="h1-0-3" class="i">+            if (it.size != 2) return Locale(locale).getDisplayName(Locale.getDefault())
</a>             return Locale(it[0], it[1]).getDisplayName(Locale.getDefault())
         }
     }
<a href="#h1-1" id="h1-1" class="h">@@ -105,7 +106,7 @@ class PickLanguageScreen : SetupScreen(){
</a>                                 contentAlignment = Alignment.Center
                             ) {
                                 Text(
<a href="#h1-1-3" id="h1-1-3" class="d">-                                    text = getLocaleDisplayName(locale),
</a><a href="#h1-1-4" id="h1-1-4" class="i">+                                    text = remember(locale) { getLocaleDisplayName(locale) },
</a>                                     fontSize = 16.sp,
                                     fontWeight = FontWeight.Light,
                                 )
<a href="#h1-2" id="h1-2" class="h">@@ -125,7 +126,7 @@ class PickLanguageScreen : SetupScreen(){
</a>             Button(onClick = {
                 isDialog = true
             }) {
<a href="#h1-2-3" id="h1-2-3" class="d">-                Text(text = getLocaleDisplayName(selectedLocale.value), fontSize = 16.sp,
</a><a href="#h1-2-4" id="h1-2-4" class="i">+                Text(text = remember(selectedLocale.value) { getLocaleDisplayName(selectedLocale.value) }, fontSize = 16.sp,
</a>                     fontWeight = FontWeight.Normal)
             }
         }
<b>diff --git a/<a id="h2" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/types/LocalePair.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/types/LocalePair.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/types/LocalePair.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/types/LocalePair.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,6 +1,16 @@
</a> package me.rhunk.snapenhance.common.bridge.types
 
<a href="#h2-0-2" id="h2-0-2" class="i">+import java.util.Locale
</a><a href="#h2-0-3" id="h2-0-3" class="i">+
</a> data class LocalePair(
     val locale: String,
     val content: String
<a href="#h2-0-7" id="h2-0-7" class="d">-)</a><a href="#h2-0-8" id="h2-0-8" class="d">-
\ No newline at end of file
</a><a href="#h2-0-9" id="h2-0-9" class="i">+) {
</a><a href="#h2-0-10" id="h2-0-10" class="i">+    fun getLocale(): Locale {
</a><a href="#h2-0-11" id="h2-0-11" class="i">+        if (locale.contains(&quot;_&quot;)) {
</a><a href="#h2-0-12" id="h2-0-12" class="i">+            val split = locale.split(&quot;_&quot;)
</a><a href="#h2-0-13" id="h2-0-13" class="i">+            return Locale(split[0], split[1])
</a><a href="#h2-0-14" id="h2-0-14" class="i">+        }
</a><a href="#h2-0-15" id="h2-0-15" class="i">+        return Locale(locale)
</a><a href="#h2-0-16" id="h2-0-16" class="i">+    }
</a><a href="#h2-0-17" id="h2-0-17" class="i">+}</a><a href="#h2-0-18" id="h2-0-18" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LocaleWrapper.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LocaleWrapper.kt</a> b/<a href="../file/common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LocaleWrapper.kt.html">common/src/main/kotlin/me/rhunk/snapenhance/common/bridge/wrapper/LocaleWrapper.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -19,7 +19,7 @@ class LocaleWrapper {
</a> 
             if (locale == DEFAULT_LOCALE) return locales
 
<a href="#h3-0-3" id="h3-0-3" class="d">-            val compatibleLocale = context.resources.assets.list(&quot;lang&quot;)?.firstOrNull { it.startsWith(locale) }?.substring(0, 5) ?: return locales
</a><a href="#h3-0-4" id="h3-0-4" class="i">+            val compatibleLocale = context.resources.assets.list(&quot;lang&quot;)?.firstOrNull { it.startsWith(locale) }?.substringBefore(&quot;.&quot;) ?: return locales
</a> 
             context.resources.assets.open(&quot;lang/$compatibleLocale.json&quot;).use { inputStream -&gt;
                 locales.add(LocalePair(compatibleLocale, inputStream.bufferedReader().use { it.readText() }))
<a href="#h3-1" id="h3-1" class="h">@@ -29,7 +29,7 @@ class LocaleWrapper {
</a>         }
 
         fun fetchAvailableLocales(context: Context): List&lt;String&gt; {
<a href="#h3-1-3" id="h3-1-3" class="d">-            return context.resources.assets.list(&quot;lang&quot;)?.map { it.substring(0, 5) } ?: listOf()
</a><a href="#h3-1-4" id="h3-1-4" class="i">+            return context.resources.assets.list(&quot;lang&quot;)?.map { it.substringBefore(&quot;.&quot;) }?.sorted() ?: listOf(DEFAULT_LOCALE)
</a>         }
     }
 
<a href="#h3-2" id="h3-2" class="h">@@ -40,7 +40,7 @@ class LocaleWrapper {
</a>     lateinit var loadedLocale: Locale
 
     private fun load(localePair: LocalePair) {
<a href="#h3-2-3" id="h3-2-3" class="d">-        loadedLocale = localePair.locale.let { Locale(it.substring(0, 2), it.substring(3, 5)) }
</a><a href="#h3-2-4" id="h3-2-4" class="i">+        loadedLocale = localePair.getLocale()
</a> 
         val translations = JsonParser.parseString(localePair.content).asJsonObject
         if (translations == null || translations.isJsonNull) {
</pre>
</div>
</body>
</html>
