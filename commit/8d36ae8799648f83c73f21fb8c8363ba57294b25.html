<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: auto updater (#23) - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/8d36ae8799648f83c73f21fb8c8363ba57294b25.html">8d36ae8799648f83c73f21fb8c8363ba57294b25</a>
<b>parent</b> <a href="../commit/39769f8940c1b14f87c1473b5a7089599d2a24b3.html">39769f8940c1b14f87c1473b5a7089599d2a24b3</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sun,  4 Jun 2023 23:39:03 +0200

feat: auto updater (#23)

* feature: auto updater

* fix: formatting

* feat: auto updater

---------

Co-authored-by: auth &lt;64337177+authorisation@users.noreply.github.com&gt;
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">23</td><td><span class="i">+++++++++++++++++++++</span><span class="d">--</span></td></tr>
<tr><td class="A">A</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt</a></td><td> | </td><td class="num">14</td><td><span class="i">++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt</a></td><td> | </td><td class="num">14</td><td><span class="i">++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></td><td> | </td><td class="num">110</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">+++++++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></td><td> | </td><td class="num">3</td><td><span class="i">++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
</table></pre><pre>13 files changed, 222 insertions(+), 6 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a> b/<a href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -3,6 +3,7 @@
</a>         &quot;spying_privacy&quot;: &quot;Spying &amp; Privacy&quot;,
         &quot;media_manager&quot;: &quot;Media Manager&quot;,
         &quot;ui_tweaks&quot;: &quot;UI &amp; Tweaks&quot;,
<a href="#h0-0-3" id="h0-0-3" class="i">+        &quot;updates&quot;: &quot;Updates&quot;,
</a>         &quot;experimental_debugging&quot;: &quot;Experimental&quot;
     },
 
<a href="#h0-1" id="h0-1" class="h">@@ -10,7 +11,8 @@
</a>         &quot;clean_cache&quot;: &quot;Clean Cache&quot;,
         &quot;clear_message_logger&quot;: &quot;Clear Message Logger&quot;,
         &quot;refresh_mappings&quot;: &quot;Refresh Mappings&quot;,
<a href="#h0-1-3" id="h0-1-3" class="d">-        &quot;open_map&quot;: &quot;Choose location on map&quot;
</a><a href="#h0-1-4" id="h0-1-4" class="i">+        &quot;open_map&quot;: &quot;Choose location on map&quot;,
</a><a href="#h0-1-5" id="h0-1-5" class="i">+        &quot;check_for_updates&quot;: &quot;Check for updates&quot;
</a>     },
    
     &quot;property&quot;: {
<a href="#h0-2" id="h0-2" class="h">@@ -55,7 +57,8 @@
</a>         &quot;location_spoof&quot;: &quot;Snapmap Location Spoofer&quot;,
         &quot;latitude_value&quot;: &quot;Latitude&quot;,
         &quot;longitude_value&quot;: &quot;Longitude&quot;,
<a href="#h0-2-3" id="h0-2-3" class="d">-        &quot;hide_ui_elements&quot;: &quot;Hide UI Elements&quot;
</a><a href="#h0-2-4" id="h0-2-4" class="i">+        &quot;hide_ui_elements&quot;: &quot;Hide UI Elements&quot;,
</a><a href="#h0-2-5" id="h0-2-5" class="i">+        &quot;auto_updater&quot;: &quot;Auto Updater&quot;
</a>     },
 
     &quot;option&quot;: {
<a href="#h0-3" id="h0-3" class="h">@@ -112,6 +115,12 @@
</a>                 &quot;remove_cognac_button&quot;: &quot;Remove Cognac Button&quot;,
                 &quot;remove_stickers_button&quot;: &quot;Remove Stickers Button&quot;,
                 &quot;remove_voice_record_button&quot;: &quot;Remove Voice Record Button&quot;
<a href="#h0-3-3" id="h0-3-3" class="i">+            },
</a><a href="#h0-3-4" id="h0-3-4" class="i">+            &quot;auto_updater&quot;: {
</a><a href="#h0-3-5" id="h0-3-5" class="i">+                &quot;DISABLED&quot;: &quot;Disabled&quot;,
</a><a href="#h0-3-6" id="h0-3-6" class="i">+                &quot;EVERY_LAUNCH&quot;: &quot;Every Launch&quot;,
</a><a href="#h0-3-7" id="h0-3-7" class="i">+                &quot;DAILY&quot;: &quot;Daily&quot;,
</a><a href="#h0-3-8" id="h0-3-8" class="i">+                &quot;WEEKLY&quot;: &quot;Weekly&quot;
</a>             }
         }
     },
<a href="#h0-4" id="h0-4" class="h">@@ -155,5 +164,15 @@
</a>         &quot;display_name&quot;: &quot;Display Name&quot;,
         &quot;added_date&quot;: &quot;Added Date&quot;,
         &quot;birthday&quot;: &quot;Birthday : {month} {day}&quot;
<a href="#h0-4-3" id="h0-4-3" class="i">+    },
</a><a href="#h0-4-4" id="h0-4-4" class="i">+
</a><a href="#h0-4-5" id="h0-4-5" class="i">+    &quot;auto_updater&quot;: {
</a><a href="#h0-4-6" id="h0-4-6" class="i">+        &quot;no_update_available&quot;: &quot;No Update available!&quot;,
</a><a href="#h0-4-7" id="h0-4-7" class="i">+        &quot;dialog_title&quot;: &quot;New Update available!&quot;,
</a><a href="#h0-4-8" id="h0-4-8" class="i">+        &quot;dialog_message&quot;: &quot;There is a new Update for SnapEnhance available! ({version})\n\n{body}&quot;,
</a><a href="#h0-4-9" id="h0-4-9" class="i">+        &quot;dialog_positive_button&quot;: &quot;Download and Install&quot;,
</a><a href="#h0-4-10" id="h0-4-10" class="i">+        &quot;dialog_negative_button&quot;: &quot;Cancel&quot;,
</a><a href="#h0-4-11" id="h0-4-11" class="i">+        &quot;downloading_toast&quot;: &quot;Downloading Update...&quot;,
</a><a href="#h0-4-12" id="h0-4-12" class="i">+        &quot;download_manager_notification_title&quot;: &quot;Downloading SnapEnhance APK...&quot;
</a>     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h1-0-0" id="h1-0-0" class="i">+package me.rhunk.snapenhance.action.impl
</a><a href="#h1-0-1" id="h1-0-1" class="i">+
</a><a href="#h1-0-2" id="h1-0-2" class="i">+import me.rhunk.snapenhance.action.AbstractAction
</a><a href="#h1-0-3" id="h1-0-3" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h1-0-4" id="h1-0-4" class="i">+import me.rhunk.snapenhance.features.impl.AutoUpdater
</a><a href="#h1-0-5" id="h1-0-5" class="i">+
</a><a href="#h1-0-6" id="h1-0-6" class="i">+class CheckForUpdates : AbstractAction(&quot;action.check_for_updates&quot;, dependsOnProperty = ConfigProperty.AUTO_UPDATER) {
</a><a href="#h1-0-7" id="h1-0-7" class="i">+    override fun run() {
</a><a href="#h1-0-8" id="h1-0-8" class="i">+        context.executeAsync {
</a><a href="#h1-0-9" id="h1-0-9" class="i">+            runCatching {
</a><a href="#h1-0-10" id="h1-0-10" class="i">+                val latestVersion = context.feature(AutoUpdater::class).checkForUpdates()
</a><a href="#h1-0-11" id="h1-0-11" class="i">+                if (latestVersion == null) {
</a><a href="#h1-0-12" id="h1-0-12" class="i">+                    context.longToast(context.translation.get(&quot;auto_updater.no_update_available&quot;))
</a><a href="#h1-0-13" id="h1-0-13" class="i">+                }
</a><a href="#h1-0-14" id="h1-0-14" class="i">+            }.onFailure {
</a><a href="#h1-0-15" id="h1-0-15" class="i">+                context.longToast(it.message ?: &quot;Failed to check for updates&quot;)
</a><a href="#h1-0-16" id="h1-0-16" class="i">+            }
</a><a href="#h1-0-17" id="h1-0-17" class="i">+        }
</a><a href="#h1-0-18" id="h1-0-18" class="i">+    }
</a><a href="#h1-0-19" id="h1-0-19" class="i">+}</a><a href="#h1-0-20" id="h1-0-20" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/AbstractBridgeClient.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -99,4 +99,16 @@ abstract class AbstractBridgeClient {
</a>      * @return the translations result
      */
     abstract fun fetchTranslations(): LocaleResult
<a href="#h2-0-3" id="h2-0-3" class="i">+
</a><a href="#h2-0-4" id="h2-0-4" class="i">+    /**
</a><a href="#h2-0-5" id="h2-0-5" class="i">+     * Get check for updates last time
</a><a href="#h2-0-6" id="h2-0-6" class="i">+     * @return the last time check for updates was done
</a><a href="#h2-0-7" id="h2-0-7" class="i">+     */
</a><a href="#h2-0-8" id="h2-0-8" class="i">+    abstract fun getAutoUpdaterTime(): Long
</a><a href="#h2-0-9" id="h2-0-9" class="i">+
</a><a href="#h2-0-10" id="h2-0-10" class="i">+    /**
</a><a href="#h2-0-11" id="h2-0-11" class="i">+     * Set check for updates last time
</a><a href="#h2-0-12" id="h2-0-12" class="i">+     * @param time the time to set
</a><a href="#h2-0-13" id="h2-0-13" class="i">+     */
</a><a href="#h2-0-14" id="h2-0-14" class="i">+    abstract fun setAutoUpdaterTime(time: Long)
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/RootBridgeClient.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -112,6 +112,20 @@ class RootBridgeClient : AbstractBridgeClient() {
</a>         throw Throwable(&quot;Failed to fetch translations for $locale&quot;)
     }
 
<a href="#h3-0-3" id="h3-0-3" class="i">+    override fun getAutoUpdaterTime(): Long {
</a><a href="#h3-0-4" id="h3-0-4" class="i">+        readFile(BridgeFileType.ANTI_AUTO_DOWNLOAD).run {
</a><a href="#h3-0-5" id="h3-0-5" class="i">+            return if (isEmpty()) {
</a><a href="#h3-0-6" id="h3-0-6" class="i">+                0
</a><a href="#h3-0-7" id="h3-0-7" class="i">+            } else {
</a><a href="#h3-0-8" id="h3-0-8" class="i">+                String(this).toLong()
</a><a href="#h3-0-9" id="h3-0-9" class="i">+            }
</a><a href="#h3-0-10" id="h3-0-10" class="i">+        }
</a><a href="#h3-0-11" id="h3-0-11" class="i">+    }
</a><a href="#h3-0-12" id="h3-0-12" class="i">+
</a><a href="#h3-0-13" id="h3-0-13" class="i">+    override fun setAutoUpdaterTime(time: Long) {
</a><a href="#h3-0-14" id="h3-0-14" class="i">+        writeFile(BridgeFileType.AUTO_UPDATER_TIMESTAMP, time.toString().toByteArray(Charsets.UTF_8))
</a><a href="#h3-0-15" id="h3-0-15" class="i">+    }
</a><a href="#h3-0-16" id="h3-0-16" class="i">+
</a>     private fun rootOperation(command: String): String {
         val process = Runtime.getRuntime().exec(&quot;su -c $command&quot;)
         process.waitFor()
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/client/ServiceBridgeClient.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -221,6 +221,20 @@ class ServiceBridgeClient: AbstractBridgeClient(), ServiceConnection {
</a>         }
     }
 
<a href="#h4-0-3" id="h4-0-3" class="i">+    override fun getAutoUpdaterTime(): Long {
</a><a href="#h4-0-4" id="h4-0-4" class="i">+        readFile(BridgeFileType.ANTI_AUTO_DOWNLOAD).run {
</a><a href="#h4-0-5" id="h4-0-5" class="i">+            return if (isEmpty()) {
</a><a href="#h4-0-6" id="h4-0-6" class="i">+                0
</a><a href="#h4-0-7" id="h4-0-7" class="i">+            } else {
</a><a href="#h4-0-8" id="h4-0-8" class="i">+                String(this).toLong()
</a><a href="#h4-0-9" id="h4-0-9" class="i">+            }
</a><a href="#h4-0-10" id="h4-0-10" class="i">+        }
</a><a href="#h4-0-11" id="h4-0-11" class="i">+    }
</a><a href="#h4-0-12" id="h4-0-12" class="i">+
</a><a href="#h4-0-13" id="h4-0-13" class="i">+    override fun setAutoUpdaterTime(time: Long) {
</a><a href="#h4-0-14" id="h4-0-14" class="i">+        writeFile(BridgeFileType.ANTI_AUTO_DOWNLOAD, time.toString().toByteArray())
</a><a href="#h4-0-15" id="h4-0-15" class="i">+    }
</a><a href="#h4-0-16" id="h4-0-16" class="i">+
</a>     override fun onServiceConnected(name: ComponentName, service: IBinder) {
         messenger = Messenger(service)
         future.complete(true)
<b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/file/BridgeFileType.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -7,7 +7,8 @@ enum class BridgeFileType(val value: Int, val fileName: String, val isDatabase: 
</a>     MESSAGE_LOGGER_DATABASE(2, &quot;message_logger.db&quot;, true),
     STEALTH(3, &quot;stealth.txt&quot;),
     ANTI_AUTO_DOWNLOAD(4, &quot;anti_auto_download.txt&quot;),
<a href="#h5-0-3" id="h5-0-3" class="d">-    ANTI_AUTO_SAVE(5, &quot;anti_auto_save.txt&quot;);
</a><a href="#h5-0-4" id="h5-0-4" class="i">+    ANTI_AUTO_SAVE(5, &quot;anti_auto_save.txt&quot;),
</a><a href="#h5-0-5" id="h5-0-5" class="i">+    AUTO_UPDATER_TIMESTAMP(6, &quot;auto_updater_timestamp.txt&quot;);
</a> 
     companion object {
         fun fromValue(value: Int): BridgeFileType? {
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -6,5 +6,6 @@ enum class ConfigCategory(
</a>     SPYING_PRIVACY(&quot;category.spying_privacy&quot;),
     MEDIA_MANAGEMENT(&quot;category.media_manager&quot;),
     UI_TWEAKS(&quot;category.ui_tweaks&quot;),
<a href="#h6-0-3" id="h6-0-3" class="i">+    UPDATES(&quot;category.updates&quot;),
</a>     EXPERIMENTAL_DEBUGGING(&quot;category.experimental_debugging&quot;);
 }
<b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -257,6 +257,17 @@ enum class ConfigProperty(
</a>         ConfigCategory.UI_TWEAKS,
         ConfigIntegerValue(20)
     ),
<a href="#h7-0-3" id="h7-0-3" class="i">+
</a><a href="#h7-0-4" id="h7-0-4" class="i">+    // UPDATES
</a><a href="#h7-0-5" id="h7-0-5" class="i">+    AUTO_UPDATER(
</a><a href="#h7-0-6" id="h7-0-6" class="i">+        &quot;property.auto_updater&quot;,
</a><a href="#h7-0-7" id="h7-0-7" class="i">+        &quot;description.auto_updater&quot;,
</a><a href="#h7-0-8" id="h7-0-8" class="i">+        ConfigCategory.UPDATES,
</a><a href="#h7-0-9" id="h7-0-9" class="i">+        ConfigStateSelection(
</a><a href="#h7-0-10" id="h7-0-10" class="i">+            listOf(&quot;DISABLED&quot;, &quot;EVERY_LAUNCH&quot;, &quot;DAILY&quot;, &quot;WEEKLY&quot;),
</a><a href="#h7-0-11" id="h7-0-11" class="i">+            &quot;DAILY&quot;
</a><a href="#h7-0-12" id="h7-0-12" class="i">+        )
</a><a href="#h7-0-13" id="h7-0-13" class="i">+    ),
</a>     
     // EXPERIMENTAL DEBUGGING
     USE_DOWNLOAD_MANAGER(
<b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,109 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+package me.rhunk.snapenhance.features.impl
</a><a href="#h8-0-1" id="h8-0-1" class="i">+
</a><a href="#h8-0-2" id="h8-0-2" class="i">+import android.annotation.SuppressLint
</a><a href="#h8-0-3" id="h8-0-3" class="i">+import android.app.AlertDialog
</a><a href="#h8-0-4" id="h8-0-4" class="i">+import android.app.DownloadManager
</a><a href="#h8-0-5" id="h8-0-5" class="i">+import android.content.BroadcastReceiver
</a><a href="#h8-0-6" id="h8-0-6" class="i">+import android.content.Context
</a><a href="#h8-0-7" id="h8-0-7" class="i">+import android.content.Intent
</a><a href="#h8-0-8" id="h8-0-8" class="i">+import android.content.IntentFilter
</a><a href="#h8-0-9" id="h8-0-9" class="i">+import android.net.Uri
</a><a href="#h8-0-10" id="h8-0-10" class="i">+import android.os.Environment
</a><a href="#h8-0-11" id="h8-0-11" class="i">+import me.rhunk.snapenhance.BuildConfig
</a><a href="#h8-0-12" id="h8-0-12" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h8-0-13" id="h8-0-13" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h8-0-14" id="h8-0-14" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h8-0-15" id="h8-0-15" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h8-0-16" id="h8-0-16" class="i">+import okhttp3.OkHttpClient
</a><a href="#h8-0-17" id="h8-0-17" class="i">+import okhttp3.Request
</a><a href="#h8-0-18" id="h8-0-18" class="i">+import org.json.JSONArray
</a><a href="#h8-0-19" id="h8-0-19" class="i">+
</a><a href="#h8-0-20" id="h8-0-20" class="i">+class AutoUpdater : Feature(&quot;AutoUpdater&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h8-0-21" id="h8-0-21" class="i">+    override fun asyncOnActivityCreate() {
</a><a href="#h8-0-22" id="h8-0-22" class="i">+        val checkForUpdateMode = context.config.state(ConfigProperty.AUTO_UPDATER)
</a><a href="#h8-0-23" id="h8-0-23" class="i">+        val currentTimeMillis = System.currentTimeMillis()
</a><a href="#h8-0-24" id="h8-0-24" class="i">+        val checkForUpdatesTimestamp = context.bridgeClient.getAutoUpdaterTime()
</a><a href="#h8-0-25" id="h8-0-25" class="i">+
</a><a href="#h8-0-26" id="h8-0-26" class="i">+        val delayTimestamp = when (checkForUpdateMode) {
</a><a href="#h8-0-27" id="h8-0-27" class="i">+            &quot;EVERY_LAUNCH&quot; -&gt; currentTimeMillis - checkForUpdatesTimestamp
</a><a href="#h8-0-28" id="h8-0-28" class="i">+            &quot;DAILY&quot; -&gt; 86400000L
</a><a href="#h8-0-29" id="h8-0-29" class="i">+            &quot;WEEKLY&quot; -&gt; 604800000L
</a><a href="#h8-0-30" id="h8-0-30" class="i">+            else -&gt; return
</a><a href="#h8-0-31" id="h8-0-31" class="i">+        }
</a><a href="#h8-0-32" id="h8-0-32" class="i">+
</a><a href="#h8-0-33" id="h8-0-33" class="i">+        if (checkForUpdatesTimestamp + delayTimestamp &gt; currentTimeMillis) return
</a><a href="#h8-0-34" id="h8-0-34" class="i">+
</a><a href="#h8-0-35" id="h8-0-35" class="i">+        runCatching {
</a><a href="#h8-0-36" id="h8-0-36" class="i">+            checkForUpdates()
</a><a href="#h8-0-37" id="h8-0-37" class="i">+        }.onFailure {
</a><a href="#h8-0-38" id="h8-0-38" class="i">+            Logger.error(&quot;Failed to check for updates: ${it.message}&quot;, it)
</a><a href="#h8-0-39" id="h8-0-39" class="i">+        }.onSuccess {
</a><a href="#h8-0-40" id="h8-0-40" class="i">+            context.bridgeClient.setAutoUpdaterTime(currentTimeMillis)
</a><a href="#h8-0-41" id="h8-0-41" class="i">+        }
</a><a href="#h8-0-42" id="h8-0-42" class="i">+    }
</a><a href="#h8-0-43" id="h8-0-43" class="i">+
</a><a href="#h8-0-44" id="h8-0-44" class="i">+    @SuppressLint(&quot;UnspecifiedRegisterReceiverFlag&quot;)
</a><a href="#h8-0-45" id="h8-0-45" class="i">+    fun checkForUpdates(): String? {
</a><a href="#h8-0-46" id="h8-0-46" class="i">+        val endpoint = Request.Builder().url(&quot;https://api.github.com/repos/rhunk/SnapEnhance/releases&quot;).build()
</a><a href="#h8-0-47" id="h8-0-47" class="i">+        val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h8-0-48" id="h8-0-48" class="i">+
</a><a href="#h8-0-49" id="h8-0-49" class="i">+        if (!response.isSuccessful) throw Throwable(&quot;Failed to fetch releases: ${response.code}&quot;)
</a><a href="#h8-0-50" id="h8-0-50" class="i">+
</a><a href="#h8-0-51" id="h8-0-51" class="i">+        val releases = JSONArray(response.body.string()).also {
</a><a href="#h8-0-52" id="h8-0-52" class="i">+            if (it.length() == 0) throw Throwable(&quot;No releases found&quot;)
</a><a href="#h8-0-53" id="h8-0-53" class="i">+        }
</a><a href="#h8-0-54" id="h8-0-54" class="i">+
</a><a href="#h8-0-55" id="h8-0-55" class="i">+        val latestRelease = releases.getJSONObject(0)
</a><a href="#h8-0-56" id="h8-0-56" class="i">+        val latestVersion = latestRelease.getString(&quot;tag_name&quot;)
</a><a href="#h8-0-57" id="h8-0-57" class="i">+        if (latestVersion.removePrefix(&quot;v&quot;) == BuildConfig.VERSION_NAME) return null
</a><a href="#h8-0-58" id="h8-0-58" class="i">+
</a><a href="#h8-0-59" id="h8-0-59" class="i">+        val releaseContentBody = latestRelease.getString(&quot;body&quot;)
</a><a href="#h8-0-60" id="h8-0-60" class="i">+        val downloadEndpoint = latestRelease.getJSONArray(&quot;assets&quot;).getJSONObject(0).getString(&quot;browser_download_url&quot;)
</a><a href="#h8-0-61" id="h8-0-61" class="i">+
</a><a href="#h8-0-62" id="h8-0-62" class="i">+        context.runOnUiThread {
</a><a href="#h8-0-63" id="h8-0-63" class="i">+            AlertDialog.Builder(context.mainActivity)
</a><a href="#h8-0-64" id="h8-0-64" class="i">+                .setTitle(context.translation.get(&quot;auto_updater.dialog_title&quot;))
</a><a href="#h8-0-65" id="h8-0-65" class="i">+                .setMessage(
</a><a href="#h8-0-66" id="h8-0-66" class="i">+                    context.translation.get(&quot;auto_updater.dialog_message&quot;)
</a><a href="#h8-0-67" id="h8-0-67" class="i">+                        .replace(&quot;{version}&quot;, latestVersion)
</a><a href="#h8-0-68" id="h8-0-68" class="i">+                        .replace(&quot;{body}&quot;, releaseContentBody)
</a><a href="#h8-0-69" id="h8-0-69" class="i">+                )
</a><a href="#h8-0-70" id="h8-0-70" class="i">+                .setNegativeButton(context.translation.get(&quot;auto_updater.dialog_negative_button&quot;)) { dialog, _ -&gt;
</a><a href="#h8-0-71" id="h8-0-71" class="i">+                    dialog.dismiss()
</a><a href="#h8-0-72" id="h8-0-72" class="i">+                }
</a><a href="#h8-0-73" id="h8-0-73" class="i">+                .setPositiveButton(context.translation.get(&quot;auto_updater.dialog_positive_button&quot;)) { dialog, _ -&gt;
</a><a href="#h8-0-74" id="h8-0-74" class="i">+                    dialog.dismiss()
</a><a href="#h8-0-75" id="h8-0-75" class="i">+                    context.longToast(context.translation.get(&quot;auto_updater.downloading_toast&quot;))
</a><a href="#h8-0-76" id="h8-0-76" class="i">+
</a><a href="#h8-0-77" id="h8-0-77" class="i">+                    val request = DownloadManager.Request(Uri.parse(downloadEndpoint))
</a><a href="#h8-0-78" id="h8-0-78" class="i">+                        .setTitle(context.translation.get(&quot;auto_updater.download_manager_notification_title&quot;))
</a><a href="#h8-0-79" id="h8-0-79" class="i">+                        .setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, &quot;latest-snapenhance.apk&quot;)
</a><a href="#h8-0-80" id="h8-0-80" class="i">+                        .setMimeType(&quot;application/vnd.android.package-archive&quot;)
</a><a href="#h8-0-81" id="h8-0-81" class="i">+                        .setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE)
</a><a href="#h8-0-82" id="h8-0-82" class="i">+
</a><a href="#h8-0-83" id="h8-0-83" class="i">+                    val downloadManager = context.androidContext.getSystemService(Context.DOWNLOAD_SERVICE) as DownloadManager
</a><a href="#h8-0-84" id="h8-0-84" class="i">+                    val downloadId = downloadManager.enqueue(request)
</a><a href="#h8-0-85" id="h8-0-85" class="i">+
</a><a href="#h8-0-86" id="h8-0-86" class="i">+                    val onCompleteReceiver = object: BroadcastReceiver() {
</a><a href="#h8-0-87" id="h8-0-87" class="i">+                        override fun onReceive(context: Context, intent: Intent) {
</a><a href="#h8-0-88" id="h8-0-88" class="i">+                            val id = intent.getLongExtra(DownloadManager.EXTRA_DOWNLOAD_ID, -1)
</a><a href="#h8-0-89" id="h8-0-89" class="i">+                            if (id != downloadId) return
</a><a href="#h8-0-90" id="h8-0-90" class="i">+                            context.unregisterReceiver(this)
</a><a href="#h8-0-91" id="h8-0-91" class="i">+                            context.startActivity(
</a><a href="#h8-0-92" id="h8-0-92" class="i">+                                Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h8-0-93" id="h8-0-93" class="i">+                                    setDataAndType(downloadManager.getUriForDownloadedFile(downloadId), &quot;application/vnd.android.package-archive&quot;)
</a><a href="#h8-0-94" id="h8-0-94" class="i">+                                    flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h8-0-95" id="h8-0-95" class="i">+                                }
</a><a href="#h8-0-96" id="h8-0-96" class="i">+                            )
</a><a href="#h8-0-97" id="h8-0-97" class="i">+                        }
</a><a href="#h8-0-98" id="h8-0-98" class="i">+                    }
</a><a href="#h8-0-99" id="h8-0-99" class="i">+
</a><a href="#h8-0-100" id="h8-0-100" class="i">+                    context.mainActivity?.registerReceiver(onCompleteReceiver, IntentFilter(
</a><a href="#h8-0-101" id="h8-0-101" class="i">+                        DownloadManager.ACTION_DOWNLOAD_COMPLETE
</a><a href="#h8-0-102" id="h8-0-102" class="i">+                    ))
</a><a href="#h8-0-103" id="h8-0-103" class="i">+                }.show()
</a><a href="#h8-0-104" id="h8-0-104" class="i">+        }
</a><a href="#h8-0-105" id="h8-0-105" class="i">+
</a><a href="#h8-0-106" id="h8-0-106" class="i">+        return latestVersion
</a><a href="#h8-0-107" id="h8-0-107" class="i">+    }
</a><a href="#h8-0-108" id="h8-0-108" class="i">+}</a><a href="#h8-0-109" id="h8-0-109" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -2,11 +2,13 @@ package me.rhunk.snapenhance.features.impl.ui.menus.impl
</a> 
 import android.annotation.SuppressLint
 import android.app.AlertDialog
<a href="#h9-0-3" id="h9-0-3" class="i">+import android.graphics.Color
</a> import android.graphics.Typeface
 import android.text.InputType
 import android.view.View
 import android.widget.Button
 import android.widget.EditText
<a href="#h9-0-9" id="h9-0-9" class="i">+import android.widget.LinearLayout
</a> import android.widget.Switch
 import android.widget.TextView
 import me.rhunk.snapenhance.BuildConfig
<a href="#h9-1" id="h9-1" class="h">@@ -163,6 +165,13 @@ class SettingsMenu : AbstractMenu() {
</a>         return resultView
     }
 
<a href="#h9-1-3" id="h9-1-3" class="i">+    private fun newSeparator(thickness: Int, color: Int = Color.BLACK): View {
</a><a href="#h9-1-4" id="h9-1-4" class="i">+        return LinearLayout(context.mainActivity).apply {
</a><a href="#h9-1-5" id="h9-1-5" class="i">+            setPadding(0, 0, 0, thickness)
</a><a href="#h9-1-6" id="h9-1-6" class="i">+            setBackgroundColor(color)
</a><a href="#h9-1-7" id="h9-1-7" class="i">+        }
</a><a href="#h9-1-8" id="h9-1-8" class="i">+    }
</a><a href="#h9-1-9" id="h9-1-9" class="i">+
</a>     @SuppressLint(&quot;SetTextI18n&quot;)
     @Suppress(&quot;deprecation&quot;)
     fun inject(viewModel: View, addView: (View) -&gt; Unit) {
<a href="#h9-2" id="h9-2" class="h">@@ -206,9 +215,10 @@ class SettingsMenu : AbstractMenu() {
</a>             }
         }
 
<a href="#h9-2-3" id="h9-2-3" class="d">-        //addView(createCategoryTitle(viewModel, &quot;category.debugging&quot;))
</a>         actions.filter { it.first.dependsOnProperty == null }.forEach {
             addView(it.second())
         }
<a href="#h9-2-7" id="h9-2-7" class="i">+
</a><a href="#h9-2-8" id="h9-2-8" class="i">+        addView(newSeparator(3, Color.parseColor(&quot;#f5f5f5&quot;)))
</a>     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -2,6 +2,7 @@ package me.rhunk.snapenhance.manager.impl
</a> 
 import me.rhunk.snapenhance.ModContext
 import me.rhunk.snapenhance.action.AbstractAction
<a href="#h10-0-3" id="h10-0-3" class="i">+import me.rhunk.snapenhance.action.impl.CheckForUpdates
</a> import me.rhunk.snapenhance.action.impl.CleanCache
 import me.rhunk.snapenhance.action.impl.ClearMessageLogger
 import me.rhunk.snapenhance.action.impl.OpenMap
<a href="#h10-1" id="h10-1" class="h">@@ -24,6 +25,7 @@ class ActionManager(
</a>         load(ClearMessageLogger::class)
         load(RefreshMappings::class)
         load(OpenMap::class)
<a href="#h10-1-3" id="h10-1-3" class="i">+        load(CheckForUpdates::class)
</a> 
         actions.values.forEach(AbstractAction::init)
     }
<b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -4,6 +4,7 @@ import me.rhunk.snapenhance.Logger
</a> import me.rhunk.snapenhance.ModContext
 import me.rhunk.snapenhance.features.Feature
 import me.rhunk.snapenhance.features.FeatureLoadParams
<a href="#h11-0-3" id="h11-0-3" class="i">+import me.rhunk.snapenhance.features.impl.AutoUpdater
</a> import me.rhunk.snapenhance.features.impl.ConfigEnumKeys
 import me.rhunk.snapenhance.features.impl.Messaging
 import me.rhunk.snapenhance.features.impl.downloader.AntiAutoDownload
<a href="#h11-1" id="h11-1" class="h">@@ -75,7 +76,7 @@ class FeatureManager(private val context: ModContext) : Manager {
</a>         register(MeoPasscodeBypass::class)
         register(AppPasscode::class)
         register(LocationSpoofer::class)
<a href="#h11-1-3" id="h11-1-3" class="d">-
</a><a href="#h11-1-4" id="h11-1-4" class="i">+        register(AutoUpdater::class)
</a> 
         initializeFeatures()
     }
<b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -74,7 +74,7 @@ class MappingManager(private val context: ModContext) : Manager {
</a> 
             val loadingDialog = statusDialogBuilder.show()
 
<a href="#h12-0-3" id="h12-0-3" class="d">-            thread(start = true) {
</a><a href="#h12-0-4" id="h12-0-4" class="i">+            context.executeAsync {
</a>                 runCatching {
                     refresh()
                 }.onSuccess {
</pre>
</div>
</body>
</html>
