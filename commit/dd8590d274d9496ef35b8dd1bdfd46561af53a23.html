<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat(composer_hooks): ts modules - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/dd8590d274d9496ef35b8dd1bdfd46561af53a23.html">dd8590d274d9496ef35b8dd1bdfd46561af53a23</a>
<b>parent</b> <a href="../commit/807ce1b6e7c4aadaf779cf87db2218f38b3ffcea.html">807ce1b6e7c4aadaf779cf87db2218f38b3ffcea</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Fri, 24 May 2024 02:06:01 +0200

feat(composer_hooks): ts modules

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">.github/workflows/debug.yml</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">.github/workflows/release.yml</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">composer/.gitignore</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h3">composer/build.gradle.kts</a></td><td> | </td><td class="num">34</td><td><span class="i">++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">composer/rollup.config.js</a></td><td> | </td><td class="num">8</td><td><span class="i">++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h5">composer/src/main/ts/composer.ts</a></td><td> | </td><td class="num">4</td><td><span class="i">++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">composer/src/main/ts/imports.ts</a></td><td> | </td><td class="num">21</td><td><span class="i">+++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">composer/src/main/ts/main.ts</a></td><td> | </td><td class="num">36</td><td><span class="i">++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">composer/src/main/ts/modules/bypassCameraRollSelectionLimit.ts</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h9">composer/src/main/ts/modules/firstCreatedUsername.ts</a></td><td> | </td><td class="num">29</td><td><span class="i">+++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">composer/src/main/ts/modules/operaDownloadButton.ts</a></td><td> | </td><td class="num">36</td><td><span class="i">++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h11">composer/src/main/ts/types.ts</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h12">composer/src/main/ts/utils.ts</a></td><td> | </td><td class="num">57</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">composer/tsconfig.json</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h14">composer/types/index.d.ts</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h15">core/build.gradle.kts</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h16">core/src/main/assets/composer/loader.js</a></td><td> | </td><td class="num">138</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/ComposerHooks.kt</a></td><td> | </td><td class="num">150</td><td><span class="i">++++++++++++++++++++++++++++++++++++++</span><span class="d">-----------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h18">settings.gradle.kts</a></td><td> | </td><td class="num">1</td><td><span class="i">+</span><span class="d"></span></td></tr>
</table></pre><pre>19 files changed, 395 insertions(+), 215 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/.github/workflows/debug.yml.html">.github/workflows/debug.yml</a> b/<a href="../file/.github/workflows/debug.yml.html">.github/workflows/debug.yml</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -26,6 +26,9 @@ jobs:
</a>       - name: Grant execute permission for gradlew
         run: chmod +x gradlew
 
<a href="#h0-0-3" id="h0-0-3" class="i">+      - name: Setup NPM Dependencies
</a><a href="#h0-0-4" id="h0-0-4" class="i">+        run: npm install typescript -g
</a><a href="#h0-0-5" id="h0-0-5" class="i">+
</a>       - name: Build
         run: ./gradlew assembleArmv8Debug
 
<a href="#h0-1" id="h0-1" class="h">@@ -70,6 +73,9 @@ jobs:
</a>       - name: Grant execute permission for gradlew
         run: chmod +x gradlew
 
<a href="#h0-1-3" id="h0-1-3" class="i">+      - name: Setup NPM Dependencies
</a><a href="#h0-1-4" id="h0-1-4" class="i">+        run: npm install typescript -g
</a><a href="#h0-1-5" id="h0-1-5" class="i">+
</a>       - name: Build
         run: ./gradlew assembleArmv7Debug
 
<a href="#h0-2" id="h0-2" class="h">@@ -114,6 +120,9 @@ jobs:
</a>       - name: Grant execute permission for gradlew
         run: chmod +x gradlew
 
<a href="#h0-2-3" id="h0-2-3" class="i">+      - name: Setup NPM Dependencies
</a><a href="#h0-2-4" id="h0-2-4" class="i">+        run: npm install typescript -g
</a><a href="#h0-2-5" id="h0-2-5" class="i">+
</a>       - name: Build
         run: ./gradlew assembleAllDebug
 
<b>diff --git a/<a id="h1" href="../file/.github/workflows/release.yml.html">.github/workflows/release.yml</a> b/<a href="../file/.github/workflows/release.yml.html">.github/workflows/release.yml</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -30,6 +30,9 @@ jobs:
</a>       - name: Grant execute permission for gradlew
         run: chmod +x gradlew
 
<a href="#h1-0-3" id="h1-0-3" class="i">+      - name: Setup NPM Dependencies
</a><a href="#h1-0-4" id="h1-0-4" class="i">+        run: npm install typescript -g
</a><a href="#h1-0-5" id="h1-0-5" class="i">+
</a>       - name: Build
         run: ./gradlew assembleArmv8Release
         
<a href="#h1-1" id="h1-1" class="h">@@ -73,6 +76,9 @@ jobs:
</a>       - name: Grant execute permission for gradlew
         run: chmod +x gradlew
 
<a href="#h1-1-3" id="h1-1-3" class="i">+      - name: Setup NPM Dependencies
</a><a href="#h1-1-4" id="h1-1-4" class="i">+        run: npm install typescript -g
</a><a href="#h1-1-5" id="h1-1-5" class="i">+
</a>       - name: Build
         run: ./gradlew assembleArmv7Release
 
<a href="#h1-2" id="h1-2" class="h">@@ -116,6 +122,9 @@ jobs:
</a>       - name: Grant execute permission for gradlew
         run: chmod +x gradlew
 
<a href="#h1-2-3" id="h1-2-3" class="i">+      - name: Setup NPM Dependencies
</a><a href="#h1-2-4" id="h1-2-4" class="i">+        run: npm install typescript -g
</a><a href="#h1-2-5" id="h1-2-5" class="i">+
</a>       - name: Build
         run: ./gradlew assembleAllRelease
         
<b>diff --git a/<a id="h2" href="../file/composer/.gitignore.html">composer/.gitignore</a> b/<a href="../file/composer/.gitignore.html">composer/.gitignore</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+/build</a><a href="#h2-0-1" id="h2-0-1" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/composer/build.gradle.kts.html">composer/build.gradle.kts</a> b/<a href="../file/composer/build.gradle.kts.html">composer/build.gradle.kts</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -0,0 +1,34 @@
</a><a href="#h3-0-0" id="h3-0-0" class="i">+plugins {
</a><a href="#h3-0-1" id="h3-0-1" class="i">+    alias(libs.plugins.androidLibrary)
</a><a href="#h3-0-2" id="h3-0-2" class="i">+    alias(libs.plugins.kotlinAndroid)
</a><a href="#h3-0-3" id="h3-0-3" class="i">+}
</a><a href="#h3-0-4" id="h3-0-4" class="i">+
</a><a href="#h3-0-5" id="h3-0-5" class="i">+android {
</a><a href="#h3-0-6" id="h3-0-6" class="i">+    namespace = rootProject.ext[&quot;applicationId&quot;].toString() + &quot;.composer&quot;
</a><a href="#h3-0-7" id="h3-0-7" class="i">+    compileSdk = 34
</a><a href="#h3-0-8" id="h3-0-8" class="i">+
</a><a href="#h3-0-9" id="h3-0-9" class="i">+    sourceSets {
</a><a href="#h3-0-10" id="h3-0-10" class="i">+        getByName(&quot;main&quot;) {
</a><a href="#h3-0-11" id="h3-0-11" class="i">+            assets.srcDirs(&quot;build/assets&quot;)
</a><a href="#h3-0-12" id="h3-0-12" class="i">+        }
</a><a href="#h3-0-13" id="h3-0-13" class="i">+    }
</a><a href="#h3-0-14" id="h3-0-14" class="i">+}
</a><a href="#h3-0-15" id="h3-0-15" class="i">+
</a><a href="#h3-0-16" id="h3-0-16" class="i">+task(&quot;compileTypeScript&quot;) {
</a><a href="#h3-0-17" id="h3-0-17" class="i">+    doLast {
</a><a href="#h3-0-18" id="h3-0-18" class="i">+        project.exec {
</a><a href="#h3-0-19" id="h3-0-19" class="i">+            commandLine(&quot;npx&quot;, &quot;--yes&quot;, &quot;tsc&quot;, &quot;--project&quot;, &quot;tsconfig.json&quot;)
</a><a href="#h3-0-20" id="h3-0-20" class="i">+        }
</a><a href="#h3-0-21" id="h3-0-21" class="i">+        project.exec {
</a><a href="#h3-0-22" id="h3-0-22" class="i">+            commandLine(&quot;npx&quot;, &quot;--yes&quot;, &quot;rollup&quot;, &quot;--config&quot;, &quot;rollup.config.js&quot;, &quot;--bundleConfigAsCjs&quot;)
</a><a href="#h3-0-23" id="h3-0-23" class="i">+        }
</a><a href="#h3-0-24" id="h3-0-24" class="i">+        project.copy {
</a><a href="#h3-0-25" id="h3-0-25" class="i">+            from(&quot;build/loader.js&quot;)
</a><a href="#h3-0-26" id="h3-0-26" class="i">+            into(&quot;build/assets/composer&quot;)
</a><a href="#h3-0-27" id="h3-0-27" class="i">+        }
</a><a href="#h3-0-28" id="h3-0-28" class="i">+    }
</a><a href="#h3-0-29" id="h3-0-29" class="i">+}
</a><a href="#h3-0-30" id="h3-0-30" class="i">+
</a><a href="#h3-0-31" id="h3-0-31" class="i">+tasks.named(&quot;preBuild&quot;).configure {
</a><a href="#h3-0-32" id="h3-0-32" class="i">+    dependsOn(&quot;compileTypeScript&quot;)
</a><a href="#h3-0-33" id="h3-0-33" class="i">+}
</a><b>diff --git a/<a id="h4" href="../file/composer/rollup.config.js.html">composer/rollup.config.js</a> b/<a href="../file/composer/rollup.config.js.html">composer/rollup.config.js</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,7 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+export default {
</a><a href="#h4-0-1" id="h4-0-1" class="i">+  input: &quot;./build/typescript/main.js&quot;,
</a><a href="#h4-0-2" id="h4-0-2" class="i">+  output: {
</a><a href="#h4-0-3" id="h4-0-3" class="i">+    file: &quot;./build/loader.js&quot;,
</a><a href="#h4-0-4" id="h4-0-4" class="i">+    format: &quot;iife&quot;,
</a><a href="#h4-0-5" id="h4-0-5" class="i">+  }
</a><a href="#h4-0-6" id="h4-0-6" class="i">+};</a><a href="#h4-0-7" id="h4-0-7" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/composer/src/main/ts/composer.ts.html">composer/src/main/ts/composer.ts</a> b/<a href="../file/composer/src/main/ts/composer.ts.html">composer/src/main/ts/composer.ts</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -0,0 +1,4 @@
</a><a href="#h5-0-0" id="h5-0-0" class="i">+export const jsx = require(&#39;composer_core/src/JSX&#39;).jsx;
</a><a href="#h5-0-1" id="h5-0-1" class="i">+export const assetCatalog = require(&quot;composer_core/src/AssetCatalog&quot;)
</a><a href="#h5-0-2" id="h5-0-2" class="i">+export const style = require(&quot;composer_core/src/Style&quot;);
</a><a href="#h5-0-3" id="h5-0-3" class="i">+export const colors = require(&quot;coreui/src/styles/semanticColors&quot;);
</a><b>diff --git a/<a id="h6" href="../file/composer/src/main/ts/imports.ts.html">composer/src/main/ts/imports.ts</a> b/<a href="../file/composer/src/main/ts/imports.ts.html">composer/src/main/ts/imports.ts</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,21 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+import { Config, FriendInfo } from &quot;./types&quot;;
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+declare var _getImportsFunctionName: string;
</a><a href="#h6-0-3" id="h6-0-3" class="i">+const remoteImports = require(&#39;composer_core/src/DeviceBridge&#39;)[_getImportsFunctionName]();
</a><a href="#h6-0-4" id="h6-0-4" class="i">+
</a><a href="#h6-0-5" id="h6-0-5" class="i">+function callRemoteFunction(method: string, ...args: any[]): any | null {
</a><a href="#h6-0-6" id="h6-0-6" class="i">+    return remoteImports[method](...args);
</a><a href="#h6-0-7" id="h6-0-7" class="i">+}
</a><a href="#h6-0-8" id="h6-0-8" class="i">+
</a><a href="#h6-0-9" id="h6-0-9" class="i">+
</a><a href="#h6-0-10" id="h6-0-10" class="i">+export const log = (logLevel: string, message: string) =&gt; callRemoteFunction(&quot;log&quot;, logLevel, message);
</a><a href="#h6-0-11" id="h6-0-11" class="i">+
</a><a href="#h6-0-12" id="h6-0-12" class="i">+export const getConfig = () =&gt; callRemoteFunction(&quot;getConfig&quot;) as Config;
</a><a href="#h6-0-13" id="h6-0-13" class="i">+
</a><a href="#h6-0-14" id="h6-0-14" class="i">+export const downloadLastOperaMedia = (isLongPress: boolean) =&gt; callRemoteFunction(&quot;downloadLastOperaMedia&quot;, isLongPress);
</a><a href="#h6-0-15" id="h6-0-15" class="i">+
</a><a href="#h6-0-16" id="h6-0-16" class="i">+export function getFriendInfoByUsername(username: string): FriendInfo | null {
</a><a href="#h6-0-17" id="h6-0-17" class="i">+    const friendInfo = callRemoteFunction(&quot;getFriendInfoByUsername&quot;, username);
</a><a href="#h6-0-18" id="h6-0-18" class="i">+    if (!friendInfo) return null;
</a><a href="#h6-0-19" id="h6-0-19" class="i">+    return JSON.parse(friendInfo);
</a><a href="#h6-0-20" id="h6-0-20" class="i">+}
</a><b>diff --git a/<a id="h7" href="../file/composer/src/main/ts/main.ts.html">composer/src/main/ts/main.ts</a> b/<a href="../file/composer/src/main/ts/main.ts.html">composer/src/main/ts/main.ts</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,36 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+import { getConfig, log } from &quot;./imports&quot;;
</a><a href="#h7-0-1" id="h7-0-1" class="i">+import { Module } from &quot;./types&quot;;
</a><a href="#h7-0-2" id="h7-0-2" class="i">+
</a><a href="#h7-0-3" id="h7-0-3" class="i">+import operaDownloadButton from &quot;./modules/operaDownloadButton&quot;;
</a><a href="#h7-0-4" id="h7-0-4" class="i">+import firstCreatedUsername from &quot;./modules/firstCreatedUsername&quot;;
</a><a href="#h7-0-5" id="h7-0-5" class="i">+import bypassCameraRollSelectionLimit from &quot;./modules/bypassCameraRollSelectionLimit&quot;;
</a><a href="#h7-0-6" id="h7-0-6" class="i">+
</a><a href="#h7-0-7" id="h7-0-7" class="i">+
</a><a href="#h7-0-8" id="h7-0-8" class="i">+try {
</a><a href="#h7-0-9" id="h7-0-9" class="i">+    const config = getConfig();
</a><a href="#h7-0-10" id="h7-0-10" class="i">+
</a><a href="#h7-0-11" id="h7-0-11" class="i">+    if (config.composerLogs) {
</a><a href="#h7-0-12" id="h7-0-12" class="i">+        [&quot;log&quot;, &quot;error&quot;, &quot;warn&quot;, &quot;info&quot;, &quot;debug&quot;].forEach(method =&gt; {
</a><a href="#h7-0-13" id="h7-0-13" class="i">+            console[method] = (...args: any) =&gt; log(method, Array.from(args).join(&quot; &quot;));
</a><a href="#h7-0-14" id="h7-0-14" class="i">+        })
</a><a href="#h7-0-15" id="h7-0-15" class="i">+    }
</a><a href="#h7-0-16" id="h7-0-16" class="i">+
</a><a href="#h7-0-17" id="h7-0-17" class="i">+    const modules: Module[] = [
</a><a href="#h7-0-18" id="h7-0-18" class="i">+        operaDownloadButton, 
</a><a href="#h7-0-19" id="h7-0-19" class="i">+        firstCreatedUsername,
</a><a href="#h7-0-20" id="h7-0-20" class="i">+        bypassCameraRollSelectionLimit
</a><a href="#h7-0-21" id="h7-0-21" class="i">+    ];
</a><a href="#h7-0-22" id="h7-0-22" class="i">+
</a><a href="#h7-0-23" id="h7-0-23" class="i">+    modules.forEach(module =&gt; {
</a><a href="#h7-0-24" id="h7-0-24" class="i">+        if (!module.enabled(config)) return
</a><a href="#h7-0-25" id="h7-0-25" class="i">+        try {
</a><a href="#h7-0-26" id="h7-0-26" class="i">+            module.init();
</a><a href="#h7-0-27" id="h7-0-27" class="i">+        } catch (e) {
</a><a href="#h7-0-28" id="h7-0-28" class="i">+            console.error(`failed to initialize module ${module.name}`, e, e.stack);
</a><a href="#h7-0-29" id="h7-0-29" class="i">+        }
</a><a href="#h7-0-30" id="h7-0-30" class="i">+    });
</a><a href="#h7-0-31" id="h7-0-31" class="i">+
</a><a href="#h7-0-32" id="h7-0-32" class="i">+    console.log(&quot;composer modules loaded!&quot;);
</a><a href="#h7-0-33" id="h7-0-33" class="i">+} catch (e) {
</a><a href="#h7-0-34" id="h7-0-34" class="i">+    log(&quot;error&quot;, &quot;Failed to load composer modules\n&quot; + e + &quot;\n&quot; + e.stack)
</a><a href="#h7-0-35" id="h7-0-35" class="i">+}
</a><b>diff --git a/<a id="h8" href="../file/composer/src/main/ts/modules/bypassCameraRollSelectionLimit.ts.html">composer/src/main/ts/modules/bypassCameraRollSelectionLimit.ts</a> b/<a href="../file/composer/src/main/ts/modules/bypassCameraRollSelectionLimit.ts.html">composer/src/main/ts/modules/bypassCameraRollSelectionLimit.ts</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,19 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+import { defineModule } from &quot;../types&quot;;
</a><a href="#h8-0-1" id="h8-0-1" class="i">+import { interceptComponent } from &quot;../utils&quot;;
</a><a href="#h8-0-2" id="h8-0-2" class="i">+
</a><a href="#h8-0-3" id="h8-0-3" class="i">+export default defineModule({
</a><a href="#h8-0-4" id="h8-0-4" class="i">+    name: &quot;Bypass Camera Roll Selection Limit&quot;,
</a><a href="#h8-0-5" id="h8-0-5" class="i">+    enabled: config =&gt; config.bypassCameraRollLimit,
</a><a href="#h8-0-6" id="h8-0-6" class="i">+    init() {
</a><a href="#h8-0-7" id="h8-0-7" class="i">+        interceptComponent(
</a><a href="#h8-0-8" id="h8-0-8" class="i">+            &#39;memories_ui/src/clickhandlers/MultiSelectClickHandler&#39;,
</a><a href="#h8-0-9" id="h8-0-9" class="i">+            &#39;MultiSelectClickHandler&#39;,
</a><a href="#h8-0-10" id="h8-0-10" class="i">+            {
</a><a href="#h8-0-11" id="h8-0-11" class="i">+                &quot;&lt;init&gt;&quot;: (args: any[], superCall: () =&gt; void) =&gt; {
</a><a href="#h8-0-12" id="h8-0-12" class="i">+                    args[1].selectionLimit = 9999999;
</a><a href="#h8-0-13" id="h8-0-13" class="i">+                    superCall();
</a><a href="#h8-0-14" id="h8-0-14" class="i">+                }
</a><a href="#h8-0-15" id="h8-0-15" class="i">+            }
</a><a href="#h8-0-16" id="h8-0-16" class="i">+        )
</a><a href="#h8-0-17" id="h8-0-17" class="i">+    }
</a><a href="#h8-0-18" id="h8-0-18" class="i">+});</a><a href="#h8-0-19" id="h8-0-19" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h9" href="../file/composer/src/main/ts/modules/firstCreatedUsername.ts.html">composer/src/main/ts/modules/firstCreatedUsername.ts</a> b/<a href="../file/composer/src/main/ts/modules/firstCreatedUsername.ts.html">composer/src/main/ts/modules/firstCreatedUsername.ts</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -0,0 +1,28 @@
</a><a href="#h9-0-0" id="h9-0-0" class="i">+import { defineModule } from &quot;../types&quot;;
</a><a href="#h9-0-1" id="h9-0-1" class="i">+import { getFriendInfoByUsername } from &quot;../imports&quot;;
</a><a href="#h9-0-2" id="h9-0-2" class="i">+import { interceptComponent } from &quot;../utils&quot;;
</a><a href="#h9-0-3" id="h9-0-3" class="i">+
</a><a href="#h9-0-4" id="h9-0-4" class="i">+export default defineModule({
</a><a href="#h9-0-5" id="h9-0-5" class="i">+    name: &quot;Show First Created Username&quot;,
</a><a href="#h9-0-6" id="h9-0-6" class="i">+    enabled: config =&gt; config.showFirstCreatedUsername,
</a><a href="#h9-0-7" id="h9-0-7" class="i">+    init() {
</a><a href="#h9-0-8" id="h9-0-8" class="i">+        interceptComponent(
</a><a href="#h9-0-9" id="h9-0-9" class="i">+            &#39;common_profile/src/identity/ProfileIdentityView&#39;,
</a><a href="#h9-0-10" id="h9-0-10" class="i">+            &#39;ProfileIdentityView&#39;,
</a><a href="#h9-0-11" id="h9-0-11" class="i">+            {
</a><a href="#h9-0-12" id="h9-0-12" class="i">+                onRender: (component: any, _args: any[], render: () =&gt; void) =&gt; {
</a><a href="#h9-0-13" id="h9-0-13" class="i">+                    if (component.viewModel) {
</a><a href="#h9-0-14" id="h9-0-14" class="i">+                        let userInfo = getFriendInfoByUsername(component.viewModel.username);
</a><a href="#h9-0-15" id="h9-0-15" class="i">+                        if (userInfo) {
</a><a href="#h9-0-16" id="h9-0-16" class="i">+                            let firstCreatedUsername = userInfo.username.split(&quot;|&quot;)[0];
</a><a href="#h9-0-17" id="h9-0-17" class="i">+                            if (firstCreatedUsername != component.viewModel.username) {
</a><a href="#h9-0-18" id="h9-0-18" class="i">+                                component.viewModel.username += &quot; (&quot; + firstCreatedUsername + &quot;)&quot;;
</a><a href="#h9-0-19" id="h9-0-19" class="i">+                            }
</a><a href="#h9-0-20" id="h9-0-20" class="i">+                        }
</a><a href="#h9-0-21" id="h9-0-21" class="i">+                    }
</a><a href="#h9-0-22" id="h9-0-22" class="i">+                    render();
</a><a href="#h9-0-23" id="h9-0-23" class="i">+                }
</a><a href="#h9-0-24" id="h9-0-24" class="i">+            }
</a><a href="#h9-0-25" id="h9-0-25" class="i">+        )
</a><a href="#h9-0-26" id="h9-0-26" class="i">+    }
</a><a href="#h9-0-27" id="h9-0-27" class="i">+});</a><a href="#h9-0-28" id="h9-0-28" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/composer/src/main/ts/modules/operaDownloadButton.ts.html">composer/src/main/ts/modules/operaDownloadButton.ts</a> b/<a href="../file/composer/src/main/ts/modules/operaDownloadButton.ts.html">composer/src/main/ts/modules/operaDownloadButton.ts</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,35 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+import { assetCatalog, jsx, style } from &quot;../composer&quot;
</a><a href="#h10-0-1" id="h10-0-1" class="i">+import { defineModule } from &quot;../types&quot;
</a><a href="#h10-0-2" id="h10-0-2" class="i">+import { downloadLastOperaMedia } from &quot;../imports&quot;
</a><a href="#h10-0-3" id="h10-0-3" class="i">+import { interceptComponent } from &quot;../utils&quot;
</a><a href="#h10-0-4" id="h10-0-4" class="i">+
</a><a href="#h10-0-5" id="h10-0-5" class="i">+
</a><a href="#h10-0-6" id="h10-0-6" class="i">+export default defineModule({
</a><a href="#h10-0-7" id="h10-0-7" class="i">+    name: &quot;Opera Download Button&quot;,
</a><a href="#h10-0-8" id="h10-0-8" class="i">+    enabled: config =&gt; config.operaDownloadButton,
</a><a href="#h10-0-9" id="h10-0-9" class="i">+    init() {
</a><a href="#h10-0-10" id="h10-0-10" class="i">+        const downloadIcon = assetCatalog.loadCatalog(&quot;share_sheet/res&quot;).downloadIcon
</a><a href="#h10-0-11" id="h10-0-11" class="i">+        interceptComponent(
</a><a href="#h10-0-12" id="h10-0-12" class="i">+            &#39;context_chrome_header/src/ChromeHeaderRenderer&#39;,
</a><a href="#h10-0-13" id="h10-0-13" class="i">+            &#39;ChromeHeaderRenderer&#39;,
</a><a href="#h10-0-14" id="h10-0-14" class="i">+            {
</a><a href="#h10-0-15" id="h10-0-15" class="i">+                onRenderBaseHeader: (_component: any, _args: any[], render: () =&gt; void) =&gt; {
</a><a href="#h10-0-16" id="h10-0-16" class="i">+                    render()
</a><a href="#h10-0-17" id="h10-0-17" class="i">+                    jsx.beginRender(jsx.makeNodePrototype(&quot;image&quot;))
</a><a href="#h10-0-18" id="h10-0-18" class="i">+                    jsx.setAttributeStyle(&quot;style&quot;, new style.Style({
</a><a href="#h10-0-19" id="h10-0-19" class="i">+                        height: 32,
</a><a href="#h10-0-20" id="h10-0-20" class="i">+                        marginTop: 4,
</a><a href="#h10-0-21" id="h10-0-21" class="i">+                        marginLeft: 8,
</a><a href="#h10-0-22" id="h10-0-22" class="i">+                        marginRight: 12,
</a><a href="#h10-0-23" id="h10-0-23" class="i">+                        objectFit: &quot;contain&quot;,
</a><a href="#h10-0-24" id="h10-0-24" class="i">+                        tint: &quot;white&quot;
</a><a href="#h10-0-25" id="h10-0-25" class="i">+                    }))
</a><a href="#h10-0-26" id="h10-0-26" class="i">+                    jsx.setAttribute(&quot;src&quot;, downloadIcon)
</a><a href="#h10-0-27" id="h10-0-27" class="i">+                    jsx.setAttributeFunction(&quot;onTap&quot;, () =&gt; downloadLastOperaMedia(false))
</a><a href="#h10-0-28" id="h10-0-28" class="i">+                    jsx.setAttributeFunction(&quot;onLongPress&quot;, () =&gt; downloadLastOperaMedia(true))
</a><a href="#h10-0-29" id="h10-0-29" class="i">+                    jsx.endRender()
</a><a href="#h10-0-30" id="h10-0-30" class="i">+                }
</a><a href="#h10-0-31" id="h10-0-31" class="i">+            }
</a><a href="#h10-0-32" id="h10-0-32" class="i">+        )
</a><a href="#h10-0-33" id="h10-0-33" class="i">+    }
</a><a href="#h10-0-34" id="h10-0-34" class="i">+})</a><a href="#h10-0-35" id="h10-0-35" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h11" href="../file/composer/src/main/ts/types.ts.html">composer/src/main/ts/types.ts</a> b/<a href="../file/composer/src/main/ts/types.ts.html">composer/src/main/ts/types.ts</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -0,0 +1,44 @@
</a><a href="#h11-0-0" id="h11-0-0" class="i">+export interface Config {
</a><a href="#h11-0-1" id="h11-0-1" class="i">+    readonly operaDownloadButton: boolean
</a><a href="#h11-0-2" id="h11-0-2" class="i">+    readonly bypassCameraRollLimit: boolean
</a><a href="#h11-0-3" id="h11-0-3" class="i">+    readonly showFirstCreatedUsername: boolean
</a><a href="#h11-0-4" id="h11-0-4" class="i">+    readonly composerLogs: boolean
</a><a href="#h11-0-5" id="h11-0-5" class="i">+}
</a><a href="#h11-0-6" id="h11-0-6" class="i">+
</a><a href="#h11-0-7" id="h11-0-7" class="i">+export interface FriendInfo {
</a><a href="#h11-0-8" id="h11-0-8" class="i">+    readonly id: number
</a><a href="#h11-0-9" id="h11-0-9" class="i">+    readonly lastModifiedTimestamp: number
</a><a href="#h11-0-10" id="h11-0-10" class="i">+    readonly username: string
</a><a href="#h11-0-11" id="h11-0-11" class="i">+    readonly userId: string
</a><a href="#h11-0-12" id="h11-0-12" class="i">+    readonly displayName: string
</a><a href="#h11-0-13" id="h11-0-13" class="i">+    readonly bitmojiAvatarId: string
</a><a href="#h11-0-14" id="h11-0-14" class="i">+    readonly bitmojiSelfieId: string
</a><a href="#h11-0-15" id="h11-0-15" class="i">+    readonly bitmojiSceneId: string
</a><a href="#h11-0-16" id="h11-0-16" class="i">+    readonly bitmojiBackgroundId: string
</a><a href="#h11-0-17" id="h11-0-17" class="i">+    readonly friendmojis: string
</a><a href="#h11-0-18" id="h11-0-18" class="i">+    readonly friendmojiCategories: string
</a><a href="#h11-0-19" id="h11-0-19" class="i">+    readonly snapScore: number
</a><a href="#h11-0-20" id="h11-0-20" class="i">+    readonly birthday: number
</a><a href="#h11-0-21" id="h11-0-21" class="i">+    readonly addedTimestamp: number
</a><a href="#h11-0-22" id="h11-0-22" class="i">+    readonly reverseAddedTimestamp: number
</a><a href="#h11-0-23" id="h11-0-23" class="i">+    readonly serverDisplayName: string
</a><a href="#h11-0-24" id="h11-0-24" class="i">+    readonly streakLength: number
</a><a href="#h11-0-25" id="h11-0-25" class="i">+    readonly streakExpirationTimestamp: number
</a><a href="#h11-0-26" id="h11-0-26" class="i">+    readonly reverseBestFriendRanking: number
</a><a href="#h11-0-27" id="h11-0-27" class="i">+    readonly isPinnedBestFriend: number
</a><a href="#h11-0-28" id="h11-0-28" class="i">+    readonly plusBadgeVisibility: number
</a><a href="#h11-0-29" id="h11-0-29" class="i">+    readonly usernameForSorting: string
</a><a href="#h11-0-30" id="h11-0-30" class="i">+    readonly friendLinkType: number
</a><a href="#h11-0-31" id="h11-0-31" class="i">+    readonly postViewEmoji: string
</a><a href="#h11-0-32" id="h11-0-32" class="i">+    readonly businessCategory: number
</a><a href="#h11-0-33" id="h11-0-33" class="i">+}
</a><a href="#h11-0-34" id="h11-0-34" class="i">+
</a><a href="#h11-0-35" id="h11-0-35" class="i">+export interface Module {
</a><a href="#h11-0-36" id="h11-0-36" class="i">+    readonly name: string
</a><a href="#h11-0-37" id="h11-0-37" class="i">+    enabled: (config: Config) =&gt; boolean
</a><a href="#h11-0-38" id="h11-0-38" class="i">+    init: () =&gt; void
</a><a href="#h11-0-39" id="h11-0-39" class="i">+}
</a><a href="#h11-0-40" id="h11-0-40" class="i">+
</a><a href="#h11-0-41" id="h11-0-41" class="i">+export function defineModule&lt;T extends Module&gt;(module: T &amp; Record&lt;string, any&gt;): T {
</a><a href="#h11-0-42" id="h11-0-42" class="i">+    return module
</a><a href="#h11-0-43" id="h11-0-43" class="i">+}
</a><b>diff --git a/<a id="h12" href="../file/composer/src/main/ts/utils.ts.html">composer/src/main/ts/utils.ts</a> b/<a href="../file/composer/src/main/ts/utils.ts.html">composer/src/main/ts/utils.ts</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -0,0 +1,57 @@
</a><a href="#h12-0-0" id="h12-0-0" class="i">+export function dumpObject(obj: any, indent = 0) {
</a><a href="#h12-0-1" id="h12-0-1" class="i">+    if (typeof obj !== &quot;object&quot;) return console.log(obj);
</a><a href="#h12-0-2" id="h12-0-2" class="i">+    let prefix = &quot;&quot;
</a><a href="#h12-0-3" id="h12-0-3" class="i">+    for (let i = 0; i &lt; indent; i++) {
</a><a href="#h12-0-4" id="h12-0-4" class="i">+        prefix += &quot;    &quot;;
</a><a href="#h12-0-5" id="h12-0-5" class="i">+    }
</a><a href="#h12-0-6" id="h12-0-6" class="i">+    for (let key of Object.keys(obj)) {
</a><a href="#h12-0-7" id="h12-0-7" class="i">+        try {
</a><a href="#h12-0-8" id="h12-0-8" class="i">+            console.log(prefix, key, typeof obj[key], obj[key]);
</a><a href="#h12-0-9" id="h12-0-9" class="i">+            if (key == &quot;renderer&quot;) continue
</a><a href="#h12-0-10" id="h12-0-10" class="i">+            if (typeof obj[key] === &quot;object&quot; &amp;&amp; indent &lt; 10) dumpObject(obj[key], indent + 1);
</a><a href="#h12-0-11" id="h12-0-11" class="i">+        } catch (e) {}
</a><a href="#h12-0-12" id="h12-0-12" class="i">+    }
</a><a href="#h12-0-13" id="h12-0-13" class="i">+}
</a><a href="#h12-0-14" id="h12-0-14" class="i">+
</a><a href="#h12-0-15" id="h12-0-15" class="i">+export function proxyProperty(module: any, functionName: string, handler: any) {
</a><a href="#h12-0-16" id="h12-0-16" class="i">+    if (!module || !module[functionName]) {
</a><a href="#h12-0-17" id="h12-0-17" class="i">+        console.warn(&quot;Function not found&quot;, functionName);
</a><a href="#h12-0-18" id="h12-0-18" class="i">+        return;
</a><a href="#h12-0-19" id="h12-0-19" class="i">+    }
</a><a href="#h12-0-20" id="h12-0-20" class="i">+    module[functionName] = new Proxy(module[functionName], {
</a><a href="#h12-0-21" id="h12-0-21" class="i">+        apply: (a, b, c) =&gt; handler(a, b, c),
</a><a href="#h12-0-22" id="h12-0-22" class="i">+        construct: (a, b, c) =&gt; handler(a, b, c)
</a><a href="#h12-0-23" id="h12-0-23" class="i">+    });
</a><a href="#h12-0-24" id="h12-0-24" class="i">+}
</a><a href="#h12-0-25" id="h12-0-25" class="i">+
</a><a href="#h12-0-26" id="h12-0-26" class="i">+export function interceptComponent(moduleName: string, className: string, functions: any) {
</a><a href="#h12-0-27" id="h12-0-27" class="i">+    proxyProperty(require(moduleName), className, (target: any, args: any[], newTarget: any) =&gt; {
</a><a href="#h12-0-28" id="h12-0-28" class="i">+        let initProxy = functions[&quot;&lt;init&gt;&quot;]
</a><a href="#h12-0-29" id="h12-0-29" class="i">+        let component: any;
</a><a href="#h12-0-30" id="h12-0-30" class="i">+
</a><a href="#h12-0-31" id="h12-0-31" class="i">+        if (initProxy) {
</a><a href="#h12-0-32" id="h12-0-32" class="i">+            initProxy(args, (newArgs: any[]) =&gt; {
</a><a href="#h12-0-33" id="h12-0-33" class="i">+                component = Reflect.construct(target, newArgs || args, newTarget);
</a><a href="#h12-0-34" id="h12-0-34" class="i">+            });
</a><a href="#h12-0-35" id="h12-0-35" class="i">+        } else {
</a><a href="#h12-0-36" id="h12-0-36" class="i">+            component = Reflect.construct(target, args, newTarget);
</a><a href="#h12-0-37" id="h12-0-37" class="i">+        }
</a><a href="#h12-0-38" id="h12-0-38" class="i">+
</a><a href="#h12-0-39" id="h12-0-39" class="i">+        for (let funcName of Object.keys(functions)) {
</a><a href="#h12-0-40" id="h12-0-40" class="i">+            if (funcName == &quot;&lt;init&gt;&quot; || !component[funcName]) continue
</a><a href="#h12-0-41" id="h12-0-41" class="i">+            proxyProperty(component, funcName, (target: any, thisArg: any, argumentsList: any[]) =&gt; {
</a><a href="#h12-0-42" id="h12-0-42" class="i">+                let result: any;
</a><a href="#h12-0-43" id="h12-0-43" class="i">+                try {
</a><a href="#h12-0-44" id="h12-0-44" class="i">+                    functions[funcName](component, argumentsList, (newArgs: any[]) =&gt; {
</a><a href="#h12-0-45" id="h12-0-45" class="i">+                        result = Reflect.apply(target, thisArg, newArgs || argumentsList);
</a><a href="#h12-0-46" id="h12-0-46" class="i">+                    });
</a><a href="#h12-0-47" id="h12-0-47" class="i">+                } catch (e) {
</a><a href="#h12-0-48" id="h12-0-48" class="i">+                    console.error(&quot;Error in&quot;, funcName, e);
</a><a href="#h12-0-49" id="h12-0-49" class="i">+                }
</a><a href="#h12-0-50" id="h12-0-50" class="i">+                return result;
</a><a href="#h12-0-51" id="h12-0-51" class="i">+            });
</a><a href="#h12-0-52" id="h12-0-52" class="i">+        }
</a><a href="#h12-0-53" id="h12-0-53" class="i">+
</a><a href="#h12-0-54" id="h12-0-54" class="i">+        return component;
</a><a href="#h12-0-55" id="h12-0-55" class="i">+    })
</a><a href="#h12-0-56" id="h12-0-56" class="i">+}
</a><b>diff --git a/<a id="h13" href="../file/composer/tsconfig.json.html">composer/tsconfig.json</a> b/<a href="../file/composer/tsconfig.json.html">composer/tsconfig.json</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,8 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+{
</a><a href="#h13-0-1" id="h13-0-1" class="i">+  &quot;compilerOptions&quot;: {
</a><a href="#h13-0-2" id="h13-0-2" class="i">+    &quot;outDir&quot;: &quot;build/typescript&quot;,
</a><a href="#h13-0-3" id="h13-0-3" class="i">+    &quot;target&quot;: &quot;ES6&quot;,
</a><a href="#h13-0-4" id="h13-0-4" class="i">+    &quot;typeRoots&quot;: [&quot;types/*&quot;]
</a><a href="#h13-0-5" id="h13-0-5" class="i">+  },
</a><a href="#h13-0-6" id="h13-0-6" class="i">+  &quot;include&quot;: [&quot;./src/main/ts/**/*&quot;, &quot;./types/**/*&quot;]
</a><a href="#h13-0-7" id="h13-0-7" class="i">+}</a><a href="#h13-0-8" id="h13-0-8" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/composer/types/index.d.ts.html">composer/types/index.d.ts</a> b/<a href="../file/composer/types/index.d.ts.html">composer/types/index.d.ts</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -0,0 +1 @@
</a><a href="#h14-0-0" id="h14-0-0" class="i">+declare function require(module: string): any;</a><a href="#h14-0-1" id="h14-0-1" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/core/build.gradle.kts.html">core/build.gradle.kts</a> b/<a href="../file/core/build.gradle.kts.html">core/build.gradle.kts</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -41,6 +41,7 @@ dependencies {
</a>     implementation(project(&quot;:common&quot;))
     implementation(project(&quot;:mapper&quot;))
     implementation(project(&quot;:native&quot;))
<a href="#h15-0-3" id="h15-0-3" class="i">+    implementation(project(&quot;:composer&quot;))
</a> 
     implementation(libs.androidx.activity.ktx)
     implementation(platform(libs.androidx.compose.bom))
<b>diff --git a/<a id="h16" href="../file/core/src/main/assets/composer/loader.js.html">core/src/main/assets/composer/loader.js</a> b/<a href="../file/core/src/main/assets/composer/loader.js.html">core/src/main/assets/composer/loader.js</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -1,138 +0,0 @@
</a><a href="#h16-0-0" id="h16-0-0" class="d">-const config = callExport(&quot;getConfig&quot;);
</a><a href="#h16-0-1" id="h16-0-1" class="d">-
</a><a href="#h16-0-2" id="h16-0-2" class="d">-if (config.composerLogs) {
</a><a href="#h16-0-3" id="h16-0-3" class="d">-    [&quot;log&quot;, &quot;error&quot;, &quot;warn&quot;, &quot;info&quot;, &quot;debug&quot;].forEach(method =&gt; {
</a><a href="#h16-0-4" id="h16-0-4" class="d">-        console[method] = (...args) =&gt; callExport(&quot;log&quot;, method, Array.from(args).join(&quot; &quot;));
</a><a href="#h16-0-5" id="h16-0-5" class="d">-    })
</a><a href="#h16-0-6" id="h16-0-6" class="d">-
</a><a href="#h16-0-7" id="h16-0-7" class="d">-    console.stacktrace = () =&gt; new Error().stack;
</a><a href="#h16-0-8" id="h16-0-8" class="d">-    console.info(&quot;loader.js loaded&quot;);
</a><a href="#h16-0-9" id="h16-0-9" class="d">-}
</a><a href="#h16-0-10" id="h16-0-10" class="d">-
</a><a href="#h16-0-11" id="h16-0-11" class="d">-// Composer imports
</a><a href="#h16-0-12" id="h16-0-12" class="d">-
</a><a href="#h16-0-13" id="h16-0-13" class="d">-const jsx = require(&#39;composer_core/src/JSX&#39;).jsx;
</a><a href="#h16-0-14" id="h16-0-14" class="d">-const assetCatalog = require(&quot;composer_core/src/AssetCatalog&quot;)
</a><a href="#h16-0-15" id="h16-0-15" class="d">-const style = require(&quot;composer_core/src/Style&quot;);
</a><a href="#h16-0-16" id="h16-0-16" class="d">-const colors = require(&quot;coreui/src/styles/semanticColors&quot;);
</a><a href="#h16-0-17" id="h16-0-17" class="d">-
</a><a href="#h16-0-18" id="h16-0-18" class="d">-function dumpObject(obj, indent = 0) {
</a><a href="#h16-0-19" id="h16-0-19" class="d">-    if (typeof obj !== &quot;object&quot;) return console.log(obj);
</a><a href="#h16-0-20" id="h16-0-20" class="d">-    let prefix = &quot;&quot;
</a><a href="#h16-0-21" id="h16-0-21" class="d">-    for (let i = 0; i &lt; indent; i++) {
</a><a href="#h16-0-22" id="h16-0-22" class="d">-        prefix += &quot;    &quot;;
</a><a href="#h16-0-23" id="h16-0-23" class="d">-    }
</a><a href="#h16-0-24" id="h16-0-24" class="d">-    for (let key of Object.keys(obj)) {
</a><a href="#h16-0-25" id="h16-0-25" class="d">-        try {
</a><a href="#h16-0-26" id="h16-0-26" class="d">-            console.log(prefix, key, typeof obj[key], obj[key]);
</a><a href="#h16-0-27" id="h16-0-27" class="d">-            if (key == &quot;renderer&quot;) continue
</a><a href="#h16-0-28" id="h16-0-28" class="d">-            if (typeof obj[key] === &quot;object&quot; &amp;&amp; indent &lt; 10) dumpObject(obj[key], indent + 1);
</a><a href="#h16-0-29" id="h16-0-29" class="d">-        } catch (e) {
</a><a href="#h16-0-30" id="h16-0-30" class="d">-        }
</a><a href="#h16-0-31" id="h16-0-31" class="d">-    }
</a><a href="#h16-0-32" id="h16-0-32" class="d">-}
</a><a href="#h16-0-33" id="h16-0-33" class="d">-
</a><a href="#h16-0-34" id="h16-0-34" class="d">-function proxyProperty(module, functionName, handler) {
</a><a href="#h16-0-35" id="h16-0-35" class="d">-    if (!module || !module[functionName]) {
</a><a href="#h16-0-36" id="h16-0-36" class="d">-        console.warn(&quot;Function not found&quot;, functionName);
</a><a href="#h16-0-37" id="h16-0-37" class="d">-        return;
</a><a href="#h16-0-38" id="h16-0-38" class="d">-    }
</a><a href="#h16-0-39" id="h16-0-39" class="d">-    module[functionName] = new Proxy(module[functionName], {
</a><a href="#h16-0-40" id="h16-0-40" class="d">-        apply: (a, b, c) =&gt; handler(a, b, c),
</a><a href="#h16-0-41" id="h16-0-41" class="d">-        construct: (a, b, c) =&gt; handler(a, b, c)
</a><a href="#h16-0-42" id="h16-0-42" class="d">-    });
</a><a href="#h16-0-43" id="h16-0-43" class="d">-}
</a><a href="#h16-0-44" id="h16-0-44" class="d">-
</a><a href="#h16-0-45" id="h16-0-45" class="d">-function interceptComponent(moduleName, className, functions) {
</a><a href="#h16-0-46" id="h16-0-46" class="d">-    proxyProperty(require(moduleName), className, (target, args, newTarget) =&gt; {
</a><a href="#h16-0-47" id="h16-0-47" class="d">-        let initProxy = functions[&quot;&lt;init&gt;&quot;]
</a><a href="#h16-0-48" id="h16-0-48" class="d">-        let component;
</a><a href="#h16-0-49" id="h16-0-49" class="d">-
</a><a href="#h16-0-50" id="h16-0-50" class="d">-        if (initProxy) {
</a><a href="#h16-0-51" id="h16-0-51" class="d">-            initProxy(args, (newArgs) =&gt; {
</a><a href="#h16-0-52" id="h16-0-52" class="d">-                component = Reflect.construct(target, newArgs || args, newTarget);
</a><a href="#h16-0-53" id="h16-0-53" class="d">-            });
</a><a href="#h16-0-54" id="h16-0-54" class="d">-        } else {
</a><a href="#h16-0-55" id="h16-0-55" class="d">-            component = Reflect.construct(target, args, newTarget);
</a><a href="#h16-0-56" id="h16-0-56" class="d">-        }
</a><a href="#h16-0-57" id="h16-0-57" class="d">-
</a><a href="#h16-0-58" id="h16-0-58" class="d">-        for (let funcName of Object.keys(functions)) {
</a><a href="#h16-0-59" id="h16-0-59" class="d">-            if (funcName == &quot;&lt;init&gt;&quot; || !component[funcName]) continue
</a><a href="#h16-0-60" id="h16-0-60" class="d">-            proxyProperty(component, funcName, (target, thisArg, argumentsList) =&gt; {
</a><a href="#h16-0-61" id="h16-0-61" class="d">-                let result;
</a><a href="#h16-0-62" id="h16-0-62" class="d">-                try {
</a><a href="#h16-0-63" id="h16-0-63" class="d">-                    functions[funcName](component, argumentsList, (newArgs) =&gt; {
</a><a href="#h16-0-64" id="h16-0-64" class="d">-                        result = Reflect.apply(target, thisArg, newArgs || argumentsList);
</a><a href="#h16-0-65" id="h16-0-65" class="d">-                    });
</a><a href="#h16-0-66" id="h16-0-66" class="d">-                } catch (e) {
</a><a href="#h16-0-67" id="h16-0-67" class="d">-                    console.error(&quot;Error in&quot;, funcName, e);
</a><a href="#h16-0-68" id="h16-0-68" class="d">-                }
</a><a href="#h16-0-69" id="h16-0-69" class="d">-                return result;
</a><a href="#h16-0-70" id="h16-0-70" class="d">-            });
</a><a href="#h16-0-71" id="h16-0-71" class="d">-        }
</a><a href="#h16-0-72" id="h16-0-72" class="d">-
</a><a href="#h16-0-73" id="h16-0-73" class="d">-        return component;
</a><a href="#h16-0-74" id="h16-0-74" class="d">-    })
</a><a href="#h16-0-75" id="h16-0-75" class="d">-}
</a><a href="#h16-0-76" id="h16-0-76" class="d">-
</a><a href="#h16-0-77" id="h16-0-77" class="d">-if (config.bypassCameraRollLimit) {
</a><a href="#h16-0-78" id="h16-0-78" class="d">-    interceptComponent(
</a><a href="#h16-0-79" id="h16-0-79" class="d">-        &#39;memories_ui/src/clickhandlers/MultiSelectClickHandler&#39;,
</a><a href="#h16-0-80" id="h16-0-80" class="d">-        &#39;MultiSelectClickHandler&#39;,
</a><a href="#h16-0-81" id="h16-0-81" class="d">-        {
</a><a href="#h16-0-82" id="h16-0-82" class="d">-            &quot;&lt;init&gt;&quot;: (args, superCall) =&gt; {
</a><a href="#h16-0-83" id="h16-0-83" class="d">-                args[1].selectionLimit = 9999999;
</a><a href="#h16-0-84" id="h16-0-84" class="d">-                superCall();
</a><a href="#h16-0-85" id="h16-0-85" class="d">-            }
</a><a href="#h16-0-86" id="h16-0-86" class="d">-        }
</a><a href="#h16-0-87" id="h16-0-87" class="d">-    )
</a><a href="#h16-0-88" id="h16-0-88" class="d">-}
</a><a href="#h16-0-89" id="h16-0-89" class="d">-
</a><a href="#h16-0-90" id="h16-0-90" class="d">-if (config.operaDownloadButton) {
</a><a href="#h16-0-91" id="h16-0-91" class="d">-    const downloadIcon = assetCatalog.loadCatalog(&quot;share_sheet/res&quot;).downloadIcon
</a><a href="#h16-0-92" id="h16-0-92" class="d">-
</a><a href="#h16-0-93" id="h16-0-93" class="d">-    interceptComponent(
</a><a href="#h16-0-94" id="h16-0-94" class="d">-        &#39;context_chrome_header/src/ChromeHeaderRenderer&#39;,
</a><a href="#h16-0-95" id="h16-0-95" class="d">-        &#39;ChromeHeaderRenderer&#39;,
</a><a href="#h16-0-96" id="h16-0-96" class="d">-        {
</a><a href="#h16-0-97" id="h16-0-97" class="d">-            onRenderBaseHeader: (component, args, render) =&gt; {
</a><a href="#h16-0-98" id="h16-0-98" class="d">-                render()
</a><a href="#h16-0-99" id="h16-0-99" class="d">-                jsx.beginRender(jsx.makeNodePrototype(&quot;image&quot;))
</a><a href="#h16-0-100" id="h16-0-100" class="d">-                jsx.setAttributeStyle(&quot;style&quot;, new style.Style({
</a><a href="#h16-0-101" id="h16-0-101" class="d">-                    height: 32,
</a><a href="#h16-0-102" id="h16-0-102" class="d">-                    marginTop: 4,
</a><a href="#h16-0-103" id="h16-0-103" class="d">-                    marginLeft: 8,
</a><a href="#h16-0-104" id="h16-0-104" class="d">-                    marginRight: 12,
</a><a href="#h16-0-105" id="h16-0-105" class="d">-                    objectFit: &quot;contain&quot;,
</a><a href="#h16-0-106" id="h16-0-106" class="d">-                    tint: &quot;white&quot;
</a><a href="#h16-0-107" id="h16-0-107" class="d">-                }))
</a><a href="#h16-0-108" id="h16-0-108" class="d">-                jsx.setAttribute(&quot;src&quot;, downloadIcon)
</a><a href="#h16-0-109" id="h16-0-109" class="d">-                jsx.setAttributeFunction(&quot;onTap&quot;, () =&gt; callExport(&quot;downloadLastOperaMedia&quot;, false))
</a><a href="#h16-0-110" id="h16-0-110" class="d">-                jsx.setAttributeFunction(&quot;onLongPress&quot;, () =&gt; callExport(&quot;downloadLastOperaMedia&quot;, true))
</a><a href="#h16-0-111" id="h16-0-111" class="d">-                jsx.endRender()
</a><a href="#h16-0-112" id="h16-0-112" class="d">-            }
</a><a href="#h16-0-113" id="h16-0-113" class="d">-        }
</a><a href="#h16-0-114" id="h16-0-114" class="d">-    )
</a><a href="#h16-0-115" id="h16-0-115" class="d">-}
</a><a href="#h16-0-116" id="h16-0-116" class="d">-
</a><a href="#h16-0-117" id="h16-0-117" class="d">-if (config.showFirstCreatedUsername) {
</a><a href="#h16-0-118" id="h16-0-118" class="d">-    interceptComponent(
</a><a href="#h16-0-119" id="h16-0-119" class="d">-        &#39;common_profile/src/identity/ProfileIdentityView&#39;,
</a><a href="#h16-0-120" id="h16-0-120" class="d">-        &#39;ProfileIdentityView&#39;,
</a><a href="#h16-0-121" id="h16-0-121" class="d">-        {
</a><a href="#h16-0-122" id="h16-0-122" class="d">-            onRender: (component, _, render) =&gt; {
</a><a href="#h16-0-123" id="h16-0-123" class="d">-                if (component.viewModel) {
</a><a href="#h16-0-124" id="h16-0-124" class="d">-                    let userInfo = callExport(&quot;getFriendInfoByUsername&quot;, component.viewModel.username);
</a><a href="#h16-0-125" id="h16-0-125" class="d">-                    if (userInfo) {
</a><a href="#h16-0-126" id="h16-0-126" class="d">-                        let userInfoJson = JSON.parse(userInfo);
</a><a href="#h16-0-127" id="h16-0-127" class="d">-                        let firstCreatedUsername = userInfoJson.username.split(&quot;|&quot;)[0];
</a><a href="#h16-0-128" id="h16-0-128" class="d">-                        if (firstCreatedUsername != component.viewModel.username) {
</a><a href="#h16-0-129" id="h16-0-129" class="d">-                            component.viewModel.username += &quot; (&quot; + firstCreatedUsername + &quot;)&quot;;
</a><a href="#h16-0-130" id="h16-0-130" class="d">-                        }
</a><a href="#h16-0-131" id="h16-0-131" class="d">-                    }
</a><a href="#h16-0-132" id="h16-0-132" class="d">-                }
</a><a href="#h16-0-133" id="h16-0-133" class="d">-                render();
</a><a href="#h16-0-134" id="h16-0-134" class="d">-            }
</a><a href="#h16-0-135" id="h16-0-135" class="d">-        }
</a><a href="#h16-0-136" id="h16-0-136" class="d">-    )
</a><a href="#h16-0-137" id="h16-0-137" class="d">-}
</a><b>diff --git a/<a id="h17" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/ComposerHooks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/ComposerHooks.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/ComposerHooks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/features/impl/experiments/ComposerHooks.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -44,7 +44,7 @@ import kotlin.random.Random
</a> 
 class ComposerHooks: Feature(&quot;ComposerHooks&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
     private val config by lazy { context.config.experimental.nativeHooks.composerHooks }
<a href="#h17-0-3" id="h17-0-3" class="d">-    private val exportedFunctionName = Random.nextInt().absoluteValue.toString(16)
</a><a href="#h17-0-4" id="h17-0-4" class="i">+    private val getImportsFunctionName = Random.nextLong().absoluteValue.toString(16)
</a> 
     private val composerConsole by lazy {
         createComposeAlertDialog(context.mainActivity!!) {
<a href="#h17-1" id="h17-1" class="h">@@ -126,7 +126,7 @@ class ComposerHooks: Feature(&quot;ComposerHooks&quot;, loadParams = FeatureLoadParams.INI
</a>         }
     }
 
<a href="#h17-1-3" id="h17-1-3" class="d">-    private fun newComposerFunction(block: (composerMarshaller: ComposerMarshaller) -&gt; Boolean): Any {
</a><a href="#h17-1-4" id="h17-1-4" class="i">+    private fun newComposerFunction(block: ComposerMarshaller.() -&gt; Boolean): Any? {
</a>         val composerFunctionClass = findClass(&quot;com.snap.composer.callable.ComposerFunction&quot;)
         return Proxy.newProxyInstance(
             composerFunctionClass.classLoader,
<a href="#h17-2" id="h17-2" class="h">@@ -137,101 +137,97 @@ class ComposerHooks: Feature(&quot;ComposerHooks&quot;, loadParams = FeatureLoadParams.INI
</a>         }
     }
 
<a href="#h17-2-3" id="h17-2-3" class="d">-    private fun getConfig(): Map&lt;String, Any&gt; {
</a><a href="#h17-2-4" id="h17-2-4" class="d">-        return mapOf&lt;String, Any&gt;(
</a><a href="#h17-2-5" id="h17-2-5" class="d">-            &quot;operaDownloadButton&quot; to context.config.downloader.operaDownloadButton.get(),
</a><a href="#h17-2-6" id="h17-2-6" class="d">-            &quot;bypassCameraRollLimit&quot; to config.bypassCameraRollLimit.get(),
</a><a href="#h17-2-7" id="h17-2-7" class="d">-            &quot;showFirstCreatedUsername&quot; to config.showFirstCreatedUsername.get(),
</a><a href="#h17-2-8" id="h17-2-8" class="d">-            &quot;composerConsole&quot; to config.composerConsole.get(),
</a><a href="#h17-2-9" id="h17-2-9" class="d">-            &quot;composerLogs&quot; to config.composerLogs.get()
</a><a href="#h17-2-10" id="h17-2-10" class="d">-        )
</a><a href="#h17-2-11" id="h17-2-11" class="d">-    }
</a><a href="#h17-2-12" id="h17-2-12" class="i">+    @Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h17-2-13" id="h17-2-13" class="i">+    override fun init() {
</a><a href="#h17-2-14" id="h17-2-14" class="i">+        if (config.globalState != true) return
</a> 
<a href="#h17-2-16" id="h17-2-16" class="d">-    private fun handleExportCall(composerMarshaller: ComposerMarshaller): Boolean {
</a><a href="#h17-2-17" id="h17-2-17" class="d">-        val argc = composerMarshaller.getSize()
</a><a href="#h17-2-18" id="h17-2-18" class="d">-        if (argc &lt; 1) return false
</a><a href="#h17-2-19" id="h17-2-19" class="d">-        val action = composerMarshaller.getUntyped(0) as? String ?: return false
</a><a href="#h17-2-20" id="h17-2-20" class="i">+        val importedFunctions = mutableMapOf&lt;String, Any?&gt;()
</a> 
<a href="#h17-2-22" id="h17-2-22" class="d">-        when (action) {
</a><a href="#h17-2-23" id="h17-2-23" class="d">-            &quot;getConfig&quot; -&gt; composerMarshaller.pushUntyped(getConfig())
</a><a href="#h17-2-24" id="h17-2-24" class="d">-            &quot;showToast&quot; -&gt; {
</a><a href="#h17-2-25" id="h17-2-25" class="d">-                if (argc &lt; 2) return false
</a><a href="#h17-2-26" id="h17-2-26" class="d">-                context.shortToast(composerMarshaller.getUntyped(1) as? String ?: return false)
</a><a href="#h17-2-27" id="h17-2-27" class="i">+        fun composerFunction(name: String, block: ComposerMarshaller.() -&gt; Unit) {
</a><a href="#h17-2-28" id="h17-2-28" class="i">+            importedFunctions[name] = newComposerFunction {
</a><a href="#h17-2-29" id="h17-2-29" class="i">+                block(this)
</a><a href="#h17-2-30" id="h17-2-30" class="i">+                true
</a>             }
<a href="#h17-2-32" id="h17-2-32" class="d">-            &quot;downloadLastOperaMedia&quot; -&gt; context.feature(MediaDownloader::class).downloadLastOperaMediaAsync(composerMarshaller.getUntyped(1) == true)
</a><a href="#h17-2-33" id="h17-2-33" class="d">-            &quot;getFriendInfoByUsername&quot; -&gt; {
</a><a href="#h17-2-34" id="h17-2-34" class="d">-                if (argc &lt; 2) return false
</a><a href="#h17-2-35" id="h17-2-35" class="d">-                val username = composerMarshaller.getUntyped(1) as? String ?: return false
</a><a href="#h17-2-36" id="h17-2-36" class="d">-                runCatching {
</a><a href="#h17-2-37" id="h17-2-37" class="d">-                    composerMarshaller.pushUntyped(context.database.getFriendInfoByUsername(username)?.let {
</a><a href="#h17-2-38" id="h17-2-38" class="d">-                        context.gson.toJson(it)
</a><a href="#h17-2-39" id="h17-2-39" class="d">-                    })
</a><a href="#h17-2-40" id="h17-2-40" class="d">-                }.onFailure {
</a><a href="#h17-2-41" id="h17-2-41" class="d">-                    composerMarshaller.pushUntyped(null)
</a><a href="#h17-2-42" id="h17-2-42" class="d">-                }
</a><a href="#h17-2-43" id="h17-2-43" class="d">-            }
</a><a href="#h17-2-44" id="h17-2-44" class="d">-            &quot;log&quot; -&gt; {
</a><a href="#h17-2-45" id="h17-2-45" class="d">-                if (argc &lt; 3) return false
</a><a href="#h17-2-46" id="h17-2-46" class="d">-                val logLevel = composerMarshaller.getUntyped(1) as? String ?: return false
</a><a href="#h17-2-47" id="h17-2-47" class="d">-                val message = composerMarshaller.getUntyped(2) as? String ?: return false
</a><a href="#h17-2-48" id="h17-2-48" class="d">-
</a><a href="#h17-2-49" id="h17-2-49" class="d">-                val tag = &quot;ComposerLogs&quot;
</a><a href="#h17-2-50" id="h17-2-50" class="d">-
</a><a href="#h17-2-51" id="h17-2-51" class="d">-                when (logLevel) {
</a><a href="#h17-2-52" id="h17-2-52" class="d">-                    &quot;log&quot; -&gt; context.log.verbose(message, tag)
</a><a href="#h17-2-53" id="h17-2-53" class="d">-                    &quot;debug&quot; -&gt; context.log.debug(message, tag)
</a><a href="#h17-2-54" id="h17-2-54" class="d">-                    &quot;info&quot; -&gt; context.log.info(message, tag)
</a><a href="#h17-2-55" id="h17-2-55" class="d">-                    &quot;warn&quot; -&gt; context.log.warn(message, tag)
</a><a href="#h17-2-56" id="h17-2-56" class="d">-                    &quot;error&quot; -&gt; context.log.error(message, tag)
</a><a href="#h17-2-57" id="h17-2-57" class="d">-                }
</a><a href="#h17-2-58" id="h17-2-58" class="d">-            }
</a><a href="#h17-2-59" id="h17-2-59" class="d">-            else -&gt; context.log.warn(&quot;Unknown action: $action&quot;, &quot;Composer&quot;)
</a>         }
 
<a href="#h17-2-62" id="h17-2-62" class="d">-        return true
</a><a href="#h17-2-63" id="h17-2-63" class="d">-    }
</a><a href="#h17-2-64" id="h17-2-64" class="i">+        composerFunction(&quot;getConfig&quot;) {
</a><a href="#h17-2-65" id="h17-2-65" class="i">+            pushUntyped(mapOf&lt;String, Any&gt;(
</a><a href="#h17-2-66" id="h17-2-66" class="i">+                &quot;operaDownloadButton&quot; to context.config.downloader.operaDownloadButton.get(),
</a><a href="#h17-2-67" id="h17-2-67" class="i">+                &quot;bypassCameraRollLimit&quot; to config.bypassCameraRollLimit.get(),
</a><a href="#h17-2-68" id="h17-2-68" class="i">+                &quot;showFirstCreatedUsername&quot; to config.showFirstCreatedUsername.get(),
</a><a href="#h17-2-69" id="h17-2-69" class="i">+                &quot;composerLogs&quot; to config.composerLogs.get()
</a><a href="#h17-2-70" id="h17-2-70" class="i">+            ))
</a><a href="#h17-2-71" id="h17-2-71" class="i">+        }
</a> 
<a href="#h17-2-73" id="h17-2-73" class="d">-    private fun loadHooks() {
</a><a href="#h17-2-74" id="h17-2-74" class="d">-        if (!NativeLib.initialized) {
</a><a href="#h17-2-75" id="h17-2-75" class="d">-            context.log.error(&quot;ComposerHooks cannot be loaded without NativeLib&quot;)
</a><a href="#h17-2-76" id="h17-2-76" class="d">-            return
</a><a href="#h17-2-77" id="h17-2-77" class="i">+        composerFunction(&quot;showToast&quot;) {
</a><a href="#h17-2-78" id="h17-2-78" class="i">+            if (getSize() &lt; 1) return@composerFunction
</a><a href="#h17-2-79" id="h17-2-79" class="i">+            context.shortToast(getUntyped(0) as? String ?: return@composerFunction)
</a>         }
<a href="#h17-2-81" id="h17-2-81" class="d">-        val loaderScript = context.scriptRuntime.scripting.getScriptContent(&quot;composer/loader.js&quot;)?.let { pfd -&gt;
</a><a href="#h17-2-82" id="h17-2-82" class="d">-            ParcelFileDescriptor.AutoCloseInputStream(pfd).use {
</a><a href="#h17-2-83" id="h17-2-83" class="d">-                it.readBytes().toString(Charsets.UTF_8)
</a><a href="#h17-2-84" id="h17-2-84" class="i">+
</a><a href="#h17-2-85" id="h17-2-85" class="i">+        composerFunction(&quot;downloadLastOperaMedia&quot;) {
</a><a href="#h17-2-86" id="h17-2-86" class="i">+            context.feature(MediaDownloader::class).downloadLastOperaMediaAsync(getUntyped(0) == true)
</a><a href="#h17-2-87" id="h17-2-87" class="i">+        }
</a><a href="#h17-2-88" id="h17-2-88" class="i">+
</a><a href="#h17-2-89" id="h17-2-89" class="i">+        composerFunction(&quot;getFriendInfoByUsername&quot;) {
</a><a href="#h17-2-90" id="h17-2-90" class="i">+            if (getSize() &lt; 1) return@composerFunction
</a><a href="#h17-2-91" id="h17-2-91" class="i">+            val username = getUntyped(0) as? String ?: return@composerFunction
</a><a href="#h17-2-92" id="h17-2-92" class="i">+            runCatching {
</a><a href="#h17-2-93" id="h17-2-93" class="i">+                pushUntyped(context.database.getFriendInfoByUsername(username)?.let {
</a><a href="#h17-2-94" id="h17-2-94" class="i">+                    context.gson.toJson(it)
</a><a href="#h17-2-95" id="h17-2-95" class="i">+                })
</a><a href="#h17-2-96" id="h17-2-96" class="i">+            }.onFailure {
</a><a href="#h17-2-97" id="h17-2-97" class="i">+                pushUntyped(null)
</a>             }
<a href="#h17-2-99" id="h17-2-99" class="d">-        } ?: run {
</a><a href="#h17-2-100" id="h17-2-100" class="d">-            context.log.error(&quot;Failed to load composer loader script&quot;)
</a><a href="#h17-2-101" id="h17-2-101" class="d">-            return
</a>         }
 
<a href="#h17-2-104" id="h17-2-104" class="d">-        context.native.setComposerLoader(&quot;&quot;&quot;
</a><a href="#h17-2-105" id="h17-2-105" class="d">-            (() =&gt; { const callExport = require(&#39;composer_core/src/DeviceBridge&#39;)[&quot;$exportedFunctionName&quot;]; try { $loaderScript
</a><a href="#h17-2-106" id="h17-2-106" class="d">-                } catch (e) {
</a><a href="#h17-2-107" id="h17-2-107" class="d">-                    try {
</a><a href="#h17-2-108" id="h17-2-108" class="d">-                        callExport(&quot;log&quot;, &quot;error&quot;, e.toString() + &quot;\n&quot; + e.stack);
</a><a href="#h17-2-109" id="h17-2-109" class="d">-                    } catch (t) {}
</a><a href="#h17-2-110" id="h17-2-110" class="i">+        composerFunction(&quot;log&quot;) {
</a><a href="#h17-2-111" id="h17-2-111" class="i">+            if (getSize() &lt; 2) return@composerFunction
</a><a href="#h17-2-112" id="h17-2-112" class="i">+            val logLevel = getUntyped(0) as? String ?: return@composerFunction
</a><a href="#h17-2-113" id="h17-2-113" class="i">+            val message = getUntyped(1) as? String ?: return@composerFunction
</a><a href="#h17-2-114" id="h17-2-114" class="i">+
</a><a href="#h17-2-115" id="h17-2-115" class="i">+            val tag = &quot;ComposerLogs&quot;
</a><a href="#h17-2-116" id="h17-2-116" class="i">+
</a><a href="#h17-2-117" id="h17-2-117" class="i">+            when (logLevel) {
</a><a href="#h17-2-118" id="h17-2-118" class="i">+                &quot;log&quot; -&gt; context.log.verbose(message, tag)
</a><a href="#h17-2-119" id="h17-2-119" class="i">+                &quot;debug&quot; -&gt; context.log.debug(message, tag)
</a><a href="#h17-2-120" id="h17-2-120" class="i">+                &quot;info&quot; -&gt; context.log.info(message, tag)
</a><a href="#h17-2-121" id="h17-2-121" class="i">+                &quot;warn&quot; -&gt; context.log.warn(message, tag)
</a><a href="#h17-2-122" id="h17-2-122" class="i">+                &quot;error&quot; -&gt; context.log.error(message, tag)
</a><a href="#h17-2-123" id="h17-2-123" class="i">+            }
</a><a href="#h17-2-124" id="h17-2-124" class="i">+        }
</a><a href="#h17-2-125" id="h17-2-125" class="i">+
</a><a href="#h17-2-126" id="h17-2-126" class="i">+        fun loadHooks() {
</a><a href="#h17-2-127" id="h17-2-127" class="i">+            if (!NativeLib.initialized) {
</a><a href="#h17-2-128" id="h17-2-128" class="i">+                context.log.error(&quot;ComposerHooks cannot be loaded without NativeLib&quot;)
</a><a href="#h17-2-129" id="h17-2-129" class="i">+                return
</a><a href="#h17-2-130" id="h17-2-130" class="i">+            }
</a><a href="#h17-2-131" id="h17-2-131" class="i">+            val loaderScript = context.scriptRuntime.scripting.getScriptContent(&quot;composer/loader.js&quot;)?.let { pfd -&gt;
</a><a href="#h17-2-132" id="h17-2-132" class="i">+                ParcelFileDescriptor.AutoCloseInputStream(pfd).use {
</a><a href="#h17-2-133" id="h17-2-133" class="i">+                    it.readBytes().toString(Charsets.UTF_8)
</a>                 }
<a href="#h17-2-135" id="h17-2-135" class="d">-            })();
</a><a href="#h17-2-136" id="h17-2-136" class="d">-        &quot;&quot;&quot;.trimIndent().trim())
</a><a href="#h17-2-137" id="h17-2-137" class="i">+            } ?: run {
</a><a href="#h17-2-138" id="h17-2-138" class="i">+                context.log.error(&quot;Failed to load composer loader script&quot;)
</a><a href="#h17-2-139" id="h17-2-139" class="i">+                return
</a><a href="#h17-2-140" id="h17-2-140" class="i">+            }
</a><a href="#h17-2-141" id="h17-2-141" class="i">+            context.native.setComposerLoader(&quot;&quot;&quot;
</a><a href="#h17-2-142" id="h17-2-142" class="i">+                (() =&gt; { const _getImportsFunctionName = &quot;$getImportsFunctionName&quot;; $loaderScript })();
</a><a href="#h17-2-143" id="h17-2-143" class="i">+            &quot;&quot;&quot;.trimIndent().trim())
</a> 
<a href="#h17-2-145" id="h17-2-145" class="d">-        if (config.composerConsole.get()) {
</a><a href="#h17-2-146" id="h17-2-146" class="d">-            injectConsole()
</a><a href="#h17-2-147" id="h17-2-147" class="i">+            if (config.composerConsole.get()) {
</a><a href="#h17-2-148" id="h17-2-148" class="i">+                injectConsole()
</a><a href="#h17-2-149" id="h17-2-149" class="i">+            }
</a>         }
<a href="#h17-2-151" id="h17-2-151" class="d">-    }
</a> 
<a href="#h17-2-153" id="h17-2-153" class="d">-    @Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h17-2-154" id="h17-2-154" class="d">-    override fun init() {
</a><a href="#h17-2-155" id="h17-2-155" class="d">-        if (config.globalState != true) return
</a>         findClass(&quot;com.snapchat.client.composer.NativeBridge&quot;).apply {
             hook(&quot;createViewLoaderManager&quot;, HookStage.AFTER) { loadHooks() }
             hook(&quot;registerNativeModuleFactory&quot;, HookStage.BEFORE) { param -&gt;
                 val moduleFactory = param.argNullable&lt;Any&gt;(1) ?: return@hook
                 if (moduleFactory.javaClass.getMethod(&quot;getModulePath&quot;).invoke(moduleFactory)?.toString() != &quot;DeviceBridge&quot;) return@hook
                 Hooker.ephemeralHookObjectMethod(moduleFactory.javaClass, moduleFactory, &quot;loadModule&quot;, HookStage.AFTER) { methodParam -&gt;
<a href="#h17-2-162" id="h17-2-162" class="d">-                    val functions = methodParam.getResult() as? MutableMap&lt;String, Any&gt; ?: return@ephemeralHookObjectMethod
</a><a href="#h17-2-163" id="h17-2-163" class="d">-                    functions[exportedFunctionName] = newComposerFunction {
</a><a href="#h17-2-164" id="h17-2-164" class="d">-                        handleExportCall(it)
</a><a href="#h17-2-165" id="h17-2-165" class="i">+                    val result = methodParam.getResult() as? MutableMap&lt;String, Any?&gt; ?: return@ephemeralHookObjectMethod
</a><a href="#h17-2-166" id="h17-2-166" class="i">+                    result[getImportsFunctionName] = newComposerFunction {
</a><a href="#h17-2-167" id="h17-2-167" class="i">+                        pushUntyped(importedFunctions)
</a><a href="#h17-2-168" id="h17-2-168" class="i">+                        true
</a>                     }
                 }
             }
<b>diff --git a/<a id="h18" href="../file/settings.gradle.kts.html">settings.gradle.kts</a> b/<a href="../file/settings.gradle.kts.html">settings.gradle.kts</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -20,6 +20,7 @@ dependencyResolutionManagement {
</a> rootProject.name = &quot;SnapEnhance&quot;
 include(&quot;:common&quot;)
 include(&quot;:core&quot;)
<a href="#h18-0-3" id="h18-0-3" class="i">+include(&quot;:composer&quot;)
</a> include(&quot;:app&quot;)
 include(&quot;:mapper&quot;)
 include(&quot;:native&quot;)
</pre>
</div>
</body>
</html>
