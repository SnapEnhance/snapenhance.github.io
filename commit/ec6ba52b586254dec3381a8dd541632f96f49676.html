<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>core subproject - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/ec6ba52b586254dec3381a8dd541632f96f49676.html">ec6ba52b586254dec3381a8dd541632f96f49676</a>
<b>parent</b> <a href="../commit/4e8dff949f1c67eb4bdd122198c869206b02e9a9.html">4e8dff949f1c67eb4bdd122198c869206b02e9a9</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Thu, 27 Jul 2023 17:12:33 +0200

core subproject

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/build.gradle.kts</a></td><td> | </td><td class="num">28</td><td><span class="i">+++</span><span class="d">-------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/Logger.kt</a></td><td> | </td><td class="num">43</td><td><span class="i"></span><span class="d">-------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></td><td> | </td><td class="num">122</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a></td><td> | </td><td class="num">24</td><td><span class="i"></span><span class="d">------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></td><td> | </td><td class="num">126</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></td><td> | </td><td class="num">111</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a></td><td> | </td><td class="num">11</td><td><span class="i">+++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a></td><td> | </td><td class="num">42</td><td><span class="i"></span><span class="d">------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a></td><td> | </td><td class="num">85</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt</a></td><td> | </td><td class="num">280</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt</a></td><td> | </td><td class="num">114</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt</a></td><td> | </td><td class="num">243</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt</a></td><td> | </td><td class="num">215</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h13">app/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt</a></td><td> | </td><td class="num">98</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h14">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a></td><td> | </td><td class="num">87</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h15">app/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt</a></td><td> | </td><td class="num">112</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h16">app/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a></td><td> | </td><td class="num">338</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">build.gradle.kts</a></td><td> | </td><td class="num">3</td><td><span class="i">+++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h18">core/.gitignore</a></td><td> | </td><td class="num">16</td><td><span class="i">++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h19">core/build.gradle.kts</a></td><td> | </td><td class="num">45</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h20">app/libs/LSPosed-api-1.0-SNAPSHOT-javadoc.jar -&gt; core/libs/LSPosed-api-1.0-SNAPSHOT-javadoc.jar</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h21">app/libs/LSPosed-api-1.0-SNAPSHOT-sources.jar -&gt; core/libs/LSPosed-api-1.0-SNAPSHOT-sources.jar</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h22">app/libs/LSPosed-api-1.0-SNAPSHOT.jar -&gt; core/libs/LSPosed-api-1.0-SNAPSHOT.jar</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h23">app/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl -&gt; core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h24">app/src/main/aidl/me/rhunk/snapenhance/bridge/DownloadCallback.aidl -&gt; core/src/main/aidl/me/rhunk/snapenhance/bridge/DownloadCallback.aidl</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h25">app/src/main/assets/lang/ar_SA.json -&gt; core/src/main/assets/lang/ar_SA.json</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h26">app/src/main/assets/lang/en_US.json -&gt; core/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h27">app/src/main/assets/lang/fr_FR.json -&gt; core/src/main/assets/lang/fr_FR.json</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h28">app/src/main/assets/lang/hi_IN.json -&gt; core/src/main/assets/lang/hi_IN.json</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h29">app/src/main/assets/web/export_template.html -&gt; core/src/main/assets/web/export_template.html</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h30">app/src/main/assets/web/rawinflate.js -&gt; core/src/main/assets/web/rawinflate.js</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h31">app/src/main/assets/xposed_init -&gt; core/src/main/assets/xposed_init</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h32">app/src/main/kotlin/me/rhunk/snapenhance/Constants.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/Constants.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h33">core/src/main/kotlin/me/rhunk/snapenhance/Logger.kt</a></td><td> | </td><td class="num">44</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h34">app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h35">app/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h36">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></td><td> | </td><td class="num">123</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h37">app/src/main/kotlin/me/rhunk/snapenhance/XposedLoader.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/XposedLoader.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h38">app/src/main/kotlin/me/rhunk/snapenhance/action/AbstractAction.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/action/AbstractAction.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h39">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h40">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CleanCache.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/action/impl/CleanCache.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h41">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/ClearMessageLogger.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ClearMessageLogger.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h42">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h43">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a></td><td> | </td><td class="num">24</td><td><span class="i">++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h44">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/RefreshMappings.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/action/impl/RefreshMappings.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h45">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></td><td> | </td><td class="num">126</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h46">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h47">app/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h48">app/src/main/kotlin/me/rhunk/snapenhance/bridge/types/BridgeFileType.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/bridge/types/BridgeFileType.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h49">app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/ConfigWrapper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/ConfigWrapper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h50">app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/MessageLoggerWrapper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/MessageLoggerWrapper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h51">app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/TranslationWrapper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/TranslationWrapper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h52">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigAccessor.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigAccessor.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h53">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h54">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h55">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h56">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h57">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h58">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h59">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h60">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h61">app/src/main/kotlin/me/rhunk/snapenhance/data/FileType.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/FileType.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h62">app/src/main/kotlin/me/rhunk/snapenhance/data/LocalePair.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/LocalePair.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h63">app/src/main/kotlin/me/rhunk/snapenhance/data/MessageSender.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/MessageSender.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h64">app/src/main/kotlin/me/rhunk/snapenhance/data/SnapClassCache.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/SnapClassCache.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h65">app/src/main/kotlin/me/rhunk/snapenhance/data/SnapEnums.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/SnapEnums.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h66">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/AbstractWrapper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/AbstractWrapper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h67">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h68">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h69">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h70">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h71">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h72">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h73">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/ScSize.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/ScSize.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h74">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h75">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h76">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/EncryptionWrapper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/EncryptionWrapper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h77">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h78">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/LongformVideoPlaylistItem.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/LongformVideoPlaylistItem.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h79">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapChapter.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapChapter.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h80">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapPlaylistItem.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapPlaylistItem.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h81">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/Layer.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/Layer.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h82">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/LayerController.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/LayerController.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h83">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h84">app/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h85">app/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseObject.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseObject.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h86">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h87">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h88">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h89">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h90">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h91">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadManagerClient.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadManagerClient.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h92">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h93">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h94">app/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadMetadata.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadMetadata.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h95">app/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadRequest.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadRequest.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h96">app/src/main/kotlin/me/rhunk/snapenhance/download/data/MediaEncryptionKeyPair.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/data/MediaEncryptionKeyPair.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h97">app/src/main/kotlin/me/rhunk/snapenhance/download/data/PendingDownload.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/data/PendingDownload.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h98">app/src/main/kotlin/me/rhunk/snapenhance/download/data/SplitMediaAssetType.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/data/SplitMediaAssetType.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h99">app/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadMediaType.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadMediaType.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h100">app/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadStage.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadStage.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h101">app/src/main/kotlin/me/rhunk/snapenhance/event/EventBus.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/event/EventBus.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h102">app/src/main/kotlin/me/rhunk/snapenhance/event/Events.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/event/Events.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h103">app/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h104">app/src/main/kotlin/me/rhunk/snapenhance/features/Feature.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/Feature.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h105">app/src/main/kotlin/me/rhunk/snapenhance/features/FeatureLoadParams.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/FeatureLoadParams.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h106">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></td><td> | </td><td class="num">111</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h107">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h108">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h109">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h110">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h111">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h112">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h113">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h114">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h115">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h116">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h117">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h118">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h119">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h120">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h121">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h122">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h123">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h124">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h125">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h126">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h127">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h128">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h129">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h130">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h131">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h132">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h133">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h134">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h135">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h136">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h137">app/src/main/kotlin/me/rhunk/snapenhance/hook/HookAdapter.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/hook/HookAdapter.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h138">app/src/main/kotlin/me/rhunk/snapenhance/hook/HookStage.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/hook/HookStage.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h139">app/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h140">app/src/main/kotlin/me/rhunk/snapenhance/manager/Manager.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/manager/Manager.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h141">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a></td><td> | </td><td class="num">42</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h142">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h143">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h144">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h145">core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a></td><td> | </td><td class="num">85</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h146">app/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h147">core/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt</a></td><td> | </td><td class="num">280</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h148">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt</a></td><td> | </td><td class="num">114</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h149">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt</a></td><td> | </td><td class="num">243</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h150">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt</a></td><td> | </td><td class="num">215</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h151">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/MediaFilter.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ui/download/MediaFilter.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h152">core/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt</a></td><td> | </td><td class="num">98</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h153">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/AbstractMenu.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/AbstractMenu.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h154">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h155">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h156">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h157">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/OperaContextActionMenu.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/OperaContextActionMenu.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h158">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a></td><td> | </td><td class="num">87</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h159">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsMenu.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsMenu.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h160">core/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt</a></td><td> | </td><td class="num">112</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h161">app/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h162">app/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h163">app/src/main/kotlin/me/rhunk/snapenhance/util/CallbackBuilder.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/CallbackBuilder.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h164">app/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h165">app/src/main/kotlin/me/rhunk/snapenhance/util/SQLiteDatabaseHelper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/SQLiteDatabaseHelper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h166">app/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperMacros.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperMacros.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h167">app/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h168">app/src/main/kotlin/me/rhunk/snapenhance/util/download/RemoteMediaResolver.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/download/RemoteMediaResolver.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h169">core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a></td><td> | </td><td class="num">338</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h170">app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoEditor.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoEditor.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h171">app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoReader.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoReader.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h172">app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoWriter.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoWriter.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h173">app/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h174">app/src/main/kotlin/me/rhunk/snapenhance/util/snap/EncryptionHelper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/snap/EncryptionHelper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h175">app/src/main/kotlin/me/rhunk/snapenhance/util/snap/MediaDownloaderHelper.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/snap/MediaDownloaderHelper.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h176">app/src/main/kotlin/me/rhunk/snapenhance/util/snap/PreviewUtils.kt -&gt; core/src/main/kotlin/me/rhunk/snapenhance/util/snap/PreviewUtils.kt</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h177">app/src/main/res/drawable/action_button_cancel.xml -&gt; core/src/main/res/drawable/action_button_cancel.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h178">app/src/main/res/drawable/action_button_success.xml -&gt; core/src/main/res/drawable/action_button_success.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h179">app/src/main/res/drawable/back_arrow.xml -&gt; core/src/main/res/drawable/back_arrow.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h180">app/src/main/res/drawable/bitmoji_blank.xml -&gt; core/src/main/res/drawable/bitmoji_blank.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h181">app/src/main/res/drawable/debug_settings_icon.xml -&gt; core/src/main/res/drawable/debug_settings_icon.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h182">app/src/main/res/drawable/download_manager_item_background.xml -&gt; core/src/main/res/drawable/download_manager_item_background.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h183">app/src/main/res/drawable/settings_icon.xml -&gt; core/src/main/res/drawable/settings_icon.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h184">app/src/main/res/font/avenir_next_bold.ttf -&gt; core/src/main/res/font/avenir_next_bold.ttf</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h185">app/src/main/res/font/avenir_next_medium.ttf -&gt; core/src/main/res/font/avenir_next_medium.ttf</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h186">app/src/main/res/layout/activity_default_header.xml -&gt; core/src/main/res/layout/activity_default_header.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h187">app/src/main/res/layout/config_activity.xml -&gt; core/src/main/res/layout/config_activity.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h188">app/src/main/res/layout/config_activity_debug_item.xml -&gt; core/src/main/res/layout/config_activity_debug_item.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h189">app/src/main/res/layout/config_activity_item.xml -&gt; core/src/main/res/layout/config_activity_item.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h190">app/src/main/res/layout/debug_setting_item.xml -&gt; core/src/main/res/layout/debug_setting_item.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h191">app/src/main/res/layout/debug_settings_page.xml -&gt; core/src/main/res/layout/debug_settings_page.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h192">app/src/main/res/layout/device_spoofer_activity.xml -&gt; core/src/main/res/layout/device_spoofer_activity.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h193">app/src/main/res/layout/download_manager_activity.xml -&gt; core/src/main/res/layout/download_manager_activity.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h194">app/src/main/res/layout/download_manager_item.xml -&gt; core/src/main/res/layout/download_manager_item.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h195">app/src/main/res/layout/map.xml -&gt; core/src/main/res/layout/map.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h196">app/src/main/res/layout/precise_location_dialog.xml -&gt; core/src/main/res/layout/precise_location_dialog.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h197">app/src/main/res/mipmap-anydpi-v26/launcher_icon.xml -&gt; core/src/main/res/mipmap-anydpi-v26/launcher_icon.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h198">app/src/main/res/mipmap-anydpi-v26/launcher_icon_round.xml -&gt; core/src/main/res/mipmap-anydpi-v26/launcher_icon_round.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h199">app/src/main/res/mipmap-hdpi/launcher_icon_foreground.png -&gt; core/src/main/res/mipmap-hdpi/launcher_icon_foreground.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h200">app/src/main/res/mipmap-hdpi/launcher_icon_round.png -&gt; core/src/main/res/mipmap-hdpi/launcher_icon_round.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h201">app/src/main/res/mipmap-mdpi/launcher_icon_foreground.png -&gt; core/src/main/res/mipmap-mdpi/launcher_icon_foreground.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h202">app/src/main/res/mipmap-mdpi/launcher_icon_round.png -&gt; core/src/main/res/mipmap-mdpi/launcher_icon_round.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h203">app/src/main/res/mipmap-xhdpi/launcher_icon_foreground.png -&gt; core/src/main/res/mipmap-xhdpi/launcher_icon_foreground.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h204">app/src/main/res/mipmap-xhdpi/launcher_icon_round.png -&gt; core/src/main/res/mipmap-xhdpi/launcher_icon_round.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h205">app/src/main/res/mipmap-xxhdpi/launcher_icon_foreground.png -&gt; core/src/main/res/mipmap-xxhdpi/launcher_icon_foreground.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h206">app/src/main/res/mipmap-xxhdpi/launcher_icon_round.png -&gt; core/src/main/res/mipmap-xxhdpi/launcher_icon_round.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h207">app/src/main/res/mipmap-xxxhdpi/launcher_icon_foreground.png -&gt; core/src/main/res/mipmap-xxxhdpi/launcher_icon_foreground.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h208">app/src/main/res/mipmap-xxxhdpi/launcher_icon_round.png -&gt; core/src/main/res/mipmap-xxxhdpi/launcher_icon_round.png</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h209">app/src/main/res/values/arrays.xml -&gt; core/src/main/res/values/arrays.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h210">app/src/main/res/values/colors.xml -&gt; core/src/main/res/values/colors.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h211">app/src/main/res/values/dimens.xml -&gt; core/src/main/res/values/dimens.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h212">app/src/main/res/values/launcher_icon_background.xml -&gt; core/src/main/res/values/launcher_icon_background.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h213">app/src/main/res/values/strings.xml -&gt; core/src/main/res/values/strings.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="R">R</td><td><a href="#h214">app/src/main/res/values/themes.xml -&gt; core/src/main/res/values/themes.xml</a></td><td> | </td><td class="num">0</td><td><span class="i"></span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h215">gradle/libs.versions.toml</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h216">settings.gradle.kts</a></td><td> | </td><td class="num">2</td><td><span class="i">++</span><span class="d"></span></td></tr>
</table></pre><pre>217 files changed, 2124 insertions(+), 2065 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/build.gradle.kts.html">app/build.gradle.kts</a> b/<a href="../file/app/build.gradle.kts.html">app/build.gradle.kts</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -6,9 +6,6 @@ plugins {
</a>     alias(libs.plugins.kotlinAndroid)
 }
 
<a href="#h0-0-3" id="h0-0-3" class="d">-val appVersionName = &quot;1.1.0&quot;
</a><a href="#h0-0-4" id="h0-0-4" class="d">-val appVersionCode = 7
</a><a href="#h0-0-5" id="h0-0-5" class="d">-
</a> android {
     namespace = &quot;me.rhunk.snapenhance&quot;
     compileSdk = 33
<a href="#h0-1" id="h0-1" class="h">@@ -22,9 +19,6 @@ android {
</a>         minSdk = 28
         //noinspection OldTargetApi
         targetSdk = 33
<a href="#h0-1-3" id="h0-1-3" class="d">-
</a><a href="#h0-1-4" id="h0-1-4" class="d">-        versionCode = appVersionCode
</a><a href="#h0-1-5" id="h0-1-5" class="d">-        versionName = appVersionName
</a>         multiDexEnabled = true
     }
 
<a href="#h0-2" id="h0-2" class="h">@@ -66,7 +60,7 @@ android {
</a> 
     applicationVariants.all {
         outputs.map { it as BaseVariantOutputImpl }.forEach { variant -&gt;
<a href="#h0-2-3" id="h0-2-3" class="d">-            variant.outputFileName = &quot;app-${appVersionName}-${variant.name}.apk&quot;
</a><a href="#h0-2-4" id="h0-2-4" class="i">+            variant.outputFileName = &quot;app-${rootProject.ext[&quot;appVersionName&quot;]}-${variant.name}.apk&quot;
</a>         }
     }
 
<a href="#h0-3" id="h0-3" class="h">@@ -81,24 +75,8 @@ android {
</a> }
 
 dependencies {
<a href="#h0-3-3" id="h0-3-3" class="d">-    compileOnly(files(&quot;libs/LSPosed-api-1.0-SNAPSHOT.jar&quot;))
</a><a href="#h0-3-4" id="h0-3-4" class="d">-    implementation(libs.coroutines)
</a><a href="#h0-3-5" id="h0-3-5" class="d">-    implementation(libs.kotlin.reflect)
</a><a href="#h0-3-6" id="h0-3-6" class="d">-    implementation(libs.recyclerview)
</a><a href="#h0-3-7" id="h0-3-7" class="d">-    implementation(libs.gson)
</a><a href="#h0-3-8" id="h0-3-8" class="d">-    implementation(libs.ffmpeg.kit)
</a><a href="#h0-3-9" id="h0-3-9" class="d">-    implementation(libs.osmdroid.android)
</a><a href="#h0-3-10" id="h0-3-10" class="d">-    implementation(libs.okhttp)
</a><a href="#h0-3-11" id="h0-3-11" class="d">-    implementation(libs.androidx.documentfile)
</a><a href="#h0-3-12" id="h0-3-12" class="d">-
</a><a href="#h0-3-13" id="h0-3-13" class="d">-    implementation(project(&quot;:mapper&quot;))
</a><a href="#h0-3-14" id="h0-3-14" class="d">-}
</a><a href="#h0-3-15" id="h0-3-15" class="d">-
</a><a href="#h0-3-16" id="h0-3-16" class="d">-tasks.register(&quot;getVersion&quot;) {
</a><a href="#h0-3-17" id="h0-3-17" class="d">-    doLast {
</a><a href="#h0-3-18" id="h0-3-18" class="d">-        val versionFile = File(&quot;app/build/version.txt&quot;)
</a><a href="#h0-3-19" id="h0-3-19" class="d">-        versionFile.writeText(android.defaultConfig.versionName.toString())
</a><a href="#h0-3-20" id="h0-3-20" class="d">-    }
</a><a href="#h0-3-21" id="h0-3-21" class="i">+    implementation(project(&quot;:core&quot;))
</a><a href="#h0-3-22" id="h0-3-22" class="i">+    implementation(libs.androidx.activity.ktx)
</a> }
 
 afterEvaluate {
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/Logger.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/Logger.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/Logger.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/Logger.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,42 +0,0 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-package me.rhunk.snapenhance
</a><a href="#h1-0-1" id="h1-0-1" class="d">-
</a><a href="#h1-0-2" id="h1-0-2" class="d">-import android.util.Log
</a><a href="#h1-0-3" id="h1-0-3" class="d">-import de.robv.android.xposed.XposedBridge
</a><a href="#h1-0-4" id="h1-0-4" class="d">-
</a><a href="#h1-0-5" id="h1-0-5" class="d">-object Logger {
</a><a href="#h1-0-6" id="h1-0-6" class="d">-    private const val TAG = &quot;SnapEnhance&quot;
</a><a href="#h1-0-7" id="h1-0-7" class="d">-
</a><a href="#h1-0-8" id="h1-0-8" class="d">-    fun log(message: Any?) {
</a><a href="#h1-0-9" id="h1-0-9" class="d">-        Log.i(TAG, message.toString())
</a><a href="#h1-0-10" id="h1-0-10" class="d">-    }
</a><a href="#h1-0-11" id="h1-0-11" class="d">-
</a><a href="#h1-0-12" id="h1-0-12" class="d">-    fun debug(message: Any?) {
</a><a href="#h1-0-13" id="h1-0-13" class="d">-        if (!BuildConfig.DEBUG) return
</a><a href="#h1-0-14" id="h1-0-14" class="d">-        Log.d(TAG, message.toString())
</a><a href="#h1-0-15" id="h1-0-15" class="d">-    }
</a><a href="#h1-0-16" id="h1-0-16" class="d">-
</a><a href="#h1-0-17" id="h1-0-17" class="d">-    fun error(throwable: Throwable) {
</a><a href="#h1-0-18" id="h1-0-18" class="d">-        Log.e(TAG, &quot;&quot;, throwable)
</a><a href="#h1-0-19" id="h1-0-19" class="d">-    }
</a><a href="#h1-0-20" id="h1-0-20" class="d">-
</a><a href="#h1-0-21" id="h1-0-21" class="d">-    fun error(message: Any?) {
</a><a href="#h1-0-22" id="h1-0-22" class="d">-        Log.e(TAG, message.toString())
</a><a href="#h1-0-23" id="h1-0-23" class="d">-    }
</a><a href="#h1-0-24" id="h1-0-24" class="d">-
</a><a href="#h1-0-25" id="h1-0-25" class="d">-    fun error(message: Any?, throwable: Throwable) {
</a><a href="#h1-0-26" id="h1-0-26" class="d">-        Log.e(TAG, message.toString(), throwable)
</a><a href="#h1-0-27" id="h1-0-27" class="d">-    }
</a><a href="#h1-0-28" id="h1-0-28" class="d">-
</a><a href="#h1-0-29" id="h1-0-29" class="d">-    fun xposedLog(message: Any?) {
</a><a href="#h1-0-30" id="h1-0-30" class="d">-        XposedBridge.log(message.toString())
</a><a href="#h1-0-31" id="h1-0-31" class="d">-    }
</a><a href="#h1-0-32" id="h1-0-32" class="d">-
</a><a href="#h1-0-33" id="h1-0-33" class="d">-    fun xposedLog(message: Any?, throwable: Throwable?) {
</a><a href="#h1-0-34" id="h1-0-34" class="d">-        XposedBridge.log(message.toString())
</a><a href="#h1-0-35" id="h1-0-35" class="d">-        XposedBridge.log(throwable)
</a><a href="#h1-0-36" id="h1-0-36" class="d">-    }
</a><a href="#h1-0-37" id="h1-0-37" class="d">-
</a><a href="#h1-0-38" id="h1-0-38" class="d">-    fun xposedLog(throwable: Throwable) {
</a><a href="#h1-0-39" id="h1-0-39" class="d">-        XposedBridge.log(throwable)
</a><a href="#h1-0-40" id="h1-0-40" class="d">-    }
</a><a href="#h1-0-41" id="h1-0-41" class="d">-}</a><a href="#h1-0-42" id="h1-0-42" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,121 +0,0 @@
</a><a href="#h2-0-0" id="h2-0-0" class="d">-package me.rhunk.snapenhance
</a><a href="#h2-0-1" id="h2-0-1" class="d">-
</a><a href="#h2-0-2" id="h2-0-2" class="d">-import android.app.Activity
</a><a href="#h2-0-3" id="h2-0-3" class="d">-import android.app.Application
</a><a href="#h2-0-4" id="h2-0-4" class="d">-import android.content.Context
</a><a href="#h2-0-5" id="h2-0-5" class="d">-import android.content.pm.PackageManager
</a><a href="#h2-0-6" id="h2-0-6" class="d">-import kotlinx.coroutines.runBlocking
</a><a href="#h2-0-7" id="h2-0-7" class="d">-import kotlinx.coroutines.withContext
</a><a href="#h2-0-8" id="h2-0-8" class="d">-import me.rhunk.snapenhance.bridge.BridgeClient
</a><a href="#h2-0-9" id="h2-0-9" class="d">-import me.rhunk.snapenhance.data.SnapClassCache
</a><a href="#h2-0-10" id="h2-0-10" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h2-0-11" id="h2-0-11" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h2-0-12" id="h2-0-12" class="d">-import me.rhunk.snapenhance.hook.hook
</a><a href="#h2-0-13" id="h2-0-13" class="d">-import me.rhunk.snapenhance.util.getApplicationInfoCompat
</a><a href="#h2-0-14" id="h2-0-14" class="d">-import kotlin.time.ExperimentalTime
</a><a href="#h2-0-15" id="h2-0-15" class="d">-import kotlin.time.measureTime
</a><a href="#h2-0-16" id="h2-0-16" class="d">-
</a><a href="#h2-0-17" id="h2-0-17" class="d">-class SnapEnhance {
</a><a href="#h2-0-18" id="h2-0-18" class="d">-    companion object {
</a><a href="#h2-0-19" id="h2-0-19" class="d">-        lateinit var classLoader: ClassLoader
</a><a href="#h2-0-20" id="h2-0-20" class="d">-        val classCache: SnapClassCache by lazy {
</a><a href="#h2-0-21" id="h2-0-21" class="d">-            SnapClassCache(classLoader)
</a><a href="#h2-0-22" id="h2-0-22" class="d">-        }
</a><a href="#h2-0-23" id="h2-0-23" class="d">-    }
</a><a href="#h2-0-24" id="h2-0-24" class="d">-    private val appContext = ModContext()
</a><a href="#h2-0-25" id="h2-0-25" class="d">-    private var isBridgeInitialized = false
</a><a href="#h2-0-26" id="h2-0-26" class="d">-
</a><a href="#h2-0-27" id="h2-0-27" class="d">-    init {
</a><a href="#h2-0-28" id="h2-0-28" class="d">-        Hooker.hook(Application::class.java, &quot;attach&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h2-0-29" id="h2-0-29" class="d">-            appContext.androidContext = param.arg&lt;Context&gt;(0).also {
</a><a href="#h2-0-30" id="h2-0-30" class="d">-                classLoader = it.classLoader
</a><a href="#h2-0-31" id="h2-0-31" class="d">-            }
</a><a href="#h2-0-32" id="h2-0-32" class="d">-            appContext.bridgeClient = BridgeClient(appContext)
</a><a href="#h2-0-33" id="h2-0-33" class="d">-
</a><a href="#h2-0-34" id="h2-0-34" class="d">-            //for lspatch builds, we need to check if the service is correctly installed
</a><a href="#h2-0-35" id="h2-0-35" class="d">-            runCatching {
</a><a href="#h2-0-36" id="h2-0-36" class="d">-                appContext.androidContext.packageManager.getApplicationInfoCompat(BuildConfig.APPLICATION_ID, PackageManager.GET_META_DATA)
</a><a href="#h2-0-37" id="h2-0-37" class="d">-            }.onFailure {
</a><a href="#h2-0-38" id="h2-0-38" class="d">-                appContext.crash(&quot;SnapEnhance bridge service is not installed. Please download stable version from https://github.com/rhunk/SnapEnhance/releases&quot;)
</a><a href="#h2-0-39" id="h2-0-39" class="d">-                return@hook
</a><a href="#h2-0-40" id="h2-0-40" class="d">-            }
</a><a href="#h2-0-41" id="h2-0-41" class="d">-
</a><a href="#h2-0-42" id="h2-0-42" class="d">-            appContext.bridgeClient.apply {
</a><a href="#h2-0-43" id="h2-0-43" class="d">-                start { bridgeResult -&gt;
</a><a href="#h2-0-44" id="h2-0-44" class="d">-                    if (!bridgeResult) {
</a><a href="#h2-0-45" id="h2-0-45" class="d">-                        Logger.xposedLog(&quot;Cannot connect to bridge service&quot;)
</a><a href="#h2-0-46" id="h2-0-46" class="d">-                        appContext.softRestartApp()
</a><a href="#h2-0-47" id="h2-0-47" class="d">-                        return@start
</a><a href="#h2-0-48" id="h2-0-48" class="d">-                    }
</a><a href="#h2-0-49" id="h2-0-49" class="d">-                    runCatching {
</a><a href="#h2-0-50" id="h2-0-50" class="d">-                        runBlocking {
</a><a href="#h2-0-51" id="h2-0-51" class="d">-                            init()
</a><a href="#h2-0-52" id="h2-0-52" class="d">-                        }
</a><a href="#h2-0-53" id="h2-0-53" class="d">-                    }.onSuccess {
</a><a href="#h2-0-54" id="h2-0-54" class="d">-                        isBridgeInitialized = true
</a><a href="#h2-0-55" id="h2-0-55" class="d">-                    }.onFailure {
</a><a href="#h2-0-56" id="h2-0-56" class="d">-                        Logger.xposedLog(&quot;Failed to initialize&quot;, it)
</a><a href="#h2-0-57" id="h2-0-57" class="d">-                    }
</a><a href="#h2-0-58" id="h2-0-58" class="d">-                }
</a><a href="#h2-0-59" id="h2-0-59" class="d">-            }
</a><a href="#h2-0-60" id="h2-0-60" class="d">-        }
</a><a href="#h2-0-61" id="h2-0-61" class="d">-
</a><a href="#h2-0-62" id="h2-0-62" class="d">-        Activity::class.java.hook( &quot;onCreate&quot;,  HookStage.AFTER, { isBridgeInitialized }) {
</a><a href="#h2-0-63" id="h2-0-63" class="d">-            val activity = it.thisObject() as Activity
</a><a href="#h2-0-64" id="h2-0-64" class="d">-            if (!activity.packageName.equals(Constants.SNAPCHAT_PACKAGE_NAME)) return@hook
</a><a href="#h2-0-65" id="h2-0-65" class="d">-            val isMainActivityNotNull = appContext.mainActivity != null
</a><a href="#h2-0-66" id="h2-0-66" class="d">-            appContext.mainActivity = activity
</a><a href="#h2-0-67" id="h2-0-67" class="d">-            if (isMainActivityNotNull || !appContext.mappings.areMappingsLoaded) return@hook
</a><a href="#h2-0-68" id="h2-0-68" class="d">-            onActivityCreate()
</a><a href="#h2-0-69" id="h2-0-69" class="d">-        }
</a><a href="#h2-0-70" id="h2-0-70" class="d">-
</a><a href="#h2-0-71" id="h2-0-71" class="d">-        var activityWasResumed = false
</a><a href="#h2-0-72" id="h2-0-72" class="d">-
</a><a href="#h2-0-73" id="h2-0-73" class="d">-        //we need to reload the config when the app is resumed
</a><a href="#h2-0-74" id="h2-0-74" class="d">-        Activity::class.java.hook(&quot;onResume&quot;, HookStage.AFTER, { isBridgeInitialized }) {
</a><a href="#h2-0-75" id="h2-0-75" class="d">-            val activity = it.thisObject() as Activity
</a><a href="#h2-0-76" id="h2-0-76" class="d">-
</a><a href="#h2-0-77" id="h2-0-77" class="d">-            if (!activity.packageName.equals(Constants.SNAPCHAT_PACKAGE_NAME)) return@hook
</a><a href="#h2-0-78" id="h2-0-78" class="d">-
</a><a href="#h2-0-79" id="h2-0-79" class="d">-            if (!activityWasResumed) {
</a><a href="#h2-0-80" id="h2-0-80" class="d">-                activityWasResumed = true
</a><a href="#h2-0-81" id="h2-0-81" class="d">-                return@hook
</a><a href="#h2-0-82" id="h2-0-82" class="d">-            }
</a><a href="#h2-0-83" id="h2-0-83" class="d">-
</a><a href="#h2-0-84" id="h2-0-84" class="d">-            Logger.debug(&quot;Reloading config&quot;)
</a><a href="#h2-0-85" id="h2-0-85" class="d">-            appContext.config.loadFromBridge(appContext.bridgeClient)
</a><a href="#h2-0-86" id="h2-0-86" class="d">-        }
</a><a href="#h2-0-87" id="h2-0-87" class="d">-    }
</a><a href="#h2-0-88" id="h2-0-88" class="d">-
</a><a href="#h2-0-89" id="h2-0-89" class="d">-    @OptIn(ExperimentalTime::class)
</a><a href="#h2-0-90" id="h2-0-90" class="d">-    private suspend fun init() {
</a><a href="#h2-0-91" id="h2-0-91" class="d">-        //load translations in a coroutine to speed up initialization
</a><a href="#h2-0-92" id="h2-0-92" class="d">-        withContext(appContext.coroutineDispatcher) {
</a><a href="#h2-0-93" id="h2-0-93" class="d">-            appContext.translation.loadFromBridge(appContext.bridgeClient)
</a><a href="#h2-0-94" id="h2-0-94" class="d">-        }
</a><a href="#h2-0-95" id="h2-0-95" class="d">-
</a><a href="#h2-0-96" id="h2-0-96" class="d">-        measureTime {
</a><a href="#h2-0-97" id="h2-0-97" class="d">-            with(appContext) {
</a><a href="#h2-0-98" id="h2-0-98" class="d">-                config.loadFromBridge(bridgeClient)
</a><a href="#h2-0-99" id="h2-0-99" class="d">-                mappings.init()
</a><a href="#h2-0-100" id="h2-0-100" class="d">-                //if mappings aren&#39;t loaded, we can&#39;t initialize features
</a><a href="#h2-0-101" id="h2-0-101" class="d">-                if (!mappings.areMappingsLoaded) return
</a><a href="#h2-0-102" id="h2-0-102" class="d">-                features.init()
</a><a href="#h2-0-103" id="h2-0-103" class="d">-            }
</a><a href="#h2-0-104" id="h2-0-104" class="d">-        }.also { time -&gt;
</a><a href="#h2-0-105" id="h2-0-105" class="d">-            Logger.debug(&quot;init took $time&quot;)
</a><a href="#h2-0-106" id="h2-0-106" class="d">-        }
</a><a href="#h2-0-107" id="h2-0-107" class="d">-    }
</a><a href="#h2-0-108" id="h2-0-108" class="d">-
</a><a href="#h2-0-109" id="h2-0-109" class="d">-    @OptIn(ExperimentalTime::class)
</a><a href="#h2-0-110" id="h2-0-110" class="d">-    private fun onActivityCreate() {
</a><a href="#h2-0-111" id="h2-0-111" class="d">-        measureTime {
</a><a href="#h2-0-112" id="h2-0-112" class="d">-            with(appContext) {
</a><a href="#h2-0-113" id="h2-0-113" class="d">-                features.onActivityCreate()
</a><a href="#h2-0-114" id="h2-0-114" class="d">-                actionManager.init()
</a><a href="#h2-0-115" id="h2-0-115" class="d">-            }
</a><a href="#h2-0-116" id="h2-0-116" class="d">-        }.also { time -&gt;
</a><a href="#h2-0-117" id="h2-0-117" class="d">-            Logger.debug(&quot;onActivityCreate took $time&quot;)
</a><a href="#h2-0-118" id="h2-0-118" class="d">-        }
</a><a href="#h2-0-119" id="h2-0-119" class="d">-    }
</a><a href="#h2-0-120" id="h2-0-120" class="d">-}</a><a href="#h2-0-121" id="h2-0-121" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,23 +0,0 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-package me.rhunk.snapenhance.action.impl
</a><a href="#h3-0-1" id="h3-0-1" class="d">-
</a><a href="#h3-0-2" id="h3-0-2" class="d">-import android.content.Intent
</a><a href="#h3-0-3" id="h3-0-3" class="d">-import android.os.Bundle
</a><a href="#h3-0-4" id="h3-0-4" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h3-0-5" id="h3-0-5" class="d">-import me.rhunk.snapenhance.action.AbstractAction
</a><a href="#h3-0-6" id="h3-0-6" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h3-0-7" id="h3-0-7" class="d">-import me.rhunk.snapenhance.ui.map.MapActivity
</a><a href="#h3-0-8" id="h3-0-8" class="d">-
</a><a href="#h3-0-9" id="h3-0-9" class="d">-class OpenMap: AbstractAction(&quot;action.open_map&quot;, dependsOnProperty = ConfigProperty.LOCATION_SPOOF) {
</a><a href="#h3-0-10" id="h3-0-10" class="d">-    override fun run() {
</a><a href="#h3-0-11" id="h3-0-11" class="d">-        context.runOnUiThread {
</a><a href="#h3-0-12" id="h3-0-12" class="d">-            val mapActivityIntent = Intent()
</a><a href="#h3-0-13" id="h3-0-13" class="d">-            mapActivityIntent.setClassName(BuildConfig.APPLICATION_ID, MapActivity::class.java.name)
</a><a href="#h3-0-14" id="h3-0-14" class="d">-            mapActivityIntent.putExtra(&quot;location&quot;, Bundle().apply {
</a><a href="#h3-0-15" id="h3-0-15" class="d">-                putDouble(&quot;latitude&quot;, context.config.string(ConfigProperty.LATITUDE).toDouble())
</a><a href="#h3-0-16" id="h3-0-16" class="d">-                putDouble(&quot;longitude&quot;, context.config.string(ConfigProperty.LONGITUDE).toDouble())
</a><a href="#h3-0-17" id="h3-0-17" class="d">-            })
</a><a href="#h3-0-18" id="h3-0-18" class="d">-
</a><a href="#h3-0-19" id="h3-0-19" class="d">-            context.mainActivity!!.startActivityForResult(mapActivityIntent, 0x1337)
</a><a href="#h3-0-20" id="h3-0-20" class="d">-        }
</a><a href="#h3-0-21" id="h3-0-21" class="d">-    }
</a><a href="#h3-0-22" id="h3-0-22" class="d">-}</a><a href="#h3-0-23" id="h3-0-23" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -1,126 +0,0 @@
</a><a href="#h4-0-0" id="h4-0-0" class="d">-package me.rhunk.snapenhance.bridge
</a><a href="#h4-0-1" id="h4-0-1" class="d">-
</a><a href="#h4-0-2" id="h4-0-2" class="d">-
</a><a href="#h4-0-3" id="h4-0-3" class="d">-import android.content.ComponentName
</a><a href="#h4-0-4" id="h4-0-4" class="d">-import android.content.Context
</a><a href="#h4-0-5" id="h4-0-5" class="d">-import android.content.Intent
</a><a href="#h4-0-6" id="h4-0-6" class="d">-import android.content.ServiceConnection
</a><a href="#h4-0-7" id="h4-0-7" class="d">-import android.os.Build
</a><a href="#h4-0-8" id="h4-0-8" class="d">-import android.os.Handler
</a><a href="#h4-0-9" id="h4-0-9" class="d">-import android.os.HandlerThread
</a><a href="#h4-0-10" id="h4-0-10" class="d">-import android.os.IBinder
</a><a href="#h4-0-11" id="h4-0-11" class="d">-import de.robv.android.xposed.XposedHelpers
</a><a href="#h4-0-12" id="h4-0-12" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h4-0-13" id="h4-0-13" class="d">-import me.rhunk.snapenhance.Logger.xposedLog
</a><a href="#h4-0-14" id="h4-0-14" class="d">-import me.rhunk.snapenhance.ModContext
</a><a href="#h4-0-15" id="h4-0-15" class="d">-import me.rhunk.snapenhance.bridge.types.BridgeFileType
</a><a href="#h4-0-16" id="h4-0-16" class="d">-import me.rhunk.snapenhance.data.LocalePair
</a><a href="#h4-0-17" id="h4-0-17" class="d">-import java.util.concurrent.CompletableFuture
</a><a href="#h4-0-18" id="h4-0-18" class="d">-import java.util.concurrent.Executors
</a><a href="#h4-0-19" id="h4-0-19" class="d">-import kotlin.system.exitProcess
</a><a href="#h4-0-20" id="h4-0-20" class="d">-
</a><a href="#h4-0-21" id="h4-0-21" class="d">-
</a><a href="#h4-0-22" id="h4-0-22" class="d">-class BridgeClient(
</a><a href="#h4-0-23" id="h4-0-23" class="d">-    private val context: ModContext
</a><a href="#h4-0-24" id="h4-0-24" class="d">-):  ServiceConnection {
</a><a href="#h4-0-25" id="h4-0-25" class="d">-    private lateinit var future: CompletableFuture&lt;Boolean&gt;
</a><a href="#h4-0-26" id="h4-0-26" class="d">-    private lateinit var service: BridgeInterface
</a><a href="#h4-0-27" id="h4-0-27" class="d">-
</a><a href="#h4-0-28" id="h4-0-28" class="d">-    fun start(callback: (Boolean) -&gt; Unit) {
</a><a href="#h4-0-29" id="h4-0-29" class="d">-        this.future = CompletableFuture()
</a><a href="#h4-0-30" id="h4-0-30" class="d">-
</a><a href="#h4-0-31" id="h4-0-31" class="d">-        with(context.androidContext) {
</a><a href="#h4-0-32" id="h4-0-32" class="d">-            //ensure the remote process is running
</a><a href="#h4-0-33" id="h4-0-33" class="d">-            startActivity(Intent()
</a><a href="#h4-0-34" id="h4-0-34" class="d">-                .setClassName(BuildConfig.APPLICATION_ID, ForceStartActivity::class.java.name)
</a><a href="#h4-0-35" id="h4-0-35" class="d">-                .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_MULTIPLE_TASK)
</a><a href="#h4-0-36" id="h4-0-36" class="d">-            )
</a><a href="#h4-0-37" id="h4-0-37" class="d">-
</a><a href="#h4-0-38" id="h4-0-38" class="d">-            val intent = Intent()
</a><a href="#h4-0-39" id="h4-0-39" class="d">-                .setClassName(BuildConfig.APPLICATION_ID, BridgeService::class.java.name)
</a><a href="#h4-0-40" id="h4-0-40" class="d">-            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) {
</a><a href="#h4-0-41" id="h4-0-41" class="d">-                bindService(
</a><a href="#h4-0-42" id="h4-0-42" class="d">-                    intent,
</a><a href="#h4-0-43" id="h4-0-43" class="d">-                    Context.BIND_AUTO_CREATE,
</a><a href="#h4-0-44" id="h4-0-44" class="d">-                    Executors.newSingleThreadExecutor(),
</a><a href="#h4-0-45" id="h4-0-45" class="d">-                    this@BridgeClient
</a><a href="#h4-0-46" id="h4-0-46" class="d">-                )
</a><a href="#h4-0-47" id="h4-0-47" class="d">-            } else {
</a><a href="#h4-0-48" id="h4-0-48" class="d">-                XposedHelpers.callMethod(
</a><a href="#h4-0-49" id="h4-0-49" class="d">-                    this,
</a><a href="#h4-0-50" id="h4-0-50" class="d">-                    &quot;bindServiceAsUser&quot;,
</a><a href="#h4-0-51" id="h4-0-51" class="d">-                    intent,
</a><a href="#h4-0-52" id="h4-0-52" class="d">-                    this@BridgeClient,
</a><a href="#h4-0-53" id="h4-0-53" class="d">-                    Context.BIND_AUTO_CREATE,
</a><a href="#h4-0-54" id="h4-0-54" class="d">-                    Handler(HandlerThread(&quot;BridgeClient&quot;).apply {
</a><a href="#h4-0-55" id="h4-0-55" class="d">-                        start()
</a><a href="#h4-0-56" id="h4-0-56" class="d">-                    }.looper),
</a><a href="#h4-0-57" id="h4-0-57" class="d">-                    android.os.Process.myUserHandle()
</a><a href="#h4-0-58" id="h4-0-58" class="d">-                )
</a><a href="#h4-0-59" id="h4-0-59" class="d">-            }
</a><a href="#h4-0-60" id="h4-0-60" class="d">-        }
</a><a href="#h4-0-61" id="h4-0-61" class="d">-        callback(future.get())
</a><a href="#h4-0-62" id="h4-0-62" class="d">-    }
</a><a href="#h4-0-63" id="h4-0-63" class="d">-
</a><a href="#h4-0-64" id="h4-0-64" class="d">-
</a><a href="#h4-0-65" id="h4-0-65" class="d">-    override fun onServiceConnected(name: ComponentName, service: IBinder) {
</a><a href="#h4-0-66" id="h4-0-66" class="d">-        this.service = BridgeInterface.Stub.asInterface(service)
</a><a href="#h4-0-67" id="h4-0-67" class="d">-        future.complete(true)
</a><a href="#h4-0-68" id="h4-0-68" class="d">-    }
</a><a href="#h4-0-69" id="h4-0-69" class="d">-
</a><a href="#h4-0-70" id="h4-0-70" class="d">-    override fun onNullBinding(name: ComponentName) {
</a><a href="#h4-0-71" id="h4-0-71" class="d">-        xposedLog(&quot;failed to connect to bridge service&quot;)
</a><a href="#h4-0-72" id="h4-0-72" class="d">-        future.complete(false)
</a><a href="#h4-0-73" id="h4-0-73" class="d">-    }
</a><a href="#h4-0-74" id="h4-0-74" class="d">-
</a><a href="#h4-0-75" id="h4-0-75" class="d">-    override fun onServiceDisconnected(name: ComponentName) {
</a><a href="#h4-0-76" id="h4-0-76" class="d">-        exitProcess(0)
</a><a href="#h4-0-77" id="h4-0-77" class="d">-    }
</a><a href="#h4-0-78" id="h4-0-78" class="d">-
</a><a href="#h4-0-79" id="h4-0-79" class="d">-    fun createAndReadFile(
</a><a href="#h4-0-80" id="h4-0-80" class="d">-        fileType: BridgeFileType,
</a><a href="#h4-0-81" id="h4-0-81" class="d">-        defaultContent: ByteArray
</a><a href="#h4-0-82" id="h4-0-82" class="d">-    ): ByteArray = service.createAndReadFile(fileType.value, defaultContent)
</a><a href="#h4-0-83" id="h4-0-83" class="d">-
</a><a href="#h4-0-84" id="h4-0-84" class="d">-    fun readFile(fileType: BridgeFileType): ByteArray = service.readFile(fileType.value)
</a><a href="#h4-0-85" id="h4-0-85" class="d">-
</a><a href="#h4-0-86" id="h4-0-86" class="d">-    fun writeFile(
</a><a href="#h4-0-87" id="h4-0-87" class="d">-        fileType: BridgeFileType,
</a><a href="#h4-0-88" id="h4-0-88" class="d">-        content: ByteArray?
</a><a href="#h4-0-89" id="h4-0-89" class="d">-    ): Boolean = service.writeFile(fileType.value, content)
</a><a href="#h4-0-90" id="h4-0-90" class="d">-
</a><a href="#h4-0-91" id="h4-0-91" class="d">-    fun deleteFile(fileType: BridgeFileType) = service.deleteFile(fileType.value)
</a><a href="#h4-0-92" id="h4-0-92" class="d">-
</a><a href="#h4-0-93" id="h4-0-93" class="d">-
</a><a href="#h4-0-94" id="h4-0-94" class="d">-    fun isFileExists(fileType: BridgeFileType) = service.isFileExists(fileType.value)
</a><a href="#h4-0-95" id="h4-0-95" class="d">-
</a><a href="#h4-0-96" id="h4-0-96" class="d">-    fun getLoggedMessageIds(conversationId: String, limit: Int): LongArray = service.getLoggedMessageIds(conversationId, limit)
</a><a href="#h4-0-97" id="h4-0-97" class="d">-
</a><a href="#h4-0-98" id="h4-0-98" class="d">-    fun getMessageLoggerMessage(conversationId: String, id: Long): ByteArray? = service.getMessageLoggerMessage(conversationId, id)
</a><a href="#h4-0-99" id="h4-0-99" class="d">-
</a><a href="#h4-0-100" id="h4-0-100" class="d">-    fun addMessageLoggerMessage(conversationId: String,id: Long, message: ByteArray) = service.addMessageLoggerMessage(conversationId, id, message)
</a><a href="#h4-0-101" id="h4-0-101" class="d">-
</a><a href="#h4-0-102" id="h4-0-102" class="d">-    fun deleteMessageLoggerMessage(conversationId: String, id: Long) = service.deleteMessageLoggerMessage(conversationId, id)
</a><a href="#h4-0-103" id="h4-0-103" class="d">-
</a><a href="#h4-0-104" id="h4-0-104" class="d">-    fun clearMessageLogger() = service.clearMessageLogger()
</a><a href="#h4-0-105" id="h4-0-105" class="d">-
</a><a href="#h4-0-106" id="h4-0-106" class="d">-    fun fetchTranslations() = service.fetchTranslations().map {
</a><a href="#h4-0-107" id="h4-0-107" class="d">-        LocalePair(it.key, it.value)
</a><a href="#h4-0-108" id="h4-0-108" class="d">-    }
</a><a href="#h4-0-109" id="h4-0-109" class="d">-
</a><a href="#h4-0-110" id="h4-0-110" class="d">-    fun getAutoUpdaterTime(): Long {
</a><a href="#h4-0-111" id="h4-0-111" class="d">-        createAndReadFile(BridgeFileType.AUTO_UPDATER_TIMESTAMP, &quot;0&quot;.toByteArray()).run {
</a><a href="#h4-0-112" id="h4-0-112" class="d">-            return if (isEmpty()) {
</a><a href="#h4-0-113" id="h4-0-113" class="d">-                0
</a><a href="#h4-0-114" id="h4-0-114" class="d">-            } else {
</a><a href="#h4-0-115" id="h4-0-115" class="d">-                String(this).toLong()
</a><a href="#h4-0-116" id="h4-0-116" class="d">-            }
</a><a href="#h4-0-117" id="h4-0-117" class="d">-        }
</a><a href="#h4-0-118" id="h4-0-118" class="d">-    }
</a><a href="#h4-0-119" id="h4-0-119" class="d">-
</a><a href="#h4-0-120" id="h4-0-120" class="d">-    fun setAutoUpdaterTime(time: Long) {
</a><a href="#h4-0-121" id="h4-0-121" class="d">-        writeFile(BridgeFileType.AUTO_UPDATER_TIMESTAMP, time.toString().toByteArray())
</a><a href="#h4-0-122" id="h4-0-122" class="d">-    }
</a><a href="#h4-0-123" id="h4-0-123" class="d">-
</a><a href="#h4-0-124" id="h4-0-124" class="d">-    fun enqueueDownload(intent: Intent, callback: DownloadCallback) = service.enqueueDownload(intent, callback)
</a><a href="#h4-0-125" id="h4-0-125" class="d">-}
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,110 +0,0 @@
</a><a href="#h5-0-0" id="h5-0-0" class="d">-package me.rhunk.snapenhance.features.impl
</a><a href="#h5-0-1" id="h5-0-1" class="d">-
</a><a href="#h5-0-2" id="h5-0-2" class="d">-import android.annotation.SuppressLint
</a><a href="#h5-0-3" id="h5-0-3" class="d">-import android.app.AlertDialog
</a><a href="#h5-0-4" id="h5-0-4" class="d">-import android.app.DownloadManager
</a><a href="#h5-0-5" id="h5-0-5" class="d">-import android.content.BroadcastReceiver
</a><a href="#h5-0-6" id="h5-0-6" class="d">-import android.content.Context
</a><a href="#h5-0-7" id="h5-0-7" class="d">-import android.content.Intent
</a><a href="#h5-0-8" id="h5-0-8" class="d">-import android.content.IntentFilter
</a><a href="#h5-0-9" id="h5-0-9" class="d">-import android.net.Uri
</a><a href="#h5-0-10" id="h5-0-10" class="d">-import android.os.Environment
</a><a href="#h5-0-11" id="h5-0-11" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h5-0-12" id="h5-0-12" class="d">-import me.rhunk.snapenhance.Logger
</a><a href="#h5-0-13" id="h5-0-13" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h5-0-14" id="h5-0-14" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h5-0-15" id="h5-0-15" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h5-0-16" id="h5-0-16" class="d">-import me.rhunk.snapenhance.ui.ViewAppearanceHelper
</a><a href="#h5-0-17" id="h5-0-17" class="d">-import okhttp3.OkHttpClient
</a><a href="#h5-0-18" id="h5-0-18" class="d">-import okhttp3.Request
</a><a href="#h5-0-19" id="h5-0-19" class="d">-import org.json.JSONArray
</a><a href="#h5-0-20" id="h5-0-20" class="d">-
</a><a href="#h5-0-21" id="h5-0-21" class="d">-class AutoUpdater : Feature(&quot;AutoUpdater&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h5-0-22" id="h5-0-22" class="d">-    override fun asyncOnActivityCreate() {
</a><a href="#h5-0-23" id="h5-0-23" class="d">-        val checkForUpdateMode = context.config.state(ConfigProperty.AUTO_UPDATER)
</a><a href="#h5-0-24" id="h5-0-24" class="d">-        val currentTimeMillis = System.currentTimeMillis()
</a><a href="#h5-0-25" id="h5-0-25" class="d">-        val checkForUpdatesTimestamp = context.bridgeClient.getAutoUpdaterTime()
</a><a href="#h5-0-26" id="h5-0-26" class="d">-
</a><a href="#h5-0-27" id="h5-0-27" class="d">-        val delayTimestamp = when (checkForUpdateMode) {
</a><a href="#h5-0-28" id="h5-0-28" class="d">-            &quot;EVERY_LAUNCH&quot; -&gt; currentTimeMillis - checkForUpdatesTimestamp
</a><a href="#h5-0-29" id="h5-0-29" class="d">-            &quot;DAILY&quot; -&gt; 86400000L
</a><a href="#h5-0-30" id="h5-0-30" class="d">-            &quot;WEEKLY&quot; -&gt; 604800000L
</a><a href="#h5-0-31" id="h5-0-31" class="d">-            else -&gt; return
</a><a href="#h5-0-32" id="h5-0-32" class="d">-        }
</a><a href="#h5-0-33" id="h5-0-33" class="d">-
</a><a href="#h5-0-34" id="h5-0-34" class="d">-        if (checkForUpdatesTimestamp + delayTimestamp &gt; currentTimeMillis) return
</a><a href="#h5-0-35" id="h5-0-35" class="d">-
</a><a href="#h5-0-36" id="h5-0-36" class="d">-        runCatching {
</a><a href="#h5-0-37" id="h5-0-37" class="d">-            checkForUpdates()
</a><a href="#h5-0-38" id="h5-0-38" class="d">-        }.onFailure {
</a><a href="#h5-0-39" id="h5-0-39" class="d">-            Logger.error(&quot;Failed to check for updates: ${it.message}&quot;, it)
</a><a href="#h5-0-40" id="h5-0-40" class="d">-        }.onSuccess {
</a><a href="#h5-0-41" id="h5-0-41" class="d">-            context.bridgeClient.setAutoUpdaterTime(currentTimeMillis)
</a><a href="#h5-0-42" id="h5-0-42" class="d">-        }
</a><a href="#h5-0-43" id="h5-0-43" class="d">-    }
</a><a href="#h5-0-44" id="h5-0-44" class="d">-
</a><a href="#h5-0-45" id="h5-0-45" class="d">-    @SuppressLint(&quot;UnspecifiedRegisterReceiverFlag&quot;)
</a><a href="#h5-0-46" id="h5-0-46" class="d">-    fun checkForUpdates(): String? {
</a><a href="#h5-0-47" id="h5-0-47" class="d">-        val endpoint = Request.Builder().url(&quot;https://api.github.com/repos/rhunk/SnapEnhance/releases&quot;).build()
</a><a href="#h5-0-48" id="h5-0-48" class="d">-        val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h5-0-49" id="h5-0-49" class="d">-
</a><a href="#h5-0-50" id="h5-0-50" class="d">-        if (!response.isSuccessful) throw Throwable(&quot;Failed to fetch releases: ${response.code}&quot;)
</a><a href="#h5-0-51" id="h5-0-51" class="d">-
</a><a href="#h5-0-52" id="h5-0-52" class="d">-        val releases = JSONArray(response.body.string()).also {
</a><a href="#h5-0-53" id="h5-0-53" class="d">-            if (it.length() == 0) throw Throwable(&quot;No releases found&quot;)
</a><a href="#h5-0-54" id="h5-0-54" class="d">-        }
</a><a href="#h5-0-55" id="h5-0-55" class="d">-
</a><a href="#h5-0-56" id="h5-0-56" class="d">-        val latestRelease = releases.getJSONObject(0)
</a><a href="#h5-0-57" id="h5-0-57" class="d">-        val latestVersion = latestRelease.getString(&quot;tag_name&quot;)
</a><a href="#h5-0-58" id="h5-0-58" class="d">-        if (latestVersion.removePrefix(&quot;v&quot;) == BuildConfig.VERSION_NAME) return null
</a><a href="#h5-0-59" id="h5-0-59" class="d">-
</a><a href="#h5-0-60" id="h5-0-60" class="d">-        val releaseContentBody = latestRelease.getString(&quot;body&quot;)
</a><a href="#h5-0-61" id="h5-0-61" class="d">-        val downloadEndpoint = latestRelease.getJSONArray(&quot;assets&quot;).getJSONObject(0).getString(&quot;browser_download_url&quot;)
</a><a href="#h5-0-62" id="h5-0-62" class="d">-
</a><a href="#h5-0-63" id="h5-0-63" class="d">-        context.runOnUiThread {
</a><a href="#h5-0-64" id="h5-0-64" class="d">-            ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h5-0-65" id="h5-0-65" class="d">-                .setTitle(context.translation[&quot;auto_updater.dialog_title&quot;])
</a><a href="#h5-0-66" id="h5-0-66" class="d">-                .setMessage(
</a><a href="#h5-0-67" id="h5-0-67" class="d">-                    context.translation.format(&quot;auto_updater.dialog_message&quot;,
</a><a href="#h5-0-68" id="h5-0-68" class="d">-                        &quot;version&quot; to latestVersion,
</a><a href="#h5-0-69" id="h5-0-69" class="d">-                        &quot;body&quot; to releaseContentBody)
</a><a href="#h5-0-70" id="h5-0-70" class="d">-                )
</a><a href="#h5-0-71" id="h5-0-71" class="d">-                .setNegativeButton(context.translation[&quot;auto_updater.dialog_negative_button&quot;]) { dialog, _ -&gt;
</a><a href="#h5-0-72" id="h5-0-72" class="d">-                    dialog.dismiss()
</a><a href="#h5-0-73" id="h5-0-73" class="d">-                }
</a><a href="#h5-0-74" id="h5-0-74" class="d">-                .setPositiveButton(context.translation[&quot;auto_updater.dialog_positive_button&quot;]) { dialog, _ -&gt;
</a><a href="#h5-0-75" id="h5-0-75" class="d">-                    dialog.dismiss()
</a><a href="#h5-0-76" id="h5-0-76" class="d">-                    context.longToast(context.translation[&quot;auto_updater.downloading_toast&quot;])
</a><a href="#h5-0-77" id="h5-0-77" class="d">-
</a><a href="#h5-0-78" id="h5-0-78" class="d">-                    val request = DownloadManager.Request(Uri.parse(downloadEndpoint))
</a><a href="#h5-0-79" id="h5-0-79" class="d">-                        .setTitle(context.translation[&quot;auto_updater.download_manager_notification_title&quot;])
</a><a href="#h5-0-80" id="h5-0-80" class="d">-                        .setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, &quot;latest-snapenhance.apk&quot;)
</a><a href="#h5-0-81" id="h5-0-81" class="d">-                        .setMimeType(&quot;application/vnd.android.package-archive&quot;)
</a><a href="#h5-0-82" id="h5-0-82" class="d">-                        .setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE)
</a><a href="#h5-0-83" id="h5-0-83" class="d">-
</a><a href="#h5-0-84" id="h5-0-84" class="d">-                    val downloadManager = context.androidContext.getSystemService(Context.DOWNLOAD_SERVICE) as DownloadManager
</a><a href="#h5-0-85" id="h5-0-85" class="d">-                    val downloadId = downloadManager.enqueue(request)
</a><a href="#h5-0-86" id="h5-0-86" class="d">-
</a><a href="#h5-0-87" id="h5-0-87" class="d">-                    val onCompleteReceiver = object: BroadcastReceiver() {
</a><a href="#h5-0-88" id="h5-0-88" class="d">-                        override fun onReceive(context: Context, intent: Intent) {
</a><a href="#h5-0-89" id="h5-0-89" class="d">-                            val id = intent.getLongExtra(DownloadManager.EXTRA_DOWNLOAD_ID, -1)
</a><a href="#h5-0-90" id="h5-0-90" class="d">-                            if (id != downloadId) return
</a><a href="#h5-0-91" id="h5-0-91" class="d">-                            context.unregisterReceiver(this)
</a><a href="#h5-0-92" id="h5-0-92" class="d">-                            context.startActivity(
</a><a href="#h5-0-93" id="h5-0-93" class="d">-                                Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h5-0-94" id="h5-0-94" class="d">-                                    setDataAndType(downloadManager.getUriForDownloadedFile(downloadId), &quot;application/vnd.android.package-archive&quot;)
</a><a href="#h5-0-95" id="h5-0-95" class="d">-                                    flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h5-0-96" id="h5-0-96" class="d">-                                }
</a><a href="#h5-0-97" id="h5-0-97" class="d">-                            )
</a><a href="#h5-0-98" id="h5-0-98" class="d">-                        }
</a><a href="#h5-0-99" id="h5-0-99" class="d">-                    }
</a><a href="#h5-0-100" id="h5-0-100" class="d">-
</a><a href="#h5-0-101" id="h5-0-101" class="d">-                    context.mainActivity?.registerReceiver(onCompleteReceiver, IntentFilter(
</a><a href="#h5-0-102" id="h5-0-102" class="d">-                        DownloadManager.ACTION_DOWNLOAD_COMPLETE
</a><a href="#h5-0-103" id="h5-0-103" class="d">-                    ))
</a><a href="#h5-0-104" id="h5-0-104" class="d">-                }.show()
</a><a href="#h5-0-105" id="h5-0-105" class="d">-        }
</a><a href="#h5-0-106" id="h5-0-106" class="d">-
</a><a href="#h5-0-107" id="h5-0-107" class="d">-        return latestVersion
</a><a href="#h5-0-108" id="h5-0-108" class="d">-    }
</a><a href="#h5-0-109" id="h5-0-109" class="d">-}</a><a href="#h5-0-110" id="h5-0-110" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/MainActivity.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,10 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+package me.rhunk.snapenhance.manager
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+import android.os.Bundle
</a><a href="#h6-0-3" id="h6-0-3" class="i">+import androidx.activity.ComponentActivity
</a><a href="#h6-0-4" id="h6-0-4" class="i">+
</a><a href="#h6-0-5" id="h6-0-5" class="i">+class MainActivity : ComponentActivity() {
</a><a href="#h6-0-6" id="h6-0-6" class="i">+    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h6-0-7" id="h6-0-7" class="i">+        super.onCreate(savedInstanceState)
</a><a href="#h6-0-8" id="h6-0-8" class="i">+    }
</a><a href="#h6-0-9" id="h6-0-9" class="i">+}</a><a href="#h6-0-10" id="h6-0-10" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,41 +0,0 @@
</a><a href="#h7-0-0" id="h7-0-0" class="d">-package me.rhunk.snapenhance.manager.impl
</a><a href="#h7-0-1" id="h7-0-1" class="d">-
</a><a href="#h7-0-2" id="h7-0-2" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h7-0-3" id="h7-0-3" class="d">-import me.rhunk.snapenhance.ModContext
</a><a href="#h7-0-4" id="h7-0-4" class="d">-import me.rhunk.snapenhance.action.AbstractAction
</a><a href="#h7-0-5" id="h7-0-5" class="d">-import me.rhunk.snapenhance.action.impl.CheckForUpdates
</a><a href="#h7-0-6" id="h7-0-6" class="d">-import me.rhunk.snapenhance.action.impl.CleanCache
</a><a href="#h7-0-7" id="h7-0-7" class="d">-import me.rhunk.snapenhance.action.impl.ClearMessageLogger
</a><a href="#h7-0-8" id="h7-0-8" class="d">-import me.rhunk.snapenhance.action.impl.ExportChatMessages
</a><a href="#h7-0-9" id="h7-0-9" class="d">-import me.rhunk.snapenhance.action.impl.OpenMap
</a><a href="#h7-0-10" id="h7-0-10" class="d">-import me.rhunk.snapenhance.action.impl.RefreshMappings
</a><a href="#h7-0-11" id="h7-0-11" class="d">-import me.rhunk.snapenhance.manager.Manager
</a><a href="#h7-0-12" id="h7-0-12" class="d">-import kotlin.reflect.KClass
</a><a href="#h7-0-13" id="h7-0-13" class="d">-
</a><a href="#h7-0-14" id="h7-0-14" class="d">-class ActionManager(
</a><a href="#h7-0-15" id="h7-0-15" class="d">-    private val context: ModContext,
</a><a href="#h7-0-16" id="h7-0-16" class="d">-) : Manager {
</a><a href="#h7-0-17" id="h7-0-17" class="d">-    private val actions = mutableMapOf&lt;String, AbstractAction&gt;()
</a><a href="#h7-0-18" id="h7-0-18" class="d">-    fun getActions() = actions.values.toList()
</a><a href="#h7-0-19" id="h7-0-19" class="d">-    private fun load(clazz: KClass&lt;out AbstractAction&gt;) {
</a><a href="#h7-0-20" id="h7-0-20" class="d">-        val action = clazz.java.newInstance()
</a><a href="#h7-0-21" id="h7-0-21" class="d">-        action.context = context
</a><a href="#h7-0-22" id="h7-0-22" class="d">-        actions[action.nameKey] = action
</a><a href="#h7-0-23" id="h7-0-23" class="d">-    }
</a><a href="#h7-0-24" id="h7-0-24" class="d">-    override fun init() {
</a><a href="#h7-0-25" id="h7-0-25" class="d">-        load(CleanCache::class)
</a><a href="#h7-0-26" id="h7-0-26" class="d">-        load(ExportChatMessages::class)
</a><a href="#h7-0-27" id="h7-0-27" class="d">-        load(OpenMap::class)
</a><a href="#h7-0-28" id="h7-0-28" class="d">-
</a><a href="#h7-0-29" id="h7-0-29" class="d">-        if(!BuildConfig.DEBUG) {
</a><a href="#h7-0-30" id="h7-0-30" class="d">-            load(CheckForUpdates::class)
</a><a href="#h7-0-31" id="h7-0-31" class="d">-        }
</a><a href="#h7-0-32" id="h7-0-32" class="d">-        else {
</a><a href="#h7-0-33" id="h7-0-33" class="d">-            load(ClearMessageLogger::class)
</a><a href="#h7-0-34" id="h7-0-34" class="d">-            load(RefreshMappings::class)
</a><a href="#h7-0-35" id="h7-0-35" class="d">-        }
</a><a href="#h7-0-36" id="h7-0-36" class="d">-
</a><a href="#h7-0-37" id="h7-0-37" class="d">-
</a><a href="#h7-0-38" id="h7-0-38" class="d">-        actions.values.forEach(AbstractAction::init)
</a><a href="#h7-0-39" id="h7-0-39" class="d">-    }
</a><a href="#h7-0-40" id="h7-0-40" class="d">-}</a><a href="#h7-0-41" id="h7-0-41" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -1,85 +0,0 @@
</a><a href="#h8-0-0" id="h8-0-0" class="d">-package me.rhunk.snapenhance.ui
</a><a href="#h8-0-1" id="h8-0-1" class="d">-
</a><a href="#h8-0-2" id="h8-0-2" class="d">-import android.app.Activity
</a><a href="#h8-0-3" id="h8-0-3" class="d">-import android.app.AlertDialog
</a><a href="#h8-0-4" id="h8-0-4" class="d">-import android.content.Context
</a><a href="#h8-0-5" id="h8-0-5" class="d">-import android.content.Intent
</a><a href="#h8-0-6" id="h8-0-6" class="d">-import android.widget.EditText
</a><a href="#h8-0-7" id="h8-0-7" class="d">-import android.widget.TextView
</a><a href="#h8-0-8" id="h8-0-8" class="d">-import android.widget.Toast
</a><a href="#h8-0-9" id="h8-0-9" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h8-0-10" id="h8-0-10" class="d">-import me.rhunk.snapenhance.SharedContext
</a><a href="#h8-0-11" id="h8-0-11" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h8-0-12" id="h8-0-12" class="d">-import me.rhunk.snapenhance.util.ActivityResultCallback
</a><a href="#h8-0-13" id="h8-0-13" class="d">-import kotlin.math.abs
</a><a href="#h8-0-14" id="h8-0-14" class="d">-import kotlin.random.Random
</a><a href="#h8-0-15" id="h8-0-15" class="d">-
</a><a href="#h8-0-16" id="h8-0-16" class="d">-class ItemHelper(
</a><a href="#h8-0-17" id="h8-0-17" class="d">-    private val context : Context
</a><a href="#h8-0-18" id="h8-0-18" class="d">-) {
</a><a href="#h8-0-19" id="h8-0-19" class="d">-    val positiveButtonText by lazy {
</a><a href="#h8-0-20" id="h8-0-20" class="d">-        SharedContext.translation[&quot;button.ok&quot;]
</a><a href="#h8-0-21" id="h8-0-21" class="d">-    }
</a><a href="#h8-0-22" id="h8-0-22" class="d">-    
</a><a href="#h8-0-23" id="h8-0-23" class="d">-    val cancelButtonText by lazy {
</a><a href="#h8-0-24" id="h8-0-24" class="d">-        SharedContext.translation[&quot;button.cancel&quot;]
</a><a href="#h8-0-25" id="h8-0-25" class="d">-    }
</a><a href="#h8-0-26" id="h8-0-26" class="d">-    
</a><a href="#h8-0-27" id="h8-0-27" class="d">-    fun longToast(message: String, context: Context) {
</a><a href="#h8-0-28" id="h8-0-28" class="d">-        Toast.makeText(context, message, Toast.LENGTH_LONG).show()
</a><a href="#h8-0-29" id="h8-0-29" class="d">-    }
</a><a href="#h8-0-30" id="h8-0-30" class="d">-
</a><a href="#h8-0-31" id="h8-0-31" class="d">-    fun createTranslatedTextView(property: ConfigProperty, shouldTranslatePropertyValue: Boolean = true): TextView {
</a><a href="#h8-0-32" id="h8-0-32" class="d">-        return object: TextView(context) {
</a><a href="#h8-0-33" id="h8-0-33" class="d">-            override fun setText(text: CharSequence?, type: BufferType?) {
</a><a href="#h8-0-34" id="h8-0-34" class="d">-                val newText = text?.takeIf { it.isNotEmpty() }?.let {
</a><a href="#h8-0-35" id="h8-0-35" class="d">-                    if (!shouldTranslatePropertyValue || property.disableValueLocalization) it
</a><a href="#h8-0-36" id="h8-0-36" class="d">-                    else SharedContext.translation[property.getOptionTranslationKey(it.toString())]
</a><a href="#h8-0-37" id="h8-0-37" class="d">-                }?.let {
</a><a href="#h8-0-38" id="h8-0-38" class="d">-                    if (it.length &gt; 20) {
</a><a href="#h8-0-39" id="h8-0-39" class="d">-                        &quot;...${it.substring(it.length - 20)}&quot;
</a><a href="#h8-0-40" id="h8-0-40" class="d">-                    } else {
</a><a href="#h8-0-41" id="h8-0-41" class="d">-                        it
</a><a href="#h8-0-42" id="h8-0-42" class="d">-                    }
</a><a href="#h8-0-43" id="h8-0-43" class="d">-                } ?: &quot;&quot;
</a><a href="#h8-0-44" id="h8-0-44" class="d">-                super.setTextColor(context.getColor(R.color.tertiaryText))
</a><a href="#h8-0-45" id="h8-0-45" class="d">-                super.setText(newText, type)
</a><a href="#h8-0-46" id="h8-0-46" class="d">-            }
</a><a href="#h8-0-47" id="h8-0-47" class="d">-        }
</a><a href="#h8-0-48" id="h8-0-48" class="d">-    }
</a><a href="#h8-0-49" id="h8-0-49" class="d">-
</a><a href="#h8-0-50" id="h8-0-50" class="d">-    fun askForValue(property: ConfigProperty, requestedInputType: Int, callback: (String) -&gt; Unit) {
</a><a href="#h8-0-51" id="h8-0-51" class="d">-        val editText = EditText(context).apply {
</a><a href="#h8-0-52" id="h8-0-52" class="d">-            inputType = requestedInputType
</a><a href="#h8-0-53" id="h8-0-53" class="d">-            setText(property.valueContainer.value().toString())
</a><a href="#h8-0-54" id="h8-0-54" class="d">-        }
</a><a href="#h8-0-55" id="h8-0-55" class="d">-        AlertDialog.Builder(context)
</a><a href="#h8-0-56" id="h8-0-56" class="d">-            .setTitle(SharedContext.translation[&quot;property.${property.translationKey}.name&quot;])
</a><a href="#h8-0-57" id="h8-0-57" class="d">-            .setView(editText)
</a><a href="#h8-0-58" id="h8-0-58" class="d">-            .setPositiveButton(positiveButtonText) { _, _ -&gt;
</a><a href="#h8-0-59" id="h8-0-59" class="d">-                callback(editText.text.toString())
</a><a href="#h8-0-60" id="h8-0-60" class="d">-            }
</a><a href="#h8-0-61" id="h8-0-61" class="d">-            .setNegativeButton(cancelButtonText) { dialog, _ -&gt;
</a><a href="#h8-0-62" id="h8-0-62" class="d">-                dialog.cancel()
</a><a href="#h8-0-63" id="h8-0-63" class="d">-            }
</a><a href="#h8-0-64" id="h8-0-64" class="d">-            .show()
</a><a href="#h8-0-65" id="h8-0-65" class="d">-    }
</a><a href="#h8-0-66" id="h8-0-66" class="d">-
</a><a href="#h8-0-67" id="h8-0-67" class="d">-    fun askForFolder(activity: Activity, property: ConfigProperty, callback: (String) -&gt; Unit): Pair&lt;Int, ActivityResultCallback&gt; {
</a><a href="#h8-0-68" id="h8-0-68" class="d">-        val intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)
</a><a href="#h8-0-69" id="h8-0-69" class="d">-            .addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
</a><a href="#h8-0-70" id="h8-0-70" class="d">-            .addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
</a><a href="#h8-0-71" id="h8-0-71" class="d">-
</a><a href="#h8-0-72" id="h8-0-72" class="d">-        val requestCode = abs(Random.nextInt())
</a><a href="#h8-0-73" id="h8-0-73" class="d">-        activity.startActivityForResult(intent, requestCode)
</a><a href="#h8-0-74" id="h8-0-74" class="d">-
</a><a href="#h8-0-75" id="h8-0-75" class="d">-        return requestCode to let@{_, resultCode, data -&gt;
</a><a href="#h8-0-76" id="h8-0-76" class="d">-            if (resultCode != Activity.RESULT_OK) return@let
</a><a href="#h8-0-77" id="h8-0-77" class="d">-            val uri = data?.data ?: return@let
</a><a href="#h8-0-78" id="h8-0-78" class="d">-            val value = uri.toString()
</a><a href="#h8-0-79" id="h8-0-79" class="d">-            activity.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
</a><a href="#h8-0-80" id="h8-0-80" class="d">-            property.valueContainer.writeFrom(value)
</a><a href="#h8-0-81" id="h8-0-81" class="d">-            callback(value)
</a><a href="#h8-0-82" id="h8-0-82" class="d">-        }
</a><a href="#h8-0-83" id="h8-0-83" class="d">-    }
</a><a href="#h8-0-84" id="h8-0-84" class="d">-}
</a><b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,279 +0,0 @@
</a><a href="#h9-0-0" id="h9-0-0" class="d">-package me.rhunk.snapenhance.ui.config
</a><a href="#h9-0-1" id="h9-0-1" class="d">-
</a><a href="#h9-0-2" id="h9-0-2" class="d">-import android.app.Activity
</a><a href="#h9-0-3" id="h9-0-3" class="d">-import android.app.AlertDialog
</a><a href="#h9-0-4" id="h9-0-4" class="d">-import android.content.Intent
</a><a href="#h9-0-5" id="h9-0-5" class="d">-import android.content.res.ColorStateList
</a><a href="#h9-0-6" id="h9-0-6" class="d">-import android.os.Bundle
</a><a href="#h9-0-7" id="h9-0-7" class="d">-import android.text.Html
</a><a href="#h9-0-8" id="h9-0-8" class="d">-import android.text.InputType
</a><a href="#h9-0-9" id="h9-0-9" class="d">-import android.view.View
</a><a href="#h9-0-10" id="h9-0-10" class="d">-import android.view.ViewGroup
</a><a href="#h9-0-11" id="h9-0-11" class="d">-import android.widget.ImageButton
</a><a href="#h9-0-12" id="h9-0-12" class="d">-import android.widget.Switch
</a><a href="#h9-0-13" id="h9-0-13" class="d">-import android.widget.TextView
</a><a href="#h9-0-14" id="h9-0-14" class="d">-import android.widget.Toast
</a><a href="#h9-0-15" id="h9-0-15" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h9-0-16" id="h9-0-16" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h9-0-17" id="h9-0-17" class="d">-import me.rhunk.snapenhance.SharedContext
</a><a href="#h9-0-18" id="h9-0-18" class="d">-import me.rhunk.snapenhance.config.ConfigCategory
</a><a href="#h9-0-19" id="h9-0-19" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h9-0-20" id="h9-0-20" class="d">-import me.rhunk.snapenhance.config.impl.ConfigIntegerValue
</a><a href="#h9-0-21" id="h9-0-21" class="d">-import me.rhunk.snapenhance.config.impl.ConfigStateListValue
</a><a href="#h9-0-22" id="h9-0-22" class="d">-import me.rhunk.snapenhance.config.impl.ConfigStateSelection
</a><a href="#h9-0-23" id="h9-0-23" class="d">-import me.rhunk.snapenhance.config.impl.ConfigStateValue
</a><a href="#h9-0-24" id="h9-0-24" class="d">-import me.rhunk.snapenhance.config.impl.ConfigStringValue
</a><a href="#h9-0-25" id="h9-0-25" class="d">-import me.rhunk.snapenhance.ui.ItemHelper
</a><a href="#h9-0-26" id="h9-0-26" class="d">-import me.rhunk.snapenhance.util.ActivityResultCallback
</a><a href="#h9-0-27" id="h9-0-27" class="d">-import kotlin.system.exitProcess
</a><a href="#h9-0-28" id="h9-0-28" class="d">-
</a><a href="#h9-0-29" id="h9-0-29" class="d">-
</a><a href="#h9-0-30" id="h9-0-30" class="d">-class ConfigActivity : Activity() {
</a><a href="#h9-0-31" id="h9-0-31" class="d">-    private val itemHelper = ItemHelper(this)
</a><a href="#h9-0-32" id="h9-0-32" class="d">-    private val activityResultCallbacks = mutableMapOf&lt;Int, ActivityResultCallback&gt;()
</a><a href="#h9-0-33" id="h9-0-33" class="d">-
</a><a href="#h9-0-34" id="h9-0-34" class="d">-    @Deprecated(&quot;Deprecated in Java&quot;)
</a><a href="#h9-0-35" id="h9-0-35" class="d">-    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h9-0-36" id="h9-0-36" class="d">-    override fun onBackPressed() {
</a><a href="#h9-0-37" id="h9-0-37" class="d">-        super.onBackPressed()
</a><a href="#h9-0-38" id="h9-0-38" class="d">-        finish()
</a><a href="#h9-0-39" id="h9-0-39" class="d">-    }
</a><a href="#h9-0-40" id="h9-0-40" class="d">-
</a><a href="#h9-0-41" id="h9-0-41" class="d">-    override fun onDestroy() {
</a><a href="#h9-0-42" id="h9-0-42" class="d">-        super.onDestroy()
</a><a href="#h9-0-43" id="h9-0-43" class="d">-        SharedContext.config.writeConfig()
</a><a href="#h9-0-44" id="h9-0-44" class="d">-    }
</a><a href="#h9-0-45" id="h9-0-45" class="d">-
</a><a href="#h9-0-46" id="h9-0-46" class="d">-    override fun onPause() {
</a><a href="#h9-0-47" id="h9-0-47" class="d">-        super.onPause()
</a><a href="#h9-0-48" id="h9-0-48" class="d">-        SharedContext.config.writeConfig()
</a><a href="#h9-0-49" id="h9-0-49" class="d">-    }
</a><a href="#h9-0-50" id="h9-0-50" class="d">-
</a><a href="#h9-0-51" id="h9-0-51" class="d">-    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
</a><a href="#h9-0-52" id="h9-0-52" class="d">-        activityResultCallbacks[requestCode]?.invoke(requestCode, resultCode, data)
</a><a href="#h9-0-53" id="h9-0-53" class="d">-    }
</a><a href="#h9-0-54" id="h9-0-54" class="d">-
</a><a href="#h9-0-55" id="h9-0-55" class="d">-    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h9-0-56" id="h9-0-56" class="d">-        super.onCreate(savedInstanceState)
</a><a href="#h9-0-57" id="h9-0-57" class="d">-        SharedContext.ensureInitialized(this)
</a><a href="#h9-0-58" id="h9-0-58" class="d">-        setContentView(R.layout.config_activity)
</a><a href="#h9-0-59" id="h9-0-59" class="d">-
</a><a href="#h9-0-60" id="h9-0-60" class="d">-        findViewById&lt;View&gt;(R.id.title_bar).let { titleBar -&gt;
</a><a href="#h9-0-61" id="h9-0-61" class="d">-            titleBar.findViewById&lt;TextView&gt;(R.id.title).text = SharedContext.translation[&quot;config_activity.title&quot;]
</a><a href="#h9-0-62" id="h9-0-62" class="d">-            titleBar.findViewById&lt;ImageButton&gt;(R.id.back_button).visibility = View.GONE
</a><a href="#h9-0-63" id="h9-0-63" class="d">-        }
</a><a href="#h9-0-64" id="h9-0-64" class="d">-
</a><a href="#h9-0-65" id="h9-0-65" class="d">-        val propertyListLayout = findViewById&lt;ViewGroup&gt;(R.id.property_list)
</a><a href="#h9-0-66" id="h9-0-66" class="d">-
</a><a href="#h9-0-67" id="h9-0-67" class="d">-        if (intent.getBooleanExtra(&quot;lspatched&quot;, false) ||
</a><a href="#h9-0-68" id="h9-0-68" class="d">-            applicationInfo.packageName != &quot;me.rhunk.snapenhance&quot; ||
</a><a href="#h9-0-69" id="h9-0-69" class="d">-            BuildConfig.DEBUG) {
</a><a href="#h9-0-70" id="h9-0-70" class="d">-            propertyListLayout.addView(
</a><a href="#h9-0-71" id="h9-0-71" class="d">-                layoutInflater.inflate(
</a><a href="#h9-0-72" id="h9-0-72" class="d">-                    R.layout.config_activity_debug_item,
</a><a href="#h9-0-73" id="h9-0-73" class="d">-                    propertyListLayout,
</a><a href="#h9-0-74" id="h9-0-74" class="d">-                    false
</a><a href="#h9-0-75" id="h9-0-75" class="d">-                ).apply {
</a><a href="#h9-0-76" id="h9-0-76" class="d">-                    findViewById&lt;TextView&gt;(R.id.debug_item_content).apply {
</a><a href="#h9-0-77" id="h9-0-77" class="d">-                        text = Html.fromHtml(
</a><a href="#h9-0-78" id="h9-0-78" class="d">-                            &quot;You are using a &lt;u&gt;&lt;b&gt;debug/unofficial&lt;/b&gt;&lt;/u&gt; build!\n&quot; +
</a><a href="#h9-0-79" id="h9-0-79" class="d">-                                    &quot;Please consider downloading stable builds from &lt;a href=\&quot;https://github.com/rhunk/SnapEnhance\&quot;&gt;GitHub&lt;/a&gt;.&quot;,
</a><a href="#h9-0-80" id="h9-0-80" class="d">-                            Html.FROM_HTML_MODE_COMPACT
</a><a href="#h9-0-81" id="h9-0-81" class="d">-                        )
</a><a href="#h9-0-82" id="h9-0-82" class="d">-                        movementMethod = android.text.method.LinkMovementMethod.getInstance()
</a><a href="#h9-0-83" id="h9-0-83" class="d">-                    }
</a><a href="#h9-0-84" id="h9-0-84" class="d">-                })
</a><a href="#h9-0-85" id="h9-0-85" class="d">-        }
</a><a href="#h9-0-86" id="h9-0-86" class="d">-
</a><a href="#h9-0-87" id="h9-0-87" class="d">-        //check if save folder is set
</a><a href="#h9-0-88" id="h9-0-88" class="d">-        //TODO: first run activity
</a><a href="#h9-0-89" id="h9-0-89" class="d">-        run {
</a><a href="#h9-0-90" id="h9-0-90" class="d">-            val saveFolder = SharedContext.config.string(ConfigProperty.SAVE_FOLDER)
</a><a href="#h9-0-91" id="h9-0-91" class="d">-            val itemHelper = ItemHelper(this)
</a><a href="#h9-0-92" id="h9-0-92" class="d">-
</a><a href="#h9-0-93" id="h9-0-93" class="d">-            if (saveFolder.isEmpty() || !saveFolder.startsWith(&quot;content://&quot;)) {
</a><a href="#h9-0-94" id="h9-0-94" class="d">-                AlertDialog.Builder(this)
</a><a href="#h9-0-95" id="h9-0-95" class="d">-                    .setTitle(&quot;Save folder&quot;)
</a><a href="#h9-0-96" id="h9-0-96" class="d">-                    .setMessage(&quot;Please select a folder where you want to save downloaded files.&quot;)
</a><a href="#h9-0-97" id="h9-0-97" class="d">-                    .setPositiveButton(&quot;Select&quot;) { _, _ -&gt;
</a><a href="#h9-0-98" id="h9-0-98" class="d">-                        val (requestCode, callback) = itemHelper.askForFolder(
</a><a href="#h9-0-99" id="h9-0-99" class="d">-                            this,
</a><a href="#h9-0-100" id="h9-0-100" class="d">-                            ConfigProperty.SAVE_FOLDER
</a><a href="#h9-0-101" id="h9-0-101" class="d">-                        ) {}
</a><a href="#h9-0-102" id="h9-0-102" class="d">-                        activityResultCallbacks[requestCode] = { a1, a2, a3 -&gt;
</a><a href="#h9-0-103" id="h9-0-103" class="d">-                            callback(a1, a2, a3)
</a><a href="#h9-0-104" id="h9-0-104" class="d">-                            Toast.makeText(this, &quot;Save Folder set!&quot;, Toast.LENGTH_SHORT).show()
</a><a href="#h9-0-105" id="h9-0-105" class="d">-                            finish()
</a><a href="#h9-0-106" id="h9-0-106" class="d">-                        }
</a><a href="#h9-0-107" id="h9-0-107" class="d">-                    }
</a><a href="#h9-0-108" id="h9-0-108" class="d">-                    .setNegativeButton(&quot;Cancel&quot;) { _, _ -&gt;
</a><a href="#h9-0-109" id="h9-0-109" class="d">-                        exitProcess(0)
</a><a href="#h9-0-110" id="h9-0-110" class="d">-                    }
</a><a href="#h9-0-111" id="h9-0-111" class="d">-                    .show()
</a><a href="#h9-0-112" id="h9-0-112" class="d">-            }
</a><a href="#h9-0-113" id="h9-0-113" class="d">-        }
</a><a href="#h9-0-114" id="h9-0-114" class="d">-
</a><a href="#h9-0-115" id="h9-0-115" class="d">-        var currentCategory: ConfigCategory? = null
</a><a href="#h9-0-116" id="h9-0-116" class="d">-
</a><a href="#h9-0-117" id="h9-0-117" class="d">-        SharedContext.config.entries().filter { !it.key.category.hidden }.forEach { (property, value) -&gt;
</a><a href="#h9-0-118" id="h9-0-118" class="d">-            val configItem = layoutInflater.inflate(R.layout.config_activity_item, propertyListLayout, false)
</a><a href="#h9-0-119" id="h9-0-119" class="d">-
</a><a href="#h9-0-120" id="h9-0-120" class="d">-            fun addSeparator() {
</a><a href="#h9-0-121" id="h9-0-121" class="d">-                //add separator
</a><a href="#h9-0-122" id="h9-0-122" class="d">-                propertyListLayout.addView(View(this).apply {
</a><a href="#h9-0-123" id="h9-0-123" class="d">-                    layoutParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, 1)
</a><a href="#h9-0-124" id="h9-0-124" class="d">-                    setBackgroundColor(getColor(R.color.tertiaryBackground))
</a><a href="#h9-0-125" id="h9-0-125" class="d">-                })
</a><a href="#h9-0-126" id="h9-0-126" class="d">-            }
</a><a href="#h9-0-127" id="h9-0-127" class="d">-
</a><a href="#h9-0-128" id="h9-0-128" class="d">-            if (property.category != currentCategory) {
</a><a href="#h9-0-129" id="h9-0-129" class="d">-                if(!property.shouldAppearInSettings) return@forEach
</a><a href="#h9-0-130" id="h9-0-130" class="d">-                currentCategory = property.category
</a><a href="#h9-0-131" id="h9-0-131" class="d">-                with(layoutInflater.inflate(R.layout.config_activity_item, propertyListLayout, false)) {
</a><a href="#h9-0-132" id="h9-0-132" class="d">-                    findViewById&lt;TextView&gt;(R.id.name).apply {
</a><a href="#h9-0-133" id="h9-0-133" class="d">-                        text = SharedContext.translation[&quot;category.${property.category.key}&quot;]
</a><a href="#h9-0-134" id="h9-0-134" class="d">-                        textSize = 20f
</a><a href="#h9-0-135" id="h9-0-135" class="d">-                        typeface = typeface?.let { android.graphics.Typeface.create(it, android.graphics.Typeface.BOLD) }
</a><a href="#h9-0-136" id="h9-0-136" class="d">-                    }
</a><a href="#h9-0-137" id="h9-0-137" class="d">-                    propertyListLayout.addView(this)
</a><a href="#h9-0-138" id="h9-0-138" class="d">-                }
</a><a href="#h9-0-139" id="h9-0-139" class="d">-                addSeparator()
</a><a href="#h9-0-140" id="h9-0-140" class="d">-            }
</a><a href="#h9-0-141" id="h9-0-141" class="d">-
</a><a href="#h9-0-142" id="h9-0-142" class="d">-            if (!property.shouldAppearInSettings) return@forEach
</a><a href="#h9-0-143" id="h9-0-143" class="d">-
</a><a href="#h9-0-144" id="h9-0-144" class="d">-            val propertyName = SharedContext.translation[&quot;property.${property.translationKey}.name&quot;]
</a><a href="#h9-0-145" id="h9-0-145" class="d">-
</a><a href="#h9-0-146" id="h9-0-146" class="d">-            configItem.findViewById&lt;TextView&gt;(R.id.name).text = propertyName
</a><a href="#h9-0-147" id="h9-0-147" class="d">-            configItem.findViewById&lt;TextView&gt;(R.id.description).also {
</a><a href="#h9-0-148" id="h9-0-148" class="d">-                it.text = SharedContext.translation[&quot;property.${property.translationKey}.description&quot;]
</a><a href="#h9-0-149" id="h9-0-149" class="d">-                it.visibility = if (it.text.isEmpty()) View.GONE else View.VISIBLE
</a><a href="#h9-0-150" id="h9-0-150" class="d">-            }
</a><a href="#h9-0-151" id="h9-0-151" class="d">-
</a><a href="#h9-0-152" id="h9-0-152" class="d">-            fun addValueView(view: View) {
</a><a href="#h9-0-153" id="h9-0-153" class="d">-                configItem.findViewById&lt;ViewGroup&gt;(R.id.value).addView(view)
</a><a href="#h9-0-154" id="h9-0-154" class="d">-            }
</a><a href="#h9-0-155" id="h9-0-155" class="d">-
</a><a href="#h9-0-156" id="h9-0-156" class="d">-            when (value) {
</a><a href="#h9-0-157" id="h9-0-157" class="d">-                is ConfigStateValue -&gt; {
</a><a href="#h9-0-158" id="h9-0-158" class="d">-                    val switch = Switch(this)
</a><a href="#h9-0-159" id="h9-0-159" class="d">-                    switch.isChecked = value.value()
</a><a href="#h9-0-160" id="h9-0-160" class="d">-                    switch.trackTintList = ColorStateList(
</a><a href="#h9-0-161" id="h9-0-161" class="d">-                        arrayOf(
</a><a href="#h9-0-162" id="h9-0-162" class="d">-                            intArrayOf(android.R.attr.state_checked),
</a><a href="#h9-0-163" id="h9-0-163" class="d">-                            intArrayOf(-android.R.attr.state_checked)
</a><a href="#h9-0-164" id="h9-0-164" class="d">-                        ),
</a><a href="#h9-0-165" id="h9-0-165" class="d">-                        intArrayOf(
</a><a href="#h9-0-166" id="h9-0-166" class="d">-                            switch.highlightColor,
</a><a href="#h9-0-167" id="h9-0-167" class="d">-                            getColor(R.color.tertiaryBackground)
</a><a href="#h9-0-168" id="h9-0-168" class="d">-                        )
</a><a href="#h9-0-169" id="h9-0-169" class="d">-                    )
</a><a href="#h9-0-170" id="h9-0-170" class="d">-                    switch.setOnCheckedChangeListener { _, isChecked -&gt;
</a><a href="#h9-0-171" id="h9-0-171" class="d">-                        value.writeFrom(isChecked.toString())
</a><a href="#h9-0-172" id="h9-0-172" class="d">-                    }
</a><a href="#h9-0-173" id="h9-0-173" class="d">-                    configItem.setOnClickListener { switch.toggle() }
</a><a href="#h9-0-174" id="h9-0-174" class="d">-                    addValueView(switch)
</a><a href="#h9-0-175" id="h9-0-175" class="d">-                }
</a><a href="#h9-0-176" id="h9-0-176" class="d">-                is ConfigStringValue, is ConfigIntegerValue -&gt; {
</a><a href="#h9-0-177" id="h9-0-177" class="d">-                    val textView = itemHelper.createTranslatedTextView(property, shouldTranslatePropertyValue = false).also {
</a><a href="#h9-0-178" id="h9-0-178" class="d">-                        it.text = value.value().toString()
</a><a href="#h9-0-179" id="h9-0-179" class="d">-                    }
</a><a href="#h9-0-180" id="h9-0-180" class="d">-                    configItem.setOnClickListener {
</a><a href="#h9-0-181" id="h9-0-181" class="d">-                        if (value is ConfigStringValue &amp;&amp; value.isFolderPath) {
</a><a href="#h9-0-182" id="h9-0-182" class="d">-                            val (requestCode, callback) = itemHelper.askForFolder(this, property) {
</a><a href="#h9-0-183" id="h9-0-183" class="d">-                                value.writeFrom(it)
</a><a href="#h9-0-184" id="h9-0-184" class="d">-                                textView.text = value.value()
</a><a href="#h9-0-185" id="h9-0-185" class="d">-                            }
</a><a href="#h9-0-186" id="h9-0-186" class="d">-
</a><a href="#h9-0-187" id="h9-0-187" class="d">-                            activityResultCallbacks[requestCode] = callback
</a><a href="#h9-0-188" id="h9-0-188" class="d">-                            return@setOnClickListener
</a><a href="#h9-0-189" id="h9-0-189" class="d">-                        }
</a><a href="#h9-0-190" id="h9-0-190" class="d">-
</a><a href="#h9-0-191" id="h9-0-191" class="d">-                        if (value is ConfigIntegerValue) {
</a><a href="#h9-0-192" id="h9-0-192" class="d">-                            itemHelper.askForValue(property, InputType.TYPE_CLASS_NUMBER) {
</a><a href="#h9-0-193" id="h9-0-193" class="d">-                                try {
</a><a href="#h9-0-194" id="h9-0-194" class="d">-                                    value.writeFrom(it)
</a><a href="#h9-0-195" id="h9-0-195" class="d">-                                    textView.text = value.value().toString()
</a><a href="#h9-0-196" id="h9-0-196" class="d">-                                } catch (e: NumberFormatException) {
</a><a href="#h9-0-197" id="h9-0-197" class="d">-                                    itemHelper.longToast(SharedContext.translation[&quot;config_activity.invalid_number_toast&quot;], this)
</a><a href="#h9-0-198" id="h9-0-198" class="d">-                                }
</a><a href="#h9-0-199" id="h9-0-199" class="d">-                            }
</a><a href="#h9-0-200" id="h9-0-200" class="d">-                            return@setOnClickListener
</a><a href="#h9-0-201" id="h9-0-201" class="d">-                        }
</a><a href="#h9-0-202" id="h9-0-202" class="d">-                        itemHelper.askForValue(property, InputType.TYPE_CLASS_TEXT) {
</a><a href="#h9-0-203" id="h9-0-203" class="d">-                            value.writeFrom(it)
</a><a href="#h9-0-204" id="h9-0-204" class="d">-                            textView.text = value.value().toString()
</a><a href="#h9-0-205" id="h9-0-205" class="d">-                        }
</a><a href="#h9-0-206" id="h9-0-206" class="d">-                    }
</a><a href="#h9-0-207" id="h9-0-207" class="d">-                    addValueView(textView)
</a><a href="#h9-0-208" id="h9-0-208" class="d">-                }
</a><a href="#h9-0-209" id="h9-0-209" class="d">-                is ConfigStateListValue -&gt; {
</a><a href="#h9-0-210" id="h9-0-210" class="d">-                    val textView = itemHelper.createTranslatedTextView(property, shouldTranslatePropertyValue = false)
</a><a href="#h9-0-211" id="h9-0-211" class="d">-                    val values = value.value()
</a><a href="#h9-0-212" id="h9-0-212" class="d">-
</a><a href="#h9-0-213" id="h9-0-213" class="d">-                    fun updateText() {
</a><a href="#h9-0-214" id="h9-0-214" class="d">-                        textView.text = SharedContext.translation.format(&quot;config_activity.selected_text&quot;, &quot;count&quot; to values.filter { it.value }.size.toString())
</a><a href="#h9-0-215" id="h9-0-215" class="d">-                    }
</a><a href="#h9-0-216" id="h9-0-216" class="d">-
</a><a href="#h9-0-217" id="h9-0-217" class="d">-                    updateText()
</a><a href="#h9-0-218" id="h9-0-218" class="d">-
</a><a href="#h9-0-219" id="h9-0-219" class="d">-                    configItem.setOnClickListener {
</a><a href="#h9-0-220" id="h9-0-220" class="d">-                        AlertDialog.Builder(this)
</a><a href="#h9-0-221" id="h9-0-221" class="d">-                            .setTitle(propertyName)
</a><a href="#h9-0-222" id="h9-0-222" class="d">-                            .setPositiveButton(itemHelper.positiveButtonText) { _, _ -&gt;
</a><a href="#h9-0-223" id="h9-0-223" class="d">-                                updateText()
</a><a href="#h9-0-224" id="h9-0-224" class="d">-                            }
</a><a href="#h9-0-225" id="h9-0-225" class="d">-                            .setMultiChoiceItems(
</a><a href="#h9-0-226" id="h9-0-226" class="d">-                                values.keys.map {
</a><a href="#h9-0-227" id="h9-0-227" class="d">-                                    if (property.disableValueLocalization) it
</a><a href="#h9-0-228" id="h9-0-228" class="d">-                                    else SharedContext.translation[property.getOptionTranslationKey(it)]
</a><a href="#h9-0-229" id="h9-0-229" class="d">-                                }.toTypedArray(),
</a><a href="#h9-0-230" id="h9-0-230" class="d">-                                values.map { it.value }.toBooleanArray()
</a><a href="#h9-0-231" id="h9-0-231" class="d">-                            ) { _, which, isChecked -&gt;
</a><a href="#h9-0-232" id="h9-0-232" class="d">-                                value.setKey(values.keys.elementAt(which), isChecked)
</a><a href="#h9-0-233" id="h9-0-233" class="d">-                            }
</a><a href="#h9-0-234" id="h9-0-234" class="d">-                            .show()
</a><a href="#h9-0-235" id="h9-0-235" class="d">-                    }
</a><a href="#h9-0-236" id="h9-0-236" class="d">-
</a><a href="#h9-0-237" id="h9-0-237" class="d">-                    addValueView(textView)
</a><a href="#h9-0-238" id="h9-0-238" class="d">-                }
</a><a href="#h9-0-239" id="h9-0-239" class="d">-                is ConfigStateSelection -&gt; {
</a><a href="#h9-0-240" id="h9-0-240" class="d">-                    val textView = itemHelper.createTranslatedTextView(property, shouldTranslatePropertyValue = true)
</a><a href="#h9-0-241" id="h9-0-241" class="d">-                    textView.text = value.value()
</a><a href="#h9-0-242" id="h9-0-242" class="d">-
</a><a href="#h9-0-243" id="h9-0-243" class="d">-                    configItem.setOnClickListener {
</a><a href="#h9-0-244" id="h9-0-244" class="d">-                        val builder = AlertDialog.Builder(this)
</a><a href="#h9-0-245" id="h9-0-245" class="d">-                        builder.setTitle(propertyName)
</a><a href="#h9-0-246" id="h9-0-246" class="d">-
</a><a href="#h9-0-247" id="h9-0-247" class="d">-                        builder.setSingleChoiceItems(
</a><a href="#h9-0-248" id="h9-0-248" class="d">-                            value.keys().toTypedArray().map {
</a><a href="#h9-0-249" id="h9-0-249" class="d">-                                if (property.disableValueLocalization) it
</a><a href="#h9-0-250" id="h9-0-250" class="d">-                                else SharedContext.translation[property.getOptionTranslationKey(it)]
</a><a href="#h9-0-251" id="h9-0-251" class="d">-                            }.toTypedArray(),
</a><a href="#h9-0-252" id="h9-0-252" class="d">-                            value.keys().indexOf(value.value())
</a><a href="#h9-0-253" id="h9-0-253" class="d">-                        ) { _, which -&gt;
</a><a href="#h9-0-254" id="h9-0-254" class="d">-                            value.writeFrom(value.keys()[which])
</a><a href="#h9-0-255" id="h9-0-255" class="d">-                        }
</a><a href="#h9-0-256" id="h9-0-256" class="d">-
</a><a href="#h9-0-257" id="h9-0-257" class="d">-                        builder.setPositiveButton(itemHelper.positiveButtonText) { _, _ -&gt;
</a><a href="#h9-0-258" id="h9-0-258" class="d">-                            textView.text = value.value()
</a><a href="#h9-0-259" id="h9-0-259" class="d">-                        }
</a><a href="#h9-0-260" id="h9-0-260" class="d">-
</a><a href="#h9-0-261" id="h9-0-261" class="d">-                        builder.show()
</a><a href="#h9-0-262" id="h9-0-262" class="d">-                    }
</a><a href="#h9-0-263" id="h9-0-263" class="d">-                    addValueView(textView)
</a><a href="#h9-0-264" id="h9-0-264" class="d">-                }
</a><a href="#h9-0-265" id="h9-0-265" class="d">-            }
</a><a href="#h9-0-266" id="h9-0-266" class="d">-
</a><a href="#h9-0-267" id="h9-0-267" class="d">-            propertyListLayout.addView(configItem)
</a><a href="#h9-0-268" id="h9-0-268" class="d">-            addSeparator()
</a><a href="#h9-0-269" id="h9-0-269" class="d">-        }
</a><a href="#h9-0-270" id="h9-0-270" class="d">-
</a><a href="#h9-0-271" id="h9-0-271" class="d">-        propertyListLayout.addView(layoutInflater.inflate(R.layout.config_activity_debug_item, propertyListLayout, false).apply {
</a><a href="#h9-0-272" id="h9-0-272" class="d">-            findViewById&lt;TextView&gt;(R.id.debug_item_content).apply {
</a><a href="#h9-0-273" id="h9-0-273" class="d">-                text = Html.fromHtml(&quot;Made by rhunk on &lt;a href=\&quot;https://github.com/rhunk/SnapEnhance\&quot;&gt;GitHub&lt;/a&gt;&quot;, Html.FROM_HTML_MODE_COMPACT)
</a><a href="#h9-0-274" id="h9-0-274" class="d">-                movementMethod = android.text.method.LinkMovementMethod.getInstance()
</a><a href="#h9-0-275" id="h9-0-275" class="d">-            }
</a><a href="#h9-0-276" id="h9-0-276" class="d">-        })
</a><a href="#h9-0-277" id="h9-0-277" class="d">-    }
</a><a href="#h9-0-278" id="h9-0-278" class="d">-}</a><a href="#h9-0-279" id="h9-0-279" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -1,113 +0,0 @@
</a><a href="#h10-0-0" id="h10-0-0" class="d">-package me.rhunk.snapenhance.ui.download
</a><a href="#h10-0-1" id="h10-0-1" class="d">-
</a><a href="#h10-0-2" id="h10-0-2" class="d">-import android.app.AlertDialog
</a><a href="#h10-0-3" id="h10-0-3" class="d">-import android.content.Intent
</a><a href="#h10-0-4" id="h10-0-4" class="d">-import android.view.View
</a><a href="#h10-0-5" id="h10-0-5" class="d">-import android.view.ViewGroup
</a><a href="#h10-0-6" id="h10-0-6" class="d">-import android.widget.ArrayAdapter
</a><a href="#h10-0-7" id="h10-0-7" class="d">-import android.widget.ImageButton
</a><a href="#h10-0-8" id="h10-0-8" class="d">-import android.widget.ListView
</a><a href="#h10-0-9" id="h10-0-9" class="d">-import android.widget.TextView
</a><a href="#h10-0-10" id="h10-0-10" class="d">-import android.widget.Toast
</a><a href="#h10-0-11" id="h10-0-11" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h10-0-12" id="h10-0-12" class="d">-import me.rhunk.snapenhance.SharedContext
</a><a href="#h10-0-13" id="h10-0-13" class="d">-import me.rhunk.snapenhance.bridge.types.BridgeFileType
</a><a href="#h10-0-14" id="h10-0-14" class="d">-import me.rhunk.snapenhance.ui.config.ConfigActivity
</a><a href="#h10-0-15" id="h10-0-15" class="d">-import me.rhunk.snapenhance.ui.spoof.DeviceSpooferActivity
</a><a href="#h10-0-16" id="h10-0-16" class="d">-import java.io.File
</a><a href="#h10-0-17" id="h10-0-17" class="d">-
</a><a href="#h10-0-18" id="h10-0-18" class="d">-class ActionListAdapter(
</a><a href="#h10-0-19" id="h10-0-19" class="d">-    private val activity: DownloadManagerActivity,
</a><a href="#h10-0-20" id="h10-0-20" class="d">-    private val layoutId: Int,
</a><a href="#h10-0-21" id="h10-0-21" class="d">-    private val actions: Array&lt;Pair&lt;String, () -&gt; Unit&gt;&gt;
</a><a href="#h10-0-22" id="h10-0-22" class="d">-) : ArrayAdapter&lt;Pair&lt;String, () -&gt; Unit&gt;&gt;(activity, layoutId, actions) {
</a><a href="#h10-0-23" id="h10-0-23" class="d">-    override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {
</a><a href="#h10-0-24" id="h10-0-24" class="d">-        val view = convertView ?: activity.layoutInflater.inflate(layoutId, parent, false)
</a><a href="#h10-0-25" id="h10-0-25" class="d">-        val action = actions[position]
</a><a href="#h10-0-26" id="h10-0-26" class="d">-        view.isClickable = true
</a><a href="#h10-0-27" id="h10-0-27" class="d">-
</a><a href="#h10-0-28" id="h10-0-28" class="d">-        view.findViewById&lt;TextView&gt;(R.id.feature_text).text = action.first
</a><a href="#h10-0-29" id="h10-0-29" class="d">-        view.setOnClickListener {
</a><a href="#h10-0-30" id="h10-0-30" class="d">-            action.second()
</a><a href="#h10-0-31" id="h10-0-31" class="d">-        }
</a><a href="#h10-0-32" id="h10-0-32" class="d">-
</a><a href="#h10-0-33" id="h10-0-33" class="d">-        return view
</a><a href="#h10-0-34" id="h10-0-34" class="d">-    }
</a><a href="#h10-0-35" id="h10-0-35" class="d">-}
</a><a href="#h10-0-36" id="h10-0-36" class="d">-
</a><a href="#h10-0-37" id="h10-0-37" class="d">-class DebugSettingsLayoutInflater(
</a><a href="#h10-0-38" id="h10-0-38" class="d">-    private val activity: DownloadManagerActivity
</a><a href="#h10-0-39" id="h10-0-39" class="d">-) {
</a><a href="#h10-0-40" id="h10-0-40" class="d">-    private fun confirmAction(title: String, message: String, action: () -&gt; Unit) {
</a><a href="#h10-0-41" id="h10-0-41" class="d">-        activity.runOnUiThread {
</a><a href="#h10-0-42" id="h10-0-42" class="d">-            AlertDialog.Builder(activity)
</a><a href="#h10-0-43" id="h10-0-43" class="d">-                .setTitle(title)
</a><a href="#h10-0-44" id="h10-0-44" class="d">-                .setMessage(message)
</a><a href="#h10-0-45" id="h10-0-45" class="d">-                .setPositiveButton(SharedContext.translation[&quot;button.positive&quot;]) { _, _ -&gt;
</a><a href="#h10-0-46" id="h10-0-46" class="d">-                    action()
</a><a href="#h10-0-47" id="h10-0-47" class="d">-                }
</a><a href="#h10-0-48" id="h10-0-48" class="d">-                .setNegativeButton(SharedContext.translation[&quot;button.negative&quot;]) { _, _ -&gt; }
</a><a href="#h10-0-49" id="h10-0-49" class="d">-                .show()
</a><a href="#h10-0-50" id="h10-0-50" class="d">-        }
</a><a href="#h10-0-51" id="h10-0-51" class="d">-    }
</a><a href="#h10-0-52" id="h10-0-52" class="d">-
</a><a href="#h10-0-53" id="h10-0-53" class="d">-    private fun showSuccessToast() {
</a><a href="#h10-0-54" id="h10-0-54" class="d">-        Toast.makeText(activity, &quot;Success&quot;, Toast.LENGTH_SHORT).show()
</a><a href="#h10-0-55" id="h10-0-55" class="d">-    }
</a><a href="#h10-0-56" id="h10-0-56" class="d">-
</a><a href="#h10-0-57" id="h10-0-57" class="d">-    fun inflate(parent: ViewGroup) {
</a><a href="#h10-0-58" id="h10-0-58" class="d">-        val debugSettingsLayout = activity.layoutInflater.inflate(R.layout.debug_settings_page, parent, false)
</a><a href="#h10-0-59" id="h10-0-59" class="d">-
</a><a href="#h10-0-60" id="h10-0-60" class="d">-        val debugSettingsTranslation = activity.translation.getCategory(&quot;debug_settings_page&quot;)
</a><a href="#h10-0-61" id="h10-0-61" class="d">-
</a><a href="#h10-0-62" id="h10-0-62" class="d">-        debugSettingsLayout.findViewById&lt;ImageButton&gt;(R.id.back_button).setOnClickListener {
</a><a href="#h10-0-63" id="h10-0-63" class="d">-            parent.removeView(debugSettingsLayout)
</a><a href="#h10-0-64" id="h10-0-64" class="d">-        }
</a><a href="#h10-0-65" id="h10-0-65" class="d">-
</a><a href="#h10-0-66" id="h10-0-66" class="d">-        debugSettingsLayout.findViewById&lt;TextView&gt;(R.id.title).text = activity.translation[&quot;debug_settings&quot;]
</a><a href="#h10-0-67" id="h10-0-67" class="d">-
</a><a href="#h10-0-68" id="h10-0-68" class="d">-        debugSettingsLayout.findViewById&lt;ListView&gt;(R.id.setting_page_list).apply {
</a><a href="#h10-0-69" id="h10-0-69" class="d">-            adapter = ActionListAdapter(activity, R.layout.debug_setting_item, mutableListOf&lt;Pair&lt;String, () -&gt; Unit&gt;&gt;().apply {
</a><a href="#h10-0-70" id="h10-0-70" class="d">-                add(SharedContext.translation[&quot;config_activity.title&quot;] to {
</a><a href="#h10-0-71" id="h10-0-71" class="d">-                    activity.startActivity(Intent(activity, ConfigActivity::class.java))
</a><a href="#h10-0-72" id="h10-0-72" class="d">-                })
</a><a href="#h10-0-73" id="h10-0-73" class="d">-                add(SharedContext.translation[&quot;spoof_activity.title&quot;] to {
</a><a href="#h10-0-74" id="h10-0-74" class="d">-                    activity.startActivity(Intent(activity, DeviceSpooferActivity::class.java))
</a><a href="#h10-0-75" id="h10-0-75" class="d">-                })
</a><a href="#h10-0-76" id="h10-0-76" class="d">-                add(debugSettingsTranslation[&quot;clear_cache_title&quot;] to {
</a><a href="#h10-0-77" id="h10-0-77" class="d">-                    context.cacheDir.listFiles()?.forEach {
</a><a href="#h10-0-78" id="h10-0-78" class="d">-                        it.deleteRecursively()
</a><a href="#h10-0-79" id="h10-0-79" class="d">-                    }
</a><a href="#h10-0-80" id="h10-0-80" class="d">-                    showSuccessToast()
</a><a href="#h10-0-81" id="h10-0-81" class="d">-                })
</a><a href="#h10-0-82" id="h10-0-82" class="d">-
</a><a href="#h10-0-83" id="h10-0-83" class="d">-                BridgeFileType.values().forEach { fileType -&gt;
</a><a href="#h10-0-84" id="h10-0-84" class="d">-                    val actionName = debugSettingsTranslation.format(&quot;clear_file_title&quot;, &quot;file_name&quot; to fileType.displayName)
</a><a href="#h10-0-85" id="h10-0-85" class="d">-                    add(actionName to {
</a><a href="#h10-0-86" id="h10-0-86" class="d">-                        confirmAction(actionName, debugSettingsTranslation.format(&quot;clear_file_confirmation&quot;, &quot;file_name&quot; to fileType.displayName)) {
</a><a href="#h10-0-87" id="h10-0-87" class="d">-                            fileType.resolve(context).deleteRecursively()
</a><a href="#h10-0-88" id="h10-0-88" class="d">-                            showSuccessToast()
</a><a href="#h10-0-89" id="h10-0-89" class="d">-                        }
</a><a href="#h10-0-90" id="h10-0-90" class="d">-                    })
</a><a href="#h10-0-91" id="h10-0-91" class="d">-                }
</a><a href="#h10-0-92" id="h10-0-92" class="d">-
</a><a href="#h10-0-93" id="h10-0-93" class="d">-                add(debugSettingsTranslation[&quot;reset_all_title&quot;] to {
</a><a href="#h10-0-94" id="h10-0-94" class="d">-                    confirmAction(debugSettingsTranslation[&quot;reset_all_title&quot;], debugSettingsTranslation[&quot;reset_all_confirmation&quot;]) {
</a><a href="#h10-0-95" id="h10-0-95" class="d">-                        arrayOf(context.cacheDir, context.filesDir, File(context.dataDir, &quot;databases&quot;), File(context.dataDir, &quot;shared_prefs&quot;)).forEach {
</a><a href="#h10-0-96" id="h10-0-96" class="d">-                            it.listFiles()?.forEach { file -&gt;
</a><a href="#h10-0-97" id="h10-0-97" class="d">-                                file.deleteRecursively()
</a><a href="#h10-0-98" id="h10-0-98" class="d">-                            }
</a><a href="#h10-0-99" id="h10-0-99" class="d">-                        }
</a><a href="#h10-0-100" id="h10-0-100" class="d">-                        showSuccessToast()
</a><a href="#h10-0-101" id="h10-0-101" class="d">-                    }
</a><a href="#h10-0-102" id="h10-0-102" class="d">-                })
</a><a href="#h10-0-103" id="h10-0-103" class="d">-            }.toTypedArray())
</a><a href="#h10-0-104" id="h10-0-104" class="d">-        }
</a><a href="#h10-0-105" id="h10-0-105" class="d">-
</a><a href="#h10-0-106" id="h10-0-106" class="d">-        activity.registerBackCallback {
</a><a href="#h10-0-107" id="h10-0-107" class="d">-            parent.removeView(debugSettingsLayout)
</a><a href="#h10-0-108" id="h10-0-108" class="d">-        }
</a><a href="#h10-0-109" id="h10-0-109" class="d">-
</a><a href="#h10-0-110" id="h10-0-110" class="d">-        parent.addView(debugSettingsLayout)
</a><a href="#h10-0-111" id="h10-0-111" class="d">-    }
</a><a href="#h10-0-112" id="h10-0-112" class="d">-}</a><a href="#h10-0-113" id="h10-0-113" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -1,242 +0,0 @@
</a><a href="#h11-0-0" id="h11-0-0" class="d">-package me.rhunk.snapenhance.ui.download
</a><a href="#h11-0-1" id="h11-0-1" class="d">-
</a><a href="#h11-0-2" id="h11-0-2" class="d">-import android.annotation.SuppressLint
</a><a href="#h11-0-3" id="h11-0-3" class="d">-import android.content.Intent
</a><a href="#h11-0-4" id="h11-0-4" class="d">-import android.graphics.Bitmap
</a><a href="#h11-0-5" id="h11-0-5" class="d">-import android.graphics.BitmapFactory
</a><a href="#h11-0-6" id="h11-0-6" class="d">-import android.net.Uri
</a><a href="#h11-0-7" id="h11-0-7" class="d">-import android.os.Handler
</a><a href="#h11-0-8" id="h11-0-8" class="d">-import android.view.LayoutInflater
</a><a href="#h11-0-9" id="h11-0-9" class="d">-import android.view.View
</a><a href="#h11-0-10" id="h11-0-10" class="d">-import android.view.ViewGroup
</a><a href="#h11-0-11" id="h11-0-11" class="d">-import android.widget.Button
</a><a href="#h11-0-12" id="h11-0-12" class="d">-import android.widget.ImageView
</a><a href="#h11-0-13" id="h11-0-13" class="d">-import android.widget.TextView
</a><a href="#h11-0-14" id="h11-0-14" class="d">-import android.widget.Toast
</a><a href="#h11-0-15" id="h11-0-15" class="d">-import androidx.core.graphics.drawable.RoundedBitmapDrawableFactory
</a><a href="#h11-0-16" id="h11-0-16" class="d">-import androidx.recyclerview.widget.RecyclerView
</a><a href="#h11-0-17" id="h11-0-17" class="d">-import androidx.recyclerview.widget.RecyclerView.Adapter
</a><a href="#h11-0-18" id="h11-0-18" class="d">-import kotlinx.coroutines.CoroutineScope
</a><a href="#h11-0-19" id="h11-0-19" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h11-0-20" id="h11-0-20" class="d">-import kotlinx.coroutines.Job
</a><a href="#h11-0-21" id="h11-0-21" class="d">-import kotlinx.coroutines.job
</a><a href="#h11-0-22" id="h11-0-22" class="d">-import kotlinx.coroutines.launch
</a><a href="#h11-0-23" id="h11-0-23" class="d">-import kotlinx.coroutines.withTimeout
</a><a href="#h11-0-24" id="h11-0-24" class="d">-import me.rhunk.snapenhance.Logger
</a><a href="#h11-0-25" id="h11-0-25" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h11-0-26" id="h11-0-26" class="d">-import me.rhunk.snapenhance.SharedContext
</a><a href="#h11-0-27" id="h11-0-27" class="d">-import me.rhunk.snapenhance.data.FileType
</a><a href="#h11-0-28" id="h11-0-28" class="d">-import me.rhunk.snapenhance.download.data.PendingDownload
</a><a href="#h11-0-29" id="h11-0-29" class="d">-import me.rhunk.snapenhance.download.enums.DownloadStage
</a><a href="#h11-0-30" id="h11-0-30" class="d">-import me.rhunk.snapenhance.util.snap.PreviewUtils
</a><a href="#h11-0-31" id="h11-0-31" class="d">-import java.io.File
</a><a href="#h11-0-32" id="h11-0-32" class="d">-import java.io.FileInputStream
</a><a href="#h11-0-33" id="h11-0-33" class="d">-import java.net.URL
</a><a href="#h11-0-34" id="h11-0-34" class="d">-import kotlin.concurrent.thread
</a><a href="#h11-0-35" id="h11-0-35" class="d">-import kotlin.coroutines.coroutineContext
</a><a href="#h11-0-36" id="h11-0-36" class="d">-
</a><a href="#h11-0-37" id="h11-0-37" class="d">-class DownloadListAdapter(
</a><a href="#h11-0-38" id="h11-0-38" class="d">-    private val activity: DownloadManagerActivity,
</a><a href="#h11-0-39" id="h11-0-39" class="d">-    private val downloadList: MutableList&lt;PendingDownload&gt;
</a><a href="#h11-0-40" id="h11-0-40" class="d">-): Adapter&lt;DownloadListAdapter.ViewHolder&gt;() {
</a><a href="#h11-0-41" id="h11-0-41" class="d">-    private val coroutineScope = CoroutineScope(Dispatchers.IO)
</a><a href="#h11-0-42" id="h11-0-42" class="d">-    private val previewJobs = mutableMapOf&lt;Int, Job&gt;()
</a><a href="#h11-0-43" id="h11-0-43" class="d">-
</a><a href="#h11-0-44" id="h11-0-44" class="d">-    inner class ViewHolder(val view: View) : RecyclerView.ViewHolder(view) {
</a><a href="#h11-0-45" id="h11-0-45" class="d">-        val bitmojiIcon: ImageView = view.findViewById(R.id.bitmoji_icon)
</a><a href="#h11-0-46" id="h11-0-46" class="d">-        val title: TextView = view.findViewById(R.id.item_title)
</a><a href="#h11-0-47" id="h11-0-47" class="d">-        val subtitle: TextView = view.findViewById(R.id.item_subtitle)
</a><a href="#h11-0-48" id="h11-0-48" class="d">-        val status: TextView = view.findViewById(R.id.item_status)
</a><a href="#h11-0-49" id="h11-0-49" class="d">-        val actionButton: Button = view.findViewById(R.id.item_action_button)
</a><a href="#h11-0-50" id="h11-0-50" class="d">-        val radius by lazy {
</a><a href="#h11-0-51" id="h11-0-51" class="d">-            view.context.resources.getDimensionPixelSize(R.dimen.download_manager_item_preview_radius)
</a><a href="#h11-0-52" id="h11-0-52" class="d">-        }
</a><a href="#h11-0-53" id="h11-0-53" class="d">-        val viewWidth by lazy {
</a><a href="#h11-0-54" id="h11-0-54" class="d">-            view.resources.displayMetrics.widthPixels
</a><a href="#h11-0-55" id="h11-0-55" class="d">-        }
</a><a href="#h11-0-56" id="h11-0-56" class="d">-        val viewHeight by lazy {
</a><a href="#h11-0-57" id="h11-0-57" class="d">-            view.layoutParams.height
</a><a href="#h11-0-58" id="h11-0-58" class="d">-        }
</a><a href="#h11-0-59" id="h11-0-59" class="d">-    }
</a><a href="#h11-0-60" id="h11-0-60" class="d">-
</a><a href="#h11-0-61" id="h11-0-61" class="d">-    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
</a><a href="#h11-0-62" id="h11-0-62" class="d">-        return ViewHolder(LayoutInflater.from(parent.context).inflate(R.layout.download_manager_item, parent, false))
</a><a href="#h11-0-63" id="h11-0-63" class="d">-    }
</a><a href="#h11-0-64" id="h11-0-64" class="d">-
</a><a href="#h11-0-65" id="h11-0-65" class="d">-    override fun getItemCount(): Int {
</a><a href="#h11-0-66" id="h11-0-66" class="d">-        return downloadList.size
</a><a href="#h11-0-67" id="h11-0-67" class="d">-    }
</a><a href="#h11-0-68" id="h11-0-68" class="d">-
</a><a href="#h11-0-69" id="h11-0-69" class="d">-    @SuppressLint(&quot;Recycle&quot;)
</a><a href="#h11-0-70" id="h11-0-70" class="d">-    private suspend fun handlePreview(download: PendingDownload, holder: ViewHolder) {
</a><a href="#h11-0-71" id="h11-0-71" class="d">-        download.outputFile?.let {
</a><a href="#h11-0-72" id="h11-0-72" class="d">-            val uri = Uri.parse(it)
</a><a href="#h11-0-73" id="h11-0-73" class="d">-            runCatching {
</a><a href="#h11-0-74" id="h11-0-74" class="d">-                if (uri.scheme == &quot;content&quot;) {
</a><a href="#h11-0-75" id="h11-0-75" class="d">-                    val fileType = activity.contentResolver.openInputStream(uri)!!.use { stream -&gt;
</a><a href="#h11-0-76" id="h11-0-76" class="d">-                        FileType.fromInputStream(stream)
</a><a href="#h11-0-77" id="h11-0-77" class="d">-                    }
</a><a href="#h11-0-78" id="h11-0-78" class="d">-                    fileType to activity.contentResolver.openInputStream(uri)
</a><a href="#h11-0-79" id="h11-0-79" class="d">-                } else {
</a><a href="#h11-0-80" id="h11-0-80" class="d">-                    FileType.fromFile(File(it)) to FileInputStream(it)
</a><a href="#h11-0-81" id="h11-0-81" class="d">-                }
</a><a href="#h11-0-82" id="h11-0-82" class="d">-            }.getOrNull()
</a><a href="#h11-0-83" id="h11-0-83" class="d">-        }?.also { (fileType, assetStream) -&gt;
</a><a href="#h11-0-84" id="h11-0-84" class="d">-            val previewBitmap = assetStream?.use { stream -&gt;
</a><a href="#h11-0-85" id="h11-0-85" class="d">-                //don&#39;t preview files larger than 30MB
</a><a href="#h11-0-86" id="h11-0-86" class="d">-                if (stream.available() &gt; 30 * 1024 * 1024) return@also
</a><a href="#h11-0-87" id="h11-0-87" class="d">-
</a><a href="#h11-0-88" id="h11-0-88" class="d">-                val tempFile = File.createTempFile(&quot;preview&quot;, &quot;.${fileType.fileExtension}&quot;)
</a><a href="#h11-0-89" id="h11-0-89" class="d">-                tempFile.outputStream().use { output -&gt;
</a><a href="#h11-0-90" id="h11-0-90" class="d">-                    stream.copyTo(output)
</a><a href="#h11-0-91" id="h11-0-91" class="d">-                }
</a><a href="#h11-0-92" id="h11-0-92" class="d">-                runCatching {
</a><a href="#h11-0-93" id="h11-0-93" class="d">-                    PreviewUtils.createPreviewFromFile(tempFile)?.let { preview -&gt;
</a><a href="#h11-0-94" id="h11-0-94" class="d">-                        val offsetY = (preview.height / 2 - holder.viewHeight / 2).coerceAtLeast(0)
</a><a href="#h11-0-95" id="h11-0-95" class="d">-
</a><a href="#h11-0-96" id="h11-0-96" class="d">-                        Bitmap.createScaledBitmap(
</a><a href="#h11-0-97" id="h11-0-97" class="d">-                            Bitmap.createBitmap(
</a><a href="#h11-0-98" id="h11-0-98" class="d">-                                preview, 0, offsetY,
</a><a href="#h11-0-99" id="h11-0-99" class="d">-                                preview.width.coerceAtMost(holder.viewWidth),
</a><a href="#h11-0-100" id="h11-0-100" class="d">-                                preview.height.coerceAtMost(holder.viewHeight)
</a><a href="#h11-0-101" id="h11-0-101" class="d">-                            ),
</a><a href="#h11-0-102" id="h11-0-102" class="d">-                            holder.viewWidth,
</a><a href="#h11-0-103" id="h11-0-103" class="d">-                            holder.viewHeight,
</a><a href="#h11-0-104" id="h11-0-104" class="d">-                            false
</a><a href="#h11-0-105" id="h11-0-105" class="d">-                        )
</a><a href="#h11-0-106" id="h11-0-106" class="d">-                    }
</a><a href="#h11-0-107" id="h11-0-107" class="d">-                }.onFailure {
</a><a href="#h11-0-108" id="h11-0-108" class="d">-                    Logger.error(&quot;failed to create preview $fileType&quot;, it)
</a><a href="#h11-0-109" id="h11-0-109" class="d">-                }.also {
</a><a href="#h11-0-110" id="h11-0-110" class="d">-                    tempFile.delete()
</a><a href="#h11-0-111" id="h11-0-111" class="d">-                }.getOrNull()
</a><a href="#h11-0-112" id="h11-0-112" class="d">-            } ?: return@also
</a><a href="#h11-0-113" id="h11-0-113" class="d">-
</a><a href="#h11-0-114" id="h11-0-114" class="d">-            if (coroutineContext.job.isCancelled) return@also
</a><a href="#h11-0-115" id="h11-0-115" class="d">-            Handler(holder.view.context.mainLooper).post {
</a><a href="#h11-0-116" id="h11-0-116" class="d">-                holder.view.background = RoundedBitmapDrawableFactory.create(
</a><a href="#h11-0-117" id="h11-0-117" class="d">-                    holder.view.context.resources,
</a><a href="#h11-0-118" id="h11-0-118" class="d">-                    previewBitmap
</a><a href="#h11-0-119" id="h11-0-119" class="d">-                ).also {
</a><a href="#h11-0-120" id="h11-0-120" class="d">-                    it.cornerRadius = holder.radius.toFloat()
</a><a href="#h11-0-121" id="h11-0-121" class="d">-                }
</a><a href="#h11-0-122" id="h11-0-122" class="d">-            }
</a><a href="#h11-0-123" id="h11-0-123" class="d">-        }
</a><a href="#h11-0-124" id="h11-0-124" class="d">-    }
</a><a href="#h11-0-125" id="h11-0-125" class="d">-
</a><a href="#h11-0-126" id="h11-0-126" class="d">-    private fun updateViewHolder(download: PendingDownload, holder: ViewHolder) {
</a><a href="#h11-0-127" id="h11-0-127" class="d">-        holder.status.text = download.downloadStage.toString()
</a><a href="#h11-0-128" id="h11-0-128" class="d">-        holder.view.background = holder.view.context.getDrawable(R.drawable.download_manager_item_background)
</a><a href="#h11-0-129" id="h11-0-129" class="d">-
</a><a href="#h11-0-130" id="h11-0-130" class="d">-        coroutineScope.launch {
</a><a href="#h11-0-131" id="h11-0-131" class="d">-            withTimeout(2000) {
</a><a href="#h11-0-132" id="h11-0-132" class="d">-                handlePreview(download, holder)
</a><a href="#h11-0-133" id="h11-0-133" class="d">-            }
</a><a href="#h11-0-134" id="h11-0-134" class="d">-        }
</a><a href="#h11-0-135" id="h11-0-135" class="d">-
</a><a href="#h11-0-136" id="h11-0-136" class="d">-        val isSaved = download.downloadStage == DownloadStage.SAVED
</a><a href="#h11-0-137" id="h11-0-137" class="d">-        //if the download is in progress, the user can cancel it
</a><a href="#h11-0-138" id="h11-0-138" class="d">-        val canInteract = if (download.job != null) !download.downloadStage.isFinalStage || isSaved
</a><a href="#h11-0-139" id="h11-0-139" class="d">-        else isSaved
</a><a href="#h11-0-140" id="h11-0-140" class="d">-
</a><a href="#h11-0-141" id="h11-0-141" class="d">-        holder.status.visibility = if (isSaved) View.GONE else View.VISIBLE
</a><a href="#h11-0-142" id="h11-0-142" class="d">-
</a><a href="#h11-0-143" id="h11-0-143" class="d">-        with(holder.actionButton) {
</a><a href="#h11-0-144" id="h11-0-144" class="d">-            isEnabled = canInteract
</a><a href="#h11-0-145" id="h11-0-145" class="d">-            alpha = if (canInteract) 1f else 0.5f
</a><a href="#h11-0-146" id="h11-0-146" class="d">-            background = context.getDrawable(if (isSaved) R.drawable.action_button_success else R.drawable.action_button_cancel)
</a><a href="#h11-0-147" id="h11-0-147" class="d">-            setTextColor(context.getColor(if (isSaved) R.color.successColor else R.color.actionBarColor))
</a><a href="#h11-0-148" id="h11-0-148" class="d">-            text = if (isSaved)
</a><a href="#h11-0-149" id="h11-0-149" class="d">-                SharedContext.translation[&quot;button.open&quot;]
</a><a href="#h11-0-150" id="h11-0-150" class="d">-            else
</a><a href="#h11-0-151" id="h11-0-151" class="d">-                SharedContext.translation[&quot;button.cancel&quot;]
</a><a href="#h11-0-152" id="h11-0-152" class="d">-        }
</a><a href="#h11-0-153" id="h11-0-153" class="d">-    }
</a><a href="#h11-0-154" id="h11-0-154" class="d">-
</a><a href="#h11-0-155" id="h11-0-155" class="d">-    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
</a><a href="#h11-0-156" id="h11-0-156" class="d">-        val pendingDownload = downloadList[position]
</a><a href="#h11-0-157" id="h11-0-157" class="d">-
</a><a href="#h11-0-158" id="h11-0-158" class="d">-        pendingDownload.changeListener = { _, _ -&gt;
</a><a href="#h11-0-159" id="h11-0-159" class="d">-            Handler(holder.view.context.mainLooper).post {
</a><a href="#h11-0-160" id="h11-0-160" class="d">-                updateViewHolder(pendingDownload, holder)
</a><a href="#h11-0-161" id="h11-0-161" class="d">-                notifyItemChanged(position)
</a><a href="#h11-0-162" id="h11-0-162" class="d">-            }
</a><a href="#h11-0-163" id="h11-0-163" class="d">-        }
</a><a href="#h11-0-164" id="h11-0-164" class="d">-
</a><a href="#h11-0-165" id="h11-0-165" class="d">-        holder.bitmojiIcon.setImageResource(R.drawable.bitmoji_blank)
</a><a href="#h11-0-166" id="h11-0-166" class="d">-
</a><a href="#h11-0-167" id="h11-0-167" class="d">-        pendingDownload.metadata.iconUrl?.let { url -&gt;
</a><a href="#h11-0-168" id="h11-0-168" class="d">-            thread(start = true) {
</a><a href="#h11-0-169" id="h11-0-169" class="d">-                runCatching {
</a><a href="#h11-0-170" id="h11-0-170" class="d">-                    val iconBitmap = URL(url).openStream().use {
</a><a href="#h11-0-171" id="h11-0-171" class="d">-                        BitmapFactory.decodeStream(it)
</a><a href="#h11-0-172" id="h11-0-172" class="d">-                    }
</a><a href="#h11-0-173" id="h11-0-173" class="d">-                    Handler(holder.view.context.mainLooper).post {
</a><a href="#h11-0-174" id="h11-0-174" class="d">-                        holder.bitmojiIcon.setImageBitmap(iconBitmap)
</a><a href="#h11-0-175" id="h11-0-175" class="d">-                    }
</a><a href="#h11-0-176" id="h11-0-176" class="d">-                }
</a><a href="#h11-0-177" id="h11-0-177" class="d">-            }
</a><a href="#h11-0-178" id="h11-0-178" class="d">-        }
</a><a href="#h11-0-179" id="h11-0-179" class="d">-
</a><a href="#h11-0-180" id="h11-0-180" class="d">-        holder.title.visibility = View.GONE
</a><a href="#h11-0-181" id="h11-0-181" class="d">-        holder.subtitle.visibility = View.GONE
</a><a href="#h11-0-182" id="h11-0-182" class="d">-
</a><a href="#h11-0-183" id="h11-0-183" class="d">-        pendingDownload.metadata.mediaDisplayType?.let {
</a><a href="#h11-0-184" id="h11-0-184" class="d">-            holder.title.text = it
</a><a href="#h11-0-185" id="h11-0-185" class="d">-            holder.title.visibility = View.VISIBLE
</a><a href="#h11-0-186" id="h11-0-186" class="d">-        }
</a><a href="#h11-0-187" id="h11-0-187" class="d">-
</a><a href="#h11-0-188" id="h11-0-188" class="d">-        pendingDownload.metadata.mediaDisplaySource?.let {
</a><a href="#h11-0-189" id="h11-0-189" class="d">-            holder.subtitle.text = it
</a><a href="#h11-0-190" id="h11-0-190" class="d">-            holder.subtitle.visibility = View.VISIBLE
</a><a href="#h11-0-191" id="h11-0-191" class="d">-        }
</a><a href="#h11-0-192" id="h11-0-192" class="d">-
</a><a href="#h11-0-193" id="h11-0-193" class="d">-        holder.actionButton.setOnClickListener {
</a><a href="#h11-0-194" id="h11-0-194" class="d">-            if (pendingDownload.downloadStage != DownloadStage.SAVED) {
</a><a href="#h11-0-195" id="h11-0-195" class="d">-                pendingDownload.cancel()
</a><a href="#h11-0-196" id="h11-0-196" class="d">-                pendingDownload.downloadStage = DownloadStage.CANCELLED
</a><a href="#h11-0-197" id="h11-0-197" class="d">-                updateViewHolder(pendingDownload, holder)
</a><a href="#h11-0-198" id="h11-0-198" class="d">-                notifyItemChanged(position);
</a><a href="#h11-0-199" id="h11-0-199" class="d">-                return@setOnClickListener
</a><a href="#h11-0-200" id="h11-0-200" class="d">-            }
</a><a href="#h11-0-201" id="h11-0-201" class="d">-
</a><a href="#h11-0-202" id="h11-0-202" class="d">-            pendingDownload.outputFile?.let {
</a><a href="#h11-0-203" id="h11-0-203" class="d">-                fun showFileNotFound() {
</a><a href="#h11-0-204" id="h11-0-204" class="d">-                    Toast.makeText(holder.view.context, SharedContext.translation[&quot;download_manager_activity.file_not_found_toast&quot;], Toast.LENGTH_SHORT).show()
</a><a href="#h11-0-205" id="h11-0-205" class="d">-                }
</a><a href="#h11-0-206" id="h11-0-206" class="d">-
</a><a href="#h11-0-207" id="h11-0-207" class="d">-                val uri = Uri.parse(it)
</a><a href="#h11-0-208" id="h11-0-208" class="d">-                val fileType = runCatching {
</a><a href="#h11-0-209" id="h11-0-209" class="d">-                    if (uri.scheme == &quot;content&quot;) {
</a><a href="#h11-0-210" id="h11-0-210" class="d">-                        activity.contentResolver.openInputStream(uri)?.use { input -&gt;
</a><a href="#h11-0-211" id="h11-0-211" class="d">-                            FileType.fromInputStream(input)
</a><a href="#h11-0-212" id="h11-0-212" class="d">-                        } ?: run {
</a><a href="#h11-0-213" id="h11-0-213" class="d">-                            showFileNotFound()
</a><a href="#h11-0-214" id="h11-0-214" class="d">-                            return@setOnClickListener
</a><a href="#h11-0-215" id="h11-0-215" class="d">-                        }
</a><a href="#h11-0-216" id="h11-0-216" class="d">-                    } else {
</a><a href="#h11-0-217" id="h11-0-217" class="d">-                        val file = File(it)
</a><a href="#h11-0-218" id="h11-0-218" class="d">-                        if (!file.exists()) {
</a><a href="#h11-0-219" id="h11-0-219" class="d">-                            showFileNotFound()
</a><a href="#h11-0-220" id="h11-0-220" class="d">-                            return@setOnClickListener
</a><a href="#h11-0-221" id="h11-0-221" class="d">-                        }
</a><a href="#h11-0-222" id="h11-0-222" class="d">-                        FileType.fromFile(file)
</a><a href="#h11-0-223" id="h11-0-223" class="d">-                    }
</a><a href="#h11-0-224" id="h11-0-224" class="d">-                }.onFailure { exception -&gt;
</a><a href="#h11-0-225" id="h11-0-225" class="d">-                    Logger.error(&quot;Failed to open file&quot;, exception)
</a><a href="#h11-0-226" id="h11-0-226" class="d">-                }.getOrDefault(FileType.UNKNOWN)
</a><a href="#h11-0-227" id="h11-0-227" class="d">-                if (fileType == FileType.UNKNOWN) {
</a><a href="#h11-0-228" id="h11-0-228" class="d">-                    showFileNotFound()
</a><a href="#h11-0-229" id="h11-0-229" class="d">-                    return@setOnClickListener
</a><a href="#h11-0-230" id="h11-0-230" class="d">-                }
</a><a href="#h11-0-231" id="h11-0-231" class="d">-
</a><a href="#h11-0-232" id="h11-0-232" class="d">-                val intent = Intent(Intent.ACTION_VIEW)
</a><a href="#h11-0-233" id="h11-0-233" class="d">-                intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_GRANT_READ_URI_PERMISSION
</a><a href="#h11-0-234" id="h11-0-234" class="d">-                intent.setDataAndType(uri, fileType.mimeType)
</a><a href="#h11-0-235" id="h11-0-235" class="d">-                holder.view.context.startActivity(intent)
</a><a href="#h11-0-236" id="h11-0-236" class="d">-            }
</a><a href="#h11-0-237" id="h11-0-237" class="d">-        }
</a><a href="#h11-0-238" id="h11-0-238" class="d">-
</a><a href="#h11-0-239" id="h11-0-239" class="d">-        updateViewHolder(pendingDownload, holder)
</a><a href="#h11-0-240" id="h11-0-240" class="d">-    }
</a><a href="#h11-0-241" id="h11-0-241" class="d">-}</a><a href="#h11-0-242" id="h11-0-242" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -1,214 +0,0 @@
</a><a href="#h12-0-0" id="h12-0-0" class="d">-package me.rhunk.snapenhance.ui.download
</a><a href="#h12-0-1" id="h12-0-1" class="d">-
</a><a href="#h12-0-2" id="h12-0-2" class="d">-import android.annotation.SuppressLint
</a><a href="#h12-0-3" id="h12-0-3" class="d">-import android.app.Activity
</a><a href="#h12-0-4" id="h12-0-4" class="d">-import android.app.AlertDialog
</a><a href="#h12-0-5" id="h12-0-5" class="d">-import android.content.Context
</a><a href="#h12-0-6" id="h12-0-6" class="d">-import android.content.Intent
</a><a href="#h12-0-7" id="h12-0-7" class="d">-import android.net.Uri
</a><a href="#h12-0-8" id="h12-0-8" class="d">-import android.os.Bundle
</a><a href="#h12-0-9" id="h12-0-9" class="d">-import android.os.PowerManager
</a><a href="#h12-0-10" id="h12-0-10" class="d">-import android.provider.Settings
</a><a href="#h12-0-11" id="h12-0-11" class="d">-import android.view.View
</a><a href="#h12-0-12" id="h12-0-12" class="d">-import android.widget.Button
</a><a href="#h12-0-13" id="h12-0-13" class="d">-import android.widget.ImageButton
</a><a href="#h12-0-14" id="h12-0-14" class="d">-import android.widget.TextView
</a><a href="#h12-0-15" id="h12-0-15" class="d">-import androidx.recyclerview.widget.ItemTouchHelper
</a><a href="#h12-0-16" id="h12-0-16" class="d">-import androidx.recyclerview.widget.RecyclerView
</a><a href="#h12-0-17" id="h12-0-17" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h12-0-18" id="h12-0-18" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h12-0-19" id="h12-0-19" class="d">-import me.rhunk.snapenhance.SharedContext
</a><a href="#h12-0-20" id="h12-0-20" class="d">-import me.rhunk.snapenhance.bridge.wrapper.TranslationWrapper
</a><a href="#h12-0-21" id="h12-0-21" class="d">-import me.rhunk.snapenhance.download.data.PendingDownload
</a><a href="#h12-0-22" id="h12-0-22" class="d">-
</a><a href="#h12-0-23" id="h12-0-23" class="d">-class DownloadManagerActivity : Activity() {
</a><a href="#h12-0-24" id="h12-0-24" class="d">-    lateinit var translation: TranslationWrapper
</a><a href="#h12-0-25" id="h12-0-25" class="d">-
</a><a href="#h12-0-26" id="h12-0-26" class="d">-    private val backCallbacks = mutableListOf&lt;() -&gt; Unit&gt;()
</a><a href="#h12-0-27" id="h12-0-27" class="d">-    private val fetchedDownloadTasks = mutableListOf&lt;PendingDownload&gt;()
</a><a href="#h12-0-28" id="h12-0-28" class="d">-    private var listFilter = MediaFilter.NONE
</a><a href="#h12-0-29" id="h12-0-29" class="d">-
</a><a href="#h12-0-30" id="h12-0-30" class="d">-    private val preferences by lazy {
</a><a href="#h12-0-31" id="h12-0-31" class="d">-        getSharedPreferences(&quot;settings&quot;, Context.MODE_PRIVATE)
</a><a href="#h12-0-32" id="h12-0-32" class="d">-    }
</a><a href="#h12-0-33" id="h12-0-33" class="d">-
</a><a href="#h12-0-34" id="h12-0-34" class="d">-    private fun updateNoDownloadText() {
</a><a href="#h12-0-35" id="h12-0-35" class="d">-        findViewById&lt;TextView&gt;(R.id.no_download_title).let {
</a><a href="#h12-0-36" id="h12-0-36" class="d">-            it.text = translation[&quot;no_downloads&quot;]
</a><a href="#h12-0-37" id="h12-0-37" class="d">-            it.visibility = if (fetchedDownloadTasks.isEmpty()) View.VISIBLE else View.GONE
</a><a href="#h12-0-38" id="h12-0-38" class="d">-        }
</a><a href="#h12-0-39" id="h12-0-39" class="d">-    }
</a><a href="#h12-0-40" id="h12-0-40" class="d">-
</a><a href="#h12-0-41" id="h12-0-41" class="d">-    @SuppressLint(&quot;NotifyDataSetChanged&quot;)
</a><a href="#h12-0-42" id="h12-0-42" class="d">-    private fun updateListContent() {
</a><a href="#h12-0-43" id="h12-0-43" class="d">-        fetchedDownloadTasks.clear()
</a><a href="#h12-0-44" id="h12-0-44" class="d">-        fetchedDownloadTasks.addAll(SharedContext.downloadTaskManager.queryAllTasks(filter = listFilter).values)
</a><a href="#h12-0-45" id="h12-0-45" class="d">-
</a><a href="#h12-0-46" id="h12-0-46" class="d">-        with(findViewById&lt;RecyclerView&gt;(R.id.download_list)) {
</a><a href="#h12-0-47" id="h12-0-47" class="d">-            adapter?.notifyDataSetChanged()
</a><a href="#h12-0-48" id="h12-0-48" class="d">-            scrollToPosition(0)
</a><a href="#h12-0-49" id="h12-0-49" class="d">-        }
</a><a href="#h12-0-50" id="h12-0-50" class="d">-        updateNoDownloadText()
</a><a href="#h12-0-51" id="h12-0-51" class="d">-    }
</a><a href="#h12-0-52" id="h12-0-52" class="d">-
</a><a href="#h12-0-53" id="h12-0-53" class="d">-    @Deprecated(&quot;Deprecated in Java&quot;)
</a><a href="#h12-0-54" id="h12-0-54" class="d">-    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h12-0-55" id="h12-0-55" class="d">-    override fun onBackPressed() {
</a><a href="#h12-0-56" id="h12-0-56" class="d">-        backCallbacks.lastOrNull()?.let {
</a><a href="#h12-0-57" id="h12-0-57" class="d">-            it()
</a><a href="#h12-0-58" id="h12-0-58" class="d">-            backCallbacks.removeLast()
</a><a href="#h12-0-59" id="h12-0-59" class="d">-        } ?: super.onBackPressed()
</a><a href="#h12-0-60" id="h12-0-60" class="d">-    }
</a><a href="#h12-0-61" id="h12-0-61" class="d">-
</a><a href="#h12-0-62" id="h12-0-62" class="d">-    fun registerBackCallback(callback: () -&gt; Unit) {
</a><a href="#h12-0-63" id="h12-0-63" class="d">-        backCallbacks.add(callback)
</a><a href="#h12-0-64" id="h12-0-64" class="d">-    }
</a><a href="#h12-0-65" id="h12-0-65" class="d">-
</a><a href="#h12-0-66" id="h12-0-66" class="d">-    @SuppressLint(&quot;BatteryLife&quot;, &quot;NotifyDataSetChanged&quot;, &quot;SetTextI18n&quot;)
</a><a href="#h12-0-67" id="h12-0-67" class="d">-    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h12-0-68" id="h12-0-68" class="d">-        super.onCreate(savedInstanceState)
</a><a href="#h12-0-69" id="h12-0-69" class="d">-        SharedContext.ensureInitialized(this)
</a><a href="#h12-0-70" id="h12-0-70" class="d">-        translation = SharedContext.translation.getCategory(&quot;download_manager_activity&quot;)
</a><a href="#h12-0-71" id="h12-0-71" class="d">-        
</a><a href="#h12-0-72" id="h12-0-72" class="d">-        setContentView(R.layout.download_manager_activity)
</a><a href="#h12-0-73" id="h12-0-73" class="d">-        
</a><a href="#h12-0-74" id="h12-0-74" class="d">-        findViewById&lt;TextView&gt;(R.id.title).text = resources.getString(R.string.app_name) + &quot; &quot; + BuildConfig.VERSION_NAME
</a><a href="#h12-0-75" id="h12-0-75" class="d">-
</a><a href="#h12-0-76" id="h12-0-76" class="d">-        findViewById&lt;ImageButton&gt;(R.id.debug_settings_button).setOnClickListener {
</a><a href="#h12-0-77" id="h12-0-77" class="d">-            DebugSettingsLayoutInflater(this).inflate(findViewById(android.R.id.content))
</a><a href="#h12-0-78" id="h12-0-78" class="d">-        }
</a><a href="#h12-0-79" id="h12-0-79" class="d">-        
</a><a href="#h12-0-80" id="h12-0-80" class="d">-        with(findViewById&lt;RecyclerView&gt;(R.id.download_list)) {
</a><a href="#h12-0-81" id="h12-0-81" class="d">-            layoutManager = androidx.recyclerview.widget.LinearLayoutManager(this@DownloadManagerActivity)
</a><a href="#h12-0-82" id="h12-0-82" class="d">-
</a><a href="#h12-0-83" id="h12-0-83" class="d">-            adapter = DownloadListAdapter(this@DownloadManagerActivity, fetchedDownloadTasks).apply {
</a><a href="#h12-0-84" id="h12-0-84" class="d">-                registerAdapterDataObserver(object : RecyclerView.AdapterDataObserver() {
</a><a href="#h12-0-85" id="h12-0-85" class="d">-                    override fun onItemRangeRemoved(positionStart: Int, itemCount: Int) {
</a><a href="#h12-0-86" id="h12-0-86" class="d">-                        updateNoDownloadText()
</a><a href="#h12-0-87" id="h12-0-87" class="d">-                    }
</a><a href="#h12-0-88" id="h12-0-88" class="d">-                })
</a><a href="#h12-0-89" id="h12-0-89" class="d">-            }
</a><a href="#h12-0-90" id="h12-0-90" class="d">-
</a><a href="#h12-0-91" id="h12-0-91" class="d">-            ItemTouchHelper(object : ItemTouchHelper.SimpleCallback(0, ItemTouchHelper.LEFT or ItemTouchHelper.RIGHT) {
</a><a href="#h12-0-92" id="h12-0-92" class="d">-                override fun getMovementFlags(
</a><a href="#h12-0-93" id="h12-0-93" class="d">-                    recyclerView: RecyclerView,
</a><a href="#h12-0-94" id="h12-0-94" class="d">-                    viewHolder: RecyclerView.ViewHolder
</a><a href="#h12-0-95" id="h12-0-95" class="d">-                ): Int {
</a><a href="#h12-0-96" id="h12-0-96" class="d">-                    val download = fetchedDownloadTasks[viewHolder.absoluteAdapterPosition]
</a><a href="#h12-0-97" id="h12-0-97" class="d">-                    return if (download.isJobActive()) {
</a><a href="#h12-0-98" id="h12-0-98" class="d">-                        0
</a><a href="#h12-0-99" id="h12-0-99" class="d">-                    } else {
</a><a href="#h12-0-100" id="h12-0-100" class="d">-                        super.getMovementFlags(recyclerView, viewHolder)
</a><a href="#h12-0-101" id="h12-0-101" class="d">-                    }
</a><a href="#h12-0-102" id="h12-0-102" class="d">-                }
</a><a href="#h12-0-103" id="h12-0-103" class="d">-
</a><a href="#h12-0-104" id="h12-0-104" class="d">-                override fun onMove(
</a><a href="#h12-0-105" id="h12-0-105" class="d">-                    recyclerView: RecyclerView,
</a><a href="#h12-0-106" id="h12-0-106" class="d">-                    viewHolder: RecyclerView.ViewHolder,
</a><a href="#h12-0-107" id="h12-0-107" class="d">-                    target: RecyclerView.ViewHolder
</a><a href="#h12-0-108" id="h12-0-108" class="d">-                ): Boolean {
</a><a href="#h12-0-109" id="h12-0-109" class="d">-                    return false
</a><a href="#h12-0-110" id="h12-0-110" class="d">-                }
</a><a href="#h12-0-111" id="h12-0-111" class="d">-
</a><a href="#h12-0-112" id="h12-0-112" class="d">-                @SuppressLint(&quot;NotifyDataSetChanged&quot;)
</a><a href="#h12-0-113" id="h12-0-113" class="d">-                override fun onSwiped(viewHolder: RecyclerView.ViewHolder, direction: Int) {
</a><a href="#h12-0-114" id="h12-0-114" class="d">-                    fetchedDownloadTasks.removeAt(viewHolder.absoluteAdapterPosition).let {
</a><a href="#h12-0-115" id="h12-0-115" class="d">-                        SharedContext.downloadTaskManager.removeTask(it)
</a><a href="#h12-0-116" id="h12-0-116" class="d">-                    }
</a><a href="#h12-0-117" id="h12-0-117" class="d">-                    adapter?.notifyItemRemoved(viewHolder.absoluteAdapterPosition)
</a><a href="#h12-0-118" id="h12-0-118" class="d">-                }
</a><a href="#h12-0-119" id="h12-0-119" class="d">-            }).attachToRecyclerView(this)
</a><a href="#h12-0-120" id="h12-0-120" class="d">-
</a><a href="#h12-0-121" id="h12-0-121" class="d">-            var isLoading = false
</a><a href="#h12-0-122" id="h12-0-122" class="d">-
</a><a href="#h12-0-123" id="h12-0-123" class="d">-            addOnScrollListener(object : RecyclerView.OnScrollListener() {
</a><a href="#h12-0-124" id="h12-0-124" class="d">-                override fun onScrollStateChanged(recyclerView: RecyclerView, newState: Int) {
</a><a href="#h12-0-125" id="h12-0-125" class="d">-                    val layoutManager = recyclerView.layoutManager as androidx.recyclerview.widget.LinearLayoutManager
</a><a href="#h12-0-126" id="h12-0-126" class="d">-                    val lastVisibleItemPosition = layoutManager.findLastVisibleItemPosition()
</a><a href="#h12-0-127" id="h12-0-127" class="d">-
</a><a href="#h12-0-128" id="h12-0-128" class="d">-                    if (lastVisibleItemPosition == RecyclerView.NO_POSITION) {
</a><a href="#h12-0-129" id="h12-0-129" class="d">-                        return
</a><a href="#h12-0-130" id="h12-0-130" class="d">-                    }
</a><a href="#h12-0-131" id="h12-0-131" class="d">-
</a><a href="#h12-0-132" id="h12-0-132" class="d">-                    if (lastVisibleItemPosition == fetchedDownloadTasks.size - 1 &amp;&amp; !isLoading) {
</a><a href="#h12-0-133" id="h12-0-133" class="d">-                        isLoading = true
</a><a href="#h12-0-134" id="h12-0-134" class="d">-
</a><a href="#h12-0-135" id="h12-0-135" class="d">-                        SharedContext.downloadTaskManager.queryTasks(fetchedDownloadTasks.last().downloadId, filter = listFilter).forEach {
</a><a href="#h12-0-136" id="h12-0-136" class="d">-                            fetchedDownloadTasks.add(it.value)
</a><a href="#h12-0-137" id="h12-0-137" class="d">-                            adapter?.notifyItemInserted(fetchedDownloadTasks.size - 1)
</a><a href="#h12-0-138" id="h12-0-138" class="d">-                        }
</a><a href="#h12-0-139" id="h12-0-139" class="d">-
</a><a href="#h12-0-140" id="h12-0-140" class="d">-                        isLoading = false
</a><a href="#h12-0-141" id="h12-0-141" class="d">-                    }
</a><a href="#h12-0-142" id="h12-0-142" class="d">-                }
</a><a href="#h12-0-143" id="h12-0-143" class="d">-            })
</a><a href="#h12-0-144" id="h12-0-144" class="d">-    
</a><a href="#h12-0-145" id="h12-0-145" class="d">-            arrayOf(
</a><a href="#h12-0-146" id="h12-0-146" class="d">-                Pair(R.id.all_category, MediaFilter.NONE),
</a><a href="#h12-0-147" id="h12-0-147" class="d">-                Pair(R.id.pending_category, MediaFilter.PENDING),
</a><a href="#h12-0-148" id="h12-0-148" class="d">-                Pair(R.id.snap_category, MediaFilter.CHAT_MEDIA),
</a><a href="#h12-0-149" id="h12-0-149" class="d">-                Pair(R.id.story_category, MediaFilter.STORY),
</a><a href="#h12-0-150" id="h12-0-150" class="d">-                Pair(R.id.spotlight_category, MediaFilter.SPOTLIGHT)
</a><a href="#h12-0-151" id="h12-0-151" class="d">-            ).let { categoryPairs -&gt;
</a><a href="#h12-0-152" id="h12-0-152" class="d">-                categoryPairs.forEach { pair -&gt;
</a><a href="#h12-0-153" id="h12-0-153" class="d">-                    this@DownloadManagerActivity.findViewById&lt;TextView&gt;(pair.first).apply {
</a><a href="#h12-0-154" id="h12-0-154" class="d">-                        text = translation[&quot;category.${resources.getResourceEntryName(pair.first)}&quot;]
</a><a href="#h12-0-155" id="h12-0-155" class="d">-                    }.setOnClickListener { view -&gt;
</a><a href="#h12-0-156" id="h12-0-156" class="d">-                        listFilter = pair.second
</a><a href="#h12-0-157" id="h12-0-157" class="d">-                        updateListContent()
</a><a href="#h12-0-158" id="h12-0-158" class="d">-                        categoryPairs.map { this@DownloadManagerActivity.findViewById&lt;TextView&gt;(it.first) }.forEach {
</a><a href="#h12-0-159" id="h12-0-159" class="d">-                            it.setTextColor(getColor(R.color.primaryText))
</a><a href="#h12-0-160" id="h12-0-160" class="d">-                        }
</a><a href="#h12-0-161" id="h12-0-161" class="d">-                        (view as TextView).setTextColor(getColor(R.color.focusedCategoryColor))
</a><a href="#h12-0-162" id="h12-0-162" class="d">-                    }
</a><a href="#h12-0-163" id="h12-0-163" class="d">-                }
</a><a href="#h12-0-164" id="h12-0-164" class="d">-            }
</a><a href="#h12-0-165" id="h12-0-165" class="d">-
</a><a href="#h12-0-166" id="h12-0-166" class="d">-            this@DownloadManagerActivity.findViewById&lt;Button&gt;(R.id.remove_all_button).also {
</a><a href="#h12-0-167" id="h12-0-167" class="d">-                it.text = translation[&quot;remove_all&quot;]
</a><a href="#h12-0-168" id="h12-0-168" class="d">-            }.setOnClickListener {
</a><a href="#h12-0-169" id="h12-0-169" class="d">-                with(AlertDialog.Builder(this@DownloadManagerActivity)) {
</a><a href="#h12-0-170" id="h12-0-170" class="d">-                    setTitle(translation[&quot;remove_all_title&quot;])
</a><a href="#h12-0-171" id="h12-0-171" class="d">-                    setMessage(translation[&quot;remove_all_text&quot;])
</a><a href="#h12-0-172" id="h12-0-172" class="d">-                    setPositiveButton(SharedContext.translation[&quot;button.positive&quot;]) { _, _ -&gt;
</a><a href="#h12-0-173" id="h12-0-173" class="d">-                        SharedContext.downloadTaskManager.removeAllTasks()
</a><a href="#h12-0-174" id="h12-0-174" class="d">-                        fetchedDownloadTasks.removeIf {
</a><a href="#h12-0-175" id="h12-0-175" class="d">-                            if (it.isJobActive()) it.cancel()
</a><a href="#h12-0-176" id="h12-0-176" class="d">-                            true
</a><a href="#h12-0-177" id="h12-0-177" class="d">-                        }
</a><a href="#h12-0-178" id="h12-0-178" class="d">-                        adapter?.notifyDataSetChanged()
</a><a href="#h12-0-179" id="h12-0-179" class="d">-                        updateNoDownloadText()
</a><a href="#h12-0-180" id="h12-0-180" class="d">-                    }
</a><a href="#h12-0-181" id="h12-0-181" class="d">-                    setNegativeButton(SharedContext.translation[&quot;button.negative&quot;]) { dialog, _ -&gt;
</a><a href="#h12-0-182" id="h12-0-182" class="d">-                        dialog.dismiss()
</a><a href="#h12-0-183" id="h12-0-183" class="d">-                    }
</a><a href="#h12-0-184" id="h12-0-184" class="d">-                    show()
</a><a href="#h12-0-185" id="h12-0-185" class="d">-                }
</a><a href="#h12-0-186" id="h12-0-186" class="d">-            }
</a><a href="#h12-0-187" id="h12-0-187" class="d">-
</a><a href="#h12-0-188" id="h12-0-188" class="d">-        }
</a><a href="#h12-0-189" id="h12-0-189" class="d">-
</a><a href="#h12-0-190" id="h12-0-190" class="d">-        updateListContent()
</a><a href="#h12-0-191" id="h12-0-191" class="d">-
</a><a href="#h12-0-192" id="h12-0-192" class="d">-        if (!preferences.getBoolean(&quot;ask_battery_optimisations&quot;, true) ||
</a><a href="#h12-0-193" id="h12-0-193" class="d">-            !(getSystemService(Context.POWER_SERVICE) as PowerManager).isIgnoringBatteryOptimizations(packageName)) return
</a><a href="#h12-0-194" id="h12-0-194" class="d">-
</a><a href="#h12-0-195" id="h12-0-195" class="d">-        with(Intent()) {
</a><a href="#h12-0-196" id="h12-0-196" class="d">-            action = Settings.ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS
</a><a href="#h12-0-197" id="h12-0-197" class="d">-            data = Uri.parse(&quot;package:$packageName&quot;)
</a><a href="#h12-0-198" id="h12-0-198" class="d">-            startActivityForResult(this, 1)
</a><a href="#h12-0-199" id="h12-0-199" class="d">-        }
</a><a href="#h12-0-200" id="h12-0-200" class="d">-    }
</a><a href="#h12-0-201" id="h12-0-201" class="d">-
</a><a href="#h12-0-202" id="h12-0-202" class="d">-    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
</a><a href="#h12-0-203" id="h12-0-203" class="d">-        if (requestCode == 1) {
</a><a href="#h12-0-204" id="h12-0-204" class="d">-            preferences.edit().putBoolean(&quot;ask_battery_optimisations&quot;, false).apply()
</a><a href="#h12-0-205" id="h12-0-205" class="d">-        }
</a><a href="#h12-0-206" id="h12-0-206" class="d">-    }
</a><a href="#h12-0-207" id="h12-0-207" class="d">-
</a><a href="#h12-0-208" id="h12-0-208" class="d">-    @SuppressLint(&quot;NotifyDataSetChanged&quot;)
</a><a href="#h12-0-209" id="h12-0-209" class="d">-    override fun onResume() {
</a><a href="#h12-0-210" id="h12-0-210" class="d">-        super.onResume()
</a><a href="#h12-0-211" id="h12-0-211" class="d">-        updateListContent()
</a><a href="#h12-0-212" id="h12-0-212" class="d">-    }
</a><a href="#h12-0-213" id="h12-0-213" class="d">-}</a><a href="#h12-0-214" id="h12-0-214" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h13" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,98 +0,0 @@
</a><a href="#h13-0-0" id="h13-0-0" class="d">-package me.rhunk.snapenhance.ui.map
</a><a href="#h13-0-1" id="h13-0-1" class="d">-
</a><a href="#h13-0-2" id="h13-0-2" class="d">-import android.annotation.SuppressLint
</a><a href="#h13-0-3" id="h13-0-3" class="d">-import android.app.Activity
</a><a href="#h13-0-4" id="h13-0-4" class="d">-import android.app.AlertDialog
</a><a href="#h13-0-5" id="h13-0-5" class="d">-import android.content.Context
</a><a href="#h13-0-6" id="h13-0-6" class="d">-import android.os.Bundle
</a><a href="#h13-0-7" id="h13-0-7" class="d">-import android.view.MotionEvent
</a><a href="#h13-0-8" id="h13-0-8" class="d">-import android.widget.Button
</a><a href="#h13-0-9" id="h13-0-9" class="d">-import android.widget.EditText
</a><a href="#h13-0-10" id="h13-0-10" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h13-0-11" id="h13-0-11" class="d">-import org.osmdroid.config.Configuration
</a><a href="#h13-0-12" id="h13-0-12" class="d">-import org.osmdroid.tileprovider.tilesource.TileSourceFactory
</a><a href="#h13-0-13" id="h13-0-13" class="d">-import org.osmdroid.util.GeoPoint
</a><a href="#h13-0-14" id="h13-0-14" class="d">-import org.osmdroid.views.MapView
</a><a href="#h13-0-15" id="h13-0-15" class="d">-import org.osmdroid.views.Projection
</a><a href="#h13-0-16" id="h13-0-16" class="d">-import org.osmdroid.views.overlay.Marker
</a><a href="#h13-0-17" id="h13-0-17" class="d">-import org.osmdroid.views.overlay.Overlay
</a><a href="#h13-0-18" id="h13-0-18" class="d">-
</a><a href="#h13-0-19" id="h13-0-19" class="d">-
</a><a href="#h13-0-20" id="h13-0-20" class="d">-class MapActivity : Activity() {
</a><a href="#h13-0-21" id="h13-0-21" class="d">-
</a><a href="#h13-0-22" id="h13-0-22" class="d">-    private lateinit var mapView: MapView
</a><a href="#h13-0-23" id="h13-0-23" class="d">-
</a><a href="#h13-0-24" id="h13-0-24" class="d">-    @SuppressLint(&quot;MissingInflatedId&quot;, &quot;ResourceType&quot;)
</a><a href="#h13-0-25" id="h13-0-25" class="d">-    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h13-0-26" id="h13-0-26" class="d">-        super.onCreate(savedInstanceState)
</a><a href="#h13-0-27" id="h13-0-27" class="d">-
</a><a href="#h13-0-28" id="h13-0-28" class="d">-        val contextBundle = intent.extras?.getBundle(&quot;location&quot;) ?: return
</a><a href="#h13-0-29" id="h13-0-29" class="d">-        val locationLatitude = contextBundle.getDouble(&quot;latitude&quot;)
</a><a href="#h13-0-30" id="h13-0-30" class="d">-        val locationLongitude = contextBundle.getDouble(&quot;longitude&quot;)
</a><a href="#h13-0-31" id="h13-0-31" class="d">-
</a><a href="#h13-0-32" id="h13-0-32" class="d">-        Configuration.getInstance().load(applicationContext, getSharedPreferences(&quot;osmdroid&quot;, Context.MODE_PRIVATE))
</a><a href="#h13-0-33" id="h13-0-33" class="d">-
</a><a href="#h13-0-34" id="h13-0-34" class="d">-        setContentView(R.layout.map)
</a><a href="#h13-0-35" id="h13-0-35" class="d">-
</a><a href="#h13-0-36" id="h13-0-36" class="d">-        mapView = findViewById(R.id.mapView)
</a><a href="#h13-0-37" id="h13-0-37" class="d">-        mapView.setMultiTouchControls(true);
</a><a href="#h13-0-38" id="h13-0-38" class="d">-        mapView.setTileSource(TileSourceFactory.MAPNIK)
</a><a href="#h13-0-39" id="h13-0-39" class="d">-
</a><a href="#h13-0-40" id="h13-0-40" class="d">-        val startPoint = GeoPoint(locationLatitude, locationLongitude)
</a><a href="#h13-0-41" id="h13-0-41" class="d">-        mapView.controller.setZoom(10.0)
</a><a href="#h13-0-42" id="h13-0-42" class="d">-        mapView.controller.setCenter(startPoint)
</a><a href="#h13-0-43" id="h13-0-43" class="d">-
</a><a href="#h13-0-44" id="h13-0-44" class="d">-        val marker = Marker(mapView)
</a><a href="#h13-0-45" id="h13-0-45" class="d">-        marker.isDraggable = true
</a><a href="#h13-0-46" id="h13-0-46" class="d">-        marker.position = startPoint
</a><a href="#h13-0-47" id="h13-0-47" class="d">-        marker.setAnchor(Marker.ANCHOR_CENTER, Marker.ANCHOR_BOTTOM)
</a><a href="#h13-0-48" id="h13-0-48" class="d">-
</a><a href="#h13-0-49" id="h13-0-49" class="d">-        mapView.overlays.add(object: Overlay() {
</a><a href="#h13-0-50" id="h13-0-50" class="d">-            override fun onSingleTapConfirmed(e: MotionEvent?, mapView: MapView?): Boolean {
</a><a href="#h13-0-51" id="h13-0-51" class="d">-                val proj: Projection = mapView!!.projection
</a><a href="#h13-0-52" id="h13-0-52" class="d">-                val loc = proj.fromPixels(e!!.x.toInt(), e.y.toInt()) as GeoPoint
</a><a href="#h13-0-53" id="h13-0-53" class="d">-                marker.position = loc
</a><a href="#h13-0-54" id="h13-0-54" class="d">-                mapView.invalidate()
</a><a href="#h13-0-55" id="h13-0-55" class="d">-                return true
</a><a href="#h13-0-56" id="h13-0-56" class="d">-            }
</a><a href="#h13-0-57" id="h13-0-57" class="d">-        })
</a><a href="#h13-0-58" id="h13-0-58" class="d">-
</a><a href="#h13-0-59" id="h13-0-59" class="d">-        mapView.overlays.add(marker)
</a><a href="#h13-0-60" id="h13-0-60" class="d">-
</a><a href="#h13-0-61" id="h13-0-61" class="d">-        val applyButton = findViewById&lt;Button&gt;(R.id.apply_location_button)
</a><a href="#h13-0-62" id="h13-0-62" class="d">-        applyButton.setOnClickListener {
</a><a href="#h13-0-63" id="h13-0-63" class="d">-            val bundle = Bundle()
</a><a href="#h13-0-64" id="h13-0-64" class="d">-            bundle.putFloat(&quot;latitude&quot;, marker.position.latitude.toFloat())
</a><a href="#h13-0-65" id="h13-0-65" class="d">-            bundle.putFloat(&quot;longitude&quot;, marker.position.longitude.toFloat())
</a><a href="#h13-0-66" id="h13-0-66" class="d">-            setResult(RESULT_OK, intent.putExtra(&quot;location&quot;, bundle))
</a><a href="#h13-0-67" id="h13-0-67" class="d">-            finish()
</a><a href="#h13-0-68" id="h13-0-68" class="d">-        }
</a><a href="#h13-0-69" id="h13-0-69" class="d">-
</a><a href="#h13-0-70" id="h13-0-70" class="d">-        val setPreciseLocationButton = findViewById&lt;Button&gt;(R.id.set_precise_location_button)
</a><a href="#h13-0-71" id="h13-0-71" class="d">-
</a><a href="#h13-0-72" id="h13-0-72" class="d">-        setPreciseLocationButton.setOnClickListener {
</a><a href="#h13-0-73" id="h13-0-73" class="d">-            val locationDialog = layoutInflater.inflate(R.layout.precise_location_dialog, null)
</a><a href="#h13-0-74" id="h13-0-74" class="d">-            val dialogLatitude = locationDialog.findViewById&lt;EditText&gt;(R.id.dialog_latitude).also { it.setText(marker.position.latitude.toString()) }
</a><a href="#h13-0-75" id="h13-0-75" class="d">-            val dialogLongitude = locationDialog.findViewById&lt;EditText&gt;(R.id.dialog_longitude).also { it.setText(marker.position.longitude.toString()) }
</a><a href="#h13-0-76" id="h13-0-76" class="d">-
</a><a href="#h13-0-77" id="h13-0-77" class="d">-            AlertDialog.Builder(this)
</a><a href="#h13-0-78" id="h13-0-78" class="d">-                .setView(locationDialog)
</a><a href="#h13-0-79" id="h13-0-79" class="d">-                .setTitle(&quot;Set a precise location&quot;)
</a><a href="#h13-0-80" id="h13-0-80" class="d">-                .setPositiveButton(&quot;Set&quot;) { _, _ -&gt;
</a><a href="#h13-0-81" id="h13-0-81" class="d">-                    val latitude = dialogLatitude.text.toString().toDoubleOrNull()
</a><a href="#h13-0-82" id="h13-0-82" class="d">-                    val longitude = dialogLongitude.text.toString().toDoubleOrNull()
</a><a href="#h13-0-83" id="h13-0-83" class="d">-                    if (latitude != null &amp;&amp; longitude != null) {
</a><a href="#h13-0-84" id="h13-0-84" class="d">-                        val preciseLocation = GeoPoint(latitude, longitude)
</a><a href="#h13-0-85" id="h13-0-85" class="d">-                        mapView.controller.setCenter(preciseLocation)
</a><a href="#h13-0-86" id="h13-0-86" class="d">-                        marker.position = preciseLocation
</a><a href="#h13-0-87" id="h13-0-87" class="d">-                        mapView.invalidate()
</a><a href="#h13-0-88" id="h13-0-88" class="d">-                    }
</a><a href="#h13-0-89" id="h13-0-89" class="d">-                }.setNegativeButton(&quot;Cancel&quot;) { _, _ -&gt; }.show()
</a><a href="#h13-0-90" id="h13-0-90" class="d">-        }
</a><a href="#h13-0-91" id="h13-0-91" class="d">-    }
</a><a href="#h13-0-92" id="h13-0-92" class="d">-
</a><a href="#h13-0-93" id="h13-0-93" class="d">-    override fun onDestroy() {
</a><a href="#h13-0-94" id="h13-0-94" class="d">-        super.onDestroy()
</a><a href="#h13-0-95" id="h13-0-95" class="d">-        mapView.onDetach()
</a><a href="#h13-0-96" id="h13-0-96" class="d">-    }
</a><a href="#h13-0-97" id="h13-0-97" class="d">-}
</a><b>diff --git a/<a id="h14" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,86 +0,0 @@
</a><a href="#h14-0-0" id="h14-0-0" class="d">-package me.rhunk.snapenhance.ui.menu.impl
</a><a href="#h14-0-1" id="h14-0-1" class="d">-
</a><a href="#h14-0-2" id="h14-0-2" class="d">-import android.annotation.SuppressLint
</a><a href="#h14-0-3" id="h14-0-3" class="d">-import android.content.Intent
</a><a href="#h14-0-4" id="h14-0-4" class="d">-import android.view.View
</a><a href="#h14-0-5" id="h14-0-5" class="d">-import android.view.ViewGroup
</a><a href="#h14-0-6" id="h14-0-6" class="d">-import android.widget.FrameLayout
</a><a href="#h14-0-7" id="h14-0-7" class="d">-import android.widget.ImageView
</a><a href="#h14-0-8" id="h14-0-8" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h14-0-9" id="h14-0-9" class="d">-import me.rhunk.snapenhance.Constants
</a><a href="#h14-0-10" id="h14-0-10" class="d">-import me.rhunk.snapenhance.ui.config.ConfigActivity
</a><a href="#h14-0-11" id="h14-0-11" class="d">-import me.rhunk.snapenhance.ui.menu.AbstractMenu
</a><a href="#h14-0-12" id="h14-0-12" class="d">-import java.io.File
</a><a href="#h14-0-13" id="h14-0-13" class="d">-
</a><a href="#h14-0-14" id="h14-0-14" class="d">-
</a><a href="#h14-0-15" id="h14-0-15" class="d">-@SuppressLint(&quot;DiscouragedApi&quot;)
</a><a href="#h14-0-16" id="h14-0-16" class="d">-class SettingsGearInjector : AbstractMenu() {
</a><a href="#h14-0-17" id="h14-0-17" class="d">-    private val headerButtonOpaqueIconTint by lazy {
</a><a href="#h14-0-18" id="h14-0-18" class="d">-        context.resources.getIdentifier(&quot;headerButtonOpaqueIconTint&quot;, &quot;attr&quot;, Constants.SNAPCHAT_PACKAGE_NAME).let {
</a><a href="#h14-0-19" id="h14-0-19" class="d">-            context.androidContext.theme.obtainStyledAttributes(intArrayOf(it)).getColorStateList(0)
</a><a href="#h14-0-20" id="h14-0-20" class="d">-        }
</a><a href="#h14-0-21" id="h14-0-21" class="d">-    }
</a><a href="#h14-0-22" id="h14-0-22" class="d">-
</a><a href="#h14-0-23" id="h14-0-23" class="d">-    private val settingsSvg by lazy {
</a><a href="#h14-0-24" id="h14-0-24" class="d">-        context.resources.getIdentifier(&quot;svg_settings_32x32&quot;, &quot;drawable&quot;, Constants.SNAPCHAT_PACKAGE_NAME).let {
</a><a href="#h14-0-25" id="h14-0-25" class="d">-            context.resources.getDrawable(it, context.androidContext.theme)
</a><a href="#h14-0-26" id="h14-0-26" class="d">-        }
</a><a href="#h14-0-27" id="h14-0-27" class="d">-    }
</a><a href="#h14-0-28" id="h14-0-28" class="d">-
</a><a href="#h14-0-29" id="h14-0-29" class="d">-    private val ngsHovaHeaderSearchIconBackgroundMarginLeft by lazy {
</a><a href="#h14-0-30" id="h14-0-30" class="d">-        context.resources.getIdentifier(&quot;ngs_hova_header_search_icon_background_margin_left&quot;, &quot;dimen&quot;, Constants.SNAPCHAT_PACKAGE_NAME).let {
</a><a href="#h14-0-31" id="h14-0-31" class="d">-            context.resources.getDimensionPixelSize(it)
</a><a href="#h14-0-32" id="h14-0-32" class="d">-        }
</a><a href="#h14-0-33" id="h14-0-33" class="d">-    }
</a><a href="#h14-0-34" id="h14-0-34" class="d">-
</a><a href="#h14-0-35" id="h14-0-35" class="d">-    @SuppressLint(&quot;SetTextI18n&quot;, &quot;ClickableViewAccessibility&quot;)
</a><a href="#h14-0-36" id="h14-0-36" class="d">-    fun inject(parent: ViewGroup, child: View) {
</a><a href="#h14-0-37" id="h14-0-37" class="d">-        val firstView = (child as ViewGroup).getChildAt(0)
</a><a href="#h14-0-38" id="h14-0-38" class="d">-
</a><a href="#h14-0-39" id="h14-0-39" class="d">-        child.clipChildren = false
</a><a href="#h14-0-40" id="h14-0-40" class="d">-        child.addView(FrameLayout(parent.context).apply {
</a><a href="#h14-0-41" id="h14-0-41" class="d">-            layoutParams = FrameLayout.LayoutParams(firstView.layoutParams.width, firstView.layoutParams.height).apply {
</a><a href="#h14-0-42" id="h14-0-42" class="d">-                y = 0f
</a><a href="#h14-0-43" id="h14-0-43" class="d">-                x = -(ngsHovaHeaderSearchIconBackgroundMarginLeft + firstView.layoutParams.width).toFloat()
</a><a href="#h14-0-44" id="h14-0-44" class="d">-            }
</a><a href="#h14-0-45" id="h14-0-45" class="d">-
</a><a href="#h14-0-46" id="h14-0-46" class="d">-            isClickable = true
</a><a href="#h14-0-47" id="h14-0-47" class="d">-
</a><a href="#h14-0-48" id="h14-0-48" class="d">-            setOnClickListener {
</a><a href="#h14-0-49" id="h14-0-49" class="d">-                val intent = Intent().apply {
</a><a href="#h14-0-50" id="h14-0-50" class="d">-                    setClassName(BuildConfig.APPLICATION_ID, ConfigActivity::class.java.name)
</a><a href="#h14-0-51" id="h14-0-51" class="d">-                }
</a><a href="#h14-0-52" id="h14-0-52" class="d">-                intent.putExtra(&quot;lspatched&quot;, File(context.cacheDir, &quot;lspatch/origin&quot;).exists())
</a><a href="#h14-0-53" id="h14-0-53" class="d">-                context.startActivity(intent)
</a><a href="#h14-0-54" id="h14-0-54" class="d">-            }
</a><a href="#h14-0-55" id="h14-0-55" class="d">-
</a><a href="#h14-0-56" id="h14-0-56" class="d">-            parent.setOnTouchListener { _, event -&gt;
</a><a href="#h14-0-57" id="h14-0-57" class="d">-                if (child.visibility == View.INVISIBLE || child.alpha == 0F) return@setOnTouchListener false
</a><a href="#h14-0-58" id="h14-0-58" class="d">-
</a><a href="#h14-0-59" id="h14-0-59" class="d">-                val viewLocation = IntArray(2)
</a><a href="#h14-0-60" id="h14-0-60" class="d">-                getLocationOnScreen(viewLocation)
</a><a href="#h14-0-61" id="h14-0-61" class="d">-
</a><a href="#h14-0-62" id="h14-0-62" class="d">-                val x = event.rawX - viewLocation[0]
</a><a href="#h14-0-63" id="h14-0-63" class="d">-                val y = event.rawY - viewLocation[1]
</a><a href="#h14-0-64" id="h14-0-64" class="d">-
</a><a href="#h14-0-65" id="h14-0-65" class="d">-                if (x &gt; 0 &amp;&amp; x &lt; width &amp;&amp; y &gt; 0 &amp;&amp; y &lt; height) {
</a><a href="#h14-0-66" id="h14-0-66" class="d">-                    performClick()
</a><a href="#h14-0-67" id="h14-0-67" class="d">-                }
</a><a href="#h14-0-68" id="h14-0-68" class="d">-
</a><a href="#h14-0-69" id="h14-0-69" class="d">-                false
</a><a href="#h14-0-70" id="h14-0-70" class="d">-            }
</a><a href="#h14-0-71" id="h14-0-71" class="d">-            backgroundTintList = firstView.backgroundTintList
</a><a href="#h14-0-72" id="h14-0-72" class="d">-            background = firstView.background
</a><a href="#h14-0-73" id="h14-0-73" class="d">-
</a><a href="#h14-0-74" id="h14-0-74" class="d">-            addView(ImageView(context).apply {
</a><a href="#h14-0-75" id="h14-0-75" class="d">-                layoutParams = FrameLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT, 17).apply {
</a><a href="#h14-0-76" id="h14-0-76" class="d">-                    gravity = android.view.Gravity.CENTER
</a><a href="#h14-0-77" id="h14-0-77" class="d">-                }
</a><a href="#h14-0-78" id="h14-0-78" class="d">-                setImageDrawable(settingsSvg)
</a><a href="#h14-0-79" id="h14-0-79" class="d">-                headerButtonOpaqueIconTint?.let {
</a><a href="#h14-0-80" id="h14-0-80" class="d">-                    imageTintList = it
</a><a href="#h14-0-81" id="h14-0-81" class="d">-                }
</a><a href="#h14-0-82" id="h14-0-82" class="d">-            })
</a><a href="#h14-0-83" id="h14-0-83" class="d">-        })
</a><a href="#h14-0-84" id="h14-0-84" class="d">-    }
</a><a href="#h14-0-85" id="h14-0-85" class="d">-}</a><a href="#h14-0-86" id="h14-0-86" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -1,111 +0,0 @@
</a><a href="#h15-0-0" id="h15-0-0" class="d">-package me.rhunk.snapenhance.ui.spoof
</a><a href="#h15-0-1" id="h15-0-1" class="d">-
</a><a href="#h15-0-2" id="h15-0-2" class="d">-import android.app.Activity
</a><a href="#h15-0-3" id="h15-0-3" class="d">-import android.content.res.ColorStateList
</a><a href="#h15-0-4" id="h15-0-4" class="d">-import android.os.Bundle
</a><a href="#h15-0-5" id="h15-0-5" class="d">-import android.text.InputType
</a><a href="#h15-0-6" id="h15-0-6" class="d">-import android.view.View
</a><a href="#h15-0-7" id="h15-0-7" class="d">-import android.view.ViewGroup
</a><a href="#h15-0-8" id="h15-0-8" class="d">-import android.widget.ImageButton
</a><a href="#h15-0-9" id="h15-0-9" class="d">-import android.widget.Switch
</a><a href="#h15-0-10" id="h15-0-10" class="d">-import android.widget.TextView
</a><a href="#h15-0-11" id="h15-0-11" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h15-0-12" id="h15-0-12" class="d">-import me.rhunk.snapenhance.SharedContext
</a><a href="#h15-0-13" id="h15-0-13" class="d">-import me.rhunk.snapenhance.config.ConfigCategory
</a><a href="#h15-0-14" id="h15-0-14" class="d">-import me.rhunk.snapenhance.config.impl.ConfigIntegerValue
</a><a href="#h15-0-15" id="h15-0-15" class="d">-import me.rhunk.snapenhance.config.impl.ConfigStateValue
</a><a href="#h15-0-16" id="h15-0-16" class="d">-import me.rhunk.snapenhance.config.impl.ConfigStringValue
</a><a href="#h15-0-17" id="h15-0-17" class="d">-import me.rhunk.snapenhance.ui.ItemHelper
</a><a href="#h15-0-18" id="h15-0-18" class="d">-
</a><a href="#h15-0-19" id="h15-0-19" class="d">-class DeviceSpooferActivity: Activity() {
</a><a href="#h15-0-20" id="h15-0-20" class="d">-    private val itemHelper = ItemHelper(this)
</a><a href="#h15-0-21" id="h15-0-21" class="d">-    
</a><a href="#h15-0-22" id="h15-0-22" class="d">-    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h15-0-23" id="h15-0-23" class="d">-        super.onCreate(savedInstanceState)
</a><a href="#h15-0-24" id="h15-0-24" class="d">-        SharedContext.ensureInitialized(this)
</a><a href="#h15-0-25" id="h15-0-25" class="d">-        setContentView(R.layout.device_spoofer_activity)
</a><a href="#h15-0-26" id="h15-0-26" class="d">-        
</a><a href="#h15-0-27" id="h15-0-27" class="d">-        findViewById&lt;TextView&gt;(R.id.title).text = &quot;Device Spoofer&quot;
</a><a href="#h15-0-28" id="h15-0-28" class="d">-        findViewById&lt;ImageButton&gt;(R.id.back_button).setOnClickListener { finish() }
</a><a href="#h15-0-29" id="h15-0-29" class="d">-        val propertyListLayout = findViewById&lt;ViewGroup&gt;(R.id.spoof_property_list)
</a><a href="#h15-0-30" id="h15-0-30" class="d">-        
</a><a href="#h15-0-31" id="h15-0-31" class="d">-        SharedContext.config.entries().filter { it.key.category == ConfigCategory.DEVICE_SPOOFER }.forEach { (property, value) -&gt;
</a><a href="#h15-0-32" id="h15-0-32" class="d">-            val configItem = layoutInflater.inflate(R.layout.config_activity_item, propertyListLayout, false)
</a><a href="#h15-0-33" id="h15-0-33" class="d">-            
</a><a href="#h15-0-34" id="h15-0-34" class="d">-            val propertyName = SharedContext.translation[&quot;property.${property.translationKey}.name&quot;]
</a><a href="#h15-0-35" id="h15-0-35" class="d">-            
</a><a href="#h15-0-36" id="h15-0-36" class="d">-            fun addSeparator() {
</a><a href="#h15-0-37" id="h15-0-37" class="d">-                //add separator
</a><a href="#h15-0-38" id="h15-0-38" class="d">-                propertyListLayout.addView(View(this).apply {
</a><a href="#h15-0-39" id="h15-0-39" class="d">-                    layoutParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, 1)
</a><a href="#h15-0-40" id="h15-0-40" class="d">-                    setBackgroundColor(getColor(R.color.tertiaryBackground))
</a><a href="#h15-0-41" id="h15-0-41" class="d">-                })
</a><a href="#h15-0-42" id="h15-0-42" class="d">-            }
</a><a href="#h15-0-43" id="h15-0-43" class="d">-            
</a><a href="#h15-0-44" id="h15-0-44" class="d">-            configItem.findViewById&lt;TextView&gt;(R.id.name).text = propertyName
</a><a href="#h15-0-45" id="h15-0-45" class="d">-            configItem.findViewById&lt;TextView&gt;(R.id.description).also {
</a><a href="#h15-0-46" id="h15-0-46" class="d">-                it.text = SharedContext.translation[&quot;property.${property.translationKey}.description&quot;]
</a><a href="#h15-0-47" id="h15-0-47" class="d">-                it.visibility = if (it.text.isEmpty()) View.GONE else View.VISIBLE
</a><a href="#h15-0-48" id="h15-0-48" class="d">-            }
</a><a href="#h15-0-49" id="h15-0-49" class="d">-        
</a><a href="#h15-0-50" id="h15-0-50" class="d">-            fun addValueView(view: View) {
</a><a href="#h15-0-51" id="h15-0-51" class="d">-                configItem.findViewById&lt;ViewGroup&gt;(R.id.value).addView(view)
</a><a href="#h15-0-52" id="h15-0-52" class="d">-            }
</a><a href="#h15-0-53" id="h15-0-53" class="d">-        
</a><a href="#h15-0-54" id="h15-0-54" class="d">-            when (value) {
</a><a href="#h15-0-55" id="h15-0-55" class="d">-                is ConfigStateValue -&gt; {
</a><a href="#h15-0-56" id="h15-0-56" class="d">-                    val switch = Switch(this)
</a><a href="#h15-0-57" id="h15-0-57" class="d">-                    switch.isChecked = value.value()
</a><a href="#h15-0-58" id="h15-0-58" class="d">-                    switch.trackTintList = ColorStateList(
</a><a href="#h15-0-59" id="h15-0-59" class="d">-                        arrayOf(
</a><a href="#h15-0-60" id="h15-0-60" class="d">-                            intArrayOf(android.R.attr.state_checked),
</a><a href="#h15-0-61" id="h15-0-61" class="d">-                            intArrayOf(-android.R.attr.state_checked)
</a><a href="#h15-0-62" id="h15-0-62" class="d">-                        ),
</a><a href="#h15-0-63" id="h15-0-63" class="d">-                        intArrayOf(
</a><a href="#h15-0-64" id="h15-0-64" class="d">-                            switch.highlightColor,
</a><a href="#h15-0-65" id="h15-0-65" class="d">-                            getColor(R.color.tertiaryBackground)
</a><a href="#h15-0-66" id="h15-0-66" class="d">-                        )
</a><a href="#h15-0-67" id="h15-0-67" class="d">-                    )
</a><a href="#h15-0-68" id="h15-0-68" class="d">-                    switch.setOnCheckedChangeListener { _, isChecked -&gt;
</a><a href="#h15-0-69" id="h15-0-69" class="d">-                        value.writeFrom(isChecked.toString())
</a><a href="#h15-0-70" id="h15-0-70" class="d">-                    }
</a><a href="#h15-0-71" id="h15-0-71" class="d">-                    configItem.setOnClickListener { switch.toggle() }
</a><a href="#h15-0-72" id="h15-0-72" class="d">-                    addValueView(switch)
</a><a href="#h15-0-73" id="h15-0-73" class="d">-                }
</a><a href="#h15-0-74" id="h15-0-74" class="d">-                is ConfigStringValue, is ConfigIntegerValue -&gt; {
</a><a href="#h15-0-75" id="h15-0-75" class="d">-                    val textView = itemHelper.createTranslatedTextView(property, shouldTranslatePropertyValue = false).also {
</a><a href="#h15-0-76" id="h15-0-76" class="d">-                        it.text = value.value().toString()
</a><a href="#h15-0-77" id="h15-0-77" class="d">-                    }
</a><a href="#h15-0-78" id="h15-0-78" class="d">-                    configItem.setOnClickListener {
</a><a href="#h15-0-79" id="h15-0-79" class="d">-                        if (value is ConfigIntegerValue) {
</a><a href="#h15-0-80" id="h15-0-80" class="d">-                            itemHelper.askForValue(property, InputType.TYPE_CLASS_NUMBER) {
</a><a href="#h15-0-81" id="h15-0-81" class="d">-                                try {
</a><a href="#h15-0-82" id="h15-0-82" class="d">-                                    value.writeFrom(it)
</a><a href="#h15-0-83" id="h15-0-83" class="d">-                                    textView.text = value.value().toString()
</a><a href="#h15-0-84" id="h15-0-84" class="d">-                                } catch (e: NumberFormatException) {
</a><a href="#h15-0-85" id="h15-0-85" class="d">-                                    itemHelper.longToast(SharedContext.translation[&quot;config_activity.invalid_number_toast&quot;], this)
</a><a href="#h15-0-86" id="h15-0-86" class="d">-                                }
</a><a href="#h15-0-87" id="h15-0-87" class="d">-                            }
</a><a href="#h15-0-88" id="h15-0-88" class="d">-                            return@setOnClickListener
</a><a href="#h15-0-89" id="h15-0-89" class="d">-                        }
</a><a href="#h15-0-90" id="h15-0-90" class="d">-                        itemHelper.askForValue(property, InputType.TYPE_CLASS_TEXT) {
</a><a href="#h15-0-91" id="h15-0-91" class="d">-                            value.writeFrom(it)
</a><a href="#h15-0-92" id="h15-0-92" class="d">-                            textView.text = value.value().toString()
</a><a href="#h15-0-93" id="h15-0-93" class="d">-                        }
</a><a href="#h15-0-94" id="h15-0-94" class="d">-                    }
</a><a href="#h15-0-95" id="h15-0-95" class="d">-                    addValueView(textView)
</a><a href="#h15-0-96" id="h15-0-96" class="d">-                }
</a><a href="#h15-0-97" id="h15-0-97" class="d">-            }
</a><a href="#h15-0-98" id="h15-0-98" class="d">-        
</a><a href="#h15-0-99" id="h15-0-99" class="d">-            propertyListLayout.addView(configItem)
</a><a href="#h15-0-100" id="h15-0-100" class="d">-            addSeparator()
</a><a href="#h15-0-101" id="h15-0-101" class="d">-        }
</a><a href="#h15-0-102" id="h15-0-102" class="d">-    }
</a><a href="#h15-0-103" id="h15-0-103" class="d">-    
</a><a href="#h15-0-104" id="h15-0-104" class="d">-    @Deprecated(&quot;Deprecated in Java&quot;)
</a><a href="#h15-0-105" id="h15-0-105" class="d">-    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h15-0-106" id="h15-0-106" class="d">-    override fun onBackPressed() {
</a><a href="#h15-0-107" id="h15-0-107" class="d">-        super.onBackPressed()
</a><a href="#h15-0-108" id="h15-0-108" class="d">-        finish()
</a><a href="#h15-0-109" id="h15-0-109" class="d">-    }
</a><a href="#h15-0-110" id="h15-0-110" class="d">-}</a><a href="#h15-0-111" id="h15-0-111" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -1,337 +0,0 @@
</a><a href="#h16-0-0" id="h16-0-0" class="d">-package me.rhunk.snapenhance.util.export
</a><a href="#h16-0-1" id="h16-0-1" class="d">-
</a><a href="#h16-0-2" id="h16-0-2" class="d">-import android.content.pm.PackageManager
</a><a href="#h16-0-3" id="h16-0-3" class="d">-import android.os.Environment
</a><a href="#h16-0-4" id="h16-0-4" class="d">-import android.util.Base64InputStream
</a><a href="#h16-0-5" id="h16-0-5" class="d">-import com.google.gson.JsonArray
</a><a href="#h16-0-6" id="h16-0-6" class="d">-import com.google.gson.JsonObject
</a><a href="#h16-0-7" id="h16-0-7" class="d">-import de.robv.android.xposed.XposedHelpers
</a><a href="#h16-0-8" id="h16-0-8" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h16-0-9" id="h16-0-9" class="d">-import kotlinx.coroutines.async
</a><a href="#h16-0-10" id="h16-0-10" class="d">-import kotlinx.coroutines.awaitAll
</a><a href="#h16-0-11" id="h16-0-11" class="d">-import kotlinx.coroutines.withContext
</a><a href="#h16-0-12" id="h16-0-12" class="d">-import me.rhunk.snapenhance.BuildConfig
</a><a href="#h16-0-13" id="h16-0-13" class="d">-import me.rhunk.snapenhance.Logger
</a><a href="#h16-0-14" id="h16-0-14" class="d">-import me.rhunk.snapenhance.ModContext
</a><a href="#h16-0-15" id="h16-0-15" class="d">-import me.rhunk.snapenhance.data.ContentType
</a><a href="#h16-0-16" id="h16-0-16" class="d">-import me.rhunk.snapenhance.data.FileType
</a><a href="#h16-0-17" id="h16-0-17" class="d">-import me.rhunk.snapenhance.data.MediaReferenceType
</a><a href="#h16-0-18" id="h16-0-18" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h16-0-19" id="h16-0-19" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a><a href="#h16-0-20" id="h16-0-20" class="d">-import me.rhunk.snapenhance.database.objects.FriendFeedInfo
</a><a href="#h16-0-21" id="h16-0-21" class="d">-import me.rhunk.snapenhance.database.objects.FriendInfo
</a><a href="#h16-0-22" id="h16-0-22" class="d">-import me.rhunk.snapenhance.util.getApplicationInfoCompat
</a><a href="#h16-0-23" id="h16-0-23" class="d">-import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a><a href="#h16-0-24" id="h16-0-24" class="d">-import me.rhunk.snapenhance.util.snap.EncryptionHelper
</a><a href="#h16-0-25" id="h16-0-25" class="d">-import me.rhunk.snapenhance.util.snap.MediaDownloaderHelper
</a><a href="#h16-0-26" id="h16-0-26" class="d">-import java.io.File
</a><a href="#h16-0-27" id="h16-0-27" class="d">-import java.io.FileOutputStream
</a><a href="#h16-0-28" id="h16-0-28" class="d">-import java.io.InputStream
</a><a href="#h16-0-29" id="h16-0-29" class="d">-import java.io.OutputStream
</a><a href="#h16-0-30" id="h16-0-30" class="d">-import java.text.SimpleDateFormat
</a><a href="#h16-0-31" id="h16-0-31" class="d">-import java.util.Base64
</a><a href="#h16-0-32" id="h16-0-32" class="d">-import java.util.Collections
</a><a href="#h16-0-33" id="h16-0-33" class="d">-import java.util.Date
</a><a href="#h16-0-34" id="h16-0-34" class="d">-import java.util.Locale
</a><a href="#h16-0-35" id="h16-0-35" class="d">-import java.util.zip.Deflater
</a><a href="#h16-0-36" id="h16-0-36" class="d">-import java.util.zip.DeflaterInputStream
</a><a href="#h16-0-37" id="h16-0-37" class="d">-import java.util.zip.ZipFile
</a><a href="#h16-0-38" id="h16-0-38" class="d">-import kotlin.io.encoding.ExperimentalEncodingApi
</a><a href="#h16-0-39" id="h16-0-39" class="d">-
</a><a href="#h16-0-40" id="h16-0-40" class="d">-
</a><a href="#h16-0-41" id="h16-0-41" class="d">-enum class ExportFormat(
</a><a href="#h16-0-42" id="h16-0-42" class="d">-    val extension: String,
</a><a href="#h16-0-43" id="h16-0-43" class="d">-){
</a><a href="#h16-0-44" id="h16-0-44" class="d">-    JSON(&quot;json&quot;),
</a><a href="#h16-0-45" id="h16-0-45" class="d">-    TEXT(&quot;txt&quot;),
</a><a href="#h16-0-46" id="h16-0-46" class="d">-    HTML(&quot;html&quot;);
</a><a href="#h16-0-47" id="h16-0-47" class="d">-}
</a><a href="#h16-0-48" id="h16-0-48" class="d">-
</a><a href="#h16-0-49" id="h16-0-49" class="d">-class MessageExporter(
</a><a href="#h16-0-50" id="h16-0-50" class="d">-    private val context: ModContext,
</a><a href="#h16-0-51" id="h16-0-51" class="d">-    private val outputFile: File,
</a><a href="#h16-0-52" id="h16-0-52" class="d">-    private val friendFeedInfo: FriendFeedInfo,
</a><a href="#h16-0-53" id="h16-0-53" class="d">-    private val mediaToDownload: List&lt;ContentType&gt;? = null,
</a><a href="#h16-0-54" id="h16-0-54" class="d">-    private val printLog: (String) -&gt; Unit = {},
</a><a href="#h16-0-55" id="h16-0-55" class="d">-) {
</a><a href="#h16-0-56" id="h16-0-56" class="d">-    private lateinit var conversationParticipants: Map&lt;String, FriendInfo&gt;
</a><a href="#h16-0-57" id="h16-0-57" class="d">-    private lateinit var messages: List&lt;Message&gt;
</a><a href="#h16-0-58" id="h16-0-58" class="d">-
</a><a href="#h16-0-59" id="h16-0-59" class="d">-    fun readMessages(messages: List&lt;Message&gt;) {
</a><a href="#h16-0-60" id="h16-0-60" class="d">-        conversationParticipants =
</a><a href="#h16-0-61" id="h16-0-61" class="d">-            context.database.getConversationParticipants(friendFeedInfo.key!!)
</a><a href="#h16-0-62" id="h16-0-62" class="d">-                ?.mapNotNull {
</a><a href="#h16-0-63" id="h16-0-63" class="d">-                    context.database.getFriendInfo(it)
</a><a href="#h16-0-64" id="h16-0-64" class="d">-                }?.associateBy { it.userId!! } ?: emptyMap()
</a><a href="#h16-0-65" id="h16-0-65" class="d">-
</a><a href="#h16-0-66" id="h16-0-66" class="d">-        if (conversationParticipants.isEmpty())
</a><a href="#h16-0-67" id="h16-0-67" class="d">-            throw Throwable(&quot;Failed to get conversation participants for ${friendFeedInfo.key}&quot;)
</a><a href="#h16-0-68" id="h16-0-68" class="d">-
</a><a href="#h16-0-69" id="h16-0-69" class="d">-        this.messages = messages.sortedBy { it.orderKey }
</a><a href="#h16-0-70" id="h16-0-70" class="d">-    }
</a><a href="#h16-0-71" id="h16-0-71" class="d">-
</a><a href="#h16-0-72" id="h16-0-72" class="d">-    private fun serializeMessageContent(message: Message): String? {
</a><a href="#h16-0-73" id="h16-0-73" class="d">-        return if (message.messageContent.contentType == ContentType.CHAT) {
</a><a href="#h16-0-74" id="h16-0-74" class="d">-            ProtoReader(message.messageContent.content).getString(2, 1) ?: &quot;Failed to parse message&quot;
</a><a href="#h16-0-75" id="h16-0-75" class="d">-        } else null
</a><a href="#h16-0-76" id="h16-0-76" class="d">-    }
</a><a href="#h16-0-77" id="h16-0-77" class="d">-
</a><a href="#h16-0-78" id="h16-0-78" class="d">-    private fun exportText(output: OutputStream) {
</a><a href="#h16-0-79" id="h16-0-79" class="d">-        val writer = output.bufferedWriter()
</a><a href="#h16-0-80" id="h16-0-80" class="d">-        writer.write(&quot;Conversation key: ${friendFeedInfo.key}\n&quot;)
</a><a href="#h16-0-81" id="h16-0-81" class="d">-        writer.write(&quot;Conversation Name: ${friendFeedInfo.feedDisplayName}\n&quot;)
</a><a href="#h16-0-82" id="h16-0-82" class="d">-        writer.write(&quot;Participants:\n&quot;)
</a><a href="#h16-0-83" id="h16-0-83" class="d">-        conversationParticipants.forEach { (userId, friendInfo) -&gt;
</a><a href="#h16-0-84" id="h16-0-84" class="d">-            writer.write(&quot;  $userId: ${friendInfo.displayName}\n&quot;)
</a><a href="#h16-0-85" id="h16-0-85" class="d">-        }
</a><a href="#h16-0-86" id="h16-0-86" class="d">-
</a><a href="#h16-0-87" id="h16-0-87" class="d">-        writer.write(&quot;\nMessages:\n&quot;)
</a><a href="#h16-0-88" id="h16-0-88" class="d">-        messages.forEach { message -&gt;
</a><a href="#h16-0-89" id="h16-0-89" class="d">-            val sender = conversationParticipants[message.senderId.toString()]
</a><a href="#h16-0-90" id="h16-0-90" class="d">-            val senderUsername = sender?.usernameForSorting ?: message.senderId.toString()
</a><a href="#h16-0-91" id="h16-0-91" class="d">-            val senderDisplayName = sender?.displayName ?: message.senderId.toString()
</a><a href="#h16-0-92" id="h16-0-92" class="d">-            val messageContent = serializeMessageContent(message) ?: message.messageContent.contentType.name
</a><a href="#h16-0-93" id="h16-0-93" class="d">-            val date = SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;, Locale.ENGLISH).format(Date(message.messageMetadata.createdAt))
</a><a href="#h16-0-94" id="h16-0-94" class="d">-            writer.write(&quot;[$date] - $senderDisplayName (${senderUsername}): $messageContent\n&quot;)
</a><a href="#h16-0-95" id="h16-0-95" class="d">-        }
</a><a href="#h16-0-96" id="h16-0-96" class="d">-        writer.flush()
</a><a href="#h16-0-97" id="h16-0-97" class="d">-    }
</a><a href="#h16-0-98" id="h16-0-98" class="d">-
</a><a href="#h16-0-99" id="h16-0-99" class="d">-    @OptIn(ExperimentalEncodingApi::class)
</a><a href="#h16-0-100" id="h16-0-100" class="d">-    suspend fun exportHtml(output: OutputStream) {
</a><a href="#h16-0-101" id="h16-0-101" class="d">-        val downloadMediaCacheFolder = File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS), &quot;SnapEnhance/cache&quot;).also { it.mkdirs() }
</a><a href="#h16-0-102" id="h16-0-102" class="d">-        val mediaFiles = Collections.synchronizedMap(mutableMapOf&lt;String, Pair&lt;FileType, File&gt;&gt;())
</a><a href="#h16-0-103" id="h16-0-103" class="d">-
</a><a href="#h16-0-104" id="h16-0-104" class="d">-        printLog(&quot;found ${messages.size} messages&quot;)
</a><a href="#h16-0-105" id="h16-0-105" class="d">-
</a><a href="#h16-0-106" id="h16-0-106" class="d">-        withContext(Dispatchers.IO) {
</a><a href="#h16-0-107" id="h16-0-107" class="d">-            messages.filter {
</a><a href="#h16-0-108" id="h16-0-108" class="d">-                mediaToDownload?.contains(it.messageContent.contentType) ?: false
</a><a href="#h16-0-109" id="h16-0-109" class="d">-            }.map { message -&gt;
</a><a href="#h16-0-110" id="h16-0-110" class="d">-                async {
</a><a href="#h16-0-111" id="h16-0-111" class="d">-                    val remoteMediaReferences by lazy {
</a><a href="#h16-0-112" id="h16-0-112" class="d">-                        val serializedMessageContent = context.gson.toJsonTree(message.messageContent.instanceNonNull()).asJsonObject
</a><a href="#h16-0-113" id="h16-0-113" class="d">-                        serializedMessageContent[&quot;mRemoteMediaReferences&quot;]
</a><a href="#h16-0-114" id="h16-0-114" class="d">-                            .asJsonArray.map { it.asJsonObject[&quot;mMediaReferences&quot;].asJsonArray }
</a><a href="#h16-0-115" id="h16-0-115" class="d">-                            .flatten()
</a><a href="#h16-0-116" id="h16-0-116" class="d">-                    }
</a><a href="#h16-0-117" id="h16-0-117" class="d">-
</a><a href="#h16-0-118" id="h16-0-118" class="d">-                    remoteMediaReferences.firstOrNull().takeIf { it != null }?.let { media -&gt;
</a><a href="#h16-0-119" id="h16-0-119" class="d">-                        val protoMediaReference = media.asJsonObject[&quot;mContentObject&quot;].asJsonArray.map { it.asByte }.toByteArray()
</a><a href="#h16-0-120" id="h16-0-120" class="d">-
</a><a href="#h16-0-121" id="h16-0-121" class="d">-                        runCatching {
</a><a href="#h16-0-122" id="h16-0-122" class="d">-                            val downloadedMedia = MediaDownloaderHelper.downloadMediaFromReference(protoMediaReference) {
</a><a href="#h16-0-123" id="h16-0-123" class="d">-                                EncryptionHelper.decryptInputStream(it, message.messageContent.contentType, ProtoReader(message.messageContent.content), isArroyo = false)
</a><a href="#h16-0-124" id="h16-0-124" class="d">-                            }
</a><a href="#h16-0-125" id="h16-0-125" class="d">-
</a><a href="#h16-0-126" id="h16-0-126" class="d">-                            printLog(&quot;downloaded media ${message.orderKey}&quot;)
</a><a href="#h16-0-127" id="h16-0-127" class="d">-
</a><a href="#h16-0-128" id="h16-0-128" class="d">-                            downloadedMedia.forEach { (type, mediaData) -&gt;
</a><a href="#h16-0-129" id="h16-0-129" class="d">-                                val fileType = FileType.fromByteArray(mediaData)
</a><a href="#h16-0-130" id="h16-0-130" class="d">-                                val fileName = &quot;${type}_${kotlin.io.encoding.Base64.UrlSafe.encode(protoMediaReference).replace(&quot;=&quot;, &quot;&quot;)}&quot;
</a><a href="#h16-0-131" id="h16-0-131" class="d">-
</a><a href="#h16-0-132" id="h16-0-132" class="d">-                                val mediaFile = File(downloadMediaCacheFolder, &quot;$fileName.${fileType.fileExtension}&quot;)
</a><a href="#h16-0-133" id="h16-0-133" class="d">-
</a><a href="#h16-0-134" id="h16-0-134" class="d">-                                FileOutputStream(mediaFile).use { fos -&gt;
</a><a href="#h16-0-135" id="h16-0-135" class="d">-                                    mediaData.inputStream().copyTo(fos)
</a><a href="#h16-0-136" id="h16-0-136" class="d">-                                }
</a><a href="#h16-0-137" id="h16-0-137" class="d">-
</a><a href="#h16-0-138" id="h16-0-138" class="d">-                                mediaFiles[fileName] = fileType to mediaFile
</a><a href="#h16-0-139" id="h16-0-139" class="d">-                            }
</a><a href="#h16-0-140" id="h16-0-140" class="d">-                        }.onFailure {
</a><a href="#h16-0-141" id="h16-0-141" class="d">-                            printLog(&quot;failed to download media for ${message.messageDescriptor.conversationId}_${message.orderKey}&quot;)
</a><a href="#h16-0-142" id="h16-0-142" class="d">-                            Logger.error(&quot;failed to download media for ${message.messageDescriptor.conversationId}_${message.orderKey}&quot;, it)
</a><a href="#h16-0-143" id="h16-0-143" class="d">-                        }
</a><a href="#h16-0-144" id="h16-0-144" class="d">-                    }
</a><a href="#h16-0-145" id="h16-0-145" class="d">-                }
</a><a href="#h16-0-146" id="h16-0-146" class="d">-            }.awaitAll()
</a><a href="#h16-0-147" id="h16-0-147" class="d">-        }
</a><a href="#h16-0-148" id="h16-0-148" class="d">-
</a><a href="#h16-0-149" id="h16-0-149" class="d">-        printLog(&quot;writing downloaded medias...&quot;)
</a><a href="#h16-0-150" id="h16-0-150" class="d">-
</a><a href="#h16-0-151" id="h16-0-151" class="d">-        //write the head of the html file
</a><a href="#h16-0-152" id="h16-0-152" class="d">-        output.write(&quot;&quot;&quot;
</a><a href="#h16-0-153" id="h16-0-153" class="d">-            &lt;!DOCTYPE html&gt;
</a><a href="#h16-0-154" id="h16-0-154" class="d">-            &lt;html&gt;
</a><a href="#h16-0-155" id="h16-0-155" class="d">-            &lt;head&gt;
</a><a href="#h16-0-156" id="h16-0-156" class="d">-                &lt;meta charset=&quot;UTF-8&quot;&gt;
</a><a href="#h16-0-157" id="h16-0-157" class="d">-                &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
</a><a href="#h16-0-158" id="h16-0-158" class="d">-                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
</a><a href="#h16-0-159" id="h16-0-159" class="d">-                &lt;title&gt;&lt;/title&gt;
</a><a href="#h16-0-160" id="h16-0-160" class="d">-            &lt;/head&gt;
</a><a href="#h16-0-161" id="h16-0-161" class="d">-        &quot;&quot;&quot;.trimIndent().toByteArray())
</a><a href="#h16-0-162" id="h16-0-162" class="d">-
</a><a href="#h16-0-163" id="h16-0-163" class="d">-        output.write(&quot;&lt;!-- This file was generated by SnapEnhance ${BuildConfig.VERSION_NAME} --&gt;\n&quot;.toByteArray())
</a><a href="#h16-0-164" id="h16-0-164" class="d">-
</a><a href="#h16-0-165" id="h16-0-165" class="d">-        mediaFiles.forEach { (key, filePair) -&gt;
</a><a href="#h16-0-166" id="h16-0-166" class="d">-            printLog(&quot;writing $key...&quot;)
</a><a href="#h16-0-167" id="h16-0-167" class="d">-            output.write(&quot;&lt;div class=\&quot;media-$key\&quot;&gt;&lt;!-- &quot;.toByteArray())
</a><a href="#h16-0-168" id="h16-0-168" class="d">-
</a><a href="#h16-0-169" id="h16-0-169" class="d">-            val deflateInputStream = DeflaterInputStream(filePair.second.inputStream(), Deflater(Deflater.BEST_COMPRESSION, true))
</a><a href="#h16-0-170" id="h16-0-170" class="d">-            val base64InputStream = XposedHelpers.newInstance(
</a><a href="#h16-0-171" id="h16-0-171" class="d">-                Base64InputStream::class.java,
</a><a href="#h16-0-172" id="h16-0-172" class="d">-                deflateInputStream,
</a><a href="#h16-0-173" id="h16-0-173" class="d">-                android.util.Base64.DEFAULT or android.util.Base64.NO_WRAP,
</a><a href="#h16-0-174" id="h16-0-174" class="d">-                true
</a><a href="#h16-0-175" id="h16-0-175" class="d">-            ) as InputStream
</a><a href="#h16-0-176" id="h16-0-176" class="d">-            base64InputStream.copyTo(output)
</a><a href="#h16-0-177" id="h16-0-177" class="d">-            deflateInputStream.close()
</a><a href="#h16-0-178" id="h16-0-178" class="d">-
</a><a href="#h16-0-179" id="h16-0-179" class="d">-            output.write(&quot; --&gt;&lt;/div&gt;\n&quot;.toByteArray())
</a><a href="#h16-0-180" id="h16-0-180" class="d">-            output.flush()
</a><a href="#h16-0-181" id="h16-0-181" class="d">-        }
</a><a href="#h16-0-182" id="h16-0-182" class="d">-        printLog(&quot;writing json conversation data...&quot;)
</a><a href="#h16-0-183" id="h16-0-183" class="d">-
</a><a href="#h16-0-184" id="h16-0-184" class="d">-        //write the json file
</a><a href="#h16-0-185" id="h16-0-185" class="d">-        output.write(&quot;&lt;script type=\&quot;application/json\&quot; class=\&quot;exported_content\&quot;&gt;&quot;.toByteArray())
</a><a href="#h16-0-186" id="h16-0-186" class="d">-        exportJson(output)
</a><a href="#h16-0-187" id="h16-0-187" class="d">-        output.write(&quot;&lt;/script&gt;\n&quot;.toByteArray())
</a><a href="#h16-0-188" id="h16-0-188" class="d">-
</a><a href="#h16-0-189" id="h16-0-189" class="d">-        printLog(&quot;writing template...&quot;)
</a><a href="#h16-0-190" id="h16-0-190" class="d">-
</a><a href="#h16-0-191" id="h16-0-191" class="d">-        runCatching {
</a><a href="#h16-0-192" id="h16-0-192" class="d">-            ZipFile(
</a><a href="#h16-0-193" id="h16-0-193" class="d">-                context.androidContext.packageManager.getApplicationInfoCompat(BuildConfig.APPLICATION_ID, PackageManager.GET_META_DATA).publicSourceDir
</a><a href="#h16-0-194" id="h16-0-194" class="d">-            ).use { apkFile -&gt;
</a><a href="#h16-0-195" id="h16-0-195" class="d">-                //export rawinflate.js
</a><a href="#h16-0-196" id="h16-0-196" class="d">-                apkFile.getEntry(&quot;assets/web/rawinflate.js&quot;).let { entry -&gt;
</a><a href="#h16-0-197" id="h16-0-197" class="d">-                    output.write(&quot;&lt;script&gt;&quot;.toByteArray())
</a><a href="#h16-0-198" id="h16-0-198" class="d">-                    apkFile.getInputStream(entry).copyTo(output)
</a><a href="#h16-0-199" id="h16-0-199" class="d">-                    output.write(&quot;&lt;/script&gt;\n&quot;.toByteArray())
</a><a href="#h16-0-200" id="h16-0-200" class="d">-                }
</a><a href="#h16-0-201" id="h16-0-201" class="d">-
</a><a href="#h16-0-202" id="h16-0-202" class="d">-                //export avenir next font
</a><a href="#h16-0-203" id="h16-0-203" class="d">-                apkFile.getEntry(&quot;res/font/avenir_next_medium.ttf&quot;).let { entry -&gt;
</a><a href="#h16-0-204" id="h16-0-204" class="d">-                    val encodedFontData = kotlin.io.encoding.Base64.Default.encode(apkFile.getInputStream(entry).readBytes())
</a><a href="#h16-0-205" id="h16-0-205" class="d">-                    output.write(&quot;&quot;&quot;
</a><a href="#h16-0-206" id="h16-0-206" class="d">-                        &lt;style&gt;
</a><a href="#h16-0-207" id="h16-0-207" class="d">-                            @font-face {
</a><a href="#h16-0-208" id="h16-0-208" class="d">-                                font-family: &#39;Avenir Next&#39;;
</a><a href="#h16-0-209" id="h16-0-209" class="d">-                                src: url(&#39;data:font/truetype;charset=utf-8;base64, $encodedFontData&#39;);
</a><a href="#h16-0-210" id="h16-0-210" class="d">-                                font-weight: normal;
</a><a href="#h16-0-211" id="h16-0-211" class="d">-                                font-style: normal;
</a><a href="#h16-0-212" id="h16-0-212" class="d">-                            }
</a><a href="#h16-0-213" id="h16-0-213" class="d">-                        &lt;/style&gt;
</a><a href="#h16-0-214" id="h16-0-214" class="d">-                    &quot;&quot;&quot;.trimIndent().toByteArray())
</a><a href="#h16-0-215" id="h16-0-215" class="d">-                }
</a><a href="#h16-0-216" id="h16-0-216" class="d">-
</a><a href="#h16-0-217" id="h16-0-217" class="d">-                apkFile.getEntry(&quot;assets/web/export_template.html&quot;).let { entry -&gt;
</a><a href="#h16-0-218" id="h16-0-218" class="d">-                    apkFile.getInputStream(entry).copyTo(output)
</a><a href="#h16-0-219" id="h16-0-219" class="d">-                }
</a><a href="#h16-0-220" id="h16-0-220" class="d">-
</a><a href="#h16-0-221" id="h16-0-221" class="d">-                apkFile.close()
</a><a href="#h16-0-222" id="h16-0-222" class="d">-            }
</a><a href="#h16-0-223" id="h16-0-223" class="d">-        }.onFailure {
</a><a href="#h16-0-224" id="h16-0-224" class="d">-            printLog(&quot;failed to read template from apk&quot;)
</a><a href="#h16-0-225" id="h16-0-225" class="d">-            Logger.error(&quot;failed to read template from apk&quot;, it)
</a><a href="#h16-0-226" id="h16-0-226" class="d">-        }
</a><a href="#h16-0-227" id="h16-0-227" class="d">-
</a><a href="#h16-0-228" id="h16-0-228" class="d">-        output.write(&quot;&lt;/html&gt;&quot;.toByteArray())
</a><a href="#h16-0-229" id="h16-0-229" class="d">-        output.close()
</a><a href="#h16-0-230" id="h16-0-230" class="d">-        printLog(&quot;done&quot;)
</a><a href="#h16-0-231" id="h16-0-231" class="d">-    }
</a><a href="#h16-0-232" id="h16-0-232" class="d">-
</a><a href="#h16-0-233" id="h16-0-233" class="d">-    private fun exportJson(output: OutputStream) {
</a><a href="#h16-0-234" id="h16-0-234" class="d">-        val rootObject = JsonObject().apply {
</a><a href="#h16-0-235" id="h16-0-235" class="d">-            addProperty(&quot;conversationId&quot;, friendFeedInfo.key)
</a><a href="#h16-0-236" id="h16-0-236" class="d">-            addProperty(&quot;conversationName&quot;, friendFeedInfo.feedDisplayName)
</a><a href="#h16-0-237" id="h16-0-237" class="d">-
</a><a href="#h16-0-238" id="h16-0-238" class="d">-            var index = 0
</a><a href="#h16-0-239" id="h16-0-239" class="d">-            val participants = mutableMapOf&lt;String, Int&gt;()
</a><a href="#h16-0-240" id="h16-0-240" class="d">-
</a><a href="#h16-0-241" id="h16-0-241" class="d">-            add(&quot;participants&quot;, JsonObject().apply {
</a><a href="#h16-0-242" id="h16-0-242" class="d">-                conversationParticipants.forEach { (userId, friendInfo) -&gt;
</a><a href="#h16-0-243" id="h16-0-243" class="d">-                    add(userId, JsonObject().apply {
</a><a href="#h16-0-244" id="h16-0-244" class="d">-                        addProperty(&quot;id&quot;, index)
</a><a href="#h16-0-245" id="h16-0-245" class="d">-                        addProperty(&quot;displayName&quot;, friendInfo.displayName)
</a><a href="#h16-0-246" id="h16-0-246" class="d">-                        addProperty(&quot;username&quot;, friendInfo.usernameForSorting)
</a><a href="#h16-0-247" id="h16-0-247" class="d">-                        addProperty(&quot;bitmojiSelfieId&quot;, friendInfo.bitmojiSelfieId)
</a><a href="#h16-0-248" id="h16-0-248" class="d">-                    })
</a><a href="#h16-0-249" id="h16-0-249" class="d">-                    participants[userId] = index++
</a><a href="#h16-0-250" id="h16-0-250" class="d">-                }
</a><a href="#h16-0-251" id="h16-0-251" class="d">-            })
</a><a href="#h16-0-252" id="h16-0-252" class="d">-            add(&quot;messages&quot;, JsonArray().apply {
</a><a href="#h16-0-253" id="h16-0-253" class="d">-                messages.forEach { message -&gt;
</a><a href="#h16-0-254" id="h16-0-254" class="d">-                    add(JsonObject().apply {
</a><a href="#h16-0-255" id="h16-0-255" class="d">-                        addProperty(&quot;orderKey&quot;, message.orderKey)
</a><a href="#h16-0-256" id="h16-0-256" class="d">-                        addProperty(&quot;senderId&quot;, participants.getOrDefault(message.senderId.toString(), -1))
</a><a href="#h16-0-257" id="h16-0-257" class="d">-                        addProperty(&quot;type&quot;, message.messageContent.contentType.toString())
</a><a href="#h16-0-258" id="h16-0-258" class="d">-
</a><a href="#h16-0-259" id="h16-0-259" class="d">-                        fun addUUIDList(name: String, list: List&lt;SnapUUID&gt;) {
</a><a href="#h16-0-260" id="h16-0-260" class="d">-                            add(name, JsonArray().apply {
</a><a href="#h16-0-261" id="h16-0-261" class="d">-                                list.map { participants.getOrDefault(it.toString(), -1) }.forEach { add(it) }
</a><a href="#h16-0-262" id="h16-0-262" class="d">-                            })
</a><a href="#h16-0-263" id="h16-0-263" class="d">-                        }
</a><a href="#h16-0-264" id="h16-0-264" class="d">-
</a><a href="#h16-0-265" id="h16-0-265" class="d">-                        addUUIDList(&quot;savedBy&quot;, message.messageMetadata.savedBy)
</a><a href="#h16-0-266" id="h16-0-266" class="d">-                        addUUIDList(&quot;seenBy&quot;, message.messageMetadata.seenBy)
</a><a href="#h16-0-267" id="h16-0-267" class="d">-                        addUUIDList(&quot;openedBy&quot;, message.messageMetadata.openedBy)
</a><a href="#h16-0-268" id="h16-0-268" class="d">-
</a><a href="#h16-0-269" id="h16-0-269" class="d">-                        add(&quot;reactions&quot;, JsonObject().apply {
</a><a href="#h16-0-270" id="h16-0-270" class="d">-                            message.messageMetadata.reactions.forEach { reaction -&gt;
</a><a href="#h16-0-271" id="h16-0-271" class="d">-                                addProperty(
</a><a href="#h16-0-272" id="h16-0-272" class="d">-                                    participants.getOrDefault(reaction.userId.toString(), -1L).toString(),
</a><a href="#h16-0-273" id="h16-0-273" class="d">-                                    reaction.reactionId
</a><a href="#h16-0-274" id="h16-0-274" class="d">-                                )
</a><a href="#h16-0-275" id="h16-0-275" class="d">-                            }
</a><a href="#h16-0-276" id="h16-0-276" class="d">-                        })
</a><a href="#h16-0-277" id="h16-0-277" class="d">-
</a><a href="#h16-0-278" id="h16-0-278" class="d">-                        addProperty(&quot;createdTimestamp&quot;, message.messageMetadata.createdAt)
</a><a href="#h16-0-279" id="h16-0-279" class="d">-                        addProperty(&quot;readTimestamp&quot;, message.messageMetadata.readAt)
</a><a href="#h16-0-280" id="h16-0-280" class="d">-                        addProperty(&quot;serializedContent&quot;, serializeMessageContent(message))
</a><a href="#h16-0-281" id="h16-0-281" class="d">-                        addProperty(&quot;rawContent&quot;, Base64.getUrlEncoder().encodeToString(message.messageContent.content))
</a><a href="#h16-0-282" id="h16-0-282" class="d">-
</a><a href="#h16-0-283" id="h16-0-283" class="d">-                        val messageContentType = message.messageContent.contentType
</a><a href="#h16-0-284" id="h16-0-284" class="d">-
</a><a href="#h16-0-285" id="h16-0-285" class="d">-                        EncryptionHelper.getEncryptionKeys(messageContentType, ProtoReader(message.messageContent.content), isArroyo = false)?.let { encryptionKeyPair -&gt;
</a><a href="#h16-0-286" id="h16-0-286" class="d">-                            add(&quot;encryption&quot;, JsonObject().apply encryption@{
</a><a href="#h16-0-287" id="h16-0-287" class="d">-                                addProperty(&quot;key&quot;, Base64.getEncoder().encodeToString(encryptionKeyPair.first))
</a><a href="#h16-0-288" id="h16-0-288" class="d">-                                addProperty(&quot;iv&quot;, Base64.getEncoder().encodeToString(encryptionKeyPair.second))
</a><a href="#h16-0-289" id="h16-0-289" class="d">-                            })
</a><a href="#h16-0-290" id="h16-0-290" class="d">-                        }
</a><a href="#h16-0-291" id="h16-0-291" class="d">-
</a><a href="#h16-0-292" id="h16-0-292" class="d">-                        val remoteMediaReferences by lazy {
</a><a href="#h16-0-293" id="h16-0-293" class="d">-                            val serializedMessageContent = context.gson.toJsonTree(message.messageContent.instanceNonNull()).asJsonObject
</a><a href="#h16-0-294" id="h16-0-294" class="d">-                            serializedMessageContent[&quot;mRemoteMediaReferences&quot;]
</a><a href="#h16-0-295" id="h16-0-295" class="d">-                                .asJsonArray.map { it.asJsonObject[&quot;mMediaReferences&quot;].asJsonArray }
</a><a href="#h16-0-296" id="h16-0-296" class="d">-                                .flatten()
</a><a href="#h16-0-297" id="h16-0-297" class="d">-                        }
</a><a href="#h16-0-298" id="h16-0-298" class="d">-
</a><a href="#h16-0-299" id="h16-0-299" class="d">-                        add(&quot;mediaReferences&quot;, JsonArray().apply mediaReferences@ {
</a><a href="#h16-0-300" id="h16-0-300" class="d">-                            if (messageContentType != ContentType.EXTERNAL_MEDIA &amp;&amp;
</a><a href="#h16-0-301" id="h16-0-301" class="d">-                                messageContentType != ContentType.STICKER &amp;&amp;
</a><a href="#h16-0-302" id="h16-0-302" class="d">-                                messageContentType != ContentType.SNAP &amp;&amp;
</a><a href="#h16-0-303" id="h16-0-303" class="d">-                                messageContentType != ContentType.NOTE)
</a><a href="#h16-0-304" id="h16-0-304" class="d">-                                return@mediaReferences
</a><a href="#h16-0-305" id="h16-0-305" class="d">-
</a><a href="#h16-0-306" id="h16-0-306" class="d">-                            remoteMediaReferences.forEach { media -&gt;
</a><a href="#h16-0-307" id="h16-0-307" class="d">-                                val protoMediaReference = media.asJsonObject[&quot;mContentObject&quot;].asJsonArray.map { it.asByte }.toByteArray()
</a><a href="#h16-0-308" id="h16-0-308" class="d">-                                val mediaType = MediaReferenceType.valueOf(media.asJsonObject[&quot;mMediaType&quot;].asString)
</a><a href="#h16-0-309" id="h16-0-309" class="d">-                                add(JsonObject().apply {
</a><a href="#h16-0-310" id="h16-0-310" class="d">-                                    addProperty(&quot;mediaType&quot;, mediaType.toString())
</a><a href="#h16-0-311" id="h16-0-311" class="d">-                                    addProperty(&quot;content&quot;, Base64.getUrlEncoder().encodeToString(protoMediaReference))
</a><a href="#h16-0-312" id="h16-0-312" class="d">-                                })
</a><a href="#h16-0-313" id="h16-0-313" class="d">-                            }
</a><a href="#h16-0-314" id="h16-0-314" class="d">-                        })
</a><a href="#h16-0-315" id="h16-0-315" class="d">-
</a><a href="#h16-0-316" id="h16-0-316" class="d">-                    })
</a><a href="#h16-0-317" id="h16-0-317" class="d">-                }
</a><a href="#h16-0-318" id="h16-0-318" class="d">-            })
</a><a href="#h16-0-319" id="h16-0-319" class="d">-        }
</a><a href="#h16-0-320" id="h16-0-320" class="d">-
</a><a href="#h16-0-321" id="h16-0-321" class="d">-        output.write(context.gson.toJson(rootObject).toByteArray())
</a><a href="#h16-0-322" id="h16-0-322" class="d">-        output.flush()
</a><a href="#h16-0-323" id="h16-0-323" class="d">-    }
</a><a href="#h16-0-324" id="h16-0-324" class="d">-
</a><a href="#h16-0-325" id="h16-0-325" class="d">-    suspend fun exportTo(exportFormat: ExportFormat) {
</a><a href="#h16-0-326" id="h16-0-326" class="d">-        val output = FileOutputStream(outputFile)
</a><a href="#h16-0-327" id="h16-0-327" class="d">-
</a><a href="#h16-0-328" id="h16-0-328" class="d">-        when (exportFormat) {
</a><a href="#h16-0-329" id="h16-0-329" class="d">-            ExportFormat.HTML -&gt; exportHtml(output)
</a><a href="#h16-0-330" id="h16-0-330" class="d">-            ExportFormat.JSON -&gt; exportJson(output)
</a><a href="#h16-0-331" id="h16-0-331" class="d">-            ExportFormat.TEXT -&gt; exportText(output)
</a><a href="#h16-0-332" id="h16-0-332" class="d">-        }
</a><a href="#h16-0-333" id="h16-0-333" class="d">-
</a><a href="#h16-0-334" id="h16-0-334" class="d">-        output.close()
</a><a href="#h16-0-335" id="h16-0-335" class="d">-    }
</a><a href="#h16-0-336" id="h16-0-336" class="d">-}</a><a href="#h16-0-337" id="h16-0-337" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h17" href="../file/build.gradle.kts.html">build.gradle.kts</a> b/<a href="../file/build.gradle.kts.html">build.gradle.kts</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -5,4 +5,7 @@ plugins {
</a>     alias(libs.plugins.kotlinAndroid) apply false
 }
 
<a href="#h17-0-3" id="h17-0-3" class="i">+rootProject.ext.set(&quot;appVersionName&quot;, &quot;1.1.0&quot;)
</a><a href="#h17-0-4" id="h17-0-4" class="i">+rootProject.ext.set(&quot;appVersionCode&quot;, 7)
</a><a href="#h17-0-5" id="h17-0-5" class="i">+
</a> true // Needed to make the Suppress annotation work for the plugins block 
\ No newline at end of file
<b>diff --git a/<a id="h18" href="../file/core/.gitignore.html">core/.gitignore</a> b/<a href="../file/core/.gitignore.html">core/.gitignore</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -0,0 +1,16 @@
</a><a href="#h18-0-0" id="h18-0-0" class="i">+*.iml
</a><a href="#h18-0-1" id="h18-0-1" class="i">+.gradle
</a><a href="#h18-0-2" id="h18-0-2" class="i">+/local.properties
</a><a href="#h18-0-3" id="h18-0-3" class="i">+/.idea/caches
</a><a href="#h18-0-4" id="h18-0-4" class="i">+/.idea/libraries
</a><a href="#h18-0-5" id="h18-0-5" class="i">+/.idea/modules.xml
</a><a href="#h18-0-6" id="h18-0-6" class="i">+/.idea/workspace.xml
</a><a href="#h18-0-7" id="h18-0-7" class="i">+/.idea/navEditor.xml
</a><a href="#h18-0-8" id="h18-0-8" class="i">+/.idea/assetWizardSettings.xml
</a><a href="#h18-0-9" id="h18-0-9" class="i">+/.idea/
</a><a href="#h18-0-10" id="h18-0-10" class="i">+.DS_Store
</a><a href="#h18-0-11" id="h18-0-11" class="i">+/build
</a><a href="#h18-0-12" id="h18-0-12" class="i">+/captures
</a><a href="#h18-0-13" id="h18-0-13" class="i">+.externalNativeBuild
</a><a href="#h18-0-14" id="h18-0-14" class="i">+.cxx
</a><a href="#h18-0-15" id="h18-0-15" class="i">+local.properties
</a><b>diff --git a/<a id="h19" href="../file/core/build.gradle.kts.html">core/build.gradle.kts</a> b/<a href="../file/core/build.gradle.kts.html">core/build.gradle.kts</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -0,0 +1,44 @@
</a><a href="#h19-0-0" id="h19-0-0" class="i">+@Suppress(&quot;DSL_SCOPE_VIOLATION&quot;) // TODO: Remove once KTIJ-19369 is fixed
</a><a href="#h19-0-1" id="h19-0-1" class="i">+plugins {
</a><a href="#h19-0-2" id="h19-0-2" class="i">+    id(&quot;com.android.library&quot;)
</a><a href="#h19-0-3" id="h19-0-3" class="i">+    alias(libs.plugins.kotlinAndroid)
</a><a href="#h19-0-4" id="h19-0-4" class="i">+}
</a><a href="#h19-0-5" id="h19-0-5" class="i">+android {
</a><a href="#h19-0-6" id="h19-0-6" class="i">+    namespace = &quot;me.rhunk.snapenhance.core&quot;
</a><a href="#h19-0-7" id="h19-0-7" class="i">+    compileSdk = 33
</a><a href="#h19-0-8" id="h19-0-8" class="i">+
</a><a href="#h19-0-9" id="h19-0-9" class="i">+    buildFeatures {
</a><a href="#h19-0-10" id="h19-0-10" class="i">+        aidl = true
</a><a href="#h19-0-11" id="h19-0-11" class="i">+    }
</a><a href="#h19-0-12" id="h19-0-12" class="i">+
</a><a href="#h19-0-13" id="h19-0-13" class="i">+    defaultConfig {
</a><a href="#h19-0-14" id="h19-0-14" class="i">+        minSdk = 28
</a><a href="#h19-0-15" id="h19-0-15" class="i">+        buildConfigField(&quot;String&quot;, &quot;VERSION_NAME&quot;, &quot;\&quot;${rootProject.ext[&quot;appVersionName&quot;]}\&quot;&quot;)
</a><a href="#h19-0-16" id="h19-0-16" class="i">+        buildConfigField(&quot;int&quot;, &quot;VERSION_CODE&quot;, &quot;${rootProject.ext[&quot;appVersionCode&quot;]}&quot;)
</a><a href="#h19-0-17" id="h19-0-17" class="i">+    }
</a><a href="#h19-0-18" id="h19-0-18" class="i">+
</a><a href="#h19-0-19" id="h19-0-19" class="i">+    kotlinOptions {
</a><a href="#h19-0-20" id="h19-0-20" class="i">+        jvmTarget = &quot;1.8&quot;
</a><a href="#h19-0-21" id="h19-0-21" class="i">+    }
</a><a href="#h19-0-22" id="h19-0-22" class="i">+}
</a><a href="#h19-0-23" id="h19-0-23" class="i">+
</a><a href="#h19-0-24" id="h19-0-24" class="i">+tasks.register(&quot;getVersion&quot;) {
</a><a href="#h19-0-25" id="h19-0-25" class="i">+    doLast {
</a><a href="#h19-0-26" id="h19-0-26" class="i">+        val versionFile = File(&quot;app/build/version.txt&quot;)
</a><a href="#h19-0-27" id="h19-0-27" class="i">+        versionFile.writeText(android.defaultConfig.versionName.toString())
</a><a href="#h19-0-28" id="h19-0-28" class="i">+    }
</a><a href="#h19-0-29" id="h19-0-29" class="i">+}
</a><a href="#h19-0-30" id="h19-0-30" class="i">+
</a><a href="#h19-0-31" id="h19-0-31" class="i">+dependencies {
</a><a href="#h19-0-32" id="h19-0-32" class="i">+    compileOnly(files(&quot;libs/LSPosed-api-1.0-SNAPSHOT.jar&quot;))
</a><a href="#h19-0-33" id="h19-0-33" class="i">+    implementation(libs.coroutines)
</a><a href="#h19-0-34" id="h19-0-34" class="i">+    implementation(libs.kotlin.reflect)
</a><a href="#h19-0-35" id="h19-0-35" class="i">+    implementation(libs.recyclerview)
</a><a href="#h19-0-36" id="h19-0-36" class="i">+    implementation(libs.gson)
</a><a href="#h19-0-37" id="h19-0-37" class="i">+    implementation(libs.ffmpeg.kit)
</a><a href="#h19-0-38" id="h19-0-38" class="i">+    implementation(libs.osmdroid.android)
</a><a href="#h19-0-39" id="h19-0-39" class="i">+    implementation(libs.okhttp)
</a><a href="#h19-0-40" id="h19-0-40" class="i">+    implementation(libs.androidx.documentfile)
</a><a href="#h19-0-41" id="h19-0-41" class="i">+
</a><a href="#h19-0-42" id="h19-0-42" class="i">+    implementation(project(&quot;:mapper&quot;))
</a><a href="#h19-0-43" id="h19-0-43" class="i">+}</a><a href="#h19-0-44" id="h19-0-44" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/app/libs/LSPosed-api-1.0-SNAPSHOT-javadoc.jar.html">app/libs/LSPosed-api-1.0-SNAPSHOT-javadoc.jar</a> b/<a href="../file/core/libs/LSPosed-api-1.0-SNAPSHOT-javadoc.jar.html">core/libs/LSPosed-api-1.0-SNAPSHOT-javadoc.jar</a></b>
Binary files differ.
<b>diff --git a/<a id="h21" href="../file/app/libs/LSPosed-api-1.0-SNAPSHOT-sources.jar.html">app/libs/LSPosed-api-1.0-SNAPSHOT-sources.jar</a> b/<a href="../file/core/libs/LSPosed-api-1.0-SNAPSHOT-sources.jar.html">core/libs/LSPosed-api-1.0-SNAPSHOT-sources.jar</a></b>
Binary files differ.
<b>diff --git a/<a id="h22" href="../file/app/libs/LSPosed-api-1.0-SNAPSHOT.jar.html">app/libs/LSPosed-api-1.0-SNAPSHOT.jar</a> b/<a href="../file/core/libs/LSPosed-api-1.0-SNAPSHOT.jar.html">core/libs/LSPosed-api-1.0-SNAPSHOT.jar</a></b>
Binary files differ.
<b>diff --git a/<a id="h23" href="../file/app/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">app/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a> b/<a href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></b>
<b>diff --git a/<a id="h24" href="../file/app/src/main/aidl/me/rhunk/snapenhance/bridge/DownloadCallback.aidl.html">app/src/main/aidl/me/rhunk/snapenhance/bridge/DownloadCallback.aidl</a> b/<a href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/DownloadCallback.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/DownloadCallback.aidl</a></b>
<b>diff --git a/<a id="h25" href="../file/app/src/main/assets/lang/ar_SA.json.html">app/src/main/assets/lang/ar_SA.json</a> b/<a href="../file/core/src/main/assets/lang/ar_SA.json.html">core/src/main/assets/lang/ar_SA.json</a></b>
<b>diff --git a/<a id="h26" href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a> b/<a href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a></b>
<b>diff --git a/<a id="h27" href="../file/app/src/main/assets/lang/fr_FR.json.html">app/src/main/assets/lang/fr_FR.json</a> b/<a href="../file/core/src/main/assets/lang/fr_FR.json.html">core/src/main/assets/lang/fr_FR.json</a></b>
<b>diff --git a/<a id="h28" href="../file/app/src/main/assets/lang/hi_IN.json.html">app/src/main/assets/lang/hi_IN.json</a> b/<a href="../file/core/src/main/assets/lang/hi_IN.json.html">core/src/main/assets/lang/hi_IN.json</a></b>
<b>diff --git a/<a id="h29" href="../file/app/src/main/assets/web/export_template.html.html">app/src/main/assets/web/export_template.html</a> b/<a href="../file/core/src/main/assets/web/export_template.html.html">core/src/main/assets/web/export_template.html</a></b>
<b>diff --git a/<a id="h30" href="../file/app/src/main/assets/web/rawinflate.js.html">app/src/main/assets/web/rawinflate.js</a> b/<a href="../file/core/src/main/assets/web/rawinflate.js.html">core/src/main/assets/web/rawinflate.js</a></b>
<b>diff --git a/<a id="h31" href="../file/app/src/main/assets/xposed_init.html">app/src/main/assets/xposed_init</a> b/<a href="../file/core/src/main/assets/xposed_init.html">core/src/main/assets/xposed_init</a></b>
<b>diff --git a/<a id="h32" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/Constants.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/Constants.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/Constants.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/Constants.kt</a></b>
<b>diff --git a/<a id="h33" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/Logger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/Logger.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/Logger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/Logger.kt</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -0,0 +1,43 @@
</a><a href="#h33-0-0" id="h33-0-0" class="i">+package me.rhunk.snapenhance
</a><a href="#h33-0-1" id="h33-0-1" class="i">+
</a><a href="#h33-0-2" id="h33-0-2" class="i">+import android.util.Log
</a><a href="#h33-0-3" id="h33-0-3" class="i">+import de.robv.android.xposed.XposedBridge
</a><a href="#h33-0-4" id="h33-0-4" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h33-0-5" id="h33-0-5" class="i">+
</a><a href="#h33-0-6" id="h33-0-6" class="i">+object Logger {
</a><a href="#h33-0-7" id="h33-0-7" class="i">+    private const val TAG = &quot;SnapEnhance&quot;
</a><a href="#h33-0-8" id="h33-0-8" class="i">+
</a><a href="#h33-0-9" id="h33-0-9" class="i">+    fun log(message: Any?) {
</a><a href="#h33-0-10" id="h33-0-10" class="i">+        Log.i(TAG, message.toString())
</a><a href="#h33-0-11" id="h33-0-11" class="i">+    }
</a><a href="#h33-0-12" id="h33-0-12" class="i">+
</a><a href="#h33-0-13" id="h33-0-13" class="i">+    fun debug(message: Any?) {
</a><a href="#h33-0-14" id="h33-0-14" class="i">+        if (!BuildConfig.DEBUG) return
</a><a href="#h33-0-15" id="h33-0-15" class="i">+        Log.d(TAG, message.toString())
</a><a href="#h33-0-16" id="h33-0-16" class="i">+    }
</a><a href="#h33-0-17" id="h33-0-17" class="i">+
</a><a href="#h33-0-18" id="h33-0-18" class="i">+    fun error(throwable: Throwable) {
</a><a href="#h33-0-19" id="h33-0-19" class="i">+        Log.e(TAG, &quot;&quot;, throwable)
</a><a href="#h33-0-20" id="h33-0-20" class="i">+    }
</a><a href="#h33-0-21" id="h33-0-21" class="i">+
</a><a href="#h33-0-22" id="h33-0-22" class="i">+    fun error(message: Any?) {
</a><a href="#h33-0-23" id="h33-0-23" class="i">+        Log.e(TAG, message.toString())
</a><a href="#h33-0-24" id="h33-0-24" class="i">+    }
</a><a href="#h33-0-25" id="h33-0-25" class="i">+
</a><a href="#h33-0-26" id="h33-0-26" class="i">+    fun error(message: Any?, throwable: Throwable) {
</a><a href="#h33-0-27" id="h33-0-27" class="i">+        Log.e(TAG, message.toString(), throwable)
</a><a href="#h33-0-28" id="h33-0-28" class="i">+    }
</a><a href="#h33-0-29" id="h33-0-29" class="i">+
</a><a href="#h33-0-30" id="h33-0-30" class="i">+    fun xposedLog(message: Any?) {
</a><a href="#h33-0-31" id="h33-0-31" class="i">+        XposedBridge.log(message.toString())
</a><a href="#h33-0-32" id="h33-0-32" class="i">+    }
</a><a href="#h33-0-33" id="h33-0-33" class="i">+
</a><a href="#h33-0-34" id="h33-0-34" class="i">+    fun xposedLog(message: Any?, throwable: Throwable?) {
</a><a href="#h33-0-35" id="h33-0-35" class="i">+        XposedBridge.log(message.toString())
</a><a href="#h33-0-36" id="h33-0-36" class="i">+        XposedBridge.log(throwable)
</a><a href="#h33-0-37" id="h33-0-37" class="i">+    }
</a><a href="#h33-0-38" id="h33-0-38" class="i">+
</a><a href="#h33-0-39" id="h33-0-39" class="i">+    fun xposedLog(throwable: Throwable) {
</a><a href="#h33-0-40" id="h33-0-40" class="i">+        XposedBridge.log(throwable)
</a><a href="#h33-0-41" id="h33-0-41" class="i">+    }
</a><a href="#h33-0-42" id="h33-0-42" class="i">+}</a><a href="#h33-0-43" id="h33-0-43" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h34" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ModContext.kt</a></b>
<b>diff --git a/<a id="h35" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt</a></b>
<b>diff --git a/<a id="h36" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -0,0 +1,122 @@
</a><a href="#h36-0-0" id="h36-0-0" class="i">+package me.rhunk.snapenhance
</a><a href="#h36-0-1" id="h36-0-1" class="i">+
</a><a href="#h36-0-2" id="h36-0-2" class="i">+import android.app.Activity
</a><a href="#h36-0-3" id="h36-0-3" class="i">+import android.app.Application
</a><a href="#h36-0-4" id="h36-0-4" class="i">+import android.content.Context
</a><a href="#h36-0-5" id="h36-0-5" class="i">+import android.content.pm.PackageManager
</a><a href="#h36-0-6" id="h36-0-6" class="i">+import kotlinx.coroutines.runBlocking
</a><a href="#h36-0-7" id="h36-0-7" class="i">+import kotlinx.coroutines.withContext
</a><a href="#h36-0-8" id="h36-0-8" class="i">+import me.rhunk.snapenhance.bridge.BridgeClient
</a><a href="#h36-0-9" id="h36-0-9" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h36-0-10" id="h36-0-10" class="i">+import me.rhunk.snapenhance.data.SnapClassCache
</a><a href="#h36-0-11" id="h36-0-11" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h36-0-12" id="h36-0-12" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h36-0-13" id="h36-0-13" class="i">+import me.rhunk.snapenhance.hook.hook
</a><a href="#h36-0-14" id="h36-0-14" class="i">+import me.rhunk.snapenhance.util.getApplicationInfoCompat
</a><a href="#h36-0-15" id="h36-0-15" class="i">+import kotlin.time.ExperimentalTime
</a><a href="#h36-0-16" id="h36-0-16" class="i">+import kotlin.time.measureTime
</a><a href="#h36-0-17" id="h36-0-17" class="i">+
</a><a href="#h36-0-18" id="h36-0-18" class="i">+class SnapEnhance {
</a><a href="#h36-0-19" id="h36-0-19" class="i">+    companion object {
</a><a href="#h36-0-20" id="h36-0-20" class="i">+        lateinit var classLoader: ClassLoader
</a><a href="#h36-0-21" id="h36-0-21" class="i">+        val classCache: SnapClassCache by lazy {
</a><a href="#h36-0-22" id="h36-0-22" class="i">+            SnapClassCache(classLoader)
</a><a href="#h36-0-23" id="h36-0-23" class="i">+        }
</a><a href="#h36-0-24" id="h36-0-24" class="i">+    }
</a><a href="#h36-0-25" id="h36-0-25" class="i">+    private val appContext = ModContext()
</a><a href="#h36-0-26" id="h36-0-26" class="i">+    private var isBridgeInitialized = false
</a><a href="#h36-0-27" id="h36-0-27" class="i">+
</a><a href="#h36-0-28" id="h36-0-28" class="i">+    init {
</a><a href="#h36-0-29" id="h36-0-29" class="i">+        Hooker.hook(Application::class.java, &quot;attach&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h36-0-30" id="h36-0-30" class="i">+            appContext.androidContext = param.arg&lt;Context&gt;(0).also {
</a><a href="#h36-0-31" id="h36-0-31" class="i">+                classLoader = it.classLoader
</a><a href="#h36-0-32" id="h36-0-32" class="i">+            }
</a><a href="#h36-0-33" id="h36-0-33" class="i">+            appContext.bridgeClient = BridgeClient(appContext)
</a><a href="#h36-0-34" id="h36-0-34" class="i">+
</a><a href="#h36-0-35" id="h36-0-35" class="i">+            //for lspatch builds, we need to check if the service is correctly installed
</a><a href="#h36-0-36" id="h36-0-36" class="i">+            runCatching {
</a><a href="#h36-0-37" id="h36-0-37" class="i">+                appContext.androidContext.packageManager.getApplicationInfoCompat(BuildConfig.LIBRARY_PACKAGE_NAME, PackageManager.GET_META_DATA)
</a><a href="#h36-0-38" id="h36-0-38" class="i">+            }.onFailure {
</a><a href="#h36-0-39" id="h36-0-39" class="i">+                appContext.crash(&quot;SnapEnhance bridge service is not installed. Please download stable version from https://github.com/rhunk/SnapEnhance/releases&quot;)
</a><a href="#h36-0-40" id="h36-0-40" class="i">+                return@hook
</a><a href="#h36-0-41" id="h36-0-41" class="i">+            }
</a><a href="#h36-0-42" id="h36-0-42" class="i">+
</a><a href="#h36-0-43" id="h36-0-43" class="i">+            appContext.bridgeClient.apply {
</a><a href="#h36-0-44" id="h36-0-44" class="i">+                start { bridgeResult -&gt;
</a><a href="#h36-0-45" id="h36-0-45" class="i">+                    if (!bridgeResult) {
</a><a href="#h36-0-46" id="h36-0-46" class="i">+                        Logger.xposedLog(&quot;Cannot connect to bridge service&quot;)
</a><a href="#h36-0-47" id="h36-0-47" class="i">+                        appContext.softRestartApp()
</a><a href="#h36-0-48" id="h36-0-48" class="i">+                        return@start
</a><a href="#h36-0-49" id="h36-0-49" class="i">+                    }
</a><a href="#h36-0-50" id="h36-0-50" class="i">+                    runCatching {
</a><a href="#h36-0-51" id="h36-0-51" class="i">+                        runBlocking {
</a><a href="#h36-0-52" id="h36-0-52" class="i">+                            init()
</a><a href="#h36-0-53" id="h36-0-53" class="i">+                        }
</a><a href="#h36-0-54" id="h36-0-54" class="i">+                    }.onSuccess {
</a><a href="#h36-0-55" id="h36-0-55" class="i">+                        isBridgeInitialized = true
</a><a href="#h36-0-56" id="h36-0-56" class="i">+                    }.onFailure {
</a><a href="#h36-0-57" id="h36-0-57" class="i">+                        Logger.xposedLog(&quot;Failed to initialize&quot;, it)
</a><a href="#h36-0-58" id="h36-0-58" class="i">+                    }
</a><a href="#h36-0-59" id="h36-0-59" class="i">+                }
</a><a href="#h36-0-60" id="h36-0-60" class="i">+            }
</a><a href="#h36-0-61" id="h36-0-61" class="i">+        }
</a><a href="#h36-0-62" id="h36-0-62" class="i">+
</a><a href="#h36-0-63" id="h36-0-63" class="i">+        Activity::class.java.hook( &quot;onCreate&quot;,  HookStage.AFTER, { isBridgeInitialized }) {
</a><a href="#h36-0-64" id="h36-0-64" class="i">+            val activity = it.thisObject() as Activity
</a><a href="#h36-0-65" id="h36-0-65" class="i">+            if (!activity.packageName.equals(Constants.SNAPCHAT_PACKAGE_NAME)) return@hook
</a><a href="#h36-0-66" id="h36-0-66" class="i">+            val isMainActivityNotNull = appContext.mainActivity != null
</a><a href="#h36-0-67" id="h36-0-67" class="i">+            appContext.mainActivity = activity
</a><a href="#h36-0-68" id="h36-0-68" class="i">+            if (isMainActivityNotNull || !appContext.mappings.areMappingsLoaded) return@hook
</a><a href="#h36-0-69" id="h36-0-69" class="i">+            onActivityCreate()
</a><a href="#h36-0-70" id="h36-0-70" class="i">+        }
</a><a href="#h36-0-71" id="h36-0-71" class="i">+
</a><a href="#h36-0-72" id="h36-0-72" class="i">+        var activityWasResumed = false
</a><a href="#h36-0-73" id="h36-0-73" class="i">+
</a><a href="#h36-0-74" id="h36-0-74" class="i">+        //we need to reload the config when the app is resumed
</a><a href="#h36-0-75" id="h36-0-75" class="i">+        Activity::class.java.hook(&quot;onResume&quot;, HookStage.AFTER, { isBridgeInitialized }) {
</a><a href="#h36-0-76" id="h36-0-76" class="i">+            val activity = it.thisObject() as Activity
</a><a href="#h36-0-77" id="h36-0-77" class="i">+
</a><a href="#h36-0-78" id="h36-0-78" class="i">+            if (!activity.packageName.equals(Constants.SNAPCHAT_PACKAGE_NAME)) return@hook
</a><a href="#h36-0-79" id="h36-0-79" class="i">+
</a><a href="#h36-0-80" id="h36-0-80" class="i">+            if (!activityWasResumed) {
</a><a href="#h36-0-81" id="h36-0-81" class="i">+                activityWasResumed = true
</a><a href="#h36-0-82" id="h36-0-82" class="i">+                return@hook
</a><a href="#h36-0-83" id="h36-0-83" class="i">+            }
</a><a href="#h36-0-84" id="h36-0-84" class="i">+
</a><a href="#h36-0-85" id="h36-0-85" class="i">+            Logger.debug(&quot;Reloading config&quot;)
</a><a href="#h36-0-86" id="h36-0-86" class="i">+            appContext.config.loadFromBridge(appContext.bridgeClient)
</a><a href="#h36-0-87" id="h36-0-87" class="i">+        }
</a><a href="#h36-0-88" id="h36-0-88" class="i">+    }
</a><a href="#h36-0-89" id="h36-0-89" class="i">+
</a><a href="#h36-0-90" id="h36-0-90" class="i">+    @OptIn(ExperimentalTime::class)
</a><a href="#h36-0-91" id="h36-0-91" class="i">+    private suspend fun init() {
</a><a href="#h36-0-92" id="h36-0-92" class="i">+        //load translations in a coroutine to speed up initialization
</a><a href="#h36-0-93" id="h36-0-93" class="i">+        withContext(appContext.coroutineDispatcher) {
</a><a href="#h36-0-94" id="h36-0-94" class="i">+            appContext.translation.loadFromBridge(appContext.bridgeClient)
</a><a href="#h36-0-95" id="h36-0-95" class="i">+        }
</a><a href="#h36-0-96" id="h36-0-96" class="i">+
</a><a href="#h36-0-97" id="h36-0-97" class="i">+        measureTime {
</a><a href="#h36-0-98" id="h36-0-98" class="i">+            with(appContext) {
</a><a href="#h36-0-99" id="h36-0-99" class="i">+                config.loadFromBridge(bridgeClient)
</a><a href="#h36-0-100" id="h36-0-100" class="i">+                mappings.init()
</a><a href="#h36-0-101" id="h36-0-101" class="i">+                //if mappings aren&#39;t loaded, we can&#39;t initialize features
</a><a href="#h36-0-102" id="h36-0-102" class="i">+                if (!mappings.areMappingsLoaded) return
</a><a href="#h36-0-103" id="h36-0-103" class="i">+                features.init()
</a><a href="#h36-0-104" id="h36-0-104" class="i">+            }
</a><a href="#h36-0-105" id="h36-0-105" class="i">+        }.also { time -&gt;
</a><a href="#h36-0-106" id="h36-0-106" class="i">+            Logger.debug(&quot;init took $time&quot;)
</a><a href="#h36-0-107" id="h36-0-107" class="i">+        }
</a><a href="#h36-0-108" id="h36-0-108" class="i">+    }
</a><a href="#h36-0-109" id="h36-0-109" class="i">+
</a><a href="#h36-0-110" id="h36-0-110" class="i">+    @OptIn(ExperimentalTime::class)
</a><a href="#h36-0-111" id="h36-0-111" class="i">+    private fun onActivityCreate() {
</a><a href="#h36-0-112" id="h36-0-112" class="i">+        measureTime {
</a><a href="#h36-0-113" id="h36-0-113" class="i">+            with(appContext) {
</a><a href="#h36-0-114" id="h36-0-114" class="i">+                features.onActivityCreate()
</a><a href="#h36-0-115" id="h36-0-115" class="i">+                actionManager.init()
</a><a href="#h36-0-116" id="h36-0-116" class="i">+            }
</a><a href="#h36-0-117" id="h36-0-117" class="i">+        }.also { time -&gt;
</a><a href="#h36-0-118" id="h36-0-118" class="i">+            Logger.debug(&quot;onActivityCreate took $time&quot;)
</a><a href="#h36-0-119" id="h36-0-119" class="i">+        }
</a><a href="#h36-0-120" id="h36-0-120" class="i">+    }
</a><a href="#h36-0-121" id="h36-0-121" class="i">+}</a><a href="#h36-0-122" id="h36-0-122" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h37" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/XposedLoader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/XposedLoader.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/XposedLoader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/XposedLoader.kt</a></b>
<b>diff --git a/<a id="h38" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/AbstractAction.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/AbstractAction.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/AbstractAction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/AbstractAction.kt</a></b>
<b>diff --git a/<a id="h39" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/CheckForUpdates.kt</a></b>
<b>diff --git a/<a id="h40" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CleanCache.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/CleanCache.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/CleanCache.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/CleanCache.kt</a></b>
<b>diff --git a/<a id="h41" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/ClearMessageLogger.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/ClearMessageLogger.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ClearMessageLogger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ClearMessageLogger.kt</a></b>
<b>diff --git a/<a id="h42" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt</a></b>
<b>diff --git a/<a id="h43" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/OpenMap.kt</a></b>
<a href="#h43-0" id="h43-0" class="h">@@ -0,0 +1,23 @@
</a><a href="#h43-0-0" id="h43-0-0" class="i">+package me.rhunk.snapenhance.action.impl
</a><a href="#h43-0-1" id="h43-0-1" class="i">+
</a><a href="#h43-0-2" id="h43-0-2" class="i">+import android.content.Intent
</a><a href="#h43-0-3" id="h43-0-3" class="i">+import android.os.Bundle
</a><a href="#h43-0-4" id="h43-0-4" class="i">+import me.rhunk.snapenhance.action.AbstractAction
</a><a href="#h43-0-5" id="h43-0-5" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h43-0-6" id="h43-0-6" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h43-0-7" id="h43-0-7" class="i">+import me.rhunk.snapenhance.ui.map.MapActivity
</a><a href="#h43-0-8" id="h43-0-8" class="i">+
</a><a href="#h43-0-9" id="h43-0-9" class="i">+class OpenMap: AbstractAction(&quot;action.open_map&quot;, dependsOnProperty = ConfigProperty.LOCATION_SPOOF) {
</a><a href="#h43-0-10" id="h43-0-10" class="i">+    override fun run() {
</a><a href="#h43-0-11" id="h43-0-11" class="i">+        context.runOnUiThread {
</a><a href="#h43-0-12" id="h43-0-12" class="i">+            val mapActivityIntent = Intent()
</a><a href="#h43-0-13" id="h43-0-13" class="i">+            mapActivityIntent.setClassName(BuildConfig.LIBRARY_PACKAGE_NAME, MapActivity::class.java.name)
</a><a href="#h43-0-14" id="h43-0-14" class="i">+            mapActivityIntent.putExtra(&quot;location&quot;, Bundle().apply {
</a><a href="#h43-0-15" id="h43-0-15" class="i">+                putDouble(&quot;latitude&quot;, context.config.string(ConfigProperty.LATITUDE).toDouble())
</a><a href="#h43-0-16" id="h43-0-16" class="i">+                putDouble(&quot;longitude&quot;, context.config.string(ConfigProperty.LONGITUDE).toDouble())
</a><a href="#h43-0-17" id="h43-0-17" class="i">+            })
</a><a href="#h43-0-18" id="h43-0-18" class="i">+
</a><a href="#h43-0-19" id="h43-0-19" class="i">+            context.mainActivity!!.startActivityForResult(mapActivityIntent, 0x1337)
</a><a href="#h43-0-20" id="h43-0-20" class="i">+        }
</a><a href="#h43-0-21" id="h43-0-21" class="i">+    }
</a><a href="#h43-0-22" id="h43-0-22" class="i">+}</a><a href="#h43-0-23" id="h43-0-23" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h44" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/action/impl/RefreshMappings.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/action/impl/RefreshMappings.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/RefreshMappings.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/RefreshMappings.kt</a></b>
<b>diff --git a/<a id="h45" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></b>
<a href="#h45-0" id="h45-0" class="h">@@ -0,0 +1,126 @@
</a><a href="#h45-0-0" id="h45-0-0" class="i">+package me.rhunk.snapenhance.bridge
</a><a href="#h45-0-1" id="h45-0-1" class="i">+
</a><a href="#h45-0-2" id="h45-0-2" class="i">+
</a><a href="#h45-0-3" id="h45-0-3" class="i">+import android.content.ComponentName
</a><a href="#h45-0-4" id="h45-0-4" class="i">+import android.content.Context
</a><a href="#h45-0-5" id="h45-0-5" class="i">+import android.content.Intent
</a><a href="#h45-0-6" id="h45-0-6" class="i">+import android.content.ServiceConnection
</a><a href="#h45-0-7" id="h45-0-7" class="i">+import android.os.Build
</a><a href="#h45-0-8" id="h45-0-8" class="i">+import android.os.Handler
</a><a href="#h45-0-9" id="h45-0-9" class="i">+import android.os.HandlerThread
</a><a href="#h45-0-10" id="h45-0-10" class="i">+import android.os.IBinder
</a><a href="#h45-0-11" id="h45-0-11" class="i">+import de.robv.android.xposed.XposedHelpers
</a><a href="#h45-0-12" id="h45-0-12" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h45-0-13" id="h45-0-13" class="i">+import me.rhunk.snapenhance.Logger.xposedLog
</a><a href="#h45-0-14" id="h45-0-14" class="i">+import me.rhunk.snapenhance.ModContext
</a><a href="#h45-0-15" id="h45-0-15" class="i">+import me.rhunk.snapenhance.bridge.types.BridgeFileType
</a><a href="#h45-0-16" id="h45-0-16" class="i">+import me.rhunk.snapenhance.data.LocalePair
</a><a href="#h45-0-17" id="h45-0-17" class="i">+import java.util.concurrent.CompletableFuture
</a><a href="#h45-0-18" id="h45-0-18" class="i">+import java.util.concurrent.Executors
</a><a href="#h45-0-19" id="h45-0-19" class="i">+import kotlin.system.exitProcess
</a><a href="#h45-0-20" id="h45-0-20" class="i">+
</a><a href="#h45-0-21" id="h45-0-21" class="i">+
</a><a href="#h45-0-22" id="h45-0-22" class="i">+class BridgeClient(
</a><a href="#h45-0-23" id="h45-0-23" class="i">+    private val context: ModContext
</a><a href="#h45-0-24" id="h45-0-24" class="i">+):  ServiceConnection {
</a><a href="#h45-0-25" id="h45-0-25" class="i">+    private lateinit var future: CompletableFuture&lt;Boolean&gt;
</a><a href="#h45-0-26" id="h45-0-26" class="i">+    private lateinit var service: BridgeInterface
</a><a href="#h45-0-27" id="h45-0-27" class="i">+
</a><a href="#h45-0-28" id="h45-0-28" class="i">+    fun start(callback: (Boolean) -&gt; Unit) {
</a><a href="#h45-0-29" id="h45-0-29" class="i">+        this.future = CompletableFuture()
</a><a href="#h45-0-30" id="h45-0-30" class="i">+
</a><a href="#h45-0-31" id="h45-0-31" class="i">+        with(context.androidContext) {
</a><a href="#h45-0-32" id="h45-0-32" class="i">+            //ensure the remote process is running
</a><a href="#h45-0-33" id="h45-0-33" class="i">+            startActivity(Intent()
</a><a href="#h45-0-34" id="h45-0-34" class="i">+                .setClassName(BuildConfig.LIBRARY_PACKAGE_NAME, ForceStartActivity::class.java.name)
</a><a href="#h45-0-35" id="h45-0-35" class="i">+                .addFlags(Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_MULTIPLE_TASK)
</a><a href="#h45-0-36" id="h45-0-36" class="i">+            )
</a><a href="#h45-0-37" id="h45-0-37" class="i">+
</a><a href="#h45-0-38" id="h45-0-38" class="i">+            val intent = Intent()
</a><a href="#h45-0-39" id="h45-0-39" class="i">+                .setClassName(BuildConfig.LIBRARY_PACKAGE_NAME, BridgeService::class.java.name)
</a><a href="#h45-0-40" id="h45-0-40" class="i">+            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) {
</a><a href="#h45-0-41" id="h45-0-41" class="i">+                bindService(
</a><a href="#h45-0-42" id="h45-0-42" class="i">+                    intent,
</a><a href="#h45-0-43" id="h45-0-43" class="i">+                    Context.BIND_AUTO_CREATE,
</a><a href="#h45-0-44" id="h45-0-44" class="i">+                    Executors.newSingleThreadExecutor(),
</a><a href="#h45-0-45" id="h45-0-45" class="i">+                    this@BridgeClient
</a><a href="#h45-0-46" id="h45-0-46" class="i">+                )
</a><a href="#h45-0-47" id="h45-0-47" class="i">+            } else {
</a><a href="#h45-0-48" id="h45-0-48" class="i">+                XposedHelpers.callMethod(
</a><a href="#h45-0-49" id="h45-0-49" class="i">+                    this,
</a><a href="#h45-0-50" id="h45-0-50" class="i">+                    &quot;bindServiceAsUser&quot;,
</a><a href="#h45-0-51" id="h45-0-51" class="i">+                    intent,
</a><a href="#h45-0-52" id="h45-0-52" class="i">+                    this@BridgeClient,
</a><a href="#h45-0-53" id="h45-0-53" class="i">+                    Context.BIND_AUTO_CREATE,
</a><a href="#h45-0-54" id="h45-0-54" class="i">+                    Handler(HandlerThread(&quot;BridgeClient&quot;).apply {
</a><a href="#h45-0-55" id="h45-0-55" class="i">+                        start()
</a><a href="#h45-0-56" id="h45-0-56" class="i">+                    }.looper),
</a><a href="#h45-0-57" id="h45-0-57" class="i">+                    android.os.Process.myUserHandle()
</a><a href="#h45-0-58" id="h45-0-58" class="i">+                )
</a><a href="#h45-0-59" id="h45-0-59" class="i">+            }
</a><a href="#h45-0-60" id="h45-0-60" class="i">+        }
</a><a href="#h45-0-61" id="h45-0-61" class="i">+        callback(future.get())
</a><a href="#h45-0-62" id="h45-0-62" class="i">+    }
</a><a href="#h45-0-63" id="h45-0-63" class="i">+
</a><a href="#h45-0-64" id="h45-0-64" class="i">+
</a><a href="#h45-0-65" id="h45-0-65" class="i">+    override fun onServiceConnected(name: ComponentName, service: IBinder) {
</a><a href="#h45-0-66" id="h45-0-66" class="i">+        this.service = BridgeInterface.Stub.asInterface(service)
</a><a href="#h45-0-67" id="h45-0-67" class="i">+        future.complete(true)
</a><a href="#h45-0-68" id="h45-0-68" class="i">+    }
</a><a href="#h45-0-69" id="h45-0-69" class="i">+
</a><a href="#h45-0-70" id="h45-0-70" class="i">+    override fun onNullBinding(name: ComponentName) {
</a><a href="#h45-0-71" id="h45-0-71" class="i">+        xposedLog(&quot;failed to connect to bridge service&quot;)
</a><a href="#h45-0-72" id="h45-0-72" class="i">+        future.complete(false)
</a><a href="#h45-0-73" id="h45-0-73" class="i">+    }
</a><a href="#h45-0-74" id="h45-0-74" class="i">+
</a><a href="#h45-0-75" id="h45-0-75" class="i">+    override fun onServiceDisconnected(name: ComponentName) {
</a><a href="#h45-0-76" id="h45-0-76" class="i">+        exitProcess(0)
</a><a href="#h45-0-77" id="h45-0-77" class="i">+    }
</a><a href="#h45-0-78" id="h45-0-78" class="i">+
</a><a href="#h45-0-79" id="h45-0-79" class="i">+    fun createAndReadFile(
</a><a href="#h45-0-80" id="h45-0-80" class="i">+        fileType: BridgeFileType,
</a><a href="#h45-0-81" id="h45-0-81" class="i">+        defaultContent: ByteArray
</a><a href="#h45-0-82" id="h45-0-82" class="i">+    ): ByteArray = service.createAndReadFile(fileType.value, defaultContent)
</a><a href="#h45-0-83" id="h45-0-83" class="i">+
</a><a href="#h45-0-84" id="h45-0-84" class="i">+    fun readFile(fileType: BridgeFileType): ByteArray = service.readFile(fileType.value)
</a><a href="#h45-0-85" id="h45-0-85" class="i">+
</a><a href="#h45-0-86" id="h45-0-86" class="i">+    fun writeFile(
</a><a href="#h45-0-87" id="h45-0-87" class="i">+        fileType: BridgeFileType,
</a><a href="#h45-0-88" id="h45-0-88" class="i">+        content: ByteArray?
</a><a href="#h45-0-89" id="h45-0-89" class="i">+    ): Boolean = service.writeFile(fileType.value, content)
</a><a href="#h45-0-90" id="h45-0-90" class="i">+
</a><a href="#h45-0-91" id="h45-0-91" class="i">+    fun deleteFile(fileType: BridgeFileType) = service.deleteFile(fileType.value)
</a><a href="#h45-0-92" id="h45-0-92" class="i">+
</a><a href="#h45-0-93" id="h45-0-93" class="i">+
</a><a href="#h45-0-94" id="h45-0-94" class="i">+    fun isFileExists(fileType: BridgeFileType) = service.isFileExists(fileType.value)
</a><a href="#h45-0-95" id="h45-0-95" class="i">+
</a><a href="#h45-0-96" id="h45-0-96" class="i">+    fun getLoggedMessageIds(conversationId: String, limit: Int): LongArray = service.getLoggedMessageIds(conversationId, limit)
</a><a href="#h45-0-97" id="h45-0-97" class="i">+
</a><a href="#h45-0-98" id="h45-0-98" class="i">+    fun getMessageLoggerMessage(conversationId: String, id: Long): ByteArray? = service.getMessageLoggerMessage(conversationId, id)
</a><a href="#h45-0-99" id="h45-0-99" class="i">+
</a><a href="#h45-0-100" id="h45-0-100" class="i">+    fun addMessageLoggerMessage(conversationId: String,id: Long, message: ByteArray) = service.addMessageLoggerMessage(conversationId, id, message)
</a><a href="#h45-0-101" id="h45-0-101" class="i">+
</a><a href="#h45-0-102" id="h45-0-102" class="i">+    fun deleteMessageLoggerMessage(conversationId: String, id: Long) = service.deleteMessageLoggerMessage(conversationId, id)
</a><a href="#h45-0-103" id="h45-0-103" class="i">+
</a><a href="#h45-0-104" id="h45-0-104" class="i">+    fun clearMessageLogger() = service.clearMessageLogger()
</a><a href="#h45-0-105" id="h45-0-105" class="i">+
</a><a href="#h45-0-106" id="h45-0-106" class="i">+    fun fetchTranslations() = service.fetchTranslations().map {
</a><a href="#h45-0-107" id="h45-0-107" class="i">+        LocalePair(it.key, it.value)
</a><a href="#h45-0-108" id="h45-0-108" class="i">+    }
</a><a href="#h45-0-109" id="h45-0-109" class="i">+
</a><a href="#h45-0-110" id="h45-0-110" class="i">+    fun getAutoUpdaterTime(): Long {
</a><a href="#h45-0-111" id="h45-0-111" class="i">+        createAndReadFile(BridgeFileType.AUTO_UPDATER_TIMESTAMP, &quot;0&quot;.toByteArray()).run {
</a><a href="#h45-0-112" id="h45-0-112" class="i">+            return if (isEmpty()) {
</a><a href="#h45-0-113" id="h45-0-113" class="i">+                0
</a><a href="#h45-0-114" id="h45-0-114" class="i">+            } else {
</a><a href="#h45-0-115" id="h45-0-115" class="i">+                String(this).toLong()
</a><a href="#h45-0-116" id="h45-0-116" class="i">+            }
</a><a href="#h45-0-117" id="h45-0-117" class="i">+        }
</a><a href="#h45-0-118" id="h45-0-118" class="i">+    }
</a><a href="#h45-0-119" id="h45-0-119" class="i">+
</a><a href="#h45-0-120" id="h45-0-120" class="i">+    fun setAutoUpdaterTime(time: Long) {
</a><a href="#h45-0-121" id="h45-0-121" class="i">+        writeFile(BridgeFileType.AUTO_UPDATER_TIMESTAMP, time.toString().toByteArray())
</a><a href="#h45-0-122" id="h45-0-122" class="i">+    }
</a><a href="#h45-0-123" id="h45-0-123" class="i">+
</a><a href="#h45-0-124" id="h45-0-124" class="i">+    fun enqueueDownload(intent: Intent, callback: DownloadCallback) = service.enqueueDownload(intent, callback)
</a><a href="#h45-0-125" id="h45-0-125" class="i">+}
</a><b>diff --git a/<a id="h46" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></b>
<b>diff --git a/<a id="h47" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/ForceStartActivity.kt</a></b>
<b>diff --git a/<a id="h48" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/types/BridgeFileType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/types/BridgeFileType.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/types/BridgeFileType.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/types/BridgeFileType.kt</a></b>
<b>diff --git a/<a id="h49" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/ConfigWrapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/ConfigWrapper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/ConfigWrapper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/ConfigWrapper.kt</a></b>
<b>diff --git a/<a id="h50" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/MessageLoggerWrapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/MessageLoggerWrapper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/MessageLoggerWrapper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/MessageLoggerWrapper.kt</a></b>
<b>diff --git a/<a id="h51" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/TranslationWrapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/TranslationWrapper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/TranslationWrapper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/wrapper/TranslationWrapper.kt</a></b>
<b>diff --git a/<a id="h52" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigAccessor.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigAccessor.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigAccessor.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigAccessor.kt</a></b>
<b>diff --git a/<a id="h53" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></b>
<b>diff --git a/<a id="h54" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></b>
<b>diff --git a/<a id="h55" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt</a></b>
<b>diff --git a/<a id="h56" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt</a></b>
<b>diff --git a/<a id="h57" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt</a></b>
<b>diff --git a/<a id="h58" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt</a></b>
<b>diff --git a/<a id="h59" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt</a></b>
<b>diff --git a/<a id="h60" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt</a></b>
<b>diff --git a/<a id="h61" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/FileType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/FileType.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/FileType.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/FileType.kt</a></b>
<b>diff --git a/<a id="h62" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/LocalePair.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/LocalePair.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/LocalePair.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/LocalePair.kt</a></b>
<b>diff --git a/<a id="h63" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/MessageSender.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/MessageSender.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/MessageSender.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/MessageSender.kt</a></b>
<b>diff --git a/<a id="h64" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/SnapClassCache.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/SnapClassCache.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/SnapClassCache.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/SnapClassCache.kt</a></b>
<b>diff --git a/<a id="h65" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/SnapEnums.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/SnapEnums.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/SnapEnums.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/SnapEnums.kt</a></b>
<b>diff --git a/<a id="h66" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/AbstractWrapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/AbstractWrapper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/AbstractWrapper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/AbstractWrapper.kt</a></b>
<b>diff --git a/<a id="h67" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/FriendActionButton.kt</a></b>
<b>diff --git a/<a id="h68" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt</a></b>
<b>diff --git a/<a id="h69" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt</a></b>
<b>diff --git a/<a id="h70" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt</a></b>
<b>diff --git a/<a id="h71" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt</a></b>
<b>diff --git a/<a id="h72" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt</a></b>
<b>diff --git a/<a id="h73" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/ScSize.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/ScSize.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/ScSize.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/ScSize.kt</a></b>
<b>diff --git a/<a id="h74" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a></b>
<b>diff --git a/<a id="h75" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt</a></b>
<b>diff --git a/<a id="h76" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/EncryptionWrapper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/EncryptionWrapper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/EncryptionWrapper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/EncryptionWrapper.kt</a></b>
<b>diff --git a/<a id="h77" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt</a></b>
<b>diff --git a/<a id="h78" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/LongformVideoPlaylistItem.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/LongformVideoPlaylistItem.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/LongformVideoPlaylistItem.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/LongformVideoPlaylistItem.kt</a></b>
<b>diff --git a/<a id="h79" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapChapter.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapChapter.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapChapter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapChapter.kt</a></b>
<b>diff --git a/<a id="h80" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapPlaylistItem.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapPlaylistItem.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapPlaylistItem.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/dash/SnapPlaylistItem.kt</a></b>
<b>diff --git a/<a id="h81" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/Layer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/Layer.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/Layer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/Layer.kt</a></b>
<b>diff --git a/<a id="h82" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/LayerController.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/LayerController.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/LayerController.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/LayerController.kt</a></b>
<b>diff --git a/<a id="h83" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt</a></b>
<b>diff --git a/<a id="h84" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt</a></b>
<b>diff --git a/<a id="h85" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseObject.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseObject.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseObject.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseObject.kt</a></b>
<b>diff --git a/<a id="h86" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt</a></b>
<b>diff --git a/<a id="h87" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt</a></b>
<b>diff --git a/<a id="h88" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt</a></b>
<b>diff --git a/<a id="h89" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt</a></b>
<b>diff --git a/<a id="h90" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt</a></b>
<b>diff --git a/<a id="h91" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadManagerClient.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadManagerClient.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadManagerClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadManagerClient.kt</a></b>
<b>diff --git a/<a id="h92" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadProcessor.kt</a></b>
<b>diff --git a/<a id="h93" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt</a></b>
<b>diff --git a/<a id="h94" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadMetadata.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadMetadata.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadMetadata.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadMetadata.kt</a></b>
<b>diff --git a/<a id="h95" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadRequest.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadRequest.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/data/DownloadRequest.kt</a></b>
<b>diff --git a/<a id="h96" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/data/MediaEncryptionKeyPair.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/data/MediaEncryptionKeyPair.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/data/MediaEncryptionKeyPair.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/data/MediaEncryptionKeyPair.kt</a></b>
<b>diff --git a/<a id="h97" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/data/PendingDownload.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/data/PendingDownload.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/data/PendingDownload.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/data/PendingDownload.kt</a></b>
<b>diff --git a/<a id="h98" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/data/SplitMediaAssetType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/data/SplitMediaAssetType.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/data/SplitMediaAssetType.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/data/SplitMediaAssetType.kt</a></b>
<b>diff --git a/<a id="h99" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadMediaType.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadMediaType.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadMediaType.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadMediaType.kt</a></b>
<b>diff --git a/<a id="h100" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadStage.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadStage.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadStage.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/enums/DownloadStage.kt</a></b>
<b>diff --git a/<a id="h101" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/event/EventBus.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/event/EventBus.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/event/EventBus.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/event/EventBus.kt</a></b>
<b>diff --git a/<a id="h102" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/event/Events.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/event/Events.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/event/Events.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/event/Events.kt</a></b>
<b>diff --git a/<a id="h103" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/BridgeFileFeature.kt</a></b>
<b>diff --git a/<a id="h104" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/Feature.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/Feature.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/Feature.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/Feature.kt</a></b>
<b>diff --git a/<a id="h105" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/FeatureLoadParams.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/FeatureLoadParams.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/FeatureLoadParams.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/FeatureLoadParams.kt</a></b>
<b>diff --git a/<a id="h106" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/AutoUpdater.kt</a></b>
<a href="#h106-0" id="h106-0" class="h">@@ -0,0 +1,110 @@
</a><a href="#h106-0-0" id="h106-0-0" class="i">+package me.rhunk.snapenhance.features.impl
</a><a href="#h106-0-1" id="h106-0-1" class="i">+
</a><a href="#h106-0-2" id="h106-0-2" class="i">+import android.annotation.SuppressLint
</a><a href="#h106-0-3" id="h106-0-3" class="i">+import android.app.AlertDialog
</a><a href="#h106-0-4" id="h106-0-4" class="i">+import android.app.DownloadManager
</a><a href="#h106-0-5" id="h106-0-5" class="i">+import android.content.BroadcastReceiver
</a><a href="#h106-0-6" id="h106-0-6" class="i">+import android.content.Context
</a><a href="#h106-0-7" id="h106-0-7" class="i">+import android.content.Intent
</a><a href="#h106-0-8" id="h106-0-8" class="i">+import android.content.IntentFilter
</a><a href="#h106-0-9" id="h106-0-9" class="i">+import android.net.Uri
</a><a href="#h106-0-10" id="h106-0-10" class="i">+import android.os.Environment
</a><a href="#h106-0-11" id="h106-0-11" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h106-0-12" id="h106-0-12" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h106-0-13" id="h106-0-13" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h106-0-14" id="h106-0-14" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h106-0-15" id="h106-0-15" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h106-0-16" id="h106-0-16" class="i">+import me.rhunk.snapenhance.ui.ViewAppearanceHelper
</a><a href="#h106-0-17" id="h106-0-17" class="i">+import okhttp3.OkHttpClient
</a><a href="#h106-0-18" id="h106-0-18" class="i">+import okhttp3.Request
</a><a href="#h106-0-19" id="h106-0-19" class="i">+import org.json.JSONArray
</a><a href="#h106-0-20" id="h106-0-20" class="i">+
</a><a href="#h106-0-21" id="h106-0-21" class="i">+class AutoUpdater : Feature(&quot;AutoUpdater&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h106-0-22" id="h106-0-22" class="i">+    override fun asyncOnActivityCreate() {
</a><a href="#h106-0-23" id="h106-0-23" class="i">+        val checkForUpdateMode = context.config.state(ConfigProperty.AUTO_UPDATER)
</a><a href="#h106-0-24" id="h106-0-24" class="i">+        val currentTimeMillis = System.currentTimeMillis()
</a><a href="#h106-0-25" id="h106-0-25" class="i">+        val checkForUpdatesTimestamp = context.bridgeClient.getAutoUpdaterTime()
</a><a href="#h106-0-26" id="h106-0-26" class="i">+
</a><a href="#h106-0-27" id="h106-0-27" class="i">+        val delayTimestamp = when (checkForUpdateMode) {
</a><a href="#h106-0-28" id="h106-0-28" class="i">+            &quot;EVERY_LAUNCH&quot; -&gt; currentTimeMillis - checkForUpdatesTimestamp
</a><a href="#h106-0-29" id="h106-0-29" class="i">+            &quot;DAILY&quot; -&gt; 86400000L
</a><a href="#h106-0-30" id="h106-0-30" class="i">+            &quot;WEEKLY&quot; -&gt; 604800000L
</a><a href="#h106-0-31" id="h106-0-31" class="i">+            else -&gt; return
</a><a href="#h106-0-32" id="h106-0-32" class="i">+        }
</a><a href="#h106-0-33" id="h106-0-33" class="i">+
</a><a href="#h106-0-34" id="h106-0-34" class="i">+        if (checkForUpdatesTimestamp + delayTimestamp &gt; currentTimeMillis) return
</a><a href="#h106-0-35" id="h106-0-35" class="i">+
</a><a href="#h106-0-36" id="h106-0-36" class="i">+        runCatching {
</a><a href="#h106-0-37" id="h106-0-37" class="i">+            checkForUpdates()
</a><a href="#h106-0-38" id="h106-0-38" class="i">+        }.onFailure {
</a><a href="#h106-0-39" id="h106-0-39" class="i">+            Logger.error(&quot;Failed to check for updates: ${it.message}&quot;, it)
</a><a href="#h106-0-40" id="h106-0-40" class="i">+        }.onSuccess {
</a><a href="#h106-0-41" id="h106-0-41" class="i">+            context.bridgeClient.setAutoUpdaterTime(currentTimeMillis)
</a><a href="#h106-0-42" id="h106-0-42" class="i">+        }
</a><a href="#h106-0-43" id="h106-0-43" class="i">+    }
</a><a href="#h106-0-44" id="h106-0-44" class="i">+
</a><a href="#h106-0-45" id="h106-0-45" class="i">+    @SuppressLint(&quot;UnspecifiedRegisterReceiverFlag&quot;)
</a><a href="#h106-0-46" id="h106-0-46" class="i">+    fun checkForUpdates(): String? {
</a><a href="#h106-0-47" id="h106-0-47" class="i">+        val endpoint = Request.Builder().url(&quot;https://api.github.com/repos/rhunk/SnapEnhance/releases&quot;).build()
</a><a href="#h106-0-48" id="h106-0-48" class="i">+        val response = OkHttpClient().newCall(endpoint).execute()
</a><a href="#h106-0-49" id="h106-0-49" class="i">+
</a><a href="#h106-0-50" id="h106-0-50" class="i">+        if (!response.isSuccessful) throw Throwable(&quot;Failed to fetch releases: ${response.code}&quot;)
</a><a href="#h106-0-51" id="h106-0-51" class="i">+
</a><a href="#h106-0-52" id="h106-0-52" class="i">+        val releases = JSONArray(response.body.string()).also {
</a><a href="#h106-0-53" id="h106-0-53" class="i">+            if (it.length() == 0) throw Throwable(&quot;No releases found&quot;)
</a><a href="#h106-0-54" id="h106-0-54" class="i">+        }
</a><a href="#h106-0-55" id="h106-0-55" class="i">+
</a><a href="#h106-0-56" id="h106-0-56" class="i">+        val latestRelease = releases.getJSONObject(0)
</a><a href="#h106-0-57" id="h106-0-57" class="i">+        val latestVersion = latestRelease.getString(&quot;tag_name&quot;)
</a><a href="#h106-0-58" id="h106-0-58" class="i">+        if (latestVersion.removePrefix(&quot;v&quot;) == BuildConfig.VERSION_NAME) return null
</a><a href="#h106-0-59" id="h106-0-59" class="i">+
</a><a href="#h106-0-60" id="h106-0-60" class="i">+        val releaseContentBody = latestRelease.getString(&quot;body&quot;)
</a><a href="#h106-0-61" id="h106-0-61" class="i">+        val downloadEndpoint = latestRelease.getJSONArray(&quot;assets&quot;).getJSONObject(0).getString(&quot;browser_download_url&quot;)
</a><a href="#h106-0-62" id="h106-0-62" class="i">+
</a><a href="#h106-0-63" id="h106-0-63" class="i">+        context.runOnUiThread {
</a><a href="#h106-0-64" id="h106-0-64" class="i">+            ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h106-0-65" id="h106-0-65" class="i">+                .setTitle(context.translation[&quot;auto_updater.dialog_title&quot;])
</a><a href="#h106-0-66" id="h106-0-66" class="i">+                .setMessage(
</a><a href="#h106-0-67" id="h106-0-67" class="i">+                    context.translation.format(&quot;auto_updater.dialog_message&quot;,
</a><a href="#h106-0-68" id="h106-0-68" class="i">+                        &quot;version&quot; to latestVersion,
</a><a href="#h106-0-69" id="h106-0-69" class="i">+                        &quot;body&quot; to releaseContentBody)
</a><a href="#h106-0-70" id="h106-0-70" class="i">+                )
</a><a href="#h106-0-71" id="h106-0-71" class="i">+                .setNegativeButton(context.translation[&quot;auto_updater.dialog_negative_button&quot;]) { dialog, _ -&gt;
</a><a href="#h106-0-72" id="h106-0-72" class="i">+                    dialog.dismiss()
</a><a href="#h106-0-73" id="h106-0-73" class="i">+                }
</a><a href="#h106-0-74" id="h106-0-74" class="i">+                .setPositiveButton(context.translation[&quot;auto_updater.dialog_positive_button&quot;]) { dialog, _ -&gt;
</a><a href="#h106-0-75" id="h106-0-75" class="i">+                    dialog.dismiss()
</a><a href="#h106-0-76" id="h106-0-76" class="i">+                    context.longToast(context.translation[&quot;auto_updater.downloading_toast&quot;])
</a><a href="#h106-0-77" id="h106-0-77" class="i">+
</a><a href="#h106-0-78" id="h106-0-78" class="i">+                    val request = DownloadManager.Request(Uri.parse(downloadEndpoint))
</a><a href="#h106-0-79" id="h106-0-79" class="i">+                        .setTitle(context.translation[&quot;auto_updater.download_manager_notification_title&quot;])
</a><a href="#h106-0-80" id="h106-0-80" class="i">+                        .setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, &quot;latest-snapenhance.apk&quot;)
</a><a href="#h106-0-81" id="h106-0-81" class="i">+                        .setMimeType(&quot;application/vnd.android.package-archive&quot;)
</a><a href="#h106-0-82" id="h106-0-82" class="i">+                        .setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE)
</a><a href="#h106-0-83" id="h106-0-83" class="i">+
</a><a href="#h106-0-84" id="h106-0-84" class="i">+                    val downloadManager = context.androidContext.getSystemService(Context.DOWNLOAD_SERVICE) as DownloadManager
</a><a href="#h106-0-85" id="h106-0-85" class="i">+                    val downloadId = downloadManager.enqueue(request)
</a><a href="#h106-0-86" id="h106-0-86" class="i">+
</a><a href="#h106-0-87" id="h106-0-87" class="i">+                    val onCompleteReceiver = object: BroadcastReceiver() {
</a><a href="#h106-0-88" id="h106-0-88" class="i">+                        override fun onReceive(context: Context, intent: Intent) {
</a><a href="#h106-0-89" id="h106-0-89" class="i">+                            val id = intent.getLongExtra(DownloadManager.EXTRA_DOWNLOAD_ID, -1)
</a><a href="#h106-0-90" id="h106-0-90" class="i">+                            if (id != downloadId) return
</a><a href="#h106-0-91" id="h106-0-91" class="i">+                            context.unregisterReceiver(this)
</a><a href="#h106-0-92" id="h106-0-92" class="i">+                            context.startActivity(
</a><a href="#h106-0-93" id="h106-0-93" class="i">+                                Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h106-0-94" id="h106-0-94" class="i">+                                    setDataAndType(downloadManager.getUriForDownloadedFile(downloadId), &quot;application/vnd.android.package-archive&quot;)
</a><a href="#h106-0-95" id="h106-0-95" class="i">+                                    flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h106-0-96" id="h106-0-96" class="i">+                                }
</a><a href="#h106-0-97" id="h106-0-97" class="i">+                            )
</a><a href="#h106-0-98" id="h106-0-98" class="i">+                        }
</a><a href="#h106-0-99" id="h106-0-99" class="i">+                    }
</a><a href="#h106-0-100" id="h106-0-100" class="i">+
</a><a href="#h106-0-101" id="h106-0-101" class="i">+                    context.mainActivity?.registerReceiver(onCompleteReceiver, IntentFilter(
</a><a href="#h106-0-102" id="h106-0-102" class="i">+                        DownloadManager.ACTION_DOWNLOAD_COMPLETE
</a><a href="#h106-0-103" id="h106-0-103" class="i">+                    ))
</a><a href="#h106-0-104" id="h106-0-104" class="i">+                }.show()
</a><a href="#h106-0-105" id="h106-0-105" class="i">+        }
</a><a href="#h106-0-106" id="h106-0-106" class="i">+
</a><a href="#h106-0-107" id="h106-0-107" class="i">+        return latestVersion
</a><a href="#h106-0-108" id="h106-0-108" class="i">+    }
</a><a href="#h106-0-109" id="h106-0-109" class="i">+}</a><a href="#h106-0-110" id="h106-0-110" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h107" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigEnumKeys.kt</a></b>
<b>diff --git a/<a id="h108" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a></b>
<b>diff --git a/<a id="h109" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/AntiAutoDownload.kt</a></b>
<b>diff --git a/<a id="h110" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></b>
<b>diff --git a/<a id="h111" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AmoledDarkMode.kt</a></b>
<b>diff --git a/<a id="h112" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/AppPasscode.kt</a></b>
<b>diff --git a/<a id="h113" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/DeviceSpooferHook.kt</a></b>
<b>diff --git a/<a id="h114" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/InfiniteStoryBoost.kt</a></b>
<b>diff --git a/<a id="h115" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/MeoPasscodeBypass.kt</a></b>
<b>diff --git a/<a id="h116" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a></b>
<b>diff --git a/<a id="h117" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/DisableMetrics.kt</a></b>
<b>diff --git a/<a id="h118" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/privacy/PreventMessageSending.kt</a></b>
<b>diff --git a/<a id="h119" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a></b>
<b>diff --git a/<a id="h120" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a></b>
<b>diff --git a/<a id="h121" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/PreventReadReceipts.kt</a></b>
<b>diff --git a/<a id="h122" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/StealthMode.kt</a></b>
<b>diff --git a/<a id="h123" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt</a></b>
<b>diff --git a/<a id="h124" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a></b>
<b>diff --git a/<a id="h125" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/CameraTweaks.kt</a></b>
<b>diff --git a/<a id="h126" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a></b>
<b>diff --git a/<a id="h127" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a></b>
<b>diff --git a/<a id="h128" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GooglePlayServicesDialogs.kt</a></b>
<b>diff --git a/<a id="h129" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a></b>
<b>diff --git a/<a id="h130" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a></b>
<b>diff --git a/<a id="h131" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a></b>
<b>diff --git a/<a id="h132" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a></b>
<b>diff --git a/<a id="h133" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a></b>
<b>diff --git a/<a id="h134" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt</a></b>
<b>diff --git a/<a id="h135" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/StartupPageOverride.kt</a></b>
<b>diff --git a/<a id="h136" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a></b>
<b>diff --git a/<a id="h137" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/hook/HookAdapter.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/hook/HookAdapter.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/hook/HookAdapter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/hook/HookAdapter.kt</a></b>
<b>diff --git a/<a id="h138" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/hook/HookStage.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/hook/HookStage.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/hook/HookStage.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/hook/HookStage.kt</a></b>
<b>diff --git a/<a id="h139" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/hook/Hooker.kt</a></b>
<b>diff --git a/<a id="h140" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/Manager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/Manager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/Manager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/Manager.kt</a></b>
<b>diff --git a/<a id="h141" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ActionManager.kt</a></b>
<a href="#h141-0" id="h141-0" class="h">@@ -0,0 +1,41 @@
</a><a href="#h141-0-0" id="h141-0-0" class="i">+package me.rhunk.snapenhance.manager.impl
</a><a href="#h141-0-1" id="h141-0-1" class="i">+
</a><a href="#h141-0-2" id="h141-0-2" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h141-0-3" id="h141-0-3" class="i">+import me.rhunk.snapenhance.ModContext
</a><a href="#h141-0-4" id="h141-0-4" class="i">+import me.rhunk.snapenhance.action.AbstractAction
</a><a href="#h141-0-5" id="h141-0-5" class="i">+import me.rhunk.snapenhance.action.impl.CheckForUpdates
</a><a href="#h141-0-6" id="h141-0-6" class="i">+import me.rhunk.snapenhance.action.impl.CleanCache
</a><a href="#h141-0-7" id="h141-0-7" class="i">+import me.rhunk.snapenhance.action.impl.ClearMessageLogger
</a><a href="#h141-0-8" id="h141-0-8" class="i">+import me.rhunk.snapenhance.action.impl.ExportChatMessages
</a><a href="#h141-0-9" id="h141-0-9" class="i">+import me.rhunk.snapenhance.action.impl.OpenMap
</a><a href="#h141-0-10" id="h141-0-10" class="i">+import me.rhunk.snapenhance.action.impl.RefreshMappings
</a><a href="#h141-0-11" id="h141-0-11" class="i">+import me.rhunk.snapenhance.manager.Manager
</a><a href="#h141-0-12" id="h141-0-12" class="i">+import kotlin.reflect.KClass
</a><a href="#h141-0-13" id="h141-0-13" class="i">+
</a><a href="#h141-0-14" id="h141-0-14" class="i">+class ActionManager(
</a><a href="#h141-0-15" id="h141-0-15" class="i">+    private val context: ModContext,
</a><a href="#h141-0-16" id="h141-0-16" class="i">+) : Manager {
</a><a href="#h141-0-17" id="h141-0-17" class="i">+    private val actions = mutableMapOf&lt;String, AbstractAction&gt;()
</a><a href="#h141-0-18" id="h141-0-18" class="i">+    fun getActions() = actions.values.toList()
</a><a href="#h141-0-19" id="h141-0-19" class="i">+    private fun load(clazz: KClass&lt;out AbstractAction&gt;) {
</a><a href="#h141-0-20" id="h141-0-20" class="i">+        val action = clazz.java.newInstance()
</a><a href="#h141-0-21" id="h141-0-21" class="i">+        action.context = context
</a><a href="#h141-0-22" id="h141-0-22" class="i">+        actions[action.nameKey] = action
</a><a href="#h141-0-23" id="h141-0-23" class="i">+    }
</a><a href="#h141-0-24" id="h141-0-24" class="i">+    override fun init() {
</a><a href="#h141-0-25" id="h141-0-25" class="i">+        load(CleanCache::class)
</a><a href="#h141-0-26" id="h141-0-26" class="i">+        load(ExportChatMessages::class)
</a><a href="#h141-0-27" id="h141-0-27" class="i">+        load(OpenMap::class)
</a><a href="#h141-0-28" id="h141-0-28" class="i">+
</a><a href="#h141-0-29" id="h141-0-29" class="i">+        if(!BuildConfig.DEBUG) {
</a><a href="#h141-0-30" id="h141-0-30" class="i">+            load(CheckForUpdates::class)
</a><a href="#h141-0-31" id="h141-0-31" class="i">+        }
</a><a href="#h141-0-32" id="h141-0-32" class="i">+        else {
</a><a href="#h141-0-33" id="h141-0-33" class="i">+            load(ClearMessageLogger::class)
</a><a href="#h141-0-34" id="h141-0-34" class="i">+            load(RefreshMappings::class)
</a><a href="#h141-0-35" id="h141-0-35" class="i">+        }
</a><a href="#h141-0-36" id="h141-0-36" class="i">+
</a><a href="#h141-0-37" id="h141-0-37" class="i">+
</a><a href="#h141-0-38" id="h141-0-38" class="i">+        actions.values.forEach(AbstractAction::init)
</a><a href="#h141-0-39" id="h141-0-39" class="i">+    }
</a><a href="#h141-0-40" id="h141-0-40" class="i">+}</a><a href="#h141-0-41" id="h141-0-41" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h142" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a></b>
<b>diff --git a/<a id="h143" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></b>
<b>diff --git a/<a id="h144" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></b>
<b>diff --git a/<a id="h145" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/ItemHelper.kt</a></b>
<a href="#h145-0" id="h145-0" class="h">@@ -0,0 +1,85 @@
</a><a href="#h145-0-0" id="h145-0-0" class="i">+package me.rhunk.snapenhance.ui
</a><a href="#h145-0-1" id="h145-0-1" class="i">+
</a><a href="#h145-0-2" id="h145-0-2" class="i">+import android.app.Activity
</a><a href="#h145-0-3" id="h145-0-3" class="i">+import android.app.AlertDialog
</a><a href="#h145-0-4" id="h145-0-4" class="i">+import android.content.Context
</a><a href="#h145-0-5" id="h145-0-5" class="i">+import android.content.Intent
</a><a href="#h145-0-6" id="h145-0-6" class="i">+import android.widget.EditText
</a><a href="#h145-0-7" id="h145-0-7" class="i">+import android.widget.TextView
</a><a href="#h145-0-8" id="h145-0-8" class="i">+import android.widget.Toast
</a><a href="#h145-0-9" id="h145-0-9" class="i">+import me.rhunk.snapenhance.core.R
</a><a href="#h145-0-10" id="h145-0-10" class="i">+import me.rhunk.snapenhance.SharedContext
</a><a href="#h145-0-11" id="h145-0-11" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h145-0-12" id="h145-0-12" class="i">+import me.rhunk.snapenhance.util.ActivityResultCallback
</a><a href="#h145-0-13" id="h145-0-13" class="i">+import kotlin.math.abs
</a><a href="#h145-0-14" id="h145-0-14" class="i">+import kotlin.random.Random
</a><a href="#h145-0-15" id="h145-0-15" class="i">+
</a><a href="#h145-0-16" id="h145-0-16" class="i">+class ItemHelper(
</a><a href="#h145-0-17" id="h145-0-17" class="i">+    private val context : Context
</a><a href="#h145-0-18" id="h145-0-18" class="i">+) {
</a><a href="#h145-0-19" id="h145-0-19" class="i">+    val positiveButtonText by lazy {
</a><a href="#h145-0-20" id="h145-0-20" class="i">+        SharedContext.translation[&quot;button.ok&quot;]
</a><a href="#h145-0-21" id="h145-0-21" class="i">+    }
</a><a href="#h145-0-22" id="h145-0-22" class="i">+    
</a><a href="#h145-0-23" id="h145-0-23" class="i">+    val cancelButtonText by lazy {
</a><a href="#h145-0-24" id="h145-0-24" class="i">+        SharedContext.translation[&quot;button.cancel&quot;]
</a><a href="#h145-0-25" id="h145-0-25" class="i">+    }
</a><a href="#h145-0-26" id="h145-0-26" class="i">+    
</a><a href="#h145-0-27" id="h145-0-27" class="i">+    fun longToast(message: String, context: Context) {
</a><a href="#h145-0-28" id="h145-0-28" class="i">+        Toast.makeText(context, message, Toast.LENGTH_LONG).show()
</a><a href="#h145-0-29" id="h145-0-29" class="i">+    }
</a><a href="#h145-0-30" id="h145-0-30" class="i">+
</a><a href="#h145-0-31" id="h145-0-31" class="i">+    fun createTranslatedTextView(property: ConfigProperty, shouldTranslatePropertyValue: Boolean = true): TextView {
</a><a href="#h145-0-32" id="h145-0-32" class="i">+        return object: TextView(context) {
</a><a href="#h145-0-33" id="h145-0-33" class="i">+            override fun setText(text: CharSequence?, type: BufferType?) {
</a><a href="#h145-0-34" id="h145-0-34" class="i">+                val newText = text?.takeIf { it.isNotEmpty() }?.let {
</a><a href="#h145-0-35" id="h145-0-35" class="i">+                    if (!shouldTranslatePropertyValue || property.disableValueLocalization) it
</a><a href="#h145-0-36" id="h145-0-36" class="i">+                    else SharedContext.translation[property.getOptionTranslationKey(it.toString())]
</a><a href="#h145-0-37" id="h145-0-37" class="i">+                }?.let {
</a><a href="#h145-0-38" id="h145-0-38" class="i">+                    if (it.length &gt; 20) {
</a><a href="#h145-0-39" id="h145-0-39" class="i">+                        &quot;...${it.substring(it.length - 20)}&quot;
</a><a href="#h145-0-40" id="h145-0-40" class="i">+                    } else {
</a><a href="#h145-0-41" id="h145-0-41" class="i">+                        it
</a><a href="#h145-0-42" id="h145-0-42" class="i">+                    }
</a><a href="#h145-0-43" id="h145-0-43" class="i">+                } ?: &quot;&quot;
</a><a href="#h145-0-44" id="h145-0-44" class="i">+                super.setTextColor(context.getColor(R.color.tertiaryText))
</a><a href="#h145-0-45" id="h145-0-45" class="i">+                super.setText(newText, type)
</a><a href="#h145-0-46" id="h145-0-46" class="i">+            }
</a><a href="#h145-0-47" id="h145-0-47" class="i">+        }
</a><a href="#h145-0-48" id="h145-0-48" class="i">+    }
</a><a href="#h145-0-49" id="h145-0-49" class="i">+
</a><a href="#h145-0-50" id="h145-0-50" class="i">+    fun askForValue(property: ConfigProperty, requestedInputType: Int, callback: (String) -&gt; Unit) {
</a><a href="#h145-0-51" id="h145-0-51" class="i">+        val editText = EditText(context).apply {
</a><a href="#h145-0-52" id="h145-0-52" class="i">+            inputType = requestedInputType
</a><a href="#h145-0-53" id="h145-0-53" class="i">+            setText(property.valueContainer.value().toString())
</a><a href="#h145-0-54" id="h145-0-54" class="i">+        }
</a><a href="#h145-0-55" id="h145-0-55" class="i">+        AlertDialog.Builder(context)
</a><a href="#h145-0-56" id="h145-0-56" class="i">+            .setTitle(SharedContext.translation[&quot;property.${property.translationKey}.name&quot;])
</a><a href="#h145-0-57" id="h145-0-57" class="i">+            .setView(editText)
</a><a href="#h145-0-58" id="h145-0-58" class="i">+            .setPositiveButton(positiveButtonText) { _, _ -&gt;
</a><a href="#h145-0-59" id="h145-0-59" class="i">+                callback(editText.text.toString())
</a><a href="#h145-0-60" id="h145-0-60" class="i">+            }
</a><a href="#h145-0-61" id="h145-0-61" class="i">+            .setNegativeButton(cancelButtonText) { dialog, _ -&gt;
</a><a href="#h145-0-62" id="h145-0-62" class="i">+                dialog.cancel()
</a><a href="#h145-0-63" id="h145-0-63" class="i">+            }
</a><a href="#h145-0-64" id="h145-0-64" class="i">+            .show()
</a><a href="#h145-0-65" id="h145-0-65" class="i">+    }
</a><a href="#h145-0-66" id="h145-0-66" class="i">+
</a><a href="#h145-0-67" id="h145-0-67" class="i">+    fun askForFolder(activity: Activity, property: ConfigProperty, callback: (String) -&gt; Unit): Pair&lt;Int, ActivityResultCallback&gt; {
</a><a href="#h145-0-68" id="h145-0-68" class="i">+        val intent = Intent(Intent.ACTION_OPEN_DOCUMENT_TREE)
</a><a href="#h145-0-69" id="h145-0-69" class="i">+            .addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION)
</a><a href="#h145-0-70" id="h145-0-70" class="i">+            .addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
</a><a href="#h145-0-71" id="h145-0-71" class="i">+
</a><a href="#h145-0-72" id="h145-0-72" class="i">+        val requestCode = abs(Random.nextInt())
</a><a href="#h145-0-73" id="h145-0-73" class="i">+        activity.startActivityForResult(intent, requestCode)
</a><a href="#h145-0-74" id="h145-0-74" class="i">+
</a><a href="#h145-0-75" id="h145-0-75" class="i">+        return requestCode to let@{_, resultCode, data -&gt;
</a><a href="#h145-0-76" id="h145-0-76" class="i">+            if (resultCode != Activity.RESULT_OK) return@let
</a><a href="#h145-0-77" id="h145-0-77" class="i">+            val uri = data?.data ?: return@let
</a><a href="#h145-0-78" id="h145-0-78" class="i">+            val value = uri.toString()
</a><a href="#h145-0-79" id="h145-0-79" class="i">+            activity.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION)
</a><a href="#h145-0-80" id="h145-0-80" class="i">+            property.valueContainer.writeFrom(value)
</a><a href="#h145-0-81" id="h145-0-81" class="i">+            callback(value)
</a><a href="#h145-0-82" id="h145-0-82" class="i">+        }
</a><a href="#h145-0-83" id="h145-0-83" class="i">+    }
</a><a href="#h145-0-84" id="h145-0-84" class="i">+}
</a><b>diff --git a/<a id="h146" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/ViewAppearanceHelper.kt</a></b>
<b>diff --git a/<a id="h147" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/config/ConfigActivity.kt</a></b>
<a href="#h147-0" id="h147-0" class="h">@@ -0,0 +1,279 @@
</a><a href="#h147-0-0" id="h147-0-0" class="i">+package me.rhunk.snapenhance.ui.config
</a><a href="#h147-0-1" id="h147-0-1" class="i">+
</a><a href="#h147-0-2" id="h147-0-2" class="i">+import android.app.Activity
</a><a href="#h147-0-3" id="h147-0-3" class="i">+import android.app.AlertDialog
</a><a href="#h147-0-4" id="h147-0-4" class="i">+import android.content.Intent
</a><a href="#h147-0-5" id="h147-0-5" class="i">+import android.content.res.ColorStateList
</a><a href="#h147-0-6" id="h147-0-6" class="i">+import android.os.Bundle
</a><a href="#h147-0-7" id="h147-0-7" class="i">+import android.text.Html
</a><a href="#h147-0-8" id="h147-0-8" class="i">+import android.text.InputType
</a><a href="#h147-0-9" id="h147-0-9" class="i">+import android.view.View
</a><a href="#h147-0-10" id="h147-0-10" class="i">+import android.view.ViewGroup
</a><a href="#h147-0-11" id="h147-0-11" class="i">+import android.widget.ImageButton
</a><a href="#h147-0-12" id="h147-0-12" class="i">+import android.widget.Switch
</a><a href="#h147-0-13" id="h147-0-13" class="i">+import android.widget.TextView
</a><a href="#h147-0-14" id="h147-0-14" class="i">+import android.widget.Toast
</a><a href="#h147-0-15" id="h147-0-15" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h147-0-16" id="h147-0-16" class="i">+import me.rhunk.snapenhance.core.R
</a><a href="#h147-0-17" id="h147-0-17" class="i">+import me.rhunk.snapenhance.SharedContext
</a><a href="#h147-0-18" id="h147-0-18" class="i">+import me.rhunk.snapenhance.config.ConfigCategory
</a><a href="#h147-0-19" id="h147-0-19" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h147-0-20" id="h147-0-20" class="i">+import me.rhunk.snapenhance.config.impl.ConfigIntegerValue
</a><a href="#h147-0-21" id="h147-0-21" class="i">+import me.rhunk.snapenhance.config.impl.ConfigStateListValue
</a><a href="#h147-0-22" id="h147-0-22" class="i">+import me.rhunk.snapenhance.config.impl.ConfigStateSelection
</a><a href="#h147-0-23" id="h147-0-23" class="i">+import me.rhunk.snapenhance.config.impl.ConfigStateValue
</a><a href="#h147-0-24" id="h147-0-24" class="i">+import me.rhunk.snapenhance.config.impl.ConfigStringValue
</a><a href="#h147-0-25" id="h147-0-25" class="i">+import me.rhunk.snapenhance.ui.ItemHelper
</a><a href="#h147-0-26" id="h147-0-26" class="i">+import me.rhunk.snapenhance.util.ActivityResultCallback
</a><a href="#h147-0-27" id="h147-0-27" class="i">+import kotlin.system.exitProcess
</a><a href="#h147-0-28" id="h147-0-28" class="i">+
</a><a href="#h147-0-29" id="h147-0-29" class="i">+
</a><a href="#h147-0-30" id="h147-0-30" class="i">+class ConfigActivity : Activity() {
</a><a href="#h147-0-31" id="h147-0-31" class="i">+    private val itemHelper = ItemHelper(this)
</a><a href="#h147-0-32" id="h147-0-32" class="i">+    private val activityResultCallbacks = mutableMapOf&lt;Int, ActivityResultCallback&gt;()
</a><a href="#h147-0-33" id="h147-0-33" class="i">+
</a><a href="#h147-0-34" id="h147-0-34" class="i">+    @Deprecated(&quot;Deprecated in Java&quot;)
</a><a href="#h147-0-35" id="h147-0-35" class="i">+    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h147-0-36" id="h147-0-36" class="i">+    override fun onBackPressed() {
</a><a href="#h147-0-37" id="h147-0-37" class="i">+        super.onBackPressed()
</a><a href="#h147-0-38" id="h147-0-38" class="i">+        finish()
</a><a href="#h147-0-39" id="h147-0-39" class="i">+    }
</a><a href="#h147-0-40" id="h147-0-40" class="i">+
</a><a href="#h147-0-41" id="h147-0-41" class="i">+    override fun onDestroy() {
</a><a href="#h147-0-42" id="h147-0-42" class="i">+        super.onDestroy()
</a><a href="#h147-0-43" id="h147-0-43" class="i">+        SharedContext.config.writeConfig()
</a><a href="#h147-0-44" id="h147-0-44" class="i">+    }
</a><a href="#h147-0-45" id="h147-0-45" class="i">+
</a><a href="#h147-0-46" id="h147-0-46" class="i">+    override fun onPause() {
</a><a href="#h147-0-47" id="h147-0-47" class="i">+        super.onPause()
</a><a href="#h147-0-48" id="h147-0-48" class="i">+        SharedContext.config.writeConfig()
</a><a href="#h147-0-49" id="h147-0-49" class="i">+    }
</a><a href="#h147-0-50" id="h147-0-50" class="i">+
</a><a href="#h147-0-51" id="h147-0-51" class="i">+    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
</a><a href="#h147-0-52" id="h147-0-52" class="i">+        activityResultCallbacks[requestCode]?.invoke(requestCode, resultCode, data)
</a><a href="#h147-0-53" id="h147-0-53" class="i">+    }
</a><a href="#h147-0-54" id="h147-0-54" class="i">+
</a><a href="#h147-0-55" id="h147-0-55" class="i">+    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h147-0-56" id="h147-0-56" class="i">+        super.onCreate(savedInstanceState)
</a><a href="#h147-0-57" id="h147-0-57" class="i">+        SharedContext.ensureInitialized(this)
</a><a href="#h147-0-58" id="h147-0-58" class="i">+        setContentView(R.layout.config_activity)
</a><a href="#h147-0-59" id="h147-0-59" class="i">+
</a><a href="#h147-0-60" id="h147-0-60" class="i">+        findViewById&lt;View&gt;(R.id.title_bar).let { titleBar -&gt;
</a><a href="#h147-0-61" id="h147-0-61" class="i">+            titleBar.findViewById&lt;TextView&gt;(R.id.title).text = SharedContext.translation[&quot;config_activity.title&quot;]
</a><a href="#h147-0-62" id="h147-0-62" class="i">+            titleBar.findViewById&lt;ImageButton&gt;(R.id.back_button).visibility = View.GONE
</a><a href="#h147-0-63" id="h147-0-63" class="i">+        }
</a><a href="#h147-0-64" id="h147-0-64" class="i">+
</a><a href="#h147-0-65" id="h147-0-65" class="i">+        val propertyListLayout = findViewById&lt;ViewGroup&gt;(R.id.property_list)
</a><a href="#h147-0-66" id="h147-0-66" class="i">+
</a><a href="#h147-0-67" id="h147-0-67" class="i">+        if (intent.getBooleanExtra(&quot;lspatched&quot;, false) ||
</a><a href="#h147-0-68" id="h147-0-68" class="i">+            applicationInfo.packageName != &quot;me.rhunk.snapenhance&quot; ||
</a><a href="#h147-0-69" id="h147-0-69" class="i">+            BuildConfig.DEBUG) {
</a><a href="#h147-0-70" id="h147-0-70" class="i">+            propertyListLayout.addView(
</a><a href="#h147-0-71" id="h147-0-71" class="i">+                layoutInflater.inflate(
</a><a href="#h147-0-72" id="h147-0-72" class="i">+                    R.layout.config_activity_debug_item,
</a><a href="#h147-0-73" id="h147-0-73" class="i">+                    propertyListLayout,
</a><a href="#h147-0-74" id="h147-0-74" class="i">+                    false
</a><a href="#h147-0-75" id="h147-0-75" class="i">+                ).apply {
</a><a href="#h147-0-76" id="h147-0-76" class="i">+                    findViewById&lt;TextView&gt;(R.id.debug_item_content).apply {
</a><a href="#h147-0-77" id="h147-0-77" class="i">+                        text = Html.fromHtml(
</a><a href="#h147-0-78" id="h147-0-78" class="i">+                            &quot;You are using a &lt;u&gt;&lt;b&gt;debug/unofficial&lt;/b&gt;&lt;/u&gt; build!\n&quot; +
</a><a href="#h147-0-79" id="h147-0-79" class="i">+                                    &quot;Please consider downloading stable builds from &lt;a href=\&quot;https://github.com/rhunk/SnapEnhance\&quot;&gt;GitHub&lt;/a&gt;.&quot;,
</a><a href="#h147-0-80" id="h147-0-80" class="i">+                            Html.FROM_HTML_MODE_COMPACT
</a><a href="#h147-0-81" id="h147-0-81" class="i">+                        )
</a><a href="#h147-0-82" id="h147-0-82" class="i">+                        movementMethod = android.text.method.LinkMovementMethod.getInstance()
</a><a href="#h147-0-83" id="h147-0-83" class="i">+                    }
</a><a href="#h147-0-84" id="h147-0-84" class="i">+                })
</a><a href="#h147-0-85" id="h147-0-85" class="i">+        }
</a><a href="#h147-0-86" id="h147-0-86" class="i">+
</a><a href="#h147-0-87" id="h147-0-87" class="i">+        //check if save folder is set
</a><a href="#h147-0-88" id="h147-0-88" class="i">+        //TODO: first run activity
</a><a href="#h147-0-89" id="h147-0-89" class="i">+        run {
</a><a href="#h147-0-90" id="h147-0-90" class="i">+            val saveFolder = SharedContext.config.string(ConfigProperty.SAVE_FOLDER)
</a><a href="#h147-0-91" id="h147-0-91" class="i">+            val itemHelper = ItemHelper(this)
</a><a href="#h147-0-92" id="h147-0-92" class="i">+
</a><a href="#h147-0-93" id="h147-0-93" class="i">+            if (saveFolder.isEmpty() || !saveFolder.startsWith(&quot;content://&quot;)) {
</a><a href="#h147-0-94" id="h147-0-94" class="i">+                AlertDialog.Builder(this)
</a><a href="#h147-0-95" id="h147-0-95" class="i">+                    .setTitle(&quot;Save folder&quot;)
</a><a href="#h147-0-96" id="h147-0-96" class="i">+                    .setMessage(&quot;Please select a folder where you want to save downloaded files.&quot;)
</a><a href="#h147-0-97" id="h147-0-97" class="i">+                    .setPositiveButton(&quot;Select&quot;) { _, _ -&gt;
</a><a href="#h147-0-98" id="h147-0-98" class="i">+                        val (requestCode, callback) = itemHelper.askForFolder(
</a><a href="#h147-0-99" id="h147-0-99" class="i">+                            this,
</a><a href="#h147-0-100" id="h147-0-100" class="i">+                            ConfigProperty.SAVE_FOLDER
</a><a href="#h147-0-101" id="h147-0-101" class="i">+                        ) {}
</a><a href="#h147-0-102" id="h147-0-102" class="i">+                        activityResultCallbacks[requestCode] = { a1, a2, a3 -&gt;
</a><a href="#h147-0-103" id="h147-0-103" class="i">+                            callback(a1, a2, a3)
</a><a href="#h147-0-104" id="h147-0-104" class="i">+                            Toast.makeText(this, &quot;Save Folder set!&quot;, Toast.LENGTH_SHORT).show()
</a><a href="#h147-0-105" id="h147-0-105" class="i">+                            finish()
</a><a href="#h147-0-106" id="h147-0-106" class="i">+                        }
</a><a href="#h147-0-107" id="h147-0-107" class="i">+                    }
</a><a href="#h147-0-108" id="h147-0-108" class="i">+                    .setNegativeButton(&quot;Cancel&quot;) { _, _ -&gt;
</a><a href="#h147-0-109" id="h147-0-109" class="i">+                        exitProcess(0)
</a><a href="#h147-0-110" id="h147-0-110" class="i">+                    }
</a><a href="#h147-0-111" id="h147-0-111" class="i">+                    .show()
</a><a href="#h147-0-112" id="h147-0-112" class="i">+            }
</a><a href="#h147-0-113" id="h147-0-113" class="i">+        }
</a><a href="#h147-0-114" id="h147-0-114" class="i">+
</a><a href="#h147-0-115" id="h147-0-115" class="i">+        var currentCategory: ConfigCategory? = null
</a><a href="#h147-0-116" id="h147-0-116" class="i">+
</a><a href="#h147-0-117" id="h147-0-117" class="i">+        SharedContext.config.entries().filter { !it.key.category.hidden }.forEach { (property, value) -&gt;
</a><a href="#h147-0-118" id="h147-0-118" class="i">+            val configItem = layoutInflater.inflate(R.layout.config_activity_item, propertyListLayout, false)
</a><a href="#h147-0-119" id="h147-0-119" class="i">+
</a><a href="#h147-0-120" id="h147-0-120" class="i">+            fun addSeparator() {
</a><a href="#h147-0-121" id="h147-0-121" class="i">+                //add separator
</a><a href="#h147-0-122" id="h147-0-122" class="i">+                propertyListLayout.addView(View(this).apply {
</a><a href="#h147-0-123" id="h147-0-123" class="i">+                    layoutParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, 1)
</a><a href="#h147-0-124" id="h147-0-124" class="i">+                    setBackgroundColor(getColor(R.color.tertiaryBackground))
</a><a href="#h147-0-125" id="h147-0-125" class="i">+                })
</a><a href="#h147-0-126" id="h147-0-126" class="i">+            }
</a><a href="#h147-0-127" id="h147-0-127" class="i">+
</a><a href="#h147-0-128" id="h147-0-128" class="i">+            if (property.category != currentCategory) {
</a><a href="#h147-0-129" id="h147-0-129" class="i">+                if(!property.shouldAppearInSettings) return@forEach
</a><a href="#h147-0-130" id="h147-0-130" class="i">+                currentCategory = property.category
</a><a href="#h147-0-131" id="h147-0-131" class="i">+                with(layoutInflater.inflate(R.layout.config_activity_item, propertyListLayout, false)) {
</a><a href="#h147-0-132" id="h147-0-132" class="i">+                    findViewById&lt;TextView&gt;(R.id.name).apply {
</a><a href="#h147-0-133" id="h147-0-133" class="i">+                        text = SharedContext.translation[&quot;category.${property.category.key}&quot;]
</a><a href="#h147-0-134" id="h147-0-134" class="i">+                        textSize = 20f
</a><a href="#h147-0-135" id="h147-0-135" class="i">+                        typeface = typeface?.let { android.graphics.Typeface.create(it, android.graphics.Typeface.BOLD) }
</a><a href="#h147-0-136" id="h147-0-136" class="i">+                    }
</a><a href="#h147-0-137" id="h147-0-137" class="i">+                    propertyListLayout.addView(this)
</a><a href="#h147-0-138" id="h147-0-138" class="i">+                }
</a><a href="#h147-0-139" id="h147-0-139" class="i">+                addSeparator()
</a><a href="#h147-0-140" id="h147-0-140" class="i">+            }
</a><a href="#h147-0-141" id="h147-0-141" class="i">+
</a><a href="#h147-0-142" id="h147-0-142" class="i">+            if (!property.shouldAppearInSettings) return@forEach
</a><a href="#h147-0-143" id="h147-0-143" class="i">+
</a><a href="#h147-0-144" id="h147-0-144" class="i">+            val propertyName = SharedContext.translation[&quot;property.${property.translationKey}.name&quot;]
</a><a href="#h147-0-145" id="h147-0-145" class="i">+
</a><a href="#h147-0-146" id="h147-0-146" class="i">+            configItem.findViewById&lt;TextView&gt;(R.id.name).text = propertyName
</a><a href="#h147-0-147" id="h147-0-147" class="i">+            configItem.findViewById&lt;TextView&gt;(R.id.description).also {
</a><a href="#h147-0-148" id="h147-0-148" class="i">+                it.text = SharedContext.translation[&quot;property.${property.translationKey}.description&quot;]
</a><a href="#h147-0-149" id="h147-0-149" class="i">+                it.visibility = if (it.text.isEmpty()) View.GONE else View.VISIBLE
</a><a href="#h147-0-150" id="h147-0-150" class="i">+            }
</a><a href="#h147-0-151" id="h147-0-151" class="i">+
</a><a href="#h147-0-152" id="h147-0-152" class="i">+            fun addValueView(view: View) {
</a><a href="#h147-0-153" id="h147-0-153" class="i">+                configItem.findViewById&lt;ViewGroup&gt;(R.id.value).addView(view)
</a><a href="#h147-0-154" id="h147-0-154" class="i">+            }
</a><a href="#h147-0-155" id="h147-0-155" class="i">+
</a><a href="#h147-0-156" id="h147-0-156" class="i">+            when (value) {
</a><a href="#h147-0-157" id="h147-0-157" class="i">+                is ConfigStateValue -&gt; {
</a><a href="#h147-0-158" id="h147-0-158" class="i">+                    val switch = Switch(this)
</a><a href="#h147-0-159" id="h147-0-159" class="i">+                    switch.isChecked = value.value()
</a><a href="#h147-0-160" id="h147-0-160" class="i">+                    switch.trackTintList = ColorStateList(
</a><a href="#h147-0-161" id="h147-0-161" class="i">+                        arrayOf(
</a><a href="#h147-0-162" id="h147-0-162" class="i">+                            intArrayOf(android.R.attr.state_checked),
</a><a href="#h147-0-163" id="h147-0-163" class="i">+                            intArrayOf(-android.R.attr.state_checked)
</a><a href="#h147-0-164" id="h147-0-164" class="i">+                        ),
</a><a href="#h147-0-165" id="h147-0-165" class="i">+                        intArrayOf(
</a><a href="#h147-0-166" id="h147-0-166" class="i">+                            switch.highlightColor,
</a><a href="#h147-0-167" id="h147-0-167" class="i">+                            getColor(R.color.tertiaryBackground)
</a><a href="#h147-0-168" id="h147-0-168" class="i">+                        )
</a><a href="#h147-0-169" id="h147-0-169" class="i">+                    )
</a><a href="#h147-0-170" id="h147-0-170" class="i">+                    switch.setOnCheckedChangeListener { _, isChecked -&gt;
</a><a href="#h147-0-171" id="h147-0-171" class="i">+                        value.writeFrom(isChecked.toString())
</a><a href="#h147-0-172" id="h147-0-172" class="i">+                    }
</a><a href="#h147-0-173" id="h147-0-173" class="i">+                    configItem.setOnClickListener { switch.toggle() }
</a><a href="#h147-0-174" id="h147-0-174" class="i">+                    addValueView(switch)
</a><a href="#h147-0-175" id="h147-0-175" class="i">+                }
</a><a href="#h147-0-176" id="h147-0-176" class="i">+                is ConfigStringValue, is ConfigIntegerValue -&gt; {
</a><a href="#h147-0-177" id="h147-0-177" class="i">+                    val textView = itemHelper.createTranslatedTextView(property, shouldTranslatePropertyValue = false).also {
</a><a href="#h147-0-178" id="h147-0-178" class="i">+                        it.text = value.value().toString()
</a><a href="#h147-0-179" id="h147-0-179" class="i">+                    }
</a><a href="#h147-0-180" id="h147-0-180" class="i">+                    configItem.setOnClickListener {
</a><a href="#h147-0-181" id="h147-0-181" class="i">+                        if (value is ConfigStringValue &amp;&amp; value.isFolderPath) {
</a><a href="#h147-0-182" id="h147-0-182" class="i">+                            val (requestCode, callback) = itemHelper.askForFolder(this, property) {
</a><a href="#h147-0-183" id="h147-0-183" class="i">+                                value.writeFrom(it)
</a><a href="#h147-0-184" id="h147-0-184" class="i">+                                textView.text = value.value()
</a><a href="#h147-0-185" id="h147-0-185" class="i">+                            }
</a><a href="#h147-0-186" id="h147-0-186" class="i">+
</a><a href="#h147-0-187" id="h147-0-187" class="i">+                            activityResultCallbacks[requestCode] = callback
</a><a href="#h147-0-188" id="h147-0-188" class="i">+                            return@setOnClickListener
</a><a href="#h147-0-189" id="h147-0-189" class="i">+                        }
</a><a href="#h147-0-190" id="h147-0-190" class="i">+
</a><a href="#h147-0-191" id="h147-0-191" class="i">+                        if (value is ConfigIntegerValue) {
</a><a href="#h147-0-192" id="h147-0-192" class="i">+                            itemHelper.askForValue(property, InputType.TYPE_CLASS_NUMBER) {
</a><a href="#h147-0-193" id="h147-0-193" class="i">+                                try {
</a><a href="#h147-0-194" id="h147-0-194" class="i">+                                    value.writeFrom(it)
</a><a href="#h147-0-195" id="h147-0-195" class="i">+                                    textView.text = value.value().toString()
</a><a href="#h147-0-196" id="h147-0-196" class="i">+                                } catch (e: NumberFormatException) {
</a><a href="#h147-0-197" id="h147-0-197" class="i">+                                    itemHelper.longToast(SharedContext.translation[&quot;config_activity.invalid_number_toast&quot;], this)
</a><a href="#h147-0-198" id="h147-0-198" class="i">+                                }
</a><a href="#h147-0-199" id="h147-0-199" class="i">+                            }
</a><a href="#h147-0-200" id="h147-0-200" class="i">+                            return@setOnClickListener
</a><a href="#h147-0-201" id="h147-0-201" class="i">+                        }
</a><a href="#h147-0-202" id="h147-0-202" class="i">+                        itemHelper.askForValue(property, InputType.TYPE_CLASS_TEXT) {
</a><a href="#h147-0-203" id="h147-0-203" class="i">+                            value.writeFrom(it)
</a><a href="#h147-0-204" id="h147-0-204" class="i">+                            textView.text = value.value().toString()
</a><a href="#h147-0-205" id="h147-0-205" class="i">+                        }
</a><a href="#h147-0-206" id="h147-0-206" class="i">+                    }
</a><a href="#h147-0-207" id="h147-0-207" class="i">+                    addValueView(textView)
</a><a href="#h147-0-208" id="h147-0-208" class="i">+                }
</a><a href="#h147-0-209" id="h147-0-209" class="i">+                is ConfigStateListValue -&gt; {
</a><a href="#h147-0-210" id="h147-0-210" class="i">+                    val textView = itemHelper.createTranslatedTextView(property, shouldTranslatePropertyValue = false)
</a><a href="#h147-0-211" id="h147-0-211" class="i">+                    val values = value.value()
</a><a href="#h147-0-212" id="h147-0-212" class="i">+
</a><a href="#h147-0-213" id="h147-0-213" class="i">+                    fun updateText() {
</a><a href="#h147-0-214" id="h147-0-214" class="i">+                        textView.text = SharedContext.translation.format(&quot;config_activity.selected_text&quot;, &quot;count&quot; to values.filter { it.value }.size.toString())
</a><a href="#h147-0-215" id="h147-0-215" class="i">+                    }
</a><a href="#h147-0-216" id="h147-0-216" class="i">+
</a><a href="#h147-0-217" id="h147-0-217" class="i">+                    updateText()
</a><a href="#h147-0-218" id="h147-0-218" class="i">+
</a><a href="#h147-0-219" id="h147-0-219" class="i">+                    configItem.setOnClickListener {
</a><a href="#h147-0-220" id="h147-0-220" class="i">+                        AlertDialog.Builder(this)
</a><a href="#h147-0-221" id="h147-0-221" class="i">+                            .setTitle(propertyName)
</a><a href="#h147-0-222" id="h147-0-222" class="i">+                            .setPositiveButton(itemHelper.positiveButtonText) { _, _ -&gt;
</a><a href="#h147-0-223" id="h147-0-223" class="i">+                                updateText()
</a><a href="#h147-0-224" id="h147-0-224" class="i">+                            }
</a><a href="#h147-0-225" id="h147-0-225" class="i">+                            .setMultiChoiceItems(
</a><a href="#h147-0-226" id="h147-0-226" class="i">+                                values.keys.map {
</a><a href="#h147-0-227" id="h147-0-227" class="i">+                                    if (property.disableValueLocalization) it
</a><a href="#h147-0-228" id="h147-0-228" class="i">+                                    else SharedContext.translation[property.getOptionTranslationKey(it)]
</a><a href="#h147-0-229" id="h147-0-229" class="i">+                                }.toTypedArray(),
</a><a href="#h147-0-230" id="h147-0-230" class="i">+                                values.map { it.value }.toBooleanArray()
</a><a href="#h147-0-231" id="h147-0-231" class="i">+                            ) { _, which, isChecked -&gt;
</a><a href="#h147-0-232" id="h147-0-232" class="i">+                                value.setKey(values.keys.elementAt(which), isChecked)
</a><a href="#h147-0-233" id="h147-0-233" class="i">+                            }
</a><a href="#h147-0-234" id="h147-0-234" class="i">+                            .show()
</a><a href="#h147-0-235" id="h147-0-235" class="i">+                    }
</a><a href="#h147-0-236" id="h147-0-236" class="i">+
</a><a href="#h147-0-237" id="h147-0-237" class="i">+                    addValueView(textView)
</a><a href="#h147-0-238" id="h147-0-238" class="i">+                }
</a><a href="#h147-0-239" id="h147-0-239" class="i">+                is ConfigStateSelection -&gt; {
</a><a href="#h147-0-240" id="h147-0-240" class="i">+                    val textView = itemHelper.createTranslatedTextView(property, shouldTranslatePropertyValue = true)
</a><a href="#h147-0-241" id="h147-0-241" class="i">+                    textView.text = value.value()
</a><a href="#h147-0-242" id="h147-0-242" class="i">+
</a><a href="#h147-0-243" id="h147-0-243" class="i">+                    configItem.setOnClickListener {
</a><a href="#h147-0-244" id="h147-0-244" class="i">+                        val builder = AlertDialog.Builder(this)
</a><a href="#h147-0-245" id="h147-0-245" class="i">+                        builder.setTitle(propertyName)
</a><a href="#h147-0-246" id="h147-0-246" class="i">+
</a><a href="#h147-0-247" id="h147-0-247" class="i">+                        builder.setSingleChoiceItems(
</a><a href="#h147-0-248" id="h147-0-248" class="i">+                            value.keys().toTypedArray().map {
</a><a href="#h147-0-249" id="h147-0-249" class="i">+                                if (property.disableValueLocalization) it
</a><a href="#h147-0-250" id="h147-0-250" class="i">+                                else SharedContext.translation[property.getOptionTranslationKey(it)]
</a><a href="#h147-0-251" id="h147-0-251" class="i">+                            }.toTypedArray(),
</a><a href="#h147-0-252" id="h147-0-252" class="i">+                            value.keys().indexOf(value.value())
</a><a href="#h147-0-253" id="h147-0-253" class="i">+                        ) { _, which -&gt;
</a><a href="#h147-0-254" id="h147-0-254" class="i">+                            value.writeFrom(value.keys()[which])
</a><a href="#h147-0-255" id="h147-0-255" class="i">+                        }
</a><a href="#h147-0-256" id="h147-0-256" class="i">+
</a><a href="#h147-0-257" id="h147-0-257" class="i">+                        builder.setPositiveButton(itemHelper.positiveButtonText) { _, _ -&gt;
</a><a href="#h147-0-258" id="h147-0-258" class="i">+                            textView.text = value.value()
</a><a href="#h147-0-259" id="h147-0-259" class="i">+                        }
</a><a href="#h147-0-260" id="h147-0-260" class="i">+
</a><a href="#h147-0-261" id="h147-0-261" class="i">+                        builder.show()
</a><a href="#h147-0-262" id="h147-0-262" class="i">+                    }
</a><a href="#h147-0-263" id="h147-0-263" class="i">+                    addValueView(textView)
</a><a href="#h147-0-264" id="h147-0-264" class="i">+                }
</a><a href="#h147-0-265" id="h147-0-265" class="i">+            }
</a><a href="#h147-0-266" id="h147-0-266" class="i">+
</a><a href="#h147-0-267" id="h147-0-267" class="i">+            propertyListLayout.addView(configItem)
</a><a href="#h147-0-268" id="h147-0-268" class="i">+            addSeparator()
</a><a href="#h147-0-269" id="h147-0-269" class="i">+        }
</a><a href="#h147-0-270" id="h147-0-270" class="i">+
</a><a href="#h147-0-271" id="h147-0-271" class="i">+        propertyListLayout.addView(layoutInflater.inflate(R.layout.config_activity_debug_item, propertyListLayout, false).apply {
</a><a href="#h147-0-272" id="h147-0-272" class="i">+            findViewById&lt;TextView&gt;(R.id.debug_item_content).apply {
</a><a href="#h147-0-273" id="h147-0-273" class="i">+                text = Html.fromHtml(&quot;Made by rhunk on &lt;a href=\&quot;https://github.com/rhunk/SnapEnhance\&quot;&gt;GitHub&lt;/a&gt;&quot;, Html.FROM_HTML_MODE_COMPACT)
</a><a href="#h147-0-274" id="h147-0-274" class="i">+                movementMethod = android.text.method.LinkMovementMethod.getInstance()
</a><a href="#h147-0-275" id="h147-0-275" class="i">+            }
</a><a href="#h147-0-276" id="h147-0-276" class="i">+        })
</a><a href="#h147-0-277" id="h147-0-277" class="i">+    }
</a><a href="#h147-0-278" id="h147-0-278" class="i">+}</a><a href="#h147-0-279" id="h147-0-279" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h148" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DebugSettingsLayoutInflater.kt</a></b>
<a href="#h148-0" id="h148-0" class="h">@@ -0,0 +1,113 @@
</a><a href="#h148-0-0" id="h148-0-0" class="i">+package me.rhunk.snapenhance.ui.download
</a><a href="#h148-0-1" id="h148-0-1" class="i">+
</a><a href="#h148-0-2" id="h148-0-2" class="i">+import android.app.AlertDialog
</a><a href="#h148-0-3" id="h148-0-3" class="i">+import android.content.Intent
</a><a href="#h148-0-4" id="h148-0-4" class="i">+import android.view.View
</a><a href="#h148-0-5" id="h148-0-5" class="i">+import android.view.ViewGroup
</a><a href="#h148-0-6" id="h148-0-6" class="i">+import android.widget.ArrayAdapter
</a><a href="#h148-0-7" id="h148-0-7" class="i">+import android.widget.ImageButton
</a><a href="#h148-0-8" id="h148-0-8" class="i">+import android.widget.ListView
</a><a href="#h148-0-9" id="h148-0-9" class="i">+import android.widget.TextView
</a><a href="#h148-0-10" id="h148-0-10" class="i">+import android.widget.Toast
</a><a href="#h148-0-11" id="h148-0-11" class="i">+import me.rhunk.snapenhance.core.R
</a><a href="#h148-0-12" id="h148-0-12" class="i">+import me.rhunk.snapenhance.SharedContext
</a><a href="#h148-0-13" id="h148-0-13" class="i">+import me.rhunk.snapenhance.bridge.types.BridgeFileType
</a><a href="#h148-0-14" id="h148-0-14" class="i">+import me.rhunk.snapenhance.ui.config.ConfigActivity
</a><a href="#h148-0-15" id="h148-0-15" class="i">+import me.rhunk.snapenhance.ui.spoof.DeviceSpooferActivity
</a><a href="#h148-0-16" id="h148-0-16" class="i">+import java.io.File
</a><a href="#h148-0-17" id="h148-0-17" class="i">+
</a><a href="#h148-0-18" id="h148-0-18" class="i">+class ActionListAdapter(
</a><a href="#h148-0-19" id="h148-0-19" class="i">+    private val activity: DownloadManagerActivity,
</a><a href="#h148-0-20" id="h148-0-20" class="i">+    private val layoutId: Int,
</a><a href="#h148-0-21" id="h148-0-21" class="i">+    private val actions: Array&lt;Pair&lt;String, () -&gt; Unit&gt;&gt;
</a><a href="#h148-0-22" id="h148-0-22" class="i">+) : ArrayAdapter&lt;Pair&lt;String, () -&gt; Unit&gt;&gt;(activity, layoutId, actions) {
</a><a href="#h148-0-23" id="h148-0-23" class="i">+    override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {
</a><a href="#h148-0-24" id="h148-0-24" class="i">+        val view = convertView ?: activity.layoutInflater.inflate(layoutId, parent, false)
</a><a href="#h148-0-25" id="h148-0-25" class="i">+        val action = actions[position]
</a><a href="#h148-0-26" id="h148-0-26" class="i">+        view.isClickable = true
</a><a href="#h148-0-27" id="h148-0-27" class="i">+
</a><a href="#h148-0-28" id="h148-0-28" class="i">+        view.findViewById&lt;TextView&gt;(R.id.feature_text).text = action.first
</a><a href="#h148-0-29" id="h148-0-29" class="i">+        view.setOnClickListener {
</a><a href="#h148-0-30" id="h148-0-30" class="i">+            action.second()
</a><a href="#h148-0-31" id="h148-0-31" class="i">+        }
</a><a href="#h148-0-32" id="h148-0-32" class="i">+
</a><a href="#h148-0-33" id="h148-0-33" class="i">+        return view
</a><a href="#h148-0-34" id="h148-0-34" class="i">+    }
</a><a href="#h148-0-35" id="h148-0-35" class="i">+}
</a><a href="#h148-0-36" id="h148-0-36" class="i">+
</a><a href="#h148-0-37" id="h148-0-37" class="i">+class DebugSettingsLayoutInflater(
</a><a href="#h148-0-38" id="h148-0-38" class="i">+    private val activity: DownloadManagerActivity
</a><a href="#h148-0-39" id="h148-0-39" class="i">+) {
</a><a href="#h148-0-40" id="h148-0-40" class="i">+    private fun confirmAction(title: String, message: String, action: () -&gt; Unit) {
</a><a href="#h148-0-41" id="h148-0-41" class="i">+        activity.runOnUiThread {
</a><a href="#h148-0-42" id="h148-0-42" class="i">+            AlertDialog.Builder(activity)
</a><a href="#h148-0-43" id="h148-0-43" class="i">+                .setTitle(title)
</a><a href="#h148-0-44" id="h148-0-44" class="i">+                .setMessage(message)
</a><a href="#h148-0-45" id="h148-0-45" class="i">+                .setPositiveButton(SharedContext.translation[&quot;button.positive&quot;]) { _, _ -&gt;
</a><a href="#h148-0-46" id="h148-0-46" class="i">+                    action()
</a><a href="#h148-0-47" id="h148-0-47" class="i">+                }
</a><a href="#h148-0-48" id="h148-0-48" class="i">+                .setNegativeButton(SharedContext.translation[&quot;button.negative&quot;]) { _, _ -&gt; }
</a><a href="#h148-0-49" id="h148-0-49" class="i">+                .show()
</a><a href="#h148-0-50" id="h148-0-50" class="i">+        }
</a><a href="#h148-0-51" id="h148-0-51" class="i">+    }
</a><a href="#h148-0-52" id="h148-0-52" class="i">+
</a><a href="#h148-0-53" id="h148-0-53" class="i">+    private fun showSuccessToast() {
</a><a href="#h148-0-54" id="h148-0-54" class="i">+        Toast.makeText(activity, &quot;Success&quot;, Toast.LENGTH_SHORT).show()
</a><a href="#h148-0-55" id="h148-0-55" class="i">+    }
</a><a href="#h148-0-56" id="h148-0-56" class="i">+
</a><a href="#h148-0-57" id="h148-0-57" class="i">+    fun inflate(parent: ViewGroup) {
</a><a href="#h148-0-58" id="h148-0-58" class="i">+        val debugSettingsLayout = activity.layoutInflater.inflate(R.layout.debug_settings_page, parent, false)
</a><a href="#h148-0-59" id="h148-0-59" class="i">+
</a><a href="#h148-0-60" id="h148-0-60" class="i">+        val debugSettingsTranslation = activity.translation.getCategory(&quot;debug_settings_page&quot;)
</a><a href="#h148-0-61" id="h148-0-61" class="i">+
</a><a href="#h148-0-62" id="h148-0-62" class="i">+        debugSettingsLayout.findViewById&lt;ImageButton&gt;(R.id.back_button).setOnClickListener {
</a><a href="#h148-0-63" id="h148-0-63" class="i">+            parent.removeView(debugSettingsLayout)
</a><a href="#h148-0-64" id="h148-0-64" class="i">+        }
</a><a href="#h148-0-65" id="h148-0-65" class="i">+
</a><a href="#h148-0-66" id="h148-0-66" class="i">+        debugSettingsLayout.findViewById&lt;TextView&gt;(R.id.title).text = activity.translation[&quot;debug_settings&quot;]
</a><a href="#h148-0-67" id="h148-0-67" class="i">+
</a><a href="#h148-0-68" id="h148-0-68" class="i">+        debugSettingsLayout.findViewById&lt;ListView&gt;(R.id.setting_page_list).apply {
</a><a href="#h148-0-69" id="h148-0-69" class="i">+            adapter = ActionListAdapter(activity, R.layout.debug_setting_item, mutableListOf&lt;Pair&lt;String, () -&gt; Unit&gt;&gt;().apply {
</a><a href="#h148-0-70" id="h148-0-70" class="i">+                add(SharedContext.translation[&quot;config_activity.title&quot;] to {
</a><a href="#h148-0-71" id="h148-0-71" class="i">+                    activity.startActivity(Intent(activity, ConfigActivity::class.java))
</a><a href="#h148-0-72" id="h148-0-72" class="i">+                })
</a><a href="#h148-0-73" id="h148-0-73" class="i">+                add(SharedContext.translation[&quot;spoof_activity.title&quot;] to {
</a><a href="#h148-0-74" id="h148-0-74" class="i">+                    activity.startActivity(Intent(activity, DeviceSpooferActivity::class.java))
</a><a href="#h148-0-75" id="h148-0-75" class="i">+                })
</a><a href="#h148-0-76" id="h148-0-76" class="i">+                add(debugSettingsTranslation[&quot;clear_cache_title&quot;] to {
</a><a href="#h148-0-77" id="h148-0-77" class="i">+                    context.cacheDir.listFiles()?.forEach {
</a><a href="#h148-0-78" id="h148-0-78" class="i">+                        it.deleteRecursively()
</a><a href="#h148-0-79" id="h148-0-79" class="i">+                    }
</a><a href="#h148-0-80" id="h148-0-80" class="i">+                    showSuccessToast()
</a><a href="#h148-0-81" id="h148-0-81" class="i">+                })
</a><a href="#h148-0-82" id="h148-0-82" class="i">+
</a><a href="#h148-0-83" id="h148-0-83" class="i">+                BridgeFileType.values().forEach { fileType -&gt;
</a><a href="#h148-0-84" id="h148-0-84" class="i">+                    val actionName = debugSettingsTranslation.format(&quot;clear_file_title&quot;, &quot;file_name&quot; to fileType.displayName)
</a><a href="#h148-0-85" id="h148-0-85" class="i">+                    add(actionName to {
</a><a href="#h148-0-86" id="h148-0-86" class="i">+                        confirmAction(actionName, debugSettingsTranslation.format(&quot;clear_file_confirmation&quot;, &quot;file_name&quot; to fileType.displayName)) {
</a><a href="#h148-0-87" id="h148-0-87" class="i">+                            fileType.resolve(context).deleteRecursively()
</a><a href="#h148-0-88" id="h148-0-88" class="i">+                            showSuccessToast()
</a><a href="#h148-0-89" id="h148-0-89" class="i">+                        }
</a><a href="#h148-0-90" id="h148-0-90" class="i">+                    })
</a><a href="#h148-0-91" id="h148-0-91" class="i">+                }
</a><a href="#h148-0-92" id="h148-0-92" class="i">+
</a><a href="#h148-0-93" id="h148-0-93" class="i">+                add(debugSettingsTranslation[&quot;reset_all_title&quot;] to {
</a><a href="#h148-0-94" id="h148-0-94" class="i">+                    confirmAction(debugSettingsTranslation[&quot;reset_all_title&quot;], debugSettingsTranslation[&quot;reset_all_confirmation&quot;]) {
</a><a href="#h148-0-95" id="h148-0-95" class="i">+                        arrayOf(context.cacheDir, context.filesDir, File(context.dataDir, &quot;databases&quot;), File(context.dataDir, &quot;shared_prefs&quot;)).forEach {
</a><a href="#h148-0-96" id="h148-0-96" class="i">+                            it.listFiles()?.forEach { file -&gt;
</a><a href="#h148-0-97" id="h148-0-97" class="i">+                                file.deleteRecursively()
</a><a href="#h148-0-98" id="h148-0-98" class="i">+                            }
</a><a href="#h148-0-99" id="h148-0-99" class="i">+                        }
</a><a href="#h148-0-100" id="h148-0-100" class="i">+                        showSuccessToast()
</a><a href="#h148-0-101" id="h148-0-101" class="i">+                    }
</a><a href="#h148-0-102" id="h148-0-102" class="i">+                })
</a><a href="#h148-0-103" id="h148-0-103" class="i">+            }.toTypedArray())
</a><a href="#h148-0-104" id="h148-0-104" class="i">+        }
</a><a href="#h148-0-105" id="h148-0-105" class="i">+
</a><a href="#h148-0-106" id="h148-0-106" class="i">+        activity.registerBackCallback {
</a><a href="#h148-0-107" id="h148-0-107" class="i">+            parent.removeView(debugSettingsLayout)
</a><a href="#h148-0-108" id="h148-0-108" class="i">+        }
</a><a href="#h148-0-109" id="h148-0-109" class="i">+
</a><a href="#h148-0-110" id="h148-0-110" class="i">+        parent.addView(debugSettingsLayout)
</a><a href="#h148-0-111" id="h148-0-111" class="i">+    }
</a><a href="#h148-0-112" id="h148-0-112" class="i">+}</a><a href="#h148-0-113" id="h148-0-113" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h149" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadListAdapter.kt</a></b>
<a href="#h149-0" id="h149-0" class="h">@@ -0,0 +1,242 @@
</a><a href="#h149-0-0" id="h149-0-0" class="i">+package me.rhunk.snapenhance.ui.download
</a><a href="#h149-0-1" id="h149-0-1" class="i">+
</a><a href="#h149-0-2" id="h149-0-2" class="i">+import android.annotation.SuppressLint
</a><a href="#h149-0-3" id="h149-0-3" class="i">+import android.content.Intent
</a><a href="#h149-0-4" id="h149-0-4" class="i">+import android.graphics.Bitmap
</a><a href="#h149-0-5" id="h149-0-5" class="i">+import android.graphics.BitmapFactory
</a><a href="#h149-0-6" id="h149-0-6" class="i">+import android.net.Uri
</a><a href="#h149-0-7" id="h149-0-7" class="i">+import android.os.Handler
</a><a href="#h149-0-8" id="h149-0-8" class="i">+import android.view.LayoutInflater
</a><a href="#h149-0-9" id="h149-0-9" class="i">+import android.view.View
</a><a href="#h149-0-10" id="h149-0-10" class="i">+import android.view.ViewGroup
</a><a href="#h149-0-11" id="h149-0-11" class="i">+import android.widget.Button
</a><a href="#h149-0-12" id="h149-0-12" class="i">+import android.widget.ImageView
</a><a href="#h149-0-13" id="h149-0-13" class="i">+import android.widget.TextView
</a><a href="#h149-0-14" id="h149-0-14" class="i">+import android.widget.Toast
</a><a href="#h149-0-15" id="h149-0-15" class="i">+import androidx.core.graphics.drawable.RoundedBitmapDrawableFactory
</a><a href="#h149-0-16" id="h149-0-16" class="i">+import androidx.recyclerview.widget.RecyclerView
</a><a href="#h149-0-17" id="h149-0-17" class="i">+import androidx.recyclerview.widget.RecyclerView.Adapter
</a><a href="#h149-0-18" id="h149-0-18" class="i">+import kotlinx.coroutines.CoroutineScope
</a><a href="#h149-0-19" id="h149-0-19" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h149-0-20" id="h149-0-20" class="i">+import kotlinx.coroutines.Job
</a><a href="#h149-0-21" id="h149-0-21" class="i">+import kotlinx.coroutines.job
</a><a href="#h149-0-22" id="h149-0-22" class="i">+import kotlinx.coroutines.launch
</a><a href="#h149-0-23" id="h149-0-23" class="i">+import kotlinx.coroutines.withTimeout
</a><a href="#h149-0-24" id="h149-0-24" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h149-0-25" id="h149-0-25" class="i">+import me.rhunk.snapenhance.core.R
</a><a href="#h149-0-26" id="h149-0-26" class="i">+import me.rhunk.snapenhance.SharedContext
</a><a href="#h149-0-27" id="h149-0-27" class="i">+import me.rhunk.snapenhance.data.FileType
</a><a href="#h149-0-28" id="h149-0-28" class="i">+import me.rhunk.snapenhance.download.data.PendingDownload
</a><a href="#h149-0-29" id="h149-0-29" class="i">+import me.rhunk.snapenhance.download.enums.DownloadStage
</a><a href="#h149-0-30" id="h149-0-30" class="i">+import me.rhunk.snapenhance.util.snap.PreviewUtils
</a><a href="#h149-0-31" id="h149-0-31" class="i">+import java.io.File
</a><a href="#h149-0-32" id="h149-0-32" class="i">+import java.io.FileInputStream
</a><a href="#h149-0-33" id="h149-0-33" class="i">+import java.net.URL
</a><a href="#h149-0-34" id="h149-0-34" class="i">+import kotlin.concurrent.thread
</a><a href="#h149-0-35" id="h149-0-35" class="i">+import kotlin.coroutines.coroutineContext
</a><a href="#h149-0-36" id="h149-0-36" class="i">+
</a><a href="#h149-0-37" id="h149-0-37" class="i">+class DownloadListAdapter(
</a><a href="#h149-0-38" id="h149-0-38" class="i">+    private val activity: DownloadManagerActivity,
</a><a href="#h149-0-39" id="h149-0-39" class="i">+    private val downloadList: MutableList&lt;PendingDownload&gt;
</a><a href="#h149-0-40" id="h149-0-40" class="i">+): Adapter&lt;DownloadListAdapter.ViewHolder&gt;() {
</a><a href="#h149-0-41" id="h149-0-41" class="i">+    private val coroutineScope = CoroutineScope(Dispatchers.IO)
</a><a href="#h149-0-42" id="h149-0-42" class="i">+    private val previewJobs = mutableMapOf&lt;Int, Job&gt;()
</a><a href="#h149-0-43" id="h149-0-43" class="i">+
</a><a href="#h149-0-44" id="h149-0-44" class="i">+    inner class ViewHolder(val view: View) : RecyclerView.ViewHolder(view) {
</a><a href="#h149-0-45" id="h149-0-45" class="i">+        val bitmojiIcon: ImageView = view.findViewById(R.id.bitmoji_icon)
</a><a href="#h149-0-46" id="h149-0-46" class="i">+        val title: TextView = view.findViewById(R.id.item_title)
</a><a href="#h149-0-47" id="h149-0-47" class="i">+        val subtitle: TextView = view.findViewById(R.id.item_subtitle)
</a><a href="#h149-0-48" id="h149-0-48" class="i">+        val status: TextView = view.findViewById(R.id.item_status)
</a><a href="#h149-0-49" id="h149-0-49" class="i">+        val actionButton: Button = view.findViewById(R.id.item_action_button)
</a><a href="#h149-0-50" id="h149-0-50" class="i">+        val radius by lazy {
</a><a href="#h149-0-51" id="h149-0-51" class="i">+            view.context.resources.getDimensionPixelSize(R.dimen.download_manager_item_preview_radius)
</a><a href="#h149-0-52" id="h149-0-52" class="i">+        }
</a><a href="#h149-0-53" id="h149-0-53" class="i">+        val viewWidth by lazy {
</a><a href="#h149-0-54" id="h149-0-54" class="i">+            view.resources.displayMetrics.widthPixels
</a><a href="#h149-0-55" id="h149-0-55" class="i">+        }
</a><a href="#h149-0-56" id="h149-0-56" class="i">+        val viewHeight by lazy {
</a><a href="#h149-0-57" id="h149-0-57" class="i">+            view.layoutParams.height
</a><a href="#h149-0-58" id="h149-0-58" class="i">+        }
</a><a href="#h149-0-59" id="h149-0-59" class="i">+    }
</a><a href="#h149-0-60" id="h149-0-60" class="i">+
</a><a href="#h149-0-61" id="h149-0-61" class="i">+    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
</a><a href="#h149-0-62" id="h149-0-62" class="i">+        return ViewHolder(LayoutInflater.from(parent.context).inflate(R.layout.download_manager_item, parent, false))
</a><a href="#h149-0-63" id="h149-0-63" class="i">+    }
</a><a href="#h149-0-64" id="h149-0-64" class="i">+
</a><a href="#h149-0-65" id="h149-0-65" class="i">+    override fun getItemCount(): Int {
</a><a href="#h149-0-66" id="h149-0-66" class="i">+        return downloadList.size
</a><a href="#h149-0-67" id="h149-0-67" class="i">+    }
</a><a href="#h149-0-68" id="h149-0-68" class="i">+
</a><a href="#h149-0-69" id="h149-0-69" class="i">+    @SuppressLint(&quot;Recycle&quot;)
</a><a href="#h149-0-70" id="h149-0-70" class="i">+    private suspend fun handlePreview(download: PendingDownload, holder: ViewHolder) {
</a><a href="#h149-0-71" id="h149-0-71" class="i">+        download.outputFile?.let {
</a><a href="#h149-0-72" id="h149-0-72" class="i">+            val uri = Uri.parse(it)
</a><a href="#h149-0-73" id="h149-0-73" class="i">+            runCatching {
</a><a href="#h149-0-74" id="h149-0-74" class="i">+                if (uri.scheme == &quot;content&quot;) {
</a><a href="#h149-0-75" id="h149-0-75" class="i">+                    val fileType = activity.contentResolver.openInputStream(uri)!!.use { stream -&gt;
</a><a href="#h149-0-76" id="h149-0-76" class="i">+                        FileType.fromInputStream(stream)
</a><a href="#h149-0-77" id="h149-0-77" class="i">+                    }
</a><a href="#h149-0-78" id="h149-0-78" class="i">+                    fileType to activity.contentResolver.openInputStream(uri)
</a><a href="#h149-0-79" id="h149-0-79" class="i">+                } else {
</a><a href="#h149-0-80" id="h149-0-80" class="i">+                    FileType.fromFile(File(it)) to FileInputStream(it)
</a><a href="#h149-0-81" id="h149-0-81" class="i">+                }
</a><a href="#h149-0-82" id="h149-0-82" class="i">+            }.getOrNull()
</a><a href="#h149-0-83" id="h149-0-83" class="i">+        }?.also { (fileType, assetStream) -&gt;
</a><a href="#h149-0-84" id="h149-0-84" class="i">+            val previewBitmap = assetStream?.use { stream -&gt;
</a><a href="#h149-0-85" id="h149-0-85" class="i">+                //don&#39;t preview files larger than 30MB
</a><a href="#h149-0-86" id="h149-0-86" class="i">+                if (stream.available() &gt; 30 * 1024 * 1024) return@also
</a><a href="#h149-0-87" id="h149-0-87" class="i">+
</a><a href="#h149-0-88" id="h149-0-88" class="i">+                val tempFile = File.createTempFile(&quot;preview&quot;, &quot;.${fileType.fileExtension}&quot;)
</a><a href="#h149-0-89" id="h149-0-89" class="i">+                tempFile.outputStream().use { output -&gt;
</a><a href="#h149-0-90" id="h149-0-90" class="i">+                    stream.copyTo(output)
</a><a href="#h149-0-91" id="h149-0-91" class="i">+                }
</a><a href="#h149-0-92" id="h149-0-92" class="i">+                runCatching {
</a><a href="#h149-0-93" id="h149-0-93" class="i">+                    PreviewUtils.createPreviewFromFile(tempFile)?.let { preview -&gt;
</a><a href="#h149-0-94" id="h149-0-94" class="i">+                        val offsetY = (preview.height / 2 - holder.viewHeight / 2).coerceAtLeast(0)
</a><a href="#h149-0-95" id="h149-0-95" class="i">+
</a><a href="#h149-0-96" id="h149-0-96" class="i">+                        Bitmap.createScaledBitmap(
</a><a href="#h149-0-97" id="h149-0-97" class="i">+                            Bitmap.createBitmap(
</a><a href="#h149-0-98" id="h149-0-98" class="i">+                                preview, 0, offsetY,
</a><a href="#h149-0-99" id="h149-0-99" class="i">+                                preview.width.coerceAtMost(holder.viewWidth),
</a><a href="#h149-0-100" id="h149-0-100" class="i">+                                preview.height.coerceAtMost(holder.viewHeight)
</a><a href="#h149-0-101" id="h149-0-101" class="i">+                            ),
</a><a href="#h149-0-102" id="h149-0-102" class="i">+                            holder.viewWidth,
</a><a href="#h149-0-103" id="h149-0-103" class="i">+                            holder.viewHeight,
</a><a href="#h149-0-104" id="h149-0-104" class="i">+                            false
</a><a href="#h149-0-105" id="h149-0-105" class="i">+                        )
</a><a href="#h149-0-106" id="h149-0-106" class="i">+                    }
</a><a href="#h149-0-107" id="h149-0-107" class="i">+                }.onFailure {
</a><a href="#h149-0-108" id="h149-0-108" class="i">+                    Logger.error(&quot;failed to create preview $fileType&quot;, it)
</a><a href="#h149-0-109" id="h149-0-109" class="i">+                }.also {
</a><a href="#h149-0-110" id="h149-0-110" class="i">+                    tempFile.delete()
</a><a href="#h149-0-111" id="h149-0-111" class="i">+                }.getOrNull()
</a><a href="#h149-0-112" id="h149-0-112" class="i">+            } ?: return@also
</a><a href="#h149-0-113" id="h149-0-113" class="i">+
</a><a href="#h149-0-114" id="h149-0-114" class="i">+            if (coroutineContext.job.isCancelled) return@also
</a><a href="#h149-0-115" id="h149-0-115" class="i">+            Handler(holder.view.context.mainLooper).post {
</a><a href="#h149-0-116" id="h149-0-116" class="i">+                holder.view.background = RoundedBitmapDrawableFactory.create(
</a><a href="#h149-0-117" id="h149-0-117" class="i">+                    holder.view.context.resources,
</a><a href="#h149-0-118" id="h149-0-118" class="i">+                    previewBitmap
</a><a href="#h149-0-119" id="h149-0-119" class="i">+                ).also {
</a><a href="#h149-0-120" id="h149-0-120" class="i">+                    it.cornerRadius = holder.radius.toFloat()
</a><a href="#h149-0-121" id="h149-0-121" class="i">+                }
</a><a href="#h149-0-122" id="h149-0-122" class="i">+            }
</a><a href="#h149-0-123" id="h149-0-123" class="i">+        }
</a><a href="#h149-0-124" id="h149-0-124" class="i">+    }
</a><a href="#h149-0-125" id="h149-0-125" class="i">+
</a><a href="#h149-0-126" id="h149-0-126" class="i">+    private fun updateViewHolder(download: PendingDownload, holder: ViewHolder) {
</a><a href="#h149-0-127" id="h149-0-127" class="i">+        holder.status.text = download.downloadStage.toString()
</a><a href="#h149-0-128" id="h149-0-128" class="i">+        holder.view.background = holder.view.context.getDrawable(R.drawable.download_manager_item_background)
</a><a href="#h149-0-129" id="h149-0-129" class="i">+
</a><a href="#h149-0-130" id="h149-0-130" class="i">+        coroutineScope.launch {
</a><a href="#h149-0-131" id="h149-0-131" class="i">+            withTimeout(2000) {
</a><a href="#h149-0-132" id="h149-0-132" class="i">+                handlePreview(download, holder)
</a><a href="#h149-0-133" id="h149-0-133" class="i">+            }
</a><a href="#h149-0-134" id="h149-0-134" class="i">+        }
</a><a href="#h149-0-135" id="h149-0-135" class="i">+
</a><a href="#h149-0-136" id="h149-0-136" class="i">+        val isSaved = download.downloadStage == DownloadStage.SAVED
</a><a href="#h149-0-137" id="h149-0-137" class="i">+        //if the download is in progress, the user can cancel it
</a><a href="#h149-0-138" id="h149-0-138" class="i">+        val canInteract = if (download.job != null) !download.downloadStage.isFinalStage || isSaved
</a><a href="#h149-0-139" id="h149-0-139" class="i">+        else isSaved
</a><a href="#h149-0-140" id="h149-0-140" class="i">+
</a><a href="#h149-0-141" id="h149-0-141" class="i">+        holder.status.visibility = if (isSaved) View.GONE else View.VISIBLE
</a><a href="#h149-0-142" id="h149-0-142" class="i">+
</a><a href="#h149-0-143" id="h149-0-143" class="i">+        with(holder.actionButton) {
</a><a href="#h149-0-144" id="h149-0-144" class="i">+            isEnabled = canInteract
</a><a href="#h149-0-145" id="h149-0-145" class="i">+            alpha = if (canInteract) 1f else 0.5f
</a><a href="#h149-0-146" id="h149-0-146" class="i">+            background = context.getDrawable(if (isSaved) R.drawable.action_button_success else R.drawable.action_button_cancel)
</a><a href="#h149-0-147" id="h149-0-147" class="i">+            setTextColor(context.getColor(if (isSaved) R.color.successColor else R.color.actionBarColor))
</a><a href="#h149-0-148" id="h149-0-148" class="i">+            text = if (isSaved)
</a><a href="#h149-0-149" id="h149-0-149" class="i">+                SharedContext.translation[&quot;button.open&quot;]
</a><a href="#h149-0-150" id="h149-0-150" class="i">+            else
</a><a href="#h149-0-151" id="h149-0-151" class="i">+                SharedContext.translation[&quot;button.cancel&quot;]
</a><a href="#h149-0-152" id="h149-0-152" class="i">+        }
</a><a href="#h149-0-153" id="h149-0-153" class="i">+    }
</a><a href="#h149-0-154" id="h149-0-154" class="i">+
</a><a href="#h149-0-155" id="h149-0-155" class="i">+    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
</a><a href="#h149-0-156" id="h149-0-156" class="i">+        val pendingDownload = downloadList[position]
</a><a href="#h149-0-157" id="h149-0-157" class="i">+
</a><a href="#h149-0-158" id="h149-0-158" class="i">+        pendingDownload.changeListener = { _, _ -&gt;
</a><a href="#h149-0-159" id="h149-0-159" class="i">+            Handler(holder.view.context.mainLooper).post {
</a><a href="#h149-0-160" id="h149-0-160" class="i">+                updateViewHolder(pendingDownload, holder)
</a><a href="#h149-0-161" id="h149-0-161" class="i">+                notifyItemChanged(position)
</a><a href="#h149-0-162" id="h149-0-162" class="i">+            }
</a><a href="#h149-0-163" id="h149-0-163" class="i">+        }
</a><a href="#h149-0-164" id="h149-0-164" class="i">+
</a><a href="#h149-0-165" id="h149-0-165" class="i">+        holder.bitmojiIcon.setImageResource(R.drawable.bitmoji_blank)
</a><a href="#h149-0-166" id="h149-0-166" class="i">+
</a><a href="#h149-0-167" id="h149-0-167" class="i">+        pendingDownload.metadata.iconUrl?.let { url -&gt;
</a><a href="#h149-0-168" id="h149-0-168" class="i">+            thread(start = true) {
</a><a href="#h149-0-169" id="h149-0-169" class="i">+                runCatching {
</a><a href="#h149-0-170" id="h149-0-170" class="i">+                    val iconBitmap = URL(url).openStream().use {
</a><a href="#h149-0-171" id="h149-0-171" class="i">+                        BitmapFactory.decodeStream(it)
</a><a href="#h149-0-172" id="h149-0-172" class="i">+                    }
</a><a href="#h149-0-173" id="h149-0-173" class="i">+                    Handler(holder.view.context.mainLooper).post {
</a><a href="#h149-0-174" id="h149-0-174" class="i">+                        holder.bitmojiIcon.setImageBitmap(iconBitmap)
</a><a href="#h149-0-175" id="h149-0-175" class="i">+                    }
</a><a href="#h149-0-176" id="h149-0-176" class="i">+                }
</a><a href="#h149-0-177" id="h149-0-177" class="i">+            }
</a><a href="#h149-0-178" id="h149-0-178" class="i">+        }
</a><a href="#h149-0-179" id="h149-0-179" class="i">+
</a><a href="#h149-0-180" id="h149-0-180" class="i">+        holder.title.visibility = View.GONE
</a><a href="#h149-0-181" id="h149-0-181" class="i">+        holder.subtitle.visibility = View.GONE
</a><a href="#h149-0-182" id="h149-0-182" class="i">+
</a><a href="#h149-0-183" id="h149-0-183" class="i">+        pendingDownload.metadata.mediaDisplayType?.let {
</a><a href="#h149-0-184" id="h149-0-184" class="i">+            holder.title.text = it
</a><a href="#h149-0-185" id="h149-0-185" class="i">+            holder.title.visibility = View.VISIBLE
</a><a href="#h149-0-186" id="h149-0-186" class="i">+        }
</a><a href="#h149-0-187" id="h149-0-187" class="i">+
</a><a href="#h149-0-188" id="h149-0-188" class="i">+        pendingDownload.metadata.mediaDisplaySource?.let {
</a><a href="#h149-0-189" id="h149-0-189" class="i">+            holder.subtitle.text = it
</a><a href="#h149-0-190" id="h149-0-190" class="i">+            holder.subtitle.visibility = View.VISIBLE
</a><a href="#h149-0-191" id="h149-0-191" class="i">+        }
</a><a href="#h149-0-192" id="h149-0-192" class="i">+
</a><a href="#h149-0-193" id="h149-0-193" class="i">+        holder.actionButton.setOnClickListener {
</a><a href="#h149-0-194" id="h149-0-194" class="i">+            if (pendingDownload.downloadStage != DownloadStage.SAVED) {
</a><a href="#h149-0-195" id="h149-0-195" class="i">+                pendingDownload.cancel()
</a><a href="#h149-0-196" id="h149-0-196" class="i">+                pendingDownload.downloadStage = DownloadStage.CANCELLED
</a><a href="#h149-0-197" id="h149-0-197" class="i">+                updateViewHolder(pendingDownload, holder)
</a><a href="#h149-0-198" id="h149-0-198" class="i">+                notifyItemChanged(position);
</a><a href="#h149-0-199" id="h149-0-199" class="i">+                return@setOnClickListener
</a><a href="#h149-0-200" id="h149-0-200" class="i">+            }
</a><a href="#h149-0-201" id="h149-0-201" class="i">+
</a><a href="#h149-0-202" id="h149-0-202" class="i">+            pendingDownload.outputFile?.let {
</a><a href="#h149-0-203" id="h149-0-203" class="i">+                fun showFileNotFound() {
</a><a href="#h149-0-204" id="h149-0-204" class="i">+                    Toast.makeText(holder.view.context, SharedContext.translation[&quot;download_manager_activity.file_not_found_toast&quot;], Toast.LENGTH_SHORT).show()
</a><a href="#h149-0-205" id="h149-0-205" class="i">+                }
</a><a href="#h149-0-206" id="h149-0-206" class="i">+
</a><a href="#h149-0-207" id="h149-0-207" class="i">+                val uri = Uri.parse(it)
</a><a href="#h149-0-208" id="h149-0-208" class="i">+                val fileType = runCatching {
</a><a href="#h149-0-209" id="h149-0-209" class="i">+                    if (uri.scheme == &quot;content&quot;) {
</a><a href="#h149-0-210" id="h149-0-210" class="i">+                        activity.contentResolver.openInputStream(uri)?.use { input -&gt;
</a><a href="#h149-0-211" id="h149-0-211" class="i">+                            FileType.fromInputStream(input)
</a><a href="#h149-0-212" id="h149-0-212" class="i">+                        } ?: run {
</a><a href="#h149-0-213" id="h149-0-213" class="i">+                            showFileNotFound()
</a><a href="#h149-0-214" id="h149-0-214" class="i">+                            return@setOnClickListener
</a><a href="#h149-0-215" id="h149-0-215" class="i">+                        }
</a><a href="#h149-0-216" id="h149-0-216" class="i">+                    } else {
</a><a href="#h149-0-217" id="h149-0-217" class="i">+                        val file = File(it)
</a><a href="#h149-0-218" id="h149-0-218" class="i">+                        if (!file.exists()) {
</a><a href="#h149-0-219" id="h149-0-219" class="i">+                            showFileNotFound()
</a><a href="#h149-0-220" id="h149-0-220" class="i">+                            return@setOnClickListener
</a><a href="#h149-0-221" id="h149-0-221" class="i">+                        }
</a><a href="#h149-0-222" id="h149-0-222" class="i">+                        FileType.fromFile(file)
</a><a href="#h149-0-223" id="h149-0-223" class="i">+                    }
</a><a href="#h149-0-224" id="h149-0-224" class="i">+                }.onFailure { exception -&gt;
</a><a href="#h149-0-225" id="h149-0-225" class="i">+                    Logger.error(&quot;Failed to open file&quot;, exception)
</a><a href="#h149-0-226" id="h149-0-226" class="i">+                }.getOrDefault(FileType.UNKNOWN)
</a><a href="#h149-0-227" id="h149-0-227" class="i">+                if (fileType == FileType.UNKNOWN) {
</a><a href="#h149-0-228" id="h149-0-228" class="i">+                    showFileNotFound()
</a><a href="#h149-0-229" id="h149-0-229" class="i">+                    return@setOnClickListener
</a><a href="#h149-0-230" id="h149-0-230" class="i">+                }
</a><a href="#h149-0-231" id="h149-0-231" class="i">+
</a><a href="#h149-0-232" id="h149-0-232" class="i">+                val intent = Intent(Intent.ACTION_VIEW)
</a><a href="#h149-0-233" id="h149-0-233" class="i">+                intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_GRANT_READ_URI_PERMISSION
</a><a href="#h149-0-234" id="h149-0-234" class="i">+                intent.setDataAndType(uri, fileType.mimeType)
</a><a href="#h149-0-235" id="h149-0-235" class="i">+                holder.view.context.startActivity(intent)
</a><a href="#h149-0-236" id="h149-0-236" class="i">+            }
</a><a href="#h149-0-237" id="h149-0-237" class="i">+        }
</a><a href="#h149-0-238" id="h149-0-238" class="i">+
</a><a href="#h149-0-239" id="h149-0-239" class="i">+        updateViewHolder(pendingDownload, holder)
</a><a href="#h149-0-240" id="h149-0-240" class="i">+    }
</a><a href="#h149-0-241" id="h149-0-241" class="i">+}</a><a href="#h149-0-242" id="h149-0-242" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h150" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/DownloadManagerActivity.kt</a></b>
<a href="#h150-0" id="h150-0" class="h">@@ -0,0 +1,214 @@
</a><a href="#h150-0-0" id="h150-0-0" class="i">+package me.rhunk.snapenhance.ui.download
</a><a href="#h150-0-1" id="h150-0-1" class="i">+
</a><a href="#h150-0-2" id="h150-0-2" class="i">+import android.annotation.SuppressLint
</a><a href="#h150-0-3" id="h150-0-3" class="i">+import android.app.Activity
</a><a href="#h150-0-4" id="h150-0-4" class="i">+import android.app.AlertDialog
</a><a href="#h150-0-5" id="h150-0-5" class="i">+import android.content.Context
</a><a href="#h150-0-6" id="h150-0-6" class="i">+import android.content.Intent
</a><a href="#h150-0-7" id="h150-0-7" class="i">+import android.net.Uri
</a><a href="#h150-0-8" id="h150-0-8" class="i">+import android.os.Bundle
</a><a href="#h150-0-9" id="h150-0-9" class="i">+import android.os.PowerManager
</a><a href="#h150-0-10" id="h150-0-10" class="i">+import android.provider.Settings
</a><a href="#h150-0-11" id="h150-0-11" class="i">+import android.view.View
</a><a href="#h150-0-12" id="h150-0-12" class="i">+import android.widget.Button
</a><a href="#h150-0-13" id="h150-0-13" class="i">+import android.widget.ImageButton
</a><a href="#h150-0-14" id="h150-0-14" class="i">+import android.widget.TextView
</a><a href="#h150-0-15" id="h150-0-15" class="i">+import androidx.recyclerview.widget.ItemTouchHelper
</a><a href="#h150-0-16" id="h150-0-16" class="i">+import androidx.recyclerview.widget.RecyclerView
</a><a href="#h150-0-17" id="h150-0-17" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h150-0-18" id="h150-0-18" class="i">+import me.rhunk.snapenhance.core.R
</a><a href="#h150-0-19" id="h150-0-19" class="i">+import me.rhunk.snapenhance.SharedContext
</a><a href="#h150-0-20" id="h150-0-20" class="i">+import me.rhunk.snapenhance.bridge.wrapper.TranslationWrapper
</a><a href="#h150-0-21" id="h150-0-21" class="i">+import me.rhunk.snapenhance.download.data.PendingDownload
</a><a href="#h150-0-22" id="h150-0-22" class="i">+
</a><a href="#h150-0-23" id="h150-0-23" class="i">+class DownloadManagerActivity : Activity() {
</a><a href="#h150-0-24" id="h150-0-24" class="i">+    lateinit var translation: TranslationWrapper
</a><a href="#h150-0-25" id="h150-0-25" class="i">+
</a><a href="#h150-0-26" id="h150-0-26" class="i">+    private val backCallbacks = mutableListOf&lt;() -&gt; Unit&gt;()
</a><a href="#h150-0-27" id="h150-0-27" class="i">+    private val fetchedDownloadTasks = mutableListOf&lt;PendingDownload&gt;()
</a><a href="#h150-0-28" id="h150-0-28" class="i">+    private var listFilter = MediaFilter.NONE
</a><a href="#h150-0-29" id="h150-0-29" class="i">+
</a><a href="#h150-0-30" id="h150-0-30" class="i">+    private val preferences by lazy {
</a><a href="#h150-0-31" id="h150-0-31" class="i">+        getSharedPreferences(&quot;settings&quot;, Context.MODE_PRIVATE)
</a><a href="#h150-0-32" id="h150-0-32" class="i">+    }
</a><a href="#h150-0-33" id="h150-0-33" class="i">+
</a><a href="#h150-0-34" id="h150-0-34" class="i">+    private fun updateNoDownloadText() {
</a><a href="#h150-0-35" id="h150-0-35" class="i">+        findViewById&lt;TextView&gt;(R.id.no_download_title).let {
</a><a href="#h150-0-36" id="h150-0-36" class="i">+            it.text = translation[&quot;no_downloads&quot;]
</a><a href="#h150-0-37" id="h150-0-37" class="i">+            it.visibility = if (fetchedDownloadTasks.isEmpty()) View.VISIBLE else View.GONE
</a><a href="#h150-0-38" id="h150-0-38" class="i">+        }
</a><a href="#h150-0-39" id="h150-0-39" class="i">+    }
</a><a href="#h150-0-40" id="h150-0-40" class="i">+
</a><a href="#h150-0-41" id="h150-0-41" class="i">+    @SuppressLint(&quot;NotifyDataSetChanged&quot;)
</a><a href="#h150-0-42" id="h150-0-42" class="i">+    private fun updateListContent() {
</a><a href="#h150-0-43" id="h150-0-43" class="i">+        fetchedDownloadTasks.clear()
</a><a href="#h150-0-44" id="h150-0-44" class="i">+        fetchedDownloadTasks.addAll(SharedContext.downloadTaskManager.queryAllTasks(filter = listFilter).values)
</a><a href="#h150-0-45" id="h150-0-45" class="i">+
</a><a href="#h150-0-46" id="h150-0-46" class="i">+        with(findViewById&lt;RecyclerView&gt;(R.id.download_list)) {
</a><a href="#h150-0-47" id="h150-0-47" class="i">+            adapter?.notifyDataSetChanged()
</a><a href="#h150-0-48" id="h150-0-48" class="i">+            scrollToPosition(0)
</a><a href="#h150-0-49" id="h150-0-49" class="i">+        }
</a><a href="#h150-0-50" id="h150-0-50" class="i">+        updateNoDownloadText()
</a><a href="#h150-0-51" id="h150-0-51" class="i">+    }
</a><a href="#h150-0-52" id="h150-0-52" class="i">+
</a><a href="#h150-0-53" id="h150-0-53" class="i">+    @Deprecated(&quot;Deprecated in Java&quot;)
</a><a href="#h150-0-54" id="h150-0-54" class="i">+    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h150-0-55" id="h150-0-55" class="i">+    override fun onBackPressed() {
</a><a href="#h150-0-56" id="h150-0-56" class="i">+        backCallbacks.lastOrNull()?.let {
</a><a href="#h150-0-57" id="h150-0-57" class="i">+            it()
</a><a href="#h150-0-58" id="h150-0-58" class="i">+            backCallbacks.removeLast()
</a><a href="#h150-0-59" id="h150-0-59" class="i">+        } ?: super.onBackPressed()
</a><a href="#h150-0-60" id="h150-0-60" class="i">+    }
</a><a href="#h150-0-61" id="h150-0-61" class="i">+
</a><a href="#h150-0-62" id="h150-0-62" class="i">+    fun registerBackCallback(callback: () -&gt; Unit) {
</a><a href="#h150-0-63" id="h150-0-63" class="i">+        backCallbacks.add(callback)
</a><a href="#h150-0-64" id="h150-0-64" class="i">+    }
</a><a href="#h150-0-65" id="h150-0-65" class="i">+
</a><a href="#h150-0-66" id="h150-0-66" class="i">+    @SuppressLint(&quot;BatteryLife&quot;, &quot;NotifyDataSetChanged&quot;, &quot;SetTextI18n&quot;)
</a><a href="#h150-0-67" id="h150-0-67" class="i">+    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h150-0-68" id="h150-0-68" class="i">+        super.onCreate(savedInstanceState)
</a><a href="#h150-0-69" id="h150-0-69" class="i">+        SharedContext.ensureInitialized(this)
</a><a href="#h150-0-70" id="h150-0-70" class="i">+        translation = SharedContext.translation.getCategory(&quot;download_manager_activity&quot;)
</a><a href="#h150-0-71" id="h150-0-71" class="i">+        
</a><a href="#h150-0-72" id="h150-0-72" class="i">+        setContentView(R.layout.download_manager_activity)
</a><a href="#h150-0-73" id="h150-0-73" class="i">+        
</a><a href="#h150-0-74" id="h150-0-74" class="i">+        findViewById&lt;TextView&gt;(R.id.title).text = resources.getString(R.string.app_name) + &quot; &quot; + BuildConfig.VERSION_NAME
</a><a href="#h150-0-75" id="h150-0-75" class="i">+
</a><a href="#h150-0-76" id="h150-0-76" class="i">+        findViewById&lt;ImageButton&gt;(R.id.debug_settings_button).setOnClickListener {
</a><a href="#h150-0-77" id="h150-0-77" class="i">+            DebugSettingsLayoutInflater(this).inflate(findViewById(android.R.id.content))
</a><a href="#h150-0-78" id="h150-0-78" class="i">+        }
</a><a href="#h150-0-79" id="h150-0-79" class="i">+        
</a><a href="#h150-0-80" id="h150-0-80" class="i">+        with(findViewById&lt;RecyclerView&gt;(R.id.download_list)) {
</a><a href="#h150-0-81" id="h150-0-81" class="i">+            layoutManager = androidx.recyclerview.widget.LinearLayoutManager(this@DownloadManagerActivity)
</a><a href="#h150-0-82" id="h150-0-82" class="i">+
</a><a href="#h150-0-83" id="h150-0-83" class="i">+            adapter = DownloadListAdapter(this@DownloadManagerActivity, fetchedDownloadTasks).apply {
</a><a href="#h150-0-84" id="h150-0-84" class="i">+                registerAdapterDataObserver(object : RecyclerView.AdapterDataObserver() {
</a><a href="#h150-0-85" id="h150-0-85" class="i">+                    override fun onItemRangeRemoved(positionStart: Int, itemCount: Int) {
</a><a href="#h150-0-86" id="h150-0-86" class="i">+                        updateNoDownloadText()
</a><a href="#h150-0-87" id="h150-0-87" class="i">+                    }
</a><a href="#h150-0-88" id="h150-0-88" class="i">+                })
</a><a href="#h150-0-89" id="h150-0-89" class="i">+            }
</a><a href="#h150-0-90" id="h150-0-90" class="i">+
</a><a href="#h150-0-91" id="h150-0-91" class="i">+            ItemTouchHelper(object : ItemTouchHelper.SimpleCallback(0, ItemTouchHelper.LEFT or ItemTouchHelper.RIGHT) {
</a><a href="#h150-0-92" id="h150-0-92" class="i">+                override fun getMovementFlags(
</a><a href="#h150-0-93" id="h150-0-93" class="i">+                    recyclerView: RecyclerView,
</a><a href="#h150-0-94" id="h150-0-94" class="i">+                    viewHolder: RecyclerView.ViewHolder
</a><a href="#h150-0-95" id="h150-0-95" class="i">+                ): Int {
</a><a href="#h150-0-96" id="h150-0-96" class="i">+                    val download = fetchedDownloadTasks[viewHolder.absoluteAdapterPosition]
</a><a href="#h150-0-97" id="h150-0-97" class="i">+                    return if (download.isJobActive()) {
</a><a href="#h150-0-98" id="h150-0-98" class="i">+                        0
</a><a href="#h150-0-99" id="h150-0-99" class="i">+                    } else {
</a><a href="#h150-0-100" id="h150-0-100" class="i">+                        super.getMovementFlags(recyclerView, viewHolder)
</a><a href="#h150-0-101" id="h150-0-101" class="i">+                    }
</a><a href="#h150-0-102" id="h150-0-102" class="i">+                }
</a><a href="#h150-0-103" id="h150-0-103" class="i">+
</a><a href="#h150-0-104" id="h150-0-104" class="i">+                override fun onMove(
</a><a href="#h150-0-105" id="h150-0-105" class="i">+                    recyclerView: RecyclerView,
</a><a href="#h150-0-106" id="h150-0-106" class="i">+                    viewHolder: RecyclerView.ViewHolder,
</a><a href="#h150-0-107" id="h150-0-107" class="i">+                    target: RecyclerView.ViewHolder
</a><a href="#h150-0-108" id="h150-0-108" class="i">+                ): Boolean {
</a><a href="#h150-0-109" id="h150-0-109" class="i">+                    return false
</a><a href="#h150-0-110" id="h150-0-110" class="i">+                }
</a><a href="#h150-0-111" id="h150-0-111" class="i">+
</a><a href="#h150-0-112" id="h150-0-112" class="i">+                @SuppressLint(&quot;NotifyDataSetChanged&quot;)
</a><a href="#h150-0-113" id="h150-0-113" class="i">+                override fun onSwiped(viewHolder: RecyclerView.ViewHolder, direction: Int) {
</a><a href="#h150-0-114" id="h150-0-114" class="i">+                    fetchedDownloadTasks.removeAt(viewHolder.absoluteAdapterPosition).let {
</a><a href="#h150-0-115" id="h150-0-115" class="i">+                        SharedContext.downloadTaskManager.removeTask(it)
</a><a href="#h150-0-116" id="h150-0-116" class="i">+                    }
</a><a href="#h150-0-117" id="h150-0-117" class="i">+                    adapter?.notifyItemRemoved(viewHolder.absoluteAdapterPosition)
</a><a href="#h150-0-118" id="h150-0-118" class="i">+                }
</a><a href="#h150-0-119" id="h150-0-119" class="i">+            }).attachToRecyclerView(this)
</a><a href="#h150-0-120" id="h150-0-120" class="i">+
</a><a href="#h150-0-121" id="h150-0-121" class="i">+            var isLoading = false
</a><a href="#h150-0-122" id="h150-0-122" class="i">+
</a><a href="#h150-0-123" id="h150-0-123" class="i">+            addOnScrollListener(object : RecyclerView.OnScrollListener() {
</a><a href="#h150-0-124" id="h150-0-124" class="i">+                override fun onScrollStateChanged(recyclerView: RecyclerView, newState: Int) {
</a><a href="#h150-0-125" id="h150-0-125" class="i">+                    val layoutManager = recyclerView.layoutManager as androidx.recyclerview.widget.LinearLayoutManager
</a><a href="#h150-0-126" id="h150-0-126" class="i">+                    val lastVisibleItemPosition = layoutManager.findLastVisibleItemPosition()
</a><a href="#h150-0-127" id="h150-0-127" class="i">+
</a><a href="#h150-0-128" id="h150-0-128" class="i">+                    if (lastVisibleItemPosition == RecyclerView.NO_POSITION) {
</a><a href="#h150-0-129" id="h150-0-129" class="i">+                        return
</a><a href="#h150-0-130" id="h150-0-130" class="i">+                    }
</a><a href="#h150-0-131" id="h150-0-131" class="i">+
</a><a href="#h150-0-132" id="h150-0-132" class="i">+                    if (lastVisibleItemPosition == fetchedDownloadTasks.size - 1 &amp;&amp; !isLoading) {
</a><a href="#h150-0-133" id="h150-0-133" class="i">+                        isLoading = true
</a><a href="#h150-0-134" id="h150-0-134" class="i">+
</a><a href="#h150-0-135" id="h150-0-135" class="i">+                        SharedContext.downloadTaskManager.queryTasks(fetchedDownloadTasks.last().downloadId, filter = listFilter).forEach {
</a><a href="#h150-0-136" id="h150-0-136" class="i">+                            fetchedDownloadTasks.add(it.value)
</a><a href="#h150-0-137" id="h150-0-137" class="i">+                            adapter?.notifyItemInserted(fetchedDownloadTasks.size - 1)
</a><a href="#h150-0-138" id="h150-0-138" class="i">+                        }
</a><a href="#h150-0-139" id="h150-0-139" class="i">+
</a><a href="#h150-0-140" id="h150-0-140" class="i">+                        isLoading = false
</a><a href="#h150-0-141" id="h150-0-141" class="i">+                    }
</a><a href="#h150-0-142" id="h150-0-142" class="i">+                }
</a><a href="#h150-0-143" id="h150-0-143" class="i">+            })
</a><a href="#h150-0-144" id="h150-0-144" class="i">+    
</a><a href="#h150-0-145" id="h150-0-145" class="i">+            arrayOf(
</a><a href="#h150-0-146" id="h150-0-146" class="i">+                Pair(R.id.all_category, MediaFilter.NONE),
</a><a href="#h150-0-147" id="h150-0-147" class="i">+                Pair(R.id.pending_category, MediaFilter.PENDING),
</a><a href="#h150-0-148" id="h150-0-148" class="i">+                Pair(R.id.snap_category, MediaFilter.CHAT_MEDIA),
</a><a href="#h150-0-149" id="h150-0-149" class="i">+                Pair(R.id.story_category, MediaFilter.STORY),
</a><a href="#h150-0-150" id="h150-0-150" class="i">+                Pair(R.id.spotlight_category, MediaFilter.SPOTLIGHT)
</a><a href="#h150-0-151" id="h150-0-151" class="i">+            ).let { categoryPairs -&gt;
</a><a href="#h150-0-152" id="h150-0-152" class="i">+                categoryPairs.forEach { pair -&gt;
</a><a href="#h150-0-153" id="h150-0-153" class="i">+                    this@DownloadManagerActivity.findViewById&lt;TextView&gt;(pair.first).apply {
</a><a href="#h150-0-154" id="h150-0-154" class="i">+                        text = translation[&quot;category.${resources.getResourceEntryName(pair.first)}&quot;]
</a><a href="#h150-0-155" id="h150-0-155" class="i">+                    }.setOnClickListener { view -&gt;
</a><a href="#h150-0-156" id="h150-0-156" class="i">+                        listFilter = pair.second
</a><a href="#h150-0-157" id="h150-0-157" class="i">+                        updateListContent()
</a><a href="#h150-0-158" id="h150-0-158" class="i">+                        categoryPairs.map { this@DownloadManagerActivity.findViewById&lt;TextView&gt;(it.first) }.forEach {
</a><a href="#h150-0-159" id="h150-0-159" class="i">+                            it.setTextColor(getColor(R.color.primaryText))
</a><a href="#h150-0-160" id="h150-0-160" class="i">+                        }
</a><a href="#h150-0-161" id="h150-0-161" class="i">+                        (view as TextView).setTextColor(getColor(R.color.focusedCategoryColor))
</a><a href="#h150-0-162" id="h150-0-162" class="i">+                    }
</a><a href="#h150-0-163" id="h150-0-163" class="i">+                }
</a><a href="#h150-0-164" id="h150-0-164" class="i">+            }
</a><a href="#h150-0-165" id="h150-0-165" class="i">+
</a><a href="#h150-0-166" id="h150-0-166" class="i">+            this@DownloadManagerActivity.findViewById&lt;Button&gt;(R.id.remove_all_button).also {
</a><a href="#h150-0-167" id="h150-0-167" class="i">+                it.text = translation[&quot;remove_all&quot;]
</a><a href="#h150-0-168" id="h150-0-168" class="i">+            }.setOnClickListener {
</a><a href="#h150-0-169" id="h150-0-169" class="i">+                with(AlertDialog.Builder(this@DownloadManagerActivity)) {
</a><a href="#h150-0-170" id="h150-0-170" class="i">+                    setTitle(translation[&quot;remove_all_title&quot;])
</a><a href="#h150-0-171" id="h150-0-171" class="i">+                    setMessage(translation[&quot;remove_all_text&quot;])
</a><a href="#h150-0-172" id="h150-0-172" class="i">+                    setPositiveButton(SharedContext.translation[&quot;button.positive&quot;]) { _, _ -&gt;
</a><a href="#h150-0-173" id="h150-0-173" class="i">+                        SharedContext.downloadTaskManager.removeAllTasks()
</a><a href="#h150-0-174" id="h150-0-174" class="i">+                        fetchedDownloadTasks.removeIf {
</a><a href="#h150-0-175" id="h150-0-175" class="i">+                            if (it.isJobActive()) it.cancel()
</a><a href="#h150-0-176" id="h150-0-176" class="i">+                            true
</a><a href="#h150-0-177" id="h150-0-177" class="i">+                        }
</a><a href="#h150-0-178" id="h150-0-178" class="i">+                        adapter?.notifyDataSetChanged()
</a><a href="#h150-0-179" id="h150-0-179" class="i">+                        updateNoDownloadText()
</a><a href="#h150-0-180" id="h150-0-180" class="i">+                    }
</a><a href="#h150-0-181" id="h150-0-181" class="i">+                    setNegativeButton(SharedContext.translation[&quot;button.negative&quot;]) { dialog, _ -&gt;
</a><a href="#h150-0-182" id="h150-0-182" class="i">+                        dialog.dismiss()
</a><a href="#h150-0-183" id="h150-0-183" class="i">+                    }
</a><a href="#h150-0-184" id="h150-0-184" class="i">+                    show()
</a><a href="#h150-0-185" id="h150-0-185" class="i">+                }
</a><a href="#h150-0-186" id="h150-0-186" class="i">+            }
</a><a href="#h150-0-187" id="h150-0-187" class="i">+
</a><a href="#h150-0-188" id="h150-0-188" class="i">+        }
</a><a href="#h150-0-189" id="h150-0-189" class="i">+
</a><a href="#h150-0-190" id="h150-0-190" class="i">+        updateListContent()
</a><a href="#h150-0-191" id="h150-0-191" class="i">+
</a><a href="#h150-0-192" id="h150-0-192" class="i">+        if (!preferences.getBoolean(&quot;ask_battery_optimisations&quot;, true) ||
</a><a href="#h150-0-193" id="h150-0-193" class="i">+            !(getSystemService(Context.POWER_SERVICE) as PowerManager).isIgnoringBatteryOptimizations(packageName)) return
</a><a href="#h150-0-194" id="h150-0-194" class="i">+
</a><a href="#h150-0-195" id="h150-0-195" class="i">+        with(Intent()) {
</a><a href="#h150-0-196" id="h150-0-196" class="i">+            action = Settings.ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS
</a><a href="#h150-0-197" id="h150-0-197" class="i">+            data = Uri.parse(&quot;package:$packageName&quot;)
</a><a href="#h150-0-198" id="h150-0-198" class="i">+            startActivityForResult(this, 1)
</a><a href="#h150-0-199" id="h150-0-199" class="i">+        }
</a><a href="#h150-0-200" id="h150-0-200" class="i">+    }
</a><a href="#h150-0-201" id="h150-0-201" class="i">+
</a><a href="#h150-0-202" id="h150-0-202" class="i">+    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
</a><a href="#h150-0-203" id="h150-0-203" class="i">+        if (requestCode == 1) {
</a><a href="#h150-0-204" id="h150-0-204" class="i">+            preferences.edit().putBoolean(&quot;ask_battery_optimisations&quot;, false).apply()
</a><a href="#h150-0-205" id="h150-0-205" class="i">+        }
</a><a href="#h150-0-206" id="h150-0-206" class="i">+    }
</a><a href="#h150-0-207" id="h150-0-207" class="i">+
</a><a href="#h150-0-208" id="h150-0-208" class="i">+    @SuppressLint(&quot;NotifyDataSetChanged&quot;)
</a><a href="#h150-0-209" id="h150-0-209" class="i">+    override fun onResume() {
</a><a href="#h150-0-210" id="h150-0-210" class="i">+        super.onResume()
</a><a href="#h150-0-211" id="h150-0-211" class="i">+        updateListContent()
</a><a href="#h150-0-212" id="h150-0-212" class="i">+    }
</a><a href="#h150-0-213" id="h150-0-213" class="i">+}</a><a href="#h150-0-214" id="h150-0-214" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h151" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/download/MediaFilter.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/download/MediaFilter.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/download/MediaFilter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/download/MediaFilter.kt</a></b>
<b>diff --git a/<a id="h152" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/map/MapActivity.kt</a></b>
<a href="#h152-0" id="h152-0" class="h">@@ -0,0 +1,98 @@
</a><a href="#h152-0-0" id="h152-0-0" class="i">+package me.rhunk.snapenhance.ui.map
</a><a href="#h152-0-1" id="h152-0-1" class="i">+
</a><a href="#h152-0-2" id="h152-0-2" class="i">+import android.annotation.SuppressLint
</a><a href="#h152-0-3" id="h152-0-3" class="i">+import android.app.Activity
</a><a href="#h152-0-4" id="h152-0-4" class="i">+import android.app.AlertDialog
</a><a href="#h152-0-5" id="h152-0-5" class="i">+import android.content.Context
</a><a href="#h152-0-6" id="h152-0-6" class="i">+import android.os.Bundle
</a><a href="#h152-0-7" id="h152-0-7" class="i">+import android.view.MotionEvent
</a><a href="#h152-0-8" id="h152-0-8" class="i">+import android.widget.Button
</a><a href="#h152-0-9" id="h152-0-9" class="i">+import android.widget.EditText
</a><a href="#h152-0-10" id="h152-0-10" class="i">+import me.rhunk.snapenhance.core.R
</a><a href="#h152-0-11" id="h152-0-11" class="i">+import org.osmdroid.config.Configuration
</a><a href="#h152-0-12" id="h152-0-12" class="i">+import org.osmdroid.tileprovider.tilesource.TileSourceFactory
</a><a href="#h152-0-13" id="h152-0-13" class="i">+import org.osmdroid.util.GeoPoint
</a><a href="#h152-0-14" id="h152-0-14" class="i">+import org.osmdroid.views.MapView
</a><a href="#h152-0-15" id="h152-0-15" class="i">+import org.osmdroid.views.Projection
</a><a href="#h152-0-16" id="h152-0-16" class="i">+import org.osmdroid.views.overlay.Marker
</a><a href="#h152-0-17" id="h152-0-17" class="i">+import org.osmdroid.views.overlay.Overlay
</a><a href="#h152-0-18" id="h152-0-18" class="i">+
</a><a href="#h152-0-19" id="h152-0-19" class="i">+
</a><a href="#h152-0-20" id="h152-0-20" class="i">+class MapActivity : Activity() {
</a><a href="#h152-0-21" id="h152-0-21" class="i">+
</a><a href="#h152-0-22" id="h152-0-22" class="i">+    private lateinit var mapView: MapView
</a><a href="#h152-0-23" id="h152-0-23" class="i">+
</a><a href="#h152-0-24" id="h152-0-24" class="i">+    @SuppressLint(&quot;MissingInflatedId&quot;, &quot;ResourceType&quot;)
</a><a href="#h152-0-25" id="h152-0-25" class="i">+    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h152-0-26" id="h152-0-26" class="i">+        super.onCreate(savedInstanceState)
</a><a href="#h152-0-27" id="h152-0-27" class="i">+
</a><a href="#h152-0-28" id="h152-0-28" class="i">+        val contextBundle = intent.extras?.getBundle(&quot;location&quot;) ?: return
</a><a href="#h152-0-29" id="h152-0-29" class="i">+        val locationLatitude = contextBundle.getDouble(&quot;latitude&quot;)
</a><a href="#h152-0-30" id="h152-0-30" class="i">+        val locationLongitude = contextBundle.getDouble(&quot;longitude&quot;)
</a><a href="#h152-0-31" id="h152-0-31" class="i">+
</a><a href="#h152-0-32" id="h152-0-32" class="i">+        Configuration.getInstance().load(applicationContext, getSharedPreferences(&quot;osmdroid&quot;, Context.MODE_PRIVATE))
</a><a href="#h152-0-33" id="h152-0-33" class="i">+
</a><a href="#h152-0-34" id="h152-0-34" class="i">+        setContentView(R.layout.map)
</a><a href="#h152-0-35" id="h152-0-35" class="i">+
</a><a href="#h152-0-36" id="h152-0-36" class="i">+        mapView = findViewById(R.id.mapView)
</a><a href="#h152-0-37" id="h152-0-37" class="i">+        mapView.setMultiTouchControls(true);
</a><a href="#h152-0-38" id="h152-0-38" class="i">+        mapView.setTileSource(TileSourceFactory.MAPNIK)
</a><a href="#h152-0-39" id="h152-0-39" class="i">+
</a><a href="#h152-0-40" id="h152-0-40" class="i">+        val startPoint = GeoPoint(locationLatitude, locationLongitude)
</a><a href="#h152-0-41" id="h152-0-41" class="i">+        mapView.controller.setZoom(10.0)
</a><a href="#h152-0-42" id="h152-0-42" class="i">+        mapView.controller.setCenter(startPoint)
</a><a href="#h152-0-43" id="h152-0-43" class="i">+
</a><a href="#h152-0-44" id="h152-0-44" class="i">+        val marker = Marker(mapView)
</a><a href="#h152-0-45" id="h152-0-45" class="i">+        marker.isDraggable = true
</a><a href="#h152-0-46" id="h152-0-46" class="i">+        marker.position = startPoint
</a><a href="#h152-0-47" id="h152-0-47" class="i">+        marker.setAnchor(Marker.ANCHOR_CENTER, Marker.ANCHOR_BOTTOM)
</a><a href="#h152-0-48" id="h152-0-48" class="i">+
</a><a href="#h152-0-49" id="h152-0-49" class="i">+        mapView.overlays.add(object: Overlay() {
</a><a href="#h152-0-50" id="h152-0-50" class="i">+            override fun onSingleTapConfirmed(e: MotionEvent?, mapView: MapView?): Boolean {
</a><a href="#h152-0-51" id="h152-0-51" class="i">+                val proj: Projection = mapView!!.projection
</a><a href="#h152-0-52" id="h152-0-52" class="i">+                val loc = proj.fromPixels(e!!.x.toInt(), e.y.toInt()) as GeoPoint
</a><a href="#h152-0-53" id="h152-0-53" class="i">+                marker.position = loc
</a><a href="#h152-0-54" id="h152-0-54" class="i">+                mapView.invalidate()
</a><a href="#h152-0-55" id="h152-0-55" class="i">+                return true
</a><a href="#h152-0-56" id="h152-0-56" class="i">+            }
</a><a href="#h152-0-57" id="h152-0-57" class="i">+        })
</a><a href="#h152-0-58" id="h152-0-58" class="i">+
</a><a href="#h152-0-59" id="h152-0-59" class="i">+        mapView.overlays.add(marker)
</a><a href="#h152-0-60" id="h152-0-60" class="i">+
</a><a href="#h152-0-61" id="h152-0-61" class="i">+        val applyButton = findViewById&lt;Button&gt;(R.id.apply_location_button)
</a><a href="#h152-0-62" id="h152-0-62" class="i">+        applyButton.setOnClickListener {
</a><a href="#h152-0-63" id="h152-0-63" class="i">+            val bundle = Bundle()
</a><a href="#h152-0-64" id="h152-0-64" class="i">+            bundle.putFloat(&quot;latitude&quot;, marker.position.latitude.toFloat())
</a><a href="#h152-0-65" id="h152-0-65" class="i">+            bundle.putFloat(&quot;longitude&quot;, marker.position.longitude.toFloat())
</a><a href="#h152-0-66" id="h152-0-66" class="i">+            setResult(RESULT_OK, intent.putExtra(&quot;location&quot;, bundle))
</a><a href="#h152-0-67" id="h152-0-67" class="i">+            finish()
</a><a href="#h152-0-68" id="h152-0-68" class="i">+        }
</a><a href="#h152-0-69" id="h152-0-69" class="i">+
</a><a href="#h152-0-70" id="h152-0-70" class="i">+        val setPreciseLocationButton = findViewById&lt;Button&gt;(R.id.set_precise_location_button)
</a><a href="#h152-0-71" id="h152-0-71" class="i">+
</a><a href="#h152-0-72" id="h152-0-72" class="i">+        setPreciseLocationButton.setOnClickListener {
</a><a href="#h152-0-73" id="h152-0-73" class="i">+            val locationDialog = layoutInflater.inflate(R.layout.precise_location_dialog, null)
</a><a href="#h152-0-74" id="h152-0-74" class="i">+            val dialogLatitude = locationDialog.findViewById&lt;EditText&gt;(R.id.dialog_latitude).also { it.setText(marker.position.latitude.toString()) }
</a><a href="#h152-0-75" id="h152-0-75" class="i">+            val dialogLongitude = locationDialog.findViewById&lt;EditText&gt;(R.id.dialog_longitude).also { it.setText(marker.position.longitude.toString()) }
</a><a href="#h152-0-76" id="h152-0-76" class="i">+
</a><a href="#h152-0-77" id="h152-0-77" class="i">+            AlertDialog.Builder(this)
</a><a href="#h152-0-78" id="h152-0-78" class="i">+                .setView(locationDialog)
</a><a href="#h152-0-79" id="h152-0-79" class="i">+                .setTitle(&quot;Set a precise location&quot;)
</a><a href="#h152-0-80" id="h152-0-80" class="i">+                .setPositiveButton(&quot;Set&quot;) { _, _ -&gt;
</a><a href="#h152-0-81" id="h152-0-81" class="i">+                    val latitude = dialogLatitude.text.toString().toDoubleOrNull()
</a><a href="#h152-0-82" id="h152-0-82" class="i">+                    val longitude = dialogLongitude.text.toString().toDoubleOrNull()
</a><a href="#h152-0-83" id="h152-0-83" class="i">+                    if (latitude != null &amp;&amp; longitude != null) {
</a><a href="#h152-0-84" id="h152-0-84" class="i">+                        val preciseLocation = GeoPoint(latitude, longitude)
</a><a href="#h152-0-85" id="h152-0-85" class="i">+                        mapView.controller.setCenter(preciseLocation)
</a><a href="#h152-0-86" id="h152-0-86" class="i">+                        marker.position = preciseLocation
</a><a href="#h152-0-87" id="h152-0-87" class="i">+                        mapView.invalidate()
</a><a href="#h152-0-88" id="h152-0-88" class="i">+                    }
</a><a href="#h152-0-89" id="h152-0-89" class="i">+                }.setNegativeButton(&quot;Cancel&quot;) { _, _ -&gt; }.show()
</a><a href="#h152-0-90" id="h152-0-90" class="i">+        }
</a><a href="#h152-0-91" id="h152-0-91" class="i">+    }
</a><a href="#h152-0-92" id="h152-0-92" class="i">+
</a><a href="#h152-0-93" id="h152-0-93" class="i">+    override fun onDestroy() {
</a><a href="#h152-0-94" id="h152-0-94" class="i">+        super.onDestroy()
</a><a href="#h152-0-95" id="h152-0-95" class="i">+        mapView.onDetach()
</a><a href="#h152-0-96" id="h152-0-96" class="i">+    }
</a><a href="#h152-0-97" id="h152-0-97" class="i">+}
</a><b>diff --git a/<a id="h153" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/AbstractMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/AbstractMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/AbstractMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/AbstractMenu.kt</a></b>
<b>diff --git a/<a id="h154" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/ChatActionMenu.kt</a></b>
<b>diff --git a/<a id="h155" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a></b>
<b>diff --git a/<a id="h156" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/MenuViewInjector.kt</a></b>
<b>diff --git a/<a id="h157" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/OperaContextActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/OperaContextActionMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/OperaContextActionMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/OperaContextActionMenu.kt</a></b>
<b>diff --git a/<a id="h158" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsGearInjector.kt</a></b>
<a href="#h158-0" id="h158-0" class="h">@@ -0,0 +1,86 @@
</a><a href="#h158-0-0" id="h158-0-0" class="i">+package me.rhunk.snapenhance.ui.menu.impl
</a><a href="#h158-0-1" id="h158-0-1" class="i">+
</a><a href="#h158-0-2" id="h158-0-2" class="i">+import android.annotation.SuppressLint
</a><a href="#h158-0-3" id="h158-0-3" class="i">+import android.content.Intent
</a><a href="#h158-0-4" id="h158-0-4" class="i">+import android.view.View
</a><a href="#h158-0-5" id="h158-0-5" class="i">+import android.view.ViewGroup
</a><a href="#h158-0-6" id="h158-0-6" class="i">+import android.widget.FrameLayout
</a><a href="#h158-0-7" id="h158-0-7" class="i">+import android.widget.ImageView
</a><a href="#h158-0-8" id="h158-0-8" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h158-0-9" id="h158-0-9" class="i">+import me.rhunk.snapenhance.Constants
</a><a href="#h158-0-10" id="h158-0-10" class="i">+import me.rhunk.snapenhance.ui.config.ConfigActivity
</a><a href="#h158-0-11" id="h158-0-11" class="i">+import me.rhunk.snapenhance.ui.menu.AbstractMenu
</a><a href="#h158-0-12" id="h158-0-12" class="i">+import java.io.File
</a><a href="#h158-0-13" id="h158-0-13" class="i">+
</a><a href="#h158-0-14" id="h158-0-14" class="i">+
</a><a href="#h158-0-15" id="h158-0-15" class="i">+@SuppressLint(&quot;DiscouragedApi&quot;)
</a><a href="#h158-0-16" id="h158-0-16" class="i">+class SettingsGearInjector : AbstractMenu() {
</a><a href="#h158-0-17" id="h158-0-17" class="i">+    private val headerButtonOpaqueIconTint by lazy {
</a><a href="#h158-0-18" id="h158-0-18" class="i">+        context.resources.getIdentifier(&quot;headerButtonOpaqueIconTint&quot;, &quot;attr&quot;, Constants.SNAPCHAT_PACKAGE_NAME).let {
</a><a href="#h158-0-19" id="h158-0-19" class="i">+            context.androidContext.theme.obtainStyledAttributes(intArrayOf(it)).getColorStateList(0)
</a><a href="#h158-0-20" id="h158-0-20" class="i">+        }
</a><a href="#h158-0-21" id="h158-0-21" class="i">+    }
</a><a href="#h158-0-22" id="h158-0-22" class="i">+
</a><a href="#h158-0-23" id="h158-0-23" class="i">+    private val settingsSvg by lazy {
</a><a href="#h158-0-24" id="h158-0-24" class="i">+        context.resources.getIdentifier(&quot;svg_settings_32x32&quot;, &quot;drawable&quot;, Constants.SNAPCHAT_PACKAGE_NAME).let {
</a><a href="#h158-0-25" id="h158-0-25" class="i">+            context.resources.getDrawable(it, context.androidContext.theme)
</a><a href="#h158-0-26" id="h158-0-26" class="i">+        }
</a><a href="#h158-0-27" id="h158-0-27" class="i">+    }
</a><a href="#h158-0-28" id="h158-0-28" class="i">+
</a><a href="#h158-0-29" id="h158-0-29" class="i">+    private val ngsHovaHeaderSearchIconBackgroundMarginLeft by lazy {
</a><a href="#h158-0-30" id="h158-0-30" class="i">+        context.resources.getIdentifier(&quot;ngs_hova_header_search_icon_background_margin_left&quot;, &quot;dimen&quot;, Constants.SNAPCHAT_PACKAGE_NAME).let {
</a><a href="#h158-0-31" id="h158-0-31" class="i">+            context.resources.getDimensionPixelSize(it)
</a><a href="#h158-0-32" id="h158-0-32" class="i">+        }
</a><a href="#h158-0-33" id="h158-0-33" class="i">+    }
</a><a href="#h158-0-34" id="h158-0-34" class="i">+
</a><a href="#h158-0-35" id="h158-0-35" class="i">+    @SuppressLint(&quot;SetTextI18n&quot;, &quot;ClickableViewAccessibility&quot;)
</a><a href="#h158-0-36" id="h158-0-36" class="i">+    fun inject(parent: ViewGroup, child: View) {
</a><a href="#h158-0-37" id="h158-0-37" class="i">+        val firstView = (child as ViewGroup).getChildAt(0)
</a><a href="#h158-0-38" id="h158-0-38" class="i">+
</a><a href="#h158-0-39" id="h158-0-39" class="i">+        child.clipChildren = false
</a><a href="#h158-0-40" id="h158-0-40" class="i">+        child.addView(FrameLayout(parent.context).apply {
</a><a href="#h158-0-41" id="h158-0-41" class="i">+            layoutParams = FrameLayout.LayoutParams(firstView.layoutParams.width, firstView.layoutParams.height).apply {
</a><a href="#h158-0-42" id="h158-0-42" class="i">+                y = 0f
</a><a href="#h158-0-43" id="h158-0-43" class="i">+                x = -(ngsHovaHeaderSearchIconBackgroundMarginLeft + firstView.layoutParams.width).toFloat()
</a><a href="#h158-0-44" id="h158-0-44" class="i">+            }
</a><a href="#h158-0-45" id="h158-0-45" class="i">+
</a><a href="#h158-0-46" id="h158-0-46" class="i">+            isClickable = true
</a><a href="#h158-0-47" id="h158-0-47" class="i">+
</a><a href="#h158-0-48" id="h158-0-48" class="i">+            setOnClickListener {
</a><a href="#h158-0-49" id="h158-0-49" class="i">+                val intent = Intent().apply {
</a><a href="#h158-0-50" id="h158-0-50" class="i">+                    setClassName(BuildConfig.LIBRARY_PACKAGE_NAME, ConfigActivity::class.java.name)
</a><a href="#h158-0-51" id="h158-0-51" class="i">+                }
</a><a href="#h158-0-52" id="h158-0-52" class="i">+                intent.putExtra(&quot;lspatched&quot;, File(context.cacheDir, &quot;lspatch/origin&quot;).exists())
</a><a href="#h158-0-53" id="h158-0-53" class="i">+                context.startActivity(intent)
</a><a href="#h158-0-54" id="h158-0-54" class="i">+            }
</a><a href="#h158-0-55" id="h158-0-55" class="i">+
</a><a href="#h158-0-56" id="h158-0-56" class="i">+            parent.setOnTouchListener { _, event -&gt;
</a><a href="#h158-0-57" id="h158-0-57" class="i">+                if (child.visibility == View.INVISIBLE || child.alpha == 0F) return@setOnTouchListener false
</a><a href="#h158-0-58" id="h158-0-58" class="i">+
</a><a href="#h158-0-59" id="h158-0-59" class="i">+                val viewLocation = IntArray(2)
</a><a href="#h158-0-60" id="h158-0-60" class="i">+                getLocationOnScreen(viewLocation)
</a><a href="#h158-0-61" id="h158-0-61" class="i">+
</a><a href="#h158-0-62" id="h158-0-62" class="i">+                val x = event.rawX - viewLocation[0]
</a><a href="#h158-0-63" id="h158-0-63" class="i">+                val y = event.rawY - viewLocation[1]
</a><a href="#h158-0-64" id="h158-0-64" class="i">+
</a><a href="#h158-0-65" id="h158-0-65" class="i">+                if (x &gt; 0 &amp;&amp; x &lt; width &amp;&amp; y &gt; 0 &amp;&amp; y &lt; height) {
</a><a href="#h158-0-66" id="h158-0-66" class="i">+                    performClick()
</a><a href="#h158-0-67" id="h158-0-67" class="i">+                }
</a><a href="#h158-0-68" id="h158-0-68" class="i">+
</a><a href="#h158-0-69" id="h158-0-69" class="i">+                false
</a><a href="#h158-0-70" id="h158-0-70" class="i">+            }
</a><a href="#h158-0-71" id="h158-0-71" class="i">+            backgroundTintList = firstView.backgroundTintList
</a><a href="#h158-0-72" id="h158-0-72" class="i">+            background = firstView.background
</a><a href="#h158-0-73" id="h158-0-73" class="i">+
</a><a href="#h158-0-74" id="h158-0-74" class="i">+            addView(ImageView(context).apply {
</a><a href="#h158-0-75" id="h158-0-75" class="i">+                layoutParams = FrameLayout.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT, 17).apply {
</a><a href="#h158-0-76" id="h158-0-76" class="i">+                    gravity = android.view.Gravity.CENTER
</a><a href="#h158-0-77" id="h158-0-77" class="i">+                }
</a><a href="#h158-0-78" id="h158-0-78" class="i">+                setImageDrawable(settingsSvg)
</a><a href="#h158-0-79" id="h158-0-79" class="i">+                headerButtonOpaqueIconTint?.let {
</a><a href="#h158-0-80" id="h158-0-80" class="i">+                    imageTintList = it
</a><a href="#h158-0-81" id="h158-0-81" class="i">+                }
</a><a href="#h158-0-82" id="h158-0-82" class="i">+            })
</a><a href="#h158-0-83" id="h158-0-83" class="i">+        })
</a><a href="#h158-0-84" id="h158-0-84" class="i">+    }
</a><a href="#h158-0-85" id="h158-0-85" class="i">+}</a><a href="#h158-0-86" id="h158-0-86" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h159" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/SettingsMenu.kt</a></b>
<b>diff --git a/<a id="h160" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/spoof/DeviceSpooferActivity.kt</a></b>
<a href="#h160-0" id="h160-0" class="h">@@ -0,0 +1,111 @@
</a><a href="#h160-0-0" id="h160-0-0" class="i">+package me.rhunk.snapenhance.ui.spoof
</a><a href="#h160-0-1" id="h160-0-1" class="i">+
</a><a href="#h160-0-2" id="h160-0-2" class="i">+import android.app.Activity
</a><a href="#h160-0-3" id="h160-0-3" class="i">+import android.content.res.ColorStateList
</a><a href="#h160-0-4" id="h160-0-4" class="i">+import android.os.Bundle
</a><a href="#h160-0-5" id="h160-0-5" class="i">+import android.text.InputType
</a><a href="#h160-0-6" id="h160-0-6" class="i">+import android.view.View
</a><a href="#h160-0-7" id="h160-0-7" class="i">+import android.view.ViewGroup
</a><a href="#h160-0-8" id="h160-0-8" class="i">+import android.widget.ImageButton
</a><a href="#h160-0-9" id="h160-0-9" class="i">+import android.widget.Switch
</a><a href="#h160-0-10" id="h160-0-10" class="i">+import android.widget.TextView
</a><a href="#h160-0-11" id="h160-0-11" class="i">+import me.rhunk.snapenhance.core.R
</a><a href="#h160-0-12" id="h160-0-12" class="i">+import me.rhunk.snapenhance.SharedContext
</a><a href="#h160-0-13" id="h160-0-13" class="i">+import me.rhunk.snapenhance.config.ConfigCategory
</a><a href="#h160-0-14" id="h160-0-14" class="i">+import me.rhunk.snapenhance.config.impl.ConfigIntegerValue
</a><a href="#h160-0-15" id="h160-0-15" class="i">+import me.rhunk.snapenhance.config.impl.ConfigStateValue
</a><a href="#h160-0-16" id="h160-0-16" class="i">+import me.rhunk.snapenhance.config.impl.ConfigStringValue
</a><a href="#h160-0-17" id="h160-0-17" class="i">+import me.rhunk.snapenhance.ui.ItemHelper
</a><a href="#h160-0-18" id="h160-0-18" class="i">+
</a><a href="#h160-0-19" id="h160-0-19" class="i">+class DeviceSpooferActivity: Activity() {
</a><a href="#h160-0-20" id="h160-0-20" class="i">+    private val itemHelper = ItemHelper(this)
</a><a href="#h160-0-21" id="h160-0-21" class="i">+    
</a><a href="#h160-0-22" id="h160-0-22" class="i">+    override fun onCreate(savedInstanceState: Bundle?) {
</a><a href="#h160-0-23" id="h160-0-23" class="i">+        super.onCreate(savedInstanceState)
</a><a href="#h160-0-24" id="h160-0-24" class="i">+        SharedContext.ensureInitialized(this)
</a><a href="#h160-0-25" id="h160-0-25" class="i">+        setContentView(R.layout.device_spoofer_activity)
</a><a href="#h160-0-26" id="h160-0-26" class="i">+        
</a><a href="#h160-0-27" id="h160-0-27" class="i">+        findViewById&lt;TextView&gt;(R.id.title).text = &quot;Device Spoofer&quot;
</a><a href="#h160-0-28" id="h160-0-28" class="i">+        findViewById&lt;ImageButton&gt;(R.id.back_button).setOnClickListener { finish() }
</a><a href="#h160-0-29" id="h160-0-29" class="i">+        val propertyListLayout = findViewById&lt;ViewGroup&gt;(R.id.spoof_property_list)
</a><a href="#h160-0-30" id="h160-0-30" class="i">+        
</a><a href="#h160-0-31" id="h160-0-31" class="i">+        SharedContext.config.entries().filter { it.key.category == ConfigCategory.DEVICE_SPOOFER }.forEach { (property, value) -&gt;
</a><a href="#h160-0-32" id="h160-0-32" class="i">+            val configItem = layoutInflater.inflate(R.layout.config_activity_item, propertyListLayout, false)
</a><a href="#h160-0-33" id="h160-0-33" class="i">+            
</a><a href="#h160-0-34" id="h160-0-34" class="i">+            val propertyName = SharedContext.translation[&quot;property.${property.translationKey}.name&quot;]
</a><a href="#h160-0-35" id="h160-0-35" class="i">+            
</a><a href="#h160-0-36" id="h160-0-36" class="i">+            fun addSeparator() {
</a><a href="#h160-0-37" id="h160-0-37" class="i">+                //add separator
</a><a href="#h160-0-38" id="h160-0-38" class="i">+                propertyListLayout.addView(View(this).apply {
</a><a href="#h160-0-39" id="h160-0-39" class="i">+                    layoutParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, 1)
</a><a href="#h160-0-40" id="h160-0-40" class="i">+                    setBackgroundColor(getColor(R.color.tertiaryBackground))
</a><a href="#h160-0-41" id="h160-0-41" class="i">+                })
</a><a href="#h160-0-42" id="h160-0-42" class="i">+            }
</a><a href="#h160-0-43" id="h160-0-43" class="i">+            
</a><a href="#h160-0-44" id="h160-0-44" class="i">+            configItem.findViewById&lt;TextView&gt;(R.id.name).text = propertyName
</a><a href="#h160-0-45" id="h160-0-45" class="i">+            configItem.findViewById&lt;TextView&gt;(R.id.description).also {
</a><a href="#h160-0-46" id="h160-0-46" class="i">+                it.text = SharedContext.translation[&quot;property.${property.translationKey}.description&quot;]
</a><a href="#h160-0-47" id="h160-0-47" class="i">+                it.visibility = if (it.text.isEmpty()) View.GONE else View.VISIBLE
</a><a href="#h160-0-48" id="h160-0-48" class="i">+            }
</a><a href="#h160-0-49" id="h160-0-49" class="i">+        
</a><a href="#h160-0-50" id="h160-0-50" class="i">+            fun addValueView(view: View) {
</a><a href="#h160-0-51" id="h160-0-51" class="i">+                configItem.findViewById&lt;ViewGroup&gt;(R.id.value).addView(view)
</a><a href="#h160-0-52" id="h160-0-52" class="i">+            }
</a><a href="#h160-0-53" id="h160-0-53" class="i">+        
</a><a href="#h160-0-54" id="h160-0-54" class="i">+            when (value) {
</a><a href="#h160-0-55" id="h160-0-55" class="i">+                is ConfigStateValue -&gt; {
</a><a href="#h160-0-56" id="h160-0-56" class="i">+                    val switch = Switch(this)
</a><a href="#h160-0-57" id="h160-0-57" class="i">+                    switch.isChecked = value.value()
</a><a href="#h160-0-58" id="h160-0-58" class="i">+                    switch.trackTintList = ColorStateList(
</a><a href="#h160-0-59" id="h160-0-59" class="i">+                        arrayOf(
</a><a href="#h160-0-60" id="h160-0-60" class="i">+                            intArrayOf(android.R.attr.state_checked),
</a><a href="#h160-0-61" id="h160-0-61" class="i">+                            intArrayOf(-android.R.attr.state_checked)
</a><a href="#h160-0-62" id="h160-0-62" class="i">+                        ),
</a><a href="#h160-0-63" id="h160-0-63" class="i">+                        intArrayOf(
</a><a href="#h160-0-64" id="h160-0-64" class="i">+                            switch.highlightColor,
</a><a href="#h160-0-65" id="h160-0-65" class="i">+                            getColor(R.color.tertiaryBackground)
</a><a href="#h160-0-66" id="h160-0-66" class="i">+                        )
</a><a href="#h160-0-67" id="h160-0-67" class="i">+                    )
</a><a href="#h160-0-68" id="h160-0-68" class="i">+                    switch.setOnCheckedChangeListener { _, isChecked -&gt;
</a><a href="#h160-0-69" id="h160-0-69" class="i">+                        value.writeFrom(isChecked.toString())
</a><a href="#h160-0-70" id="h160-0-70" class="i">+                    }
</a><a href="#h160-0-71" id="h160-0-71" class="i">+                    configItem.setOnClickListener { switch.toggle() }
</a><a href="#h160-0-72" id="h160-0-72" class="i">+                    addValueView(switch)
</a><a href="#h160-0-73" id="h160-0-73" class="i">+                }
</a><a href="#h160-0-74" id="h160-0-74" class="i">+                is ConfigStringValue, is ConfigIntegerValue -&gt; {
</a><a href="#h160-0-75" id="h160-0-75" class="i">+                    val textView = itemHelper.createTranslatedTextView(property, shouldTranslatePropertyValue = false).also {
</a><a href="#h160-0-76" id="h160-0-76" class="i">+                        it.text = value.value().toString()
</a><a href="#h160-0-77" id="h160-0-77" class="i">+                    }
</a><a href="#h160-0-78" id="h160-0-78" class="i">+                    configItem.setOnClickListener {
</a><a href="#h160-0-79" id="h160-0-79" class="i">+                        if (value is ConfigIntegerValue) {
</a><a href="#h160-0-80" id="h160-0-80" class="i">+                            itemHelper.askForValue(property, InputType.TYPE_CLASS_NUMBER) {
</a><a href="#h160-0-81" id="h160-0-81" class="i">+                                try {
</a><a href="#h160-0-82" id="h160-0-82" class="i">+                                    value.writeFrom(it)
</a><a href="#h160-0-83" id="h160-0-83" class="i">+                                    textView.text = value.value().toString()
</a><a href="#h160-0-84" id="h160-0-84" class="i">+                                } catch (e: NumberFormatException) {
</a><a href="#h160-0-85" id="h160-0-85" class="i">+                                    itemHelper.longToast(SharedContext.translation[&quot;config_activity.invalid_number_toast&quot;], this)
</a><a href="#h160-0-86" id="h160-0-86" class="i">+                                }
</a><a href="#h160-0-87" id="h160-0-87" class="i">+                            }
</a><a href="#h160-0-88" id="h160-0-88" class="i">+                            return@setOnClickListener
</a><a href="#h160-0-89" id="h160-0-89" class="i">+                        }
</a><a href="#h160-0-90" id="h160-0-90" class="i">+                        itemHelper.askForValue(property, InputType.TYPE_CLASS_TEXT) {
</a><a href="#h160-0-91" id="h160-0-91" class="i">+                            value.writeFrom(it)
</a><a href="#h160-0-92" id="h160-0-92" class="i">+                            textView.text = value.value().toString()
</a><a href="#h160-0-93" id="h160-0-93" class="i">+                        }
</a><a href="#h160-0-94" id="h160-0-94" class="i">+                    }
</a><a href="#h160-0-95" id="h160-0-95" class="i">+                    addValueView(textView)
</a><a href="#h160-0-96" id="h160-0-96" class="i">+                }
</a><a href="#h160-0-97" id="h160-0-97" class="i">+            }
</a><a href="#h160-0-98" id="h160-0-98" class="i">+        
</a><a href="#h160-0-99" id="h160-0-99" class="i">+            propertyListLayout.addView(configItem)
</a><a href="#h160-0-100" id="h160-0-100" class="i">+            addSeparator()
</a><a href="#h160-0-101" id="h160-0-101" class="i">+        }
</a><a href="#h160-0-102" id="h160-0-102" class="i">+    }
</a><a href="#h160-0-103" id="h160-0-103" class="i">+    
</a><a href="#h160-0-104" id="h160-0-104" class="i">+    @Deprecated(&quot;Deprecated in Java&quot;)
</a><a href="#h160-0-105" id="h160-0-105" class="i">+    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h160-0-106" id="h160-0-106" class="i">+    override fun onBackPressed() {
</a><a href="#h160-0-107" id="h160-0-107" class="i">+        super.onBackPressed()
</a><a href="#h160-0-108" id="h160-0-108" class="i">+        finish()
</a><a href="#h160-0-109" id="h160-0-109" class="i">+    }
</a><a href="#h160-0-110" id="h160-0-110" class="i">+}</a><a href="#h160-0-111" id="h160-0-111" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h161" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt</a></b>
<b>diff --git a/<a id="h162" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt</a></b>
<b>diff --git a/<a id="h163" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/CallbackBuilder.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/CallbackBuilder.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/CallbackBuilder.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/CallbackBuilder.kt</a></b>
<b>diff --git a/<a id="h164" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ReflectionHelper.kt</a></b>
<b>diff --git a/<a id="h165" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/SQLiteDatabaseHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/SQLiteDatabaseHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/SQLiteDatabaseHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/SQLiteDatabaseHelper.kt</a></b>
<b>diff --git a/<a id="h166" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperMacros.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperMacros.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperMacros.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperMacros.kt</a></b>
<b>diff --git a/<a id="h167" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/download/DownloadServer.kt</a></b>
<b>diff --git a/<a id="h168" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/download/RemoteMediaResolver.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/download/RemoteMediaResolver.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/download/RemoteMediaResolver.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/download/RemoteMediaResolver.kt</a></b>
<b>diff --git a/<a id="h169" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a></b>
<a href="#h169-0" id="h169-0" class="h">@@ -0,0 +1,337 @@
</a><a href="#h169-0-0" id="h169-0-0" class="i">+package me.rhunk.snapenhance.util.export
</a><a href="#h169-0-1" id="h169-0-1" class="i">+
</a><a href="#h169-0-2" id="h169-0-2" class="i">+import android.content.pm.PackageManager
</a><a href="#h169-0-3" id="h169-0-3" class="i">+import android.os.Environment
</a><a href="#h169-0-4" id="h169-0-4" class="i">+import android.util.Base64InputStream
</a><a href="#h169-0-5" id="h169-0-5" class="i">+import com.google.gson.JsonArray
</a><a href="#h169-0-6" id="h169-0-6" class="i">+import com.google.gson.JsonObject
</a><a href="#h169-0-7" id="h169-0-7" class="i">+import de.robv.android.xposed.XposedHelpers
</a><a href="#h169-0-8" id="h169-0-8" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h169-0-9" id="h169-0-9" class="i">+import kotlinx.coroutines.async
</a><a href="#h169-0-10" id="h169-0-10" class="i">+import kotlinx.coroutines.awaitAll
</a><a href="#h169-0-11" id="h169-0-11" class="i">+import kotlinx.coroutines.withContext
</a><a href="#h169-0-12" id="h169-0-12" class="i">+import me.rhunk.snapenhance.core.BuildConfig
</a><a href="#h169-0-13" id="h169-0-13" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h169-0-14" id="h169-0-14" class="i">+import me.rhunk.snapenhance.ModContext
</a><a href="#h169-0-15" id="h169-0-15" class="i">+import me.rhunk.snapenhance.data.ContentType
</a><a href="#h169-0-16" id="h169-0-16" class="i">+import me.rhunk.snapenhance.data.FileType
</a><a href="#h169-0-17" id="h169-0-17" class="i">+import me.rhunk.snapenhance.data.MediaReferenceType
</a><a href="#h169-0-18" id="h169-0-18" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h169-0-19" id="h169-0-19" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a><a href="#h169-0-20" id="h169-0-20" class="i">+import me.rhunk.snapenhance.database.objects.FriendFeedInfo
</a><a href="#h169-0-21" id="h169-0-21" class="i">+import me.rhunk.snapenhance.database.objects.FriendInfo
</a><a href="#h169-0-22" id="h169-0-22" class="i">+import me.rhunk.snapenhance.util.getApplicationInfoCompat
</a><a href="#h169-0-23" id="h169-0-23" class="i">+import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a><a href="#h169-0-24" id="h169-0-24" class="i">+import me.rhunk.snapenhance.util.snap.EncryptionHelper
</a><a href="#h169-0-25" id="h169-0-25" class="i">+import me.rhunk.snapenhance.util.snap.MediaDownloaderHelper
</a><a href="#h169-0-26" id="h169-0-26" class="i">+import java.io.File
</a><a href="#h169-0-27" id="h169-0-27" class="i">+import java.io.FileOutputStream
</a><a href="#h169-0-28" id="h169-0-28" class="i">+import java.io.InputStream
</a><a href="#h169-0-29" id="h169-0-29" class="i">+import java.io.OutputStream
</a><a href="#h169-0-30" id="h169-0-30" class="i">+import java.text.SimpleDateFormat
</a><a href="#h169-0-31" id="h169-0-31" class="i">+import java.util.Base64
</a><a href="#h169-0-32" id="h169-0-32" class="i">+import java.util.Collections
</a><a href="#h169-0-33" id="h169-0-33" class="i">+import java.util.Date
</a><a href="#h169-0-34" id="h169-0-34" class="i">+import java.util.Locale
</a><a href="#h169-0-35" id="h169-0-35" class="i">+import java.util.zip.Deflater
</a><a href="#h169-0-36" id="h169-0-36" class="i">+import java.util.zip.DeflaterInputStream
</a><a href="#h169-0-37" id="h169-0-37" class="i">+import java.util.zip.ZipFile
</a><a href="#h169-0-38" id="h169-0-38" class="i">+import kotlin.io.encoding.ExperimentalEncodingApi
</a><a href="#h169-0-39" id="h169-0-39" class="i">+
</a><a href="#h169-0-40" id="h169-0-40" class="i">+
</a><a href="#h169-0-41" id="h169-0-41" class="i">+enum class ExportFormat(
</a><a href="#h169-0-42" id="h169-0-42" class="i">+    val extension: String,
</a><a href="#h169-0-43" id="h169-0-43" class="i">+){
</a><a href="#h169-0-44" id="h169-0-44" class="i">+    JSON(&quot;json&quot;),
</a><a href="#h169-0-45" id="h169-0-45" class="i">+    TEXT(&quot;txt&quot;),
</a><a href="#h169-0-46" id="h169-0-46" class="i">+    HTML(&quot;html&quot;);
</a><a href="#h169-0-47" id="h169-0-47" class="i">+}
</a><a href="#h169-0-48" id="h169-0-48" class="i">+
</a><a href="#h169-0-49" id="h169-0-49" class="i">+class MessageExporter(
</a><a href="#h169-0-50" id="h169-0-50" class="i">+    private val context: ModContext,
</a><a href="#h169-0-51" id="h169-0-51" class="i">+    private val outputFile: File,
</a><a href="#h169-0-52" id="h169-0-52" class="i">+    private val friendFeedInfo: FriendFeedInfo,
</a><a href="#h169-0-53" id="h169-0-53" class="i">+    private val mediaToDownload: List&lt;ContentType&gt;? = null,
</a><a href="#h169-0-54" id="h169-0-54" class="i">+    private val printLog: (String) -&gt; Unit = {},
</a><a href="#h169-0-55" id="h169-0-55" class="i">+) {
</a><a href="#h169-0-56" id="h169-0-56" class="i">+    private lateinit var conversationParticipants: Map&lt;String, FriendInfo&gt;
</a><a href="#h169-0-57" id="h169-0-57" class="i">+    private lateinit var messages: List&lt;Message&gt;
</a><a href="#h169-0-58" id="h169-0-58" class="i">+
</a><a href="#h169-0-59" id="h169-0-59" class="i">+    fun readMessages(messages: List&lt;Message&gt;) {
</a><a href="#h169-0-60" id="h169-0-60" class="i">+        conversationParticipants =
</a><a href="#h169-0-61" id="h169-0-61" class="i">+            context.database.getConversationParticipants(friendFeedInfo.key!!)
</a><a href="#h169-0-62" id="h169-0-62" class="i">+                ?.mapNotNull {
</a><a href="#h169-0-63" id="h169-0-63" class="i">+                    context.database.getFriendInfo(it)
</a><a href="#h169-0-64" id="h169-0-64" class="i">+                }?.associateBy { it.userId!! } ?: emptyMap()
</a><a href="#h169-0-65" id="h169-0-65" class="i">+
</a><a href="#h169-0-66" id="h169-0-66" class="i">+        if (conversationParticipants.isEmpty())
</a><a href="#h169-0-67" id="h169-0-67" class="i">+            throw Throwable(&quot;Failed to get conversation participants for ${friendFeedInfo.key}&quot;)
</a><a href="#h169-0-68" id="h169-0-68" class="i">+
</a><a href="#h169-0-69" id="h169-0-69" class="i">+        this.messages = messages.sortedBy { it.orderKey }
</a><a href="#h169-0-70" id="h169-0-70" class="i">+    }
</a><a href="#h169-0-71" id="h169-0-71" class="i">+
</a><a href="#h169-0-72" id="h169-0-72" class="i">+    private fun serializeMessageContent(message: Message): String? {
</a><a href="#h169-0-73" id="h169-0-73" class="i">+        return if (message.messageContent.contentType == ContentType.CHAT) {
</a><a href="#h169-0-74" id="h169-0-74" class="i">+            ProtoReader(message.messageContent.content).getString(2, 1) ?: &quot;Failed to parse message&quot;
</a><a href="#h169-0-75" id="h169-0-75" class="i">+        } else null
</a><a href="#h169-0-76" id="h169-0-76" class="i">+    }
</a><a href="#h169-0-77" id="h169-0-77" class="i">+
</a><a href="#h169-0-78" id="h169-0-78" class="i">+    private fun exportText(output: OutputStream) {
</a><a href="#h169-0-79" id="h169-0-79" class="i">+        val writer = output.bufferedWriter()
</a><a href="#h169-0-80" id="h169-0-80" class="i">+        writer.write(&quot;Conversation key: ${friendFeedInfo.key}\n&quot;)
</a><a href="#h169-0-81" id="h169-0-81" class="i">+        writer.write(&quot;Conversation Name: ${friendFeedInfo.feedDisplayName}\n&quot;)
</a><a href="#h169-0-82" id="h169-0-82" class="i">+        writer.write(&quot;Participants:\n&quot;)
</a><a href="#h169-0-83" id="h169-0-83" class="i">+        conversationParticipants.forEach { (userId, friendInfo) -&gt;
</a><a href="#h169-0-84" id="h169-0-84" class="i">+            writer.write(&quot;  $userId: ${friendInfo.displayName}\n&quot;)
</a><a href="#h169-0-85" id="h169-0-85" class="i">+        }
</a><a href="#h169-0-86" id="h169-0-86" class="i">+
</a><a href="#h169-0-87" id="h169-0-87" class="i">+        writer.write(&quot;\nMessages:\n&quot;)
</a><a href="#h169-0-88" id="h169-0-88" class="i">+        messages.forEach { message -&gt;
</a><a href="#h169-0-89" id="h169-0-89" class="i">+            val sender = conversationParticipants[message.senderId.toString()]
</a><a href="#h169-0-90" id="h169-0-90" class="i">+            val senderUsername = sender?.usernameForSorting ?: message.senderId.toString()
</a><a href="#h169-0-91" id="h169-0-91" class="i">+            val senderDisplayName = sender?.displayName ?: message.senderId.toString()
</a><a href="#h169-0-92" id="h169-0-92" class="i">+            val messageContent = serializeMessageContent(message) ?: message.messageContent.contentType.name
</a><a href="#h169-0-93" id="h169-0-93" class="i">+            val date = SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;, Locale.ENGLISH).format(Date(message.messageMetadata.createdAt))
</a><a href="#h169-0-94" id="h169-0-94" class="i">+            writer.write(&quot;[$date] - $senderDisplayName (${senderUsername}): $messageContent\n&quot;)
</a><a href="#h169-0-95" id="h169-0-95" class="i">+        }
</a><a href="#h169-0-96" id="h169-0-96" class="i">+        writer.flush()
</a><a href="#h169-0-97" id="h169-0-97" class="i">+    }
</a><a href="#h169-0-98" id="h169-0-98" class="i">+
</a><a href="#h169-0-99" id="h169-0-99" class="i">+    @OptIn(ExperimentalEncodingApi::class)
</a><a href="#h169-0-100" id="h169-0-100" class="i">+    suspend fun exportHtml(output: OutputStream) {
</a><a href="#h169-0-101" id="h169-0-101" class="i">+        val downloadMediaCacheFolder = File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS), &quot;SnapEnhance/cache&quot;).also { it.mkdirs() }
</a><a href="#h169-0-102" id="h169-0-102" class="i">+        val mediaFiles = Collections.synchronizedMap(mutableMapOf&lt;String, Pair&lt;FileType, File&gt;&gt;())
</a><a href="#h169-0-103" id="h169-0-103" class="i">+
</a><a href="#h169-0-104" id="h169-0-104" class="i">+        printLog(&quot;found ${messages.size} messages&quot;)
</a><a href="#h169-0-105" id="h169-0-105" class="i">+
</a><a href="#h169-0-106" id="h169-0-106" class="i">+        withContext(Dispatchers.IO) {
</a><a href="#h169-0-107" id="h169-0-107" class="i">+            messages.filter {
</a><a href="#h169-0-108" id="h169-0-108" class="i">+                mediaToDownload?.contains(it.messageContent.contentType) ?: false
</a><a href="#h169-0-109" id="h169-0-109" class="i">+            }.map { message -&gt;
</a><a href="#h169-0-110" id="h169-0-110" class="i">+                async {
</a><a href="#h169-0-111" id="h169-0-111" class="i">+                    val remoteMediaReferences by lazy {
</a><a href="#h169-0-112" id="h169-0-112" class="i">+                        val serializedMessageContent = context.gson.toJsonTree(message.messageContent.instanceNonNull()).asJsonObject
</a><a href="#h169-0-113" id="h169-0-113" class="i">+                        serializedMessageContent[&quot;mRemoteMediaReferences&quot;]
</a><a href="#h169-0-114" id="h169-0-114" class="i">+                            .asJsonArray.map { it.asJsonObject[&quot;mMediaReferences&quot;].asJsonArray }
</a><a href="#h169-0-115" id="h169-0-115" class="i">+                            .flatten()
</a><a href="#h169-0-116" id="h169-0-116" class="i">+                    }
</a><a href="#h169-0-117" id="h169-0-117" class="i">+
</a><a href="#h169-0-118" id="h169-0-118" class="i">+                    remoteMediaReferences.firstOrNull().takeIf { it != null }?.let { media -&gt;
</a><a href="#h169-0-119" id="h169-0-119" class="i">+                        val protoMediaReference = media.asJsonObject[&quot;mContentObject&quot;].asJsonArray.map { it.asByte }.toByteArray()
</a><a href="#h169-0-120" id="h169-0-120" class="i">+
</a><a href="#h169-0-121" id="h169-0-121" class="i">+                        runCatching {
</a><a href="#h169-0-122" id="h169-0-122" class="i">+                            val downloadedMedia = MediaDownloaderHelper.downloadMediaFromReference(protoMediaReference) {
</a><a href="#h169-0-123" id="h169-0-123" class="i">+                                EncryptionHelper.decryptInputStream(it, message.messageContent.contentType, ProtoReader(message.messageContent.content), isArroyo = false)
</a><a href="#h169-0-124" id="h169-0-124" class="i">+                            }
</a><a href="#h169-0-125" id="h169-0-125" class="i">+
</a><a href="#h169-0-126" id="h169-0-126" class="i">+                            printLog(&quot;downloaded media ${message.orderKey}&quot;)
</a><a href="#h169-0-127" id="h169-0-127" class="i">+
</a><a href="#h169-0-128" id="h169-0-128" class="i">+                            downloadedMedia.forEach { (type, mediaData) -&gt;
</a><a href="#h169-0-129" id="h169-0-129" class="i">+                                val fileType = FileType.fromByteArray(mediaData)
</a><a href="#h169-0-130" id="h169-0-130" class="i">+                                val fileName = &quot;${type}_${kotlin.io.encoding.Base64.UrlSafe.encode(protoMediaReference).replace(&quot;=&quot;, &quot;&quot;)}&quot;
</a><a href="#h169-0-131" id="h169-0-131" class="i">+
</a><a href="#h169-0-132" id="h169-0-132" class="i">+                                val mediaFile = File(downloadMediaCacheFolder, &quot;$fileName.${fileType.fileExtension}&quot;)
</a><a href="#h169-0-133" id="h169-0-133" class="i">+
</a><a href="#h169-0-134" id="h169-0-134" class="i">+                                FileOutputStream(mediaFile).use { fos -&gt;
</a><a href="#h169-0-135" id="h169-0-135" class="i">+                                    mediaData.inputStream().copyTo(fos)
</a><a href="#h169-0-136" id="h169-0-136" class="i">+                                }
</a><a href="#h169-0-137" id="h169-0-137" class="i">+
</a><a href="#h169-0-138" id="h169-0-138" class="i">+                                mediaFiles[fileName] = fileType to mediaFile
</a><a href="#h169-0-139" id="h169-0-139" class="i">+                            }
</a><a href="#h169-0-140" id="h169-0-140" class="i">+                        }.onFailure {
</a><a href="#h169-0-141" id="h169-0-141" class="i">+                            printLog(&quot;failed to download media for ${message.messageDescriptor.conversationId}_${message.orderKey}&quot;)
</a><a href="#h169-0-142" id="h169-0-142" class="i">+                            Logger.error(&quot;failed to download media for ${message.messageDescriptor.conversationId}_${message.orderKey}&quot;, it)
</a><a href="#h169-0-143" id="h169-0-143" class="i">+                        }
</a><a href="#h169-0-144" id="h169-0-144" class="i">+                    }
</a><a href="#h169-0-145" id="h169-0-145" class="i">+                }
</a><a href="#h169-0-146" id="h169-0-146" class="i">+            }.awaitAll()
</a><a href="#h169-0-147" id="h169-0-147" class="i">+        }
</a><a href="#h169-0-148" id="h169-0-148" class="i">+
</a><a href="#h169-0-149" id="h169-0-149" class="i">+        printLog(&quot;writing downloaded medias...&quot;)
</a><a href="#h169-0-150" id="h169-0-150" class="i">+
</a><a href="#h169-0-151" id="h169-0-151" class="i">+        //write the head of the html file
</a><a href="#h169-0-152" id="h169-0-152" class="i">+        output.write(&quot;&quot;&quot;
</a><a href="#h169-0-153" id="h169-0-153" class="i">+            &lt;!DOCTYPE html&gt;
</a><a href="#h169-0-154" id="h169-0-154" class="i">+            &lt;html&gt;
</a><a href="#h169-0-155" id="h169-0-155" class="i">+            &lt;head&gt;
</a><a href="#h169-0-156" id="h169-0-156" class="i">+                &lt;meta charset=&quot;UTF-8&quot;&gt;
</a><a href="#h169-0-157" id="h169-0-157" class="i">+                &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
</a><a href="#h169-0-158" id="h169-0-158" class="i">+                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
</a><a href="#h169-0-159" id="h169-0-159" class="i">+                &lt;title&gt;&lt;/title&gt;
</a><a href="#h169-0-160" id="h169-0-160" class="i">+            &lt;/head&gt;
</a><a href="#h169-0-161" id="h169-0-161" class="i">+        &quot;&quot;&quot;.trimIndent().toByteArray())
</a><a href="#h169-0-162" id="h169-0-162" class="i">+
</a><a href="#h169-0-163" id="h169-0-163" class="i">+        output.write(&quot;&lt;!-- This file was generated by SnapEnhance ${BuildConfig.VERSION_NAME} --&gt;\n&quot;.toByteArray())
</a><a href="#h169-0-164" id="h169-0-164" class="i">+
</a><a href="#h169-0-165" id="h169-0-165" class="i">+        mediaFiles.forEach { (key, filePair) -&gt;
</a><a href="#h169-0-166" id="h169-0-166" class="i">+            printLog(&quot;writing $key...&quot;)
</a><a href="#h169-0-167" id="h169-0-167" class="i">+            output.write(&quot;&lt;div class=\&quot;media-$key\&quot;&gt;&lt;!-- &quot;.toByteArray())
</a><a href="#h169-0-168" id="h169-0-168" class="i">+
</a><a href="#h169-0-169" id="h169-0-169" class="i">+            val deflateInputStream = DeflaterInputStream(filePair.second.inputStream(), Deflater(Deflater.BEST_COMPRESSION, true))
</a><a href="#h169-0-170" id="h169-0-170" class="i">+            val base64InputStream = XposedHelpers.newInstance(
</a><a href="#h169-0-171" id="h169-0-171" class="i">+                Base64InputStream::class.java,
</a><a href="#h169-0-172" id="h169-0-172" class="i">+                deflateInputStream,
</a><a href="#h169-0-173" id="h169-0-173" class="i">+                android.util.Base64.DEFAULT or android.util.Base64.NO_WRAP,
</a><a href="#h169-0-174" id="h169-0-174" class="i">+                true
</a><a href="#h169-0-175" id="h169-0-175" class="i">+            ) as InputStream
</a><a href="#h169-0-176" id="h169-0-176" class="i">+            base64InputStream.copyTo(output)
</a><a href="#h169-0-177" id="h169-0-177" class="i">+            deflateInputStream.close()
</a><a href="#h169-0-178" id="h169-0-178" class="i">+
</a><a href="#h169-0-179" id="h169-0-179" class="i">+            output.write(&quot; --&gt;&lt;/div&gt;\n&quot;.toByteArray())
</a><a href="#h169-0-180" id="h169-0-180" class="i">+            output.flush()
</a><a href="#h169-0-181" id="h169-0-181" class="i">+        }
</a><a href="#h169-0-182" id="h169-0-182" class="i">+        printLog(&quot;writing json conversation data...&quot;)
</a><a href="#h169-0-183" id="h169-0-183" class="i">+
</a><a href="#h169-0-184" id="h169-0-184" class="i">+        //write the json file
</a><a href="#h169-0-185" id="h169-0-185" class="i">+        output.write(&quot;&lt;script type=\&quot;application/json\&quot; class=\&quot;exported_content\&quot;&gt;&quot;.toByteArray())
</a><a href="#h169-0-186" id="h169-0-186" class="i">+        exportJson(output)
</a><a href="#h169-0-187" id="h169-0-187" class="i">+        output.write(&quot;&lt;/script&gt;\n&quot;.toByteArray())
</a><a href="#h169-0-188" id="h169-0-188" class="i">+
</a><a href="#h169-0-189" id="h169-0-189" class="i">+        printLog(&quot;writing template...&quot;)
</a><a href="#h169-0-190" id="h169-0-190" class="i">+
</a><a href="#h169-0-191" id="h169-0-191" class="i">+        runCatching {
</a><a href="#h169-0-192" id="h169-0-192" class="i">+            ZipFile(
</a><a href="#h169-0-193" id="h169-0-193" class="i">+                context.androidContext.packageManager.getApplicationInfoCompat(BuildConfig.LIBRARY_PACKAGE_NAME, PackageManager.GET_META_DATA).publicSourceDir
</a><a href="#h169-0-194" id="h169-0-194" class="i">+            ).use { apkFile -&gt;
</a><a href="#h169-0-195" id="h169-0-195" class="i">+                //export rawinflate.js
</a><a href="#h169-0-196" id="h169-0-196" class="i">+                apkFile.getEntry(&quot;assets/web/rawinflate.js&quot;).let { entry -&gt;
</a><a href="#h169-0-197" id="h169-0-197" class="i">+                    output.write(&quot;&lt;script&gt;&quot;.toByteArray())
</a><a href="#h169-0-198" id="h169-0-198" class="i">+                    apkFile.getInputStream(entry).copyTo(output)
</a><a href="#h169-0-199" id="h169-0-199" class="i">+                    output.write(&quot;&lt;/script&gt;\n&quot;.toByteArray())
</a><a href="#h169-0-200" id="h169-0-200" class="i">+                }
</a><a href="#h169-0-201" id="h169-0-201" class="i">+
</a><a href="#h169-0-202" id="h169-0-202" class="i">+                //export avenir next font
</a><a href="#h169-0-203" id="h169-0-203" class="i">+                apkFile.getEntry(&quot;res/font/avenir_next_medium.ttf&quot;).let { entry -&gt;
</a><a href="#h169-0-204" id="h169-0-204" class="i">+                    val encodedFontData = kotlin.io.encoding.Base64.Default.encode(apkFile.getInputStream(entry).readBytes())
</a><a href="#h169-0-205" id="h169-0-205" class="i">+                    output.write(&quot;&quot;&quot;
</a><a href="#h169-0-206" id="h169-0-206" class="i">+                        &lt;style&gt;
</a><a href="#h169-0-207" id="h169-0-207" class="i">+                            @font-face {
</a><a href="#h169-0-208" id="h169-0-208" class="i">+                                font-family: &#39;Avenir Next&#39;;
</a><a href="#h169-0-209" id="h169-0-209" class="i">+                                src: url(&#39;data:font/truetype;charset=utf-8;base64, $encodedFontData&#39;);
</a><a href="#h169-0-210" id="h169-0-210" class="i">+                                font-weight: normal;
</a><a href="#h169-0-211" id="h169-0-211" class="i">+                                font-style: normal;
</a><a href="#h169-0-212" id="h169-0-212" class="i">+                            }
</a><a href="#h169-0-213" id="h169-0-213" class="i">+                        &lt;/style&gt;
</a><a href="#h169-0-214" id="h169-0-214" class="i">+                    &quot;&quot;&quot;.trimIndent().toByteArray())
</a><a href="#h169-0-215" id="h169-0-215" class="i">+                }
</a><a href="#h169-0-216" id="h169-0-216" class="i">+
</a><a href="#h169-0-217" id="h169-0-217" class="i">+                apkFile.getEntry(&quot;assets/web/export_template.html&quot;).let { entry -&gt;
</a><a href="#h169-0-218" id="h169-0-218" class="i">+                    apkFile.getInputStream(entry).copyTo(output)
</a><a href="#h169-0-219" id="h169-0-219" class="i">+                }
</a><a href="#h169-0-220" id="h169-0-220" class="i">+
</a><a href="#h169-0-221" id="h169-0-221" class="i">+                apkFile.close()
</a><a href="#h169-0-222" id="h169-0-222" class="i">+            }
</a><a href="#h169-0-223" id="h169-0-223" class="i">+        }.onFailure {
</a><a href="#h169-0-224" id="h169-0-224" class="i">+            printLog(&quot;failed to read template from apk&quot;)
</a><a href="#h169-0-225" id="h169-0-225" class="i">+            Logger.error(&quot;failed to read template from apk&quot;, it)
</a><a href="#h169-0-226" id="h169-0-226" class="i">+        }
</a><a href="#h169-0-227" id="h169-0-227" class="i">+
</a><a href="#h169-0-228" id="h169-0-228" class="i">+        output.write(&quot;&lt;/html&gt;&quot;.toByteArray())
</a><a href="#h169-0-229" id="h169-0-229" class="i">+        output.close()
</a><a href="#h169-0-230" id="h169-0-230" class="i">+        printLog(&quot;done&quot;)
</a><a href="#h169-0-231" id="h169-0-231" class="i">+    }
</a><a href="#h169-0-232" id="h169-0-232" class="i">+
</a><a href="#h169-0-233" id="h169-0-233" class="i">+    private fun exportJson(output: OutputStream) {
</a><a href="#h169-0-234" id="h169-0-234" class="i">+        val rootObject = JsonObject().apply {
</a><a href="#h169-0-235" id="h169-0-235" class="i">+            addProperty(&quot;conversationId&quot;, friendFeedInfo.key)
</a><a href="#h169-0-236" id="h169-0-236" class="i">+            addProperty(&quot;conversationName&quot;, friendFeedInfo.feedDisplayName)
</a><a href="#h169-0-237" id="h169-0-237" class="i">+
</a><a href="#h169-0-238" id="h169-0-238" class="i">+            var index = 0
</a><a href="#h169-0-239" id="h169-0-239" class="i">+            val participants = mutableMapOf&lt;String, Int&gt;()
</a><a href="#h169-0-240" id="h169-0-240" class="i">+
</a><a href="#h169-0-241" id="h169-0-241" class="i">+            add(&quot;participants&quot;, JsonObject().apply {
</a><a href="#h169-0-242" id="h169-0-242" class="i">+                conversationParticipants.forEach { (userId, friendInfo) -&gt;
</a><a href="#h169-0-243" id="h169-0-243" class="i">+                    add(userId, JsonObject().apply {
</a><a href="#h169-0-244" id="h169-0-244" class="i">+                        addProperty(&quot;id&quot;, index)
</a><a href="#h169-0-245" id="h169-0-245" class="i">+                        addProperty(&quot;displayName&quot;, friendInfo.displayName)
</a><a href="#h169-0-246" id="h169-0-246" class="i">+                        addProperty(&quot;username&quot;, friendInfo.usernameForSorting)
</a><a href="#h169-0-247" id="h169-0-247" class="i">+                        addProperty(&quot;bitmojiSelfieId&quot;, friendInfo.bitmojiSelfieId)
</a><a href="#h169-0-248" id="h169-0-248" class="i">+                    })
</a><a href="#h169-0-249" id="h169-0-249" class="i">+                    participants[userId] = index++
</a><a href="#h169-0-250" id="h169-0-250" class="i">+                }
</a><a href="#h169-0-251" id="h169-0-251" class="i">+            })
</a><a href="#h169-0-252" id="h169-0-252" class="i">+            add(&quot;messages&quot;, JsonArray().apply {
</a><a href="#h169-0-253" id="h169-0-253" class="i">+                messages.forEach { message -&gt;
</a><a href="#h169-0-254" id="h169-0-254" class="i">+                    add(JsonObject().apply {
</a><a href="#h169-0-255" id="h169-0-255" class="i">+                        addProperty(&quot;orderKey&quot;, message.orderKey)
</a><a href="#h169-0-256" id="h169-0-256" class="i">+                        addProperty(&quot;senderId&quot;, participants.getOrDefault(message.senderId.toString(), -1))
</a><a href="#h169-0-257" id="h169-0-257" class="i">+                        addProperty(&quot;type&quot;, message.messageContent.contentType.toString())
</a><a href="#h169-0-258" id="h169-0-258" class="i">+
</a><a href="#h169-0-259" id="h169-0-259" class="i">+                        fun addUUIDList(name: String, list: List&lt;SnapUUID&gt;) {
</a><a href="#h169-0-260" id="h169-0-260" class="i">+                            add(name, JsonArray().apply {
</a><a href="#h169-0-261" id="h169-0-261" class="i">+                                list.map { participants.getOrDefault(it.toString(), -1) }.forEach { add(it) }
</a><a href="#h169-0-262" id="h169-0-262" class="i">+                            })
</a><a href="#h169-0-263" id="h169-0-263" class="i">+                        }
</a><a href="#h169-0-264" id="h169-0-264" class="i">+
</a><a href="#h169-0-265" id="h169-0-265" class="i">+                        addUUIDList(&quot;savedBy&quot;, message.messageMetadata.savedBy)
</a><a href="#h169-0-266" id="h169-0-266" class="i">+                        addUUIDList(&quot;seenBy&quot;, message.messageMetadata.seenBy)
</a><a href="#h169-0-267" id="h169-0-267" class="i">+                        addUUIDList(&quot;openedBy&quot;, message.messageMetadata.openedBy)
</a><a href="#h169-0-268" id="h169-0-268" class="i">+
</a><a href="#h169-0-269" id="h169-0-269" class="i">+                        add(&quot;reactions&quot;, JsonObject().apply {
</a><a href="#h169-0-270" id="h169-0-270" class="i">+                            message.messageMetadata.reactions.forEach { reaction -&gt;
</a><a href="#h169-0-271" id="h169-0-271" class="i">+                                addProperty(
</a><a href="#h169-0-272" id="h169-0-272" class="i">+                                    participants.getOrDefault(reaction.userId.toString(), -1L).toString(),
</a><a href="#h169-0-273" id="h169-0-273" class="i">+                                    reaction.reactionId
</a><a href="#h169-0-274" id="h169-0-274" class="i">+                                )
</a><a href="#h169-0-275" id="h169-0-275" class="i">+                            }
</a><a href="#h169-0-276" id="h169-0-276" class="i">+                        })
</a><a href="#h169-0-277" id="h169-0-277" class="i">+
</a><a href="#h169-0-278" id="h169-0-278" class="i">+                        addProperty(&quot;createdTimestamp&quot;, message.messageMetadata.createdAt)
</a><a href="#h169-0-279" id="h169-0-279" class="i">+                        addProperty(&quot;readTimestamp&quot;, message.messageMetadata.readAt)
</a><a href="#h169-0-280" id="h169-0-280" class="i">+                        addProperty(&quot;serializedContent&quot;, serializeMessageContent(message))
</a><a href="#h169-0-281" id="h169-0-281" class="i">+                        addProperty(&quot;rawContent&quot;, Base64.getUrlEncoder().encodeToString(message.messageContent.content))
</a><a href="#h169-0-282" id="h169-0-282" class="i">+
</a><a href="#h169-0-283" id="h169-0-283" class="i">+                        val messageContentType = message.messageContent.contentType
</a><a href="#h169-0-284" id="h169-0-284" class="i">+
</a><a href="#h169-0-285" id="h169-0-285" class="i">+                        EncryptionHelper.getEncryptionKeys(messageContentType, ProtoReader(message.messageContent.content), isArroyo = false)?.let { encryptionKeyPair -&gt;
</a><a href="#h169-0-286" id="h169-0-286" class="i">+                            add(&quot;encryption&quot;, JsonObject().apply encryption@{
</a><a href="#h169-0-287" id="h169-0-287" class="i">+                                addProperty(&quot;key&quot;, Base64.getEncoder().encodeToString(encryptionKeyPair.first))
</a><a href="#h169-0-288" id="h169-0-288" class="i">+                                addProperty(&quot;iv&quot;, Base64.getEncoder().encodeToString(encryptionKeyPair.second))
</a><a href="#h169-0-289" id="h169-0-289" class="i">+                            })
</a><a href="#h169-0-290" id="h169-0-290" class="i">+                        }
</a><a href="#h169-0-291" id="h169-0-291" class="i">+
</a><a href="#h169-0-292" id="h169-0-292" class="i">+                        val remoteMediaReferences by lazy {
</a><a href="#h169-0-293" id="h169-0-293" class="i">+                            val serializedMessageContent = context.gson.toJsonTree(message.messageContent.instanceNonNull()).asJsonObject
</a><a href="#h169-0-294" id="h169-0-294" class="i">+                            serializedMessageContent[&quot;mRemoteMediaReferences&quot;]
</a><a href="#h169-0-295" id="h169-0-295" class="i">+                                .asJsonArray.map { it.asJsonObject[&quot;mMediaReferences&quot;].asJsonArray }
</a><a href="#h169-0-296" id="h169-0-296" class="i">+                                .flatten()
</a><a href="#h169-0-297" id="h169-0-297" class="i">+                        }
</a><a href="#h169-0-298" id="h169-0-298" class="i">+
</a><a href="#h169-0-299" id="h169-0-299" class="i">+                        add(&quot;mediaReferences&quot;, JsonArray().apply mediaReferences@ {
</a><a href="#h169-0-300" id="h169-0-300" class="i">+                            if (messageContentType != ContentType.EXTERNAL_MEDIA &amp;&amp;
</a><a href="#h169-0-301" id="h169-0-301" class="i">+                                messageContentType != ContentType.STICKER &amp;&amp;
</a><a href="#h169-0-302" id="h169-0-302" class="i">+                                messageContentType != ContentType.SNAP &amp;&amp;
</a><a href="#h169-0-303" id="h169-0-303" class="i">+                                messageContentType != ContentType.NOTE)
</a><a href="#h169-0-304" id="h169-0-304" class="i">+                                return@mediaReferences
</a><a href="#h169-0-305" id="h169-0-305" class="i">+
</a><a href="#h169-0-306" id="h169-0-306" class="i">+                            remoteMediaReferences.forEach { media -&gt;
</a><a href="#h169-0-307" id="h169-0-307" class="i">+                                val protoMediaReference = media.asJsonObject[&quot;mContentObject&quot;].asJsonArray.map { it.asByte }.toByteArray()
</a><a href="#h169-0-308" id="h169-0-308" class="i">+                                val mediaType = MediaReferenceType.valueOf(media.asJsonObject[&quot;mMediaType&quot;].asString)
</a><a href="#h169-0-309" id="h169-0-309" class="i">+                                add(JsonObject().apply {
</a><a href="#h169-0-310" id="h169-0-310" class="i">+                                    addProperty(&quot;mediaType&quot;, mediaType.toString())
</a><a href="#h169-0-311" id="h169-0-311" class="i">+                                    addProperty(&quot;content&quot;, Base64.getUrlEncoder().encodeToString(protoMediaReference))
</a><a href="#h169-0-312" id="h169-0-312" class="i">+                                })
</a><a href="#h169-0-313" id="h169-0-313" class="i">+                            }
</a><a href="#h169-0-314" id="h169-0-314" class="i">+                        })
</a><a href="#h169-0-315" id="h169-0-315" class="i">+
</a><a href="#h169-0-316" id="h169-0-316" class="i">+                    })
</a><a href="#h169-0-317" id="h169-0-317" class="i">+                }
</a><a href="#h169-0-318" id="h169-0-318" class="i">+            })
</a><a href="#h169-0-319" id="h169-0-319" class="i">+        }
</a><a href="#h169-0-320" id="h169-0-320" class="i">+
</a><a href="#h169-0-321" id="h169-0-321" class="i">+        output.write(context.gson.toJson(rootObject).toByteArray())
</a><a href="#h169-0-322" id="h169-0-322" class="i">+        output.flush()
</a><a href="#h169-0-323" id="h169-0-323" class="i">+    }
</a><a href="#h169-0-324" id="h169-0-324" class="i">+
</a><a href="#h169-0-325" id="h169-0-325" class="i">+    suspend fun exportTo(exportFormat: ExportFormat) {
</a><a href="#h169-0-326" id="h169-0-326" class="i">+        val output = FileOutputStream(outputFile)
</a><a href="#h169-0-327" id="h169-0-327" class="i">+
</a><a href="#h169-0-328" id="h169-0-328" class="i">+        when (exportFormat) {
</a><a href="#h169-0-329" id="h169-0-329" class="i">+            ExportFormat.HTML -&gt; exportHtml(output)
</a><a href="#h169-0-330" id="h169-0-330" class="i">+            ExportFormat.JSON -&gt; exportJson(output)
</a><a href="#h169-0-331" id="h169-0-331" class="i">+            ExportFormat.TEXT -&gt; exportText(output)
</a><a href="#h169-0-332" id="h169-0-332" class="i">+        }
</a><a href="#h169-0-333" id="h169-0-333" class="i">+
</a><a href="#h169-0-334" id="h169-0-334" class="i">+        output.close()
</a><a href="#h169-0-335" id="h169-0-335" class="i">+    }
</a><a href="#h169-0-336" id="h169-0-336" class="i">+}</a><a href="#h169-0-337" id="h169-0-337" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h170" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoEditor.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoEditor.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoEditor.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoEditor.kt</a></b>
<b>diff --git a/<a id="h171" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoReader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoReader.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoReader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoReader.kt</a></b>
<b>diff --git a/<a id="h172" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoWriter.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoWriter.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoWriter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/protobuf/ProtoWriter.kt</a></b>
<b>diff --git a/<a id="h173" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/BitmojiSelfie.kt</a></b>
<b>diff --git a/<a id="h174" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/snap/EncryptionHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/snap/EncryptionHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/snap/EncryptionHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/EncryptionHelper.kt</a></b>
<b>diff --git a/<a id="h175" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/snap/MediaDownloaderHelper.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/snap/MediaDownloaderHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/snap/MediaDownloaderHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/MediaDownloaderHelper.kt</a></b>
<b>diff --git a/<a id="h176" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/util/snap/PreviewUtils.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/util/snap/PreviewUtils.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/snap/PreviewUtils.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/PreviewUtils.kt</a></b>
<b>diff --git a/<a id="h177" href="../file/app/src/main/res/drawable/action_button_cancel.xml.html">app/src/main/res/drawable/action_button_cancel.xml</a> b/<a href="../file/core/src/main/res/drawable/action_button_cancel.xml.html">core/src/main/res/drawable/action_button_cancel.xml</a></b>
<b>diff --git a/<a id="h178" href="../file/app/src/main/res/drawable/action_button_success.xml.html">app/src/main/res/drawable/action_button_success.xml</a> b/<a href="../file/core/src/main/res/drawable/action_button_success.xml.html">core/src/main/res/drawable/action_button_success.xml</a></b>
<b>diff --git a/<a id="h179" href="../file/app/src/main/res/drawable/back_arrow.xml.html">app/src/main/res/drawable/back_arrow.xml</a> b/<a href="../file/core/src/main/res/drawable/back_arrow.xml.html">core/src/main/res/drawable/back_arrow.xml</a></b>
<b>diff --git a/<a id="h180" href="../file/app/src/main/res/drawable/bitmoji_blank.xml.html">app/src/main/res/drawable/bitmoji_blank.xml</a> b/<a href="../file/core/src/main/res/drawable/bitmoji_blank.xml.html">core/src/main/res/drawable/bitmoji_blank.xml</a></b>
<b>diff --git a/<a id="h181" href="../file/app/src/main/res/drawable/debug_settings_icon.xml.html">app/src/main/res/drawable/debug_settings_icon.xml</a> b/<a href="../file/core/src/main/res/drawable/debug_settings_icon.xml.html">core/src/main/res/drawable/debug_settings_icon.xml</a></b>
<b>diff --git a/<a id="h182" href="../file/app/src/main/res/drawable/download_manager_item_background.xml.html">app/src/main/res/drawable/download_manager_item_background.xml</a> b/<a href="../file/core/src/main/res/drawable/download_manager_item_background.xml.html">core/src/main/res/drawable/download_manager_item_background.xml</a></b>
<b>diff --git a/<a id="h183" href="../file/app/src/main/res/drawable/settings_icon.xml.html">app/src/main/res/drawable/settings_icon.xml</a> b/<a href="../file/core/src/main/res/drawable/settings_icon.xml.html">core/src/main/res/drawable/settings_icon.xml</a></b>
<b>diff --git a/<a id="h184" href="../file/app/src/main/res/font/avenir_next_bold.ttf.html">app/src/main/res/font/avenir_next_bold.ttf</a> b/<a href="../file/core/src/main/res/font/avenir_next_bold.ttf.html">core/src/main/res/font/avenir_next_bold.ttf</a></b>
Binary files differ.
<b>diff --git a/<a id="h185" href="../file/app/src/main/res/font/avenir_next_medium.ttf.html">app/src/main/res/font/avenir_next_medium.ttf</a> b/<a href="../file/core/src/main/res/font/avenir_next_medium.ttf.html">core/src/main/res/font/avenir_next_medium.ttf</a></b>
Binary files differ.
<b>diff --git a/<a id="h186" href="../file/app/src/main/res/layout/activity_default_header.xml.html">app/src/main/res/layout/activity_default_header.xml</a> b/<a href="../file/core/src/main/res/layout/activity_default_header.xml.html">core/src/main/res/layout/activity_default_header.xml</a></b>
<b>diff --git a/<a id="h187" href="../file/app/src/main/res/layout/config_activity.xml.html">app/src/main/res/layout/config_activity.xml</a> b/<a href="../file/core/src/main/res/layout/config_activity.xml.html">core/src/main/res/layout/config_activity.xml</a></b>
<b>diff --git a/<a id="h188" href="../file/app/src/main/res/layout/config_activity_debug_item.xml.html">app/src/main/res/layout/config_activity_debug_item.xml</a> b/<a href="../file/core/src/main/res/layout/config_activity_debug_item.xml.html">core/src/main/res/layout/config_activity_debug_item.xml</a></b>
<b>diff --git a/<a id="h189" href="../file/app/src/main/res/layout/config_activity_item.xml.html">app/src/main/res/layout/config_activity_item.xml</a> b/<a href="../file/core/src/main/res/layout/config_activity_item.xml.html">core/src/main/res/layout/config_activity_item.xml</a></b>
<b>diff --git a/<a id="h190" href="../file/app/src/main/res/layout/debug_setting_item.xml.html">app/src/main/res/layout/debug_setting_item.xml</a> b/<a href="../file/core/src/main/res/layout/debug_setting_item.xml.html">core/src/main/res/layout/debug_setting_item.xml</a></b>
<b>diff --git a/<a id="h191" href="../file/app/src/main/res/layout/debug_settings_page.xml.html">app/src/main/res/layout/debug_settings_page.xml</a> b/<a href="../file/core/src/main/res/layout/debug_settings_page.xml.html">core/src/main/res/layout/debug_settings_page.xml</a></b>
<b>diff --git a/<a id="h192" href="../file/app/src/main/res/layout/device_spoofer_activity.xml.html">app/src/main/res/layout/device_spoofer_activity.xml</a> b/<a href="../file/core/src/main/res/layout/device_spoofer_activity.xml.html">core/src/main/res/layout/device_spoofer_activity.xml</a></b>
<b>diff --git a/<a id="h193" href="../file/app/src/main/res/layout/download_manager_activity.xml.html">app/src/main/res/layout/download_manager_activity.xml</a> b/<a href="../file/core/src/main/res/layout/download_manager_activity.xml.html">core/src/main/res/layout/download_manager_activity.xml</a></b>
<b>diff --git a/<a id="h194" href="../file/app/src/main/res/layout/download_manager_item.xml.html">app/src/main/res/layout/download_manager_item.xml</a> b/<a href="../file/core/src/main/res/layout/download_manager_item.xml.html">core/src/main/res/layout/download_manager_item.xml</a></b>
<b>diff --git a/<a id="h195" href="../file/app/src/main/res/layout/map.xml.html">app/src/main/res/layout/map.xml</a> b/<a href="../file/core/src/main/res/layout/map.xml.html">core/src/main/res/layout/map.xml</a></b>
<b>diff --git a/<a id="h196" href="../file/app/src/main/res/layout/precise_location_dialog.xml.html">app/src/main/res/layout/precise_location_dialog.xml</a> b/<a href="../file/core/src/main/res/layout/precise_location_dialog.xml.html">core/src/main/res/layout/precise_location_dialog.xml</a></b>
<b>diff --git a/<a id="h197" href="../file/app/src/main/res/mipmap-anydpi-v26/launcher_icon.xml.html">app/src/main/res/mipmap-anydpi-v26/launcher_icon.xml</a> b/<a href="../file/core/src/main/res/mipmap-anydpi-v26/launcher_icon.xml.html">core/src/main/res/mipmap-anydpi-v26/launcher_icon.xml</a></b>
<b>diff --git a/<a id="h198" href="../file/app/src/main/res/mipmap-anydpi-v26/launcher_icon_round.xml.html">app/src/main/res/mipmap-anydpi-v26/launcher_icon_round.xml</a> b/<a href="../file/core/src/main/res/mipmap-anydpi-v26/launcher_icon_round.xml.html">core/src/main/res/mipmap-anydpi-v26/launcher_icon_round.xml</a></b>
<b>diff --git a/<a id="h199" href="../file/app/src/main/res/mipmap-hdpi/launcher_icon_foreground.png.html">app/src/main/res/mipmap-hdpi/launcher_icon_foreground.png</a> b/<a href="../file/core/src/main/res/mipmap-hdpi/launcher_icon_foreground.png.html">core/src/main/res/mipmap-hdpi/launcher_icon_foreground.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h200" href="../file/app/src/main/res/mipmap-hdpi/launcher_icon_round.png.html">app/src/main/res/mipmap-hdpi/launcher_icon_round.png</a> b/<a href="../file/core/src/main/res/mipmap-hdpi/launcher_icon_round.png.html">core/src/main/res/mipmap-hdpi/launcher_icon_round.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h201" href="../file/app/src/main/res/mipmap-mdpi/launcher_icon_foreground.png.html">app/src/main/res/mipmap-mdpi/launcher_icon_foreground.png</a> b/<a href="../file/core/src/main/res/mipmap-mdpi/launcher_icon_foreground.png.html">core/src/main/res/mipmap-mdpi/launcher_icon_foreground.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h202" href="../file/app/src/main/res/mipmap-mdpi/launcher_icon_round.png.html">app/src/main/res/mipmap-mdpi/launcher_icon_round.png</a> b/<a href="../file/core/src/main/res/mipmap-mdpi/launcher_icon_round.png.html">core/src/main/res/mipmap-mdpi/launcher_icon_round.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h203" href="../file/app/src/main/res/mipmap-xhdpi/launcher_icon_foreground.png.html">app/src/main/res/mipmap-xhdpi/launcher_icon_foreground.png</a> b/<a href="../file/core/src/main/res/mipmap-xhdpi/launcher_icon_foreground.png.html">core/src/main/res/mipmap-xhdpi/launcher_icon_foreground.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h204" href="../file/app/src/main/res/mipmap-xhdpi/launcher_icon_round.png.html">app/src/main/res/mipmap-xhdpi/launcher_icon_round.png</a> b/<a href="../file/core/src/main/res/mipmap-xhdpi/launcher_icon_round.png.html">core/src/main/res/mipmap-xhdpi/launcher_icon_round.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h205" href="../file/app/src/main/res/mipmap-xxhdpi/launcher_icon_foreground.png.html">app/src/main/res/mipmap-xxhdpi/launcher_icon_foreground.png</a> b/<a href="../file/core/src/main/res/mipmap-xxhdpi/launcher_icon_foreground.png.html">core/src/main/res/mipmap-xxhdpi/launcher_icon_foreground.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h206" href="../file/app/src/main/res/mipmap-xxhdpi/launcher_icon_round.png.html">app/src/main/res/mipmap-xxhdpi/launcher_icon_round.png</a> b/<a href="../file/core/src/main/res/mipmap-xxhdpi/launcher_icon_round.png.html">core/src/main/res/mipmap-xxhdpi/launcher_icon_round.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h207" href="../file/app/src/main/res/mipmap-xxxhdpi/launcher_icon_foreground.png.html">app/src/main/res/mipmap-xxxhdpi/launcher_icon_foreground.png</a> b/<a href="../file/core/src/main/res/mipmap-xxxhdpi/launcher_icon_foreground.png.html">core/src/main/res/mipmap-xxxhdpi/launcher_icon_foreground.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h208" href="../file/app/src/main/res/mipmap-xxxhdpi/launcher_icon_round.png.html">app/src/main/res/mipmap-xxxhdpi/launcher_icon_round.png</a> b/<a href="../file/core/src/main/res/mipmap-xxxhdpi/launcher_icon_round.png.html">core/src/main/res/mipmap-xxxhdpi/launcher_icon_round.png</a></b>
Binary files differ.
<b>diff --git a/<a id="h209" href="../file/app/src/main/res/values/arrays.xml.html">app/src/main/res/values/arrays.xml</a> b/<a href="../file/core/src/main/res/values/arrays.xml.html">core/src/main/res/values/arrays.xml</a></b>
<b>diff --git a/<a id="h210" href="../file/app/src/main/res/values/colors.xml.html">app/src/main/res/values/colors.xml</a> b/<a href="../file/core/src/main/res/values/colors.xml.html">core/src/main/res/values/colors.xml</a></b>
<b>diff --git a/<a id="h211" href="../file/app/src/main/res/values/dimens.xml.html">app/src/main/res/values/dimens.xml</a> b/<a href="../file/core/src/main/res/values/dimens.xml.html">core/src/main/res/values/dimens.xml</a></b>
<b>diff --git a/<a id="h212" href="../file/app/src/main/res/values/launcher_icon_background.xml.html">app/src/main/res/values/launcher_icon_background.xml</a> b/<a href="../file/core/src/main/res/values/launcher_icon_background.xml.html">core/src/main/res/values/launcher_icon_background.xml</a></b>
<b>diff --git a/<a id="h213" href="../file/app/src/main/res/values/strings.xml.html">app/src/main/res/values/strings.xml</a> b/<a href="../file/core/src/main/res/values/strings.xml.html">core/src/main/res/values/strings.xml</a></b>
<b>diff --git a/<a id="h214" href="../file/app/src/main/res/values/themes.xml.html">app/src/main/res/values/themes.xml</a> b/<a href="../file/core/src/main/res/values/themes.xml.html">core/src/main/res/values/themes.xml</a></b>
<b>diff --git a/<a id="h215" href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a> b/<a href="../file/gradle/libs.versions.toml.html">gradle/libs.versions.toml</a></b>
<a href="#h215-0" id="h215-0" class="h">@@ -11,6 +11,7 @@ osmdroid-android = &quot;6.1.16&quot;
</a> okhttp = &quot;5.0.0-alpha.11&quot;
 dexlib2 = &quot;2.5.2&quot;
 androidx-documentfile = &quot;1.1.0-alpha01&quot;
<a href="#h215-0-3" id="h215-0-3" class="i">+activity-ktx = &quot;1.7.2&quot;
</a> 
 
 [libraries]
<a href="#h215-1" id="h215-1" class="h">@@ -24,6 +25,7 @@ osmdroid-android = { group = &quot;org.osmdroid&quot;, name = &quot;osmdroid-android&quot;, version.
</a> okhttp = { group = &quot;com.squareup.okhttp3&quot;, name = &quot;okhttp&quot;, version.ref = &quot;okhttp&quot; }
 dexlib2 = { group = &quot;org.smali&quot;, name = &quot;dexlib2&quot;, version.ref = &quot;dexlib2&quot; }
 androidx-documentfile = { group = &quot;androidx.documentfile&quot;, name = &quot;documentfile&quot;, version.ref = &quot;androidx-documentfile&quot; }
<a href="#h215-1-3" id="h215-1-3" class="i">+androidx-activity-ktx = { group = &quot;androidx.activity&quot;, name = &quot;activity-ktx&quot;, version.ref = &quot;activity-ktx&quot; }
</a> 
 
 [plugins]
<b>diff --git a/<a id="h216" href="../file/settings.gradle.kts.html">settings.gradle.kts</a> b/<a href="../file/settings.gradle.kts.html">settings.gradle.kts</a></b>
<a href="#h216-0" id="h216-0" class="h">@@ -15,6 +15,8 @@ dependencyResolutionManagement {
</a>     }
 }
 
<a href="#h216-0-3" id="h216-0-3" class="i">+
</a> rootProject.name = &quot;SnapEnhance&quot;
<a href="#h216-0-5" id="h216-0-5" class="i">+include(&quot;:core&quot;)
</a> include(&quot;:app&quot;)
 include(&quot;:mapper&quot;) 
\ No newline at end of file
</pre>
</div>
</body>
</html>
