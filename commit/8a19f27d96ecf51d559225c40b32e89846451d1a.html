<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>feat: social section - bridge: rules, sync - move extensions to a new package - snap widget broadcast receiver (SnapWidgetBroadcastReceiverHelper) - refactor compose remember delegates - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/8a19f27d96ecf51d559225c40b32e89846451d1a.html">8a19f27d96ecf51d559225c40b32e89846451d1a</a>
<b>parent</b> <a href="../commit/11b7119f8b5478adcadb013112da67044dafa6c7.html">11b7119f8b5478adcadb013112da67044dafa6c7</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sat, 19 Aug 2023 11:58:41 +0200

feat: social section
- bridge: rules, sync
- move extensions to a new package
- snap widget broadcast receiver (SnapWidgetBroadcastReceiverHelper)
- refactor compose remember delegates

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></td><td> | </td><td class="num">83</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a></td><td> | </td><td class="num">128</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">----------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">+++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt</a></td><td> | </td><td class="num">10</td><td><span class="i">++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/Dialogs.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">+++++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a></td><td> | </td><td class="num">66</td><td><span class="i">+++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a></td><td> | </td><td class="num">124</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">+++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a></td><td> | </td><td class="num">131</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++</span><span class="d">------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/MappingsScreen.kt</a></td><td> | </td><td class="num">32</td><td><span class="i">+++++++++++++++++</span><span class="d">---------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">+++++++</span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SaveFolderScreen.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h13">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/Accompagnist.kt</a></td><td> | </td><td class="num">57</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h14">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></td><td> | </td><td class="num">123</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">---------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h15">core/src/main/aidl/me/rhunk/snapenhance/bridge/SyncCallback.aidl</a></td><td> | </td><td class="num">18</td><td><span class="i">++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h16">core/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h17">core/src/main/kotlin/me/rhunk/snapenhance/EventDispatcher.kt</a></td><td> | </td><td class="num">26</td><td><span class="i">++++++++++++++++++++++++</span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h18">core/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt</a></td><td> | </td><td class="num">35</td><td><span class="i"></span><span class="d">-----------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h19">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></td><td> | </td><td class="num">56</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h20">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">+++++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h21">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h22">core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/EventBus.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+++++</span><span class="d">-</span></td></tr>
<tr><td class="A">A</td><td><a href="#h23">core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/events/impl/SnapWidgetBroadcastReceiveEvent.kt</a></td><td> | </td><td class="num">12</td><td><span class="i">++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h24">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumConversationFeature.kt</a></td><td> | </td><td class="num">11</td><td><span class="i"></span><span class="d">-----------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h25">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/ManagementObjects.kt</a></td><td> | </td><td class="num">29</td><td><span class="i"></span><span class="d">-----------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h26">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a></td><td> | </td><td class="num">56</td><td><span class="i">++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h27">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h28">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h29">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h30">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">+++++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt</a></td><td> | </td><td class="num">8</td><td><span class="i">++++</span><span class="d">----</span></td></tr>
<tr><td class="A">A</td><td><a href="#h38">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedEntry.kt</a></td><td> | </td><td class="num">47</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h39">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt</a></td><td> | </td><td class="num">38</td><td><span class="i"></span><span class="d">--------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h40">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt</a></td><td> | </td><td class="num">9</td><td><span class="i">+++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h41">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h42">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h43">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h44">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigurationOverride.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h45">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h46">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></td><td> | </td><td class="num">5</td><td><span class="i">++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h47">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h48">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h49">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h50">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h51">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a></td><td> | </td><td class="num">37</td><td><span class="i">+++++++++++++++++</span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h52">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="D">D</td><td><a href="#h53">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></td><td> | </td><td class="num">190</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h54">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="D">D</td><td><a href="#h55">core/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt</a></td><td> | </td><td class="num">6</td><td><span class="i"></span><span class="d">------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h56">core/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt</a></td><td> | </td><td class="num">13</td><td><span class="i"></span><span class="d">-------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h57">core/src/main/kotlin/me/rhunk/snapenhance/util/DbCursorExt.kt</a></td><td> | </td><td class="num">38</td><td><span class="i"></span><span class="d">--------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h58">core/src/main/kotlin/me/rhunk/snapenhance/util/SerializableDataObject.kt</a></td><td> | </td><td class="num">23</td><td><span class="i">+++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h59">core/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperExt.kt</a></td><td> | </td><td class="num">20</td><td><span class="i"></span><span class="d">--------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h60">core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">+++++++++</span><span class="d">---------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h61">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/AndroidCompatExtensions.kt</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h62">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/DbCursorExt.kt</a></td><td> | </td><td class="num">38</td><td><span class="i">++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h63">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/XposedHelperExt.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h64">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/SnapWidgetBroadcastReceiverHelper.kt</a></td><td> | </td><td class="num">25</td><td><span class="i">+++++++++++++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>65 files changed, 1087 insertions(+), 633 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeService.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -3,17 +3,25 @@ package me.rhunk.snapenhance.bridge
</a> import android.app.Service
 import android.content.Intent
 import android.os.IBinder
<a href="#h0-0-3" id="h0-0-3" class="i">+import me.rhunk.snapenhance.Logger
</a> import me.rhunk.snapenhance.RemoteSideContext
 import me.rhunk.snapenhance.SharedContextHolder
 import me.rhunk.snapenhance.bridge.types.BridgeFileType
 import me.rhunk.snapenhance.bridge.types.FileActionType
 import me.rhunk.snapenhance.bridge.wrapper.LocaleWrapper
 import me.rhunk.snapenhance.bridge.wrapper.MessageLoggerWrapper
<a href="#h0-0-10" id="h0-0-10" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
</a><a href="#h0-0-11" id="h0-0-11" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
</a><a href="#h0-0-12" id="h0-0-12" class="i">+import me.rhunk.snapenhance.core.messaging.RuleScope
</a><a href="#h0-0-13" id="h0-0-13" class="i">+import me.rhunk.snapenhance.database.objects.FriendInfo
</a> import me.rhunk.snapenhance.download.DownloadProcessor
<a href="#h0-0-15" id="h0-0-15" class="i">+import me.rhunk.snapenhance.util.SerializableDataObject
</a><a href="#h0-0-16" id="h0-0-16" class="i">+import kotlin.system.measureTimeMillis
</a> 
 class BridgeService : Service() {
     private lateinit var messageLoggerWrapper: MessageLoggerWrapper
     private lateinit var remoteSideContext: RemoteSideContext
<a href="#h0-0-21" id="h0-0-21" class="i">+    private lateinit var syncCallback: SyncCallback
</a> 
     override fun onBind(intent: Intent): IBinder {
         remoteSideContext = SharedContextHolder.remote(this).apply {
<a href="#h0-1" id="h0-1" class="h">@@ -25,28 +33,36 @@ class BridgeService : Service() {
</a> 
     inner class BridgeBinder : BridgeInterface.Stub() {
         override fun fileOperation(action: Int, fileType: Int, content: ByteArray?): ByteArray {
<a href="#h0-1-3" id="h0-1-3" class="d">-            val resolvedFile by lazy { BridgeFileType.fromValue(fileType)?.resolve(this@BridgeService) }
</a><a href="#h0-1-4" id="h0-1-4" class="i">+            val resolvedFile by lazy {
</a><a href="#h0-1-5" id="h0-1-5" class="i">+                BridgeFileType.fromValue(fileType)?.resolve(this@BridgeService)
</a><a href="#h0-1-6" id="h0-1-6" class="i">+            }
</a> 
             return when (FileActionType.values()[action]) {
                 FileActionType.CREATE_AND_READ -&gt; {
                     resolvedFile?.let {
                         if (!it.exists()) {
<a href="#h0-1-12" id="h0-1-12" class="d">-                            return content?.also { content -&gt; it.writeBytes(content) } ?: ByteArray(0)
</a><a href="#h0-1-13" id="h0-1-13" class="i">+                            return content?.also { content -&gt; it.writeBytes(content) } ?: ByteArray(
</a><a href="#h0-1-14" id="h0-1-14" class="i">+                                0
</a><a href="#h0-1-15" id="h0-1-15" class="i">+                            )
</a>                         }
 
                         it.readBytes()
                     } ?: ByteArray(0)
                 }
<a href="#h0-1-21" id="h0-1-21" class="i">+
</a>                 FileActionType.READ -&gt; {
                     resolvedFile?.takeIf { it.exists() }?.readBytes() ?: ByteArray(0)
                 }
<a href="#h0-1-25" id="h0-1-25" class="i">+
</a>                 FileActionType.WRITE -&gt; {
                     content?.also { resolvedFile?.writeBytes(content) } ?: ByteArray(0)
                 }
<a href="#h0-1-29" id="h0-1-29" class="i">+
</a>                 FileActionType.DELETE -&gt; {
                     resolvedFile?.takeIf { it.exists() }?.delete()
                     ByteArray(0)
                 }
<a href="#h0-1-34" id="h0-1-34" class="i">+
</a>                 FileActionType.EXISTS -&gt; {
                     if (resolvedFile?.exists() == true)
                         ByteArray(1)
<a href="#h0-2" id="h0-2" class="h">@@ -55,27 +71,76 @@ class BridgeService : Service() {
</a>             }
         }
 
<a href="#h0-2-3" id="h0-2-3" class="d">-        override fun getLoggedMessageIds(conversationId: String, limit: Int) = messageLoggerWrapper.getMessageIds(conversationId, limit).toLongArray()
</a><a href="#h0-2-4" id="h0-2-4" class="i">+        override fun getLoggedMessageIds(conversationId: String, limit: Int) =
</a><a href="#h0-2-5" id="h0-2-5" class="i">+            messageLoggerWrapper.getMessageIds(conversationId, limit).toLongArray()
</a> 
<a href="#h0-2-7" id="h0-2-7" class="d">-        override fun getMessageLoggerMessage(conversationId: String, id: Long) = messageLoggerWrapper.getMessage(conversationId, id).second
</a><a href="#h0-2-8" id="h0-2-8" class="i">+        override fun getMessageLoggerMessage(conversationId: String, id: Long) =
</a><a href="#h0-2-9" id="h0-2-9" class="i">+            messageLoggerWrapper.getMessage(conversationId, id).second
</a> 
         override fun addMessageLoggerMessage(conversationId: String, id: Long, message: ByteArray) {
             messageLoggerWrapper.addMessage(conversationId, id, message)
         }
 
<a href="#h0-2-15" id="h0-2-15" class="d">-        override fun deleteMessageLoggerMessage(conversationId: String, id: Long) = messageLoggerWrapper.deleteMessage(conversationId, id)
</a><a href="#h0-2-16" id="h0-2-16" class="i">+        override fun deleteMessageLoggerMessage(conversationId: String, id: Long) =
</a><a href="#h0-2-17" id="h0-2-17" class="i">+            messageLoggerWrapper.deleteMessage(conversationId, id)
</a> 
         override fun clearMessageLogger() = messageLoggerWrapper.clearMessages()
 
<a href="#h0-2-21" id="h0-2-21" class="d">-        override fun fetchLocales(userLocale: String) = LocaleWrapper.fetchLocales(context = this@BridgeService, userLocale).associate {
</a><a href="#h0-2-22" id="h0-2-22" class="d">-            it.locale to it.content
</a><a href="#h0-2-23" id="h0-2-23" class="d">-        }
</a><a href="#h0-2-24" id="h0-2-24" class="i">+        override fun fetchLocales(userLocale: String) =
</a><a href="#h0-2-25" id="h0-2-25" class="i">+            LocaleWrapper.fetchLocales(context = this@BridgeService, userLocale).associate {
</a><a href="#h0-2-26" id="h0-2-26" class="i">+                it.locale to it.content
</a><a href="#h0-2-27" id="h0-2-27" class="i">+            }
</a> 
         override fun enqueueDownload(intent: Intent, callback: DownloadCallback) {
             DownloadProcessor(
<a href="#h0-2-31" id="h0-2-31" class="d">-                remoteSideContext = SharedContextHolder.remote(this@BridgeService),
</a><a href="#h0-2-32" id="h0-2-32" class="i">+                remoteSideContext = remoteSideContext,
</a>                 callback = callback
             ).onReceive(intent)
         }
<a href="#h0-2-36" id="h0-2-36" class="i">+
</a><a href="#h0-2-37" id="h0-2-37" class="i">+        override fun getRules(objectType: String, uuid: String): MutableList&lt;String&gt; {
</a><a href="#h0-2-38" id="h0-2-38" class="i">+            remoteSideContext.modDatabase.getRulesFromId(RuleScope.valueOf(objectType), uuid)
</a><a href="#h0-2-39" id="h0-2-39" class="i">+                .let { rules -&gt;
</a><a href="#h0-2-40" id="h0-2-40" class="i">+                    return rules.map { it.toJson() }.toMutableList()
</a><a href="#h0-2-41" id="h0-2-41" class="i">+                }
</a><a href="#h0-2-42" id="h0-2-42" class="i">+        }
</a><a href="#h0-2-43" id="h0-2-43" class="i">+
</a><a href="#h0-2-44" id="h0-2-44" class="i">+        override fun sync(callback: SyncCallback) {
</a><a href="#h0-2-45" id="h0-2-45" class="i">+            Logger.debug(&quot;Syncing remote&quot;)
</a><a href="#h0-2-46" id="h0-2-46" class="i">+            syncCallback = callback
</a><a href="#h0-2-47" id="h0-2-47" class="i">+            measureTimeMillis {
</a><a href="#h0-2-48" id="h0-2-48" class="i">+                remoteSideContext.modDatabase.getFriendsIds().forEach { friendId -&gt;
</a><a href="#h0-2-49" id="h0-2-49" class="i">+                    runCatching {
</a><a href="#h0-2-50" id="h0-2-50" class="i">+                        SerializableDataObject.fromJson&lt;FriendInfo&gt;(callback.syncFriend(friendId)).let {
</a><a href="#h0-2-51" id="h0-2-51" class="i">+                            remoteSideContext.modDatabase.syncFriend(it)
</a><a href="#h0-2-52" id="h0-2-52" class="i">+                        }
</a><a href="#h0-2-53" id="h0-2-53" class="i">+                    }.onFailure {
</a><a href="#h0-2-54" id="h0-2-54" class="i">+                        Logger.error(&quot;Failed to sync friend $friendId&quot;, it)
</a><a href="#h0-2-55" id="h0-2-55" class="i">+                    }
</a><a href="#h0-2-56" id="h0-2-56" class="i">+                }
</a><a href="#h0-2-57" id="h0-2-57" class="i">+                remoteSideContext.modDatabase.getGroupsIds().forEach { groupId -&gt;
</a><a href="#h0-2-58" id="h0-2-58" class="i">+                    runCatching {
</a><a href="#h0-2-59" id="h0-2-59" class="i">+                        SerializableDataObject.fromJson&lt;MessagingGroupInfo&gt;(callback.syncGroup(groupId)).let {
</a><a href="#h0-2-60" id="h0-2-60" class="i">+                            remoteSideContext.modDatabase.syncGroupInfo(it)
</a><a href="#h0-2-61" id="h0-2-61" class="i">+                        }
</a><a href="#h0-2-62" id="h0-2-62" class="i">+                    }.onFailure {
</a><a href="#h0-2-63" id="h0-2-63" class="i">+                        Logger.error(&quot;Failed to sync group $groupId&quot;, it)
</a><a href="#h0-2-64" id="h0-2-64" class="i">+                    }
</a><a href="#h0-2-65" id="h0-2-65" class="i">+                }
</a><a href="#h0-2-66" id="h0-2-66" class="i">+            }.also {
</a><a href="#h0-2-67" id="h0-2-67" class="i">+                Logger.debug(&quot;Syncing remote took $it ms&quot;)
</a><a href="#h0-2-68" id="h0-2-68" class="i">+            }
</a><a href="#h0-2-69" id="h0-2-69" class="i">+        }
</a><a href="#h0-2-70" id="h0-2-70" class="i">+
</a><a href="#h0-2-71" id="h0-2-71" class="i">+        override fun passGroupsAndFriends(
</a><a href="#h0-2-72" id="h0-2-72" class="i">+            groups: List&lt;String&gt;,
</a><a href="#h0-2-73" id="h0-2-73" class="i">+            friends: List&lt;String&gt;
</a><a href="#h0-2-74" id="h0-2-74" class="i">+        ) {
</a><a href="#h0-2-75" id="h0-2-75" class="i">+            Logger.debug(&quot;Received ${groups.size} groups and ${friends.size} friends&quot;)
</a><a href="#h0-2-76" id="h0-2-76" class="i">+            remoteSideContext.modDatabase.receiveMessagingDataCallback(
</a><a href="#h0-2-77" id="h0-2-77" class="i">+                friends.map { SerializableDataObject.fromJson&lt;MessagingFriendInfo&gt;(it) },
</a><a href="#h0-2-78" id="h0-2-78" class="i">+                groups.map { SerializableDataObject.fromJson&lt;MessagingGroupInfo&gt;(it) }
</a><a href="#h0-2-79" id="h0-2-79" class="i">+            )
</a><a href="#h0-2-80" id="h0-2-80" class="i">+        }
</a>     }
 }
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/messaging/ModDatabase.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,16 +1,19 @@
</a> package me.rhunk.snapenhance.messaging
 
 import android.database.sqlite.SQLiteDatabase
<a href="#h1-0-3" id="h1-0-3" class="i">+import me.rhunk.snapenhance.Logger
</a> import me.rhunk.snapenhance.RemoteSideContext
 import me.rhunk.snapenhance.core.messaging.FriendStreaks
<a href="#h1-0-6" id="h1-0-6" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
</a><a href="#h1-0-7" id="h1-0-7" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
</a> import me.rhunk.snapenhance.core.messaging.MessagingRule
 import me.rhunk.snapenhance.core.messaging.Mode
<a href="#h1-0-10" id="h1-0-10" class="d">-import me.rhunk.snapenhance.core.messaging.ObjectType
</a><a href="#h1-0-11" id="h1-0-11" class="i">+import me.rhunk.snapenhance.core.messaging.RuleScope
</a> import me.rhunk.snapenhance.database.objects.FriendInfo
 import me.rhunk.snapenhance.util.SQLiteDatabaseHelper
<a href="#h1-0-14" id="h1-0-14" class="d">-import me.rhunk.snapenhance.util.getInteger
</a><a href="#h1-0-15" id="h1-0-15" class="d">-import me.rhunk.snapenhance.util.getLongOrNull
</a><a href="#h1-0-16" id="h1-0-16" class="d">-import me.rhunk.snapenhance.util.getStringOrNull
</a><a href="#h1-0-17" id="h1-0-17" class="i">+import me.rhunk.snapenhance.util.ktx.getInteger
</a><a href="#h1-0-18" id="h1-0-18" class="i">+import me.rhunk.snapenhance.util.ktx.getLongOrNull
</a><a href="#h1-0-19" id="h1-0-19" class="i">+import me.rhunk.snapenhance.util.ktx.getStringOrNull
</a> import java.util.concurrent.Executors
 
 
<a href="#h1-1" id="h1-1" class="h">@@ -20,19 +23,27 @@ class ModDatabase(
</a>     private val executor = Executors.newSingleThreadExecutor()
     private lateinit var database: SQLiteDatabase
 
<a href="#h1-1-3" id="h1-1-3" class="i">+    var receiveMessagingDataCallback: (friends: List&lt;MessagingFriendInfo&gt;, groups: List&lt;MessagingGroupInfo&gt;) -&gt; Unit = { _, _ -&gt; }
</a><a href="#h1-1-4" id="h1-1-4" class="i">+
</a><a href="#h1-1-5" id="h1-1-5" class="i">+
</a>     fun init() {
         database = context.androidContext.openOrCreateDatabase(&quot;main.db&quot;, 0, null)
         SQLiteDatabaseHelper.createTablesFromSchema(database, mapOf(
             &quot;friends&quot; to listOf(
                 &quot;userId VARCHAR PRIMARY KEY&quot;,
                 &quot;displayName VARCHAR&quot;,
<a href="#h1-1-12" id="h1-1-12" class="d">-                &quot;mutable_username VARCHAR&quot;,
</a><a href="#h1-1-13" id="h1-1-13" class="i">+                &quot;mutableUsername VARCHAR&quot;,
</a>                 &quot;bitmojiId VARCHAR&quot;,
                 &quot;selfieId VARCHAR&quot;
             ),
<a href="#h1-1-17" id="h1-1-17" class="i">+            &quot;groups&quot; to listOf(
</a><a href="#h1-1-18" id="h1-1-18" class="i">+                &quot;conversationId VARCHAR PRIMARY KEY&quot;,
</a><a href="#h1-1-19" id="h1-1-19" class="i">+                &quot;name VARCHAR&quot;,
</a><a href="#h1-1-20" id="h1-1-20" class="i">+                &quot;participantsCount INTEGER&quot;
</a><a href="#h1-1-21" id="h1-1-21" class="i">+            ),
</a>             &quot;rules&quot; to listOf(
                 &quot;id INTEGER PRIMARY KEY AUTOINCREMENT&quot;,
<a href="#h1-1-24" id="h1-1-24" class="d">-                &quot;objectType VARCHAR&quot;,
</a><a href="#h1-1-25" id="h1-1-25" class="i">+                &quot;scope VARCHAR&quot;,
</a>                 &quot;targetUuid VARCHAR&quot;,
                 &quot;enabled BOOLEAN&quot;,
                 &quot;mode VARCHAR&quot;,
<a href="#h1-2" id="h1-2" class="h">@@ -59,27 +70,94 @@ class ModDatabase(
</a>         ))
     }
 
<a href="#h1-2-3" id="h1-2-3" class="d">-    fun syncFriends(friends: List&lt;FriendInfo&gt;) {
</a><a href="#h1-2-4" id="h1-2-4" class="i">+    fun getFriendsIds(): List&lt;String&gt; {
</a><a href="#h1-2-5" id="h1-2-5" class="i">+        return database.rawQuery(&quot;SELECT userId FROM friends&quot;, null).use { cursor -&gt;
</a><a href="#h1-2-6" id="h1-2-6" class="i">+            val ids = mutableListOf&lt;String&gt;()
</a><a href="#h1-2-7" id="h1-2-7" class="i">+            while (cursor.moveToNext()) {
</a><a href="#h1-2-8" id="h1-2-8" class="i">+                ids.add(cursor.getString(0))
</a><a href="#h1-2-9" id="h1-2-9" class="i">+            }
</a><a href="#h1-2-10" id="h1-2-10" class="i">+            ids
</a><a href="#h1-2-11" id="h1-2-11" class="i">+        }
</a><a href="#h1-2-12" id="h1-2-12" class="i">+    }
</a><a href="#h1-2-13" id="h1-2-13" class="i">+
</a><a href="#h1-2-14" id="h1-2-14" class="i">+    fun getGroupsIds(): List&lt;String&gt; {
</a><a href="#h1-2-15" id="h1-2-15" class="i">+        return database.rawQuery(&quot;SELECT conversationId FROM groups&quot;, null).use { cursor -&gt;
</a><a href="#h1-2-16" id="h1-2-16" class="i">+            val ids = mutableListOf&lt;String&gt;()
</a><a href="#h1-2-17" id="h1-2-17" class="i">+            while (cursor.moveToNext()) {
</a><a href="#h1-2-18" id="h1-2-18" class="i">+                ids.add(cursor.getString(0))
</a><a href="#h1-2-19" id="h1-2-19" class="i">+            }
</a><a href="#h1-2-20" id="h1-2-20" class="i">+            ids
</a><a href="#h1-2-21" id="h1-2-21" class="i">+        }
</a><a href="#h1-2-22" id="h1-2-22" class="i">+    }
</a><a href="#h1-2-23" id="h1-2-23" class="i">+
</a><a href="#h1-2-24" id="h1-2-24" class="i">+    fun getGroups(): List&lt;MessagingGroupInfo&gt; {
</a><a href="#h1-2-25" id="h1-2-25" class="i">+        return database.rawQuery(&quot;SELECT * FROM groups&quot;, null).use { cursor -&gt;
</a><a href="#h1-2-26" id="h1-2-26" class="i">+            val groups = mutableListOf&lt;MessagingGroupInfo&gt;()
</a><a href="#h1-2-27" id="h1-2-27" class="i">+            while (cursor.moveToNext()) {
</a><a href="#h1-2-28" id="h1-2-28" class="i">+                groups.add(MessagingGroupInfo(
</a><a href="#h1-2-29" id="h1-2-29" class="i">+                    conversationId = cursor.getStringOrNull(&quot;conversationId&quot;)!!,
</a><a href="#h1-2-30" id="h1-2-30" class="i">+                    name = cursor.getStringOrNull(&quot;name&quot;)!!,
</a><a href="#h1-2-31" id="h1-2-31" class="i">+                    participantsCount = cursor.getInteger(&quot;participantsCount&quot;)
</a><a href="#h1-2-32" id="h1-2-32" class="i">+                ))
</a><a href="#h1-2-33" id="h1-2-33" class="i">+            }
</a><a href="#h1-2-34" id="h1-2-34" class="i">+            groups
</a><a href="#h1-2-35" id="h1-2-35" class="i">+        }
</a><a href="#h1-2-36" id="h1-2-36" class="i">+    }
</a><a href="#h1-2-37" id="h1-2-37" class="i">+
</a><a href="#h1-2-38" id="h1-2-38" class="i">+    fun getFriends(): List&lt;MessagingFriendInfo&gt; {
</a><a href="#h1-2-39" id="h1-2-39" class="i">+        return database.rawQuery(&quot;SELECT * FROM friends&quot;, null).use { cursor -&gt;
</a><a href="#h1-2-40" id="h1-2-40" class="i">+            val friends = mutableListOf&lt;MessagingFriendInfo&gt;()
</a><a href="#h1-2-41" id="h1-2-41" class="i">+            while (cursor.moveToNext()) {
</a><a href="#h1-2-42" id="h1-2-42" class="i">+                runCatching {
</a><a href="#h1-2-43" id="h1-2-43" class="i">+                    friends.add(MessagingFriendInfo(
</a><a href="#h1-2-44" id="h1-2-44" class="i">+                        userId = cursor.getStringOrNull(&quot;userId&quot;)!!,
</a><a href="#h1-2-45" id="h1-2-45" class="i">+                        displayName = cursor.getStringOrNull(&quot;displayName&quot;),
</a><a href="#h1-2-46" id="h1-2-46" class="i">+                        mutableUsername = cursor.getStringOrNull(&quot;mutableUsername&quot;)!!,
</a><a href="#h1-2-47" id="h1-2-47" class="i">+                        bitmojiId = cursor.getStringOrNull(&quot;bitmojiId&quot;),
</a><a href="#h1-2-48" id="h1-2-48" class="i">+                        selfieId = cursor.getStringOrNull(&quot;selfieId&quot;)
</a><a href="#h1-2-49" id="h1-2-49" class="i">+                    ))
</a><a href="#h1-2-50" id="h1-2-50" class="i">+                }.onFailure {
</a><a href="#h1-2-51" id="h1-2-51" class="i">+                    Logger.error(&quot;Failed to parse friend&quot;, it)
</a><a href="#h1-2-52" id="h1-2-52" class="i">+                }
</a><a href="#h1-2-53" id="h1-2-53" class="i">+            }
</a><a href="#h1-2-54" id="h1-2-54" class="i">+            friends
</a><a href="#h1-2-55" id="h1-2-55" class="i">+        }
</a><a href="#h1-2-56" id="h1-2-56" class="i">+    }
</a><a href="#h1-2-57" id="h1-2-57" class="i">+
</a><a href="#h1-2-58" id="h1-2-58" class="i">+
</a><a href="#h1-2-59" id="h1-2-59" class="i">+    fun syncGroupInfo(conversationInfo: MessagingGroupInfo) {
</a><a href="#h1-2-60" id="h1-2-60" class="i">+        executor.execute {
</a><a href="#h1-2-61" id="h1-2-61" class="i">+            try {
</a><a href="#h1-2-62" id="h1-2-62" class="i">+                database.execSQL(&quot;INSERT OR REPLACE INTO groups VALUES (?, ?, ?)&quot;, arrayOf(
</a><a href="#h1-2-63" id="h1-2-63" class="i">+                    conversationInfo.conversationId,
</a><a href="#h1-2-64" id="h1-2-64" class="i">+                    conversationInfo.name,
</a><a href="#h1-2-65" id="h1-2-65" class="i">+                    conversationInfo.participantsCount
</a><a href="#h1-2-66" id="h1-2-66" class="i">+                ))
</a><a href="#h1-2-67" id="h1-2-67" class="i">+            } catch (e: Exception) {
</a><a href="#h1-2-68" id="h1-2-68" class="i">+                throw e
</a><a href="#h1-2-69" id="h1-2-69" class="i">+            }
</a><a href="#h1-2-70" id="h1-2-70" class="i">+        }
</a><a href="#h1-2-71" id="h1-2-71" class="i">+    }
</a><a href="#h1-2-72" id="h1-2-72" class="i">+
</a><a href="#h1-2-73" id="h1-2-73" class="i">+    fun syncFriend(friend: FriendInfo) {
</a>         executor.execute {
             try {
<a href="#h1-2-76" id="h1-2-76" class="d">-                friends.forEach { friend -&gt;
</a><a href="#h1-2-77" id="h1-2-77" class="d">-                    database.execSQL(&quot;INSERT OR REPLACE INTO friends VALUES (?, ?, ?, ?, ?)&quot;, arrayOf(
</a><a href="#h1-2-78" id="h1-2-78" class="i">+                database.execSQL(&quot;INSERT OR REPLACE INTO friends VALUES (?, ?, ?, ?, ?)&quot;, arrayOf(
</a><a href="#h1-2-79" id="h1-2-79" class="i">+                    friend.userId,
</a><a href="#h1-2-80" id="h1-2-80" class="i">+                    friend.displayName,
</a><a href="#h1-2-81" id="h1-2-81" class="i">+                    friend.usernameForSorting!!.split(&quot;|&quot;)[1],
</a><a href="#h1-2-82" id="h1-2-82" class="i">+                    friend.bitmojiAvatarId,
</a><a href="#h1-2-83" id="h1-2-83" class="i">+                    friend.bitmojiSelfieId
</a><a href="#h1-2-84" id="h1-2-84" class="i">+                ))
</a><a href="#h1-2-85" id="h1-2-85" class="i">+                //sync streaks
</a><a href="#h1-2-86" id="h1-2-86" class="i">+                if (friend.streakLength &gt; 0) {
</a><a href="#h1-2-87" id="h1-2-87" class="i">+                    database.execSQL(&quot;INSERT OR REPLACE INTO streaks (userId, expirationTimestamp, count) VALUES (?, ?, ?)&quot;, arrayOf(
</a>                         friend.userId,
<a href="#h1-2-89" id="h1-2-89" class="d">-                        friend.displayName,
</a><a href="#h1-2-90" id="h1-2-90" class="d">-                        friend.username,
</a><a href="#h1-2-91" id="h1-2-91" class="d">-                        friend.bitmojiAvatarId,
</a><a href="#h1-2-92" id="h1-2-92" class="d">-                        friend.bitmojiSelfieId
</a><a href="#h1-2-93" id="h1-2-93" class="i">+                        friend.streakExpirationTimestamp,
</a><a href="#h1-2-94" id="h1-2-94" class="i">+                        friend.streakLength
</a>                     ))
<a href="#h1-2-96" id="h1-2-96" class="d">-                    //sync streaks
</a><a href="#h1-2-97" id="h1-2-97" class="d">-                    if (friend.streakLength &gt; 0) {
</a><a href="#h1-2-98" id="h1-2-98" class="d">-                        database.execSQL(&quot;INSERT OR REPLACE INTO streaks (userId, expirationTimestamp, count) VALUES (?, ?, ?)&quot;, arrayOf(
</a><a href="#h1-2-99" id="h1-2-99" class="d">-                            friend.userId,
</a><a href="#h1-2-100" id="h1-2-100" class="d">-                            friend.streakExpirationTimestamp,
</a><a href="#h1-2-101" id="h1-2-101" class="d">-                            friend.streakLength
</a><a href="#h1-2-102" id="h1-2-102" class="d">-                        ))
</a><a href="#h1-2-103" id="h1-2-103" class="d">-                    } else {
</a><a href="#h1-2-104" id="h1-2-104" class="d">-                        database.execSQL(&quot;DELETE FROM streaks WHERE userId = ?&quot;, arrayOf(friend.userId))
</a><a href="#h1-2-105" id="h1-2-105" class="d">-                    }
</a><a href="#h1-2-106" id="h1-2-106" class="i">+                } else {
</a><a href="#h1-2-107" id="h1-2-107" class="i">+                    database.execSQL(&quot;DELETE FROM streaks WHERE userId = ?&quot;, arrayOf(friend.userId))
</a>                 }
             } catch (e: Exception) {
                 throw e
<a href="#h1-3" id="h1-3" class="h">@@ -87,13 +165,13 @@ class ModDatabase(
</a>         }
     }
 
<a href="#h1-3-3" id="h1-3-3" class="d">-    fun getRulesFromId(type: ObjectType, targetUuid: String): List&lt;MessagingRule&gt; {
</a><a href="#h1-3-4" id="h1-3-4" class="i">+    fun getRulesFromId(type: RuleScope, targetUuid: String): List&lt;MessagingRule&gt; {
</a>         return database.rawQuery(&quot;SELECT * FROM rules WHERE objectType = ? AND targetUuid = ?&quot;, arrayOf(type.name, targetUuid)).use { cursor -&gt;
             val rules = mutableListOf&lt;MessagingRule&gt;()
             while (cursor.moveToNext()) {
                 rules.add(MessagingRule(
                     id = cursor.getInteger(&quot;id&quot;),
<a href="#h1-3-10" id="h1-3-10" class="d">-                    objectType = ObjectType.valueOf(cursor.getStringOrNull(&quot;objectType&quot;)!!),
</a><a href="#h1-3-11" id="h1-3-11" class="i">+                    ruleScope = RuleScope.valueOf(cursor.getStringOrNull(&quot;scope&quot;)!!),
</a>                     targetUuid = cursor.getStringOrNull(&quot;targetUuid&quot;)!!,
                     enabled = cursor.getInteger(&quot;enabled&quot;) == 1,
                     mode = Mode.valueOf(cursor.getStringOrNull(&quot;mode&quot;)!!),
<b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Section.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -17,6 +17,7 @@ import me.rhunk.snapenhance.ui.manager.sections.HomeSection
</a> import me.rhunk.snapenhance.ui.manager.sections.NotImplemented
 import me.rhunk.snapenhance.ui.manager.sections.downloads.DownloadsSection
 import me.rhunk.snapenhance.ui.manager.sections.features.FeaturesSection
<a href="#h2-0-3" id="h2-0-3" class="i">+import me.rhunk.snapenhance.ui.manager.sections.social.SocialSection
</a> import kotlin.reflect.KClass
 
 enum class EnumSection(
<a href="#h2-1" id="h2-1" class="h">@@ -39,9 +40,10 @@ enum class EnumSection(
</a>         icon = Icons.Filled.Home,
         section = HomeSection::class
     ),
<a href="#h2-1-3" id="h2-1-3" class="d">-    FRIENDS(
</a><a href="#h2-1-4" id="h2-1-4" class="d">-        route = &quot;friends&quot;,
</a><a href="#h2-1-5" id="h2-1-5" class="d">-        icon = Icons.Filled.Group
</a><a href="#h2-1-6" id="h2-1-6" class="i">+    SOCIAL(
</a><a href="#h2-1-7" id="h2-1-7" class="i">+        route = &quot;social&quot;,
</a><a href="#h2-1-8" id="h2-1-8" class="i">+        icon = Icons.Filled.Group,
</a><a href="#h2-1-9" id="h2-1-9" class="i">+        section = SocialSection::class
</a>     ),
     PLUGINS(
         route = &quot;plugins&quot;,
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/downloads/DownloadsSection.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -34,9 +34,11 @@ import androidx.compose.material3.RadioButton
</a> import androidx.compose.material3.Text
 import androidx.compose.runtime.Composable
 import androidx.compose.runtime.LaunchedEffect
<a href="#h3-0-3" id="h3-0-3" class="i">+import androidx.compose.runtime.getValue
</a> import androidx.compose.runtime.mutableStateOf
 import androidx.compose.runtime.remember
 import androidx.compose.runtime.rememberCoroutineScope
<a href="#h3-0-7" id="h3-0-7" class="i">+import androidx.compose.runtime.setValue
</a> import androidx.compose.ui.Alignment
 import androidx.compose.ui.Modifier
 import androidx.compose.ui.draw.blur
<a href="#h3-1" id="h3-1" class="h">@@ -102,15 +104,15 @@ class DownloadsSection : Section() {
</a>     @Composable
     private fun FilterList() {
         val coroutineScope = rememberCoroutineScope()
<a href="#h3-1-3" id="h3-1-3" class="d">-        val showMenu = remember { mutableStateOf(false) }
</a><a href="#h3-1-4" id="h3-1-4" class="d">-        IconButton(onClick = { showMenu.value = !showMenu.value}) {
</a><a href="#h3-1-5" id="h3-1-5" class="i">+        var showMenu by remember { mutableStateOf(false) }
</a><a href="#h3-1-6" id="h3-1-6" class="i">+        IconButton(onClick = { showMenu = !showMenu}) {
</a>             Icon(
                 imageVector = Icons.Default.FilterList,
                 contentDescription = null
             )
         }
 
<a href="#h3-1-13" id="h3-1-13" class="d">-        DropdownMenu(expanded = showMenu.value, onDismissRequest = { showMenu.value = false }) {
</a><a href="#h3-1-14" id="h3-1-14" class="i">+        DropdownMenu(expanded = showMenu, onDismissRequest = { showMenu = false }) {
</a>             MediaFilter.values().toList().forEach { filter -&gt;
                 DropdownMenuItem(
                     text = {
<a href="#h3-2" id="h3-2" class="h">@@ -130,7 +132,7 @@ class DownloadsSection : Section() {
</a>                     onClick = {
                         coroutineScope.launch {
                             loadByFilter(filter)
<a href="#h3-2-3" id="h3-2-3" class="d">-                            showMenu.value = false
</a><a href="#h3-2-4" id="h3-2-4" class="i">+                            showMenu = false
</a>                         }
                     }
                 )
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/Dialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/Dialogs.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/Dialogs.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/Dialogs.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -18,8 +18,10 @@ import androidx.compose.material3.Switch
</a> import androidx.compose.material3.Text
 import androidx.compose.material3.TextField
 import androidx.compose.runtime.Composable
<a href="#h4-0-3" id="h4-0-3" class="i">+import androidx.compose.runtime.getValue
</a> import androidx.compose.runtime.mutableStateOf
 import androidx.compose.runtime.remember
<a href="#h4-0-6" id="h4-0-6" class="i">+import androidx.compose.runtime.setValue
</a> import androidx.compose.ui.Alignment
 import androidx.compose.ui.Modifier
 import androidx.compose.ui.focus.FocusRequester
<a href="#h4-1" id="h4-1" class="h">@@ -72,14 +74,14 @@ class Dialogs(
</a>             add(0, &quot;null&quot;)
         }
 
<a href="#h4-1-3" id="h4-1-3" class="d">-        val selectedValue = remember {
</a><a href="#h4-1-4" id="h4-1-4" class="i">+        var selectedValue by remember {
</a>             mutableStateOf(property.value.getNullable()?.toString() ?: &quot;null&quot;)
         }
 
         DefaultDialogCard {
             keys.forEachIndexed { index, item -&gt;
                 fun select() {
<a href="#h4-1-11" id="h4-1-11" class="d">-                    selectedValue.value = item
</a><a href="#h4-1-12" id="h4-1-12" class="i">+                    selectedValue = item
</a>                     property.value.setAny(if (index == 0) {
                         null
                     } else {
<a href="#h4-2" id="h4-2" class="h">@@ -97,7 +99,7 @@ class Dialogs(
</a>                         modifier = Modifier.weight(1f)
                     )
                     RadioButton(
<a href="#h4-2-3" id="h4-2-3" class="d">-                        selected = selectedValue.value == item,
</a><a href="#h4-2-4" id="h4-2-4" class="i">+                        selected = selectedValue == item,
</a>                         onClick = { select() }
                     )
                 }
<a href="#h4-3" id="h4-3" class="h">@@ -179,13 +181,11 @@ class Dialogs(
</a>         val toggledStates = property.value.get() as MutableList&lt;String&gt;
         DefaultDialogCard {
             defaultItems.forEach { key -&gt;
<a href="#h4-3-3" id="h4-3-3" class="d">-                val state = remember {
</a><a href="#h4-3-4" id="h4-3-4" class="d">-                    mutableStateOf(toggledStates.contains(key))
</a><a href="#h4-3-5" id="h4-3-5" class="d">-                }
</a><a href="#h4-3-6" id="h4-3-6" class="i">+                var state by remember { mutableStateOf(toggledStates.contains(key)) }
</a> 
                 fun toggle(value: Boolean? = null) {
<a href="#h4-3-9" id="h4-3-9" class="d">-                    state.value = value ?: !state.value
</a><a href="#h4-3-10" id="h4-3-10" class="d">-                    if (state.value) {
</a><a href="#h4-3-11" id="h4-3-11" class="i">+                    state = value ?: !state
</a><a href="#h4-3-12" id="h4-3-12" class="i">+                    if (state) {
</a>                         toggledStates.add(key)
                     } else {
                         toggledStates.remove(key)
<a href="#h4-4" id="h4-4" class="h">@@ -203,7 +203,7 @@ class Dialogs(
</a>                             .weight(1f)
                     )
                     Switch(
<a href="#h4-4-3" id="h4-4-3" class="d">-                        checked = state.value,
</a><a href="#h4-4-4" id="h4-4-4" class="i">+                        checked = state,
</a>                         onCheckedChange = {
                             toggle(it)
                         }
<b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/features/FeaturesSection.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -44,9 +44,11 @@ import androidx.compose.material3.TextFieldDefaults
</a> import androidx.compose.material3.rememberBottomSheetScaffoldState
 import androidx.compose.runtime.Composable
 import androidx.compose.runtime.LaunchedEffect
<a href="#h5-0-3" id="h5-0-3" class="i">+import androidx.compose.runtime.getValue
</a> import androidx.compose.runtime.mutableStateOf
 import androidx.compose.runtime.remember
 import androidx.compose.runtime.rememberCoroutineScope
<a href="#h5-0-7" id="h5-0-7" class="i">+import androidx.compose.runtime.setValue
</a> import androidx.compose.ui.Alignment
 import androidx.compose.ui.Modifier
 import androidx.compose.ui.focus.FocusRequester
<a href="#h5-1" id="h5-1" class="h">@@ -172,18 +174,16 @@ class FeaturesSection : Section() {
</a> 
     @Composable
     private fun PropertyAction(property: PropertyPair&lt;*&gt;, registerClickCallback: RegisterClickCallback) {
<a href="#h5-1-3" id="h5-1-3" class="d">-        val showDialog = remember { mutableStateOf(false) }
</a><a href="#h5-1-4" id="h5-1-4" class="d">-        val dialogComposable = remember { mutableStateOf&lt;@Composable () -&gt; Unit&gt;({}) }
</a><a href="#h5-1-5" id="h5-1-5" class="i">+        var showDialog by remember { mutableStateOf(false) }
</a><a href="#h5-1-6" id="h5-1-6" class="i">+        var dialogComposable by remember { mutableStateOf&lt;@Composable () -&gt; Unit&gt;({}) }
</a> 
<a href="#h5-1-8" id="h5-1-8" class="d">-        fun registerDialogOnClickCallback() = registerClickCallback {
</a><a href="#h5-1-9" id="h5-1-9" class="d">-            showDialog.value = true
</a><a href="#h5-1-10" id="h5-1-10" class="d">-        }
</a><a href="#h5-1-11" id="h5-1-11" class="i">+        fun registerDialogOnClickCallback() = registerClickCallback { showDialog = true }
</a> 
<a href="#h5-1-13" id="h5-1-13" class="d">-        if (showDialog.value) {
</a><a href="#h5-1-14" id="h5-1-14" class="i">+        if (showDialog) {
</a>             Dialog(
<a href="#h5-1-16" id="h5-1-16" class="d">-                onDismissRequest = { showDialog.value = false }
</a><a href="#h5-1-17" id="h5-1-17" class="i">+                onDismissRequest = { showDialog = false }
</a>             ) {
<a href="#h5-1-19" id="h5-1-19" class="d">-                dialogComposable.value()
</a><a href="#h5-1-20" id="h5-1-20" class="i">+                dialogComposable()
</a>             }
         }
 
<a href="#h5-2" id="h5-2" class="h">@@ -203,12 +203,12 @@ class FeaturesSection : Section() {
</a> 
         when (val dataType = remember { property.key.dataType.type }) {
             DataProcessors.Type.BOOLEAN -&gt; {
<a href="#h5-2-3" id="h5-2-3" class="d">-                val state = remember { mutableStateOf(propertyValue.get() as Boolean) }
</a><a href="#h5-2-4" id="h5-2-4" class="i">+                var state by remember { mutableStateOf(propertyValue.get() as Boolean) }
</a>                 Switch(
<a href="#h5-2-6" id="h5-2-6" class="d">-                    checked = state.value,
</a><a href="#h5-2-7" id="h5-2-7" class="i">+                    checked = state,
</a>                     onCheckedChange = registerClickCallback {
<a href="#h5-2-9" id="h5-2-9" class="d">-                        state.value = state.value.not()
</a><a href="#h5-2-10" id="h5-2-10" class="d">-                        propertyValue.setAny(state.value)
</a><a href="#h5-2-11" id="h5-2-11" class="i">+                        state = state.not()
</a><a href="#h5-2-12" id="h5-2-12" class="i">+                        propertyValue.setAny(state)
</a>                     }
                 )
             }
<a href="#h5-3" id="h5-3" class="h">@@ -216,7 +216,7 @@ class FeaturesSection : Section() {
</a>             DataProcessors.Type.STRING_UNIQUE_SELECTION -&gt; {
                 registerDialogOnClickCallback()
 
<a href="#h5-3-3" id="h5-3-3" class="d">-                dialogComposable.value = {
</a><a href="#h5-3-4" id="h5-3-4" class="i">+                dialogComposable = {
</a>                     dialogs.UniqueSelectionDialog(property)
                 }
 
<a href="#h5-4" id="h5-4" class="h">@@ -233,13 +233,13 @@ class FeaturesSection : Section() {
</a>             }
 
             DataProcessors.Type.STRING_MULTIPLE_SELECTION, DataProcessors.Type.STRING, DataProcessors.Type.INTEGER, DataProcessors.Type.FLOAT -&gt; {
<a href="#h5-4-3" id="h5-4-3" class="d">-                dialogComposable.value = {
</a><a href="#h5-4-4" id="h5-4-4" class="i">+                dialogComposable = {
</a>                     when (dataType) {
                         DataProcessors.Type.STRING_MULTIPLE_SELECTION -&gt; {
                             dialogs.MultipleSelectionDialog(property)
                         }
                         DataProcessors.Type.STRING, DataProcessors.Type.INTEGER, DataProcessors.Type.FLOAT -&gt; {
<a href="#h5-4-10" id="h5-4-10" class="d">-                            dialogs.KeyboardInputDialog(property) { showDialog.value = false }
</a><a href="#h5-4-11" id="h5-4-11" class="i">+                            dialogs.KeyboardInputDialog(property) { showDialog = false }
</a>                         }
                         else -&gt; {}
                     }
<a href="#h5-5" id="h5-5" class="h">@@ -271,7 +271,7 @@ class FeaturesSection : Section() {
</a> 
                 if (container.globalState == null) return
 
<a href="#h5-5-3" id="h5-5-3" class="d">-                val state = remember { mutableStateOf(container.globalState!!) }
</a><a href="#h5-5-4" id="h5-5-4" class="i">+                var state by remember { mutableStateOf(container.globalState!!) }
</a> 
                 Box(
                     modifier = Modifier
<a href="#h5-6" id="h5-6" class="h">@@ -288,10 +288,10 @@ class FeaturesSection : Section() {
</a>                 }
 
                 Switch(
<a href="#h5-6-3" id="h5-6-3" class="d">-                    checked = state.value,
</a><a href="#h5-6-4" id="h5-6-4" class="i">+                    checked = state,
</a>                     onCheckedChange = {
<a href="#h5-6-6" id="h5-6-6" class="d">-                        state.value = state.value.not()
</a><a href="#h5-6-7" id="h5-6-7" class="d">-                        container.globalState = state.value
</a><a href="#h5-6-8" id="h5-6-8" class="i">+                        state = state.not()
</a><a href="#h5-6-9" id="h5-6-9" class="i">+                        container.globalState = state
</a>                     }
                 )
             }
<a href="#h5-7" id="h5-7" class="h">@@ -301,7 +301,7 @@ class FeaturesSection : Section() {
</a> 
     @Composable
     private fun PropertyCard(property: PropertyPair&lt;*&gt;) {
<a href="#h5-7-3" id="h5-7-3" class="d">-        val clickCallback = remember { mutableStateOf&lt;ClickCallback?&gt;(null) }
</a><a href="#h5-7-4" id="h5-7-4" class="i">+        var clickCallback by remember { mutableStateOf&lt;ClickCallback?&gt;(null) }
</a>         Card(
             modifier = Modifier
                 .fillMaxWidth()
<a href="#h5-8" id="h5-8" class="h">@@ -311,7 +311,7 @@ class FeaturesSection : Section() {
</a>                 modifier = Modifier
                     .fillMaxSize()
                     .clickable {
<a href="#h5-8-3" id="h5-8-3" class="d">-                        clickCallback.value?.invoke(true)
</a><a href="#h5-8-4" id="h5-8-4" class="i">+                        clickCallback?.invoke(true)
</a>                     }
                     .padding(all = 4.dp),
                 horizontalArrangement = Arrangement.SpaceBetween
<a href="#h5-9" id="h5-9" class="h">@@ -371,7 +371,7 @@ class FeaturesSection : Section() {
</a>                     verticalAlignment = Alignment.CenterVertically
                 ) {
                     PropertyAction(property, registerClickCallback = { callback -&gt;
<a href="#h5-9-3" id="h5-9-3" class="d">-                        clickCallback.value = callback
</a><a href="#h5-9-4" id="h5-9-4" class="i">+                        clickCallback = callback
</a>                         callback
                     })
                 }
<a href="#h5-10" id="h5-10" class="h">@@ -381,20 +381,20 @@ class FeaturesSection : Section() {
</a> 
     @Composable
     private fun FeatureSearchBar(rowScope: RowScope, focusRequester: FocusRequester) {
<a href="#h5-10-3" id="h5-10-3" class="d">-        val searchValue = remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h5-10-4" id="h5-10-4" class="i">+        var searchValue by remember { mutableStateOf(&quot;&quot;) }
</a>         val scope = rememberCoroutineScope()
<a href="#h5-10-6" id="h5-10-6" class="d">-        val currentSearchJob = remember { mutableStateOf&lt;Job?&gt;(null) }
</a><a href="#h5-10-7" id="h5-10-7" class="i">+        var currentSearchJob by remember { mutableStateOf&lt;Job?&gt;(null) }
</a> 
         rowScope.apply {
             TextField(
<a href="#h5-10-11" id="h5-10-11" class="d">-                value = searchValue.value,
</a><a href="#h5-10-12" id="h5-10-12" class="i">+                value = searchValue,
</a>                 onValueChange = { keyword -&gt;
<a href="#h5-10-14" id="h5-10-14" class="d">-                    searchValue.value = keyword
</a><a href="#h5-10-15" id="h5-10-15" class="i">+                    searchValue = keyword
</a>                     if (keyword.isEmpty()) {
                         navController.navigate(MAIN_ROUTE)
                         return@TextField
                     }
<a href="#h5-10-20" id="h5-10-20" class="d">-                    currentSearchJob.value?.cancel()
</a><a href="#h5-10-21" id="h5-10-21" class="i">+                    currentSearchJob?.cancel()
</a>                     scope.launch {
                         delay(300)
                         navController.navigate(SEARCH_FEATURE_ROUTE.replace(&quot;{keyword}&quot;, keyword), NavOptions.Builder()
<a href="#h5-11" id="h5-11" class="h">@@ -402,7 +402,7 @@ class FeaturesSection : Section() {
</a>                             .setPopUpTo(MAIN_ROUTE, false)
                             .build()
                         )
<a href="#h5-11-3" id="h5-11-3" class="d">-                    }.also { currentSearchJob.value = it }
</a><a href="#h5-11-4" id="h5-11-4" class="i">+                    }.also { currentSearchJob = it }
</a>                 },
 
                 keyboardActions = KeyboardActions(onDone = {
<a href="#h5-12" id="h5-12" class="h">@@ -428,10 +428,10 @@ class FeaturesSection : Section() {
</a> 
     @Composable
     override fun TopBarActions(rowScope: RowScope) {
<a href="#h5-12-3" id="h5-12-3" class="d">-        val showSearchBar = remember { mutableStateOf(false) }
</a><a href="#h5-12-4" id="h5-12-4" class="i">+        var showSearchBar by remember { mutableStateOf(false) }
</a>         val focusRequester = remember { FocusRequester() }
 
<a href="#h5-12-7" id="h5-12-7" class="d">-        if (showSearchBar.value) {
</a><a href="#h5-12-8" id="h5-12-8" class="i">+        if (showSearchBar) {
</a>             FeatureSearchBar(rowScope, focusRequester)
             LaunchedEffect(true) {
                 focusRequester.requestFocus()
<a href="#h5-13" id="h5-13" class="h">@@ -439,13 +439,13 @@ class FeaturesSection : Section() {
</a>         }
 
         IconButton(onClick = {
<a href="#h5-13-3" id="h5-13-3" class="d">-            showSearchBar.value = showSearchBar.value.not()
</a><a href="#h5-13-4" id="h5-13-4" class="d">-            if (!showSearchBar.value &amp;&amp; navController.currentBackStackEntry?.destination?.route == SEARCH_FEATURE_ROUTE) {
</a><a href="#h5-13-5" id="h5-13-5" class="i">+            showSearchBar = showSearchBar.not()
</a><a href="#h5-13-6" id="h5-13-6" class="i">+            if (!showSearchBar &amp;&amp; navController.currentBackStackEntry?.destination?.route == SEARCH_FEATURE_ROUTE) {
</a>                 navController.navigate(MAIN_ROUTE)
             }
         }) {
             Icon(
<a href="#h5-13-11" id="h5-13-11" class="d">-                imageVector = if (showSearchBar.value) Icons.Filled.Close
</a><a href="#h5-13-12" id="h5-13-12" class="i">+                imageVector = if (showSearchBar) Icons.Filled.Close
</a>                     else Icons.Filled.Search,
                 contentDescription = null
             )
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/AddFriendDialog.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,123 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.sections.social
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+import androidx.compose.foundation.layout.Spacer
</a><a href="#h6-0-3" id="h6-0-3" class="i">+import androidx.compose.foundation.layout.fillMaxSize
</a><a href="#h6-0-4" id="h6-0-4" class="i">+import androidx.compose.foundation.layout.padding
</a><a href="#h6-0-5" id="h6-0-5" class="i">+import androidx.compose.foundation.layout.size
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h6-0-7" id="h6-0-7" class="i">+import androidx.compose.material3.Card
</a><a href="#h6-0-8" id="h6-0-8" class="i">+import androidx.compose.material3.CircularProgressIndicator
</a><a href="#h6-0-9" id="h6-0-9" class="i">+import androidx.compose.material3.MaterialTheme
</a><a href="#h6-0-10" id="h6-0-10" class="i">+import androidx.compose.material3.Text
</a><a href="#h6-0-11" id="h6-0-11" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h6-0-12" id="h6-0-12" class="i">+import androidx.compose.runtime.LaunchedEffect
</a><a href="#h6-0-13" id="h6-0-13" class="i">+import androidx.compose.runtime.getValue
</a><a href="#h6-0-14" id="h6-0-14" class="i">+import androidx.compose.runtime.mutableStateOf
</a><a href="#h6-0-15" id="h6-0-15" class="i">+import androidx.compose.runtime.remember
</a><a href="#h6-0-16" id="h6-0-16" class="i">+import androidx.compose.runtime.rememberCoroutineScope
</a><a href="#h6-0-17" id="h6-0-17" class="i">+import androidx.compose.runtime.setValue
</a><a href="#h6-0-18" id="h6-0-18" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h6-0-19" id="h6-0-19" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h6-0-20" id="h6-0-20" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h6-0-21" id="h6-0-21" class="i">+import androidx.compose.ui.window.Dialog
</a><a href="#h6-0-22" id="h6-0-22" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h6-0-23" id="h6-0-23" class="i">+import kotlinx.coroutines.Job
</a><a href="#h6-0-24" id="h6-0-24" class="i">+import kotlinx.coroutines.delay
</a><a href="#h6-0-25" id="h6-0-25" class="i">+import kotlinx.coroutines.launch
</a><a href="#h6-0-26" id="h6-0-26" class="i">+import kotlinx.coroutines.withContext
</a><a href="#h6-0-27" id="h6-0-27" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h6-0-28" id="h6-0-28" class="i">+import me.rhunk.snapenhance.RemoteSideContext
</a><a href="#h6-0-29" id="h6-0-29" class="i">+import me.rhunk.snapenhance.bridge.BridgeClient
</a><a href="#h6-0-30" id="h6-0-30" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
</a><a href="#h6-0-31" id="h6-0-31" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
</a><a href="#h6-0-32" id="h6-0-32" class="i">+import me.rhunk.snapenhance.util.snap.SnapWidgetBroadcastReceiverHelper
</a><a href="#h6-0-33" id="h6-0-33" class="i">+
</a><a href="#h6-0-34" id="h6-0-34" class="i">+class AddFriendDialog(
</a><a href="#h6-0-35" id="h6-0-35" class="i">+    private val context: RemoteSideContext,
</a><a href="#h6-0-36" id="h6-0-36" class="i">+    private val section: SocialSection,
</a><a href="#h6-0-37" id="h6-0-37" class="i">+) {
</a><a href="#h6-0-38" id="h6-0-38" class="i">+
</a><a href="#h6-0-39" id="h6-0-39" class="i">+
</a><a href="#h6-0-40" id="h6-0-40" class="i">+    @Composable
</a><a href="#h6-0-41" id="h6-0-41" class="i">+    private fun ListCardEntry(name: String) {
</a><a href="#h6-0-42" id="h6-0-42" class="i">+        Card(
</a><a href="#h6-0-43" id="h6-0-43" class="i">+            modifier = Modifier.padding(5.dp),
</a><a href="#h6-0-44" id="h6-0-44" class="i">+        ) {
</a><a href="#h6-0-45" id="h6-0-45" class="i">+            Text(text = name, modifier = Modifier.padding(10.dp))
</a><a href="#h6-0-46" id="h6-0-46" class="i">+        }
</a><a href="#h6-0-47" id="h6-0-47" class="i">+    }
</a><a href="#h6-0-48" id="h6-0-48" class="i">+
</a><a href="#h6-0-49" id="h6-0-49" class="i">+
</a><a href="#h6-0-50" id="h6-0-50" class="i">+    @Composable
</a><a href="#h6-0-51" id="h6-0-51" class="i">+    fun Content(dismiss: () -&gt; Unit = { }) {
</a><a href="#h6-0-52" id="h6-0-52" class="i">+        var cachedFriends by remember { mutableStateOf(null as List&lt;MessagingFriendInfo&gt;?) }
</a><a href="#h6-0-53" id="h6-0-53" class="i">+        var cachedGroups by remember { mutableStateOf(null as List&lt;MessagingGroupInfo&gt;?) }
</a><a href="#h6-0-54" id="h6-0-54" class="i">+
</a><a href="#h6-0-55" id="h6-0-55" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h6-0-56" id="h6-0-56" class="i">+
</a><a href="#h6-0-57" id="h6-0-57" class="i">+        var timeoutJob: Job? = null
</a><a href="#h6-0-58" id="h6-0-58" class="i">+        var hasFetchError by remember { mutableStateOf(false) }
</a><a href="#h6-0-59" id="h6-0-59" class="i">+
</a><a href="#h6-0-60" id="h6-0-60" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h6-0-61" id="h6-0-61" class="i">+            context.modDatabase.receiveMessagingDataCallback = { friends, groups -&gt;
</a><a href="#h6-0-62" id="h6-0-62" class="i">+                cachedFriends = friends
</a><a href="#h6-0-63" id="h6-0-63" class="i">+                cachedGroups = groups
</a><a href="#h6-0-64" id="h6-0-64" class="i">+                timeoutJob?.cancel()
</a><a href="#h6-0-65" id="h6-0-65" class="i">+                hasFetchError = false
</a><a href="#h6-0-66" id="h6-0-66" class="i">+            }
</a><a href="#h6-0-67" id="h6-0-67" class="i">+            SnapWidgetBroadcastReceiverHelper.create(BridgeClient.BRIDGE_SYNC_ACTION) {}.also {
</a><a href="#h6-0-68" id="h6-0-68" class="i">+                runCatching {
</a><a href="#h6-0-69" id="h6-0-69" class="i">+                    context.androidContext.sendBroadcast(it)
</a><a href="#h6-0-70" id="h6-0-70" class="i">+                }.onFailure {
</a><a href="#h6-0-71" id="h6-0-71" class="i">+                    Logger.error(&quot;Failed to send broadcast&quot;, it)
</a><a href="#h6-0-72" id="h6-0-72" class="i">+                    hasFetchError = true
</a><a href="#h6-0-73" id="h6-0-73" class="i">+                }
</a><a href="#h6-0-74" id="h6-0-74" class="i">+            }
</a><a href="#h6-0-75" id="h6-0-75" class="i">+            timeoutJob = coroutineScope.launch {
</a><a href="#h6-0-76" id="h6-0-76" class="i">+                withContext(Dispatchers.IO) {
</a><a href="#h6-0-77" id="h6-0-77" class="i">+                    delay(10000)
</a><a href="#h6-0-78" id="h6-0-78" class="i">+                    hasFetchError = true
</a><a href="#h6-0-79" id="h6-0-79" class="i">+                }
</a><a href="#h6-0-80" id="h6-0-80" class="i">+            }
</a><a href="#h6-0-81" id="h6-0-81" class="i">+        }
</a><a href="#h6-0-82" id="h6-0-82" class="i">+
</a><a href="#h6-0-83" id="h6-0-83" class="i">+        Dialog(onDismissRequest = {
</a><a href="#h6-0-84" id="h6-0-84" class="i">+            timeoutJob?.cancel()
</a><a href="#h6-0-85" id="h6-0-85" class="i">+            dismiss()
</a><a href="#h6-0-86" id="h6-0-86" class="i">+        }) {
</a><a href="#h6-0-87" id="h6-0-87" class="i">+            if (hasFetchError) {
</a><a href="#h6-0-88" id="h6-0-88" class="i">+                Text(text = &quot;Failed to load friends and groups. Make sure Snapchat is installed and logged in.&quot;)
</a><a href="#h6-0-89" id="h6-0-89" class="i">+                return@Dialog
</a><a href="#h6-0-90" id="h6-0-90" class="i">+            }
</a><a href="#h6-0-91" id="h6-0-91" class="i">+            if (cachedGroups == null || cachedFriends == null) {
</a><a href="#h6-0-92" id="h6-0-92" class="i">+                CircularProgressIndicator(
</a><a href="#h6-0-93" id="h6-0-93" class="i">+                    modifier = Modifier
</a><a href="#h6-0-94" id="h6-0-94" class="i">+                        .padding()
</a><a href="#h6-0-95" id="h6-0-95" class="i">+                        .size(30.dp),
</a><a href="#h6-0-96" id="h6-0-96" class="i">+                    strokeWidth = 3.dp,
</a><a href="#h6-0-97" id="h6-0-97" class="i">+                    color = MaterialTheme.colorScheme.onPrimary
</a><a href="#h6-0-98" id="h6-0-98" class="i">+                )
</a><a href="#h6-0-99" id="h6-0-99" class="i">+                return@Dialog
</a><a href="#h6-0-100" id="h6-0-100" class="i">+            }
</a><a href="#h6-0-101" id="h6-0-101" class="i">+
</a><a href="#h6-0-102" id="h6-0-102" class="i">+            LazyColumn(
</a><a href="#h6-0-103" id="h6-0-103" class="i">+                modifier = Modifier.fillMaxSize()
</a><a href="#h6-0-104" id="h6-0-104" class="i">+            ) {
</a><a href="#h6-0-105" id="h6-0-105" class="i">+                item {
</a><a href="#h6-0-106" id="h6-0-106" class="i">+                    Text(text = &quot;Groups&quot;, fontSize = 20.sp)
</a><a href="#h6-0-107" id="h6-0-107" class="i">+                    Spacer(modifier = Modifier.padding(5.dp))
</a><a href="#h6-0-108" id="h6-0-108" class="i">+                }
</a><a href="#h6-0-109" id="h6-0-109" class="i">+                items(cachedGroups!!.size) {
</a><a href="#h6-0-110" id="h6-0-110" class="i">+                    ListCardEntry(name = cachedGroups!![it].name)
</a><a href="#h6-0-111" id="h6-0-111" class="i">+                }
</a><a href="#h6-0-112" id="h6-0-112" class="i">+                item {
</a><a href="#h6-0-113" id="h6-0-113" class="i">+                    Text(text = &quot;Friends&quot;, fontSize = 20.sp)
</a><a href="#h6-0-114" id="h6-0-114" class="i">+                    Spacer(modifier = Modifier.padding(5.dp))
</a><a href="#h6-0-115" id="h6-0-115" class="i">+                }
</a><a href="#h6-0-116" id="h6-0-116" class="i">+                items(cachedFriends!!.size) {
</a><a href="#h6-0-117" id="h6-0-117" class="i">+                    ListCardEntry(name = cachedFriends!![it].displayName ?: cachedFriends!![it].mutableUsername)
</a><a href="#h6-0-118" id="h6-0-118" class="i">+                }
</a><a href="#h6-0-119" id="h6-0-119" class="i">+            }
</a><a href="#h6-0-120" id="h6-0-120" class="i">+        }
</a><a href="#h6-0-121" id="h6-0-121" class="i">+    }
</a><a href="#h6-0-122" id="h6-0-122" class="i">+}</a><a href="#h6-0-123" id="h6-0-123" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/FriendTab.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -0,0 +1,4 @@
</a><a href="#h7-0-0" id="h7-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.sections.social
</a><a href="#h7-0-1" id="h7-0-1" class="i">+
</a><a href="#h7-0-2" id="h7-0-2" class="i">+class FriendTab {
</a><a href="#h7-0-3" id="h7-0-3" class="i">+}</a><a href="#h7-0-4" id="h7-0-4" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/sections/social/SocialSection.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,130 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.sections.social
</a><a href="#h8-0-1" id="h8-0-1" class="i">+
</a><a href="#h8-0-2" id="h8-0-2" class="i">+import androidx.compose.foundation.ExperimentalFoundationApi
</a><a href="#h8-0-3" id="h8-0-3" class="i">+import androidx.compose.foundation.layout.Column
</a><a href="#h8-0-4" id="h8-0-4" class="i">+import androidx.compose.foundation.layout.fillMaxSize
</a><a href="#h8-0-5" id="h8-0-5" class="i">+import androidx.compose.foundation.layout.padding
</a><a href="#h8-0-6" id="h8-0-6" class="i">+import androidx.compose.foundation.pager.HorizontalPager
</a><a href="#h8-0-7" id="h8-0-7" class="i">+import androidx.compose.foundation.pager.rememberPagerState
</a><a href="#h8-0-8" id="h8-0-8" class="i">+import androidx.compose.foundation.shape.RoundedCornerShape
</a><a href="#h8-0-9" id="h8-0-9" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h8-0-10" id="h8-0-10" class="i">+import androidx.compose.material.icons.rounded.Add
</a><a href="#h8-0-11" id="h8-0-11" class="i">+import androidx.compose.material3.FloatingActionButton
</a><a href="#h8-0-12" id="h8-0-12" class="i">+import androidx.compose.material3.Icon
</a><a href="#h8-0-13" id="h8-0-13" class="i">+import androidx.compose.material3.MaterialTheme
</a><a href="#h8-0-14" id="h8-0-14" class="i">+import androidx.compose.material3.Scaffold
</a><a href="#h8-0-15" id="h8-0-15" class="i">+import androidx.compose.material3.Tab
</a><a href="#h8-0-16" id="h8-0-16" class="i">+import androidx.compose.material3.TabRow
</a><a href="#h8-0-17" id="h8-0-17" class="i">+import androidx.compose.material3.TabRowDefaults
</a><a href="#h8-0-18" id="h8-0-18" class="i">+import androidx.compose.material3.Text
</a><a href="#h8-0-19" id="h8-0-19" class="i">+import androidx.compose.runtime.Composable
</a><a href="#h8-0-20" id="h8-0-20" class="i">+import androidx.compose.runtime.getValue
</a><a href="#h8-0-21" id="h8-0-21" class="i">+import androidx.compose.runtime.mutableStateOf
</a><a href="#h8-0-22" id="h8-0-22" class="i">+import androidx.compose.runtime.remember
</a><a href="#h8-0-23" id="h8-0-23" class="i">+import androidx.compose.runtime.rememberCoroutineScope
</a><a href="#h8-0-24" id="h8-0-24" class="i">+import androidx.compose.runtime.setValue
</a><a href="#h8-0-25" id="h8-0-25" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h8-0-26" id="h8-0-26" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h8-0-27" id="h8-0-27" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h8-0-28" id="h8-0-28" class="i">+import kotlinx.coroutines.launch
</a><a href="#h8-0-29" id="h8-0-29" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
</a><a href="#h8-0-30" id="h8-0-30" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
</a><a href="#h8-0-31" id="h8-0-31" class="i">+import me.rhunk.snapenhance.ui.manager.Section
</a><a href="#h8-0-32" id="h8-0-32" class="i">+import me.rhunk.snapenhance.ui.util.pagerTabIndicatorOffset
</a><a href="#h8-0-33" id="h8-0-33" class="i">+
</a><a href="#h8-0-34" id="h8-0-34" class="i">+class SocialSection : Section() {
</a><a href="#h8-0-35" id="h8-0-35" class="i">+    private lateinit var friendList: List&lt;MessagingFriendInfo&gt;
</a><a href="#h8-0-36" id="h8-0-36" class="i">+    private lateinit var groupList: List&lt;MessagingGroupInfo&gt;
</a><a href="#h8-0-37" id="h8-0-37" class="i">+
</a><a href="#h8-0-38" id="h8-0-38" class="i">+    private val addFriendDialog by lazy {
</a><a href="#h8-0-39" id="h8-0-39" class="i">+        AddFriendDialog(context, this)
</a><a href="#h8-0-40" id="h8-0-40" class="i">+    }
</a><a href="#h8-0-41" id="h8-0-41" class="i">+
</a><a href="#h8-0-42" id="h8-0-42" class="i">+    override fun onResumed() {
</a><a href="#h8-0-43" id="h8-0-43" class="i">+        friendList = context.modDatabase.getFriends()
</a><a href="#h8-0-44" id="h8-0-44" class="i">+        groupList = context.modDatabase.getGroups()
</a><a href="#h8-0-45" id="h8-0-45" class="i">+    }
</a><a href="#h8-0-46" id="h8-0-46" class="i">+
</a><a href="#h8-0-47" id="h8-0-47" class="i">+
</a><a href="#h8-0-48" id="h8-0-48" class="i">+    @OptIn(ExperimentalFoundationApi::class)
</a><a href="#h8-0-49" id="h8-0-49" class="i">+    @Composable
</a><a href="#h8-0-50" id="h8-0-50" class="i">+    override fun Content() {
</a><a href="#h8-0-51" id="h8-0-51" class="i">+        val titles = listOf(&quot;Friends&quot;, &quot;Groups&quot;)
</a><a href="#h8-0-52" id="h8-0-52" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h8-0-53" id="h8-0-53" class="i">+        val pagerState = rememberPagerState { titles.size }
</a><a href="#h8-0-54" id="h8-0-54" class="i">+        var showAddFriendDialog by remember { mutableStateOf(false) }
</a><a href="#h8-0-55" id="h8-0-55" class="i">+
</a><a href="#h8-0-56" id="h8-0-56" class="i">+        if (showAddFriendDialog) {
</a><a href="#h8-0-57" id="h8-0-57" class="i">+            addFriendDialog.Content {
</a><a href="#h8-0-58" id="h8-0-58" class="i">+                showAddFriendDialog = false
</a><a href="#h8-0-59" id="h8-0-59" class="i">+            }
</a><a href="#h8-0-60" id="h8-0-60" class="i">+        }
</a><a href="#h8-0-61" id="h8-0-61" class="i">+
</a><a href="#h8-0-62" id="h8-0-62" class="i">+        Scaffold(
</a><a href="#h8-0-63" id="h8-0-63" class="i">+            floatingActionButton = {
</a><a href="#h8-0-64" id="h8-0-64" class="i">+                FloatingActionButton(
</a><a href="#h8-0-65" id="h8-0-65" class="i">+                    onClick = {
</a><a href="#h8-0-66" id="h8-0-66" class="i">+                        showAddFriendDialog = true
</a><a href="#h8-0-67" id="h8-0-67" class="i">+                    },
</a><a href="#h8-0-68" id="h8-0-68" class="i">+                    modifier = Modifier.padding(10.dp),
</a><a href="#h8-0-69" id="h8-0-69" class="i">+                    containerColor = MaterialTheme.colorScheme.primary,
</a><a href="#h8-0-70" id="h8-0-70" class="i">+                    contentColor = MaterialTheme.colorScheme.onPrimary,
</a><a href="#h8-0-71" id="h8-0-71" class="i">+                    shape = RoundedCornerShape(16.dp),
</a><a href="#h8-0-72" id="h8-0-72" class="i">+                ) {
</a><a href="#h8-0-73" id="h8-0-73" class="i">+                    Icon(
</a><a href="#h8-0-74" id="h8-0-74" class="i">+                        imageVector = Icons.Rounded.Add,
</a><a href="#h8-0-75" id="h8-0-75" class="i">+                        contentDescription = null
</a><a href="#h8-0-76" id="h8-0-76" class="i">+                    )
</a><a href="#h8-0-77" id="h8-0-77" class="i">+                }
</a><a href="#h8-0-78" id="h8-0-78" class="i">+            }
</a><a href="#h8-0-79" id="h8-0-79" class="i">+        ) { paddingValues -&gt;
</a><a href="#h8-0-80" id="h8-0-80" class="i">+            Column(modifier = Modifier.padding(paddingValues)) {
</a><a href="#h8-0-81" id="h8-0-81" class="i">+                TabRow(selectedTabIndex = pagerState.currentPage, indicator = { tabPositions -&gt;
</a><a href="#h8-0-82" id="h8-0-82" class="i">+                    TabRowDefaults.Indicator(
</a><a href="#h8-0-83" id="h8-0-83" class="i">+                        Modifier.pagerTabIndicatorOffset(
</a><a href="#h8-0-84" id="h8-0-84" class="i">+                            pagerState = pagerState,
</a><a href="#h8-0-85" id="h8-0-85" class="i">+                            tabPositions = tabPositions
</a><a href="#h8-0-86" id="h8-0-86" class="i">+                        )
</a><a href="#h8-0-87" id="h8-0-87" class="i">+                    )
</a><a href="#h8-0-88" id="h8-0-88" class="i">+                }) {
</a><a href="#h8-0-89" id="h8-0-89" class="i">+                    titles.forEachIndexed { index, title -&gt;
</a><a href="#h8-0-90" id="h8-0-90" class="i">+                        Tab(
</a><a href="#h8-0-91" id="h8-0-91" class="i">+                            selected = pagerState.currentPage == index,
</a><a href="#h8-0-92" id="h8-0-92" class="i">+                            onClick = {
</a><a href="#h8-0-93" id="h8-0-93" class="i">+                                coroutineScope.launch {
</a><a href="#h8-0-94" id="h8-0-94" class="i">+                                    pagerState.animateScrollToPage( index )
</a><a href="#h8-0-95" id="h8-0-95" class="i">+                                }
</a><a href="#h8-0-96" id="h8-0-96" class="i">+                            },
</a><a href="#h8-0-97" id="h8-0-97" class="i">+                            text = { Text(text = title, maxLines = 2, overflow = TextOverflow.Ellipsis) }
</a><a href="#h8-0-98" id="h8-0-98" class="i">+                        )
</a><a href="#h8-0-99" id="h8-0-99" class="i">+                    }
</a><a href="#h8-0-100" id="h8-0-100" class="i">+                }
</a><a href="#h8-0-101" id="h8-0-101" class="i">+
</a><a href="#h8-0-102" id="h8-0-102" class="i">+                HorizontalPager(modifier = Modifier.padding(paddingValues), state = pagerState) { page -&gt;
</a><a href="#h8-0-103" id="h8-0-103" class="i">+                    Column(
</a><a href="#h8-0-104" id="h8-0-104" class="i">+                        modifier = Modifier.fillMaxSize(),
</a><a href="#h8-0-105" id="h8-0-105" class="i">+                    ) {
</a><a href="#h8-0-106" id="h8-0-106" class="i">+                        when (page) {
</a><a href="#h8-0-107" id="h8-0-107" class="i">+                            0 -&gt; {
</a><a href="#h8-0-108" id="h8-0-108" class="i">+                                Text(text = &quot;Friends&quot;)
</a><a href="#h8-0-109" id="h8-0-109" class="i">+                                Column {
</a><a href="#h8-0-110" id="h8-0-110" class="i">+                                    friendList.forEach {
</a><a href="#h8-0-111" id="h8-0-111" class="i">+                                        Text(text = it.displayName ?: it.mutableUsername)
</a><a href="#h8-0-112" id="h8-0-112" class="i">+                                    }
</a><a href="#h8-0-113" id="h8-0-113" class="i">+                                }
</a><a href="#h8-0-114" id="h8-0-114" class="i">+                            }
</a><a href="#h8-0-115" id="h8-0-115" class="i">+                            1 -&gt; {
</a><a href="#h8-0-116" id="h8-0-116" class="i">+                                Text(text = &quot;Groups&quot;)
</a><a href="#h8-0-117" id="h8-0-117" class="i">+                                Column {
</a><a href="#h8-0-118" id="h8-0-118" class="i">+                                    groupList.forEach {
</a><a href="#h8-0-119" id="h8-0-119" class="i">+                                        Text(text = it.name)
</a><a href="#h8-0-120" id="h8-0-120" class="i">+                                    }
</a><a href="#h8-0-121" id="h8-0-121" class="i">+                                }
</a><a href="#h8-0-122" id="h8-0-122" class="i">+                            }
</a><a href="#h8-0-123" id="h8-0-123" class="i">+                        }
</a><a href="#h8-0-124" id="h8-0-124" class="i">+                    }
</a><a href="#h8-0-125" id="h8-0-125" class="i">+                }
</a><a href="#h8-0-126" id="h8-0-126" class="i">+            }
</a><a href="#h8-0-127" id="h8-0-127" class="i">+        }
</a><a href="#h8-0-128" id="h8-0-128" class="i">+    }
</a><a href="#h8-0-129" id="h8-0-129" class="i">+}</a><a href="#h8-0-130" id="h8-0-130" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/SetupActivity.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -24,6 +24,7 @@ import androidx.compose.material3.Scaffold
</a> import androidx.compose.runtime.getValue
 import androidx.compose.runtime.mutableStateOf
 import androidx.compose.runtime.remember
<a href="#h9-0-3" id="h9-0-3" class="i">+import androidx.compose.runtime.setValue
</a> import androidx.compose.ui.Alignment
 import androidx.compose.ui.Modifier
 import androidx.compose.ui.draw.alpha
<a href="#h9-1" id="h9-1" class="h">@@ -79,13 +80,13 @@ class SetupActivity : ComponentActivity() {
</a> 
         setContent {
             val navController = rememberNavController()
<a href="#h9-1-3" id="h9-1-3" class="d">-            val canGoNext = remember { mutableStateOf(false) }
</a><a href="#h9-1-4" id="h9-1-4" class="i">+            var canGoNext by remember { mutableStateOf(false) }
</a> 
             fun nextScreen() {
<a href="#h9-1-7" id="h9-1-7" class="d">-                if (!canGoNext.value) return
</a><a href="#h9-1-8" id="h9-1-8" class="i">+                if (!canGoNext) return
</a>                 requiredScreens.firstOrNull()?.onLeave()
                 if (requiredScreens.size &gt; 1) {
<a href="#h9-1-11" id="h9-1-11" class="d">-                    canGoNext.value = false
</a><a href="#h9-1-12" id="h9-1-12" class="i">+                    canGoNext = false
</a>                     requiredScreens.removeFirst()
                     navController.navigate(requiredScreens.first().route)
                 } else {
<a href="#h9-2" id="h9-2" class="h">@@ -102,7 +103,7 @@ class SetupActivity : ComponentActivity() {
</a>                                 .fillMaxWidth(),
                             horizontalAlignment = Alignment.CenterHorizontally
                         ) {
<a href="#h9-2-3" id="h9-2-3" class="d">-                            val alpha: Float by animateFloatAsState(if (canGoNext.value) 1f else 0f,
</a><a href="#h9-2-4" id="h9-2-4" class="i">+                            val alpha: Float by animateFloatAsState(if (canGoNext) 1f else 0f,
</a>                                 label = &quot;NextButton&quot;
                             )
 
<a href="#h9-3" id="h9-3" class="h">@@ -114,7 +115,7 @@ class SetupActivity : ComponentActivity() {
</a>                                     .alpha(alpha)
                             ) {
                                 Icon(
<a href="#h9-3-3" id="h9-3-3" class="d">-                                    imageVector = if (requiredScreens.size &lt;= 1 &amp;&amp; canGoNext.value) {
</a><a href="#h9-3-4" id="h9-3-4" class="i">+                                    imageVector = if (requiredScreens.size &lt;= 1 &amp;&amp; canGoNext) {
</a>                                         Icons.Default.Check
                                     } else {
                                         Icons.Default.ArrowForwardIos
<a href="#h9-4" id="h9-4" class="h">@@ -135,7 +136,7 @@ class SetupActivity : ComponentActivity() {
</a>                             startDestination = requiredScreens.first().route
                         ) {
                             requiredScreens.forEach { screen -&gt;
<a href="#h9-4-3" id="h9-4-3" class="d">-                                screen.allowNext = { canGoNext.value = it }
</a><a href="#h9-4-4" id="h9-4-4" class="i">+                                screen.allowNext = { canGoNext = it }
</a>                                 composable(screen.route) {
                                     BackHandler(true) {}
                                     Column(
<b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/MappingsScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/MappingsScreen.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/MappingsScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/MappingsScreen.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -11,9 +11,11 @@ import androidx.compose.material3.MaterialTheme
</a> import androidx.compose.material3.Surface
 import androidx.compose.material3.Text
 import androidx.compose.runtime.Composable
<a href="#h10-0-3" id="h10-0-3" class="i">+import androidx.compose.runtime.getValue
</a> import androidx.compose.runtime.mutableStateOf
 import androidx.compose.runtime.remember
 import androidx.compose.runtime.rememberCoroutineScope
<a href="#h10-0-7" id="h10-0-7" class="i">+import androidx.compose.runtime.setValue
</a> import androidx.compose.ui.Modifier
 import androidx.compose.ui.unit.dp
 import androidx.compose.ui.window.Dialog
<a href="#h10-1" id="h10-1" class="h">@@ -26,12 +28,12 @@ class MappingsScreen : SetupScreen() {
</a>     @Composable
     override fun Content() {
         val coroutineScope = rememberCoroutineScope()
<a href="#h10-1-3" id="h10-1-3" class="d">-        val infoText = remember { mutableStateOf(null as String?) }
</a><a href="#h10-1-4" id="h10-1-4" class="d">-        val isGenerating = remember { mutableStateOf(false) }
</a><a href="#h10-1-5" id="h10-1-5" class="i">+        var infoText by remember { mutableStateOf(null as String?) }
</a><a href="#h10-1-6" id="h10-1-6" class="i">+        var isGenerating by remember { mutableStateOf(false) }
</a> 
<a href="#h10-1-8" id="h10-1-8" class="d">-        if (infoText.value != null) {
</a><a href="#h10-1-9" id="h10-1-9" class="i">+        if (infoText != null) {
</a>             Dialog(onDismissRequest = {
<a href="#h10-1-11" id="h10-1-11" class="d">-                infoText.value = null
</a><a href="#h10-1-12" id="h10-1-12" class="i">+                infoText = null
</a>             }) {
                 Surface(
                     modifier = Modifier.padding(16.dp).fillMaxWidth(),
<a href="#h10-2" id="h10-2" class="h">@@ -40,9 +42,9 @@ class MappingsScreen : SetupScreen() {
</a>                     Column(
                         modifier = Modifier.padding(16.dp)
                     ) {
<a href="#h10-2-3" id="h10-2-3" class="d">-                        Text(text = infoText.value!!)
</a><a href="#h10-2-4" id="h10-2-4" class="i">+                        Text(text = infoText!!)
</a>                         Button(onClick = {
<a href="#h10-2-6" id="h10-2-6" class="d">-                            infoText.value = null
</a><a href="#h10-2-7" id="h10-2-7" class="i">+                            infoText = null
</a>                         },
                         modifier = Modifier.padding(top = 5.dp).align(alignment = androidx.compose.ui.Alignment.End)) {
                             Text(text = &quot;OK&quot;)
<a href="#h10-3" id="h10-3" class="h">@@ -63,27 +65,27 @@ class MappingsScreen : SetupScreen() {
</a>             }
         }
 
<a href="#h10-3-3" id="h10-3-3" class="d">-        val hasMappings = remember { mutableStateOf(false) }
</a><a href="#h10-3-4" id="h10-3-4" class="i">+        var hasMappings by remember { mutableStateOf(false) }
</a> 
         DialogText(text = context.translation[&quot;setup.mappings.dialog&quot;])
<a href="#h10-3-7" id="h10-3-7" class="d">-        if (hasMappings.value) return
</a><a href="#h10-3-8" id="h10-3-8" class="i">+        if (hasMappings) return
</a>         Button(onClick = {
<a href="#h10-3-10" id="h10-3-10" class="d">-            if (isGenerating.value) return@Button
</a><a href="#h10-3-11" id="h10-3-11" class="d">-            isGenerating.value = true
</a><a href="#h10-3-12" id="h10-3-12" class="i">+            if (isGenerating) return@Button
</a><a href="#h10-3-13" id="h10-3-13" class="i">+            isGenerating = true
</a>             coroutineScope.launch(Dispatchers.IO) {
                 runCatching {
                     tryToGenerateMappings()
                     allowNext(true)
<a href="#h10-3-18" id="h10-3-18" class="d">-                    infoText.value = context.translation[&quot;setup.mappings.generate_success&quot;]
</a><a href="#h10-3-19" id="h10-3-19" class="d">-                    hasMappings.value = true
</a><a href="#h10-3-20" id="h10-3-20" class="i">+                    infoText = context.translation[&quot;setup.mappings.generate_success&quot;]
</a><a href="#h10-3-21" id="h10-3-21" class="i">+                    hasMappings = true
</a>                 }.onFailure {
<a href="#h10-3-23" id="h10-3-23" class="d">-                    isGenerating.value = false
</a><a href="#h10-3-24" id="h10-3-24" class="d">-                    infoText.value = context.translation[&quot;setup.mappings.generate_failure&quot;] + &quot;\n\n&quot; + it.message
</a><a href="#h10-3-25" id="h10-3-25" class="i">+                    isGenerating = false
</a><a href="#h10-3-26" id="h10-3-26" class="i">+                    infoText = context.translation[&quot;setup.mappings.generate_failure&quot;] + &quot;\n\n&quot; + it.message
</a>                     Logger.error(&quot;Failed to generate mappings&quot;, it)
                 }
             }
         }) {
<a href="#h10-3-31" id="h10-3-31" class="d">-            if (isGenerating.value) {
</a><a href="#h10-3-32" id="h10-3-32" class="i">+            if (isGenerating) {
</a>                 CircularProgressIndicator(
                     modifier = Modifier.padding().size(30.dp),
                     strokeWidth = 3.dp,
<b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/PickLanguageScreen.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -15,8 +15,10 @@ import androidx.compose.material3.MaterialTheme
</a> import androidx.compose.material3.Surface
 import androidx.compose.material3.Text
 import androidx.compose.runtime.Composable
<a href="#h11-0-3" id="h11-0-3" class="i">+import androidx.compose.runtime.getValue
</a> import androidx.compose.runtime.mutableStateOf
 import androidx.compose.runtime.remember
<a href="#h11-0-6" id="h11-0-6" class="i">+import androidx.compose.runtime.setValue
</a> import androidx.compose.ui.Alignment
 import androidx.compose.ui.Modifier
 import androidx.compose.ui.text.font.FontWeight
<a href="#h11-1" id="h11-1" class="h">@@ -78,10 +80,10 @@ class PickLanguageScreen : SetupScreen(){
</a> 
         DialogText(text = context.translation[&quot;setup.dialogs.select_language&quot;])
 
<a href="#h11-1-3" id="h11-1-3" class="d">-        val isDialog = remember { mutableStateOf(false) }
</a><a href="#h11-1-4" id="h11-1-4" class="i">+        var isDialog by remember { mutableStateOf(false) }
</a> 
<a href="#h11-1-6" id="h11-1-6" class="d">-        if (isDialog.value) {
</a><a href="#h11-1-7" id="h11-1-7" class="d">-            Dialog(onDismissRequest = { isDialog.value = false }) {
</a><a href="#h11-1-8" id="h11-1-8" class="i">+        if (isDialog) {
</a><a href="#h11-1-9" id="h11-1-9" class="i">+            Dialog(onDismissRequest = { isDialog = false }) {
</a>                 Surface(
                     modifier = Modifier
                         .padding(10.dp)
<a href="#h11-2" id="h11-2" class="h">@@ -98,7 +100,7 @@ class PickLanguageScreen : SetupScreen(){
</a>                                     .fillMaxWidth()
                                     .clickable {
                                         selectedLocale.value = locale
<a href="#h11-2-3" id="h11-2-3" class="d">-                                        isDialog.value = false
</a><a href="#h11-2-4" id="h11-2-4" class="i">+                                        isDialog = false
</a>                                     },
                                 contentAlignment = Alignment.Center
                             ) {
<a href="#h11-3" id="h11-3" class="h">@@ -121,7 +123,7 @@ class PickLanguageScreen : SetupScreen(){
</a>             contentAlignment = Alignment.Center
         ) {
             Button(onClick = {
<a href="#h11-3-3" id="h11-3-3" class="d">-                isDialog.value = true
</a><a href="#h11-3-4" id="h11-3-4" class="i">+                isDialog = true
</a>             }) {
                 Text(text = getLocaleDisplayName(selectedLocale.value), fontSize = 16.sp,
                     fontWeight = FontWeight.Normal)
<b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SaveFolderScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SaveFolderScreen.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SaveFolderScreen.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/setup/screens/impl/SaveFolderScreen.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -9,9 +9,9 @@ import androidx.compose.runtime.Composable
</a> import androidx.compose.ui.Modifier
 import androidx.compose.ui.unit.dp
 import me.rhunk.snapenhance.Logger
<a href="#h12-0-3" id="h12-0-3" class="d">-import me.rhunk.snapenhance.ui.util.ObservableMutableState
</a> import me.rhunk.snapenhance.ui.setup.screens.SetupScreen
 import me.rhunk.snapenhance.ui.util.ChooseFolderHelper
<a href="#h12-0-6" id="h12-0-6" class="i">+import me.rhunk.snapenhance.ui.util.ObservableMutableState
</a> 
 class SaveFolderScreen : SetupScreen() {
     private lateinit var saveFolder: ObservableMutableState&lt;String&gt;
<b>diff --git a/<a id="h13" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/Accompagnist.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/Accompagnist.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/util/Accompagnist.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/util/Accompagnist.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -0,0 +1,56 @@
</a><a href="#h13-0-0" id="h13-0-0" class="i">+package me.rhunk.snapenhance.ui.util
</a><a href="#h13-0-1" id="h13-0-1" class="i">+
</a><a href="#h13-0-2" id="h13-0-2" class="i">+import androidx.compose.foundation.ExperimentalFoundationApi
</a><a href="#h13-0-3" id="h13-0-3" class="i">+import androidx.compose.foundation.pager.PagerState
</a><a href="#h13-0-4" id="h13-0-4" class="i">+import androidx.compose.material3.TabPosition
</a><a href="#h13-0-5" id="h13-0-5" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h13-0-6" id="h13-0-6" class="i">+import androidx.compose.ui.layout.layout
</a><a href="#h13-0-7" id="h13-0-7" class="i">+import androidx.compose.ui.unit.Constraints
</a><a href="#h13-0-8" id="h13-0-8" class="i">+import androidx.compose.ui.unit.lerp
</a><a href="#h13-0-9" id="h13-0-9" class="i">+
</a><a href="#h13-0-10" id="h13-0-10" class="i">+//https://github.com/google/accompanist/blob/main/pager-indicators/src/main/java/com/google/accompanist/pager/PagerTab.kt#L78
</a><a href="#h13-0-11" id="h13-0-11" class="i">+@OptIn(ExperimentalFoundationApi::class)
</a><a href="#h13-0-12" id="h13-0-12" class="i">+fun Modifier.pagerTabIndicatorOffset(
</a><a href="#h13-0-13" id="h13-0-13" class="i">+    pagerState: PagerState,
</a><a href="#h13-0-14" id="h13-0-14" class="i">+    tabPositions: List&lt;TabPosition&gt;,
</a><a href="#h13-0-15" id="h13-0-15" class="i">+    pageIndexMapping: (Int) -&gt; Int = { it },
</a><a href="#h13-0-16" id="h13-0-16" class="i">+): Modifier = layout { measurable, constraints -&gt;
</a><a href="#h13-0-17" id="h13-0-17" class="i">+    if (tabPositions.isEmpty()) {
</a><a href="#h13-0-18" id="h13-0-18" class="i">+        // If there are no pages, nothing to show
</a><a href="#h13-0-19" id="h13-0-19" class="i">+        layout(constraints.maxWidth, 0) {}
</a><a href="#h13-0-20" id="h13-0-20" class="i">+    } else {
</a><a href="#h13-0-21" id="h13-0-21" class="i">+        val currentPage = minOf(tabPositions.lastIndex, pageIndexMapping(pagerState.currentPage))
</a><a href="#h13-0-22" id="h13-0-22" class="i">+        val currentTab = tabPositions[currentPage]
</a><a href="#h13-0-23" id="h13-0-23" class="i">+        val previousTab = tabPositions.getOrNull(currentPage - 1)
</a><a href="#h13-0-24" id="h13-0-24" class="i">+        val nextTab = tabPositions.getOrNull(currentPage + 1)
</a><a href="#h13-0-25" id="h13-0-25" class="i">+        val fraction = pagerState.currentPageOffsetFraction
</a><a href="#h13-0-26" id="h13-0-26" class="i">+        val indicatorWidth = if (fraction &gt; 0 &amp;&amp; nextTab != null) {
</a><a href="#h13-0-27" id="h13-0-27" class="i">+            lerp(currentTab.width, nextTab.width, fraction).roundToPx()
</a><a href="#h13-0-28" id="h13-0-28" class="i">+        } else if (fraction &lt; 0 &amp;&amp; previousTab != null) {
</a><a href="#h13-0-29" id="h13-0-29" class="i">+            lerp(currentTab.width, previousTab.width, -fraction).roundToPx()
</a><a href="#h13-0-30" id="h13-0-30" class="i">+        } else {
</a><a href="#h13-0-31" id="h13-0-31" class="i">+            currentTab.width.roundToPx()
</a><a href="#h13-0-32" id="h13-0-32" class="i">+        }
</a><a href="#h13-0-33" id="h13-0-33" class="i">+        val indicatorOffset = if (fraction &gt; 0 &amp;&amp; nextTab != null) {
</a><a href="#h13-0-34" id="h13-0-34" class="i">+            lerp(currentTab.left, nextTab.left, fraction).roundToPx()
</a><a href="#h13-0-35" id="h13-0-35" class="i">+        } else if (fraction &lt; 0 &amp;&amp; previousTab != null) {
</a><a href="#h13-0-36" id="h13-0-36" class="i">+            lerp(currentTab.left, previousTab.left, -fraction).roundToPx()
</a><a href="#h13-0-37" id="h13-0-37" class="i">+        } else {
</a><a href="#h13-0-38" id="h13-0-38" class="i">+            currentTab.left.roundToPx()
</a><a href="#h13-0-39" id="h13-0-39" class="i">+        }
</a><a href="#h13-0-40" id="h13-0-40" class="i">+        val placeable = measurable.measure(
</a><a href="#h13-0-41" id="h13-0-41" class="i">+            Constraints(
</a><a href="#h13-0-42" id="h13-0-42" class="i">+                minWidth = indicatorWidth,
</a><a href="#h13-0-43" id="h13-0-43" class="i">+                maxWidth = indicatorWidth,
</a><a href="#h13-0-44" id="h13-0-44" class="i">+                minHeight = 0,
</a><a href="#h13-0-45" id="h13-0-45" class="i">+                maxHeight = constraints.maxHeight
</a><a href="#h13-0-46" id="h13-0-46" class="i">+            )
</a><a href="#h13-0-47" id="h13-0-47" class="i">+        )
</a><a href="#h13-0-48" id="h13-0-48" class="i">+        layout(constraints.maxWidth, maxOf(placeable.height, constraints.minHeight)) {
</a><a href="#h13-0-49" id="h13-0-49" class="i">+            placeable.placeRelative(
</a><a href="#h13-0-50" id="h13-0-50" class="i">+                indicatorOffset,
</a><a href="#h13-0-51" id="h13-0-51" class="i">+                maxOf(constraints.minHeight - placeable.height, 0)
</a><a href="#h13-0-52" id="h13-0-52" class="i">+            )
</a><a href="#h13-0-53" id="h13-0-53" class="i">+        }
</a><a href="#h13-0-54" id="h13-0-54" class="i">+    }
</a><a href="#h13-0-55" id="h13-0-55" class="i">+}</a><a href="#h13-0-56" id="h13-0-56" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a> b/<a href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/BridgeInterface.aidl</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -2,58 +2,77 @@ package me.rhunk.snapenhance.bridge;
</a> 
 import java.util.List;
 import me.rhunk.snapenhance.bridge.DownloadCallback;
<a href="#h14-0-3" id="h14-0-3" class="i">+import me.rhunk.snapenhance.bridge.SyncCallback;
</a> 
 interface BridgeInterface {
<a href="#h14-0-6" id="h14-0-6" class="d">-        /**
</a><a href="#h14-0-7" id="h14-0-7" class="d">-        * Execute a file operation
</a><a href="#h14-0-8" id="h14-0-8" class="d">-        */
</a><a href="#h14-0-9" id="h14-0-9" class="d">-        byte[] fileOperation(int action, int fileType, in @nullable byte[] content);
</a><a href="#h14-0-10" id="h14-0-10" class="d">-
</a><a href="#h14-0-11" id="h14-0-11" class="d">-        /**
</a><a href="#h14-0-12" id="h14-0-12" class="d">-         * Get the content of a logged message from the database
</a><a href="#h14-0-13" id="h14-0-13" class="d">-         *
</a><a href="#h14-0-14" id="h14-0-14" class="d">-         * @param conversationId the ID of the conversation
</a><a href="#h14-0-15" id="h14-0-15" class="d">-         * @return the content of the message
</a><a href="#h14-0-16" id="h14-0-16" class="d">-         */
</a><a href="#h14-0-17" id="h14-0-17" class="d">-        long[] getLoggedMessageIds(String conversationId, int limit);
</a><a href="#h14-0-18" id="h14-0-18" class="d">-
</a><a href="#h14-0-19" id="h14-0-19" class="d">-        /**
</a><a href="#h14-0-20" id="h14-0-20" class="d">-         * Get the content of a logged message from the database
</a><a href="#h14-0-21" id="h14-0-21" class="d">-         *
</a><a href="#h14-0-22" id="h14-0-22" class="d">-         * @param id the ID of the message logger message
</a><a href="#h14-0-23" id="h14-0-23" class="d">-         * @return the content of the message
</a><a href="#h14-0-24" id="h14-0-24" class="d">-         */
</a><a href="#h14-0-25" id="h14-0-25" class="d">-        @nullable byte[] getMessageLoggerMessage(String conversationId, long id);
</a><a href="#h14-0-26" id="h14-0-26" class="d">-
</a><a href="#h14-0-27" id="h14-0-27" class="d">-        /**
</a><a href="#h14-0-28" id="h14-0-28" class="d">-         * Add a message to the message logger database
</a><a href="#h14-0-29" id="h14-0-29" class="d">-         *
</a><a href="#h14-0-30" id="h14-0-30" class="d">-         * @param id      the ID of the message logger message
</a><a href="#h14-0-31" id="h14-0-31" class="d">-         * @param message the content of the message
</a><a href="#h14-0-32" id="h14-0-32" class="d">-         */
</a><a href="#h14-0-33" id="h14-0-33" class="d">-        void addMessageLoggerMessage(String conversationId, long id, in byte[] message);
</a><a href="#h14-0-34" id="h14-0-34" class="d">-
</a><a href="#h14-0-35" id="h14-0-35" class="d">-        /**
</a><a href="#h14-0-36" id="h14-0-36" class="d">-         * Delete a message from the message logger database
</a><a href="#h14-0-37" id="h14-0-37" class="d">-         *
</a><a href="#h14-0-38" id="h14-0-38" class="d">-         * @param id the ID of the message logger message
</a><a href="#h14-0-39" id="h14-0-39" class="d">-         */
</a><a href="#h14-0-40" id="h14-0-40" class="d">-        void deleteMessageLoggerMessage(String conversationId, long id);
</a><a href="#h14-0-41" id="h14-0-41" class="d">-
</a><a href="#h14-0-42" id="h14-0-42" class="d">-        /**
</a><a href="#h14-0-43" id="h14-0-43" class="d">-         * Clear the message logger database
</a><a href="#h14-0-44" id="h14-0-44" class="d">-         */
</a><a href="#h14-0-45" id="h14-0-45" class="d">-        void clearMessageLogger();
</a><a href="#h14-0-46" id="h14-0-46" class="d">-
</a><a href="#h14-0-47" id="h14-0-47" class="d">-        /**
</a><a href="#h14-0-48" id="h14-0-48" class="d">-         * Fetch the locales
</a><a href="#h14-0-49" id="h14-0-49" class="d">-         *
</a><a href="#h14-0-50" id="h14-0-50" class="d">-         * @return the locale result
</a><a href="#h14-0-51" id="h14-0-51" class="d">-         */
</a><a href="#h14-0-52" id="h14-0-52" class="d">-        Map&lt;String, String&gt; fetchLocales(String userLocale);
</a><a href="#h14-0-53" id="h14-0-53" class="d">-
</a><a href="#h14-0-54" id="h14-0-54" class="d">-        /**
</a><a href="#h14-0-55" id="h14-0-55" class="d">-         * Enqueue a download
</a><a href="#h14-0-56" id="h14-0-56" class="d">-         */
</a><a href="#h14-0-57" id="h14-0-57" class="d">-        void enqueueDownload(in Intent intent, DownloadCallback callback);
</a><a href="#h14-0-58" id="h14-0-58" class="i">+    /**
</a><a href="#h14-0-59" id="h14-0-59" class="i">+    * Execute a file operation
</a><a href="#h14-0-60" id="h14-0-60" class="i">+    */
</a><a href="#h14-0-61" id="h14-0-61" class="i">+    byte[] fileOperation(int action, int fileType, in @nullable byte[] content);
</a><a href="#h14-0-62" id="h14-0-62" class="i">+
</a><a href="#h14-0-63" id="h14-0-63" class="i">+    /**
</a><a href="#h14-0-64" id="h14-0-64" class="i">+     * Get the content of a logged message from the database
</a><a href="#h14-0-65" id="h14-0-65" class="i">+     *
</a><a href="#h14-0-66" id="h14-0-66" class="i">+     * @param conversationId the ID of the conversation
</a><a href="#h14-0-67" id="h14-0-67" class="i">+     * @return the content of the message
</a><a href="#h14-0-68" id="h14-0-68" class="i">+     */
</a><a href="#h14-0-69" id="h14-0-69" class="i">+    long[] getLoggedMessageIds(String conversationId, int limit);
</a><a href="#h14-0-70" id="h14-0-70" class="i">+
</a><a href="#h14-0-71" id="h14-0-71" class="i">+    /**
</a><a href="#h14-0-72" id="h14-0-72" class="i">+     * Get the content of a logged message from the database
</a><a href="#h14-0-73" id="h14-0-73" class="i">+     *
</a><a href="#h14-0-74" id="h14-0-74" class="i">+     * @param id the ID of the message logger message
</a><a href="#h14-0-75" id="h14-0-75" class="i">+     * @return the content of the message
</a><a href="#h14-0-76" id="h14-0-76" class="i">+     */
</a><a href="#h14-0-77" id="h14-0-77" class="i">+    @nullable byte[] getMessageLoggerMessage(String conversationId, long id);
</a><a href="#h14-0-78" id="h14-0-78" class="i">+
</a><a href="#h14-0-79" id="h14-0-79" class="i">+    /**
</a><a href="#h14-0-80" id="h14-0-80" class="i">+     * Add a message to the message logger database
</a><a href="#h14-0-81" id="h14-0-81" class="i">+     *
</a><a href="#h14-0-82" id="h14-0-82" class="i">+     * @param id      the ID of the message logger message
</a><a href="#h14-0-83" id="h14-0-83" class="i">+     * @param message the content of the message
</a><a href="#h14-0-84" id="h14-0-84" class="i">+     */
</a><a href="#h14-0-85" id="h14-0-85" class="i">+    void addMessageLoggerMessage(String conversationId, long id, in byte[] message);
</a><a href="#h14-0-86" id="h14-0-86" class="i">+
</a><a href="#h14-0-87" id="h14-0-87" class="i">+    /**
</a><a href="#h14-0-88" id="h14-0-88" class="i">+     * Delete a message from the message logger database
</a><a href="#h14-0-89" id="h14-0-89" class="i">+     *
</a><a href="#h14-0-90" id="h14-0-90" class="i">+     * @param id the ID of the message logger message
</a><a href="#h14-0-91" id="h14-0-91" class="i">+     */
</a><a href="#h14-0-92" id="h14-0-92" class="i">+    void deleteMessageLoggerMessage(String conversationId, long id);
</a><a href="#h14-0-93" id="h14-0-93" class="i">+
</a><a href="#h14-0-94" id="h14-0-94" class="i">+    /**
</a><a href="#h14-0-95" id="h14-0-95" class="i">+     * Clear the message logger database
</a><a href="#h14-0-96" id="h14-0-96" class="i">+     */
</a><a href="#h14-0-97" id="h14-0-97" class="i">+    void clearMessageLogger();
</a><a href="#h14-0-98" id="h14-0-98" class="i">+
</a><a href="#h14-0-99" id="h14-0-99" class="i">+    /**
</a><a href="#h14-0-100" id="h14-0-100" class="i">+     * Fetch the locales
</a><a href="#h14-0-101" id="h14-0-101" class="i">+     *
</a><a href="#h14-0-102" id="h14-0-102" class="i">+     * @return the locale result
</a><a href="#h14-0-103" id="h14-0-103" class="i">+     */
</a><a href="#h14-0-104" id="h14-0-104" class="i">+    Map&lt;String, String&gt; fetchLocales(String userLocale);
</a><a href="#h14-0-105" id="h14-0-105" class="i">+
</a><a href="#h14-0-106" id="h14-0-106" class="i">+    /**
</a><a href="#h14-0-107" id="h14-0-107" class="i">+     * Enqueue a download
</a><a href="#h14-0-108" id="h14-0-108" class="i">+     */
</a><a href="#h14-0-109" id="h14-0-109" class="i">+    void enqueueDownload(in Intent intent, DownloadCallback callback);
</a><a href="#h14-0-110" id="h14-0-110" class="i">+
</a><a href="#h14-0-111" id="h14-0-111" class="i">+    /**
</a><a href="#h14-0-112" id="h14-0-112" class="i">+    * Get rules for a given user or conversation
</a><a href="#h14-0-113" id="h14-0-113" class="i">+    */
</a><a href="#h14-0-114" id="h14-0-114" class="i">+
</a><a href="#h14-0-115" id="h14-0-115" class="i">+    List&lt;String&gt; getRules(String objectType, String uuid);
</a><a href="#h14-0-116" id="h14-0-116" class="i">+
</a><a href="#h14-0-117" id="h14-0-117" class="i">+    /**
</a><a href="#h14-0-118" id="h14-0-118" class="i">+    * Sync groups and friends
</a><a href="#h14-0-119" id="h14-0-119" class="i">+    */
</a><a href="#h14-0-120" id="h14-0-120" class="i">+    oneway void sync(SyncCallback callback);
</a><a href="#h14-0-121" id="h14-0-121" class="i">+
</a><a href="#h14-0-122" id="h14-0-122" class="i">+    /**
</a><a href="#h14-0-123" id="h14-0-123" class="i">+    * Pass all groups and friends to be able to add them to the database
</a><a href="#h14-0-124" id="h14-0-124" class="i">+    * @param groups serialized groups
</a><a href="#h14-0-125" id="h14-0-125" class="i">+    * @param friends serialized friends
</a><a href="#h14-0-126" id="h14-0-126" class="i">+    */
</a><a href="#h14-0-127" id="h14-0-127" class="i">+    oneway void passGroupsAndFriends(in List&lt;String&gt; groups, in List&lt;String&gt; friends);
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h15" href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/SyncCallback.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/SyncCallback.aidl</a> b/<a href="../file/core/src/main/aidl/me/rhunk/snapenhance/bridge/SyncCallback.aidl.html">core/src/main/aidl/me/rhunk/snapenhance/bridge/SyncCallback.aidl</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -0,0 +1,17 @@
</a><a href="#h15-0-0" id="h15-0-0" class="i">+package me.rhunk.snapenhance.bridge;
</a><a href="#h15-0-1" id="h15-0-1" class="i">+
</a><a href="#h15-0-2" id="h15-0-2" class="i">+interface SyncCallback {
</a><a href="#h15-0-3" id="h15-0-3" class="i">+    /**
</a><a href="#h15-0-4" id="h15-0-4" class="i">+    * Called when the friend data has been synced
</a><a href="#h15-0-5" id="h15-0-5" class="i">+    * @param uuid The uuid of the friend to sync
</a><a href="#h15-0-6" id="h15-0-6" class="i">+    * @return The serialized friend data
</a><a href="#h15-0-7" id="h15-0-7" class="i">+    */
</a><a href="#h15-0-8" id="h15-0-8" class="i">+    String syncFriend(String uuid);
</a><a href="#h15-0-9" id="h15-0-9" class="i">+
</a><a href="#h15-0-10" id="h15-0-10" class="i">+    /**
</a><a href="#h15-0-11" id="h15-0-11" class="i">+    * Called when the conversation data has been synced
</a><a href="#h15-0-12" id="h15-0-12" class="i">+    * @param uuid The uuid of the conversation to sync
</a><a href="#h15-0-13" id="h15-0-13" class="i">+    * @return The serialized conversation data
</a><a href="#h15-0-14" id="h15-0-14" class="i">+    */
</a><a href="#h15-0-15" id="h15-0-15" class="i">+    String syncGroup(String uuid);
</a><a href="#h15-0-16" id="h15-0-16" class="i">+}</a><a href="#h15-0-17" id="h15-0-17" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a> b/<a href="../file/core/src/main/assets/lang/en_US.json.html">core/src/main/assets/lang/en_US.json</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -20,7 +20,7 @@
</a>             &quot;downloads&quot;: &quot;Downloads&quot;,
             &quot;features&quot;: &quot;Features&quot;,
             &quot;home&quot;: &quot;Home&quot;,
<a href="#h16-0-3" id="h16-0-3" class="d">-            &quot;friends&quot;: &quot;Friends&quot;,
</a><a href="#h16-0-4" id="h16-0-4" class="i">+            &quot;social&quot;: &quot;Social&quot;,
</a>             &quot;plugins&quot;: &quot;Plugins&quot;
         },
         &quot;features&quot;: {
<b>diff --git a/<a id="h17" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/EventDispatcher.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/EventDispatcher.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/EventDispatcher.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/EventDispatcher.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -1,12 +1,15 @@
</a> package me.rhunk.snapenhance
 
<a href="#h17-0-2" id="h17-0-2" class="i">+import android.content.Intent
</a> import me.rhunk.snapenhance.core.eventbus.events.impl.OnSnapInteractionEvent
 import me.rhunk.snapenhance.core.eventbus.events.impl.SendMessageWithContentEvent
<a href="#h17-0-5" id="h17-0-5" class="i">+import me.rhunk.snapenhance.core.eventbus.events.impl.SnapWidgetBroadcastReceiveEvent
</a> import me.rhunk.snapenhance.data.wrapper.impl.MessageContent
 import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
 import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.hook
 import me.rhunk.snapenhance.manager.Manager
<a href="#h17-0-11" id="h17-0-11" class="i">+import me.rhunk.snapenhance.util.snap.SnapWidgetBroadcastReceiverHelper
</a> 
 class EventDispatcher(
     private val context: ModContext
<a href="#h17-1" id="h17-1" class="h">@@ -14,7 +17,7 @@ class EventDispatcher(
</a>     override fun init() {
         context.classCache.conversationManager.hook(&quot;sendMessageWithContent&quot;, HookStage.BEFORE) { param -&gt;
             val messageContent = MessageContent(param.arg(1))
<a href="#h17-1-3" id="h17-1-3" class="d">-            context.event.post(SendMessageWithContentEvent(messageContent).apply { adapter = param })?.let {
</a><a href="#h17-1-4" id="h17-1-4" class="i">+            context.event.post(SendMessageWithContentEvent(messageContent).apply { adapter = param })?.also {
</a>                 if (it.canceled) {
                     param.setResult(null)
                 }
<a href="#h17-2" id="h17-2" class="h">@@ -29,7 +32,26 @@ class EventDispatcher(
</a>                 conversationId = conversationId,
                 messageId = messageId
             )
<a href="#h17-2-3" id="h17-2-3" class="d">-            )?.let {
</a><a href="#h17-2-4" id="h17-2-4" class="i">+            )?.also {
</a><a href="#h17-2-5" id="h17-2-5" class="i">+                if (it.canceled) {
</a><a href="#h17-2-6" id="h17-2-6" class="i">+                    param.setResult(null)
</a><a href="#h17-2-7" id="h17-2-7" class="i">+                }
</a><a href="#h17-2-8" id="h17-2-8" class="i">+            }
</a><a href="#h17-2-9" id="h17-2-9" class="i">+        }
</a><a href="#h17-2-10" id="h17-2-10" class="i">+
</a><a href="#h17-2-11" id="h17-2-11" class="i">+        context.androidContext.classLoader.loadClass(SnapWidgetBroadcastReceiverHelper.CLASS_NAME)
</a><a href="#h17-2-12" id="h17-2-12" class="i">+            .hook(&quot;onReceive&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h17-2-13" id="h17-2-13" class="i">+            val intent = param.arg(1) as? Intent ?: return@hook
</a><a href="#h17-2-14" id="h17-2-14" class="i">+            if (!SnapWidgetBroadcastReceiverHelper.isIncomingIntentValid(intent)) return@hook
</a><a href="#h17-2-15" id="h17-2-15" class="i">+            val action = intent.getStringExtra(&quot;action&quot;) ?: return@hook
</a><a href="#h17-2-16" id="h17-2-16" class="i">+
</a><a href="#h17-2-17" id="h17-2-17" class="i">+            context.event.post(
</a><a href="#h17-2-18" id="h17-2-18" class="i">+                SnapWidgetBroadcastReceiveEvent(
</a><a href="#h17-2-19" id="h17-2-19" class="i">+                    androidContext = context.androidContext,
</a><a href="#h17-2-20" id="h17-2-20" class="i">+                    intent = intent,
</a><a href="#h17-2-21" id="h17-2-21" class="i">+                    action = action
</a><a href="#h17-2-22" id="h17-2-22" class="i">+                )
</a><a href="#h17-2-23" id="h17-2-23" class="i">+            )?.also {
</a>                 if (it.canceled) {
                     param.setResult(null)
                 }
<b>diff --git a/<a id="h18" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SharedContext.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -1,34 +0,0 @@
</a><a href="#h18-0-0" id="h18-0-0" class="d">-package me.rhunk.snapenhance
</a><a href="#h18-0-1" id="h18-0-1" class="d">-
</a><a href="#h18-0-2" id="h18-0-2" class="d">-import android.app.Activity
</a><a href="#h18-0-3" id="h18-0-3" class="d">-import android.app.AlertDialog
</a><a href="#h18-0-4" id="h18-0-4" class="d">-import android.content.Context
</a><a href="#h18-0-5" id="h18-0-5" class="d">-import android.content.Intent
</a><a href="#h18-0-6" id="h18-0-6" class="d">-import android.os.Build
</a><a href="#h18-0-7" id="h18-0-7" class="d">-import android.os.Environment
</a><a href="#h18-0-8" id="h18-0-8" class="d">-import android.provider.Settings
</a><a href="#h18-0-9" id="h18-0-9" class="d">-import me.rhunk.snapenhance.bridge.wrapper.LocaleWrapper
</a><a href="#h18-0-10" id="h18-0-10" class="d">-import me.rhunk.snapenhance.download.DownloadTaskManager
</a><a href="#h18-0-11" id="h18-0-11" class="d">-import kotlin.system.exitProcess
</a><a href="#h18-0-12" id="h18-0-12" class="d">-
</a><a href="#h18-0-13" id="h18-0-13" class="d">-/**
</a><a href="#h18-0-14" id="h18-0-14" class="d">- * Used to store objects between activities and receivers
</a><a href="#h18-0-15" id="h18-0-15" class="d">- */
</a><a href="#h18-0-16" id="h18-0-16" class="d">-object SharedContext {
</a><a href="#h18-0-17" id="h18-0-17" class="d">-    lateinit var downloadTaskManager: DownloadTaskManager
</a><a href="#h18-0-18" id="h18-0-18" class="d">-    lateinit var translation: LocaleWrapper
</a><a href="#h18-0-19" id="h18-0-19" class="d">-
</a><a href="#h18-0-20" id="h18-0-20" class="d">-    fun ensureInitialized(context: Context) {
</a><a href="#h18-0-21" id="h18-0-21" class="d">-        if (!this::downloadTaskManager.isInitialized) {
</a><a href="#h18-0-22" id="h18-0-22" class="d">-            downloadTaskManager = DownloadTaskManager().apply {
</a><a href="#h18-0-23" id="h18-0-23" class="d">-                init(context)
</a><a href="#h18-0-24" id="h18-0-24" class="d">-            }
</a><a href="#h18-0-25" id="h18-0-25" class="d">-        }
</a><a href="#h18-0-26" id="h18-0-26" class="d">-        if (!this::translation.isInitialized) {
</a><a href="#h18-0-27" id="h18-0-27" class="d">-            translation = LocaleWrapper().apply {
</a><a href="#h18-0-28" id="h18-0-28" class="d">-                loadFromContext(context)
</a><a href="#h18-0-29" id="h18-0-29" class="d">-            }
</a><a href="#h18-0-30" id="h18-0-30" class="d">-        }
</a><a href="#h18-0-31" id="h18-0-31" class="d">-        //askForPermissions(context)
</a><a href="#h18-0-32" id="h18-0-32" class="d">-    }
</a><a href="#h18-0-33" id="h18-0-33" class="d">-}</a><a href="#h18-0-34" id="h18-0-34" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h19" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/SnapEnhance.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -7,12 +7,16 @@ import android.content.pm.PackageManager
</a> import kotlinx.coroutines.runBlocking
 import kotlinx.coroutines.withContext
 import me.rhunk.snapenhance.bridge.BridgeClient
<a href="#h19-0-3" id="h19-0-3" class="i">+import me.rhunk.snapenhance.bridge.SyncCallback
</a> import me.rhunk.snapenhance.core.BuildConfig
<a href="#h19-0-5" id="h19-0-5" class="i">+import me.rhunk.snapenhance.core.eventbus.events.impl.SnapWidgetBroadcastReceiveEvent
</a><a href="#h19-0-6" id="h19-0-6" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingFriendInfo
</a><a href="#h19-0-7" id="h19-0-7" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingGroupInfo
</a> import me.rhunk.snapenhance.data.SnapClassCache
 import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
 import me.rhunk.snapenhance.hook.hook
<a href="#h19-0-12" id="h19-0-12" class="d">-import me.rhunk.snapenhance.util.getApplicationInfoCompat
</a><a href="#h19-0-13" id="h19-0-13" class="i">+import me.rhunk.snapenhance.util.ktx.getApplicationInfoCompat
</a> import kotlin.time.ExperimentalTime
 import kotlin.time.measureTime
 
<a href="#h19-1" id="h19-1" class="h">@@ -104,6 +108,7 @@ class SnapEnhance {
</a>                 //if mappings aren&#39;t loaded, we can&#39;t initialize features
                 if (!mappings.isMappingsLoaded()) return
                 features.init()
<a href="#h19-1-3" id="h19-1-3" class="i">+                syncRemote()
</a>             }
         }.also { time -&gt;
             Logger.debug(&quot;init took $time&quot;)
<a href="#h19-2" id="h19-2" class="h">@@ -121,4 +126,53 @@ class SnapEnhance {
</a>             Logger.debug(&quot;onActivityCreate took $time&quot;)
         }
     }
<a href="#h19-2-3" id="h19-2-3" class="i">+
</a><a href="#h19-2-4" id="h19-2-4" class="i">+    private fun syncRemote() {
</a><a href="#h19-2-5" id="h19-2-5" class="i">+        val database = appContext.database
</a><a href="#h19-2-6" id="h19-2-6" class="i">+
</a><a href="#h19-2-7" id="h19-2-7" class="i">+        appContext.bridgeClient.sync(object : SyncCallback.Stub() {
</a><a href="#h19-2-8" id="h19-2-8" class="i">+            override fun syncFriend(uuid: String): String? {
</a><a href="#h19-2-9" id="h19-2-9" class="i">+                return database.getFriendInfo(uuid)?.toJson()
</a><a href="#h19-2-10" id="h19-2-10" class="i">+            }
</a><a href="#h19-2-11" id="h19-2-11" class="i">+
</a><a href="#h19-2-12" id="h19-2-12" class="i">+            override fun syncGroup(uuid: String): String? {
</a><a href="#h19-2-13" id="h19-2-13" class="i">+                return database.getFeedEntryByConversationId(uuid)?.let {
</a><a href="#h19-2-14" id="h19-2-14" class="i">+                    MessagingGroupInfo(
</a><a href="#h19-2-15" id="h19-2-15" class="i">+                        it.key!!,
</a><a href="#h19-2-16" id="h19-2-16" class="i">+                        it.feedDisplayName!!,
</a><a href="#h19-2-17" id="h19-2-17" class="i">+                        it.participantsSize
</a><a href="#h19-2-18" id="h19-2-18" class="i">+                    ).toJson()
</a><a href="#h19-2-19" id="h19-2-19" class="i">+                }
</a><a href="#h19-2-20" id="h19-2-20" class="i">+            }
</a><a href="#h19-2-21" id="h19-2-21" class="i">+        })
</a><a href="#h19-2-22" id="h19-2-22" class="i">+
</a><a href="#h19-2-23" id="h19-2-23" class="i">+        appContext.event.subscribe(SnapWidgetBroadcastReceiveEvent::class) { event -&gt;
</a><a href="#h19-2-24" id="h19-2-24" class="i">+            if (event.action != BridgeClient.BRIDGE_SYNC_ACTION) return@subscribe
</a><a href="#h19-2-25" id="h19-2-25" class="i">+            event.canceled = true
</a><a href="#h19-2-26" id="h19-2-26" class="i">+            val feedEntries = appContext.database.getFeedEntries(Int.MAX_VALUE)
</a><a href="#h19-2-27" id="h19-2-27" class="i">+
</a><a href="#h19-2-28" id="h19-2-28" class="i">+            val groups = feedEntries.filter { it.friendUserId == null }.map {
</a><a href="#h19-2-29" id="h19-2-29" class="i">+                MessagingGroupInfo(
</a><a href="#h19-2-30" id="h19-2-30" class="i">+                    it.key!!,
</a><a href="#h19-2-31" id="h19-2-31" class="i">+                    it.feedDisplayName!!,
</a><a href="#h19-2-32" id="h19-2-32" class="i">+                    it.participantsSize
</a><a href="#h19-2-33" id="h19-2-33" class="i">+                )
</a><a href="#h19-2-34" id="h19-2-34" class="i">+            }
</a><a href="#h19-2-35" id="h19-2-35" class="i">+
</a><a href="#h19-2-36" id="h19-2-36" class="i">+            val friends = feedEntries.filter { it.friendUserId != null }.map {
</a><a href="#h19-2-37" id="h19-2-37" class="i">+                MessagingFriendInfo(
</a><a href="#h19-2-38" id="h19-2-38" class="i">+                    it.friendUserId!!,
</a><a href="#h19-2-39" id="h19-2-39" class="i">+                    it.friendDisplayName,
</a><a href="#h19-2-40" id="h19-2-40" class="i">+                    it.friendDisplayUsername!!.split(&quot;|&quot;)[1],
</a><a href="#h19-2-41" id="h19-2-41" class="i">+                    it.bitmojiAvatarId,
</a><a href="#h19-2-42" id="h19-2-42" class="i">+                    it.bitmojiSelfieId
</a><a href="#h19-2-43" id="h19-2-43" class="i">+                )
</a><a href="#h19-2-44" id="h19-2-44" class="i">+            }
</a><a href="#h19-2-45" id="h19-2-45" class="i">+
</a><a href="#h19-2-46" id="h19-2-46" class="i">+            appContext.bridgeClient.passGroupsAndFriends(
</a><a href="#h19-2-47" id="h19-2-47" class="i">+                groups.map { it.toJson() },
</a><a href="#h19-2-48" id="h19-2-48" class="i">+                friends.map { it.toJson() }
</a><a href="#h19-2-49" id="h19-2-49" class="i">+            )
</a><a href="#h19-2-50" id="h19-2-50" class="i">+        }
</a><a href="#h19-2-51" id="h19-2-51" class="i">+    }
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h20" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/action/impl/ExportChatMessages.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -17,7 +17,7 @@ import me.rhunk.snapenhance.action.AbstractAction
</a> import me.rhunk.snapenhance.data.ContentType
 import me.rhunk.snapenhance.data.wrapper.impl.Message
 import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
<a href="#h20-0-3" id="h20-0-3" class="d">-import me.rhunk.snapenhance.database.objects.FriendFeedInfo
</a><a href="#h20-0-4" id="h20-0-4" class="i">+import me.rhunk.snapenhance.database.objects.FriendFeedEntry
</a> import me.rhunk.snapenhance.features.impl.Messaging
 import me.rhunk.snapenhance.ui.ViewAppearanceHelper
 import me.rhunk.snapenhance.util.CallbackBuilder
<a href="#h20-1" id="h20-1" class="h">@@ -108,8 +108,8 @@ class ExportChatMessages : AbstractAction(&quot;action.export_chat_messages&quot;) {
</a>             exportType = askExportType() ?: return@launch
             mediaToDownload = if (exportType == ExportFormat.HTML) askMediaToDownload() else null
 
<a href="#h20-1-3" id="h20-1-3" class="d">-            val friendFeedEntries = context.database.getFriendFeed(20)
</a><a href="#h20-1-4" id="h20-1-4" class="d">-            val selectedConversations = mutableListOf&lt;FriendFeedInfo&gt;()
</a><a href="#h20-1-5" id="h20-1-5" class="i">+            val friendFeedEntries = context.database.getFeedEntries(20)
</a><a href="#h20-1-6" id="h20-1-6" class="i">+            val selectedConversations = mutableListOf&lt;FriendFeedEntry&gt;()
</a> 
             ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
                 .setTitle(context.translation[&quot;chat_export.select_conversation&quot;])
<a href="#h20-2" id="h20-2" class="h">@@ -182,12 +182,12 @@ class ExportChatMessages : AbstractAction(&quot;action.export_chat_messages&quot;) {
</a>         )
     }
 
<a href="#h20-2-3" id="h20-2-3" class="d">-    private suspend fun exportFullConversation(friendFeedInfo: FriendFeedInfo) {
</a><a href="#h20-2-4" id="h20-2-4" class="i">+    private suspend fun exportFullConversation(friendFeedEntry: FriendFeedEntry) {
</a>         //first fetch the first message
<a href="#h20-2-6" id="h20-2-6" class="d">-        val conversationId = friendFeedInfo.key!!
</a><a href="#h20-2-7" id="h20-2-7" class="d">-        val conversationName = friendFeedInfo.feedDisplayName ?: friendFeedInfo.friendDisplayName!!.split(&quot;|&quot;).lastOrNull() ?: &quot;unknown&quot;
</a><a href="#h20-2-8" id="h20-2-8" class="i">+        val conversationId = friendFeedEntry.key!!
</a><a href="#h20-2-9" id="h20-2-9" class="i">+        val conversationName = friendFeedEntry.feedDisplayName ?: friendFeedEntry.friendDisplayName!!.split(&quot;|&quot;).lastOrNull() ?: &quot;unknown&quot;
</a> 
<a href="#h20-2-11" id="h20-2-11" class="d">-        conversationAction(true, conversationId, if (friendFeedInfo.feedDisplayName != null) &quot;USERCREATEDGROUP&quot; else &quot;ONEONONE&quot;)
</a><a href="#h20-2-12" id="h20-2-12" class="i">+        conversationAction(true, conversationId, if (friendFeedEntry.feedDisplayName != null) &quot;USERCREATEDGROUP&quot; else &quot;ONEONONE&quot;)
</a>         
         logDialog(context.translation.format(&quot;chat_export.exporting_message&quot;, &quot;conversation&quot; to conversationName))
 
<a href="#h20-3" id="h20-3" class="h">@@ -215,7 +215,7 @@ class ExportChatMessages : AbstractAction(&quot;action.export_chat_messages&quot;) {
</a>         logDialog(context.translation[&quot;chat_export.writing_output&quot;])
         MessageExporter(
             context = context,
<a href="#h20-3-3" id="h20-3-3" class="d">-            friendFeedInfo = friendFeedInfo,
</a><a href="#h20-3-4" id="h20-3-4" class="i">+            friendFeedEntry = friendFeedEntry,
</a>             outputFile = outputFile,
             mediaToDownload = mediaToDownload,
             printLog = ::logDialog
<a href="#h20-4" id="h20-4" class="h">@@ -245,7 +245,7 @@ class ExportChatMessages : AbstractAction(&quot;action.export_chat_messages&quot;) {
</a>         }
     }
 
<a href="#h20-4-3" id="h20-4-3" class="d">-    private fun exportChatForConversations(conversations: List&lt;FriendFeedInfo&gt;) {
</a><a href="#h20-4-4" id="h20-4-4" class="i">+    private fun exportChatForConversations(conversations: List&lt;FriendFeedEntry&gt;) {
</a>         dialogLogs.clear()
         val jobs = mutableListOf&lt;Job&gt;()
 
<b>diff --git a/<a id="h21" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/bridge/BridgeClient.kt</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -15,7 +15,10 @@ import me.rhunk.snapenhance.ModContext
</a> import me.rhunk.snapenhance.bridge.types.BridgeFileType
 import me.rhunk.snapenhance.bridge.types.FileActionType
 import me.rhunk.snapenhance.core.BuildConfig
<a href="#h21-0-3" id="h21-0-3" class="i">+import me.rhunk.snapenhance.core.messaging.MessagingRule
</a><a href="#h21-0-4" id="h21-0-4" class="i">+import me.rhunk.snapenhance.core.messaging.RuleScope
</a> import me.rhunk.snapenhance.data.LocalePair
<a href="#h21-0-6" id="h21-0-6" class="i">+import me.rhunk.snapenhance.util.SerializableDataObject
</a> import java.util.concurrent.CompletableFuture
 import java.util.concurrent.Executors
 import kotlin.system.exitProcess
<a href="#h21-1" id="h21-1" class="h">@@ -27,6 +30,10 @@ class BridgeClient(
</a>     private lateinit var future: CompletableFuture&lt;Boolean&gt;
     private lateinit var service: BridgeInterface
 
<a href="#h21-1-3" id="h21-1-3" class="i">+    companion object {
</a><a href="#h21-1-4" id="h21-1-4" class="i">+        const val BRIDGE_SYNC_ACTION = &quot;me.rhunk.snapenhance.bridge.SYNC&quot;
</a><a href="#h21-1-5" id="h21-1-5" class="i">+    }
</a><a href="#h21-1-6" id="h21-1-6" class="i">+
</a>     fun start(callback: (Boolean) -&gt; Unit) {
         this.future = CompletableFuture()
 
<a href="#h21-2" id="h21-2" class="h">@@ -124,4 +131,14 @@ class BridgeClient(
</a>     }
 
     fun enqueueDownload(intent: Intent, callback: DownloadCallback) = service.enqueueDownload(intent, callback)
<a href="#h21-2-3" id="h21-2-3" class="i">+
</a><a href="#h21-2-4" id="h21-2-4" class="i">+    fun sync(callback: SyncCallback) = service.sync(callback)
</a><a href="#h21-2-5" id="h21-2-5" class="i">+
</a><a href="#h21-2-6" id="h21-2-6" class="i">+    fun passGroupsAndFriends(groups: List&lt;String&gt;, friends: List&lt;String&gt;) = service.passGroupsAndFriends(groups, friends)
</a><a href="#h21-2-7" id="h21-2-7" class="i">+
</a><a href="#h21-2-8" id="h21-2-8" class="i">+    fun getRulesFromId(type: RuleScope, targetUuid: String): List&lt;MessagingRule&gt; {
</a><a href="#h21-2-9" id="h21-2-9" class="i">+        return service.getRules(type.name, targetUuid).map {
</a><a href="#h21-2-10" id="h21-2-10" class="i">+            SerializableDataObject.fromJson(it, MessagingRule::class.java)
</a><a href="#h21-2-11" id="h21-2-11" class="i">+        }.toList()
</a><a href="#h21-2-12" id="h21-2-12" class="i">+    }
</a> }
<b>diff --git a/<a id="h22" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/EventBus.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/EventBus.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/EventBus.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/EventBus.kt</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -31,7 +31,11 @@ class EventBus(
</a>         val obj = object : IListener&lt;T&gt; {
             override fun handle(event: T) {
                 if (!filter(event)) return
<a href="#h22-0-3" id="h22-0-3" class="d">-                listener(event)
</a><a href="#h22-0-4" id="h22-0-4" class="i">+                runCatching {
</a><a href="#h22-0-5" id="h22-0-5" class="i">+                    listener(event)
</a><a href="#h22-0-6" id="h22-0-6" class="i">+                }.onFailure {
</a><a href="#h22-0-7" id="h22-0-7" class="i">+                    Logger.error(&quot;Error while handling event ${event::class.simpleName}&quot;, it)
</a><a href="#h22-0-8" id="h22-0-8" class="i">+                }
</a>             }
         }
         subscribe(event, obj)
<b>diff --git a/<a id="h23" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/events/impl/SnapWidgetBroadcastReceiveEvent.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/events/impl/SnapWidgetBroadcastReceiveEvent.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/events/impl/SnapWidgetBroadcastReceiveEvent.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/eventbus/events/impl/SnapWidgetBroadcastReceiveEvent.kt</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -0,0 +1,11 @@
</a><a href="#h23-0-0" id="h23-0-0" class="i">+package me.rhunk.snapenhance.core.eventbus.events.impl
</a><a href="#h23-0-1" id="h23-0-1" class="i">+
</a><a href="#h23-0-2" id="h23-0-2" class="i">+import android.content.Context
</a><a href="#h23-0-3" id="h23-0-3" class="i">+import android.content.Intent
</a><a href="#h23-0-4" id="h23-0-4" class="i">+import me.rhunk.snapenhance.core.eventbus.events.AbstractHookEvent
</a><a href="#h23-0-5" id="h23-0-5" class="i">+
</a><a href="#h23-0-6" id="h23-0-6" class="i">+class SnapWidgetBroadcastReceiveEvent(
</a><a href="#h23-0-7" id="h23-0-7" class="i">+    val androidContext: Context,
</a><a href="#h23-0-8" id="h23-0-8" class="i">+    val intent: Intent?,
</a><a href="#h23-0-9" id="h23-0-9" class="i">+    val action: String
</a><a href="#h23-0-10" id="h23-0-10" class="i">+) : AbstractHookEvent()</a><a href="#h23-0-11" id="h23-0-11" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h24" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumConversationFeature.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumConversationFeature.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumConversationFeature.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/EnumConversationFeature.kt</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -1,10 +0,0 @@
</a><a href="#h24-0-0" id="h24-0-0" class="d">-package me.rhunk.snapenhance.core.messaging
</a><a href="#h24-0-1" id="h24-0-1" class="d">-
</a><a href="#h24-0-2" id="h24-0-2" class="d">-enum class EnumConversationFeature(
</a><a href="#h24-0-3" id="h24-0-3" class="d">-    val value: String,
</a><a href="#h24-0-4" id="h24-0-4" class="d">-    val objectType: ObjectType,
</a><a href="#h24-0-5" id="h24-0-5" class="d">-) {
</a><a href="#h24-0-6" id="h24-0-6" class="d">-    DOWNLOAD(&quot;download&quot;, ObjectType.USER),
</a><a href="#h24-0-7" id="h24-0-7" class="d">-    STEALTH(&quot;stealth&quot;, ObjectType.CONVERSATION),
</a><a href="#h24-0-8" id="h24-0-8" class="d">-    AUTO_SAVE(&quot;auto_save&quot;, ObjectType.CONVERSATION);
</a><a href="#h24-0-9" id="h24-0-9" class="d">-}</a><a href="#h24-0-10" id="h24-0-10" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h25" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/ManagementObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/ManagementObjects.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/ManagementObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/ManagementObjects.kt</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -1,28 +0,0 @@
</a><a href="#h25-0-0" id="h25-0-0" class="d">-package me.rhunk.snapenhance.core.messaging
</a><a href="#h25-0-1" id="h25-0-1" class="d">-
</a><a href="#h25-0-2" id="h25-0-2" class="d">-
</a><a href="#h25-0-3" id="h25-0-3" class="d">-enum class Mode {
</a><a href="#h25-0-4" id="h25-0-4" class="d">-    BLACKLIST,
</a><a href="#h25-0-5" id="h25-0-5" class="d">-    WHITELIST
</a><a href="#h25-0-6" id="h25-0-6" class="d">-}
</a><a href="#h25-0-7" id="h25-0-7" class="d">-
</a><a href="#h25-0-8" id="h25-0-8" class="d">-enum class ObjectType {
</a><a href="#h25-0-9" id="h25-0-9" class="d">-    USER,
</a><a href="#h25-0-10" id="h25-0-10" class="d">-    CONVERSATION
</a><a href="#h25-0-11" id="h25-0-11" class="d">-}
</a><a href="#h25-0-12" id="h25-0-12" class="d">-
</a><a href="#h25-0-13" id="h25-0-13" class="d">-data class FriendStreaks(
</a><a href="#h25-0-14" id="h25-0-14" class="d">-    val userId: String,
</a><a href="#h25-0-15" id="h25-0-15" class="d">-    val notify: Boolean,
</a><a href="#h25-0-16" id="h25-0-16" class="d">-    val expirationTimestamp: Long,
</a><a href="#h25-0-17" id="h25-0-17" class="d">-    val count: Int
</a><a href="#h25-0-18" id="h25-0-18" class="d">-)
</a><a href="#h25-0-19" id="h25-0-19" class="d">-
</a><a href="#h25-0-20" id="h25-0-20" class="d">-data class MessagingRule(
</a><a href="#h25-0-21" id="h25-0-21" class="d">-    val id: Int,
</a><a href="#h25-0-22" id="h25-0-22" class="d">-    val objectType: ObjectType,
</a><a href="#h25-0-23" id="h25-0-23" class="d">-    val targetUuid: String,
</a><a href="#h25-0-24" id="h25-0-24" class="d">-    val enabled: Boolean,
</a><a href="#h25-0-25" id="h25-0-25" class="d">-    val mode: Mode?,
</a><a href="#h25-0-26" id="h25-0-26" class="d">-    val subject: String
</a><a href="#h25-0-27" id="h25-0-27" class="d">-)</a><a href="#h25-0-28" id="h25-0-28" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h26" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/core/messaging/MessagingCoreObjects.kt</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -0,0 +1,55 @@
</a><a href="#h26-0-0" id="h26-0-0" class="i">+package me.rhunk.snapenhance.core.messaging
</a><a href="#h26-0-1" id="h26-0-1" class="i">+
</a><a href="#h26-0-2" id="h26-0-2" class="i">+import me.rhunk.snapenhance.util.SerializableDataObject
</a><a href="#h26-0-3" id="h26-0-3" class="i">+
</a><a href="#h26-0-4" id="h26-0-4" class="i">+
</a><a href="#h26-0-5" id="h26-0-5" class="i">+enum class Mode {
</a><a href="#h26-0-6" id="h26-0-6" class="i">+    BLACKLIST,
</a><a href="#h26-0-7" id="h26-0-7" class="i">+    WHITELIST
</a><a href="#h26-0-8" id="h26-0-8" class="i">+}
</a><a href="#h26-0-9" id="h26-0-9" class="i">+
</a><a href="#h26-0-10" id="h26-0-10" class="i">+enum class RuleScope {
</a><a href="#h26-0-11" id="h26-0-11" class="i">+    FRIEND,
</a><a href="#h26-0-12" id="h26-0-12" class="i">+    GROUP
</a><a href="#h26-0-13" id="h26-0-13" class="i">+}
</a><a href="#h26-0-14" id="h26-0-14" class="i">+
</a><a href="#h26-0-15" id="h26-0-15" class="i">+enum class ConversationFeature(
</a><a href="#h26-0-16" id="h26-0-16" class="i">+    val value: String,
</a><a href="#h26-0-17" id="h26-0-17" class="i">+    val ruleScope: RuleScope,
</a><a href="#h26-0-18" id="h26-0-18" class="i">+) {
</a><a href="#h26-0-19" id="h26-0-19" class="i">+    DOWNLOAD(&quot;download&quot;, RuleScope.FRIEND),
</a><a href="#h26-0-20" id="h26-0-20" class="i">+    STEALTH(&quot;stealth&quot;, RuleScope.GROUP),
</a><a href="#h26-0-21" id="h26-0-21" class="i">+    AUTO_SAVE(&quot;auto_save&quot;, RuleScope.GROUP);
</a><a href="#h26-0-22" id="h26-0-22" class="i">+}
</a><a href="#h26-0-23" id="h26-0-23" class="i">+
</a><a href="#h26-0-24" id="h26-0-24" class="i">+data class FriendStreaks(
</a><a href="#h26-0-25" id="h26-0-25" class="i">+    val userId: String,
</a><a href="#h26-0-26" id="h26-0-26" class="i">+    val notify: Boolean,
</a><a href="#h26-0-27" id="h26-0-27" class="i">+    val expirationTimestamp: Long,
</a><a href="#h26-0-28" id="h26-0-28" class="i">+    val count: Int
</a><a href="#h26-0-29" id="h26-0-29" class="i">+) : SerializableDataObject()
</a><a href="#h26-0-30" id="h26-0-30" class="i">+
</a><a href="#h26-0-31" id="h26-0-31" class="i">+
</a><a href="#h26-0-32" id="h26-0-32" class="i">+data class MessagingGroupInfo(
</a><a href="#h26-0-33" id="h26-0-33" class="i">+    val conversationId: String,
</a><a href="#h26-0-34" id="h26-0-34" class="i">+    val name: String,
</a><a href="#h26-0-35" id="h26-0-35" class="i">+    val participantsCount: Int
</a><a href="#h26-0-36" id="h26-0-36" class="i">+) : SerializableDataObject()
</a><a href="#h26-0-37" id="h26-0-37" class="i">+
</a><a href="#h26-0-38" id="h26-0-38" class="i">+data class MessagingFriendInfo(
</a><a href="#h26-0-39" id="h26-0-39" class="i">+    val userId: String,
</a><a href="#h26-0-40" id="h26-0-40" class="i">+    val displayName: String?,
</a><a href="#h26-0-41" id="h26-0-41" class="i">+    val mutableUsername: String,
</a><a href="#h26-0-42" id="h26-0-42" class="i">+    val bitmojiId: String?,
</a><a href="#h26-0-43" id="h26-0-43" class="i">+    val selfieId: String?
</a><a href="#h26-0-44" id="h26-0-44" class="i">+) : SerializableDataObject()
</a><a href="#h26-0-45" id="h26-0-45" class="i">+
</a><a href="#h26-0-46" id="h26-0-46" class="i">+
</a><a href="#h26-0-47" id="h26-0-47" class="i">+data class MessagingRule(
</a><a href="#h26-0-48" id="h26-0-48" class="i">+    val id: Int,
</a><a href="#h26-0-49" id="h26-0-49" class="i">+    val ruleScope: RuleScope,
</a><a href="#h26-0-50" id="h26-0-50" class="i">+    val targetUuid: String,
</a><a href="#h26-0-51" id="h26-0-51" class="i">+    val enabled: Boolean,
</a><a href="#h26-0-52" id="h26-0-52" class="i">+    val mode: Mode?,
</a><a href="#h26-0-53" id="h26-0-53" class="i">+    val subject: String
</a><a href="#h26-0-54" id="h26-0-54" class="i">+) : SerializableDataObject()</a><a href="#h26-0-55" id="h26-0-55" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h27" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/Message.kt</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -2,7 +2,7 @@ package me.rhunk.snapenhance.data.wrapper.impl
</a> 
 import me.rhunk.snapenhance.data.MessageState
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
<a href="#h27-0-3" id="h27-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h27-0-4" id="h27-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> 
 class Message(obj: Any?) : AbstractWrapper(obj) {
     val orderKey get() = instanceNonNull().getObjectField(&quot;mOrderKey&quot;) as Long
<b>diff --git a/<a id="h28" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageContent.kt</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -2,8 +2,8 @@ package me.rhunk.snapenhance.data.wrapper.impl
</a> 
 import me.rhunk.snapenhance.data.ContentType
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
<a href="#h28-0-3" id="h28-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h28-0-4" id="h28-0-4" class="d">-import me.rhunk.snapenhance.util.setObjectField
</a><a href="#h28-0-5" id="h28-0-5" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a><a href="#h28-0-6" id="h28-0-6" class="i">+import me.rhunk.snapenhance.util.ktx.setObjectField
</a> 
 class MessageContent(obj: Any?) : AbstractWrapper(obj) {
     var content
<b>diff --git a/<a id="h29" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDescriptor.kt</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -1,7 +1,7 @@
</a> package me.rhunk.snapenhance.data.wrapper.impl
 
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
<a href="#h29-0-3" id="h29-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h29-0-4" id="h29-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> 
 class MessageDescriptor(obj: Any?) : AbstractWrapper(obj) {
     val messageId: Long get() = instanceNonNull().getObjectField(&quot;mMessageId&quot;) as Long
<b>diff --git a/<a id="h30" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageDestinations.kt</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -1,8 +1,8 @@
</a> package me.rhunk.snapenhance.data.wrapper.impl
 
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
<a href="#h30-0-3" id="h30-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h30-0-4" id="h30-0-4" class="d">-import me.rhunk.snapenhance.util.setObjectField
</a><a href="#h30-0-5" id="h30-0-5" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a><a href="#h30-0-6" id="h30-0-6" class="i">+import me.rhunk.snapenhance.util.ktx.setObjectField
</a> 
 @Suppress(&quot;UNCHECKED_CAST&quot;)
 class MessageDestinations(obj: Any) : AbstractWrapper(obj){
<b>diff --git a/<a id="h31" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/MessageMetadata.kt</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -2,7 +2,7 @@ package me.rhunk.snapenhance.data.wrapper.impl
</a> 
 import me.rhunk.snapenhance.data.PlayableSnapState
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
<a href="#h31-0-3" id="h31-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h31-0-4" id="h31-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> 
 class MessageMetadata(obj: Any?) : AbstractWrapper(obj){
     val createdAt: Long get() = instanceNonNull().getObjectField(&quot;mCreatedAt&quot;) as Long
<b>diff --git a/<a id="h32" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/SnapUUID.kt</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -2,7 +2,7 @@ package me.rhunk.snapenhance.data.wrapper.impl
</a> 
 import me.rhunk.snapenhance.SnapEnhance
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
<a href="#h32-0-3" id="h32-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h32-0-4" id="h32-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> import java.nio.ByteBuffer
 import java.util.UUID
 
<b>diff --git a/<a id="h33" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/UserIdToReaction.kt</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -1,7 +1,7 @@
</a> package me.rhunk.snapenhance.data.wrapper.impl
 
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
<a href="#h33-0-3" id="h33-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h33-0-4" id="h33-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> 
 class UserIdToReaction(obj: Any?) : AbstractWrapper(obj) {
     val userId = SnapUUID(instanceNonNull().getObjectField(&quot;mUserId&quot;))
<b>diff --git a/<a id="h34" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/MediaInfo.kt</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -2,7 +2,7 @@ package me.rhunk.snapenhance.data.wrapper.impl.media
</a> 
 import android.os.Parcelable
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
<a href="#h34-0-3" id="h34-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h34-0-4" id="h34-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> import java.lang.reflect.Field
 
 
<b>diff --git a/<a id="h35" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/data/wrapper/impl/media/opera/ParamMap.kt</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -2,7 +2,7 @@ package me.rhunk.snapenhance.data.wrapper.impl.media.opera
</a> 
 import me.rhunk.snapenhance.data.wrapper.AbstractWrapper
 import me.rhunk.snapenhance.util.ReflectionHelper
<a href="#h35-0-3" id="h35-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h35-0-4" id="h35-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> import java.lang.reflect.Field
 import java.util.concurrent.ConcurrentHashMap
 
<b>diff --git a/<a id="h36" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/DatabaseAccess.kt</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -74,10 +74,10 @@ class DatabaseAccess(private val context: ModContext) : Manager {
</a>         return obj
     }
 
<a href="#h36-0-3" id="h36-0-3" class="d">-    fun getFriendFeedInfoByUserId(userId: String): FriendFeedInfo? {
</a><a href="#h36-0-4" id="h36-0-4" class="i">+    fun getFeedEntryByUserId(userId: String): FriendFeedEntry? {
</a>         return safeDatabaseOperation(openMain()) { database -&gt;
             readDatabaseObject(
<a href="#h36-0-7" id="h36-0-7" class="d">-                FriendFeedInfo(),
</a><a href="#h36-0-8" id="h36-0-8" class="i">+                FriendFeedEntry(),
</a>                 database,
                 &quot;FriendsFeedView&quot;,
                 &quot;friendUserId = ?&quot;,
<a href="#h36-1" id="h36-1" class="h">@@ -86,10 +86,10 @@ class DatabaseAccess(private val context: ModContext) : Manager {
</a>         }
     }
 
<a href="#h36-1-3" id="h36-1-3" class="d">-    fun getFriendFeedInfoByConversationId(conversationId: String): FriendFeedInfo? {
</a><a href="#h36-1-4" id="h36-1-4" class="i">+    fun getFeedEntryByConversationId(conversationId: String): FriendFeedEntry? {
</a>         return safeDatabaseOperation(openMain()) {
             readDatabaseObject(
<a href="#h36-1-7" id="h36-1-7" class="d">-                FriendFeedInfo(),
</a><a href="#h36-1-8" id="h36-1-8" class="i">+                FriendFeedEntry(),
</a>                 it,
                 &quot;FriendsFeedView&quot;,
                 &quot;key = ?&quot;,
<a href="#h36-2" id="h36-2" class="h">@@ -110,19 +110,19 @@ class DatabaseAccess(private val context: ModContext) : Manager {
</a>         }
     }
 
<a href="#h36-2-3" id="h36-2-3" class="d">-    fun getFriendFeed(limit: Int): List&lt;FriendFeedInfo&gt; {
</a><a href="#h36-2-4" id="h36-2-4" class="i">+    fun getFeedEntries(limit: Int): List&lt;FriendFeedEntry&gt; {
</a>         return safeDatabaseOperation(openMain()) { database -&gt;
             val cursor = database.rawQuery(
                 &quot;SELECT * FROM FriendsFeedView ORDER BY _id LIMIT ?&quot;,
                 arrayOf(limit.toString())
             )
<a href="#h36-2-10" id="h36-2-10" class="d">-            val list = mutableListOf&lt;FriendFeedInfo&gt;()
</a><a href="#h36-2-11" id="h36-2-11" class="i">+            val list = mutableListOf&lt;FriendFeedEntry&gt;()
</a>             while (cursor.moveToNext()) {
<a href="#h36-2-13" id="h36-2-13" class="d">-                val friendFeedInfo = FriendFeedInfo()
</a><a href="#h36-2-14" id="h36-2-14" class="i">+                val friendFeedEntry = FriendFeedEntry()
</a>                 try {
<a href="#h36-2-16" id="h36-2-16" class="d">-                    friendFeedInfo.write(cursor)
</a><a href="#h36-2-17" id="h36-2-17" class="i">+                    friendFeedEntry.write(cursor)
</a>                 } catch (_: Throwable) {}
<a href="#h36-2-19" id="h36-2-19" class="d">-                list.add(friendFeedInfo)
</a><a href="#h36-2-20" id="h36-2-20" class="i">+                list.add(friendFeedEntry)
</a>             }
             cursor.close()
             list
<b>diff --git a/<a id="h37" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/ConversationMessage.kt</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -5,10 +5,10 @@ import android.database.Cursor
</a> import me.rhunk.snapenhance.Constants
 import me.rhunk.snapenhance.data.ContentType
 import me.rhunk.snapenhance.database.DatabaseObject
<a href="#h37-0-3" id="h37-0-3" class="d">-import me.rhunk.snapenhance.util.getBlobOrNull
</a><a href="#h37-0-4" id="h37-0-4" class="d">-import me.rhunk.snapenhance.util.getInteger
</a><a href="#h37-0-5" id="h37-0-5" class="d">-import me.rhunk.snapenhance.util.getLong
</a><a href="#h37-0-6" id="h37-0-6" class="d">-import me.rhunk.snapenhance.util.getStringOrNull
</a><a href="#h37-0-7" id="h37-0-7" class="i">+import me.rhunk.snapenhance.util.ktx.getBlobOrNull
</a><a href="#h37-0-8" id="h37-0-8" class="i">+import me.rhunk.snapenhance.util.ktx.getInteger
</a><a href="#h37-0-9" id="h37-0-9" class="i">+import me.rhunk.snapenhance.util.ktx.getLong
</a><a href="#h37-0-10" id="h37-0-10" class="i">+import me.rhunk.snapenhance.util.ktx.getStringOrNull
</a> import me.rhunk.snapenhance.util.protobuf.ProtoReader
 
 @Suppress(&quot;ArrayInDataClass&quot;)
<b>diff --git a/<a id="h38" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedEntry.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedEntry.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedEntry.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedEntry.kt</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -0,0 +1,47 @@
</a><a href="#h38-0-0" id="h38-0-0" class="i">+package me.rhunk.snapenhance.database.objects
</a><a href="#h38-0-1" id="h38-0-1" class="i">+
</a><a href="#h38-0-2" id="h38-0-2" class="i">+import android.annotation.SuppressLint
</a><a href="#h38-0-3" id="h38-0-3" class="i">+import android.database.Cursor
</a><a href="#h38-0-4" id="h38-0-4" class="i">+import me.rhunk.snapenhance.database.DatabaseObject
</a><a href="#h38-0-5" id="h38-0-5" class="i">+import me.rhunk.snapenhance.util.ktx.getIntOrNull
</a><a href="#h38-0-6" id="h38-0-6" class="i">+import me.rhunk.snapenhance.util.ktx.getInteger
</a><a href="#h38-0-7" id="h38-0-7" class="i">+import me.rhunk.snapenhance.util.ktx.getLong
</a><a href="#h38-0-8" id="h38-0-8" class="i">+import me.rhunk.snapenhance.util.ktx.getStringOrNull
</a><a href="#h38-0-9" id="h38-0-9" class="i">+
</a><a href="#h38-0-10" id="h38-0-10" class="i">+data class FriendFeedEntry(
</a><a href="#h38-0-11" id="h38-0-11" class="i">+    var id: Int = 0,
</a><a href="#h38-0-12" id="h38-0-12" class="i">+    var feedDisplayName: String? = null,
</a><a href="#h38-0-13" id="h38-0-13" class="i">+    var participantsSize: Int = 0,
</a><a href="#h38-0-14" id="h38-0-14" class="i">+    var lastInteractionTimestamp: Long = 0,
</a><a href="#h38-0-15" id="h38-0-15" class="i">+    var displayTimestamp: Long = 0,
</a><a href="#h38-0-16" id="h38-0-16" class="i">+    var displayInteractionType: String? = null,
</a><a href="#h38-0-17" id="h38-0-17" class="i">+    var lastInteractionUserId: Int? = null,
</a><a href="#h38-0-18" id="h38-0-18" class="i">+    var key: String? = null,
</a><a href="#h38-0-19" id="h38-0-19" class="i">+    var friendUserId: String? = null,
</a><a href="#h38-0-20" id="h38-0-20" class="i">+    var friendDisplayName: String? = null,
</a><a href="#h38-0-21" id="h38-0-21" class="i">+    var friendDisplayUsername: String? = null,
</a><a href="#h38-0-22" id="h38-0-22" class="i">+    var friendLinkType: Int? = null,
</a><a href="#h38-0-23" id="h38-0-23" class="i">+    var bitmojiAvatarId: String? = null,
</a><a href="#h38-0-24" id="h38-0-24" class="i">+    var bitmojiSelfieId: String? = null,
</a><a href="#h38-0-25" id="h38-0-25" class="i">+) : DatabaseObject {
</a><a href="#h38-0-26" id="h38-0-26" class="i">+
</a><a href="#h38-0-27" id="h38-0-27" class="i">+    @SuppressLint(&quot;Range&quot;)
</a><a href="#h38-0-28" id="h38-0-28" class="i">+    override fun write(cursor: Cursor) {
</a><a href="#h38-0-29" id="h38-0-29" class="i">+        with(cursor) {
</a><a href="#h38-0-30" id="h38-0-30" class="i">+            id = getInteger(&quot;_id&quot;)
</a><a href="#h38-0-31" id="h38-0-31" class="i">+            feedDisplayName = getStringOrNull(&quot;feedDisplayName&quot;)
</a><a href="#h38-0-32" id="h38-0-32" class="i">+            participantsSize = getInteger(&quot;participantsSize&quot;)
</a><a href="#h38-0-33" id="h38-0-33" class="i">+            lastInteractionTimestamp = getLong(&quot;lastInteractionTimestamp&quot;)
</a><a href="#h38-0-34" id="h38-0-34" class="i">+            displayTimestamp = getLong(&quot;displayTimestamp&quot;)
</a><a href="#h38-0-35" id="h38-0-35" class="i">+            displayInteractionType = getStringOrNull(&quot;displayInteractionType&quot;)
</a><a href="#h38-0-36" id="h38-0-36" class="i">+            lastInteractionUserId = getIntOrNull(&quot;lastInteractionUserId&quot;)
</a><a href="#h38-0-37" id="h38-0-37" class="i">+            key = getStringOrNull(&quot;key&quot;)
</a><a href="#h38-0-38" id="h38-0-38" class="i">+            friendUserId = getStringOrNull(&quot;friendUserId&quot;)
</a><a href="#h38-0-39" id="h38-0-39" class="i">+            friendDisplayName = getStringOrNull(&quot;friendDisplayName&quot;)
</a><a href="#h38-0-40" id="h38-0-40" class="i">+            friendDisplayUsername = getStringOrNull(&quot;friendDisplayUsername&quot;)
</a><a href="#h38-0-41" id="h38-0-41" class="i">+            friendLinkType = getIntOrNull(&quot;friendLinkType&quot;)
</a><a href="#h38-0-42" id="h38-0-42" class="i">+            bitmojiAvatarId = getStringOrNull(&quot;bitmojiAvatarId&quot;)
</a><a href="#h38-0-43" id="h38-0-43" class="i">+            bitmojiSelfieId = getStringOrNull(&quot;bitmojiSelfieId&quot;)
</a><a href="#h38-0-44" id="h38-0-44" class="i">+        }
</a><a href="#h38-0-45" id="h38-0-45" class="i">+    }
</a><a href="#h38-0-46" id="h38-0-46" class="i">+}
</a><b>diff --git a/<a id="h39" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendFeedInfo.kt</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -1,38 +0,0 @@
</a><a href="#h39-0-0" id="h39-0-0" class="d">-package me.rhunk.snapenhance.database.objects
</a><a href="#h39-0-1" id="h39-0-1" class="d">-
</a><a href="#h39-0-2" id="h39-0-2" class="d">-import android.annotation.SuppressLint
</a><a href="#h39-0-3" id="h39-0-3" class="d">-import android.database.Cursor
</a><a href="#h39-0-4" id="h39-0-4" class="d">-import me.rhunk.snapenhance.database.DatabaseObject
</a><a href="#h39-0-5" id="h39-0-5" class="d">-import me.rhunk.snapenhance.util.getInteger
</a><a href="#h39-0-6" id="h39-0-6" class="d">-import me.rhunk.snapenhance.util.getLong
</a><a href="#h39-0-7" id="h39-0-7" class="d">-import me.rhunk.snapenhance.util.getStringOrNull
</a><a href="#h39-0-8" id="h39-0-8" class="d">-
</a><a href="#h39-0-9" id="h39-0-9" class="d">-data class FriendFeedInfo(
</a><a href="#h39-0-10" id="h39-0-10" class="d">-    var id: Int = 0,
</a><a href="#h39-0-11" id="h39-0-11" class="d">-    var feedDisplayName: String? = null,
</a><a href="#h39-0-12" id="h39-0-12" class="d">-    var participantsSize: Int = 0,
</a><a href="#h39-0-13" id="h39-0-13" class="d">-    var lastInteractionTimestamp: Long = 0,
</a><a href="#h39-0-14" id="h39-0-14" class="d">-    var displayTimestamp: Long = 0,
</a><a href="#h39-0-15" id="h39-0-15" class="d">-    var displayInteractionType: String? = null,
</a><a href="#h39-0-16" id="h39-0-16" class="d">-    var lastInteractionUserId: Int = 0,
</a><a href="#h39-0-17" id="h39-0-17" class="d">-    var key: String? = null,
</a><a href="#h39-0-18" id="h39-0-18" class="d">-    var friendUserId: String? = null,
</a><a href="#h39-0-19" id="h39-0-19" class="d">-    var friendDisplayName: String? = null,
</a><a href="#h39-0-20" id="h39-0-20" class="d">-) : DatabaseObject {
</a><a href="#h39-0-21" id="h39-0-21" class="d">-
</a><a href="#h39-0-22" id="h39-0-22" class="d">-    @SuppressLint(&quot;Range&quot;)
</a><a href="#h39-0-23" id="h39-0-23" class="d">-    override fun write(cursor: Cursor) {
</a><a href="#h39-0-24" id="h39-0-24" class="d">-        with(cursor) {
</a><a href="#h39-0-25" id="h39-0-25" class="d">-            id = getInteger(&quot;_id&quot;)
</a><a href="#h39-0-26" id="h39-0-26" class="d">-            feedDisplayName = getStringOrNull(&quot;feedDisplayName&quot;)
</a><a href="#h39-0-27" id="h39-0-27" class="d">-            participantsSize = getInteger(&quot;participantsSize&quot;)
</a><a href="#h39-0-28" id="h39-0-28" class="d">-            lastInteractionTimestamp = getLong(&quot;lastInteractionTimestamp&quot;)
</a><a href="#h39-0-29" id="h39-0-29" class="d">-            displayTimestamp = getLong(&quot;displayTimestamp&quot;)
</a><a href="#h39-0-30" id="h39-0-30" class="d">-            displayInteractionType = getStringOrNull(&quot;displayInteractionType&quot;)
</a><a href="#h39-0-31" id="h39-0-31" class="d">-            lastInteractionUserId = getInteger(&quot;lastInteractionUserId&quot;)
</a><a href="#h39-0-32" id="h39-0-32" class="d">-            key = getStringOrNull(&quot;key&quot;)
</a><a href="#h39-0-33" id="h39-0-33" class="d">-            friendUserId = getStringOrNull(&quot;friendUserId&quot;)
</a><a href="#h39-0-34" id="h39-0-34" class="d">-            friendDisplayName = getStringOrNull(&quot;friendDisplayUsername&quot;)
</a><a href="#h39-0-35" id="h39-0-35" class="d">-        }
</a><a href="#h39-0-36" id="h39-0-36" class="d">-    }
</a><a href="#h39-0-37" id="h39-0-37" class="d">-}
</a><b>diff --git a/<a id="h40" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/FriendInfo.kt</a></b>
<a href="#h40-0" id="h40-0" class="h">@@ -3,9 +3,10 @@ package me.rhunk.snapenhance.database.objects
</a> import android.annotation.SuppressLint
 import android.database.Cursor
 import me.rhunk.snapenhance.database.DatabaseObject
<a href="#h40-0-3" id="h40-0-3" class="d">-import me.rhunk.snapenhance.util.getInteger
</a><a href="#h40-0-4" id="h40-0-4" class="d">-import me.rhunk.snapenhance.util.getLong
</a><a href="#h40-0-5" id="h40-0-5" class="d">-import me.rhunk.snapenhance.util.getStringOrNull
</a><a href="#h40-0-6" id="h40-0-6" class="i">+import me.rhunk.snapenhance.util.SerializableDataObject
</a><a href="#h40-0-7" id="h40-0-7" class="i">+import me.rhunk.snapenhance.util.ktx.getInteger
</a><a href="#h40-0-8" id="h40-0-8" class="i">+import me.rhunk.snapenhance.util.ktx.getLong
</a><a href="#h40-0-9" id="h40-0-9" class="i">+import me.rhunk.snapenhance.util.ktx.getStringOrNull
</a> 
 data class FriendInfo(
     var id: Int = 0,
<a href="#h40-1" id="h40-1" class="h">@@ -30,7 +31,7 @@ data class FriendInfo(
</a>     var isPinnedBestFriend: Int = 0,
     var plusBadgeVisibility: Int = 0,
     var usernameForSorting: String? = null
<a href="#h40-1-3" id="h40-1-3" class="d">-) : DatabaseObject {
</a><a href="#h40-1-4" id="h40-1-4" class="i">+) : DatabaseObject, SerializableDataObject() {
</a>     @SuppressLint(&quot;Range&quot;)
     override fun write(cursor: Cursor) {
         with(cursor) {
<b>diff --git a/<a id="h41" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/StoryEntry.kt</a></b>
<a href="#h41-0" id="h41-0" class="h">@@ -3,8 +3,8 @@ package me.rhunk.snapenhance.database.objects
</a> import android.annotation.SuppressLint
 import android.database.Cursor
 import me.rhunk.snapenhance.database.DatabaseObject
<a href="#h41-0-3" id="h41-0-3" class="d">-import me.rhunk.snapenhance.util.getInteger
</a><a href="#h41-0-4" id="h41-0-4" class="d">-import me.rhunk.snapenhance.util.getStringOrNull
</a><a href="#h41-0-5" id="h41-0-5" class="i">+import me.rhunk.snapenhance.util.ktx.getInteger
</a><a href="#h41-0-6" id="h41-0-6" class="i">+import me.rhunk.snapenhance.util.ktx.getStringOrNull
</a> 
 data class StoryEntry(
     var id: Int = 0,
<b>diff --git a/<a id="h42" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/database/objects/UserConversationLink.kt</a></b>
<a href="#h42-0" id="h42-0" class="h">@@ -3,8 +3,8 @@ package me.rhunk.snapenhance.database.objects
</a> import android.annotation.SuppressLint
 import android.database.Cursor
 import me.rhunk.snapenhance.database.DatabaseObject
<a href="#h42-0-3" id="h42-0-3" class="d">-import me.rhunk.snapenhance.util.getInteger
</a><a href="#h42-0-4" id="h42-0-4" class="d">-import me.rhunk.snapenhance.util.getStringOrNull
</a><a href="#h42-0-5" id="h42-0-5" class="i">+import me.rhunk.snapenhance.util.ktx.getInteger
</a><a href="#h42-0-6" id="h42-0-6" class="i">+import me.rhunk.snapenhance.util.ktx.getStringOrNull
</a> 
 class UserConversationLink(
     var userId: String? = null,
<b>diff --git a/<a id="h43" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/download/DownloadTaskManager.kt</a></b>
<a href="#h43-0" id="h43-0" class="h">@@ -8,8 +8,8 @@ import me.rhunk.snapenhance.download.data.DownloadObject
</a> import me.rhunk.snapenhance.download.data.DownloadStage
 import me.rhunk.snapenhance.download.data.MediaFilter
 import me.rhunk.snapenhance.util.SQLiteDatabaseHelper
<a href="#h43-0-3" id="h43-0-3" class="d">-import me.rhunk.snapenhance.util.getIntOrNull
</a><a href="#h43-0-4" id="h43-0-4" class="d">-import me.rhunk.snapenhance.util.getStringOrNull
</a><a href="#h43-0-5" id="h43-0-5" class="i">+import me.rhunk.snapenhance.util.ktx.getIntOrNull
</a><a href="#h43-0-6" id="h43-0-6" class="i">+import me.rhunk.snapenhance.util.ktx.getStringOrNull
</a> 
 class DownloadTaskManager {
     private lateinit var taskDatabase: SQLiteDatabase
<b>diff --git a/<a id="h44" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigurationOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigurationOverride.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigurationOverride.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ConfigurationOverride.kt</a></b>
<a href="#h44-0" id="h44-0" class="h">@@ -5,7 +5,7 @@ import me.rhunk.snapenhance.features.Feature
</a> import me.rhunk.snapenhance.features.FeatureLoadParams
 import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.hook
<a href="#h44-0-3" id="h44-0-3" class="d">-import me.rhunk.snapenhance.util.setObjectField
</a><a href="#h44-0-4" id="h44-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.setObjectField
</a> 
 class ConfigurationOverride : Feature(&quot;Configuration Override&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
     override fun init() {
<b>diff --git a/<a id="h45" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/Messaging.kt</a></b>
<a href="#h45-0" id="h45-0" class="h">@@ -8,7 +8,7 @@ import me.rhunk.snapenhance.features.impl.spying.StealthMode
</a> import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
 import me.rhunk.snapenhance.hook.hook
<a href="#h45-0-3" id="h45-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h45-0-4" id="h45-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> 
 class Messaging : Feature(&quot;Messaging&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC or FeatureLoadParams.INIT_ASYNC or FeatureLoadParams.INIT_SYNC) {
     lateinit var conversationManager: Any
<b>diff --git a/<a id="h46" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></b>
<a href="#h46-0" id="h46-0" class="h">@@ -6,7 +6,6 @@ import android.graphics.BitmapFactory
</a> import android.net.Uri
 import android.widget.ImageView
 import kotlinx.coroutines.runBlocking
<a href="#h46-0-3" id="h46-0-3" class="d">-import me.rhunk.snapenhance.Constants.ARROYO_URL_KEY_PROTO_PATH
</a> import me.rhunk.snapenhance.Logger
 import me.rhunk.snapenhance.Logger.xposedLog
 import me.rhunk.snapenhance.bridge.DownloadCallback
<a href="#h46-1" id="h46-1" class="h">@@ -22,6 +21,7 @@ import me.rhunk.snapenhance.download.DownloadManagerClient
</a> import me.rhunk.snapenhance.download.data.DownloadMediaType
 import me.rhunk.snapenhance.download.data.DownloadMetadata
 import me.rhunk.snapenhance.download.data.InputMedia
<a href="#h46-1-3" id="h46-1-3" class="i">+import me.rhunk.snapenhance.download.data.MediaFilter
</a> import me.rhunk.snapenhance.download.data.SplitMediaAssetType
 import me.rhunk.snapenhance.download.data.toKeyPair
 import me.rhunk.snapenhance.features.Feature
<a href="#h46-2" id="h46-2" class="h">@@ -32,9 +32,8 @@ import me.rhunk.snapenhance.hook.HookAdapter
</a> import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
 import me.rhunk.snapenhance.ui.ViewAppearanceHelper
<a href="#h46-2-3" id="h46-2-3" class="d">-import me.rhunk.snapenhance.download.data.MediaFilter
</a> import me.rhunk.snapenhance.util.download.RemoteMediaResolver
<a href="#h46-2-5" id="h46-2-5" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h46-2-6" id="h46-2-6" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> import me.rhunk.snapenhance.util.protobuf.ProtoReader
 import me.rhunk.snapenhance.util.snap.BitmojiSelfie
 import me.rhunk.snapenhance.util.snap.EncryptionHelper
<b>diff --git a/<a id="h47" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/experiments/UnlimitedMultiSnap.kt</a></b>
<a href="#h47-0" id="h47-0" class="h">@@ -4,7 +4,7 @@ import me.rhunk.snapenhance.features.Feature
</a> import me.rhunk.snapenhance.features.FeatureLoadParams
 import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.hookConstructor
<a href="#h47-0-3" id="h47-0-3" class="d">-import me.rhunk.snapenhance.util.setObjectField
</a><a href="#h47-0-4" id="h47-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.setObjectField
</a> 
 class UnlimitedMultiSnap : Feature(&quot;UnlimitedMultiSnap&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
<b>diff --git a/<a id="h48" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/AnonymousStoryViewing.kt</a></b>
<a href="#h48-0" id="h48-0" class="h">@@ -4,7 +4,7 @@ import me.rhunk.snapenhance.features.Feature
</a> import me.rhunk.snapenhance.features.FeatureLoadParams
 import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
<a href="#h48-0-3" id="h48-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h48-0-4" id="h48-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> 
 class AnonymousStoryViewing : Feature(&quot;Anonymous Story Viewing&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
     override fun asyncOnActivityCreate() {
<b>diff --git a/<a id="h49" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/spying/MessageLogger.kt</a></b>
<a href="#h49-0" id="h49-0" class="h">@@ -71,7 +71,7 @@ class MessageLogger : Feature(&quot;MessageLogger&quot;,
</a>         }
 
         measureTime {
<a href="#h49-0-3" id="h49-0-3" class="d">-            context.database.getFriendFeed(PREFETCH_FEED_COUNT).forEach { friendFeedInfo -&gt;
</a><a href="#h49-0-4" id="h49-0-4" class="i">+            context.database.getFeedEntries(PREFETCH_FEED_COUNT).forEach { friendFeedInfo -&gt;
</a>                 fetchedMessages.addAll(context.bridgeClient.getLoggedMessageIds(friendFeedInfo.key!!, PREFETCH_MESSAGE_COUNT).toList())
             }
         }.also { Logger.debug(&quot;Loaded ${fetchedMessages.size} cached messages in $it&quot;) }
<b>diff --git a/<a id="h50" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a></b>
<a href="#h50-0" id="h50-0" class="h">@@ -12,7 +12,7 @@ import me.rhunk.snapenhance.features.impl.spying.StealthMode
</a> import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.Hooker
 import me.rhunk.snapenhance.util.CallbackBuilder
<a href="#h50-0-3" id="h50-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h50-0-4" id="h50-0-4" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a> import java.util.concurrent.Executors
 
 class AutoSave : Feature(&quot;Auto Save&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
<b>diff --git a/<a id="h51" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a></b>
<a href="#h51-0" id="h51-0" class="h">@@ -12,8 +12,8 @@ import android.os.Bundle
</a> import android.os.UserHandle
 import de.robv.android.xposed.XposedBridge
 import de.robv.android.xposed.XposedHelpers
<a href="#h51-0-3" id="h51-0-3" class="d">-import me.rhunk.snapenhance.Constants
</a> import me.rhunk.snapenhance.Logger
<a href="#h51-0-5" id="h51-0-5" class="i">+import me.rhunk.snapenhance.core.eventbus.events.impl.SnapWidgetBroadcastReceiveEvent
</a> import me.rhunk.snapenhance.data.ContentType
 import me.rhunk.snapenhance.data.MediaReferenceType
 import me.rhunk.snapenhance.data.wrapper.impl.Message
<a href="#h51-1" id="h51-1" class="h">@@ -31,6 +31,7 @@ import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a> import me.rhunk.snapenhance.util.snap.EncryptionHelper
 import me.rhunk.snapenhance.util.snap.MediaDownloaderHelper
 import me.rhunk.snapenhance.util.snap.PreviewUtils
<a href="#h51-1-3" id="h51-1-3" class="i">+import me.rhunk.snapenhance.util.snap.SnapWidgetBroadcastReceiverHelper
</a> 
 class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
     companion object{
<a href="#h51-2" id="h51-2" class="h">@@ -42,10 +43,6 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>     private val cachedMessages = mutableMapOf&lt;String, MutableList&lt;String&gt;&gt;() // conversationId =&gt; cached messages
     private val notificationIdMap = mutableMapOf&lt;Int, String&gt;() // notificationId =&gt; conversationId
 
<a href="#h51-2-3" id="h51-2-3" class="d">-    private val broadcastReceiverClass by lazy {
</a><a href="#h51-2-4" id="h51-2-4" class="d">-        context.androidContext.classLoader.loadClass(&quot;com.snap.widgets.core.BestFriendsWidgetProvider&quot;)
</a><a href="#h51-2-5" id="h51-2-5" class="d">-    }
</a><a href="#h51-2-6" id="h51-2-6" class="d">-
</a>     private val notifyAsUserMethod by lazy {
         XposedHelpers.findMethodExact(
             NotificationManager::class.java, &quot;notifyAsUser&quot;,
<a href="#h51-3" id="h51-3" class="h">@@ -102,16 +99,18 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a> 
         fun newAction(title: String, remoteAction: String, filter: (() -&gt; Boolean), builder: (Notification.Action.Builder) -&gt; Unit) {
             if (!filter()) return
<a href="#h51-3-3" id="h51-3-3" class="d">-            val intent = Intent().setClassName(Constants.SNAPCHAT_PACKAGE_NAME, broadcastReceiverClass.name)
</a><a href="#h51-3-4" id="h51-3-4" class="d">-                .putExtra(&quot;conversation_id&quot;, conversationId)
</a><a href="#h51-3-5" id="h51-3-5" class="d">-                .putExtra(&quot;notification_id&quot;, notificationData.id)
</a><a href="#h51-3-6" id="h51-3-6" class="d">-                .putExtra(&quot;message_id&quot;, messageId)
</a><a href="#h51-3-7" id="h51-3-7" class="d">-                .setAction(remoteAction)
</a><a href="#h51-3-8" id="h51-3-8" class="i">+
</a><a href="#h51-3-9" id="h51-3-9" class="i">+            val intent = SnapWidgetBroadcastReceiverHelper.create(remoteAction) {
</a><a href="#h51-3-10" id="h51-3-10" class="i">+                putExtra(&quot;conversation_id&quot;, conversationId)
</a><a href="#h51-3-11" id="h51-3-11" class="i">+                putExtra(&quot;notification_id&quot;, notificationData.id)
</a><a href="#h51-3-12" id="h51-3-12" class="i">+                putExtra(&quot;message_id&quot;, messageId)
</a><a href="#h51-3-13" id="h51-3-13" class="i">+            }
</a><a href="#h51-3-14" id="h51-3-14" class="i">+
</a>             val action = Notification.Action.Builder(null, title, PendingIntent.getBroadcast(
                 context.androidContext,
                 System.nanoTime().toInt(),
                 intent,
<a href="#h51-3-19" id="h51-3-19" class="d">-                PendingIntent.FLAG_CANCEL_CURRENT or PendingIntent.FLAG_MUTABLE
</a><a href="#h51-3-20" id="h51-3-20" class="i">+                PendingIntent.FLAG_MUTABLE
</a>             )).apply(builder).build()
             actions.add(action)
         }
<a href="#h51-4" id="h51-4" class="h">@@ -134,14 +133,12 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>     }
 
     private fun setupBroadcastReceiverHook() {
<a href="#h51-4-3" id="h51-4-3" class="d">-        Hooker.hook(broadcastReceiverClass, &quot;onReceive&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h51-4-4" id="h51-4-4" class="d">-            val androidContext = param.arg&lt;Context&gt;(0)
</a><a href="#h51-4-5" id="h51-4-5" class="d">-            val intent = param.arg&lt;Intent&gt;(1)
</a><a href="#h51-4-6" id="h51-4-6" class="d">-
</a><a href="#h51-4-7" id="h51-4-7" class="d">-            val conversationId = intent.getStringExtra(&quot;conversation_id&quot;) ?: return@hook
</a><a href="#h51-4-8" id="h51-4-8" class="i">+        context.event.subscribe(SnapWidgetBroadcastReceiveEvent::class) { event -&gt;
</a><a href="#h51-4-9" id="h51-4-9" class="i">+            val intent = event.intent ?: return@subscribe
</a><a href="#h51-4-10" id="h51-4-10" class="i">+            val conversationId = intent.getStringExtra(&quot;conversation_id&quot;) ?: return@subscribe
</a>             val messageId = intent.getLongExtra(&quot;message_id&quot;, -1)
             val notificationId = intent.getIntExtra(&quot;notification_id&quot;, -1)
<a href="#h51-4-13" id="h51-4-13" class="d">-            val notificationManager = androidContext.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
</a><a href="#h51-4-14" id="h51-4-14" class="i">+            val notificationManager = event.androidContext.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
</a> 
             val updateNotification: (Int, (Notification) -&gt; Unit) -&gt; Unit = { id, notificationBuilder -&gt;
                 notificationManager.activeNotifications.firstOrNull { it.id == id }?.let {
<a href="#h51-5" id="h51-5" class="h">@@ -152,7 +149,7 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>                 }
             }
 
<a href="#h51-5-3" id="h51-5-3" class="d">-            when (intent.action) {
</a><a href="#h51-5-4" id="h51-5-4" class="i">+            when (event.action) {
</a>                 ACTION_REPLY -&gt; {
                     val input = RemoteInput.getResultsFromIntent(intent).getCharSequence(&quot;chat_reply_input&quot;)
                         .toString()
<a href="#h51-6" id="h51-6" class="h">@@ -177,10 +174,10 @@ class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.IN
</a>                         context.longToast(it)
                     }
                 }
<a href="#h51-6-3" id="h51-6-3" class="d">-                else -&gt; return@hook
</a><a href="#h51-6-4" id="h51-6-4" class="i">+                else -&gt; return@subscribe
</a>             }
 
<a href="#h51-6-7" id="h51-6-7" class="d">-            param.setResult(null)
</a><a href="#h51-6-8" id="h51-6-8" class="i">+            event.canceled = true
</a>         }
     }
 
<b>diff --git a/<a id="h52" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/PinConversations.kt</a></b>
<a href="#h52-0" id="h52-0" class="h">@@ -7,8 +7,8 @@ import me.rhunk.snapenhance.features.FeatureLoadParams
</a> import me.rhunk.snapenhance.hook.HookStage
 import me.rhunk.snapenhance.hook.hook
 import me.rhunk.snapenhance.hook.hookConstructor
<a href="#h52-0-3" id="h52-0-3" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h52-0-4" id="h52-0-4" class="d">-import me.rhunk.snapenhance.util.setObjectField
</a><a href="#h52-0-5" id="h52-0-5" class="i">+import me.rhunk.snapenhance.util.ktx.getObjectField
</a><a href="#h52-0-6" id="h52-0-6" class="i">+import me.rhunk.snapenhance.util.ktx.setObjectField
</a> 
 class PinConversations : BridgeFileFeature(&quot;PinConversations&quot;, BridgeFileType.PINNED_CONVERSATIONS, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
     override fun onActivityCreate() {
<b>diff --git a/<a id="h53" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/manager/impl/MappingManager.kt</a></b>
<a href="#h53-0" id="h53-0" class="h">@@ -1,189 +0,0 @@
</a><a href="#h53-0-0" id="h53-0-0" class="d">-package me.rhunk.snapenhance.manager.impl
</a><a href="#h53-0-1" id="h53-0-1" class="d">-
</a><a href="#h53-0-2" id="h53-0-2" class="d">-import com.google.gson.JsonElement
</a><a href="#h53-0-3" id="h53-0-3" class="d">-import com.google.gson.JsonParser
</a><a href="#h53-0-4" id="h53-0-4" class="d">-import me.rhunk.snapenhance.Constants
</a><a href="#h53-0-5" id="h53-0-5" class="d">-import me.rhunk.snapenhance.Logger
</a><a href="#h53-0-6" id="h53-0-6" class="d">-import me.rhunk.snapenhance.ModContext
</a><a href="#h53-0-7" id="h53-0-7" class="d">-import me.rhunk.snapenhance.bridge.types.BridgeFileType
</a><a href="#h53-0-8" id="h53-0-8" class="d">-import me.rhunk.snapenhance.manager.Manager
</a><a href="#h53-0-9" id="h53-0-9" class="d">-import me.rhunk.snapenhance.ui.ViewAppearanceHelper
</a><a href="#h53-0-10" id="h53-0-10" class="d">-import me.rhunk.snapmapper.Mapper
</a><a href="#h53-0-11" id="h53-0-11" class="d">-import me.rhunk.snapmapper.impl.BCryptClassMapper
</a><a href="#h53-0-12" id="h53-0-12" class="d">-import me.rhunk.snapmapper.impl.CallbackMapper
</a><a href="#h53-0-13" id="h53-0-13" class="d">-import me.rhunk.snapmapper.impl.CompositeConfigurationProviderMapper
</a><a href="#h53-0-14" id="h53-0-14" class="d">-import me.rhunk.snapmapper.impl.DefaultMediaItemMapper
</a><a href="#h53-0-15" id="h53-0-15" class="d">-import me.rhunk.snapmapper.impl.EnumMapper
</a><a href="#h53-0-16" id="h53-0-16" class="d">-import me.rhunk.snapmapper.impl.FriendsFeedEventDispatcherMapper
</a><a href="#h53-0-17" id="h53-0-17" class="d">-import me.rhunk.snapmapper.impl.MediaQualityLevelProviderMapper
</a><a href="#h53-0-18" id="h53-0-18" class="d">-import me.rhunk.snapmapper.impl.OperaPageViewControllerMapper
</a><a href="#h53-0-19" id="h53-0-19" class="d">-import me.rhunk.snapmapper.impl.PlatformAnalyticsCreatorMapper
</a><a href="#h53-0-20" id="h53-0-20" class="d">-import me.rhunk.snapmapper.impl.PlusSubscriptionMapper
</a><a href="#h53-0-21" id="h53-0-21" class="d">-import me.rhunk.snapmapper.impl.ScCameraSettingsMapper
</a><a href="#h53-0-22" id="h53-0-22" class="d">-import me.rhunk.snapmapper.impl.ScoreUpdateMapper
</a><a href="#h53-0-23" id="h53-0-23" class="d">-import me.rhunk.snapmapper.impl.StoryBoostStateMapper
</a><a href="#h53-0-24" id="h53-0-24" class="d">-import java.nio.charset.StandardCharsets
</a><a href="#h53-0-25" id="h53-0-25" class="d">-import java.util.concurrent.ConcurrentHashMap
</a><a href="#h53-0-26" id="h53-0-26" class="d">-import kotlin.system.measureTimeMillis
</a><a href="#h53-0-27" id="h53-0-27" class="d">-
</a><a href="#h53-0-28" id="h53-0-28" class="d">-@Suppress(&quot;UNCHECKED_CAST&quot;)
</a><a href="#h53-0-29" id="h53-0-29" class="d">-class MappingManager(private val context: ModContext) : Manager {
</a><a href="#h53-0-30" id="h53-0-30" class="d">-    private val mappers = arrayOf(
</a><a href="#h53-0-31" id="h53-0-31" class="d">-        BCryptClassMapper::class,
</a><a href="#h53-0-32" id="h53-0-32" class="d">-        CallbackMapper::class,
</a><a href="#h53-0-33" id="h53-0-33" class="d">-        DefaultMediaItemMapper::class,
</a><a href="#h53-0-34" id="h53-0-34" class="d">-        MediaQualityLevelProviderMapper::class,
</a><a href="#h53-0-35" id="h53-0-35" class="d">-        EnumMapper::class,
</a><a href="#h53-0-36" id="h53-0-36" class="d">-        OperaPageViewControllerMapper::class,
</a><a href="#h53-0-37" id="h53-0-37" class="d">-        PlatformAnalyticsCreatorMapper::class,
</a><a href="#h53-0-38" id="h53-0-38" class="d">-        PlusSubscriptionMapper::class,
</a><a href="#h53-0-39" id="h53-0-39" class="d">-        ScCameraSettingsMapper::class,
</a><a href="#h53-0-40" id="h53-0-40" class="d">-        StoryBoostStateMapper::class,
</a><a href="#h53-0-41" id="h53-0-41" class="d">-        FriendsFeedEventDispatcherMapper::class,
</a><a href="#h53-0-42" id="h53-0-42" class="d">-        CompositeConfigurationProviderMapper::class,
</a><a href="#h53-0-43" id="h53-0-43" class="d">-        ScoreUpdateMapper::class
</a><a href="#h53-0-44" id="h53-0-44" class="d">-    )
</a><a href="#h53-0-45" id="h53-0-45" class="d">-
</a><a href="#h53-0-46" id="h53-0-46" class="d">-    private val mappings = ConcurrentHashMap&lt;String, Any&gt;()
</a><a href="#h53-0-47" id="h53-0-47" class="d">-    val areMappingsLoaded: Boolean
</a><a href="#h53-0-48" id="h53-0-48" class="d">-        get() = mappings.isNotEmpty()
</a><a href="#h53-0-49" id="h53-0-49" class="d">-    private var snapBuildNumber = 0
</a><a href="#h53-0-50" id="h53-0-50" class="d">-
</a><a href="#h53-0-51" id="h53-0-51" class="d">-    @Suppress(&quot;deprecation&quot;)
</a><a href="#h53-0-52" id="h53-0-52" class="d">-    override fun init() {
</a><a href="#h53-0-53" id="h53-0-53" class="d">-        val currentBuildNumber = context.androidContext.packageManager.getPackageInfo(
</a><a href="#h53-0-54" id="h53-0-54" class="d">-            Constants.SNAPCHAT_PACKAGE_NAME,
</a><a href="#h53-0-55" id="h53-0-55" class="d">-            0
</a><a href="#h53-0-56" id="h53-0-56" class="d">-        ).longVersionCode.toInt()
</a><a href="#h53-0-57" id="h53-0-57" class="d">-        snapBuildNumber = currentBuildNumber
</a><a href="#h53-0-58" id="h53-0-58" class="d">-
</a><a href="#h53-0-59" id="h53-0-59" class="d">-        if (context.bridgeClient.isFileExists(BridgeFileType.MAPPINGS)) {
</a><a href="#h53-0-60" id="h53-0-60" class="d">-            runCatching {
</a><a href="#h53-0-61" id="h53-0-61" class="d">-                loadCached()
</a><a href="#h53-0-62" id="h53-0-62" class="d">-            }.onFailure {
</a><a href="#h53-0-63" id="h53-0-63" class="d">-                context.crash(&quot;Failed to load cached mappings ${it.message}&quot;, it)
</a><a href="#h53-0-64" id="h53-0-64" class="d">-            }
</a><a href="#h53-0-65" id="h53-0-65" class="d">-
</a><a href="#h53-0-66" id="h53-0-66" class="d">-            if (snapBuildNumber != currentBuildNumber) {
</a><a href="#h53-0-67" id="h53-0-67" class="d">-                context.bridgeClient.deleteFile(BridgeFileType.MAPPINGS)
</a><a href="#h53-0-68" id="h53-0-68" class="d">-                context.softRestartApp()
</a><a href="#h53-0-69" id="h53-0-69" class="d">-            }
</a><a href="#h53-0-70" id="h53-0-70" class="d">-            return
</a><a href="#h53-0-71" id="h53-0-71" class="d">-        }
</a><a href="#h53-0-72" id="h53-0-72" class="d">-        context.runOnUiThread {
</a><a href="#h53-0-73" id="h53-0-73" class="d">-            val statusDialogBuilder = ViewAppearanceHelper.newAlertDialogBuilder(context.mainActivity)
</a><a href="#h53-0-74" id="h53-0-74" class="d">-                .setMessage(&quot;Generating mappings, please wait...&quot;)
</a><a href="#h53-0-75" id="h53-0-75" class="d">-                .setCancelable(false)
</a><a href="#h53-0-76" id="h53-0-76" class="d">-                .setView(android.widget.ProgressBar(context.mainActivity).apply {
</a><a href="#h53-0-77" id="h53-0-77" class="d">-                    setPadding(0, 20, 0, 20)
</a><a href="#h53-0-78" id="h53-0-78" class="d">-                })
</a><a href="#h53-0-79" id="h53-0-79" class="d">-
</a><a href="#h53-0-80" id="h53-0-80" class="d">-            val loadingDialog = statusDialogBuilder.show()
</a><a href="#h53-0-81" id="h53-0-81" class="d">-
</a><a href="#h53-0-82" id="h53-0-82" class="d">-            context.executeAsync {
</a><a href="#h53-0-83" id="h53-0-83" class="d">-                runCatching {
</a><a href="#h53-0-84" id="h53-0-84" class="d">-                    refresh()
</a><a href="#h53-0-85" id="h53-0-85" class="d">-                }.onSuccess {
</a><a href="#h53-0-86" id="h53-0-86" class="d">-                    context.shortToast(&quot;Generated mappings for build $snapBuildNumber&quot;)
</a><a href="#h53-0-87" id="h53-0-87" class="d">-                    context.softRestartApp()
</a><a href="#h53-0-88" id="h53-0-88" class="d">-                }.onFailure {
</a><a href="#h53-0-89" id="h53-0-89" class="d">-                    Logger.error(&quot;Failed to generate mappings&quot;, it)
</a><a href="#h53-0-90" id="h53-0-90" class="d">-                    context.runOnUiThread {
</a><a href="#h53-0-91" id="h53-0-91" class="d">-                        loadingDialog.dismiss()
</a><a href="#h53-0-92" id="h53-0-92" class="d">-                        statusDialogBuilder.setView(null)
</a><a href="#h53-0-93" id="h53-0-93" class="d">-                        statusDialogBuilder.setMessage(&quot;Failed to generate mappings: $it&quot;)
</a><a href="#h53-0-94" id="h53-0-94" class="d">-                        statusDialogBuilder.setNegativeButton(&quot;Close&quot;) { _, _ -&gt;
</a><a href="#h53-0-95" id="h53-0-95" class="d">-                            context.mainActivity!!.finish()
</a><a href="#h53-0-96" id="h53-0-96" class="d">-                        }
</a><a href="#h53-0-97" id="h53-0-97" class="d">-                        statusDialogBuilder.show()
</a><a href="#h53-0-98" id="h53-0-98" class="d">-                    }
</a><a href="#h53-0-99" id="h53-0-99" class="d">-                }
</a><a href="#h53-0-100" id="h53-0-100" class="d">-            }
</a><a href="#h53-0-101" id="h53-0-101" class="d">-        }
</a><a href="#h53-0-102" id="h53-0-102" class="d">-    }
</a><a href="#h53-0-103" id="h53-0-103" class="d">-
</a><a href="#h53-0-104" id="h53-0-104" class="d">-    private fun loadCached() {
</a><a href="#h53-0-105" id="h53-0-105" class="d">-        if (!context.bridgeClient.isFileExists(BridgeFileType.MAPPINGS)) {
</a><a href="#h53-0-106" id="h53-0-106" class="d">-            Logger.xposedLog(&quot;Mappings file does not exist&quot;)
</a><a href="#h53-0-107" id="h53-0-107" class="d">-            return
</a><a href="#h53-0-108" id="h53-0-108" class="d">-        }
</a><a href="#h53-0-109" id="h53-0-109" class="d">-        val mappingsObject = JsonParser.parseString(
</a><a href="#h53-0-110" id="h53-0-110" class="d">-            String(
</a><a href="#h53-0-111" id="h53-0-111" class="d">-                context.bridgeClient.readFile(BridgeFileType.MAPPINGS),
</a><a href="#h53-0-112" id="h53-0-112" class="d">-                StandardCharsets.UTF_8
</a><a href="#h53-0-113" id="h53-0-113" class="d">-            )
</a><a href="#h53-0-114" id="h53-0-114" class="d">-        ).asJsonObject.also {
</a><a href="#h53-0-115" id="h53-0-115" class="d">-            snapBuildNumber = it[&quot;snap_build_number&quot;].asInt
</a><a href="#h53-0-116" id="h53-0-116" class="d">-        }
</a><a href="#h53-0-117" id="h53-0-117" class="d">-
</a><a href="#h53-0-118" id="h53-0-118" class="d">-        mappingsObject.entrySet().forEach { (key, value): Map.Entry&lt;String, JsonElement&gt; -&gt;
</a><a href="#h53-0-119" id="h53-0-119" class="d">-            if (value.isJsonArray) {
</a><a href="#h53-0-120" id="h53-0-120" class="d">-                mappings[key] = context.gson.fromJson(value, ArrayList::class.java)
</a><a href="#h53-0-121" id="h53-0-121" class="d">-                return@forEach
</a><a href="#h53-0-122" id="h53-0-122" class="d">-            }
</a><a href="#h53-0-123" id="h53-0-123" class="d">-            if (value.isJsonObject) {
</a><a href="#h53-0-124" id="h53-0-124" class="d">-                mappings[key] = context.gson.fromJson(value, ConcurrentHashMap::class.java)
</a><a href="#h53-0-125" id="h53-0-125" class="d">-                return@forEach
</a><a href="#h53-0-126" id="h53-0-126" class="d">-            }
</a><a href="#h53-0-127" id="h53-0-127" class="d">-            mappings[key] = value.asString
</a><a href="#h53-0-128" id="h53-0-128" class="d">-        }
</a><a href="#h53-0-129" id="h53-0-129" class="d">-    }
</a><a href="#h53-0-130" id="h53-0-130" class="d">-
</a><a href="#h53-0-131" id="h53-0-131" class="d">-    @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h53-0-132" id="h53-0-132" class="d">-    private fun refresh() {
</a><a href="#h53-0-133" id="h53-0-133" class="d">-        val mapper = Mapper(*mappers)
</a><a href="#h53-0-134" id="h53-0-134" class="d">-
</a><a href="#h53-0-135" id="h53-0-135" class="d">-        runCatching {
</a><a href="#h53-0-136" id="h53-0-136" class="d">-            mapper.loadApk(context.androidContext.packageManager.getApplicationInfo(
</a><a href="#h53-0-137" id="h53-0-137" class="d">-                Constants.SNAPCHAT_PACKAGE_NAME,
</a><a href="#h53-0-138" id="h53-0-138" class="d">-                0
</a><a href="#h53-0-139" id="h53-0-139" class="d">-            ).sourceDir)
</a><a href="#h53-0-140" id="h53-0-140" class="d">-        }.onFailure {
</a><a href="#h53-0-141" id="h53-0-141" class="d">-            throw Exception(&quot;Failed to load APK&quot;, it)
</a><a href="#h53-0-142" id="h53-0-142" class="d">-        }
</a><a href="#h53-0-143" id="h53-0-143" class="d">-
</a><a href="#h53-0-144" id="h53-0-144" class="d">-        measureTimeMillis {
</a><a href="#h53-0-145" id="h53-0-145" class="d">-            val result = mapper.start().apply {
</a><a href="#h53-0-146" id="h53-0-146" class="d">-                addProperty(&quot;snap_build_number&quot;, snapBuildNumber)
</a><a href="#h53-0-147" id="h53-0-147" class="d">-            }
</a><a href="#h53-0-148" id="h53-0-148" class="d">-            context.bridgeClient.writeFile(BridgeFileType.MAPPINGS, result.toString().toByteArray())
</a><a href="#h53-0-149" id="h53-0-149" class="d">-        }.also {
</a><a href="#h53-0-150" id="h53-0-150" class="d">-            Logger.xposedLog(&quot;Generated mappings in $it ms&quot;)
</a><a href="#h53-0-151" id="h53-0-151" class="d">-        }
</a><a href="#h53-0-152" id="h53-0-152" class="d">-    }
</a><a href="#h53-0-153" id="h53-0-153" class="d">-
</a><a href="#h53-0-154" id="h53-0-154" class="d">-    fun getMappedObject(key: String): Any {
</a><a href="#h53-0-155" id="h53-0-155" class="d">-        if (mappings.containsKey(key)) {
</a><a href="#h53-0-156" id="h53-0-156" class="d">-            return mappings[key]!!
</a><a href="#h53-0-157" id="h53-0-157" class="d">-        }
</a><a href="#h53-0-158" id="h53-0-158" class="d">-        throw Exception(&quot;No mapping found for $key&quot;)
</a><a href="#h53-0-159" id="h53-0-159" class="d">-    }
</a><a href="#h53-0-160" id="h53-0-160" class="d">-
</a><a href="#h53-0-161" id="h53-0-161" class="d">-    fun getMappedObjectNullable(key: String): Any? {
</a><a href="#h53-0-162" id="h53-0-162" class="d">-        return mappings[key]
</a><a href="#h53-0-163" id="h53-0-163" class="d">-    }
</a><a href="#h53-0-164" id="h53-0-164" class="d">-
</a><a href="#h53-0-165" id="h53-0-165" class="d">-    fun getMappedClass(className: String): Class&lt;*&gt; {
</a><a href="#h53-0-166" id="h53-0-166" class="d">-        return context.androidContext.classLoader.loadClass(getMappedObject(className) as String)
</a><a href="#h53-0-167" id="h53-0-167" class="d">-    }
</a><a href="#h53-0-168" id="h53-0-168" class="d">-
</a><a href="#h53-0-169" id="h53-0-169" class="d">-    fun getMappedClass(key: String, subKey: String): Class&lt;*&gt; {
</a><a href="#h53-0-170" id="h53-0-170" class="d">-        return context.androidContext.classLoader.loadClass(getMappedValue(key, subKey))
</a><a href="#h53-0-171" id="h53-0-171" class="d">-    }
</a><a href="#h53-0-172" id="h53-0-172" class="d">-
</a><a href="#h53-0-173" id="h53-0-173" class="d">-    fun getMappedValue(key: String): String {
</a><a href="#h53-0-174" id="h53-0-174" class="d">-        return getMappedObject(key) as String
</a><a href="#h53-0-175" id="h53-0-175" class="d">-    }
</a><a href="#h53-0-176" id="h53-0-176" class="d">-
</a><a href="#h53-0-177" id="h53-0-177" class="d">-    fun &lt;T : Any&gt; getMappedList(key: String): List&lt;T&gt; {
</a><a href="#h53-0-178" id="h53-0-178" class="d">-        return listOf(getMappedObject(key) as List&lt;T&gt;).flatten()
</a><a href="#h53-0-179" id="h53-0-179" class="d">-    }
</a><a href="#h53-0-180" id="h53-0-180" class="d">-
</a><a href="#h53-0-181" id="h53-0-181" class="d">-    fun getMappedValue(key: String, subKey: String): String {
</a><a href="#h53-0-182" id="h53-0-182" class="d">-        return getMappedMap(key)[subKey] as String
</a><a href="#h53-0-183" id="h53-0-183" class="d">-    }
</a><a href="#h53-0-184" id="h53-0-184" class="d">-
</a><a href="#h53-0-185" id="h53-0-185" class="d">-    fun getMappedMap(key: String): Map&lt;String, *&gt; {
</a><a href="#h53-0-186" id="h53-0-186" class="d">-        return getMappedObject(key) as Map&lt;String, *&gt;
</a><a href="#h53-0-187" id="h53-0-187" class="d">-    }
</a><a href="#h53-0-188" id="h53-0-188" class="d">-}</a><a href="#h53-0-189" id="h53-0-189" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h54" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/ui/menu/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h54-0" id="h54-0" class="h">@@ -204,7 +204,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a> 
         //mapped conversation fetch (may not work with legacy sc versions)
         messaging.lastFetchGroupConversationUUID?.let {
<a href="#h54-0-3" id="h54-0-3" class="d">-            context.database.getFriendFeedInfoByConversationId(it.toString())?.let { friendFeedInfo -&gt;
</a><a href="#h54-0-4" id="h54-0-4" class="i">+            context.database.getFeedEntryByConversationId(it.toString())?.let { friendFeedInfo -&gt;
</a>                 val participantSize = friendFeedInfo.participantsSize
                 return it.toString() to if (participantSize == 1) focusedConversationTargetUser else null
             }
<a href="#h54-1" id="h54-1" class="h">@@ -280,7 +280,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>             }
 
             run {
<a href="#h54-1-3" id="h54-1-3" class="d">-                val userId = context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId ?: return@run
</a><a href="#h54-1-4" id="h54-1-4" class="i">+                val userId = context.database.getFeedEntryByConversationId(conversationId)?.friendUserId ?: return@run
</a>                 if (friendFeedMenuOptions.contains(&quot;auto_download_blacklist&quot;)) {
                     createToggleFeature(viewConsumer,
                         &quot;friend_menu_option.auto_download_blacklist&quot;,
<a href="#h54-2" id="h54-2" class="h">@@ -340,7 +340,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a>         if (friendFeedMenuOptions.contains(&quot;auto_download_blacklist&quot;)) {
             run {
                 val userId =
<a href="#h54-2-3" id="h54-2-3" class="d">-                    context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId
</a><a href="#h54-2-4" id="h54-2-4" class="i">+                    context.database.getFeedEntryByConversationId(conversationId)?.friendUserId
</a>                         ?: return@run
                 createActionButton(
                     &quot;\u2B07\uFE0F&quot;,
<b>diff --git a/<a id="h55" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ActivityResultCallback.kt</a></b>
<a href="#h55-0" id="h55-0" class="h">@@ -1,5 +0,0 @@
</a><a href="#h55-0-0" id="h55-0-0" class="d">-package me.rhunk.snapenhance.util
</a><a href="#h55-0-1" id="h55-0-1" class="d">-
</a><a href="#h55-0-2" id="h55-0-2" class="d">-import android.content.Intent
</a><a href="#h55-0-3" id="h55-0-3" class="d">-
</a><a href="#h55-0-4" id="h55-0-4" class="d">-typealias ActivityResultCallback = (requestCode: Int, resultCode: Int, data: Intent?) -&gt; Unit</a><a href="#h55-0-5" id="h55-0-5" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h56" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/AndroidCompatExtensions.kt</a></b>
<a href="#h56-0" id="h56-0" class="h">@@ -1,13 +0,0 @@
</a><a href="#h56-0-0" id="h56-0-0" class="d">-package me.rhunk.snapenhance.util
</a><a href="#h56-0-1" id="h56-0-1" class="d">-
</a><a href="#h56-0-2" id="h56-0-2" class="d">-import android.content.pm.PackageManager
</a><a href="#h56-0-3" id="h56-0-3" class="d">-import android.content.pm.PackageManager.ApplicationInfoFlags
</a><a href="#h56-0-4" id="h56-0-4" class="d">-import android.os.Build
</a><a href="#h56-0-5" id="h56-0-5" class="d">-
</a><a href="#h56-0-6" id="h56-0-6" class="d">-fun PackageManager.getApplicationInfoCompat(packageName: String, flags: Int) =
</a><a href="#h56-0-7" id="h56-0-7" class="d">-    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {
</a><a href="#h56-0-8" id="h56-0-8" class="d">-        getApplicationInfo(packageName, ApplicationInfoFlags.of(flags.toLong()))
</a><a href="#h56-0-9" id="h56-0-9" class="d">-    } else {
</a><a href="#h56-0-10" id="h56-0-10" class="d">-        @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h56-0-11" id="h56-0-11" class="d">-        getApplicationInfo(packageName, flags)
</a><a href="#h56-0-12" id="h56-0-12" class="d">-    }
</a><b>diff --git a/<a id="h57" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/DbCursorExt.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/DbCursorExt.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/DbCursorExt.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/DbCursorExt.kt</a></b>
<a href="#h57-0" id="h57-0" class="h">@@ -1,37 +0,0 @@
</a><a href="#h57-0-0" id="h57-0-0" class="d">-package me.rhunk.snapenhance.util
</a><a href="#h57-0-1" id="h57-0-1" class="d">-
</a><a href="#h57-0-2" id="h57-0-2" class="d">-import android.database.Cursor
</a><a href="#h57-0-3" id="h57-0-3" class="d">-
</a><a href="#h57-0-4" id="h57-0-4" class="d">-fun Cursor.getStringOrNull(columnName: String): String? {
</a><a href="#h57-0-5" id="h57-0-5" class="d">-    val columnIndex = getColumnIndex(columnName)
</a><a href="#h57-0-6" id="h57-0-6" class="d">-    return if (columnIndex == -1) null else getString(columnIndex)
</a><a href="#h57-0-7" id="h57-0-7" class="d">-}
</a><a href="#h57-0-8" id="h57-0-8" class="d">-
</a><a href="#h57-0-9" id="h57-0-9" class="d">-fun Cursor.getIntOrNull(columnName: String): Int? {
</a><a href="#h57-0-10" id="h57-0-10" class="d">-    val columnIndex = getColumnIndex(columnName)
</a><a href="#h57-0-11" id="h57-0-11" class="d">-    return if (columnIndex == -1) null else getInt(columnIndex)
</a><a href="#h57-0-12" id="h57-0-12" class="d">-}
</a><a href="#h57-0-13" id="h57-0-13" class="d">-
</a><a href="#h57-0-14" id="h57-0-14" class="d">-fun Cursor.getInteger(columnName: String) = getIntOrNull(columnName) ?: throw NullPointerException(&quot;Column $columnName is null&quot;)
</a><a href="#h57-0-15" id="h57-0-15" class="d">-fun Cursor.getLong(columnName: String) = getLongOrNull(columnName) ?: throw NullPointerException(&quot;Column $columnName is null&quot;)
</a><a href="#h57-0-16" id="h57-0-16" class="d">-
</a><a href="#h57-0-17" id="h57-0-17" class="d">-fun Cursor.getBlobOrNull(columnName: String): ByteArray? {
</a><a href="#h57-0-18" id="h57-0-18" class="d">-    val columnIndex = getColumnIndex(columnName)
</a><a href="#h57-0-19" id="h57-0-19" class="d">-    return if (columnIndex == -1) null else getBlob(columnIndex)
</a><a href="#h57-0-20" id="h57-0-20" class="d">-}
</a><a href="#h57-0-21" id="h57-0-21" class="d">-
</a><a href="#h57-0-22" id="h57-0-22" class="d">-
</a><a href="#h57-0-23" id="h57-0-23" class="d">-fun Cursor.getLongOrNull(columnName: String): Long? {
</a><a href="#h57-0-24" id="h57-0-24" class="d">-    val columnIndex = getColumnIndex(columnName)
</a><a href="#h57-0-25" id="h57-0-25" class="d">-    return if (columnIndex == -1) null else getLong(columnIndex)
</a><a href="#h57-0-26" id="h57-0-26" class="d">-}
</a><a href="#h57-0-27" id="h57-0-27" class="d">-
</a><a href="#h57-0-28" id="h57-0-28" class="d">-fun Cursor.getDoubleOrNull(columnName: String): Double? {
</a><a href="#h57-0-29" id="h57-0-29" class="d">-    val columnIndex = getColumnIndex(columnName)
</a><a href="#h57-0-30" id="h57-0-30" class="d">-    return if (columnIndex == -1) null else getDouble(columnIndex)
</a><a href="#h57-0-31" id="h57-0-31" class="d">-}
</a><a href="#h57-0-32" id="h57-0-32" class="d">-
</a><a href="#h57-0-33" id="h57-0-33" class="d">-fun Cursor.getFloatOrNull(columnName: String): Float? {
</a><a href="#h57-0-34" id="h57-0-34" class="d">-    val columnIndex = getColumnIndex(columnName)
</a><a href="#h57-0-35" id="h57-0-35" class="d">-    return if (columnIndex == -1) null else getFloat(columnIndex)
</a><a href="#h57-0-36" id="h57-0-36" class="d">-}</a><a href="#h57-0-37" id="h57-0-37" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h58" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/SerializableDataObject.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/SerializableDataObject.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/SerializableDataObject.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/SerializableDataObject.kt</a></b>
<a href="#h58-0" id="h58-0" class="h">@@ -0,0 +1,22 @@
</a><a href="#h58-0-0" id="h58-0-0" class="i">+package me.rhunk.snapenhance.util
</a><a href="#h58-0-1" id="h58-0-1" class="i">+
</a><a href="#h58-0-2" id="h58-0-2" class="i">+import com.google.gson.Gson
</a><a href="#h58-0-3" id="h58-0-3" class="i">+import com.google.gson.GsonBuilder
</a><a href="#h58-0-4" id="h58-0-4" class="i">+
</a><a href="#h58-0-5" id="h58-0-5" class="i">+open class SerializableDataObject {
</a><a href="#h58-0-6" id="h58-0-6" class="i">+    companion object {
</a><a href="#h58-0-7" id="h58-0-7" class="i">+        val gson: Gson = GsonBuilder().create()
</a><a href="#h58-0-8" id="h58-0-8" class="i">+
</a><a href="#h58-0-9" id="h58-0-9" class="i">+        inline fun &lt;reified T : SerializableDataObject&gt; fromJson(json: String): T {
</a><a href="#h58-0-10" id="h58-0-10" class="i">+            return gson.fromJson(json, T::class.java)
</a><a href="#h58-0-11" id="h58-0-11" class="i">+        }
</a><a href="#h58-0-12" id="h58-0-12" class="i">+
</a><a href="#h58-0-13" id="h58-0-13" class="i">+        inline fun &lt;reified T : SerializableDataObject&gt; fromJson(json: String, type: Class&lt;T&gt;): T {
</a><a href="#h58-0-14" id="h58-0-14" class="i">+            return gson.fromJson(json, type)
</a><a href="#h58-0-15" id="h58-0-15" class="i">+        }
</a><a href="#h58-0-16" id="h58-0-16" class="i">+    }
</a><a href="#h58-0-17" id="h58-0-17" class="i">+
</a><a href="#h58-0-18" id="h58-0-18" class="i">+    fun toJson(): String {
</a><a href="#h58-0-19" id="h58-0-19" class="i">+        return gson.toJson(this)
</a><a href="#h58-0-20" id="h58-0-20" class="i">+    }
</a><a href="#h58-0-21" id="h58-0-21" class="i">+}</a><a href="#h58-0-22" id="h58-0-22" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h59" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperExt.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperExt.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperExt.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/XposedHelperExt.kt</a></b>
<a href="#h59-0" id="h59-0" class="h">@@ -1,20 +0,0 @@
</a><a href="#h59-0-0" id="h59-0-0" class="d">-package me.rhunk.snapenhance.util
</a><a href="#h59-0-1" id="h59-0-1" class="d">-
</a><a href="#h59-0-2" id="h59-0-2" class="d">-import de.robv.android.xposed.XposedHelpers
</a><a href="#h59-0-3" id="h59-0-3" class="d">-
</a><a href="#h59-0-4" id="h59-0-4" class="d">-fun Any.getObjectField(fieldName: String): Any? {
</a><a href="#h59-0-5" id="h59-0-5" class="d">-    return XposedHelpers.getObjectField(this, fieldName)
</a><a href="#h59-0-6" id="h59-0-6" class="d">-}
</a><a href="#h59-0-7" id="h59-0-7" class="d">-
</a><a href="#h59-0-8" id="h59-0-8" class="d">-fun Any.setObjectField(fieldName: String, value: Any?) {
</a><a href="#h59-0-9" id="h59-0-9" class="d">-    XposedHelpers.setObjectField(this, fieldName, value)
</a><a href="#h59-0-10" id="h59-0-10" class="d">-}
</a><a href="#h59-0-11" id="h59-0-11" class="d">-
</a><a href="#h59-0-12" id="h59-0-12" class="d">-fun Any.getObjectFieldOrNull(fieldName: String): Any? {
</a><a href="#h59-0-13" id="h59-0-13" class="d">-    return try {
</a><a href="#h59-0-14" id="h59-0-14" class="d">-        getObjectField(fieldName)
</a><a href="#h59-0-15" id="h59-0-15" class="d">-    } catch (e: Exception) {
</a><a href="#h59-0-16" id="h59-0-16" class="d">-        null
</a><a href="#h59-0-17" id="h59-0-17" class="d">-    }
</a><a href="#h59-0-18" id="h59-0-18" class="d">-}
</a><a href="#h59-0-19" id="h59-0-19" class="d">-
</a><b>diff --git a/<a id="h60" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/export/MessageExporter.kt</a></b>
<a href="#h60-0" id="h60-0" class="h">@@ -18,9 +18,9 @@ import me.rhunk.snapenhance.data.FileType
</a> import me.rhunk.snapenhance.data.MediaReferenceType
 import me.rhunk.snapenhance.data.wrapper.impl.Message
 import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
<a href="#h60-0-3" id="h60-0-3" class="d">-import me.rhunk.snapenhance.database.objects.FriendFeedInfo
</a><a href="#h60-0-4" id="h60-0-4" class="i">+import me.rhunk.snapenhance.database.objects.FriendFeedEntry
</a> import me.rhunk.snapenhance.database.objects.FriendInfo
<a href="#h60-0-6" id="h60-0-6" class="d">-import me.rhunk.snapenhance.util.getApplicationInfoCompat
</a><a href="#h60-0-7" id="h60-0-7" class="i">+import me.rhunk.snapenhance.util.ktx.getApplicationInfoCompat
</a> import me.rhunk.snapenhance.util.protobuf.ProtoReader
 import me.rhunk.snapenhance.util.snap.EncryptionHelper
 import me.rhunk.snapenhance.util.snap.MediaDownloaderHelper
<a href="#h60-1" id="h60-1" class="h">@@ -50,7 +50,7 @@ enum class ExportFormat(
</a> class MessageExporter(
     private val context: ModContext,
     private val outputFile: File,
<a href="#h60-1-3" id="h60-1-3" class="d">-    private val friendFeedInfo: FriendFeedInfo,
</a><a href="#h60-1-4" id="h60-1-4" class="i">+    private val friendFeedEntry: FriendFeedEntry,
</a>     private val mediaToDownload: List&lt;ContentType&gt;? = null,
     private val printLog: (String) -&gt; Unit = {},
 ) {
<a href="#h60-2" id="h60-2" class="h">@@ -59,13 +59,13 @@ class MessageExporter(
</a> 
     fun readMessages(messages: List&lt;Message&gt;) {
         conversationParticipants =
<a href="#h60-2-3" id="h60-2-3" class="d">-            context.database.getConversationParticipants(friendFeedInfo.key!!)
</a><a href="#h60-2-4" id="h60-2-4" class="i">+            context.database.getConversationParticipants(friendFeedEntry.key!!)
</a>                 ?.mapNotNull {
                     context.database.getFriendInfo(it)
                 }?.associateBy { it.userId!! } ?: emptyMap()
 
         if (conversationParticipants.isEmpty())
<a href="#h60-2-10" id="h60-2-10" class="d">-            throw Throwable(&quot;Failed to get conversation participants for ${friendFeedInfo.key}&quot;)
</a><a href="#h60-2-11" id="h60-2-11" class="i">+            throw Throwable(&quot;Failed to get conversation participants for ${friendFeedEntry.key}&quot;)
</a> 
         this.messages = messages.sortedBy { it.orderKey }
     }
<a href="#h60-3" id="h60-3" class="h">@@ -78,8 +78,8 @@ class MessageExporter(
</a> 
     private fun exportText(output: OutputStream) {
         val writer = output.bufferedWriter()
<a href="#h60-3-3" id="h60-3-3" class="d">-        writer.write(&quot;Conversation key: ${friendFeedInfo.key}\n&quot;)
</a><a href="#h60-3-4" id="h60-3-4" class="d">-        writer.write(&quot;Conversation Name: ${friendFeedInfo.feedDisplayName}\n&quot;)
</a><a href="#h60-3-5" id="h60-3-5" class="i">+        writer.write(&quot;Conversation key: ${friendFeedEntry.key}\n&quot;)
</a><a href="#h60-3-6" id="h60-3-6" class="i">+        writer.write(&quot;Conversation Name: ${friendFeedEntry.feedDisplayName}\n&quot;)
</a>         writer.write(&quot;Participants:\n&quot;)
         conversationParticipants.forEach { (userId, friendInfo) -&gt;
             writer.write(&quot;  $userId: ${friendInfo.displayName}\n&quot;)
<a href="#h60-4" id="h60-4" class="h">@@ -233,8 +233,8 @@ class MessageExporter(
</a> 
     private fun exportJson(output: OutputStream) {
         val rootObject = JsonObject().apply {
<a href="#h60-4-3" id="h60-4-3" class="d">-            addProperty(&quot;conversationId&quot;, friendFeedInfo.key)
</a><a href="#h60-4-4" id="h60-4-4" class="d">-            addProperty(&quot;conversationName&quot;, friendFeedInfo.feedDisplayName)
</a><a href="#h60-4-5" id="h60-4-5" class="i">+            addProperty(&quot;conversationId&quot;, friendFeedEntry.key)
</a><a href="#h60-4-6" id="h60-4-6" class="i">+            addProperty(&quot;conversationName&quot;, friendFeedEntry.feedDisplayName)
</a> 
             var index = 0
             val participants = mutableMapOf&lt;String, Int&gt;()
<b>diff --git a/<a id="h61" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/AndroidCompatExtensions.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/AndroidCompatExtensions.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/AndroidCompatExtensions.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/AndroidCompatExtensions.kt</a></b>
<a href="#h61-0" id="h61-0" class="h">@@ -0,0 +1,13 @@
</a><a href="#h61-0-0" id="h61-0-0" class="i">+package me.rhunk.snapenhance.util.ktx
</a><a href="#h61-0-1" id="h61-0-1" class="i">+
</a><a href="#h61-0-2" id="h61-0-2" class="i">+import android.content.pm.PackageManager
</a><a href="#h61-0-3" id="h61-0-3" class="i">+import android.content.pm.PackageManager.ApplicationInfoFlags
</a><a href="#h61-0-4" id="h61-0-4" class="i">+import android.os.Build
</a><a href="#h61-0-5" id="h61-0-5" class="i">+
</a><a href="#h61-0-6" id="h61-0-6" class="i">+fun PackageManager.getApplicationInfoCompat(packageName: String, flags: Int) =
</a><a href="#h61-0-7" id="h61-0-7" class="i">+    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.TIRAMISU) {
</a><a href="#h61-0-8" id="h61-0-8" class="i">+        getApplicationInfo(packageName, ApplicationInfoFlags.of(flags.toLong()))
</a><a href="#h61-0-9" id="h61-0-9" class="i">+    } else {
</a><a href="#h61-0-10" id="h61-0-10" class="i">+        @Suppress(&quot;DEPRECATION&quot;)
</a><a href="#h61-0-11" id="h61-0-11" class="i">+        getApplicationInfo(packageName, flags)
</a><a href="#h61-0-12" id="h61-0-12" class="i">+    }
</a><b>diff --git a/<a id="h62" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/DbCursorExt.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/DbCursorExt.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/DbCursorExt.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/DbCursorExt.kt</a></b>
<a href="#h62-0" id="h62-0" class="h">@@ -0,0 +1,37 @@
</a><a href="#h62-0-0" id="h62-0-0" class="i">+package me.rhunk.snapenhance.util.ktx
</a><a href="#h62-0-1" id="h62-0-1" class="i">+
</a><a href="#h62-0-2" id="h62-0-2" class="i">+import android.database.Cursor
</a><a href="#h62-0-3" id="h62-0-3" class="i">+
</a><a href="#h62-0-4" id="h62-0-4" class="i">+fun Cursor.getStringOrNull(columnName: String): String? {
</a><a href="#h62-0-5" id="h62-0-5" class="i">+    val columnIndex = getColumnIndex(columnName)
</a><a href="#h62-0-6" id="h62-0-6" class="i">+    return if (columnIndex == -1) null else getString(columnIndex)
</a><a href="#h62-0-7" id="h62-0-7" class="i">+}
</a><a href="#h62-0-8" id="h62-0-8" class="i">+
</a><a href="#h62-0-9" id="h62-0-9" class="i">+fun Cursor.getIntOrNull(columnName: String): Int? {
</a><a href="#h62-0-10" id="h62-0-10" class="i">+    val columnIndex = getColumnIndex(columnName)
</a><a href="#h62-0-11" id="h62-0-11" class="i">+    return if (columnIndex == -1) null else getInt(columnIndex)
</a><a href="#h62-0-12" id="h62-0-12" class="i">+}
</a><a href="#h62-0-13" id="h62-0-13" class="i">+
</a><a href="#h62-0-14" id="h62-0-14" class="i">+fun Cursor.getInteger(columnName: String) = getIntOrNull(columnName) ?: throw NullPointerException(&quot;Column $columnName is null&quot;)
</a><a href="#h62-0-15" id="h62-0-15" class="i">+fun Cursor.getLong(columnName: String) = getLongOrNull(columnName) ?: throw NullPointerException(&quot;Column $columnName is null&quot;)
</a><a href="#h62-0-16" id="h62-0-16" class="i">+
</a><a href="#h62-0-17" id="h62-0-17" class="i">+fun Cursor.getBlobOrNull(columnName: String): ByteArray? {
</a><a href="#h62-0-18" id="h62-0-18" class="i">+    val columnIndex = getColumnIndex(columnName)
</a><a href="#h62-0-19" id="h62-0-19" class="i">+    return if (columnIndex == -1) null else getBlob(columnIndex)
</a><a href="#h62-0-20" id="h62-0-20" class="i">+}
</a><a href="#h62-0-21" id="h62-0-21" class="i">+
</a><a href="#h62-0-22" id="h62-0-22" class="i">+
</a><a href="#h62-0-23" id="h62-0-23" class="i">+fun Cursor.getLongOrNull(columnName: String): Long? {
</a><a href="#h62-0-24" id="h62-0-24" class="i">+    val columnIndex = getColumnIndex(columnName)
</a><a href="#h62-0-25" id="h62-0-25" class="i">+    return if (columnIndex == -1) null else getLong(columnIndex)
</a><a href="#h62-0-26" id="h62-0-26" class="i">+}
</a><a href="#h62-0-27" id="h62-0-27" class="i">+
</a><a href="#h62-0-28" id="h62-0-28" class="i">+fun Cursor.getDoubleOrNull(columnName: String): Double? {
</a><a href="#h62-0-29" id="h62-0-29" class="i">+    val columnIndex = getColumnIndex(columnName)
</a><a href="#h62-0-30" id="h62-0-30" class="i">+    return if (columnIndex == -1) null else getDouble(columnIndex)
</a><a href="#h62-0-31" id="h62-0-31" class="i">+}
</a><a href="#h62-0-32" id="h62-0-32" class="i">+
</a><a href="#h62-0-33" id="h62-0-33" class="i">+fun Cursor.getFloatOrNull(columnName: String): Float? {
</a><a href="#h62-0-34" id="h62-0-34" class="i">+    val columnIndex = getColumnIndex(columnName)
</a><a href="#h62-0-35" id="h62-0-35" class="i">+    return if (columnIndex == -1) null else getFloat(columnIndex)
</a><a href="#h62-0-36" id="h62-0-36" class="i">+}</a><a href="#h62-0-37" id="h62-0-37" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h63" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/XposedHelperExt.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/XposedHelperExt.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/XposedHelperExt.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/ktx/XposedHelperExt.kt</a></b>
<a href="#h63-0" id="h63-0" class="h">@@ -0,0 +1,20 @@
</a><a href="#h63-0-0" id="h63-0-0" class="i">+package me.rhunk.snapenhance.util.ktx
</a><a href="#h63-0-1" id="h63-0-1" class="i">+
</a><a href="#h63-0-2" id="h63-0-2" class="i">+import de.robv.android.xposed.XposedHelpers
</a><a href="#h63-0-3" id="h63-0-3" class="i">+
</a><a href="#h63-0-4" id="h63-0-4" class="i">+fun Any.getObjectField(fieldName: String): Any? {
</a><a href="#h63-0-5" id="h63-0-5" class="i">+    return XposedHelpers.getObjectField(this, fieldName)
</a><a href="#h63-0-6" id="h63-0-6" class="i">+}
</a><a href="#h63-0-7" id="h63-0-7" class="i">+
</a><a href="#h63-0-8" id="h63-0-8" class="i">+fun Any.setObjectField(fieldName: String, value: Any?) {
</a><a href="#h63-0-9" id="h63-0-9" class="i">+    XposedHelpers.setObjectField(this, fieldName, value)
</a><a href="#h63-0-10" id="h63-0-10" class="i">+}
</a><a href="#h63-0-11" id="h63-0-11" class="i">+
</a><a href="#h63-0-12" id="h63-0-12" class="i">+fun Any.getObjectFieldOrNull(fieldName: String): Any? {
</a><a href="#h63-0-13" id="h63-0-13" class="i">+    return try {
</a><a href="#h63-0-14" id="h63-0-14" class="i">+        getObjectField(fieldName)
</a><a href="#h63-0-15" id="h63-0-15" class="i">+    } catch (e: Exception) {
</a><a href="#h63-0-16" id="h63-0-16" class="i">+        null
</a><a href="#h63-0-17" id="h63-0-17" class="i">+    }
</a><a href="#h63-0-18" id="h63-0-18" class="i">+}
</a><a href="#h63-0-19" id="h63-0-19" class="i">+
</a><b>diff --git a/<a id="h64" href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/snap/SnapWidgetBroadcastReceiverHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/SnapWidgetBroadcastReceiverHelper.kt</a> b/<a href="../file/core/src/main/kotlin/me/rhunk/snapenhance/util/snap/SnapWidgetBroadcastReceiverHelper.kt.html">core/src/main/kotlin/me/rhunk/snapenhance/util/snap/SnapWidgetBroadcastReceiverHelper.kt</a></b>
<a href="#h64-0" id="h64-0" class="h">@@ -0,0 +1,24 @@
</a><a href="#h64-0-0" id="h64-0-0" class="i">+package me.rhunk.snapenhance.util.snap
</a><a href="#h64-0-1" id="h64-0-1" class="i">+
</a><a href="#h64-0-2" id="h64-0-2" class="i">+import android.content.Intent
</a><a href="#h64-0-3" id="h64-0-3" class="i">+import me.rhunk.snapenhance.Constants
</a><a href="#h64-0-4" id="h64-0-4" class="i">+
</a><a href="#h64-0-5" id="h64-0-5" class="i">+object SnapWidgetBroadcastReceiverHelper {
</a><a href="#h64-0-6" id="h64-0-6" class="i">+    private const val ACTION_WIDGET_UPDATE = &quot;com.snap.android.WIDGET_APP_START_UPDATE_ACTION&quot;
</a><a href="#h64-0-7" id="h64-0-7" class="i">+    const val CLASS_NAME = &quot;com.snap.widgets.core.BestFriendsWidgetProvider&quot;
</a><a href="#h64-0-8" id="h64-0-8" class="i">+
</a><a href="#h64-0-9" id="h64-0-9" class="i">+    fun create(targetAction: String, callback: Intent.() -&gt; Unit): Intent {
</a><a href="#h64-0-10" id="h64-0-10" class="i">+        with(Intent()) {
</a><a href="#h64-0-11" id="h64-0-11" class="i">+            callback(this)
</a><a href="#h64-0-12" id="h64-0-12" class="i">+            action = ACTION_WIDGET_UPDATE
</a><a href="#h64-0-13" id="h64-0-13" class="i">+            putExtra(&quot;:)&quot;, true)
</a><a href="#h64-0-14" id="h64-0-14" class="i">+            putExtra(&quot;action&quot;, targetAction)
</a><a href="#h64-0-15" id="h64-0-15" class="i">+            setClassName(Constants.SNAPCHAT_PACKAGE_NAME, CLASS_NAME)
</a><a href="#h64-0-16" id="h64-0-16" class="i">+            return this
</a><a href="#h64-0-17" id="h64-0-17" class="i">+        }
</a><a href="#h64-0-18" id="h64-0-18" class="i">+    }
</a><a href="#h64-0-19" id="h64-0-19" class="i">+
</a><a href="#h64-0-20" id="h64-0-20" class="i">+    fun isIncomingIntentValid(intent: Intent): Boolean {
</a><a href="#h64-0-21" id="h64-0-21" class="i">+        return intent.action == ACTION_WIDGET_UPDATE &amp;&amp; intent.getBooleanExtra(&quot;:)&quot;, false)
</a><a href="#h64-0-22" id="h64-0-22" class="i">+    }
</a><a href="#h64-0-23" id="h64-0-23" class="i">+}</a><a href="#h64-0-24" id="h64-0-24" class="i">+
\ No newline at end of file
</a></pre>
</div>
</body>
</html>
