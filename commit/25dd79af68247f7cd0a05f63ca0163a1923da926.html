<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>refactor: root sections - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/25dd79af68247f7cd0a05f63ca0163a1923da926.html">25dd79af68247f7cd0a05f63ca0163a1923da926</a>
<b>parent</b> <a href="../commit/d1283b0ef764c6e044410b20fc68c0e7d4a8717b.html">d1283b0ef764c6e044410b20fc68c0e7d4a8717b</a>
<b>Author:</b> rhunk &lt;<a href="mailto:101876869+rhunk@users.noreply.github.com">101876869+rhunk@users.noreply.github.com</a>&gt;
<b>Date:</b>   Mon,  3 Jun 2024 01:30:12 +0200

refactor: root sections

Signed-off-by: rhunk &lt;101876869+rhunk@users.noreply.github.com&gt;

<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a></td><td> | </td><td class="num">26</td><td><span class="i">+++++++++++</span><span class="d">---------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h1">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRoot.kt</a></td><td> | </td><td class="num">475</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h2">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRootSection.kt</a></td><td> | </td><td class="num">475</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRoot.kt</a></td><td> | </td><td class="num">708</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt</a></td><td> | </td><td class="num">708</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRoot.kt</a></td><td> | </td><td class="num">439</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRootSection.kt</a></td><td> | </td><td class="num">439</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRoot.kt</a></td><td> | </td><td class="num">590</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt</a></td><td> | </td><td class="num">590</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="D">D</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRoot.kt</a></td><td> | </td><td class="num">290</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRootSection.kt</a></td><td> | </td><td class="num">290</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>11 files changed, 2513 insertions(+), 2517 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/Routes.kt</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -2,11 +2,7 @@ package me.rhunk.snapenhance.ui.manager
</a> 
 import androidx.compose.foundation.layout.RowScope
 import androidx.compose.material.icons.Icons
<a href="#h0-0-3" id="h0-0-3" class="d">-import androidx.compose.material.icons.filled.DataObject
</a><a href="#h0-0-4" id="h0-0-4" class="d">-import androidx.compose.material.icons.filled.Group
</a><a href="#h0-0-5" id="h0-0-5" class="d">-import androidx.compose.material.icons.filled.Home
</a><a href="#h0-0-6" id="h0-0-6" class="d">-import androidx.compose.material.icons.filled.Stars
</a><a href="#h0-0-7" id="h0-0-7" class="d">-import androidx.compose.material.icons.filled.TaskAlt
</a><a href="#h0-0-8" id="h0-0-8" class="i">+import androidx.compose.material.icons.filled.*
</a> import androidx.compose.runtime.Composable
 import androidx.compose.ui.graphics.vector.ImageVector
 import androidx.navigation.NavBackStackEntry
<a href="#h0-1" id="h0-1" class="h">@@ -18,16 +14,16 @@ import me.rhunk.snapenhance.RemoteSideContext
</a> import me.rhunk.snapenhance.ui.manager.pages.BetterLocationRoot
 import me.rhunk.snapenhance.ui.manager.pages.FileImportsRoot
 import me.rhunk.snapenhance.ui.manager.pages.LoggerHistoryRoot
<a href="#h0-1-3" id="h0-1-3" class="d">-import me.rhunk.snapenhance.ui.manager.pages.TasksRoot
</a><a href="#h0-1-4" id="h0-1-4" class="d">-import me.rhunk.snapenhance.ui.manager.pages.features.FeaturesRoot
</a><a href="#h0-1-5" id="h0-1-5" class="i">+import me.rhunk.snapenhance.ui.manager.pages.TasksRootSection
</a><a href="#h0-1-6" id="h0-1-6" class="i">+import me.rhunk.snapenhance.ui.manager.pages.features.FeaturesRootSection
</a> import me.rhunk.snapenhance.ui.manager.pages.home.HomeLogs
<a href="#h0-1-8" id="h0-1-8" class="d">-import me.rhunk.snapenhance.ui.manager.pages.home.HomeRoot
</a><a href="#h0-1-9" id="h0-1-9" class="i">+import me.rhunk.snapenhance.ui.manager.pages.home.HomeRootSection
</a> import me.rhunk.snapenhance.ui.manager.pages.home.HomeSettings
<a href="#h0-1-11" id="h0-1-11" class="d">-import me.rhunk.snapenhance.ui.manager.pages.scripting.ScriptingRoot
</a><a href="#h0-1-12" id="h0-1-12" class="i">+import me.rhunk.snapenhance.ui.manager.pages.scripting.ScriptingRootSection
</a> import me.rhunk.snapenhance.ui.manager.pages.social.LoggedStories
 import me.rhunk.snapenhance.ui.manager.pages.social.ManageScope
 import me.rhunk.snapenhance.ui.manager.pages.social.MessagingPreview
<a href="#h0-1-16" id="h0-1-16" class="d">-import me.rhunk.snapenhance.ui.manager.pages.social.SocialRoot
</a><a href="#h0-1-17" id="h0-1-17" class="i">+import me.rhunk.snapenhance.ui.manager.pages.social.SocialRootSection
</a> import me.rhunk.snapenhance.ui.manager.pages.tracker.EditRule
 import me.rhunk.snapenhance.ui.manager.pages.tracker.FriendTrackerManagerRoot
 
<a href="#h0-2" id="h0-2" class="h">@@ -50,11 +46,11 @@ class Routes(
</a>     lateinit var navController: NavController
     private val routes = mutableListOf&lt;Route&gt;()
 
<a href="#h0-2-3" id="h0-2-3" class="d">-    val tasks = route(RouteInfo(&quot;tasks&quot;, icon = Icons.Default.TaskAlt, primary = true), TasksRoot())
</a><a href="#h0-2-4" id="h0-2-4" class="i">+    val tasks = route(RouteInfo(&quot;tasks&quot;, icon = Icons.Default.TaskAlt, primary = true), TasksRootSection())
</a> 
<a href="#h0-2-6" id="h0-2-6" class="d">-    val features = route(RouteInfo(&quot;features&quot;, icon = Icons.Default.Stars, primary = true), FeaturesRoot())
</a><a href="#h0-2-7" id="h0-2-7" class="i">+    val features = route(RouteInfo(&quot;features&quot;, icon = Icons.Default.Stars, primary = true), FeaturesRootSection())
</a> 
<a href="#h0-2-9" id="h0-2-9" class="d">-    val home = route(RouteInfo(&quot;home&quot;, icon = Icons.Default.Home, primary = true), HomeRoot())
</a><a href="#h0-2-10" id="h0-2-10" class="i">+    val home = route(RouteInfo(&quot;home&quot;, icon = Icons.Default.Home, primary = true), HomeRootSection())
</a>     val settings = route(RouteInfo(&quot;home_settings&quot;), HomeSettings()).parent(home)
     val homeLogs = route(RouteInfo(&quot;home_logs&quot;), HomeLogs()).parent(home)
     val loggerHistory = route(RouteInfo(&quot;logger_history&quot;), LoggerHistoryRoot()).parent(home)
<a href="#h0-3" id="h0-3" class="h">@@ -62,12 +58,12 @@ class Routes(
</a>     val editRule = route(RouteInfo(&quot;edit_rule/?rule_id={rule_id}&quot;), EditRule())
 
     val fileImports = route(RouteInfo(&quot;file_imports&quot;), FileImportsRoot()).parent(home)
<a href="#h0-3-3" id="h0-3-3" class="d">-    val social = route(RouteInfo(&quot;social&quot;, icon = Icons.Default.Group, primary = true), SocialRoot())
</a><a href="#h0-3-4" id="h0-3-4" class="i">+    val social = route(RouteInfo(&quot;social&quot;, icon = Icons.Default.Group, primary = true), SocialRootSection())
</a>     val manageScope = route(RouteInfo(&quot;manage_scope/?scope={scope}&amp;id={id}&quot;), ManageScope()).parent(social)
     val messagingPreview = route(RouteInfo(&quot;messaging_preview/?scope={scope}&amp;id={id}&quot;), MessagingPreview()).parent(social)
     val loggedStories = route(RouteInfo(&quot;logged_stories/?id={id}&quot;), LoggedStories()).parent(social)
 
<a href="#h0-3-9" id="h0-3-9" class="d">-    val scripting = route(RouteInfo(&quot;scripts&quot;, icon = Icons.Filled.DataObject, primary = true), ScriptingRoot())
</a><a href="#h0-3-10" id="h0-3-10" class="i">+    val scripting = route(RouteInfo(&quot;scripts&quot;, icon = Icons.Filled.DataObject, primary = true), ScriptingRootSection())
</a> 
     val betterLocation = route(RouteInfo(&quot;better_location&quot;, showInNavBar = false, primary = true), BetterLocationRoot())
 
<b>diff --git a/<a id="h1" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRoot.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRoot.kt</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,474 +0,0 @@
</a><a href="#h1-0-0" id="h1-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.pages
</a><a href="#h1-0-1" id="h1-0-1" class="d">-
</a><a href="#h1-0-2" id="h1-0-2" class="d">- import android.content.Intent
</a><a href="#h1-0-3" id="h1-0-3" class="d">-import androidx.compose.foundation.border
</a><a href="#h1-0-4" id="h1-0-4" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h1-0-5" id="h1-0-5" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h1-0-6" id="h1-0-6" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h1-0-7" id="h1-0-7" class="d">-import androidx.compose.foundation.lazy.items
</a><a href="#h1-0-8" id="h1-0-8" class="d">-import androidx.compose.foundation.lazy.rememberLazyListState
</a><a href="#h1-0-9" id="h1-0-9" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h1-0-10" id="h1-0-10" class="d">-import androidx.compose.material.icons.automirrored.filled.OpenInNew
</a><a href="#h1-0-11" id="h1-0-11" class="d">-import androidx.compose.material.icons.filled.*
</a><a href="#h1-0-12" id="h1-0-12" class="d">-import androidx.compose.material3.*
</a><a href="#h1-0-13" id="h1-0-13" class="d">-import androidx.compose.runtime.*
</a><a href="#h1-0-14" id="h1-0-14" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h1-0-15" id="h1-0-15" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h1-0-16" id="h1-0-16" class="d">-import androidx.compose.ui.draw.clip
</a><a href="#h1-0-17" id="h1-0-17" class="d">-import androidx.compose.ui.graphics.StrokeCap
</a><a href="#h1-0-18" id="h1-0-18" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h1-0-19" id="h1-0-19" class="d">-import androidx.core.net.toUri
</a><a href="#h1-0-20" id="h1-0-20" class="d">-import androidx.documentfile.provider.DocumentFile
</a><a href="#h1-0-21" id="h1-0-21" class="d">-import androidx.lifecycle.Lifecycle
</a><a href="#h1-0-22" id="h1-0-22" class="d">-import androidx.navigation.NavBackStackEntry
</a><a href="#h1-0-23" id="h1-0-23" class="d">-import kotlinx.coroutines.CoroutineScope
</a><a href="#h1-0-24" id="h1-0-24" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h1-0-25" id="h1-0-25" class="d">-import kotlinx.coroutines.launch
</a><a href="#h1-0-26" id="h1-0-26" class="d">-import me.rhunk.snapenhance.bridge.DownloadCallback
</a><a href="#h1-0-27" id="h1-0-27" class="d">-import me.rhunk.snapenhance.common.data.download.DownloadMetadata
</a><a href="#h1-0-28" id="h1-0-28" class="d">-import me.rhunk.snapenhance.common.data.download.MediaDownloadSource
</a><a href="#h1-0-29" id="h1-0-29" class="d">-import me.rhunk.snapenhance.common.data.download.createNewFilePath
</a><a href="#h1-0-30" id="h1-0-30" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h1-0-31" id="h1-0-31" class="d">-import me.rhunk.snapenhance.common.util.ktx.longHashCode
</a><a href="#h1-0-32" id="h1-0-32" class="d">-import me.rhunk.snapenhance.download.DownloadProcessor
</a><a href="#h1-0-33" id="h1-0-33" class="d">-import me.rhunk.snapenhance.download.FFMpegProcessor
</a><a href="#h1-0-34" id="h1-0-34" class="d">-import me.rhunk.snapenhance.task.PendingTask
</a><a href="#h1-0-35" id="h1-0-35" class="d">-import me.rhunk.snapenhance.task.PendingTaskListener
</a><a href="#h1-0-36" id="h1-0-36" class="d">-import me.rhunk.snapenhance.task.Task
</a><a href="#h1-0-37" id="h1-0-37" class="d">-import me.rhunk.snapenhance.task.TaskStatus
</a><a href="#h1-0-38" id="h1-0-38" class="d">-import me.rhunk.snapenhance.task.TaskType
</a><a href="#h1-0-39" id="h1-0-39" class="d">-import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h1-0-40" id="h1-0-40" class="d">-import me.rhunk.snapenhance.ui.util.OnLifecycleEvent
</a><a href="#h1-0-41" id="h1-0-41" class="d">-import java.io.File
</a><a href="#h1-0-42" id="h1-0-42" class="d">-import java.util.UUID
</a><a href="#h1-0-43" id="h1-0-43" class="d">-import kotlin.math.absoluteValue
</a><a href="#h1-0-44" id="h1-0-44" class="d">-
</a><a href="#h1-0-45" id="h1-0-45" class="d">-class TasksRoot : Routes.Route() {
</a><a href="#h1-0-46" id="h1-0-46" class="d">-    private var activeTasks by mutableStateOf(listOf&lt;PendingTask&gt;())
</a><a href="#h1-0-47" id="h1-0-47" class="d">-    private lateinit var recentTasks: MutableList&lt;Task&gt;
</a><a href="#h1-0-48" id="h1-0-48" class="d">-    private val taskSelection = mutableStateListOf&lt;Pair&lt;Task, DocumentFile?&gt;&gt;()
</a><a href="#h1-0-49" id="h1-0-49" class="d">-
</a><a href="#h1-0-50" id="h1-0-50" class="d">-    private fun fetchActiveTasks(scope: CoroutineScope = context.coroutineScope) {
</a><a href="#h1-0-51" id="h1-0-51" class="d">-        scope.launch(Dispatchers.IO) {
</a><a href="#h1-0-52" id="h1-0-52" class="d">-            activeTasks = context.taskManager.getActiveTasks().values.sortedByDescending { it.taskId }.toMutableList()
</a><a href="#h1-0-53" id="h1-0-53" class="d">-        }
</a><a href="#h1-0-54" id="h1-0-54" class="d">-    }
</a><a href="#h1-0-55" id="h1-0-55" class="d">-
</a><a href="#h1-0-56" id="h1-0-56" class="d">-    private fun mergeSelection(selection: List&lt;Pair&lt;Task, DocumentFile&gt;&gt;) {
</a><a href="#h1-0-57" id="h1-0-57" class="d">-        val firstTask = selection.first().first
</a><a href="#h1-0-58" id="h1-0-58" class="d">-
</a><a href="#h1-0-59" id="h1-0-59" class="d">-        val taskHash = UUID.randomUUID().toString().longHashCode().absoluteValue.toString(16)
</a><a href="#h1-0-60" id="h1-0-60" class="d">-        val pendingTask = context.taskManager.createPendingTask(
</a><a href="#h1-0-61" id="h1-0-61" class="d">-            Task(TaskType.DOWNLOAD, &quot;Merge ${selection.size} files&quot;, firstTask.author, taskHash)
</a><a href="#h1-0-62" id="h1-0-62" class="d">-        )
</a><a href="#h1-0-63" id="h1-0-63" class="d">-        pendingTask.status = TaskStatus.RUNNING
</a><a href="#h1-0-64" id="h1-0-64" class="d">-        fetchActiveTasks()
</a><a href="#h1-0-65" id="h1-0-65" class="d">-
</a><a href="#h1-0-66" id="h1-0-66" class="d">-        context.coroutineScope.launch {
</a><a href="#h1-0-67" id="h1-0-67" class="d">-            val filesToMerge = mutableListOf&lt;File&gt;()
</a><a href="#h1-0-68" id="h1-0-68" class="d">-
</a><a href="#h1-0-69" id="h1-0-69" class="d">-            selection.forEach { (task, documentFile) -&gt;
</a><a href="#h1-0-70" id="h1-0-70" class="d">-                val tempFile = File.createTempFile(task.hash, &quot;.&quot; + documentFile.name?.substringAfterLast(&quot;.&quot;), context.androidContext.cacheDir).also {
</a><a href="#h1-0-71" id="h1-0-71" class="d">-                    it.deleteOnExit()
</a><a href="#h1-0-72" id="h1-0-72" class="d">-                }
</a><a href="#h1-0-73" id="h1-0-73" class="d">-
</a><a href="#h1-0-74" id="h1-0-74" class="d">-                runCatching {
</a><a href="#h1-0-75" id="h1-0-75" class="d">-                    pendingTask.updateProgress(&quot;Copying ${documentFile.name}&quot;)
</a><a href="#h1-0-76" id="h1-0-76" class="d">-                    context.androidContext.contentResolver.openInputStream(documentFile.uri)?.use { inputStream -&gt;
</a><a href="#h1-0-77" id="h1-0-77" class="d">-                        //copy with progress
</a><a href="#h1-0-78" id="h1-0-78" class="d">-                        val length = documentFile.length().toFloat()
</a><a href="#h1-0-79" id="h1-0-79" class="d">-                        tempFile.outputStream().use { outputStream -&gt;
</a><a href="#h1-0-80" id="h1-0-80" class="d">-                            val buffer = ByteArray(16 * 1024)
</a><a href="#h1-0-81" id="h1-0-81" class="d">-                            var read: Int
</a><a href="#h1-0-82" id="h1-0-82" class="d">-                            while (inputStream.read(buffer).also { read = it } != -1) {
</a><a href="#h1-0-83" id="h1-0-83" class="d">-                                outputStream.write(buffer, 0, read)
</a><a href="#h1-0-84" id="h1-0-84" class="d">-                                pendingTask.updateProgress(&quot;Copying ${documentFile.name}&quot;, (outputStream.channel.position().toFloat() / length * 100f).toInt())
</a><a href="#h1-0-85" id="h1-0-85" class="d">-                            }
</a><a href="#h1-0-86" id="h1-0-86" class="d">-                            outputStream.flush()
</a><a href="#h1-0-87" id="h1-0-87" class="d">-                            filesToMerge.add(tempFile)
</a><a href="#h1-0-88" id="h1-0-88" class="d">-                        }
</a><a href="#h1-0-89" id="h1-0-89" class="d">-                    }
</a><a href="#h1-0-90" id="h1-0-90" class="d">-                }.onFailure {
</a><a href="#h1-0-91" id="h1-0-91" class="d">-                    pendingTask.fail(&quot;Failed to copy file $documentFile to $tempFile&quot;)
</a><a href="#h1-0-92" id="h1-0-92" class="d">-                    filesToMerge.forEach { it.delete() }
</a><a href="#h1-0-93" id="h1-0-93" class="d">-                    return@launch
</a><a href="#h1-0-94" id="h1-0-94" class="d">-                }
</a><a href="#h1-0-95" id="h1-0-95" class="d">-            }
</a><a href="#h1-0-96" id="h1-0-96" class="d">-
</a><a href="#h1-0-97" id="h1-0-97" class="d">-            val mergedFile = File.createTempFile(&quot;merged&quot;, &quot;.mp4&quot;, context.androidContext.cacheDir).also {
</a><a href="#h1-0-98" id="h1-0-98" class="d">-                it.deleteOnExit()
</a><a href="#h1-0-99" id="h1-0-99" class="d">-            }
</a><a href="#h1-0-100" id="h1-0-100" class="d">-
</a><a href="#h1-0-101" id="h1-0-101" class="d">-            runCatching {
</a><a href="#h1-0-102" id="h1-0-102" class="d">-                context.shortToast(translation.format(&quot;merge_files_toast&quot;, &quot;count&quot; to filesToMerge.size.toString()))
</a><a href="#h1-0-103" id="h1-0-103" class="d">-                FFMpegProcessor.newFFMpegProcessor(context, pendingTask).execute(
</a><a href="#h1-0-104" id="h1-0-104" class="d">-                    FFMpegProcessor.Request(FFMpegProcessor.Action.MERGE_MEDIA, filesToMerge.map { it.absolutePath }, mergedFile)
</a><a href="#h1-0-105" id="h1-0-105" class="d">-                )
</a><a href="#h1-0-106" id="h1-0-106" class="d">-                DownloadProcessor(context, object: DownloadCallback.Default() {
</a><a href="#h1-0-107" id="h1-0-107" class="d">-                    override fun onSuccess(outputPath: String) {
</a><a href="#h1-0-108" id="h1-0-108" class="d">-                        context.log.verbose(&quot;Merged files to $outputPath&quot;)
</a><a href="#h1-0-109" id="h1-0-109" class="d">-                    }
</a><a href="#h1-0-110" id="h1-0-110" class="d">-                }).saveMediaToGallery(pendingTask, mergedFile, DownloadMetadata(
</a><a href="#h1-0-111" id="h1-0-111" class="d">-                    mediaIdentifier = taskHash,
</a><a href="#h1-0-112" id="h1-0-112" class="d">-                    outputPath = createNewFilePath(
</a><a href="#h1-0-113" id="h1-0-113" class="d">-                        context.config.root,
</a><a href="#h1-0-114" id="h1-0-114" class="d">-                        taskHash,
</a><a href="#h1-0-115" id="h1-0-115" class="d">-                        downloadSource = MediaDownloadSource.MERGED,
</a><a href="#h1-0-116" id="h1-0-116" class="d">-                        mediaAuthor = firstTask.author,
</a><a href="#h1-0-117" id="h1-0-117" class="d">-                        creationTimestamp = System.currentTimeMillis()
</a><a href="#h1-0-118" id="h1-0-118" class="d">-                    ),
</a><a href="#h1-0-119" id="h1-0-119" class="d">-                    mediaAuthor = firstTask.author,
</a><a href="#h1-0-120" id="h1-0-120" class="d">-                    downloadSource = MediaDownloadSource.MERGED.translate(context.translation),
</a><a href="#h1-0-121" id="h1-0-121" class="d">-                    iconUrl = null
</a><a href="#h1-0-122" id="h1-0-122" class="d">-                ))
</a><a href="#h1-0-123" id="h1-0-123" class="d">-            }.onFailure {
</a><a href="#h1-0-124" id="h1-0-124" class="d">-                context.log.error(&quot;Failed to merge files&quot;, it)
</a><a href="#h1-0-125" id="h1-0-125" class="d">-                pendingTask.fail(it.message ?: &quot;Failed to merge files&quot;)
</a><a href="#h1-0-126" id="h1-0-126" class="d">-            }.onSuccess {
</a><a href="#h1-0-127" id="h1-0-127" class="d">-                pendingTask.success()
</a><a href="#h1-0-128" id="h1-0-128" class="d">-            }
</a><a href="#h1-0-129" id="h1-0-129" class="d">-            filesToMerge.forEach { it.delete() }
</a><a href="#h1-0-130" id="h1-0-130" class="d">-            mergedFile.delete()
</a><a href="#h1-0-131" id="h1-0-131" class="d">-        }.also {
</a><a href="#h1-0-132" id="h1-0-132" class="d">-            pendingTask.addListener(PendingTaskListener(onCancel = { it.cancel() }))
</a><a href="#h1-0-133" id="h1-0-133" class="d">-        }
</a><a href="#h1-0-134" id="h1-0-134" class="d">-    }
</a><a href="#h1-0-135" id="h1-0-135" class="d">-
</a><a href="#h1-0-136" id="h1-0-136" class="d">-    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = {
</a><a href="#h1-0-137" id="h1-0-137" class="d">-        var showConfirmDialog by remember { mutableStateOf(false) }
</a><a href="#h1-0-138" id="h1-0-138" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h1-0-139" id="h1-0-139" class="d">-
</a><a href="#h1-0-140" id="h1-0-140" class="d">-        if (taskSelection.size == 1) {
</a><a href="#h1-0-141" id="h1-0-141" class="d">-            val selectionExists by rememberAsyncMutableState(defaultValue = false) {
</a><a href="#h1-0-142" id="h1-0-142" class="d">-                taskSelection.firstOrNull()?.second?.exists() == true
</a><a href="#h1-0-143" id="h1-0-143" class="d">-            }
</a><a href="#h1-0-144" id="h1-0-144" class="d">-            if (selectionExists) {
</a><a href="#h1-0-145" id="h1-0-145" class="d">-                taskSelection.firstOrNull()?.second?.let { documentFile -&gt;
</a><a href="#h1-0-146" id="h1-0-146" class="d">-                    IconButton(onClick = {
</a><a href="#h1-0-147" id="h1-0-147" class="d">-                        runCatching {
</a><a href="#h1-0-148" id="h1-0-148" class="d">-                            context.androidContext.startActivity(Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h1-0-149" id="h1-0-149" class="d">-                                setDataAndType(documentFile.uri, documentFile.type)
</a><a href="#h1-0-150" id="h1-0-150" class="d">-                                flags = Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h1-0-151" id="h1-0-151" class="d">-                            })
</a><a href="#h1-0-152" id="h1-0-152" class="d">-                            taskSelection.clear()
</a><a href="#h1-0-153" id="h1-0-153" class="d">-                        }.onFailure {
</a><a href="#h1-0-154" id="h1-0-154" class="d">-                            context.log.error(&quot;Failed to open file ${taskSelection.first().second}&quot;, it)
</a><a href="#h1-0-155" id="h1-0-155" class="d">-                        }
</a><a href="#h1-0-156" id="h1-0-156" class="d">-                    }) {
</a><a href="#h1-0-157" id="h1-0-157" class="d">-                        Icon(Icons.AutoMirrored.Filled.OpenInNew, contentDescription = &quot;Open&quot;)
</a><a href="#h1-0-158" id="h1-0-158" class="d">-                    }
</a><a href="#h1-0-159" id="h1-0-159" class="d">-                }
</a><a href="#h1-0-160" id="h1-0-160" class="d">-            }
</a><a href="#h1-0-161" id="h1-0-161" class="d">-        }
</a><a href="#h1-0-162" id="h1-0-162" class="d">-
</a><a href="#h1-0-163" id="h1-0-163" class="d">-        if (taskSelection.size &gt; 1) {
</a><a href="#h1-0-164" id="h1-0-164" class="d">-            val canMergeSelection by rememberAsyncMutableState(defaultValue = false, keys = arrayOf(taskSelection.size)) {
</a><a href="#h1-0-165" id="h1-0-165" class="d">-                taskSelection.all { it.second?.type?.contains(&quot;video&quot;) == true }
</a><a href="#h1-0-166" id="h1-0-166" class="d">-            }
</a><a href="#h1-0-167" id="h1-0-167" class="d">-
</a><a href="#h1-0-168" id="h1-0-168" class="d">-            if (canMergeSelection) {
</a><a href="#h1-0-169" id="h1-0-169" class="d">-                IconButton(onClick = {
</a><a href="#h1-0-170" id="h1-0-170" class="d">-                    mergeSelection(taskSelection.toList().also {
</a><a href="#h1-0-171" id="h1-0-171" class="d">-                        taskSelection.clear()
</a><a href="#h1-0-172" id="h1-0-172" class="d">-                    }.map { it.first to it.second!! })
</a><a href="#h1-0-173" id="h1-0-173" class="d">-                }) {
</a><a href="#h1-0-174" id="h1-0-174" class="d">-                    Icon(Icons.Filled.Merge, contentDescription = &quot;Merge&quot;)
</a><a href="#h1-0-175" id="h1-0-175" class="d">-                }
</a><a href="#h1-0-176" id="h1-0-176" class="d">-            }
</a><a href="#h1-0-177" id="h1-0-177" class="d">-        }
</a><a href="#h1-0-178" id="h1-0-178" class="d">-
</a><a href="#h1-0-179" id="h1-0-179" class="d">-        IconButton(onClick = {
</a><a href="#h1-0-180" id="h1-0-180" class="d">-            showConfirmDialog = true
</a><a href="#h1-0-181" id="h1-0-181" class="d">-        }) {
</a><a href="#h1-0-182" id="h1-0-182" class="d">-            Icon(Icons.Filled.Delete, contentDescription = &quot;Clear tasks&quot;)
</a><a href="#h1-0-183" id="h1-0-183" class="d">-        }
</a><a href="#h1-0-184" id="h1-0-184" class="d">-
</a><a href="#h1-0-185" id="h1-0-185" class="d">-        if (showConfirmDialog) {
</a><a href="#h1-0-186" id="h1-0-186" class="d">-            var alsoDeleteFiles by remember { mutableStateOf(false) }
</a><a href="#h1-0-187" id="h1-0-187" class="d">-
</a><a href="#h1-0-188" id="h1-0-188" class="d">-            AlertDialog(
</a><a href="#h1-0-189" id="h1-0-189" class="d">-                onDismissRequest = { showConfirmDialog = false },
</a><a href="#h1-0-190" id="h1-0-190" class="d">-                title = {
</a><a href="#h1-0-191" id="h1-0-191" class="d">-                    if (taskSelection.isNotEmpty()) {
</a><a href="#h1-0-192" id="h1-0-192" class="d">-                        Text(translation.format(&quot;remove_selected_tasks_confirm&quot;, &quot;count&quot; to taskSelection.size.toString()))
</a><a href="#h1-0-193" id="h1-0-193" class="d">-                    } else {
</a><a href="#h1-0-194" id="h1-0-194" class="d">-                        Text(translation[&quot;remove_all_tasks_confirm&quot;])
</a><a href="#h1-0-195" id="h1-0-195" class="d">-                    }
</a><a href="#h1-0-196" id="h1-0-196" class="d">-                },
</a><a href="#h1-0-197" id="h1-0-197" class="d">-                text = {
</a><a href="#h1-0-198" id="h1-0-198" class="d">-                    Column {
</a><a href="#h1-0-199" id="h1-0-199" class="d">-                        if (taskSelection.isNotEmpty()) {
</a><a href="#h1-0-200" id="h1-0-200" class="d">-                            Text(translation[&quot;remove_selected_tasks_title&quot;])
</a><a href="#h1-0-201" id="h1-0-201" class="d">-                            Row (
</a><a href="#h1-0-202" id="h1-0-202" class="d">-                                modifier = Modifier
</a><a href="#h1-0-203" id="h1-0-203" class="d">-                                    .padding(top = 10.dp)
</a><a href="#h1-0-204" id="h1-0-204" class="d">-                                    .fillMaxWidth()
</a><a href="#h1-0-205" id="h1-0-205" class="d">-                                    .clickable {
</a><a href="#h1-0-206" id="h1-0-206" class="d">-                                        alsoDeleteFiles = !alsoDeleteFiles
</a><a href="#h1-0-207" id="h1-0-207" class="d">-                                    },
</a><a href="#h1-0-208" id="h1-0-208" class="d">-                                horizontalArrangement = Arrangement.spacedBy(5.dp),
</a><a href="#h1-0-209" id="h1-0-209" class="d">-                                verticalAlignment = Alignment.CenterVertically
</a><a href="#h1-0-210" id="h1-0-210" class="d">-                            ) {
</a><a href="#h1-0-211" id="h1-0-211" class="d">-                                Checkbox(checked = alsoDeleteFiles, onCheckedChange = {
</a><a href="#h1-0-212" id="h1-0-212" class="d">-                                    alsoDeleteFiles = it
</a><a href="#h1-0-213" id="h1-0-213" class="d">-                                })
</a><a href="#h1-0-214" id="h1-0-214" class="d">-                                Text(translation[&quot;delete_files_option&quot;])
</a><a href="#h1-0-215" id="h1-0-215" class="d">-                            }
</a><a href="#h1-0-216" id="h1-0-216" class="d">-                        } else {
</a><a href="#h1-0-217" id="h1-0-217" class="d">-                            Text(translation[&quot;remove_all_tasks_title&quot;])
</a><a href="#h1-0-218" id="h1-0-218" class="d">-                        }
</a><a href="#h1-0-219" id="h1-0-219" class="d">-                    }
</a><a href="#h1-0-220" id="h1-0-220" class="d">-                },
</a><a href="#h1-0-221" id="h1-0-221" class="d">-                confirmButton = {
</a><a href="#h1-0-222" id="h1-0-222" class="d">-                    Button(
</a><a href="#h1-0-223" id="h1-0-223" class="d">-                        onClick = {
</a><a href="#h1-0-224" id="h1-0-224" class="d">-                            showConfirmDialog = false
</a><a href="#h1-0-225" id="h1-0-225" class="d">-                            if (taskSelection.isNotEmpty()) {
</a><a href="#h1-0-226" id="h1-0-226" class="d">-                                taskSelection.forEach { (task, documentFile) -&gt;
</a><a href="#h1-0-227" id="h1-0-227" class="d">-                                    coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h1-0-228" id="h1-0-228" class="d">-                                        context.taskManager.removeTask(task)
</a><a href="#h1-0-229" id="h1-0-229" class="d">-                                        if (alsoDeleteFiles) {
</a><a href="#h1-0-230" id="h1-0-230" class="d">-                                            documentFile?.delete()
</a><a href="#h1-0-231" id="h1-0-231" class="d">-                                        }
</a><a href="#h1-0-232" id="h1-0-232" class="d">-                                    }
</a><a href="#h1-0-233" id="h1-0-233" class="d">-                                    recentTasks.remove(task)
</a><a href="#h1-0-234" id="h1-0-234" class="d">-                                }
</a><a href="#h1-0-235" id="h1-0-235" class="d">-                                activeTasks = activeTasks.filter { task -&gt; !taskSelection.map { it.first }.contains(task.task) }
</a><a href="#h1-0-236" id="h1-0-236" class="d">-                                taskSelection.clear()
</a><a href="#h1-0-237" id="h1-0-237" class="d">-                            } else {
</a><a href="#h1-0-238" id="h1-0-238" class="d">-                                coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h1-0-239" id="h1-0-239" class="d">-                                    context.taskManager.clearAllTasks()
</a><a href="#h1-0-240" id="h1-0-240" class="d">-                                }
</a><a href="#h1-0-241" id="h1-0-241" class="d">-                                recentTasks.clear()
</a><a href="#h1-0-242" id="h1-0-242" class="d">-                                activeTasks.forEach {
</a><a href="#h1-0-243" id="h1-0-243" class="d">-                                    runCatching {
</a><a href="#h1-0-244" id="h1-0-244" class="d">-                                        it.cancel()
</a><a href="#h1-0-245" id="h1-0-245" class="d">-                                    }.onFailure { throwable -&gt;
</a><a href="#h1-0-246" id="h1-0-246" class="d">-                                        context.log.error(&quot;Failed to cancel task $it&quot;, throwable)
</a><a href="#h1-0-247" id="h1-0-247" class="d">-                                    }
</a><a href="#h1-0-248" id="h1-0-248" class="d">-                                }
</a><a href="#h1-0-249" id="h1-0-249" class="d">-                                activeTasks = listOf()
</a><a href="#h1-0-250" id="h1-0-250" class="d">-                                context.taskManager.getActiveTasks().clear()
</a><a href="#h1-0-251" id="h1-0-251" class="d">-                            }
</a><a href="#h1-0-252" id="h1-0-252" class="d">-                        }
</a><a href="#h1-0-253" id="h1-0-253" class="d">-                    ) {
</a><a href="#h1-0-254" id="h1-0-254" class="d">-                        Text(context.translation[&quot;button.positive&quot;])
</a><a href="#h1-0-255" id="h1-0-255" class="d">-                    }
</a><a href="#h1-0-256" id="h1-0-256" class="d">-                },
</a><a href="#h1-0-257" id="h1-0-257" class="d">-                dismissButton = {
</a><a href="#h1-0-258" id="h1-0-258" class="d">-                    Button(
</a><a href="#h1-0-259" id="h1-0-259" class="d">-                        onClick = {
</a><a href="#h1-0-260" id="h1-0-260" class="d">-                            showConfirmDialog = false
</a><a href="#h1-0-261" id="h1-0-261" class="d">-                        }
</a><a href="#h1-0-262" id="h1-0-262" class="d">-                    ) {
</a><a href="#h1-0-263" id="h1-0-263" class="d">-                        Text(context.translation[&quot;button.negative&quot;])
</a><a href="#h1-0-264" id="h1-0-264" class="d">-                    }
</a><a href="#h1-0-265" id="h1-0-265" class="d">-                }
</a><a href="#h1-0-266" id="h1-0-266" class="d">-            )
</a><a href="#h1-0-267" id="h1-0-267" class="d">-        }
</a><a href="#h1-0-268" id="h1-0-268" class="d">-    }
</a><a href="#h1-0-269" id="h1-0-269" class="d">-
</a><a href="#h1-0-270" id="h1-0-270" class="d">-    @Composable
</a><a href="#h1-0-271" id="h1-0-271" class="d">-    private fun TaskCard(modifier: Modifier, task: Task, pendingTask: PendingTask? = null) {
</a><a href="#h1-0-272" id="h1-0-272" class="d">-        var taskStatus by remember { mutableStateOf(task.status) }
</a><a href="#h1-0-273" id="h1-0-273" class="d">-        var taskProgressLabel by remember { mutableStateOf&lt;String?&gt;(null) }
</a><a href="#h1-0-274" id="h1-0-274" class="d">-        var taskProgress by remember { mutableIntStateOf(-1) }
</a><a href="#h1-0-275" id="h1-0-275" class="d">-        val isSelected by remember { derivedStateOf { taskSelection.any { it.first == task } } }
</a><a href="#h1-0-276" id="h1-0-276" class="d">-
</a><a href="#h1-0-277" id="h1-0-277" class="d">-        var documentFileMimeType by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h1-0-278" id="h1-0-278" class="d">-        var isDocumentFileReadable by remember { mutableStateOf(true) }
</a><a href="#h1-0-279" id="h1-0-279" class="d">-        val documentFile by rememberAsyncMutableState(defaultValue = null, keys = arrayOf(taskStatus.key)) {
</a><a href="#h1-0-280" id="h1-0-280" class="d">-            DocumentFile.fromSingleUri(context.androidContext, task.extra?.toUri() ?: return@rememberAsyncMutableState null)?.apply {
</a><a href="#h1-0-281" id="h1-0-281" class="d">-                documentFileMimeType = type ?: &quot;&quot;
</a><a href="#h1-0-282" id="h1-0-282" class="d">-                isDocumentFileReadable = canRead()
</a><a href="#h1-0-283" id="h1-0-283" class="d">-            }
</a><a href="#h1-0-284" id="h1-0-284" class="d">-        }
</a><a href="#h1-0-285" id="h1-0-285" class="d">-
</a><a href="#h1-0-286" id="h1-0-286" class="d">-
</a><a href="#h1-0-287" id="h1-0-287" class="d">-        val listener = remember { PendingTaskListener(
</a><a href="#h1-0-288" id="h1-0-288" class="d">-            onStateChange = {
</a><a href="#h1-0-289" id="h1-0-289" class="d">-                taskStatus = it
</a><a href="#h1-0-290" id="h1-0-290" class="d">-            },
</a><a href="#h1-0-291" id="h1-0-291" class="d">-            onProgress = { label, progress -&gt;
</a><a href="#h1-0-292" id="h1-0-292" class="d">-                taskProgressLabel = label
</a><a href="#h1-0-293" id="h1-0-293" class="d">-                taskProgress = progress
</a><a href="#h1-0-294" id="h1-0-294" class="d">-            }
</a><a href="#h1-0-295" id="h1-0-295" class="d">-        ) }
</a><a href="#h1-0-296" id="h1-0-296" class="d">-
</a><a href="#h1-0-297" id="h1-0-297" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h1-0-298" id="h1-0-298" class="d">-            pendingTask?.addListener(listener)
</a><a href="#h1-0-299" id="h1-0-299" class="d">-        }
</a><a href="#h1-0-300" id="h1-0-300" class="d">-
</a><a href="#h1-0-301" id="h1-0-301" class="d">-        DisposableEffect(Unit) {
</a><a href="#h1-0-302" id="h1-0-302" class="d">-            onDispose {
</a><a href="#h1-0-303" id="h1-0-303" class="d">-                pendingTask?.removeListener(listener)
</a><a href="#h1-0-304" id="h1-0-304" class="d">-            }
</a><a href="#h1-0-305" id="h1-0-305" class="d">-        }
</a><a href="#h1-0-306" id="h1-0-306" class="d">-
</a><a href="#h1-0-307" id="h1-0-307" class="d">-        OutlinedCard(modifier = modifier
</a><a href="#h1-0-308" id="h1-0-308" class="d">-            .clickable {
</a><a href="#h1-0-309" id="h1-0-309" class="d">-                if (isSelected) {
</a><a href="#h1-0-310" id="h1-0-310" class="d">-                    taskSelection.removeIf { it.first == task }
</a><a href="#h1-0-311" id="h1-0-311" class="d">-                    return@clickable
</a><a href="#h1-0-312" id="h1-0-312" class="d">-                }
</a><a href="#h1-0-313" id="h1-0-313" class="d">-                taskSelection.add(task to documentFile)
</a><a href="#h1-0-314" id="h1-0-314" class="d">-            }
</a><a href="#h1-0-315" id="h1-0-315" class="d">-            .let {
</a><a href="#h1-0-316" id="h1-0-316" class="d">-                if (isSelected) {
</a><a href="#h1-0-317" id="h1-0-317" class="d">-                    it
</a><a href="#h1-0-318" id="h1-0-318" class="d">-                        .border(2.dp, MaterialTheme.colorScheme.primary)
</a><a href="#h1-0-319" id="h1-0-319" class="d">-                        .clip(MaterialTheme.shapes.medium)
</a><a href="#h1-0-320" id="h1-0-320" class="d">-                } else it
</a><a href="#h1-0-321" id="h1-0-321" class="d">-            }) {
</a><a href="#h1-0-322" id="h1-0-322" class="d">-            Row(
</a><a href="#h1-0-323" id="h1-0-323" class="d">-                modifier = Modifier.padding(15.dp),
</a><a href="#h1-0-324" id="h1-0-324" class="d">-                verticalAlignment = Alignment.CenterVertically
</a><a href="#h1-0-325" id="h1-0-325" class="d">-            ) {
</a><a href="#h1-0-326" id="h1-0-326" class="d">-                Column(
</a><a href="#h1-0-327" id="h1-0-327" class="d">-                    modifier = Modifier.padding(end = 15.dp)
</a><a href="#h1-0-328" id="h1-0-328" class="d">-                ) {
</a><a href="#h1-0-329" id="h1-0-329" class="d">-                    documentFile?.let {
</a><a href="#h1-0-330" id="h1-0-330" class="d">-                        when {
</a><a href="#h1-0-331" id="h1-0-331" class="d">-                            !isDocumentFileReadable -&gt; Icon(Icons.Filled.DeleteOutline, contentDescription = &quot;File not found&quot;)
</a><a href="#h1-0-332" id="h1-0-332" class="d">-                            documentFileMimeType.contains(&quot;image&quot;) -&gt; Icon(Icons.Filled.Image, contentDescription = &quot;Image&quot;)
</a><a href="#h1-0-333" id="h1-0-333" class="d">-                            documentFileMimeType.contains(&quot;video&quot;) -&gt; Icon(Icons.Filled.Videocam, contentDescription = &quot;Video&quot;)
</a><a href="#h1-0-334" id="h1-0-334" class="d">-                            documentFileMimeType.contains(&quot;audio&quot;) -&gt; Icon(Icons.Filled.MusicNote, contentDescription = &quot;Audio&quot;)
</a><a href="#h1-0-335" id="h1-0-335" class="d">-                            else -&gt; Icon(Icons.Filled.FileCopy, contentDescription = &quot;File&quot;)
</a><a href="#h1-0-336" id="h1-0-336" class="d">-                        }
</a><a href="#h1-0-337" id="h1-0-337" class="d">-                    } ?: run {
</a><a href="#h1-0-338" id="h1-0-338" class="d">-                        when (task.type) {
</a><a href="#h1-0-339" id="h1-0-339" class="d">-                            TaskType.DOWNLOAD -&gt; Icon(Icons.Filled.Download, contentDescription = &quot;Download&quot;)
</a><a href="#h1-0-340" id="h1-0-340" class="d">-                            TaskType.CHAT_ACTION -&gt; Icon(Icons.Filled.ChatBubble, contentDescription = &quot;Chat Action&quot;)
</a><a href="#h1-0-341" id="h1-0-341" class="d">-                        }
</a><a href="#h1-0-342" id="h1-0-342" class="d">-                    }
</a><a href="#h1-0-343" id="h1-0-343" class="d">-                }
</a><a href="#h1-0-344" id="h1-0-344" class="d">-                Column(
</a><a href="#h1-0-345" id="h1-0-345" class="d">-                    modifier = Modifier.weight(1f),
</a><a href="#h1-0-346" id="h1-0-346" class="d">-                ) {
</a><a href="#h1-0-347" id="h1-0-347" class="d">-                    Row(
</a><a href="#h1-0-348" id="h1-0-348" class="d">-                        modifier = Modifier.fillMaxWidth(),
</a><a href="#h1-0-349" id="h1-0-349" class="d">-                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h1-0-350" id="h1-0-350" class="d">-                    ) {
</a><a href="#h1-0-351" id="h1-0-351" class="d">-                        Text(task.title, style = MaterialTheme.typography.bodyMedium)
</a><a href="#h1-0-352" id="h1-0-352" class="d">-                        task.author?.takeIf { it != &quot;null&quot; }?.let {
</a><a href="#h1-0-353" id="h1-0-353" class="d">-                            Spacer(modifier = Modifier.width(5.dp))
</a><a href="#h1-0-354" id="h1-0-354" class="d">-                            Text(it, style = MaterialTheme.typography.bodySmall, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h1-0-355" id="h1-0-355" class="d">-                        }
</a><a href="#h1-0-356" id="h1-0-356" class="d">-                    }
</a><a href="#h1-0-357" id="h1-0-357" class="d">-                    Text(task.hash, style = MaterialTheme.typography.labelSmall)
</a><a href="#h1-0-358" id="h1-0-358" class="d">-                    Column(
</a><a href="#h1-0-359" id="h1-0-359" class="d">-                        modifier = Modifier.padding(top = 5.dp),
</a><a href="#h1-0-360" id="h1-0-360" class="d">-                        verticalArrangement = Arrangement.spacedBy(5.dp)
</a><a href="#h1-0-361" id="h1-0-361" class="d">-                    ) {
</a><a href="#h1-0-362" id="h1-0-362" class="d">-                        if (taskStatus.isFinalStage()) {
</a><a href="#h1-0-363" id="h1-0-363" class="d">-                            if (taskStatus != TaskStatus.SUCCESS) {
</a><a href="#h1-0-364" id="h1-0-364" class="d">-                                Text(&quot;$taskStatus&quot;, style = MaterialTheme.typography.bodySmall)
</a><a href="#h1-0-365" id="h1-0-365" class="d">-                            }
</a><a href="#h1-0-366" id="h1-0-366" class="d">-                        } else {
</a><a href="#h1-0-367" id="h1-0-367" class="d">-                            taskProgressLabel?.let {
</a><a href="#h1-0-368" id="h1-0-368" class="d">-                                Text(it, style = MaterialTheme.typography.bodySmall)
</a><a href="#h1-0-369" id="h1-0-369" class="d">-                            }
</a><a href="#h1-0-370" id="h1-0-370" class="d">-                            if (taskProgress != -1) {
</a><a href="#h1-0-371" id="h1-0-371" class="d">-                                LinearProgressIndicator(
</a><a href="#h1-0-372" id="h1-0-372" class="d">-                                    progress = { taskProgress.toFloat() / 100f },
</a><a href="#h1-0-373" id="h1-0-373" class="d">-                                    strokeCap = StrokeCap.Round,
</a><a href="#h1-0-374" id="h1-0-374" class="d">-                                )
</a><a href="#h1-0-375" id="h1-0-375" class="d">-                            } else {
</a><a href="#h1-0-376" id="h1-0-376" class="d">-                                task.extra?.let {
</a><a href="#h1-0-377" id="h1-0-377" class="d">-                                    Text(it, style = MaterialTheme.typography.bodySmall)
</a><a href="#h1-0-378" id="h1-0-378" class="d">-                                }
</a><a href="#h1-0-379" id="h1-0-379" class="d">-                            }
</a><a href="#h1-0-380" id="h1-0-380" class="d">-                        }
</a><a href="#h1-0-381" id="h1-0-381" class="d">-                    }
</a><a href="#h1-0-382" id="h1-0-382" class="d">-                }
</a><a href="#h1-0-383" id="h1-0-383" class="d">-
</a><a href="#h1-0-384" id="h1-0-384" class="d">-                Column {
</a><a href="#h1-0-385" id="h1-0-385" class="d">-                    if (pendingTask != null &amp;&amp; !taskStatus.isFinalStage()) {
</a><a href="#h1-0-386" id="h1-0-386" class="d">-                        FilledIconButton(onClick = {
</a><a href="#h1-0-387" id="h1-0-387" class="d">-                            runCatching {
</a><a href="#h1-0-388" id="h1-0-388" class="d">-                                pendingTask.cancel()
</a><a href="#h1-0-389" id="h1-0-389" class="d">-                            }.onFailure { throwable -&gt;
</a><a href="#h1-0-390" id="h1-0-390" class="d">-                                context.log.error(&quot;Failed to cancel task $pendingTask&quot;, throwable)
</a><a href="#h1-0-391" id="h1-0-391" class="d">-                            }
</a><a href="#h1-0-392" id="h1-0-392" class="d">-                        }) {
</a><a href="#h1-0-393" id="h1-0-393" class="d">-                            Icon(Icons.Filled.Close, contentDescription = &quot;Cancel&quot;)
</a><a href="#h1-0-394" id="h1-0-394" class="d">-                        }
</a><a href="#h1-0-395" id="h1-0-395" class="d">-                    } else {
</a><a href="#h1-0-396" id="h1-0-396" class="d">-                        when (taskStatus) {
</a><a href="#h1-0-397" id="h1-0-397" class="d">-                            TaskStatus.SUCCESS -&gt; Icon(Icons.Filled.Check, contentDescription = &quot;Success&quot;, tint = MaterialTheme.colorScheme.primary)
</a><a href="#h1-0-398" id="h1-0-398" class="d">-                            TaskStatus.FAILURE -&gt; Icon(Icons.Filled.Error, contentDescription = &quot;Failure&quot;, tint = MaterialTheme.colorScheme.error)
</a><a href="#h1-0-399" id="h1-0-399" class="d">-                            TaskStatus.CANCELLED -&gt; Icon(Icons.Filled.Cancel, contentDescription = &quot;Cancelled&quot;, tint = MaterialTheme.colorScheme.error)
</a><a href="#h1-0-400" id="h1-0-400" class="d">-                            else -&gt; {}
</a><a href="#h1-0-401" id="h1-0-401" class="d">-                        }
</a><a href="#h1-0-402" id="h1-0-402" class="d">-                    }
</a><a href="#h1-0-403" id="h1-0-403" class="d">-                }
</a><a href="#h1-0-404" id="h1-0-404" class="d">-            }
</a><a href="#h1-0-405" id="h1-0-405" class="d">-        }
</a><a href="#h1-0-406" id="h1-0-406" class="d">-    }
</a><a href="#h1-0-407" id="h1-0-407" class="d">-
</a><a href="#h1-0-408" id="h1-0-408" class="d">-    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h1-0-409" id="h1-0-409" class="d">-        val scrollState = rememberLazyListState()
</a><a href="#h1-0-410" id="h1-0-410" class="d">-        val scope = rememberCoroutineScope()
</a><a href="#h1-0-411" id="h1-0-411" class="d">-        recentTasks = remember { mutableStateListOf() }
</a><a href="#h1-0-412" id="h1-0-412" class="d">-        var lastFetchedTaskId: Long? by remember { mutableStateOf(null) }
</a><a href="#h1-0-413" id="h1-0-413" class="d">-
</a><a href="#h1-0-414" id="h1-0-414" class="d">-        fun fetchNewRecentTasks() {
</a><a href="#h1-0-415" id="h1-0-415" class="d">-            scope.launch(Dispatchers.IO) {
</a><a href="#h1-0-416" id="h1-0-416" class="d">-                val tasks = context.taskManager.fetchStoredTasks(lastFetchedTaskId ?: Long.MAX_VALUE)
</a><a href="#h1-0-417" id="h1-0-417" class="d">-                if (tasks.isNotEmpty()) {
</a><a href="#h1-0-418" id="h1-0-418" class="d">-                    lastFetchedTaskId = tasks.keys.last()
</a><a href="#h1-0-419" id="h1-0-419" class="d">-                    val activeTaskIds = activeTasks.map { it.taskId }
</a><a href="#h1-0-420" id="h1-0-420" class="d">-                    recentTasks.addAll(tasks.filter { it.key !in activeTaskIds }.values)
</a><a href="#h1-0-421" id="h1-0-421" class="d">-                }
</a><a href="#h1-0-422" id="h1-0-422" class="d">-            }
</a><a href="#h1-0-423" id="h1-0-423" class="d">-        }
</a><a href="#h1-0-424" id="h1-0-424" class="d">-
</a><a href="#h1-0-425" id="h1-0-425" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h1-0-426" id="h1-0-426" class="d">-            fetchActiveTasks(this)
</a><a href="#h1-0-427" id="h1-0-427" class="d">-        }
</a><a href="#h1-0-428" id="h1-0-428" class="d">-
</a><a href="#h1-0-429" id="h1-0-429" class="d">-        DisposableEffect(Unit) {
</a><a href="#h1-0-430" id="h1-0-430" class="d">-            onDispose {
</a><a href="#h1-0-431" id="h1-0-431" class="d">-                taskSelection.clear()
</a><a href="#h1-0-432" id="h1-0-432" class="d">-            }
</a><a href="#h1-0-433" id="h1-0-433" class="d">-        }
</a><a href="#h1-0-434" id="h1-0-434" class="d">-
</a><a href="#h1-0-435" id="h1-0-435" class="d">-        OnLifecycleEvent { _, event -&gt;
</a><a href="#h1-0-436" id="h1-0-436" class="d">-            if (event == Lifecycle.Event.ON_RESUME) {
</a><a href="#h1-0-437" id="h1-0-437" class="d">-                fetchActiveTasks(scope)
</a><a href="#h1-0-438" id="h1-0-438" class="d">-            }
</a><a href="#h1-0-439" id="h1-0-439" class="d">-        }
</a><a href="#h1-0-440" id="h1-0-440" class="d">-
</a><a href="#h1-0-441" id="h1-0-441" class="d">-        LazyColumn(
</a><a href="#h1-0-442" id="h1-0-442" class="d">-            state = scrollState,
</a><a href="#h1-0-443" id="h1-0-443" class="d">-            modifier = Modifier.fillMaxSize()
</a><a href="#h1-0-444" id="h1-0-444" class="d">-        ) {
</a><a href="#h1-0-445" id="h1-0-445" class="d">-            item {
</a><a href="#h1-0-446" id="h1-0-446" class="d">-                if (activeTasks.isEmpty() &amp;&amp; recentTasks.isEmpty()) {
</a><a href="#h1-0-447" id="h1-0-447" class="d">-                    Column(
</a><a href="#h1-0-448" id="h1-0-448" class="d">-                        modifier = Modifier.fillMaxSize(),
</a><a href="#h1-0-449" id="h1-0-449" class="d">-                        horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h1-0-450" id="h1-0-450" class="d">-                        verticalArrangement = Arrangement.Center
</a><a href="#h1-0-451" id="h1-0-451" class="d">-                    ) {
</a><a href="#h1-0-452" id="h1-0-452" class="d">-                        translation[&quot;no_tasks&quot;].let {
</a><a href="#h1-0-453" id="h1-0-453" class="d">-                            Icon(Icons.Filled.CheckCircle, contentDescription = it, tint = MaterialTheme.colorScheme.primary)
</a><a href="#h1-0-454" id="h1-0-454" class="d">-                            Text(it, style = MaterialTheme.typography.bodyLarge)
</a><a href="#h1-0-455" id="h1-0-455" class="d">-                        }
</a><a href="#h1-0-456" id="h1-0-456" class="d">-                    }
</a><a href="#h1-0-457" id="h1-0-457" class="d">-                }
</a><a href="#h1-0-458" id="h1-0-458" class="d">-            }
</a><a href="#h1-0-459" id="h1-0-459" class="d">-            items(activeTasks, key = { it.taskId }) {pendingTask -&gt;
</a><a href="#h1-0-460" id="h1-0-460" class="d">-                TaskCard(modifier = Modifier.padding(8.dp), pendingTask.task, pendingTask = pendingTask)
</a><a href="#h1-0-461" id="h1-0-461" class="d">-            }
</a><a href="#h1-0-462" id="h1-0-462" class="d">-            items(recentTasks, key = { it.hash }) { task -&gt;
</a><a href="#h1-0-463" id="h1-0-463" class="d">-                TaskCard(modifier = Modifier.padding(8.dp), task)
</a><a href="#h1-0-464" id="h1-0-464" class="d">-            }
</a><a href="#h1-0-465" id="h1-0-465" class="d">-            item {
</a><a href="#h1-0-466" id="h1-0-466" class="d">-                Spacer(modifier = Modifier.height(20.dp))
</a><a href="#h1-0-467" id="h1-0-467" class="d">-                LaunchedEffect(remember { derivedStateOf { scrollState.firstVisibleItemIndex } }) {
</a><a href="#h1-0-468" id="h1-0-468" class="d">-                    fetchNewRecentTasks()
</a><a href="#h1-0-469" id="h1-0-469" class="d">-                }
</a><a href="#h1-0-470" id="h1-0-470" class="d">-            }
</a><a href="#h1-0-471" id="h1-0-471" class="d">-        }
</a><a href="#h1-0-472" id="h1-0-472" class="d">-    }
</a><a href="#h1-0-473" id="h1-0-473" class="d">-}</a><a href="#h1-0-474" id="h1-0-474" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h2" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRootSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/TasksRootSection.kt</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -0,0 +1,474 @@
</a><a href="#h2-0-0" id="h2-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages
</a><a href="#h2-0-1" id="h2-0-1" class="i">+
</a><a href="#h2-0-2" id="h2-0-2" class="i">+ import android.content.Intent
</a><a href="#h2-0-3" id="h2-0-3" class="i">+import androidx.compose.foundation.border
</a><a href="#h2-0-4" id="h2-0-4" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h2-0-5" id="h2-0-5" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h2-0-6" id="h2-0-6" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h2-0-7" id="h2-0-7" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h2-0-8" id="h2-0-8" class="i">+import androidx.compose.foundation.lazy.rememberLazyListState
</a><a href="#h2-0-9" id="h2-0-9" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h2-0-10" id="h2-0-10" class="i">+import androidx.compose.material.icons.automirrored.filled.OpenInNew
</a><a href="#h2-0-11" id="h2-0-11" class="i">+import androidx.compose.material.icons.filled.*
</a><a href="#h2-0-12" id="h2-0-12" class="i">+import androidx.compose.material3.*
</a><a href="#h2-0-13" id="h2-0-13" class="i">+import androidx.compose.runtime.*
</a><a href="#h2-0-14" id="h2-0-14" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h2-0-15" id="h2-0-15" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h2-0-16" id="h2-0-16" class="i">+import androidx.compose.ui.draw.clip
</a><a href="#h2-0-17" id="h2-0-17" class="i">+import androidx.compose.ui.graphics.StrokeCap
</a><a href="#h2-0-18" id="h2-0-18" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h2-0-19" id="h2-0-19" class="i">+import androidx.core.net.toUri
</a><a href="#h2-0-20" id="h2-0-20" class="i">+import androidx.documentfile.provider.DocumentFile
</a><a href="#h2-0-21" id="h2-0-21" class="i">+import androidx.lifecycle.Lifecycle
</a><a href="#h2-0-22" id="h2-0-22" class="i">+import androidx.navigation.NavBackStackEntry
</a><a href="#h2-0-23" id="h2-0-23" class="i">+import kotlinx.coroutines.CoroutineScope
</a><a href="#h2-0-24" id="h2-0-24" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h2-0-25" id="h2-0-25" class="i">+import kotlinx.coroutines.launch
</a><a href="#h2-0-26" id="h2-0-26" class="i">+import me.rhunk.snapenhance.bridge.DownloadCallback
</a><a href="#h2-0-27" id="h2-0-27" class="i">+import me.rhunk.snapenhance.common.data.download.DownloadMetadata
</a><a href="#h2-0-28" id="h2-0-28" class="i">+import me.rhunk.snapenhance.common.data.download.MediaDownloadSource
</a><a href="#h2-0-29" id="h2-0-29" class="i">+import me.rhunk.snapenhance.common.data.download.createNewFilePath
</a><a href="#h2-0-30" id="h2-0-30" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h2-0-31" id="h2-0-31" class="i">+import me.rhunk.snapenhance.common.util.ktx.longHashCode
</a><a href="#h2-0-32" id="h2-0-32" class="i">+import me.rhunk.snapenhance.download.DownloadProcessor
</a><a href="#h2-0-33" id="h2-0-33" class="i">+import me.rhunk.snapenhance.download.FFMpegProcessor
</a><a href="#h2-0-34" id="h2-0-34" class="i">+import me.rhunk.snapenhance.task.PendingTask
</a><a href="#h2-0-35" id="h2-0-35" class="i">+import me.rhunk.snapenhance.task.PendingTaskListener
</a><a href="#h2-0-36" id="h2-0-36" class="i">+import me.rhunk.snapenhance.task.Task
</a><a href="#h2-0-37" id="h2-0-37" class="i">+import me.rhunk.snapenhance.task.TaskStatus
</a><a href="#h2-0-38" id="h2-0-38" class="i">+import me.rhunk.snapenhance.task.TaskType
</a><a href="#h2-0-39" id="h2-0-39" class="i">+import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h2-0-40" id="h2-0-40" class="i">+import me.rhunk.snapenhance.ui.util.OnLifecycleEvent
</a><a href="#h2-0-41" id="h2-0-41" class="i">+import java.io.File
</a><a href="#h2-0-42" id="h2-0-42" class="i">+import java.util.UUID
</a><a href="#h2-0-43" id="h2-0-43" class="i">+import kotlin.math.absoluteValue
</a><a href="#h2-0-44" id="h2-0-44" class="i">+
</a><a href="#h2-0-45" id="h2-0-45" class="i">+class TasksRootSection : Routes.Route() {
</a><a href="#h2-0-46" id="h2-0-46" class="i">+    private var activeTasks by mutableStateOf(listOf&lt;PendingTask&gt;())
</a><a href="#h2-0-47" id="h2-0-47" class="i">+    private lateinit var recentTasks: MutableList&lt;Task&gt;
</a><a href="#h2-0-48" id="h2-0-48" class="i">+    private val taskSelection = mutableStateListOf&lt;Pair&lt;Task, DocumentFile?&gt;&gt;()
</a><a href="#h2-0-49" id="h2-0-49" class="i">+
</a><a href="#h2-0-50" id="h2-0-50" class="i">+    private fun fetchActiveTasks(scope: CoroutineScope = context.coroutineScope) {
</a><a href="#h2-0-51" id="h2-0-51" class="i">+        scope.launch(Dispatchers.IO) {
</a><a href="#h2-0-52" id="h2-0-52" class="i">+            activeTasks = context.taskManager.getActiveTasks().values.sortedByDescending { it.taskId }.toMutableList()
</a><a href="#h2-0-53" id="h2-0-53" class="i">+        }
</a><a href="#h2-0-54" id="h2-0-54" class="i">+    }
</a><a href="#h2-0-55" id="h2-0-55" class="i">+
</a><a href="#h2-0-56" id="h2-0-56" class="i">+    private fun mergeSelection(selection: List&lt;Pair&lt;Task, DocumentFile&gt;&gt;) {
</a><a href="#h2-0-57" id="h2-0-57" class="i">+        val firstTask = selection.first().first
</a><a href="#h2-0-58" id="h2-0-58" class="i">+
</a><a href="#h2-0-59" id="h2-0-59" class="i">+        val taskHash = UUID.randomUUID().toString().longHashCode().absoluteValue.toString(16)
</a><a href="#h2-0-60" id="h2-0-60" class="i">+        val pendingTask = context.taskManager.createPendingTask(
</a><a href="#h2-0-61" id="h2-0-61" class="i">+            Task(TaskType.DOWNLOAD, &quot;Merge ${selection.size} files&quot;, firstTask.author, taskHash)
</a><a href="#h2-0-62" id="h2-0-62" class="i">+        )
</a><a href="#h2-0-63" id="h2-0-63" class="i">+        pendingTask.status = TaskStatus.RUNNING
</a><a href="#h2-0-64" id="h2-0-64" class="i">+        fetchActiveTasks()
</a><a href="#h2-0-65" id="h2-0-65" class="i">+
</a><a href="#h2-0-66" id="h2-0-66" class="i">+        context.coroutineScope.launch {
</a><a href="#h2-0-67" id="h2-0-67" class="i">+            val filesToMerge = mutableListOf&lt;File&gt;()
</a><a href="#h2-0-68" id="h2-0-68" class="i">+
</a><a href="#h2-0-69" id="h2-0-69" class="i">+            selection.forEach { (task, documentFile) -&gt;
</a><a href="#h2-0-70" id="h2-0-70" class="i">+                val tempFile = File.createTempFile(task.hash, &quot;.&quot; + documentFile.name?.substringAfterLast(&quot;.&quot;), context.androidContext.cacheDir).also {
</a><a href="#h2-0-71" id="h2-0-71" class="i">+                    it.deleteOnExit()
</a><a href="#h2-0-72" id="h2-0-72" class="i">+                }
</a><a href="#h2-0-73" id="h2-0-73" class="i">+
</a><a href="#h2-0-74" id="h2-0-74" class="i">+                runCatching {
</a><a href="#h2-0-75" id="h2-0-75" class="i">+                    pendingTask.updateProgress(&quot;Copying ${documentFile.name}&quot;)
</a><a href="#h2-0-76" id="h2-0-76" class="i">+                    context.androidContext.contentResolver.openInputStream(documentFile.uri)?.use { inputStream -&gt;
</a><a href="#h2-0-77" id="h2-0-77" class="i">+                        //copy with progress
</a><a href="#h2-0-78" id="h2-0-78" class="i">+                        val length = documentFile.length().toFloat()
</a><a href="#h2-0-79" id="h2-0-79" class="i">+                        tempFile.outputStream().use { outputStream -&gt;
</a><a href="#h2-0-80" id="h2-0-80" class="i">+                            val buffer = ByteArray(16 * 1024)
</a><a href="#h2-0-81" id="h2-0-81" class="i">+                            var read: Int
</a><a href="#h2-0-82" id="h2-0-82" class="i">+                            while (inputStream.read(buffer).also { read = it } != -1) {
</a><a href="#h2-0-83" id="h2-0-83" class="i">+                                outputStream.write(buffer, 0, read)
</a><a href="#h2-0-84" id="h2-0-84" class="i">+                                pendingTask.updateProgress(&quot;Copying ${documentFile.name}&quot;, (outputStream.channel.position().toFloat() / length * 100f).toInt())
</a><a href="#h2-0-85" id="h2-0-85" class="i">+                            }
</a><a href="#h2-0-86" id="h2-0-86" class="i">+                            outputStream.flush()
</a><a href="#h2-0-87" id="h2-0-87" class="i">+                            filesToMerge.add(tempFile)
</a><a href="#h2-0-88" id="h2-0-88" class="i">+                        }
</a><a href="#h2-0-89" id="h2-0-89" class="i">+                    }
</a><a href="#h2-0-90" id="h2-0-90" class="i">+                }.onFailure {
</a><a href="#h2-0-91" id="h2-0-91" class="i">+                    pendingTask.fail(&quot;Failed to copy file $documentFile to $tempFile&quot;)
</a><a href="#h2-0-92" id="h2-0-92" class="i">+                    filesToMerge.forEach { it.delete() }
</a><a href="#h2-0-93" id="h2-0-93" class="i">+                    return@launch
</a><a href="#h2-0-94" id="h2-0-94" class="i">+                }
</a><a href="#h2-0-95" id="h2-0-95" class="i">+            }
</a><a href="#h2-0-96" id="h2-0-96" class="i">+
</a><a href="#h2-0-97" id="h2-0-97" class="i">+            val mergedFile = File.createTempFile(&quot;merged&quot;, &quot;.mp4&quot;, context.androidContext.cacheDir).also {
</a><a href="#h2-0-98" id="h2-0-98" class="i">+                it.deleteOnExit()
</a><a href="#h2-0-99" id="h2-0-99" class="i">+            }
</a><a href="#h2-0-100" id="h2-0-100" class="i">+
</a><a href="#h2-0-101" id="h2-0-101" class="i">+            runCatching {
</a><a href="#h2-0-102" id="h2-0-102" class="i">+                context.shortToast(translation.format(&quot;merge_files_toast&quot;, &quot;count&quot; to filesToMerge.size.toString()))
</a><a href="#h2-0-103" id="h2-0-103" class="i">+                FFMpegProcessor.newFFMpegProcessor(context, pendingTask).execute(
</a><a href="#h2-0-104" id="h2-0-104" class="i">+                    FFMpegProcessor.Request(FFMpegProcessor.Action.MERGE_MEDIA, filesToMerge.map { it.absolutePath }, mergedFile)
</a><a href="#h2-0-105" id="h2-0-105" class="i">+                )
</a><a href="#h2-0-106" id="h2-0-106" class="i">+                DownloadProcessor(context, object: DownloadCallback.Default() {
</a><a href="#h2-0-107" id="h2-0-107" class="i">+                    override fun onSuccess(outputPath: String) {
</a><a href="#h2-0-108" id="h2-0-108" class="i">+                        context.log.verbose(&quot;Merged files to $outputPath&quot;)
</a><a href="#h2-0-109" id="h2-0-109" class="i">+                    }
</a><a href="#h2-0-110" id="h2-0-110" class="i">+                }).saveMediaToGallery(pendingTask, mergedFile, DownloadMetadata(
</a><a href="#h2-0-111" id="h2-0-111" class="i">+                    mediaIdentifier = taskHash,
</a><a href="#h2-0-112" id="h2-0-112" class="i">+                    outputPath = createNewFilePath(
</a><a href="#h2-0-113" id="h2-0-113" class="i">+                        context.config.root,
</a><a href="#h2-0-114" id="h2-0-114" class="i">+                        taskHash,
</a><a href="#h2-0-115" id="h2-0-115" class="i">+                        downloadSource = MediaDownloadSource.MERGED,
</a><a href="#h2-0-116" id="h2-0-116" class="i">+                        mediaAuthor = firstTask.author,
</a><a href="#h2-0-117" id="h2-0-117" class="i">+                        creationTimestamp = System.currentTimeMillis()
</a><a href="#h2-0-118" id="h2-0-118" class="i">+                    ),
</a><a href="#h2-0-119" id="h2-0-119" class="i">+                    mediaAuthor = firstTask.author,
</a><a href="#h2-0-120" id="h2-0-120" class="i">+                    downloadSource = MediaDownloadSource.MERGED.translate(context.translation),
</a><a href="#h2-0-121" id="h2-0-121" class="i">+                    iconUrl = null
</a><a href="#h2-0-122" id="h2-0-122" class="i">+                ))
</a><a href="#h2-0-123" id="h2-0-123" class="i">+            }.onFailure {
</a><a href="#h2-0-124" id="h2-0-124" class="i">+                context.log.error(&quot;Failed to merge files&quot;, it)
</a><a href="#h2-0-125" id="h2-0-125" class="i">+                pendingTask.fail(it.message ?: &quot;Failed to merge files&quot;)
</a><a href="#h2-0-126" id="h2-0-126" class="i">+            }.onSuccess {
</a><a href="#h2-0-127" id="h2-0-127" class="i">+                pendingTask.success()
</a><a href="#h2-0-128" id="h2-0-128" class="i">+            }
</a><a href="#h2-0-129" id="h2-0-129" class="i">+            filesToMerge.forEach { it.delete() }
</a><a href="#h2-0-130" id="h2-0-130" class="i">+            mergedFile.delete()
</a><a href="#h2-0-131" id="h2-0-131" class="i">+        }.also {
</a><a href="#h2-0-132" id="h2-0-132" class="i">+            pendingTask.addListener(PendingTaskListener(onCancel = { it.cancel() }))
</a><a href="#h2-0-133" id="h2-0-133" class="i">+        }
</a><a href="#h2-0-134" id="h2-0-134" class="i">+    }
</a><a href="#h2-0-135" id="h2-0-135" class="i">+
</a><a href="#h2-0-136" id="h2-0-136" class="i">+    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = {
</a><a href="#h2-0-137" id="h2-0-137" class="i">+        var showConfirmDialog by remember { mutableStateOf(false) }
</a><a href="#h2-0-138" id="h2-0-138" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h2-0-139" id="h2-0-139" class="i">+
</a><a href="#h2-0-140" id="h2-0-140" class="i">+        if (taskSelection.size == 1) {
</a><a href="#h2-0-141" id="h2-0-141" class="i">+            val selectionExists by rememberAsyncMutableState(defaultValue = false) {
</a><a href="#h2-0-142" id="h2-0-142" class="i">+                taskSelection.firstOrNull()?.second?.exists() == true
</a><a href="#h2-0-143" id="h2-0-143" class="i">+            }
</a><a href="#h2-0-144" id="h2-0-144" class="i">+            if (selectionExists) {
</a><a href="#h2-0-145" id="h2-0-145" class="i">+                taskSelection.firstOrNull()?.second?.let { documentFile -&gt;
</a><a href="#h2-0-146" id="h2-0-146" class="i">+                    IconButton(onClick = {
</a><a href="#h2-0-147" id="h2-0-147" class="i">+                        runCatching {
</a><a href="#h2-0-148" id="h2-0-148" class="i">+                            context.androidContext.startActivity(Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h2-0-149" id="h2-0-149" class="i">+                                setDataAndType(documentFile.uri, documentFile.type)
</a><a href="#h2-0-150" id="h2-0-150" class="i">+                                flags = Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h2-0-151" id="h2-0-151" class="i">+                            })
</a><a href="#h2-0-152" id="h2-0-152" class="i">+                            taskSelection.clear()
</a><a href="#h2-0-153" id="h2-0-153" class="i">+                        }.onFailure {
</a><a href="#h2-0-154" id="h2-0-154" class="i">+                            context.log.error(&quot;Failed to open file ${taskSelection.first().second}&quot;, it)
</a><a href="#h2-0-155" id="h2-0-155" class="i">+                        }
</a><a href="#h2-0-156" id="h2-0-156" class="i">+                    }) {
</a><a href="#h2-0-157" id="h2-0-157" class="i">+                        Icon(Icons.AutoMirrored.Filled.OpenInNew, contentDescription = &quot;Open&quot;)
</a><a href="#h2-0-158" id="h2-0-158" class="i">+                    }
</a><a href="#h2-0-159" id="h2-0-159" class="i">+                }
</a><a href="#h2-0-160" id="h2-0-160" class="i">+            }
</a><a href="#h2-0-161" id="h2-0-161" class="i">+        }
</a><a href="#h2-0-162" id="h2-0-162" class="i">+
</a><a href="#h2-0-163" id="h2-0-163" class="i">+        if (taskSelection.size &gt; 1) {
</a><a href="#h2-0-164" id="h2-0-164" class="i">+            val canMergeSelection by rememberAsyncMutableState(defaultValue = false, keys = arrayOf(taskSelection.size)) {
</a><a href="#h2-0-165" id="h2-0-165" class="i">+                taskSelection.all { it.second?.type?.contains(&quot;video&quot;) == true }
</a><a href="#h2-0-166" id="h2-0-166" class="i">+            }
</a><a href="#h2-0-167" id="h2-0-167" class="i">+
</a><a href="#h2-0-168" id="h2-0-168" class="i">+            if (canMergeSelection) {
</a><a href="#h2-0-169" id="h2-0-169" class="i">+                IconButton(onClick = {
</a><a href="#h2-0-170" id="h2-0-170" class="i">+                    mergeSelection(taskSelection.toList().also {
</a><a href="#h2-0-171" id="h2-0-171" class="i">+                        taskSelection.clear()
</a><a href="#h2-0-172" id="h2-0-172" class="i">+                    }.map { it.first to it.second!! })
</a><a href="#h2-0-173" id="h2-0-173" class="i">+                }) {
</a><a href="#h2-0-174" id="h2-0-174" class="i">+                    Icon(Icons.Filled.Merge, contentDescription = &quot;Merge&quot;)
</a><a href="#h2-0-175" id="h2-0-175" class="i">+                }
</a><a href="#h2-0-176" id="h2-0-176" class="i">+            }
</a><a href="#h2-0-177" id="h2-0-177" class="i">+        }
</a><a href="#h2-0-178" id="h2-0-178" class="i">+
</a><a href="#h2-0-179" id="h2-0-179" class="i">+        IconButton(onClick = {
</a><a href="#h2-0-180" id="h2-0-180" class="i">+            showConfirmDialog = true
</a><a href="#h2-0-181" id="h2-0-181" class="i">+        }) {
</a><a href="#h2-0-182" id="h2-0-182" class="i">+            Icon(Icons.Filled.Delete, contentDescription = &quot;Clear tasks&quot;)
</a><a href="#h2-0-183" id="h2-0-183" class="i">+        }
</a><a href="#h2-0-184" id="h2-0-184" class="i">+
</a><a href="#h2-0-185" id="h2-0-185" class="i">+        if (showConfirmDialog) {
</a><a href="#h2-0-186" id="h2-0-186" class="i">+            var alsoDeleteFiles by remember { mutableStateOf(false) }
</a><a href="#h2-0-187" id="h2-0-187" class="i">+
</a><a href="#h2-0-188" id="h2-0-188" class="i">+            AlertDialog(
</a><a href="#h2-0-189" id="h2-0-189" class="i">+                onDismissRequest = { showConfirmDialog = false },
</a><a href="#h2-0-190" id="h2-0-190" class="i">+                title = {
</a><a href="#h2-0-191" id="h2-0-191" class="i">+                    if (taskSelection.isNotEmpty()) {
</a><a href="#h2-0-192" id="h2-0-192" class="i">+                        Text(translation.format(&quot;remove_selected_tasks_confirm&quot;, &quot;count&quot; to taskSelection.size.toString()))
</a><a href="#h2-0-193" id="h2-0-193" class="i">+                    } else {
</a><a href="#h2-0-194" id="h2-0-194" class="i">+                        Text(translation[&quot;remove_all_tasks_confirm&quot;])
</a><a href="#h2-0-195" id="h2-0-195" class="i">+                    }
</a><a href="#h2-0-196" id="h2-0-196" class="i">+                },
</a><a href="#h2-0-197" id="h2-0-197" class="i">+                text = {
</a><a href="#h2-0-198" id="h2-0-198" class="i">+                    Column {
</a><a href="#h2-0-199" id="h2-0-199" class="i">+                        if (taskSelection.isNotEmpty()) {
</a><a href="#h2-0-200" id="h2-0-200" class="i">+                            Text(translation[&quot;remove_selected_tasks_title&quot;])
</a><a href="#h2-0-201" id="h2-0-201" class="i">+                            Row (
</a><a href="#h2-0-202" id="h2-0-202" class="i">+                                modifier = Modifier
</a><a href="#h2-0-203" id="h2-0-203" class="i">+                                    .padding(top = 10.dp)
</a><a href="#h2-0-204" id="h2-0-204" class="i">+                                    .fillMaxWidth()
</a><a href="#h2-0-205" id="h2-0-205" class="i">+                                    .clickable {
</a><a href="#h2-0-206" id="h2-0-206" class="i">+                                        alsoDeleteFiles = !alsoDeleteFiles
</a><a href="#h2-0-207" id="h2-0-207" class="i">+                                    },
</a><a href="#h2-0-208" id="h2-0-208" class="i">+                                horizontalArrangement = Arrangement.spacedBy(5.dp),
</a><a href="#h2-0-209" id="h2-0-209" class="i">+                                verticalAlignment = Alignment.CenterVertically
</a><a href="#h2-0-210" id="h2-0-210" class="i">+                            ) {
</a><a href="#h2-0-211" id="h2-0-211" class="i">+                                Checkbox(checked = alsoDeleteFiles, onCheckedChange = {
</a><a href="#h2-0-212" id="h2-0-212" class="i">+                                    alsoDeleteFiles = it
</a><a href="#h2-0-213" id="h2-0-213" class="i">+                                })
</a><a href="#h2-0-214" id="h2-0-214" class="i">+                                Text(translation[&quot;delete_files_option&quot;])
</a><a href="#h2-0-215" id="h2-0-215" class="i">+                            }
</a><a href="#h2-0-216" id="h2-0-216" class="i">+                        } else {
</a><a href="#h2-0-217" id="h2-0-217" class="i">+                            Text(translation[&quot;remove_all_tasks_title&quot;])
</a><a href="#h2-0-218" id="h2-0-218" class="i">+                        }
</a><a href="#h2-0-219" id="h2-0-219" class="i">+                    }
</a><a href="#h2-0-220" id="h2-0-220" class="i">+                },
</a><a href="#h2-0-221" id="h2-0-221" class="i">+                confirmButton = {
</a><a href="#h2-0-222" id="h2-0-222" class="i">+                    Button(
</a><a href="#h2-0-223" id="h2-0-223" class="i">+                        onClick = {
</a><a href="#h2-0-224" id="h2-0-224" class="i">+                            showConfirmDialog = false
</a><a href="#h2-0-225" id="h2-0-225" class="i">+                            if (taskSelection.isNotEmpty()) {
</a><a href="#h2-0-226" id="h2-0-226" class="i">+                                taskSelection.forEach { (task, documentFile) -&gt;
</a><a href="#h2-0-227" id="h2-0-227" class="i">+                                    coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h2-0-228" id="h2-0-228" class="i">+                                        context.taskManager.removeTask(task)
</a><a href="#h2-0-229" id="h2-0-229" class="i">+                                        if (alsoDeleteFiles) {
</a><a href="#h2-0-230" id="h2-0-230" class="i">+                                            documentFile?.delete()
</a><a href="#h2-0-231" id="h2-0-231" class="i">+                                        }
</a><a href="#h2-0-232" id="h2-0-232" class="i">+                                    }
</a><a href="#h2-0-233" id="h2-0-233" class="i">+                                    recentTasks.remove(task)
</a><a href="#h2-0-234" id="h2-0-234" class="i">+                                }
</a><a href="#h2-0-235" id="h2-0-235" class="i">+                                activeTasks = activeTasks.filter { task -&gt; !taskSelection.map { it.first }.contains(task.task) }
</a><a href="#h2-0-236" id="h2-0-236" class="i">+                                taskSelection.clear()
</a><a href="#h2-0-237" id="h2-0-237" class="i">+                            } else {
</a><a href="#h2-0-238" id="h2-0-238" class="i">+                                coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h2-0-239" id="h2-0-239" class="i">+                                    context.taskManager.clearAllTasks()
</a><a href="#h2-0-240" id="h2-0-240" class="i">+                                }
</a><a href="#h2-0-241" id="h2-0-241" class="i">+                                recentTasks.clear()
</a><a href="#h2-0-242" id="h2-0-242" class="i">+                                activeTasks.forEach {
</a><a href="#h2-0-243" id="h2-0-243" class="i">+                                    runCatching {
</a><a href="#h2-0-244" id="h2-0-244" class="i">+                                        it.cancel()
</a><a href="#h2-0-245" id="h2-0-245" class="i">+                                    }.onFailure { throwable -&gt;
</a><a href="#h2-0-246" id="h2-0-246" class="i">+                                        context.log.error(&quot;Failed to cancel task $it&quot;, throwable)
</a><a href="#h2-0-247" id="h2-0-247" class="i">+                                    }
</a><a href="#h2-0-248" id="h2-0-248" class="i">+                                }
</a><a href="#h2-0-249" id="h2-0-249" class="i">+                                activeTasks = listOf()
</a><a href="#h2-0-250" id="h2-0-250" class="i">+                                context.taskManager.getActiveTasks().clear()
</a><a href="#h2-0-251" id="h2-0-251" class="i">+                            }
</a><a href="#h2-0-252" id="h2-0-252" class="i">+                        }
</a><a href="#h2-0-253" id="h2-0-253" class="i">+                    ) {
</a><a href="#h2-0-254" id="h2-0-254" class="i">+                        Text(context.translation[&quot;button.positive&quot;])
</a><a href="#h2-0-255" id="h2-0-255" class="i">+                    }
</a><a href="#h2-0-256" id="h2-0-256" class="i">+                },
</a><a href="#h2-0-257" id="h2-0-257" class="i">+                dismissButton = {
</a><a href="#h2-0-258" id="h2-0-258" class="i">+                    Button(
</a><a href="#h2-0-259" id="h2-0-259" class="i">+                        onClick = {
</a><a href="#h2-0-260" id="h2-0-260" class="i">+                            showConfirmDialog = false
</a><a href="#h2-0-261" id="h2-0-261" class="i">+                        }
</a><a href="#h2-0-262" id="h2-0-262" class="i">+                    ) {
</a><a href="#h2-0-263" id="h2-0-263" class="i">+                        Text(context.translation[&quot;button.negative&quot;])
</a><a href="#h2-0-264" id="h2-0-264" class="i">+                    }
</a><a href="#h2-0-265" id="h2-0-265" class="i">+                }
</a><a href="#h2-0-266" id="h2-0-266" class="i">+            )
</a><a href="#h2-0-267" id="h2-0-267" class="i">+        }
</a><a href="#h2-0-268" id="h2-0-268" class="i">+    }
</a><a href="#h2-0-269" id="h2-0-269" class="i">+
</a><a href="#h2-0-270" id="h2-0-270" class="i">+    @Composable
</a><a href="#h2-0-271" id="h2-0-271" class="i">+    private fun TaskCard(modifier: Modifier, task: Task, pendingTask: PendingTask? = null) {
</a><a href="#h2-0-272" id="h2-0-272" class="i">+        var taskStatus by remember { mutableStateOf(task.status) }
</a><a href="#h2-0-273" id="h2-0-273" class="i">+        var taskProgressLabel by remember { mutableStateOf&lt;String?&gt;(null) }
</a><a href="#h2-0-274" id="h2-0-274" class="i">+        var taskProgress by remember { mutableIntStateOf(-1) }
</a><a href="#h2-0-275" id="h2-0-275" class="i">+        val isSelected by remember { derivedStateOf { taskSelection.any { it.first == task } } }
</a><a href="#h2-0-276" id="h2-0-276" class="i">+
</a><a href="#h2-0-277" id="h2-0-277" class="i">+        var documentFileMimeType by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h2-0-278" id="h2-0-278" class="i">+        var isDocumentFileReadable by remember { mutableStateOf(true) }
</a><a href="#h2-0-279" id="h2-0-279" class="i">+        val documentFile by rememberAsyncMutableState(defaultValue = null, keys = arrayOf(taskStatus.key)) {
</a><a href="#h2-0-280" id="h2-0-280" class="i">+            DocumentFile.fromSingleUri(context.androidContext, task.extra?.toUri() ?: return@rememberAsyncMutableState null)?.apply {
</a><a href="#h2-0-281" id="h2-0-281" class="i">+                documentFileMimeType = type ?: &quot;&quot;
</a><a href="#h2-0-282" id="h2-0-282" class="i">+                isDocumentFileReadable = canRead()
</a><a href="#h2-0-283" id="h2-0-283" class="i">+            }
</a><a href="#h2-0-284" id="h2-0-284" class="i">+        }
</a><a href="#h2-0-285" id="h2-0-285" class="i">+
</a><a href="#h2-0-286" id="h2-0-286" class="i">+
</a><a href="#h2-0-287" id="h2-0-287" class="i">+        val listener = remember { PendingTaskListener(
</a><a href="#h2-0-288" id="h2-0-288" class="i">+            onStateChange = {
</a><a href="#h2-0-289" id="h2-0-289" class="i">+                taskStatus = it
</a><a href="#h2-0-290" id="h2-0-290" class="i">+            },
</a><a href="#h2-0-291" id="h2-0-291" class="i">+            onProgress = { label, progress -&gt;
</a><a href="#h2-0-292" id="h2-0-292" class="i">+                taskProgressLabel = label
</a><a href="#h2-0-293" id="h2-0-293" class="i">+                taskProgress = progress
</a><a href="#h2-0-294" id="h2-0-294" class="i">+            }
</a><a href="#h2-0-295" id="h2-0-295" class="i">+        ) }
</a><a href="#h2-0-296" id="h2-0-296" class="i">+
</a><a href="#h2-0-297" id="h2-0-297" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h2-0-298" id="h2-0-298" class="i">+            pendingTask?.addListener(listener)
</a><a href="#h2-0-299" id="h2-0-299" class="i">+        }
</a><a href="#h2-0-300" id="h2-0-300" class="i">+
</a><a href="#h2-0-301" id="h2-0-301" class="i">+        DisposableEffect(Unit) {
</a><a href="#h2-0-302" id="h2-0-302" class="i">+            onDispose {
</a><a href="#h2-0-303" id="h2-0-303" class="i">+                pendingTask?.removeListener(listener)
</a><a href="#h2-0-304" id="h2-0-304" class="i">+            }
</a><a href="#h2-0-305" id="h2-0-305" class="i">+        }
</a><a href="#h2-0-306" id="h2-0-306" class="i">+
</a><a href="#h2-0-307" id="h2-0-307" class="i">+        OutlinedCard(modifier = modifier
</a><a href="#h2-0-308" id="h2-0-308" class="i">+            .clickable {
</a><a href="#h2-0-309" id="h2-0-309" class="i">+                if (isSelected) {
</a><a href="#h2-0-310" id="h2-0-310" class="i">+                    taskSelection.removeIf { it.first == task }
</a><a href="#h2-0-311" id="h2-0-311" class="i">+                    return@clickable
</a><a href="#h2-0-312" id="h2-0-312" class="i">+                }
</a><a href="#h2-0-313" id="h2-0-313" class="i">+                taskSelection.add(task to documentFile)
</a><a href="#h2-0-314" id="h2-0-314" class="i">+            }
</a><a href="#h2-0-315" id="h2-0-315" class="i">+            .let {
</a><a href="#h2-0-316" id="h2-0-316" class="i">+                if (isSelected) {
</a><a href="#h2-0-317" id="h2-0-317" class="i">+                    it
</a><a href="#h2-0-318" id="h2-0-318" class="i">+                        .border(2.dp, MaterialTheme.colorScheme.primary)
</a><a href="#h2-0-319" id="h2-0-319" class="i">+                        .clip(MaterialTheme.shapes.medium)
</a><a href="#h2-0-320" id="h2-0-320" class="i">+                } else it
</a><a href="#h2-0-321" id="h2-0-321" class="i">+            }) {
</a><a href="#h2-0-322" id="h2-0-322" class="i">+            Row(
</a><a href="#h2-0-323" id="h2-0-323" class="i">+                modifier = Modifier.padding(15.dp),
</a><a href="#h2-0-324" id="h2-0-324" class="i">+                verticalAlignment = Alignment.CenterVertically
</a><a href="#h2-0-325" id="h2-0-325" class="i">+            ) {
</a><a href="#h2-0-326" id="h2-0-326" class="i">+                Column(
</a><a href="#h2-0-327" id="h2-0-327" class="i">+                    modifier = Modifier.padding(end = 15.dp)
</a><a href="#h2-0-328" id="h2-0-328" class="i">+                ) {
</a><a href="#h2-0-329" id="h2-0-329" class="i">+                    documentFile?.let {
</a><a href="#h2-0-330" id="h2-0-330" class="i">+                        when {
</a><a href="#h2-0-331" id="h2-0-331" class="i">+                            !isDocumentFileReadable -&gt; Icon(Icons.Filled.DeleteOutline, contentDescription = &quot;File not found&quot;)
</a><a href="#h2-0-332" id="h2-0-332" class="i">+                            documentFileMimeType.contains(&quot;image&quot;) -&gt; Icon(Icons.Filled.Image, contentDescription = &quot;Image&quot;)
</a><a href="#h2-0-333" id="h2-0-333" class="i">+                            documentFileMimeType.contains(&quot;video&quot;) -&gt; Icon(Icons.Filled.Videocam, contentDescription = &quot;Video&quot;)
</a><a href="#h2-0-334" id="h2-0-334" class="i">+                            documentFileMimeType.contains(&quot;audio&quot;) -&gt; Icon(Icons.Filled.MusicNote, contentDescription = &quot;Audio&quot;)
</a><a href="#h2-0-335" id="h2-0-335" class="i">+                            else -&gt; Icon(Icons.Filled.FileCopy, contentDescription = &quot;File&quot;)
</a><a href="#h2-0-336" id="h2-0-336" class="i">+                        }
</a><a href="#h2-0-337" id="h2-0-337" class="i">+                    } ?: run {
</a><a href="#h2-0-338" id="h2-0-338" class="i">+                        when (task.type) {
</a><a href="#h2-0-339" id="h2-0-339" class="i">+                            TaskType.DOWNLOAD -&gt; Icon(Icons.Filled.Download, contentDescription = &quot;Download&quot;)
</a><a href="#h2-0-340" id="h2-0-340" class="i">+                            TaskType.CHAT_ACTION -&gt; Icon(Icons.Filled.ChatBubble, contentDescription = &quot;Chat Action&quot;)
</a><a href="#h2-0-341" id="h2-0-341" class="i">+                        }
</a><a href="#h2-0-342" id="h2-0-342" class="i">+                    }
</a><a href="#h2-0-343" id="h2-0-343" class="i">+                }
</a><a href="#h2-0-344" id="h2-0-344" class="i">+                Column(
</a><a href="#h2-0-345" id="h2-0-345" class="i">+                    modifier = Modifier.weight(1f),
</a><a href="#h2-0-346" id="h2-0-346" class="i">+                ) {
</a><a href="#h2-0-347" id="h2-0-347" class="i">+                    Row(
</a><a href="#h2-0-348" id="h2-0-348" class="i">+                        modifier = Modifier.fillMaxWidth(),
</a><a href="#h2-0-349" id="h2-0-349" class="i">+                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h2-0-350" id="h2-0-350" class="i">+                    ) {
</a><a href="#h2-0-351" id="h2-0-351" class="i">+                        Text(task.title, style = MaterialTheme.typography.bodyMedium)
</a><a href="#h2-0-352" id="h2-0-352" class="i">+                        task.author?.takeIf { it != &quot;null&quot; }?.let {
</a><a href="#h2-0-353" id="h2-0-353" class="i">+                            Spacer(modifier = Modifier.width(5.dp))
</a><a href="#h2-0-354" id="h2-0-354" class="i">+                            Text(it, style = MaterialTheme.typography.bodySmall, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h2-0-355" id="h2-0-355" class="i">+                        }
</a><a href="#h2-0-356" id="h2-0-356" class="i">+                    }
</a><a href="#h2-0-357" id="h2-0-357" class="i">+                    Text(task.hash, style = MaterialTheme.typography.labelSmall)
</a><a href="#h2-0-358" id="h2-0-358" class="i">+                    Column(
</a><a href="#h2-0-359" id="h2-0-359" class="i">+                        modifier = Modifier.padding(top = 5.dp),
</a><a href="#h2-0-360" id="h2-0-360" class="i">+                        verticalArrangement = Arrangement.spacedBy(5.dp)
</a><a href="#h2-0-361" id="h2-0-361" class="i">+                    ) {
</a><a href="#h2-0-362" id="h2-0-362" class="i">+                        if (taskStatus.isFinalStage()) {
</a><a href="#h2-0-363" id="h2-0-363" class="i">+                            if (taskStatus != TaskStatus.SUCCESS) {
</a><a href="#h2-0-364" id="h2-0-364" class="i">+                                Text(&quot;$taskStatus&quot;, style = MaterialTheme.typography.bodySmall)
</a><a href="#h2-0-365" id="h2-0-365" class="i">+                            }
</a><a href="#h2-0-366" id="h2-0-366" class="i">+                        } else {
</a><a href="#h2-0-367" id="h2-0-367" class="i">+                            taskProgressLabel?.let {
</a><a href="#h2-0-368" id="h2-0-368" class="i">+                                Text(it, style = MaterialTheme.typography.bodySmall)
</a><a href="#h2-0-369" id="h2-0-369" class="i">+                            }
</a><a href="#h2-0-370" id="h2-0-370" class="i">+                            if (taskProgress != -1) {
</a><a href="#h2-0-371" id="h2-0-371" class="i">+                                LinearProgressIndicator(
</a><a href="#h2-0-372" id="h2-0-372" class="i">+                                    progress = { taskProgress.toFloat() / 100f },
</a><a href="#h2-0-373" id="h2-0-373" class="i">+                                    strokeCap = StrokeCap.Round,
</a><a href="#h2-0-374" id="h2-0-374" class="i">+                                )
</a><a href="#h2-0-375" id="h2-0-375" class="i">+                            } else {
</a><a href="#h2-0-376" id="h2-0-376" class="i">+                                task.extra?.let {
</a><a href="#h2-0-377" id="h2-0-377" class="i">+                                    Text(it, style = MaterialTheme.typography.bodySmall)
</a><a href="#h2-0-378" id="h2-0-378" class="i">+                                }
</a><a href="#h2-0-379" id="h2-0-379" class="i">+                            }
</a><a href="#h2-0-380" id="h2-0-380" class="i">+                        }
</a><a href="#h2-0-381" id="h2-0-381" class="i">+                    }
</a><a href="#h2-0-382" id="h2-0-382" class="i">+                }
</a><a href="#h2-0-383" id="h2-0-383" class="i">+
</a><a href="#h2-0-384" id="h2-0-384" class="i">+                Column {
</a><a href="#h2-0-385" id="h2-0-385" class="i">+                    if (pendingTask != null &amp;&amp; !taskStatus.isFinalStage()) {
</a><a href="#h2-0-386" id="h2-0-386" class="i">+                        FilledIconButton(onClick = {
</a><a href="#h2-0-387" id="h2-0-387" class="i">+                            runCatching {
</a><a href="#h2-0-388" id="h2-0-388" class="i">+                                pendingTask.cancel()
</a><a href="#h2-0-389" id="h2-0-389" class="i">+                            }.onFailure { throwable -&gt;
</a><a href="#h2-0-390" id="h2-0-390" class="i">+                                context.log.error(&quot;Failed to cancel task $pendingTask&quot;, throwable)
</a><a href="#h2-0-391" id="h2-0-391" class="i">+                            }
</a><a href="#h2-0-392" id="h2-0-392" class="i">+                        }) {
</a><a href="#h2-0-393" id="h2-0-393" class="i">+                            Icon(Icons.Filled.Close, contentDescription = &quot;Cancel&quot;)
</a><a href="#h2-0-394" id="h2-0-394" class="i">+                        }
</a><a href="#h2-0-395" id="h2-0-395" class="i">+                    } else {
</a><a href="#h2-0-396" id="h2-0-396" class="i">+                        when (taskStatus) {
</a><a href="#h2-0-397" id="h2-0-397" class="i">+                            TaskStatus.SUCCESS -&gt; Icon(Icons.Filled.Check, contentDescription = &quot;Success&quot;, tint = MaterialTheme.colorScheme.primary)
</a><a href="#h2-0-398" id="h2-0-398" class="i">+                            TaskStatus.FAILURE -&gt; Icon(Icons.Filled.Error, contentDescription = &quot;Failure&quot;, tint = MaterialTheme.colorScheme.error)
</a><a href="#h2-0-399" id="h2-0-399" class="i">+                            TaskStatus.CANCELLED -&gt; Icon(Icons.Filled.Cancel, contentDescription = &quot;Cancelled&quot;, tint = MaterialTheme.colorScheme.error)
</a><a href="#h2-0-400" id="h2-0-400" class="i">+                            else -&gt; {}
</a><a href="#h2-0-401" id="h2-0-401" class="i">+                        }
</a><a href="#h2-0-402" id="h2-0-402" class="i">+                    }
</a><a href="#h2-0-403" id="h2-0-403" class="i">+                }
</a><a href="#h2-0-404" id="h2-0-404" class="i">+            }
</a><a href="#h2-0-405" id="h2-0-405" class="i">+        }
</a><a href="#h2-0-406" id="h2-0-406" class="i">+    }
</a><a href="#h2-0-407" id="h2-0-407" class="i">+
</a><a href="#h2-0-408" id="h2-0-408" class="i">+    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h2-0-409" id="h2-0-409" class="i">+        val scrollState = rememberLazyListState()
</a><a href="#h2-0-410" id="h2-0-410" class="i">+        val scope = rememberCoroutineScope()
</a><a href="#h2-0-411" id="h2-0-411" class="i">+        recentTasks = remember { mutableStateListOf() }
</a><a href="#h2-0-412" id="h2-0-412" class="i">+        var lastFetchedTaskId: Long? by remember { mutableStateOf(null) }
</a><a href="#h2-0-413" id="h2-0-413" class="i">+
</a><a href="#h2-0-414" id="h2-0-414" class="i">+        fun fetchNewRecentTasks() {
</a><a href="#h2-0-415" id="h2-0-415" class="i">+            scope.launch(Dispatchers.IO) {
</a><a href="#h2-0-416" id="h2-0-416" class="i">+                val tasks = context.taskManager.fetchStoredTasks(lastFetchedTaskId ?: Long.MAX_VALUE)
</a><a href="#h2-0-417" id="h2-0-417" class="i">+                if (tasks.isNotEmpty()) {
</a><a href="#h2-0-418" id="h2-0-418" class="i">+                    lastFetchedTaskId = tasks.keys.last()
</a><a href="#h2-0-419" id="h2-0-419" class="i">+                    val activeTaskIds = activeTasks.map { it.taskId }
</a><a href="#h2-0-420" id="h2-0-420" class="i">+                    recentTasks.addAll(tasks.filter { it.key !in activeTaskIds }.values)
</a><a href="#h2-0-421" id="h2-0-421" class="i">+                }
</a><a href="#h2-0-422" id="h2-0-422" class="i">+            }
</a><a href="#h2-0-423" id="h2-0-423" class="i">+        }
</a><a href="#h2-0-424" id="h2-0-424" class="i">+
</a><a href="#h2-0-425" id="h2-0-425" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h2-0-426" id="h2-0-426" class="i">+            fetchActiveTasks(this)
</a><a href="#h2-0-427" id="h2-0-427" class="i">+        }
</a><a href="#h2-0-428" id="h2-0-428" class="i">+
</a><a href="#h2-0-429" id="h2-0-429" class="i">+        DisposableEffect(Unit) {
</a><a href="#h2-0-430" id="h2-0-430" class="i">+            onDispose {
</a><a href="#h2-0-431" id="h2-0-431" class="i">+                taskSelection.clear()
</a><a href="#h2-0-432" id="h2-0-432" class="i">+            }
</a><a href="#h2-0-433" id="h2-0-433" class="i">+        }
</a><a href="#h2-0-434" id="h2-0-434" class="i">+
</a><a href="#h2-0-435" id="h2-0-435" class="i">+        OnLifecycleEvent { _, event -&gt;
</a><a href="#h2-0-436" id="h2-0-436" class="i">+            if (event == Lifecycle.Event.ON_RESUME) {
</a><a href="#h2-0-437" id="h2-0-437" class="i">+                fetchActiveTasks(scope)
</a><a href="#h2-0-438" id="h2-0-438" class="i">+            }
</a><a href="#h2-0-439" id="h2-0-439" class="i">+        }
</a><a href="#h2-0-440" id="h2-0-440" class="i">+
</a><a href="#h2-0-441" id="h2-0-441" class="i">+        LazyColumn(
</a><a href="#h2-0-442" id="h2-0-442" class="i">+            state = scrollState,
</a><a href="#h2-0-443" id="h2-0-443" class="i">+            modifier = Modifier.fillMaxSize()
</a><a href="#h2-0-444" id="h2-0-444" class="i">+        ) {
</a><a href="#h2-0-445" id="h2-0-445" class="i">+            item {
</a><a href="#h2-0-446" id="h2-0-446" class="i">+                if (activeTasks.isEmpty() &amp;&amp; recentTasks.isEmpty()) {
</a><a href="#h2-0-447" id="h2-0-447" class="i">+                    Column(
</a><a href="#h2-0-448" id="h2-0-448" class="i">+                        modifier = Modifier.fillMaxSize(),
</a><a href="#h2-0-449" id="h2-0-449" class="i">+                        horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h2-0-450" id="h2-0-450" class="i">+                        verticalArrangement = Arrangement.Center
</a><a href="#h2-0-451" id="h2-0-451" class="i">+                    ) {
</a><a href="#h2-0-452" id="h2-0-452" class="i">+                        translation[&quot;no_tasks&quot;].let {
</a><a href="#h2-0-453" id="h2-0-453" class="i">+                            Icon(Icons.Filled.CheckCircle, contentDescription = it, tint = MaterialTheme.colorScheme.primary)
</a><a href="#h2-0-454" id="h2-0-454" class="i">+                            Text(it, style = MaterialTheme.typography.bodyLarge)
</a><a href="#h2-0-455" id="h2-0-455" class="i">+                        }
</a><a href="#h2-0-456" id="h2-0-456" class="i">+                    }
</a><a href="#h2-0-457" id="h2-0-457" class="i">+                }
</a><a href="#h2-0-458" id="h2-0-458" class="i">+            }
</a><a href="#h2-0-459" id="h2-0-459" class="i">+            items(activeTasks, key = { it.taskId }) {pendingTask -&gt;
</a><a href="#h2-0-460" id="h2-0-460" class="i">+                TaskCard(modifier = Modifier.padding(8.dp), pendingTask.task, pendingTask = pendingTask)
</a><a href="#h2-0-461" id="h2-0-461" class="i">+            }
</a><a href="#h2-0-462" id="h2-0-462" class="i">+            items(recentTasks, key = { it.hash }) { task -&gt;
</a><a href="#h2-0-463" id="h2-0-463" class="i">+                TaskCard(modifier = Modifier.padding(8.dp), task)
</a><a href="#h2-0-464" id="h2-0-464" class="i">+            }
</a><a href="#h2-0-465" id="h2-0-465" class="i">+            item {
</a><a href="#h2-0-466" id="h2-0-466" class="i">+                Spacer(modifier = Modifier.height(20.dp))
</a><a href="#h2-0-467" id="h2-0-467" class="i">+                LaunchedEffect(remember { derivedStateOf { scrollState.firstVisibleItemIndex } }) {
</a><a href="#h2-0-468" id="h2-0-468" class="i">+                    fetchNewRecentTasks()
</a><a href="#h2-0-469" id="h2-0-469" class="i">+                }
</a><a href="#h2-0-470" id="h2-0-470" class="i">+            }
</a><a href="#h2-0-471" id="h2-0-471" class="i">+        }
</a><a href="#h2-0-472" id="h2-0-472" class="i">+    }
</a><a href="#h2-0-473" id="h2-0-473" class="i">+}</a><a href="#h2-0-474" id="h2-0-474" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRoot.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRoot.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -1,707 +0,0 @@
</a><a href="#h3-0-0" id="h3-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.pages.features
</a><a href="#h3-0-1" id="h3-0-1" class="d">-
</a><a href="#h3-0-2" id="h3-0-2" class="d">-import android.content.Intent
</a><a href="#h3-0-3" id="h3-0-3" class="d">-import android.net.Uri
</a><a href="#h3-0-4" id="h3-0-4" class="d">-import androidx.compose.animation.AnimatedContentTransitionScope
</a><a href="#h3-0-5" id="h3-0-5" class="d">-import androidx.compose.animation.core.tween
</a><a href="#h3-0-6" id="h3-0-6" class="d">-import androidx.compose.foundation.background
</a><a href="#h3-0-7" id="h3-0-7" class="d">-import androidx.compose.foundation.border
</a><a href="#h3-0-8" id="h3-0-8" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h3-0-9" id="h3-0-9" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h3-0-10" id="h3-0-10" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h3-0-11" id="h3-0-11" class="d">-import androidx.compose.foundation.lazy.items
</a><a href="#h3-0-12" id="h3-0-12" class="d">-import androidx.compose.foundation.shape.RoundedCornerShape
</a><a href="#h3-0-13" id="h3-0-13" class="d">-import androidx.compose.foundation.text.KeyboardActions
</a><a href="#h3-0-14" id="h3-0-14" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h3-0-15" id="h3-0-15" class="d">-import androidx.compose.material.icons.automirrored.filled.OpenInNew
</a><a href="#h3-0-16" id="h3-0-16" class="d">-import androidx.compose.material.icons.filled.*
</a><a href="#h3-0-17" id="h3-0-17" class="d">-import androidx.compose.material3.*
</a><a href="#h3-0-18" id="h3-0-18" class="d">-import androidx.compose.runtime.*
</a><a href="#h3-0-19" id="h3-0-19" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h3-0-20" id="h3-0-20" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h3-0-21" id="h3-0-21" class="d">-import androidx.compose.ui.draw.clip
</a><a href="#h3-0-22" id="h3-0-22" class="d">-import androidx.compose.ui.focus.FocusRequester
</a><a href="#h3-0-23" id="h3-0-23" class="d">-import androidx.compose.ui.focus.focusRequester
</a><a href="#h3-0-24" id="h3-0-24" class="d">-import androidx.compose.ui.graphics.Color
</a><a href="#h3-0-25" id="h3-0-25" class="d">-import androidx.compose.ui.text.font.FontWeight
</a><a href="#h3-0-26" id="h3-0-26" class="d">-import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h3-0-27" id="h3-0-27" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h3-0-28" id="h3-0-28" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h3-0-29" id="h3-0-29" class="d">-import androidx.lifecycle.Lifecycle
</a><a href="#h3-0-30" id="h3-0-30" class="d">-import androidx.navigation.NavBackStackEntry
</a><a href="#h3-0-31" id="h3-0-31" class="d">-import androidx.navigation.NavGraph.Companion.findStartDestination
</a><a href="#h3-0-32" id="h3-0-32" class="d">-import androidx.navigation.NavGraphBuilder
</a><a href="#h3-0-33" id="h3-0-33" class="d">-import androidx.navigation.NavOptions
</a><a href="#h3-0-34" id="h3-0-34" class="d">-import androidx.navigation.compose.composable
</a><a href="#h3-0-35" id="h3-0-35" class="d">-import com.github.skydoves.colorpicker.compose.AlphaTile
</a><a href="#h3-0-36" id="h3-0-36" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h3-0-37" id="h3-0-37" class="d">-import kotlinx.coroutines.Job
</a><a href="#h3-0-38" id="h3-0-38" class="d">-import kotlinx.coroutines.delay
</a><a href="#h3-0-39" id="h3-0-39" class="d">-import kotlinx.coroutines.launch
</a><a href="#h3-0-40" id="h3-0-40" class="d">-import me.rhunk.snapenhance.common.config.*
</a><a href="#h3-0-41" id="h3-0-41" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h3-0-42" id="h3-0-42" class="d">-import me.rhunk.snapenhance.ui.manager.MainActivity
</a><a href="#h3-0-43" id="h3-0-43" class="d">-import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h3-0-44" id="h3-0-44" class="d">-import me.rhunk.snapenhance.ui.util.*
</a><a href="#h3-0-45" id="h3-0-45" class="d">-
</a><a href="#h3-0-46" id="h3-0-46" class="d">-class FeaturesRoot : Routes.Route() {
</a><a href="#h3-0-47" id="h3-0-47" class="d">-    private val alertDialogs by lazy { AlertDialogs(context.translation) }
</a><a href="#h3-0-48" id="h3-0-48" class="d">-
</a><a href="#h3-0-49" id="h3-0-49" class="d">-    companion object {
</a><a href="#h3-0-50" id="h3-0-50" class="d">-        const val FEATURE_CONTAINER_ROUTE = &quot;feature_container/{name}&quot;
</a><a href="#h3-0-51" id="h3-0-51" class="d">-        const val SEARCH_FEATURE_ROUTE = &quot;search_feature/{keyword}&quot;
</a><a href="#h3-0-52" id="h3-0-52" class="d">-    }
</a><a href="#h3-0-53" id="h3-0-53" class="d">-
</a><a href="#h3-0-54" id="h3-0-54" class="d">-    private var activityLauncherHelper: ActivityLauncherHelper? = null
</a><a href="#h3-0-55" id="h3-0-55" class="d">-
</a><a href="#h3-0-56" id="h3-0-56" class="d">-    private val allContainers by lazy {
</a><a href="#h3-0-57" id="h3-0-57" class="d">-        val containers = mutableMapOf&lt;String, PropertyPair&lt;*&gt;&gt;()
</a><a href="#h3-0-58" id="h3-0-58" class="d">-        fun queryContainerRecursive(container: ConfigContainer) {
</a><a href="#h3-0-59" id="h3-0-59" class="d">-            container.properties.forEach {
</a><a href="#h3-0-60" id="h3-0-60" class="d">-                if (it.key.dataType.type == DataProcessors.Type.CONTAINER) {
</a><a href="#h3-0-61" id="h3-0-61" class="d">-                    containers[it.key.name] = PropertyPair(it.key, it.value)
</a><a href="#h3-0-62" id="h3-0-62" class="d">-                    queryContainerRecursive(it.value.get() as ConfigContainer)
</a><a href="#h3-0-63" id="h3-0-63" class="d">-                }
</a><a href="#h3-0-64" id="h3-0-64" class="d">-            }
</a><a href="#h3-0-65" id="h3-0-65" class="d">-        }
</a><a href="#h3-0-66" id="h3-0-66" class="d">-        queryContainerRecursive(context.config.root)
</a><a href="#h3-0-67" id="h3-0-67" class="d">-        containers
</a><a href="#h3-0-68" id="h3-0-68" class="d">-    }
</a><a href="#h3-0-69" id="h3-0-69" class="d">-
</a><a href="#h3-0-70" id="h3-0-70" class="d">-    private val allProperties by lazy {
</a><a href="#h3-0-71" id="h3-0-71" class="d">-        val properties = mutableMapOf&lt;PropertyKey&lt;*&gt;, PropertyValue&lt;*&gt;&gt;()
</a><a href="#h3-0-72" id="h3-0-72" class="d">-        allContainers.values.forEach {
</a><a href="#h3-0-73" id="h3-0-73" class="d">-            val container = it.value.get() as ConfigContainer
</a><a href="#h3-0-74" id="h3-0-74" class="d">-            container.properties.forEach { property -&gt;
</a><a href="#h3-0-75" id="h3-0-75" class="d">-                properties[property.key] = property.value
</a><a href="#h3-0-76" id="h3-0-76" class="d">-            }
</a><a href="#h3-0-77" id="h3-0-77" class="d">-        }
</a><a href="#h3-0-78" id="h3-0-78" class="d">-        properties
</a><a href="#h3-0-79" id="h3-0-79" class="d">-    }
</a><a href="#h3-0-80" id="h3-0-80" class="d">-
</a><a href="#h3-0-81" id="h3-0-81" class="d">-    private fun navigateToMainRoot() {
</a><a href="#h3-0-82" id="h3-0-82" class="d">-        routes.navController.navigate(routeInfo.id, NavOptions.Builder()
</a><a href="#h3-0-83" id="h3-0-83" class="d">-            .setPopUpTo(routes.navController.graph.findStartDestination().id, false)
</a><a href="#h3-0-84" id="h3-0-84" class="d">-            .setLaunchSingleTop(true)
</a><a href="#h3-0-85" id="h3-0-85" class="d">-            .build()
</a><a href="#h3-0-86" id="h3-0-86" class="d">-        )
</a><a href="#h3-0-87" id="h3-0-87" class="d">-    }
</a><a href="#h3-0-88" id="h3-0-88" class="d">-
</a><a href="#h3-0-89" id="h3-0-89" class="d">-    override val init: () -&gt; Unit = {
</a><a href="#h3-0-90" id="h3-0-90" class="d">-        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h3-0-91" id="h3-0-91" class="d">-    }
</a><a href="#h3-0-92" id="h3-0-92" class="d">-
</a><a href="#h3-0-93" id="h3-0-93" class="d">-    private fun activityLauncher(block: ActivityLauncherHelper.() -&gt; Unit) {
</a><a href="#h3-0-94" id="h3-0-94" class="d">-        activityLauncherHelper?.let(block) ?: run {
</a><a href="#h3-0-95" id="h3-0-95" class="d">-            //open manager if activity launcher is null
</a><a href="#h3-0-96" id="h3-0-96" class="d">-            val intent = Intent(context.androidContext, MainActivity::class.java)
</a><a href="#h3-0-97" id="h3-0-97" class="d">-            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
</a><a href="#h3-0-98" id="h3-0-98" class="d">-            intent.putExtra(&quot;route&quot;, routeInfo.id)
</a><a href="#h3-0-99" id="h3-0-99" class="d">-            context.androidContext.startActivity(intent)
</a><a href="#h3-0-100" id="h3-0-100" class="d">-        }
</a><a href="#h3-0-101" id="h3-0-101" class="d">-    }
</a><a href="#h3-0-102" id="h3-0-102" class="d">-
</a><a href="#h3-0-103" id="h3-0-103" class="d">-    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h3-0-104" id="h3-0-104" class="d">-        Container(context.config.root)
</a><a href="#h3-0-105" id="h3-0-105" class="d">-    }
</a><a href="#h3-0-106" id="h3-0-106" class="d">-
</a><a href="#h3-0-107" id="h3-0-107" class="d">-    override val customComposables: NavGraphBuilder.() -&gt; Unit = {
</a><a href="#h3-0-108" id="h3-0-108" class="d">-        routeInfo.childIds.addAll(listOf(FEATURE_CONTAINER_ROUTE, SEARCH_FEATURE_ROUTE))
</a><a href="#h3-0-109" id="h3-0-109" class="d">-
</a><a href="#h3-0-110" id="h3-0-110" class="d">-        composable(FEATURE_CONTAINER_ROUTE, enterTransition = {
</a><a href="#h3-0-111" id="h3-0-111" class="d">-            slideIntoContainer(AnimatedContentTransitionScope.SlideDirection.Left, animationSpec = tween(100))
</a><a href="#h3-0-112" id="h3-0-112" class="d">-        }, exitTransition = {
</a><a href="#h3-0-113" id="h3-0-113" class="d">-            slideOutOfContainer(AnimatedContentTransitionScope.SlideDirection.Right, animationSpec = tween(300))
</a><a href="#h3-0-114" id="h3-0-114" class="d">-        }) { backStackEntry -&gt;
</a><a href="#h3-0-115" id="h3-0-115" class="d">-            backStackEntry.arguments?.getString(&quot;name&quot;)?.let { containerName -&gt;
</a><a href="#h3-0-116" id="h3-0-116" class="d">-                allContainers[containerName]?.let {
</a><a href="#h3-0-117" id="h3-0-117" class="d">-                    Container(it.value.get() as ConfigContainer)
</a><a href="#h3-0-118" id="h3-0-118" class="d">-                }
</a><a href="#h3-0-119" id="h3-0-119" class="d">-            }
</a><a href="#h3-0-120" id="h3-0-120" class="d">-        }
</a><a href="#h3-0-121" id="h3-0-121" class="d">-
</a><a href="#h3-0-122" id="h3-0-122" class="d">-        composable(SEARCH_FEATURE_ROUTE) { backStackEntry -&gt;
</a><a href="#h3-0-123" id="h3-0-123" class="d">-            backStackEntry.arguments?.getString(&quot;keyword&quot;)?.let { keyword -&gt;
</a><a href="#h3-0-124" id="h3-0-124" class="d">-                val properties = allProperties.filter {
</a><a href="#h3-0-125" id="h3-0-125" class="d">-                    it.key.name.contains(keyword, ignoreCase = true) ||
</a><a href="#h3-0-126" id="h3-0-126" class="d">-                            context.translation[it.key.propertyName()].contains(keyword, ignoreCase = true) ||
</a><a href="#h3-0-127" id="h3-0-127" class="d">-                            context.translation[it.key.propertyDescription()].contains(keyword, ignoreCase = true)
</a><a href="#h3-0-128" id="h3-0-128" class="d">-                }.map { PropertyPair(it.key, it.value) }
</a><a href="#h3-0-129" id="h3-0-129" class="d">-
</a><a href="#h3-0-130" id="h3-0-130" class="d">-                PropertiesView(properties)
</a><a href="#h3-0-131" id="h3-0-131" class="d">-            }
</a><a href="#h3-0-132" id="h3-0-132" class="d">-        }
</a><a href="#h3-0-133" id="h3-0-133" class="d">-    }
</a><a href="#h3-0-134" id="h3-0-134" class="d">-
</a><a href="#h3-0-135" id="h3-0-135" class="d">-    @Composable
</a><a href="#h3-0-136" id="h3-0-136" class="d">-    private fun PropertyAction(property: PropertyPair&lt;*&gt;, registerClickCallback: RegisterClickCallback) {
</a><a href="#h3-0-137" id="h3-0-137" class="d">-        var showDialog by remember { mutableStateOf(false) }
</a><a href="#h3-0-138" id="h3-0-138" class="d">-        var dialogComposable by remember { mutableStateOf&lt;@Composable () -&gt; Unit&gt;({}) }
</a><a href="#h3-0-139" id="h3-0-139" class="d">-
</a><a href="#h3-0-140" id="h3-0-140" class="d">-        fun registerDialogOnClickCallback() = registerClickCallback { showDialog = true }
</a><a href="#h3-0-141" id="h3-0-141" class="d">-
</a><a href="#h3-0-142" id="h3-0-142" class="d">-        if (showDialog) {
</a><a href="#h3-0-143" id="h3-0-143" class="d">-            Dialog(
</a><a href="#h3-0-144" id="h3-0-144" class="d">-                properties = DialogProperties(
</a><a href="#h3-0-145" id="h3-0-145" class="d">-                    usePlatformDefaultWidth = false
</a><a href="#h3-0-146" id="h3-0-146" class="d">-                ),
</a><a href="#h3-0-147" id="h3-0-147" class="d">-                onDismissRequest = { showDialog = false },
</a><a href="#h3-0-148" id="h3-0-148" class="d">-            ) {
</a><a href="#h3-0-149" id="h3-0-149" class="d">-                dialogComposable()
</a><a href="#h3-0-150" id="h3-0-150" class="d">-            }
</a><a href="#h3-0-151" id="h3-0-151" class="d">-        }
</a><a href="#h3-0-152" id="h3-0-152" class="d">-
</a><a href="#h3-0-153" id="h3-0-153" class="d">-        val propertyValue = property.value
</a><a href="#h3-0-154" id="h3-0-154" class="d">-
</a><a href="#h3-0-155" id="h3-0-155" class="d">-        if (property.key.params.flags.contains(ConfigFlag.USER_IMPORT)) {
</a><a href="#h3-0-156" id="h3-0-156" class="d">-            registerDialogOnClickCallback()
</a><a href="#h3-0-157" id="h3-0-157" class="d">-            dialogComposable = {
</a><a href="#h3-0-158" id="h3-0-158" class="d">-                var isEmpty by remember { mutableStateOf(false) }
</a><a href="#h3-0-159" id="h3-0-159" class="d">-                val files = rememberAsyncMutableStateList(defaultValue = listOf()) {
</a><a href="#h3-0-160" id="h3-0-160" class="d">-                    context.fileHandleManager.getStoredFiles {
</a><a href="#h3-0-161" id="h3-0-161" class="d">-                        property.key.params.filenameFilter?.invoke(it.name) == true
</a><a href="#h3-0-162" id="h3-0-162" class="d">-                    }.also {
</a><a href="#h3-0-163" id="h3-0-163" class="d">-                        isEmpty = it.isEmpty()
</a><a href="#h3-0-164" id="h3-0-164" class="d">-                        if (isEmpty) {
</a><a href="#h3-0-165" id="h3-0-165" class="d">-                            propertyValue.setAny(null)
</a><a href="#h3-0-166" id="h3-0-166" class="d">-                        }
</a><a href="#h3-0-167" id="h3-0-167" class="d">-                    }
</a><a href="#h3-0-168" id="h3-0-168" class="d">-                }
</a><a href="#h3-0-169" id="h3-0-169" class="d">-                var selectedFile by remember(files.size) { mutableStateOf(files.firstOrNull { it.name == propertyValue.getNullable() }.also {
</a><a href="#h3-0-170" id="h3-0-170" class="d">-                    if (files.isNotEmpty() &amp;&amp; it == null) propertyValue.setAny(null)
</a><a href="#h3-0-171" id="h3-0-171" class="d">-                }?.name) }
</a><a href="#h3-0-172" id="h3-0-172" class="d">-
</a><a href="#h3-0-173" id="h3-0-173" class="d">-                Card(
</a><a href="#h3-0-174" id="h3-0-174" class="d">-                    shape = MaterialTheme.shapes.large,
</a><a href="#h3-0-175" id="h3-0-175" class="d">-                    modifier = Modifier
</a><a href="#h3-0-176" id="h3-0-176" class="d">-                        .fillMaxWidth(),
</a><a href="#h3-0-177" id="h3-0-177" class="d">-                ) {
</a><a href="#h3-0-178" id="h3-0-178" class="d">-                    LazyColumn(
</a><a href="#h3-0-179" id="h3-0-179" class="d">-                        modifier = Modifier.fillMaxWidth().padding(4.dp),
</a><a href="#h3-0-180" id="h3-0-180" class="d">-                    ) {
</a><a href="#h3-0-181" id="h3-0-181" class="d">-                        item {
</a><a href="#h3-0-182" id="h3-0-182" class="d">-                            Column(
</a><a href="#h3-0-183" id="h3-0-183" class="d">-                                modifier = Modifier.fillMaxWidth().padding(16.dp),
</a><a href="#h3-0-184" id="h3-0-184" class="d">-                                horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h3-0-185" id="h3-0-185" class="d">-                            ) {
</a><a href="#h3-0-186" id="h3-0-186" class="d">-                                Text(
</a><a href="#h3-0-187" id="h3-0-187" class="d">-                                    text = context.translation[&quot;manager.dialogs.file_imports.settings_select_file_hint&quot;],
</a><a href="#h3-0-188" id="h3-0-188" class="d">-                                    fontSize = 18.sp,
</a><a href="#h3-0-189" id="h3-0-189" class="d">-                                    fontWeight = FontWeight.Bold,
</a><a href="#h3-0-190" id="h3-0-190" class="d">-                                )
</a><a href="#h3-0-191" id="h3-0-191" class="d">-                                if (isEmpty) {
</a><a href="#h3-0-192" id="h3-0-192" class="d">-                                    Text(
</a><a href="#h3-0-193" id="h3-0-193" class="d">-                                        text = context.translation[&quot;manager.dialogs.file_imports.no_files_settings_hint&quot;],
</a><a href="#h3-0-194" id="h3-0-194" class="d">-                                        fontSize = 16.sp,
</a><a href="#h3-0-195" id="h3-0-195" class="d">-                                        modifier = Modifier.padding(top = 10.dp),
</a><a href="#h3-0-196" id="h3-0-196" class="d">-                                    )
</a><a href="#h3-0-197" id="h3-0-197" class="d">-                                }
</a><a href="#h3-0-198" id="h3-0-198" class="d">-                            }
</a><a href="#h3-0-199" id="h3-0-199" class="d">-                        }
</a><a href="#h3-0-200" id="h3-0-200" class="d">-                        items(files, key = { it.name }) { file -&gt;
</a><a href="#h3-0-201" id="h3-0-201" class="d">-                            Row(
</a><a href="#h3-0-202" id="h3-0-202" class="d">-                                modifier = Modifier.clickable {
</a><a href="#h3-0-203" id="h3-0-203" class="d">-                                    selectedFile = if (selectedFile == file.name) null else file.name
</a><a href="#h3-0-204" id="h3-0-204" class="d">-                                    propertyValue.setAny(selectedFile)
</a><a href="#h3-0-205" id="h3-0-205" class="d">-                                }.padding(5.dp),
</a><a href="#h3-0-206" id="h3-0-206" class="d">-                                verticalAlignment = Alignment.CenterVertically
</a><a href="#h3-0-207" id="h3-0-207" class="d">-                            ) {
</a><a href="#h3-0-208" id="h3-0-208" class="d">-                                Icon(Icons.Filled.AttachFile, contentDescription = null, modifier = Modifier.padding(5.dp))
</a><a href="#h3-0-209" id="h3-0-209" class="d">-                                Text(
</a><a href="#h3-0-210" id="h3-0-210" class="d">-                                    text = file.name,
</a><a href="#h3-0-211" id="h3-0-211" class="d">-                                    modifier = Modifier
</a><a href="#h3-0-212" id="h3-0-212" class="d">-                                        .padding(3.dp)
</a><a href="#h3-0-213" id="h3-0-213" class="d">-                                        .weight(1f),
</a><a href="#h3-0-214" id="h3-0-214" class="d">-                                    fontSize = 14.sp,
</a><a href="#h3-0-215" id="h3-0-215" class="d">-                                    lineHeight = 16.sp
</a><a href="#h3-0-216" id="h3-0-216" class="d">-                                )
</a><a href="#h3-0-217" id="h3-0-217" class="d">-                                if (selectedFile == file.name) {
</a><a href="#h3-0-218" id="h3-0-218" class="d">-                                    Icon(Icons.Filled.Check, contentDescription = null, modifier = Modifier.padding(5.dp))
</a><a href="#h3-0-219" id="h3-0-219" class="d">-                                }
</a><a href="#h3-0-220" id="h3-0-220" class="d">-                            }
</a><a href="#h3-0-221" id="h3-0-221" class="d">-                        }
</a><a href="#h3-0-222" id="h3-0-222" class="d">-                    }
</a><a href="#h3-0-223" id="h3-0-223" class="d">-                }
</a><a href="#h3-0-224" id="h3-0-224" class="d">-            }
</a><a href="#h3-0-225" id="h3-0-225" class="d">-
</a><a href="#h3-0-226" id="h3-0-226" class="d">-            Icon(Icons.Filled.AttachFile, contentDescription = null)
</a><a href="#h3-0-227" id="h3-0-227" class="d">-            return
</a><a href="#h3-0-228" id="h3-0-228" class="d">-        }
</a><a href="#h3-0-229" id="h3-0-229" class="d">-
</a><a href="#h3-0-230" id="h3-0-230" class="d">-        if (property.key.params.flags.contains(ConfigFlag.FOLDER)) {
</a><a href="#h3-0-231" id="h3-0-231" class="d">-            IconButton(onClick = registerClickCallback {
</a><a href="#h3-0-232" id="h3-0-232" class="d">-                activityLauncher {
</a><a href="#h3-0-233" id="h3-0-233" class="d">-                    chooseFolder { uri -&gt;
</a><a href="#h3-0-234" id="h3-0-234" class="d">-                        propertyValue.setAny(uri)
</a><a href="#h3-0-235" id="h3-0-235" class="d">-                    }
</a><a href="#h3-0-236" id="h3-0-236" class="d">-                }
</a><a href="#h3-0-237" id="h3-0-237" class="d">-            }.let { { it.invoke(true) } }) {
</a><a href="#h3-0-238" id="h3-0-238" class="d">-                Icon(Icons.Filled.FolderOpen, contentDescription = null)
</a><a href="#h3-0-239" id="h3-0-239" class="d">-            }
</a><a href="#h3-0-240" id="h3-0-240" class="d">-            return
</a><a href="#h3-0-241" id="h3-0-241" class="d">-        }
</a><a href="#h3-0-242" id="h3-0-242" class="d">-
</a><a href="#h3-0-243" id="h3-0-243" class="d">-        when (val dataType = remember { property.key.dataType.type }) {
</a><a href="#h3-0-244" id="h3-0-244" class="d">-            DataProcessors.Type.BOOLEAN -&gt; {
</a><a href="#h3-0-245" id="h3-0-245" class="d">-                var state by remember { mutableStateOf(propertyValue.get() as Boolean) }
</a><a href="#h3-0-246" id="h3-0-246" class="d">-                Switch(
</a><a href="#h3-0-247" id="h3-0-247" class="d">-                    checked = state,
</a><a href="#h3-0-248" id="h3-0-248" class="d">-                    onCheckedChange = registerClickCallback {
</a><a href="#h3-0-249" id="h3-0-249" class="d">-                        state = state.not()
</a><a href="#h3-0-250" id="h3-0-250" class="d">-                        propertyValue.setAny(state)
</a><a href="#h3-0-251" id="h3-0-251" class="d">-                    }
</a><a href="#h3-0-252" id="h3-0-252" class="d">-                )
</a><a href="#h3-0-253" id="h3-0-253" class="d">-            }
</a><a href="#h3-0-254" id="h3-0-254" class="d">-
</a><a href="#h3-0-255" id="h3-0-255" class="d">-            DataProcessors.Type.MAP_COORDINATES -&gt; {
</a><a href="#h3-0-256" id="h3-0-256" class="d">-                registerDialogOnClickCallback()
</a><a href="#h3-0-257" id="h3-0-257" class="d">-                dialogComposable = {
</a><a href="#h3-0-258" id="h3-0-258" class="d">-                    alertDialogs.ChooseLocationDialog(property) {
</a><a href="#h3-0-259" id="h3-0-259" class="d">-                        showDialog = false
</a><a href="#h3-0-260" id="h3-0-260" class="d">-                    }
</a><a href="#h3-0-261" id="h3-0-261" class="d">-                }
</a><a href="#h3-0-262" id="h3-0-262" class="d">-
</a><a href="#h3-0-263" id="h3-0-263" class="d">-                Text(
</a><a href="#h3-0-264" id="h3-0-264" class="d">-                    overflow = TextOverflow.Ellipsis,
</a><a href="#h3-0-265" id="h3-0-265" class="d">-                    maxLines = 1,
</a><a href="#h3-0-266" id="h3-0-266" class="d">-                    modifier = Modifier.widthIn(0.dp, 120.dp),
</a><a href="#h3-0-267" id="h3-0-267" class="d">-                    text = (propertyValue.get() as Pair&lt;*, *&gt;).let {
</a><a href="#h3-0-268" id="h3-0-268" class="d">-                        &quot;${it.first.toString().toFloatOrNull() ?: 0F}, ${it.second.toString().toFloatOrNull() ?: 0F}&quot;
</a><a href="#h3-0-269" id="h3-0-269" class="d">-                    }
</a><a href="#h3-0-270" id="h3-0-270" class="d">-                )
</a><a href="#h3-0-271" id="h3-0-271" class="d">-            }
</a><a href="#h3-0-272" id="h3-0-272" class="d">-
</a><a href="#h3-0-273" id="h3-0-273" class="d">-            DataProcessors.Type.STRING_UNIQUE_SELECTION -&gt; {
</a><a href="#h3-0-274" id="h3-0-274" class="d">-                registerDialogOnClickCallback()
</a><a href="#h3-0-275" id="h3-0-275" class="d">-
</a><a href="#h3-0-276" id="h3-0-276" class="d">-                dialogComposable = {
</a><a href="#h3-0-277" id="h3-0-277" class="d">-                    alertDialogs.UniqueSelectionDialog(property)
</a><a href="#h3-0-278" id="h3-0-278" class="d">-                }
</a><a href="#h3-0-279" id="h3-0-279" class="d">-
</a><a href="#h3-0-280" id="h3-0-280" class="d">-                Text(
</a><a href="#h3-0-281" id="h3-0-281" class="d">-                    overflow = TextOverflow.Ellipsis,
</a><a href="#h3-0-282" id="h3-0-282" class="d">-                    maxLines = 1,
</a><a href="#h3-0-283" id="h3-0-283" class="d">-                    modifier = Modifier.widthIn(0.dp, 120.dp),
</a><a href="#h3-0-284" id="h3-0-284" class="d">-                    text = (propertyValue.getNullable() as? String ?: &quot;null&quot;).let {
</a><a href="#h3-0-285" id="h3-0-285" class="d">-                        property.key.propertyOption(context.translation, it)
</a><a href="#h3-0-286" id="h3-0-286" class="d">-                    }
</a><a href="#h3-0-287" id="h3-0-287" class="d">-                )
</a><a href="#h3-0-288" id="h3-0-288" class="d">-            }
</a><a href="#h3-0-289" id="h3-0-289" class="d">-
</a><a href="#h3-0-290" id="h3-0-290" class="d">-            DataProcessors.Type.STRING_MULTIPLE_SELECTION, DataProcessors.Type.STRING, DataProcessors.Type.INTEGER, DataProcessors.Type.FLOAT -&gt; {
</a><a href="#h3-0-291" id="h3-0-291" class="d">-                dialogComposable = {
</a><a href="#h3-0-292" id="h3-0-292" class="d">-                    when (dataType) {
</a><a href="#h3-0-293" id="h3-0-293" class="d">-                        DataProcessors.Type.STRING_MULTIPLE_SELECTION -&gt; {
</a><a href="#h3-0-294" id="h3-0-294" class="d">-                            alertDialogs.MultipleSelectionDialog(property)
</a><a href="#h3-0-295" id="h3-0-295" class="d">-                        }
</a><a href="#h3-0-296" id="h3-0-296" class="d">-                        DataProcessors.Type.STRING, DataProcessors.Type.INTEGER, DataProcessors.Type.FLOAT -&gt; {
</a><a href="#h3-0-297" id="h3-0-297" class="d">-                            alertDialogs.KeyboardInputDialog(property) { showDialog = false }
</a><a href="#h3-0-298" id="h3-0-298" class="d">-                        }
</a><a href="#h3-0-299" id="h3-0-299" class="d">-                        else -&gt; {}
</a><a href="#h3-0-300" id="h3-0-300" class="d">-                    }
</a><a href="#h3-0-301" id="h3-0-301" class="d">-                }
</a><a href="#h3-0-302" id="h3-0-302" class="d">-
</a><a href="#h3-0-303" id="h3-0-303" class="d">-                registerDialogOnClickCallback().let { { it.invoke(true) } }.also {
</a><a href="#h3-0-304" id="h3-0-304" class="d">-                    if (dataType == DataProcessors.Type.INTEGER ||
</a><a href="#h3-0-305" id="h3-0-305" class="d">-                        dataType == DataProcessors.Type.FLOAT) {
</a><a href="#h3-0-306" id="h3-0-306" class="d">-                        FilledIconButton(onClick = it) {
</a><a href="#h3-0-307" id="h3-0-307" class="d">-                            Text(
</a><a href="#h3-0-308" id="h3-0-308" class="d">-                                text = propertyValue.get().toString(),
</a><a href="#h3-0-309" id="h3-0-309" class="d">-                                modifier = Modifier.wrapContentWidth(),
</a><a href="#h3-0-310" id="h3-0-310" class="d">-                                overflow = TextOverflow.Ellipsis
</a><a href="#h3-0-311" id="h3-0-311" class="d">-                            )
</a><a href="#h3-0-312" id="h3-0-312" class="d">-                        }
</a><a href="#h3-0-313" id="h3-0-313" class="d">-                    } else {
</a><a href="#h3-0-314" id="h3-0-314" class="d">-                        IconButton(onClick = it) {
</a><a href="#h3-0-315" id="h3-0-315" class="d">-                            Icon(Icons.AutoMirrored.Filled.OpenInNew, contentDescription = null)
</a><a href="#h3-0-316" id="h3-0-316" class="d">-                        }
</a><a href="#h3-0-317" id="h3-0-317" class="d">-                    }
</a><a href="#h3-0-318" id="h3-0-318" class="d">-                }
</a><a href="#h3-0-319" id="h3-0-319" class="d">-            }
</a><a href="#h3-0-320" id="h3-0-320" class="d">-
</a><a href="#h3-0-321" id="h3-0-321" class="d">-            DataProcessors.Type.INT_COLOR -&gt; {
</a><a href="#h3-0-322" id="h3-0-322" class="d">-                dialogComposable = {
</a><a href="#h3-0-323" id="h3-0-323" class="d">-                    alertDialogs.ColorPickerDialog(property) {
</a><a href="#h3-0-324" id="h3-0-324" class="d">-                        showDialog = false
</a><a href="#h3-0-325" id="h3-0-325" class="d">-                    }
</a><a href="#h3-0-326" id="h3-0-326" class="d">-                }
</a><a href="#h3-0-327" id="h3-0-327" class="d">-
</a><a href="#h3-0-328" id="h3-0-328" class="d">-                registerDialogOnClickCallback().let { { it.invoke(true) } }.also {
</a><a href="#h3-0-329" id="h3-0-329" class="d">-                    val selectedColor = (propertyValue.getNullable() as? Int)?.let { Color(it) }
</a><a href="#h3-0-330" id="h3-0-330" class="d">-                    AlphaTile(
</a><a href="#h3-0-331" id="h3-0-331" class="d">-                        modifier = Modifier
</a><a href="#h3-0-332" id="h3-0-332" class="d">-                            .size(30.dp)
</a><a href="#h3-0-333" id="h3-0-333" class="d">-                            .border(2.dp, Color.White, shape = RoundedCornerShape(15.dp))
</a><a href="#h3-0-334" id="h3-0-334" class="d">-                            .clip(RoundedCornerShape(15.dp)),
</a><a href="#h3-0-335" id="h3-0-335" class="d">-                        selectedColor = selectedColor ?: Color.Transparent,
</a><a href="#h3-0-336" id="h3-0-336" class="d">-                        tileEvenColor = selectedColor?.let { Color(0xFFCBCBCB) } ?: Color.Transparent,
</a><a href="#h3-0-337" id="h3-0-337" class="d">-                        tileOddColor = selectedColor?.let { Color.White } ?: Color.Transparent,
</a><a href="#h3-0-338" id="h3-0-338" class="d">-                        tileSize = 8.dp,
</a><a href="#h3-0-339" id="h3-0-339" class="d">-                    )
</a><a href="#h3-0-340" id="h3-0-340" class="d">-                }
</a><a href="#h3-0-341" id="h3-0-341" class="d">-            }
</a><a href="#h3-0-342" id="h3-0-342" class="d">-
</a><a href="#h3-0-343" id="h3-0-343" class="d">-            DataProcessors.Type.CONTAINER -&gt; {
</a><a href="#h3-0-344" id="h3-0-344" class="d">-                val container = propertyValue.get() as ConfigContainer
</a><a href="#h3-0-345" id="h3-0-345" class="d">-
</a><a href="#h3-0-346" id="h3-0-346" class="d">-                registerClickCallback {
</a><a href="#h3-0-347" id="h3-0-347" class="d">-                    routes.navController.navigate(FEATURE_CONTAINER_ROUTE.replace(&quot;{name}&quot;, property.name))
</a><a href="#h3-0-348" id="h3-0-348" class="d">-                }
</a><a href="#h3-0-349" id="h3-0-349" class="d">-
</a><a href="#h3-0-350" id="h3-0-350" class="d">-                if (!container.hasGlobalState) return
</a><a href="#h3-0-351" id="h3-0-351" class="d">-
</a><a href="#h3-0-352" id="h3-0-352" class="d">-                var state by remember { mutableStateOf(container.globalState ?: false) }
</a><a href="#h3-0-353" id="h3-0-353" class="d">-
</a><a href="#h3-0-354" id="h3-0-354" class="d">-                Box(
</a><a href="#h3-0-355" id="h3-0-355" class="d">-                    modifier = Modifier
</a><a href="#h3-0-356" id="h3-0-356" class="d">-                        .padding(end = 15.dp),
</a><a href="#h3-0-357" id="h3-0-357" class="d">-                ) {
</a><a href="#h3-0-358" id="h3-0-358" class="d">-
</a><a href="#h3-0-359" id="h3-0-359" class="d">-                    Box(modifier = Modifier
</a><a href="#h3-0-360" id="h3-0-360" class="d">-                        .height(50.dp)
</a><a href="#h3-0-361" id="h3-0-361" class="d">-                        .width(1.dp)
</a><a href="#h3-0-362" id="h3-0-362" class="d">-                        .background(
</a><a href="#h3-0-363" id="h3-0-363" class="d">-                            color = MaterialTheme.colorScheme.primary.copy(alpha = 0.12f),
</a><a href="#h3-0-364" id="h3-0-364" class="d">-                            shape = RoundedCornerShape(5.dp)
</a><a href="#h3-0-365" id="h3-0-365" class="d">-                        ))
</a><a href="#h3-0-366" id="h3-0-366" class="d">-                }
</a><a href="#h3-0-367" id="h3-0-367" class="d">-
</a><a href="#h3-0-368" id="h3-0-368" class="d">-                Switch(
</a><a href="#h3-0-369" id="h3-0-369" class="d">-                    checked = state,
</a><a href="#h3-0-370" id="h3-0-370" class="d">-                    onCheckedChange = {
</a><a href="#h3-0-371" id="h3-0-371" class="d">-                        state = state.not()
</a><a href="#h3-0-372" id="h3-0-372" class="d">-                        container.globalState = state
</a><a href="#h3-0-373" id="h3-0-373" class="d">-                    }
</a><a href="#h3-0-374" id="h3-0-374" class="d">-                )
</a><a href="#h3-0-375" id="h3-0-375" class="d">-            }
</a><a href="#h3-0-376" id="h3-0-376" class="d">-        }
</a><a href="#h3-0-377" id="h3-0-377" class="d">-
</a><a href="#h3-0-378" id="h3-0-378" class="d">-    }
</a><a href="#h3-0-379" id="h3-0-379" class="d">-
</a><a href="#h3-0-380" id="h3-0-380" class="d">-    @Composable
</a><a href="#h3-0-381" id="h3-0-381" class="d">-    private fun PropertyCard(property: PropertyPair&lt;*&gt;) {
</a><a href="#h3-0-382" id="h3-0-382" class="d">-        var clickCallback by remember { mutableStateOf&lt;ClickCallback?&gt;(null) }
</a><a href="#h3-0-383" id="h3-0-383" class="d">-        val noticeColorMap = mapOf(
</a><a href="#h3-0-384" id="h3-0-384" class="d">-            FeatureNotice.UNSTABLE.key to Color(0xFFFFFB87),
</a><a href="#h3-0-385" id="h3-0-385" class="d">-            FeatureNotice.BAN_RISK.key to Color(0xFFFF8585),
</a><a href="#h3-0-386" id="h3-0-386" class="d">-            FeatureNotice.INTERNAL_BEHAVIOR.key to Color(0xFFFFFB87),
</a><a href="#h3-0-387" id="h3-0-387" class="d">-            FeatureNotice.REQUIRE_NATIVE_HOOKS.key to Color(0xFFFF5722),
</a><a href="#h3-0-388" id="h3-0-388" class="d">-        )
</a><a href="#h3-0-389" id="h3-0-389" class="d">-
</a><a href="#h3-0-390" id="h3-0-390" class="d">-        ElevatedCard(
</a><a href="#h3-0-391" id="h3-0-391" class="d">-            modifier = Modifier
</a><a href="#h3-0-392" id="h3-0-392" class="d">-                .fillMaxWidth()
</a><a href="#h3-0-393" id="h3-0-393" class="d">-                .padding(start = 10.dp, end = 10.dp, top = 5.dp, bottom = 5.dp)
</a><a href="#h3-0-394" id="h3-0-394" class="d">-        ) {
</a><a href="#h3-0-395" id="h3-0-395" class="d">-            Row(
</a><a href="#h3-0-396" id="h3-0-396" class="d">-                modifier = Modifier
</a><a href="#h3-0-397" id="h3-0-397" class="d">-                    .fillMaxSize()
</a><a href="#h3-0-398" id="h3-0-398" class="d">-                    .clickable {
</a><a href="#h3-0-399" id="h3-0-399" class="d">-                        clickCallback?.invoke(true)
</a><a href="#h3-0-400" id="h3-0-400" class="d">-                    }
</a><a href="#h3-0-401" id="h3-0-401" class="d">-                    .padding(all = 4.dp),
</a><a href="#h3-0-402" id="h3-0-402" class="d">-                horizontalArrangement = Arrangement.SpaceBetween
</a><a href="#h3-0-403" id="h3-0-403" class="d">-            ) {
</a><a href="#h3-0-404" id="h3-0-404" class="d">-                property.key.params.icon?.let { icon -&gt;
</a><a href="#h3-0-405" id="h3-0-405" class="d">-                    Icon(
</a><a href="#h3-0-406" id="h3-0-406" class="d">-                        imageVector = icon,
</a><a href="#h3-0-407" id="h3-0-407" class="d">-                        contentDescription = null,
</a><a href="#h3-0-408" id="h3-0-408" class="d">-                        modifier = Modifier
</a><a href="#h3-0-409" id="h3-0-409" class="d">-                            .align(Alignment.CenterVertically)
</a><a href="#h3-0-410" id="h3-0-410" class="d">-                            .padding(start = 10.dp)
</a><a href="#h3-0-411" id="h3-0-411" class="d">-                    )
</a><a href="#h3-0-412" id="h3-0-412" class="d">-                }
</a><a href="#h3-0-413" id="h3-0-413" class="d">-
</a><a href="#h3-0-414" id="h3-0-414" class="d">-                Column(
</a><a href="#h3-0-415" id="h3-0-415" class="d">-                    modifier = Modifier
</a><a href="#h3-0-416" id="h3-0-416" class="d">-                        .align(Alignment.CenterVertically)
</a><a href="#h3-0-417" id="h3-0-417" class="d">-                        .weight(1f, fill = true)
</a><a href="#h3-0-418" id="h3-0-418" class="d">-                        .padding(all = 10.dp)
</a><a href="#h3-0-419" id="h3-0-419" class="d">-                ) {
</a><a href="#h3-0-420" id="h3-0-420" class="d">-                    Text(
</a><a href="#h3-0-421" id="h3-0-421" class="d">-                        text = context.translation[property.key.propertyName()],
</a><a href="#h3-0-422" id="h3-0-422" class="d">-                        fontSize = 16.sp,
</a><a href="#h3-0-423" id="h3-0-423" class="d">-                        fontWeight = FontWeight.Bold
</a><a href="#h3-0-424" id="h3-0-424" class="d">-                    )
</a><a href="#h3-0-425" id="h3-0-425" class="d">-                    Text(
</a><a href="#h3-0-426" id="h3-0-426" class="d">-                        text = context.translation[property.key.propertyDescription()],
</a><a href="#h3-0-427" id="h3-0-427" class="d">-                        fontSize = 12.sp,
</a><a href="#h3-0-428" id="h3-0-428" class="d">-                        lineHeight = 15.sp
</a><a href="#h3-0-429" id="h3-0-429" class="d">-                    )
</a><a href="#h3-0-430" id="h3-0-430" class="d">-                    property.key.params.notices.also {
</a><a href="#h3-0-431" id="h3-0-431" class="d">-                        if (it.isNotEmpty()) Spacer(modifier = Modifier.height(5.dp))
</a><a href="#h3-0-432" id="h3-0-432" class="d">-                    }.forEach {
</a><a href="#h3-0-433" id="h3-0-433" class="d">-                        Text(
</a><a href="#h3-0-434" id="h3-0-434" class="d">-                            text = context.translation[&quot;features.notices.${it.key}&quot;],
</a><a href="#h3-0-435" id="h3-0-435" class="d">-                            color = noticeColorMap[it.key] ?: Color(0xFFFFFB87),
</a><a href="#h3-0-436" id="h3-0-436" class="d">-                            fontSize = 12.sp,
</a><a href="#h3-0-437" id="h3-0-437" class="d">-                            lineHeight = 15.sp
</a><a href="#h3-0-438" id="h3-0-438" class="d">-                        )
</a><a href="#h3-0-439" id="h3-0-439" class="d">-                    }
</a><a href="#h3-0-440" id="h3-0-440" class="d">-                }
</a><a href="#h3-0-441" id="h3-0-441" class="d">-                Row(
</a><a href="#h3-0-442" id="h3-0-442" class="d">-                    modifier = Modifier
</a><a href="#h3-0-443" id="h3-0-443" class="d">-                        .align(Alignment.CenterVertically)
</a><a href="#h3-0-444" id="h3-0-444" class="d">-                        .padding(all = 10.dp),
</a><a href="#h3-0-445" id="h3-0-445" class="d">-                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h3-0-446" id="h3-0-446" class="d">-                ) {
</a><a href="#h3-0-447" id="h3-0-447" class="d">-                    PropertyAction(property, registerClickCallback = { callback -&gt;
</a><a href="#h3-0-448" id="h3-0-448" class="d">-                        clickCallback = callback
</a><a href="#h3-0-449" id="h3-0-449" class="d">-                        callback
</a><a href="#h3-0-450" id="h3-0-450" class="d">-                    })
</a><a href="#h3-0-451" id="h3-0-451" class="d">-                }
</a><a href="#h3-0-452" id="h3-0-452" class="d">-            }
</a><a href="#h3-0-453" id="h3-0-453" class="d">-        }
</a><a href="#h3-0-454" id="h3-0-454" class="d">-    }
</a><a href="#h3-0-455" id="h3-0-455" class="d">-
</a><a href="#h3-0-456" id="h3-0-456" class="d">-    @Composable
</a><a href="#h3-0-457" id="h3-0-457" class="d">-    private fun FeatureSearchBar(rowScope: RowScope, focusRequester: FocusRequester) {
</a><a href="#h3-0-458" id="h3-0-458" class="d">-        var searchValue by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h3-0-459" id="h3-0-459" class="d">-        val scope = rememberCoroutineScope()
</a><a href="#h3-0-460" id="h3-0-460" class="d">-        var currentSearchJob by remember { mutableStateOf&lt;Job?&gt;(null) }
</a><a href="#h3-0-461" id="h3-0-461" class="d">-
</a><a href="#h3-0-462" id="h3-0-462" class="d">-        rowScope.apply {
</a><a href="#h3-0-463" id="h3-0-463" class="d">-            TextField(
</a><a href="#h3-0-464" id="h3-0-464" class="d">-                value = searchValue,
</a><a href="#h3-0-465" id="h3-0-465" class="d">-                onValueChange = { keyword -&gt;
</a><a href="#h3-0-466" id="h3-0-466" class="d">-                    searchValue = keyword
</a><a href="#h3-0-467" id="h3-0-467" class="d">-                    if (keyword.isEmpty()) {
</a><a href="#h3-0-468" id="h3-0-468" class="d">-                        navigateToMainRoot()
</a><a href="#h3-0-469" id="h3-0-469" class="d">-                        return@TextField
</a><a href="#h3-0-470" id="h3-0-470" class="d">-                    }
</a><a href="#h3-0-471" id="h3-0-471" class="d">-                    currentSearchJob?.cancel()
</a><a href="#h3-0-472" id="h3-0-472" class="d">-                    scope.launch {
</a><a href="#h3-0-473" id="h3-0-473" class="d">-                        delay(150)
</a><a href="#h3-0-474" id="h3-0-474" class="d">-                        routes.navController.navigate(SEARCH_FEATURE_ROUTE.replace(&quot;{keyword}&quot;, keyword), NavOptions.Builder()
</a><a href="#h3-0-475" id="h3-0-475" class="d">-                            .setLaunchSingleTop(true)
</a><a href="#h3-0-476" id="h3-0-476" class="d">-                            .setPopUpTo(routeInfo.id, false)
</a><a href="#h3-0-477" id="h3-0-477" class="d">-                            .build()
</a><a href="#h3-0-478" id="h3-0-478" class="d">-                        )
</a><a href="#h3-0-479" id="h3-0-479" class="d">-                    }.also { currentSearchJob = it }
</a><a href="#h3-0-480" id="h3-0-480" class="d">-                },
</a><a href="#h3-0-481" id="h3-0-481" class="d">-
</a><a href="#h3-0-482" id="h3-0-482" class="d">-                keyboardActions = KeyboardActions(onDone = {
</a><a href="#h3-0-483" id="h3-0-483" class="d">-                    focusRequester.freeFocus()
</a><a href="#h3-0-484" id="h3-0-484" class="d">-                }),
</a><a href="#h3-0-485" id="h3-0-485" class="d">-                modifier = Modifier
</a><a href="#h3-0-486" id="h3-0-486" class="d">-                    .focusRequester(focusRequester)
</a><a href="#h3-0-487" id="h3-0-487" class="d">-                    .weight(1f, fill = true)
</a><a href="#h3-0-488" id="h3-0-488" class="d">-                    .padding(end = 10.dp)
</a><a href="#h3-0-489" id="h3-0-489" class="d">-                    .height(70.dp),
</a><a href="#h3-0-490" id="h3-0-490" class="d">-                singleLine = true,
</a><a href="#h3-0-491" id="h3-0-491" class="d">-                colors = TextFieldDefaults.colors(
</a><a href="#h3-0-492" id="h3-0-492" class="d">-                    unfocusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h3-0-493" id="h3-0-493" class="d">-                    focusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h3-0-494" id="h3-0-494" class="d">-                    focusedIndicatorColor = Color.Transparent,
</a><a href="#h3-0-495" id="h3-0-495" class="d">-                    unfocusedIndicatorColor = Color.Transparent,
</a><a href="#h3-0-496" id="h3-0-496" class="d">-                    disabledIndicatorColor = Color.Transparent,
</a><a href="#h3-0-497" id="h3-0-497" class="d">-                    cursorColor = MaterialTheme.colorScheme.primary
</a><a href="#h3-0-498" id="h3-0-498" class="d">-                )
</a><a href="#h3-0-499" id="h3-0-499" class="d">-            )
</a><a href="#h3-0-500" id="h3-0-500" class="d">-        }
</a><a href="#h3-0-501" id="h3-0-501" class="d">-    }
</a><a href="#h3-0-502" id="h3-0-502" class="d">-
</a><a href="#h3-0-503" id="h3-0-503" class="d">-    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = topBarActions@{
</a><a href="#h3-0-504" id="h3-0-504" class="d">-        var showSearchBar by remember { mutableStateOf(false) }
</a><a href="#h3-0-505" id="h3-0-505" class="d">-        val focusRequester = remember { FocusRequester() }
</a><a href="#h3-0-506" id="h3-0-506" class="d">-
</a><a href="#h3-0-507" id="h3-0-507" class="d">-        if (showSearchBar) {
</a><a href="#h3-0-508" id="h3-0-508" class="d">-            FeatureSearchBar(this, focusRequester)
</a><a href="#h3-0-509" id="h3-0-509" class="d">-            LaunchedEffect(true) {
</a><a href="#h3-0-510" id="h3-0-510" class="d">-                focusRequester.requestFocus()
</a><a href="#h3-0-511" id="h3-0-511" class="d">-            }
</a><a href="#h3-0-512" id="h3-0-512" class="d">-        }
</a><a href="#h3-0-513" id="h3-0-513" class="d">-
</a><a href="#h3-0-514" id="h3-0-514" class="d">-        IconButton(onClick = {
</a><a href="#h3-0-515" id="h3-0-515" class="d">-            showSearchBar = showSearchBar.not()
</a><a href="#h3-0-516" id="h3-0-516" class="d">-            if (!showSearchBar &amp;&amp; routes.currentDestination == SEARCH_FEATURE_ROUTE) {
</a><a href="#h3-0-517" id="h3-0-517" class="d">-                navigateToMainRoot()
</a><a href="#h3-0-518" id="h3-0-518" class="d">-            }
</a><a href="#h3-0-519" id="h3-0-519" class="d">-        }) {
</a><a href="#h3-0-520" id="h3-0-520" class="d">-            Icon(
</a><a href="#h3-0-521" id="h3-0-521" class="d">-                imageVector = if (showSearchBar) Icons.Filled.Close
</a><a href="#h3-0-522" id="h3-0-522" class="d">-                else Icons.Filled.Search,
</a><a href="#h3-0-523" id="h3-0-523" class="d">-                contentDescription = null
</a><a href="#h3-0-524" id="h3-0-524" class="d">-            )
</a><a href="#h3-0-525" id="h3-0-525" class="d">-        }
</a><a href="#h3-0-526" id="h3-0-526" class="d">-
</a><a href="#h3-0-527" id="h3-0-527" class="d">-        if (showSearchBar) return@topBarActions
</a><a href="#h3-0-528" id="h3-0-528" class="d">-
</a><a href="#h3-0-529" id="h3-0-529" class="d">-        var showExportDropdownMenu by remember { mutableStateOf(false) }
</a><a href="#h3-0-530" id="h3-0-530" class="d">-        var showResetConfirmationDialog by remember { mutableStateOf(false) }
</a><a href="#h3-0-531" id="h3-0-531" class="d">-        var showExportDialog by remember { mutableStateOf(false) }
</a><a href="#h3-0-532" id="h3-0-532" class="d">-
</a><a href="#h3-0-533" id="h3-0-533" class="d">-        if (showResetConfirmationDialog) {
</a><a href="#h3-0-534" id="h3-0-534" class="d">-            AlertDialog(
</a><a href="#h3-0-535" id="h3-0-535" class="d">-                title = { Text(text = context.translation[&quot;manager.dialogs.reset_config.title&quot;]) },
</a><a href="#h3-0-536" id="h3-0-536" class="d">-                text = { Text(text = context.translation[&quot;manager.dialogs.reset_config.content&quot;]) },
</a><a href="#h3-0-537" id="h3-0-537" class="d">-                onDismissRequest = { showResetConfirmationDialog = false },
</a><a href="#h3-0-538" id="h3-0-538" class="d">-                confirmButton = {
</a><a href="#h3-0-539" id="h3-0-539" class="d">-                    Button(
</a><a href="#h3-0-540" id="h3-0-540" class="d">-                        onClick = {
</a><a href="#h3-0-541" id="h3-0-541" class="d">-                            context.config.reset()
</a><a href="#h3-0-542" id="h3-0-542" class="d">-                            context.shortToast(context.translation[&quot;manager.dialogs.reset_config.success_toast&quot;])
</a><a href="#h3-0-543" id="h3-0-543" class="d">-                            showResetConfirmationDialog = false
</a><a href="#h3-0-544" id="h3-0-544" class="d">-                        }
</a><a href="#h3-0-545" id="h3-0-545" class="d">-                    ) {
</a><a href="#h3-0-546" id="h3-0-546" class="d">-                        Text(text = context.translation[&quot;button.positive&quot;])
</a><a href="#h3-0-547" id="h3-0-547" class="d">-                    }
</a><a href="#h3-0-548" id="h3-0-548" class="d">-                },
</a><a href="#h3-0-549" id="h3-0-549" class="d">-                dismissButton = {
</a><a href="#h3-0-550" id="h3-0-550" class="d">-                    Button(
</a><a href="#h3-0-551" id="h3-0-551" class="d">-                        onClick = {
</a><a href="#h3-0-552" id="h3-0-552" class="d">-                            showResetConfirmationDialog = false
</a><a href="#h3-0-553" id="h3-0-553" class="d">-                        }
</a><a href="#h3-0-554" id="h3-0-554" class="d">-                    ) {
</a><a href="#h3-0-555" id="h3-0-555" class="d">-                        Text(text = context.translation[&quot;button.negative&quot;])
</a><a href="#h3-0-556" id="h3-0-556" class="d">-                    }
</a><a href="#h3-0-557" id="h3-0-557" class="d">-                }
</a><a href="#h3-0-558" id="h3-0-558" class="d">-            )
</a><a href="#h3-0-559" id="h3-0-559" class="d">-        }
</a><a href="#h3-0-560" id="h3-0-560" class="d">-
</a><a href="#h3-0-561" id="h3-0-561" class="d">-        if (showExportDialog) {
</a><a href="#h3-0-562" id="h3-0-562" class="d">-            fun exportConfig(
</a><a href="#h3-0-563" id="h3-0-563" class="d">-                exportSensitiveData: Boolean
</a><a href="#h3-0-564" id="h3-0-564" class="d">-            ) {
</a><a href="#h3-0-565" id="h3-0-565" class="d">-                showExportDialog = false
</a><a href="#h3-0-566" id="h3-0-566" class="d">-                activityLauncher {
</a><a href="#h3-0-567" id="h3-0-567" class="d">-                    saveFile(&quot;config.json&quot;, &quot;application/json&quot;) { uri -&gt;
</a><a href="#h3-0-568" id="h3-0-568" class="d">-                        runCatching {
</a><a href="#h3-0-569" id="h3-0-569" class="d">-                            context.androidContext.contentResolver.openOutputStream(Uri.parse(uri))?.use {
</a><a href="#h3-0-570" id="h3-0-570" class="d">-                                context.config.writeConfig()
</a><a href="#h3-0-571" id="h3-0-571" class="d">-                                context.config.exportToString(exportSensitiveData).byteInputStream().copyTo(it)
</a><a href="#h3-0-572" id="h3-0-572" class="d">-                                context.shortToast(translation[&quot;config_export_success_toast&quot;])
</a><a href="#h3-0-573" id="h3-0-573" class="d">-                            }
</a><a href="#h3-0-574" id="h3-0-574" class="d">-                        }.onFailure {
</a><a href="#h3-0-575" id="h3-0-575" class="d">-                            context.longToast(translation.format(&quot;config_export_failure_toast&quot;, &quot;error&quot; to it.message.toString()))
</a><a href="#h3-0-576" id="h3-0-576" class="d">-                        }
</a><a href="#h3-0-577" id="h3-0-577" class="d">-                    }
</a><a href="#h3-0-578" id="h3-0-578" class="d">-                }
</a><a href="#h3-0-579" id="h3-0-579" class="d">-            }
</a><a href="#h3-0-580" id="h3-0-580" class="d">-
</a><a href="#h3-0-581" id="h3-0-581" class="d">-            AlertDialog(
</a><a href="#h3-0-582" id="h3-0-582" class="d">-                title = { Text(text = context.translation[&quot;manager.dialogs.export_config.title&quot;]) },
</a><a href="#h3-0-583" id="h3-0-583" class="d">-                text = { Text(text = context.translation[&quot;manager.dialogs.export_config.content&quot;]) },
</a><a href="#h3-0-584" id="h3-0-584" class="d">-                onDismissRequest = { showExportDialog = false },
</a><a href="#h3-0-585" id="h3-0-585" class="d">-                confirmButton = {
</a><a href="#h3-0-586" id="h3-0-586" class="d">-                    Button(
</a><a href="#h3-0-587" id="h3-0-587" class="d">-                        onClick = { exportConfig(true) }
</a><a href="#h3-0-588" id="h3-0-588" class="d">-                    ) {
</a><a href="#h3-0-589" id="h3-0-589" class="d">-                        Text(text = context.translation[&quot;button.positive&quot;])
</a><a href="#h3-0-590" id="h3-0-590" class="d">-                    }
</a><a href="#h3-0-591" id="h3-0-591" class="d">-                },
</a><a href="#h3-0-592" id="h3-0-592" class="d">-                dismissButton = {
</a><a href="#h3-0-593" id="h3-0-593" class="d">-                    Button(
</a><a href="#h3-0-594" id="h3-0-594" class="d">-                        onClick = { exportConfig(false) }
</a><a href="#h3-0-595" id="h3-0-595" class="d">-                    ) {
</a><a href="#h3-0-596" id="h3-0-596" class="d">-                        Text(text = context.translation[&quot;button.negative&quot;])
</a><a href="#h3-0-597" id="h3-0-597" class="d">-                    }
</a><a href="#h3-0-598" id="h3-0-598" class="d">-                }
</a><a href="#h3-0-599" id="h3-0-599" class="d">-            )
</a><a href="#h3-0-600" id="h3-0-600" class="d">-        }
</a><a href="#h3-0-601" id="h3-0-601" class="d">-
</a><a href="#h3-0-602" id="h3-0-602" class="d">-        val actions = remember {
</a><a href="#h3-0-603" id="h3-0-603" class="d">-            mapOf(
</a><a href="#h3-0-604" id="h3-0-604" class="d">-                translation[&quot;export_option&quot;] to { showExportDialog = true },
</a><a href="#h3-0-605" id="h3-0-605" class="d">-                translation[&quot;import_option&quot;] to {
</a><a href="#h3-0-606" id="h3-0-606" class="d">-                    activityLauncher {
</a><a href="#h3-0-607" id="h3-0-607" class="d">-                        openFile(&quot;application/json&quot;) { uri -&gt;
</a><a href="#h3-0-608" id="h3-0-608" class="d">-                            context.androidContext.contentResolver.openInputStream(Uri.parse(uri))?.use {
</a><a href="#h3-0-609" id="h3-0-609" class="d">-                                runCatching {
</a><a href="#h3-0-610" id="h3-0-610" class="d">-                                    context.config.loadFromString(it.readBytes().toString(Charsets.UTF_8))
</a><a href="#h3-0-611" id="h3-0-611" class="d">-                                }.onFailure {
</a><a href="#h3-0-612" id="h3-0-612" class="d">-                                    context.longToast(translation.format(&quot;config_import_failure_toast&quot;, &quot;error&quot; to it.message.toString()))
</a><a href="#h3-0-613" id="h3-0-613" class="d">-                                    return@use
</a><a href="#h3-0-614" id="h3-0-614" class="d">-                                }
</a><a href="#h3-0-615" id="h3-0-615" class="d">-                                context.shortToast(translation[&quot;config_import_success_toast&quot;])
</a><a href="#h3-0-616" id="h3-0-616" class="d">-                                context.coroutineScope.launch(Dispatchers.Main) {
</a><a href="#h3-0-617" id="h3-0-617" class="d">-                                    navigateReload()
</a><a href="#h3-0-618" id="h3-0-618" class="d">-                                }
</a><a href="#h3-0-619" id="h3-0-619" class="d">-                            }
</a><a href="#h3-0-620" id="h3-0-620" class="d">-                        }
</a><a href="#h3-0-621" id="h3-0-621" class="d">-                    }
</a><a href="#h3-0-622" id="h3-0-622" class="d">-                },
</a><a href="#h3-0-623" id="h3-0-623" class="d">-                translation[&quot;reset_option&quot;] to { showResetConfirmationDialog = true }
</a><a href="#h3-0-624" id="h3-0-624" class="d">-            )
</a><a href="#h3-0-625" id="h3-0-625" class="d">-        }
</a><a href="#h3-0-626" id="h3-0-626" class="d">-
</a><a href="#h3-0-627" id="h3-0-627" class="d">-        if (context.activity != null) {
</a><a href="#h3-0-628" id="h3-0-628" class="d">-            IconButton(onClick = { showExportDropdownMenu = !showExportDropdownMenu}) {
</a><a href="#h3-0-629" id="h3-0-629" class="d">-                Icon(
</a><a href="#h3-0-630" id="h3-0-630" class="d">-                    imageVector = Icons.Filled.MoreVert,
</a><a href="#h3-0-631" id="h3-0-631" class="d">-                    contentDescription = null
</a><a href="#h3-0-632" id="h3-0-632" class="d">-                )
</a><a href="#h3-0-633" id="h3-0-633" class="d">-            }
</a><a href="#h3-0-634" id="h3-0-634" class="d">-        }
</a><a href="#h3-0-635" id="h3-0-635" class="d">-
</a><a href="#h3-0-636" id="h3-0-636" class="d">-        if (showExportDropdownMenu) {
</a><a href="#h3-0-637" id="h3-0-637" class="d">-            DropdownMenu(expanded = true, onDismissRequest = { showExportDropdownMenu = false }) {
</a><a href="#h3-0-638" id="h3-0-638" class="d">-                actions.forEach { (name, action) -&gt;
</a><a href="#h3-0-639" id="h3-0-639" class="d">-                    DropdownMenuItem(
</a><a href="#h3-0-640" id="h3-0-640" class="d">-                        text = {
</a><a href="#h3-0-641" id="h3-0-641" class="d">-                            Text(text = name)
</a><a href="#h3-0-642" id="h3-0-642" class="d">-                        },
</a><a href="#h3-0-643" id="h3-0-643" class="d">-                        onClick = {
</a><a href="#h3-0-644" id="h3-0-644" class="d">-                            action()
</a><a href="#h3-0-645" id="h3-0-645" class="d">-                            showExportDropdownMenu = false
</a><a href="#h3-0-646" id="h3-0-646" class="d">-                        }
</a><a href="#h3-0-647" id="h3-0-647" class="d">-                    )
</a><a href="#h3-0-648" id="h3-0-648" class="d">-                }
</a><a href="#h3-0-649" id="h3-0-649" class="d">-            }
</a><a href="#h3-0-650" id="h3-0-650" class="d">-        }
</a><a href="#h3-0-651" id="h3-0-651" class="d">-    }
</a><a href="#h3-0-652" id="h3-0-652" class="d">-
</a><a href="#h3-0-653" id="h3-0-653" class="d">-    @Composable
</a><a href="#h3-0-654" id="h3-0-654" class="d">-    private fun PropertiesView(
</a><a href="#h3-0-655" id="h3-0-655" class="d">-        properties: List&lt;PropertyPair&lt;*&gt;&gt;
</a><a href="#h3-0-656" id="h3-0-656" class="d">-    ) {
</a><a href="#h3-0-657" id="h3-0-657" class="d">-        Scaffold(
</a><a href="#h3-0-658" id="h3-0-658" class="d">-            modifier = Modifier.fillMaxSize(),
</a><a href="#h3-0-659" id="h3-0-659" class="d">-            content = { innerPadding -&gt;
</a><a href="#h3-0-660" id="h3-0-660" class="d">-                LazyColumn(
</a><a href="#h3-0-661" id="h3-0-661" class="d">-                    modifier = Modifier
</a><a href="#h3-0-662" id="h3-0-662" class="d">-                        .fillMaxHeight()
</a><a href="#h3-0-663" id="h3-0-663" class="d">-                        .padding(innerPadding),
</a><a href="#h3-0-664" id="h3-0-664" class="d">-                    //save button space
</a><a href="#h3-0-665" id="h3-0-665" class="d">-                    contentPadding = PaddingValues(top = 10.dp, bottom = 110.dp),
</a><a href="#h3-0-666" id="h3-0-666" class="d">-                    verticalArrangement = Arrangement.Top
</a><a href="#h3-0-667" id="h3-0-667" class="d">-                ) {
</a><a href="#h3-0-668" id="h3-0-668" class="d">-                    items(properties) {
</a><a href="#h3-0-669" id="h3-0-669" class="d">-                        PropertyCard(it)
</a><a href="#h3-0-670" id="h3-0-670" class="d">-                    }
</a><a href="#h3-0-671" id="h3-0-671" class="d">-                }
</a><a href="#h3-0-672" id="h3-0-672" class="d">-            }
</a><a href="#h3-0-673" id="h3-0-673" class="d">-        )
</a><a href="#h3-0-674" id="h3-0-674" class="d">-    }
</a><a href="#h3-0-675" id="h3-0-675" class="d">-
</a><a href="#h3-0-676" id="h3-0-676" class="d">-    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h3-0-677" id="h3-0-677" class="d">-        fun saveConfig() {
</a><a href="#h3-0-678" id="h3-0-678" class="d">-            context.coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h3-0-679" id="h3-0-679" class="d">-                context.config.writeConfig()
</a><a href="#h3-0-680" id="h3-0-680" class="d">-                context.log.verbose(&quot;saved config!&quot;)
</a><a href="#h3-0-681" id="h3-0-681" class="d">-            }
</a><a href="#h3-0-682" id="h3-0-682" class="d">-        }
</a><a href="#h3-0-683" id="h3-0-683" class="d">-
</a><a href="#h3-0-684" id="h3-0-684" class="d">-        OnLifecycleEvent { _, event -&gt;
</a><a href="#h3-0-685" id="h3-0-685" class="d">-            if (event == Lifecycle.Event.ON_PAUSE || event == Lifecycle.Event.ON_STOP) {
</a><a href="#h3-0-686" id="h3-0-686" class="d">-                saveConfig()
</a><a href="#h3-0-687" id="h3-0-687" class="d">-            }
</a><a href="#h3-0-688" id="h3-0-688" class="d">-        }
</a><a href="#h3-0-689" id="h3-0-689" class="d">-
</a><a href="#h3-0-690" id="h3-0-690" class="d">-        DisposableEffect(Unit) {
</a><a href="#h3-0-691" id="h3-0-691" class="d">-            onDispose {
</a><a href="#h3-0-692" id="h3-0-692" class="d">-                saveConfig()
</a><a href="#h3-0-693" id="h3-0-693" class="d">-            }
</a><a href="#h3-0-694" id="h3-0-694" class="d">-        }
</a><a href="#h3-0-695" id="h3-0-695" class="d">-    }
</a><a href="#h3-0-696" id="h3-0-696" class="d">-
</a><a href="#h3-0-697" id="h3-0-697" class="d">-
</a><a href="#h3-0-698" id="h3-0-698" class="d">-    @Composable
</a><a href="#h3-0-699" id="h3-0-699" class="d">-    private fun Container(
</a><a href="#h3-0-700" id="h3-0-700" class="d">-        configContainer: ConfigContainer
</a><a href="#h3-0-701" id="h3-0-701" class="d">-    ) {
</a><a href="#h3-0-702" id="h3-0-702" class="d">-        PropertiesView(remember {
</a><a href="#h3-0-703" id="h3-0-703" class="d">-            configContainer.properties.map { PropertyPair(it.key, it.value) }
</a><a href="#h3-0-704" id="h3-0-704" class="d">-        })
</a><a href="#h3-0-705" id="h3-0-705" class="d">-    }
</a><a href="#h3-0-706" id="h3-0-706" class="d">-}</a><a href="#h3-0-707" id="h3-0-707" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/features/FeaturesRootSection.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -0,0 +1,707 @@
</a><a href="#h4-0-0" id="h4-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages.features
</a><a href="#h4-0-1" id="h4-0-1" class="i">+
</a><a href="#h4-0-2" id="h4-0-2" class="i">+import android.content.Intent
</a><a href="#h4-0-3" id="h4-0-3" class="i">+import android.net.Uri
</a><a href="#h4-0-4" id="h4-0-4" class="i">+import androidx.compose.animation.AnimatedContentTransitionScope
</a><a href="#h4-0-5" id="h4-0-5" class="i">+import androidx.compose.animation.core.tween
</a><a href="#h4-0-6" id="h4-0-6" class="i">+import androidx.compose.foundation.background
</a><a href="#h4-0-7" id="h4-0-7" class="i">+import androidx.compose.foundation.border
</a><a href="#h4-0-8" id="h4-0-8" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h4-0-9" id="h4-0-9" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h4-0-10" id="h4-0-10" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h4-0-11" id="h4-0-11" class="i">+import androidx.compose.foundation.lazy.items
</a><a href="#h4-0-12" id="h4-0-12" class="i">+import androidx.compose.foundation.shape.RoundedCornerShape
</a><a href="#h4-0-13" id="h4-0-13" class="i">+import androidx.compose.foundation.text.KeyboardActions
</a><a href="#h4-0-14" id="h4-0-14" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h4-0-15" id="h4-0-15" class="i">+import androidx.compose.material.icons.automirrored.filled.OpenInNew
</a><a href="#h4-0-16" id="h4-0-16" class="i">+import androidx.compose.material.icons.filled.*
</a><a href="#h4-0-17" id="h4-0-17" class="i">+import androidx.compose.material3.*
</a><a href="#h4-0-18" id="h4-0-18" class="i">+import androidx.compose.runtime.*
</a><a href="#h4-0-19" id="h4-0-19" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h4-0-20" id="h4-0-20" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h4-0-21" id="h4-0-21" class="i">+import androidx.compose.ui.draw.clip
</a><a href="#h4-0-22" id="h4-0-22" class="i">+import androidx.compose.ui.focus.FocusRequester
</a><a href="#h4-0-23" id="h4-0-23" class="i">+import androidx.compose.ui.focus.focusRequester
</a><a href="#h4-0-24" id="h4-0-24" class="i">+import androidx.compose.ui.graphics.Color
</a><a href="#h4-0-25" id="h4-0-25" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h4-0-26" id="h4-0-26" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h4-0-27" id="h4-0-27" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h4-0-28" id="h4-0-28" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h4-0-29" id="h4-0-29" class="i">+import androidx.lifecycle.Lifecycle
</a><a href="#h4-0-30" id="h4-0-30" class="i">+import androidx.navigation.NavBackStackEntry
</a><a href="#h4-0-31" id="h4-0-31" class="i">+import androidx.navigation.NavGraph.Companion.findStartDestination
</a><a href="#h4-0-32" id="h4-0-32" class="i">+import androidx.navigation.NavGraphBuilder
</a><a href="#h4-0-33" id="h4-0-33" class="i">+import androidx.navigation.NavOptions
</a><a href="#h4-0-34" id="h4-0-34" class="i">+import androidx.navigation.compose.composable
</a><a href="#h4-0-35" id="h4-0-35" class="i">+import com.github.skydoves.colorpicker.compose.AlphaTile
</a><a href="#h4-0-36" id="h4-0-36" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h4-0-37" id="h4-0-37" class="i">+import kotlinx.coroutines.Job
</a><a href="#h4-0-38" id="h4-0-38" class="i">+import kotlinx.coroutines.delay
</a><a href="#h4-0-39" id="h4-0-39" class="i">+import kotlinx.coroutines.launch
</a><a href="#h4-0-40" id="h4-0-40" class="i">+import me.rhunk.snapenhance.common.config.*
</a><a href="#h4-0-41" id="h4-0-41" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h4-0-42" id="h4-0-42" class="i">+import me.rhunk.snapenhance.ui.manager.MainActivity
</a><a href="#h4-0-43" id="h4-0-43" class="i">+import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h4-0-44" id="h4-0-44" class="i">+import me.rhunk.snapenhance.ui.util.*
</a><a href="#h4-0-45" id="h4-0-45" class="i">+
</a><a href="#h4-0-46" id="h4-0-46" class="i">+class FeaturesRootSection : Routes.Route() {
</a><a href="#h4-0-47" id="h4-0-47" class="i">+    private val alertDialogs by lazy { AlertDialogs(context.translation) }
</a><a href="#h4-0-48" id="h4-0-48" class="i">+
</a><a href="#h4-0-49" id="h4-0-49" class="i">+    companion object {
</a><a href="#h4-0-50" id="h4-0-50" class="i">+        const val FEATURE_CONTAINER_ROUTE = &quot;feature_container/{name}&quot;
</a><a href="#h4-0-51" id="h4-0-51" class="i">+        const val SEARCH_FEATURE_ROUTE = &quot;search_feature/{keyword}&quot;
</a><a href="#h4-0-52" id="h4-0-52" class="i">+    }
</a><a href="#h4-0-53" id="h4-0-53" class="i">+
</a><a href="#h4-0-54" id="h4-0-54" class="i">+    private var activityLauncherHelper: ActivityLauncherHelper? = null
</a><a href="#h4-0-55" id="h4-0-55" class="i">+
</a><a href="#h4-0-56" id="h4-0-56" class="i">+    private val allContainers by lazy {
</a><a href="#h4-0-57" id="h4-0-57" class="i">+        val containers = mutableMapOf&lt;String, PropertyPair&lt;*&gt;&gt;()
</a><a href="#h4-0-58" id="h4-0-58" class="i">+        fun queryContainerRecursive(container: ConfigContainer) {
</a><a href="#h4-0-59" id="h4-0-59" class="i">+            container.properties.forEach {
</a><a href="#h4-0-60" id="h4-0-60" class="i">+                if (it.key.dataType.type == DataProcessors.Type.CONTAINER) {
</a><a href="#h4-0-61" id="h4-0-61" class="i">+                    containers[it.key.name] = PropertyPair(it.key, it.value)
</a><a href="#h4-0-62" id="h4-0-62" class="i">+                    queryContainerRecursive(it.value.get() as ConfigContainer)
</a><a href="#h4-0-63" id="h4-0-63" class="i">+                }
</a><a href="#h4-0-64" id="h4-0-64" class="i">+            }
</a><a href="#h4-0-65" id="h4-0-65" class="i">+        }
</a><a href="#h4-0-66" id="h4-0-66" class="i">+        queryContainerRecursive(context.config.root)
</a><a href="#h4-0-67" id="h4-0-67" class="i">+        containers
</a><a href="#h4-0-68" id="h4-0-68" class="i">+    }
</a><a href="#h4-0-69" id="h4-0-69" class="i">+
</a><a href="#h4-0-70" id="h4-0-70" class="i">+    private val allProperties by lazy {
</a><a href="#h4-0-71" id="h4-0-71" class="i">+        val properties = mutableMapOf&lt;PropertyKey&lt;*&gt;, PropertyValue&lt;*&gt;&gt;()
</a><a href="#h4-0-72" id="h4-0-72" class="i">+        allContainers.values.forEach {
</a><a href="#h4-0-73" id="h4-0-73" class="i">+            val container = it.value.get() as ConfigContainer
</a><a href="#h4-0-74" id="h4-0-74" class="i">+            container.properties.forEach { property -&gt;
</a><a href="#h4-0-75" id="h4-0-75" class="i">+                properties[property.key] = property.value
</a><a href="#h4-0-76" id="h4-0-76" class="i">+            }
</a><a href="#h4-0-77" id="h4-0-77" class="i">+        }
</a><a href="#h4-0-78" id="h4-0-78" class="i">+        properties
</a><a href="#h4-0-79" id="h4-0-79" class="i">+    }
</a><a href="#h4-0-80" id="h4-0-80" class="i">+
</a><a href="#h4-0-81" id="h4-0-81" class="i">+    private fun navigateToMainRoot() {
</a><a href="#h4-0-82" id="h4-0-82" class="i">+        routes.navController.navigate(routeInfo.id, NavOptions.Builder()
</a><a href="#h4-0-83" id="h4-0-83" class="i">+            .setPopUpTo(routes.navController.graph.findStartDestination().id, false)
</a><a href="#h4-0-84" id="h4-0-84" class="i">+            .setLaunchSingleTop(true)
</a><a href="#h4-0-85" id="h4-0-85" class="i">+            .build()
</a><a href="#h4-0-86" id="h4-0-86" class="i">+        )
</a><a href="#h4-0-87" id="h4-0-87" class="i">+    }
</a><a href="#h4-0-88" id="h4-0-88" class="i">+
</a><a href="#h4-0-89" id="h4-0-89" class="i">+    override val init: () -&gt; Unit = {
</a><a href="#h4-0-90" id="h4-0-90" class="i">+        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h4-0-91" id="h4-0-91" class="i">+    }
</a><a href="#h4-0-92" id="h4-0-92" class="i">+
</a><a href="#h4-0-93" id="h4-0-93" class="i">+    private fun activityLauncher(block: ActivityLauncherHelper.() -&gt; Unit) {
</a><a href="#h4-0-94" id="h4-0-94" class="i">+        activityLauncherHelper?.let(block) ?: run {
</a><a href="#h4-0-95" id="h4-0-95" class="i">+            //open manager if activity launcher is null
</a><a href="#h4-0-96" id="h4-0-96" class="i">+            val intent = Intent(context.androidContext, MainActivity::class.java)
</a><a href="#h4-0-97" id="h4-0-97" class="i">+            intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
</a><a href="#h4-0-98" id="h4-0-98" class="i">+            intent.putExtra(&quot;route&quot;, routeInfo.id)
</a><a href="#h4-0-99" id="h4-0-99" class="i">+            context.androidContext.startActivity(intent)
</a><a href="#h4-0-100" id="h4-0-100" class="i">+        }
</a><a href="#h4-0-101" id="h4-0-101" class="i">+    }
</a><a href="#h4-0-102" id="h4-0-102" class="i">+
</a><a href="#h4-0-103" id="h4-0-103" class="i">+    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h4-0-104" id="h4-0-104" class="i">+        Container(context.config.root)
</a><a href="#h4-0-105" id="h4-0-105" class="i">+    }
</a><a href="#h4-0-106" id="h4-0-106" class="i">+
</a><a href="#h4-0-107" id="h4-0-107" class="i">+    override val customComposables: NavGraphBuilder.() -&gt; Unit = {
</a><a href="#h4-0-108" id="h4-0-108" class="i">+        routeInfo.childIds.addAll(listOf(FEATURE_CONTAINER_ROUTE, SEARCH_FEATURE_ROUTE))
</a><a href="#h4-0-109" id="h4-0-109" class="i">+
</a><a href="#h4-0-110" id="h4-0-110" class="i">+        composable(FEATURE_CONTAINER_ROUTE, enterTransition = {
</a><a href="#h4-0-111" id="h4-0-111" class="i">+            slideIntoContainer(AnimatedContentTransitionScope.SlideDirection.Left, animationSpec = tween(100))
</a><a href="#h4-0-112" id="h4-0-112" class="i">+        }, exitTransition = {
</a><a href="#h4-0-113" id="h4-0-113" class="i">+            slideOutOfContainer(AnimatedContentTransitionScope.SlideDirection.Right, animationSpec = tween(300))
</a><a href="#h4-0-114" id="h4-0-114" class="i">+        }) { backStackEntry -&gt;
</a><a href="#h4-0-115" id="h4-0-115" class="i">+            backStackEntry.arguments?.getString(&quot;name&quot;)?.let { containerName -&gt;
</a><a href="#h4-0-116" id="h4-0-116" class="i">+                allContainers[containerName]?.let {
</a><a href="#h4-0-117" id="h4-0-117" class="i">+                    Container(it.value.get() as ConfigContainer)
</a><a href="#h4-0-118" id="h4-0-118" class="i">+                }
</a><a href="#h4-0-119" id="h4-0-119" class="i">+            }
</a><a href="#h4-0-120" id="h4-0-120" class="i">+        }
</a><a href="#h4-0-121" id="h4-0-121" class="i">+
</a><a href="#h4-0-122" id="h4-0-122" class="i">+        composable(SEARCH_FEATURE_ROUTE) { backStackEntry -&gt;
</a><a href="#h4-0-123" id="h4-0-123" class="i">+            backStackEntry.arguments?.getString(&quot;keyword&quot;)?.let { keyword -&gt;
</a><a href="#h4-0-124" id="h4-0-124" class="i">+                val properties = allProperties.filter {
</a><a href="#h4-0-125" id="h4-0-125" class="i">+                    it.key.name.contains(keyword, ignoreCase = true) ||
</a><a href="#h4-0-126" id="h4-0-126" class="i">+                            context.translation[it.key.propertyName()].contains(keyword, ignoreCase = true) ||
</a><a href="#h4-0-127" id="h4-0-127" class="i">+                            context.translation[it.key.propertyDescription()].contains(keyword, ignoreCase = true)
</a><a href="#h4-0-128" id="h4-0-128" class="i">+                }.map { PropertyPair(it.key, it.value) }
</a><a href="#h4-0-129" id="h4-0-129" class="i">+
</a><a href="#h4-0-130" id="h4-0-130" class="i">+                PropertiesView(properties)
</a><a href="#h4-0-131" id="h4-0-131" class="i">+            }
</a><a href="#h4-0-132" id="h4-0-132" class="i">+        }
</a><a href="#h4-0-133" id="h4-0-133" class="i">+    }
</a><a href="#h4-0-134" id="h4-0-134" class="i">+
</a><a href="#h4-0-135" id="h4-0-135" class="i">+    @Composable
</a><a href="#h4-0-136" id="h4-0-136" class="i">+    private fun PropertyAction(property: PropertyPair&lt;*&gt;, registerClickCallback: RegisterClickCallback) {
</a><a href="#h4-0-137" id="h4-0-137" class="i">+        var showDialog by remember { mutableStateOf(false) }
</a><a href="#h4-0-138" id="h4-0-138" class="i">+        var dialogComposable by remember { mutableStateOf&lt;@Composable () -&gt; Unit&gt;({}) }
</a><a href="#h4-0-139" id="h4-0-139" class="i">+
</a><a href="#h4-0-140" id="h4-0-140" class="i">+        fun registerDialogOnClickCallback() = registerClickCallback { showDialog = true }
</a><a href="#h4-0-141" id="h4-0-141" class="i">+
</a><a href="#h4-0-142" id="h4-0-142" class="i">+        if (showDialog) {
</a><a href="#h4-0-143" id="h4-0-143" class="i">+            Dialog(
</a><a href="#h4-0-144" id="h4-0-144" class="i">+                properties = DialogProperties(
</a><a href="#h4-0-145" id="h4-0-145" class="i">+                    usePlatformDefaultWidth = false
</a><a href="#h4-0-146" id="h4-0-146" class="i">+                ),
</a><a href="#h4-0-147" id="h4-0-147" class="i">+                onDismissRequest = { showDialog = false },
</a><a href="#h4-0-148" id="h4-0-148" class="i">+            ) {
</a><a href="#h4-0-149" id="h4-0-149" class="i">+                dialogComposable()
</a><a href="#h4-0-150" id="h4-0-150" class="i">+            }
</a><a href="#h4-0-151" id="h4-0-151" class="i">+        }
</a><a href="#h4-0-152" id="h4-0-152" class="i">+
</a><a href="#h4-0-153" id="h4-0-153" class="i">+        val propertyValue = property.value
</a><a href="#h4-0-154" id="h4-0-154" class="i">+
</a><a href="#h4-0-155" id="h4-0-155" class="i">+        if (property.key.params.flags.contains(ConfigFlag.USER_IMPORT)) {
</a><a href="#h4-0-156" id="h4-0-156" class="i">+            registerDialogOnClickCallback()
</a><a href="#h4-0-157" id="h4-0-157" class="i">+            dialogComposable = {
</a><a href="#h4-0-158" id="h4-0-158" class="i">+                var isEmpty by remember { mutableStateOf(false) }
</a><a href="#h4-0-159" id="h4-0-159" class="i">+                val files = rememberAsyncMutableStateList(defaultValue = listOf()) {
</a><a href="#h4-0-160" id="h4-0-160" class="i">+                    context.fileHandleManager.getStoredFiles {
</a><a href="#h4-0-161" id="h4-0-161" class="i">+                        property.key.params.filenameFilter?.invoke(it.name) == true
</a><a href="#h4-0-162" id="h4-0-162" class="i">+                    }.also {
</a><a href="#h4-0-163" id="h4-0-163" class="i">+                        isEmpty = it.isEmpty()
</a><a href="#h4-0-164" id="h4-0-164" class="i">+                        if (isEmpty) {
</a><a href="#h4-0-165" id="h4-0-165" class="i">+                            propertyValue.setAny(null)
</a><a href="#h4-0-166" id="h4-0-166" class="i">+                        }
</a><a href="#h4-0-167" id="h4-0-167" class="i">+                    }
</a><a href="#h4-0-168" id="h4-0-168" class="i">+                }
</a><a href="#h4-0-169" id="h4-0-169" class="i">+                var selectedFile by remember(files.size) { mutableStateOf(files.firstOrNull { it.name == propertyValue.getNullable() }.also {
</a><a href="#h4-0-170" id="h4-0-170" class="i">+                    if (files.isNotEmpty() &amp;&amp; it == null) propertyValue.setAny(null)
</a><a href="#h4-0-171" id="h4-0-171" class="i">+                }?.name) }
</a><a href="#h4-0-172" id="h4-0-172" class="i">+
</a><a href="#h4-0-173" id="h4-0-173" class="i">+                Card(
</a><a href="#h4-0-174" id="h4-0-174" class="i">+                    shape = MaterialTheme.shapes.large,
</a><a href="#h4-0-175" id="h4-0-175" class="i">+                    modifier = Modifier
</a><a href="#h4-0-176" id="h4-0-176" class="i">+                        .fillMaxWidth(),
</a><a href="#h4-0-177" id="h4-0-177" class="i">+                ) {
</a><a href="#h4-0-178" id="h4-0-178" class="i">+                    LazyColumn(
</a><a href="#h4-0-179" id="h4-0-179" class="i">+                        modifier = Modifier.fillMaxWidth().padding(4.dp),
</a><a href="#h4-0-180" id="h4-0-180" class="i">+                    ) {
</a><a href="#h4-0-181" id="h4-0-181" class="i">+                        item {
</a><a href="#h4-0-182" id="h4-0-182" class="i">+                            Column(
</a><a href="#h4-0-183" id="h4-0-183" class="i">+                                modifier = Modifier.fillMaxWidth().padding(16.dp),
</a><a href="#h4-0-184" id="h4-0-184" class="i">+                                horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h4-0-185" id="h4-0-185" class="i">+                            ) {
</a><a href="#h4-0-186" id="h4-0-186" class="i">+                                Text(
</a><a href="#h4-0-187" id="h4-0-187" class="i">+                                    text = context.translation[&quot;manager.dialogs.file_imports.settings_select_file_hint&quot;],
</a><a href="#h4-0-188" id="h4-0-188" class="i">+                                    fontSize = 18.sp,
</a><a href="#h4-0-189" id="h4-0-189" class="i">+                                    fontWeight = FontWeight.Bold,
</a><a href="#h4-0-190" id="h4-0-190" class="i">+                                )
</a><a href="#h4-0-191" id="h4-0-191" class="i">+                                if (isEmpty) {
</a><a href="#h4-0-192" id="h4-0-192" class="i">+                                    Text(
</a><a href="#h4-0-193" id="h4-0-193" class="i">+                                        text = context.translation[&quot;manager.dialogs.file_imports.no_files_settings_hint&quot;],
</a><a href="#h4-0-194" id="h4-0-194" class="i">+                                        fontSize = 16.sp,
</a><a href="#h4-0-195" id="h4-0-195" class="i">+                                        modifier = Modifier.padding(top = 10.dp),
</a><a href="#h4-0-196" id="h4-0-196" class="i">+                                    )
</a><a href="#h4-0-197" id="h4-0-197" class="i">+                                }
</a><a href="#h4-0-198" id="h4-0-198" class="i">+                            }
</a><a href="#h4-0-199" id="h4-0-199" class="i">+                        }
</a><a href="#h4-0-200" id="h4-0-200" class="i">+                        items(files, key = { it.name }) { file -&gt;
</a><a href="#h4-0-201" id="h4-0-201" class="i">+                            Row(
</a><a href="#h4-0-202" id="h4-0-202" class="i">+                                modifier = Modifier.clickable {
</a><a href="#h4-0-203" id="h4-0-203" class="i">+                                    selectedFile = if (selectedFile == file.name) null else file.name
</a><a href="#h4-0-204" id="h4-0-204" class="i">+                                    propertyValue.setAny(selectedFile)
</a><a href="#h4-0-205" id="h4-0-205" class="i">+                                }.padding(5.dp),
</a><a href="#h4-0-206" id="h4-0-206" class="i">+                                verticalAlignment = Alignment.CenterVertically
</a><a href="#h4-0-207" id="h4-0-207" class="i">+                            ) {
</a><a href="#h4-0-208" id="h4-0-208" class="i">+                                Icon(Icons.Filled.AttachFile, contentDescription = null, modifier = Modifier.padding(5.dp))
</a><a href="#h4-0-209" id="h4-0-209" class="i">+                                Text(
</a><a href="#h4-0-210" id="h4-0-210" class="i">+                                    text = file.name,
</a><a href="#h4-0-211" id="h4-0-211" class="i">+                                    modifier = Modifier
</a><a href="#h4-0-212" id="h4-0-212" class="i">+                                        .padding(3.dp)
</a><a href="#h4-0-213" id="h4-0-213" class="i">+                                        .weight(1f),
</a><a href="#h4-0-214" id="h4-0-214" class="i">+                                    fontSize = 14.sp,
</a><a href="#h4-0-215" id="h4-0-215" class="i">+                                    lineHeight = 16.sp
</a><a href="#h4-0-216" id="h4-0-216" class="i">+                                )
</a><a href="#h4-0-217" id="h4-0-217" class="i">+                                if (selectedFile == file.name) {
</a><a href="#h4-0-218" id="h4-0-218" class="i">+                                    Icon(Icons.Filled.Check, contentDescription = null, modifier = Modifier.padding(5.dp))
</a><a href="#h4-0-219" id="h4-0-219" class="i">+                                }
</a><a href="#h4-0-220" id="h4-0-220" class="i">+                            }
</a><a href="#h4-0-221" id="h4-0-221" class="i">+                        }
</a><a href="#h4-0-222" id="h4-0-222" class="i">+                    }
</a><a href="#h4-0-223" id="h4-0-223" class="i">+                }
</a><a href="#h4-0-224" id="h4-0-224" class="i">+            }
</a><a href="#h4-0-225" id="h4-0-225" class="i">+
</a><a href="#h4-0-226" id="h4-0-226" class="i">+            Icon(Icons.Filled.AttachFile, contentDescription = null)
</a><a href="#h4-0-227" id="h4-0-227" class="i">+            return
</a><a href="#h4-0-228" id="h4-0-228" class="i">+        }
</a><a href="#h4-0-229" id="h4-0-229" class="i">+
</a><a href="#h4-0-230" id="h4-0-230" class="i">+        if (property.key.params.flags.contains(ConfigFlag.FOLDER)) {
</a><a href="#h4-0-231" id="h4-0-231" class="i">+            IconButton(onClick = registerClickCallback {
</a><a href="#h4-0-232" id="h4-0-232" class="i">+                activityLauncher {
</a><a href="#h4-0-233" id="h4-0-233" class="i">+                    chooseFolder { uri -&gt;
</a><a href="#h4-0-234" id="h4-0-234" class="i">+                        propertyValue.setAny(uri)
</a><a href="#h4-0-235" id="h4-0-235" class="i">+                    }
</a><a href="#h4-0-236" id="h4-0-236" class="i">+                }
</a><a href="#h4-0-237" id="h4-0-237" class="i">+            }.let { { it.invoke(true) } }) {
</a><a href="#h4-0-238" id="h4-0-238" class="i">+                Icon(Icons.Filled.FolderOpen, contentDescription = null)
</a><a href="#h4-0-239" id="h4-0-239" class="i">+            }
</a><a href="#h4-0-240" id="h4-0-240" class="i">+            return
</a><a href="#h4-0-241" id="h4-0-241" class="i">+        }
</a><a href="#h4-0-242" id="h4-0-242" class="i">+
</a><a href="#h4-0-243" id="h4-0-243" class="i">+        when (val dataType = remember { property.key.dataType.type }) {
</a><a href="#h4-0-244" id="h4-0-244" class="i">+            DataProcessors.Type.BOOLEAN -&gt; {
</a><a href="#h4-0-245" id="h4-0-245" class="i">+                var state by remember { mutableStateOf(propertyValue.get() as Boolean) }
</a><a href="#h4-0-246" id="h4-0-246" class="i">+                Switch(
</a><a href="#h4-0-247" id="h4-0-247" class="i">+                    checked = state,
</a><a href="#h4-0-248" id="h4-0-248" class="i">+                    onCheckedChange = registerClickCallback {
</a><a href="#h4-0-249" id="h4-0-249" class="i">+                        state = state.not()
</a><a href="#h4-0-250" id="h4-0-250" class="i">+                        propertyValue.setAny(state)
</a><a href="#h4-0-251" id="h4-0-251" class="i">+                    }
</a><a href="#h4-0-252" id="h4-0-252" class="i">+                )
</a><a href="#h4-0-253" id="h4-0-253" class="i">+            }
</a><a href="#h4-0-254" id="h4-0-254" class="i">+
</a><a href="#h4-0-255" id="h4-0-255" class="i">+            DataProcessors.Type.MAP_COORDINATES -&gt; {
</a><a href="#h4-0-256" id="h4-0-256" class="i">+                registerDialogOnClickCallback()
</a><a href="#h4-0-257" id="h4-0-257" class="i">+                dialogComposable = {
</a><a href="#h4-0-258" id="h4-0-258" class="i">+                    alertDialogs.ChooseLocationDialog(property) {
</a><a href="#h4-0-259" id="h4-0-259" class="i">+                        showDialog = false
</a><a href="#h4-0-260" id="h4-0-260" class="i">+                    }
</a><a href="#h4-0-261" id="h4-0-261" class="i">+                }
</a><a href="#h4-0-262" id="h4-0-262" class="i">+
</a><a href="#h4-0-263" id="h4-0-263" class="i">+                Text(
</a><a href="#h4-0-264" id="h4-0-264" class="i">+                    overflow = TextOverflow.Ellipsis,
</a><a href="#h4-0-265" id="h4-0-265" class="i">+                    maxLines = 1,
</a><a href="#h4-0-266" id="h4-0-266" class="i">+                    modifier = Modifier.widthIn(0.dp, 120.dp),
</a><a href="#h4-0-267" id="h4-0-267" class="i">+                    text = (propertyValue.get() as Pair&lt;*, *&gt;).let {
</a><a href="#h4-0-268" id="h4-0-268" class="i">+                        &quot;${it.first.toString().toFloatOrNull() ?: 0F}, ${it.second.toString().toFloatOrNull() ?: 0F}&quot;
</a><a href="#h4-0-269" id="h4-0-269" class="i">+                    }
</a><a href="#h4-0-270" id="h4-0-270" class="i">+                )
</a><a href="#h4-0-271" id="h4-0-271" class="i">+            }
</a><a href="#h4-0-272" id="h4-0-272" class="i">+
</a><a href="#h4-0-273" id="h4-0-273" class="i">+            DataProcessors.Type.STRING_UNIQUE_SELECTION -&gt; {
</a><a href="#h4-0-274" id="h4-0-274" class="i">+                registerDialogOnClickCallback()
</a><a href="#h4-0-275" id="h4-0-275" class="i">+
</a><a href="#h4-0-276" id="h4-0-276" class="i">+                dialogComposable = {
</a><a href="#h4-0-277" id="h4-0-277" class="i">+                    alertDialogs.UniqueSelectionDialog(property)
</a><a href="#h4-0-278" id="h4-0-278" class="i">+                }
</a><a href="#h4-0-279" id="h4-0-279" class="i">+
</a><a href="#h4-0-280" id="h4-0-280" class="i">+                Text(
</a><a href="#h4-0-281" id="h4-0-281" class="i">+                    overflow = TextOverflow.Ellipsis,
</a><a href="#h4-0-282" id="h4-0-282" class="i">+                    maxLines = 1,
</a><a href="#h4-0-283" id="h4-0-283" class="i">+                    modifier = Modifier.widthIn(0.dp, 120.dp),
</a><a href="#h4-0-284" id="h4-0-284" class="i">+                    text = (propertyValue.getNullable() as? String ?: &quot;null&quot;).let {
</a><a href="#h4-0-285" id="h4-0-285" class="i">+                        property.key.propertyOption(context.translation, it)
</a><a href="#h4-0-286" id="h4-0-286" class="i">+                    }
</a><a href="#h4-0-287" id="h4-0-287" class="i">+                )
</a><a href="#h4-0-288" id="h4-0-288" class="i">+            }
</a><a href="#h4-0-289" id="h4-0-289" class="i">+
</a><a href="#h4-0-290" id="h4-0-290" class="i">+            DataProcessors.Type.STRING_MULTIPLE_SELECTION, DataProcessors.Type.STRING, DataProcessors.Type.INTEGER, DataProcessors.Type.FLOAT -&gt; {
</a><a href="#h4-0-291" id="h4-0-291" class="i">+                dialogComposable = {
</a><a href="#h4-0-292" id="h4-0-292" class="i">+                    when (dataType) {
</a><a href="#h4-0-293" id="h4-0-293" class="i">+                        DataProcessors.Type.STRING_MULTIPLE_SELECTION -&gt; {
</a><a href="#h4-0-294" id="h4-0-294" class="i">+                            alertDialogs.MultipleSelectionDialog(property)
</a><a href="#h4-0-295" id="h4-0-295" class="i">+                        }
</a><a href="#h4-0-296" id="h4-0-296" class="i">+                        DataProcessors.Type.STRING, DataProcessors.Type.INTEGER, DataProcessors.Type.FLOAT -&gt; {
</a><a href="#h4-0-297" id="h4-0-297" class="i">+                            alertDialogs.KeyboardInputDialog(property) { showDialog = false }
</a><a href="#h4-0-298" id="h4-0-298" class="i">+                        }
</a><a href="#h4-0-299" id="h4-0-299" class="i">+                        else -&gt; {}
</a><a href="#h4-0-300" id="h4-0-300" class="i">+                    }
</a><a href="#h4-0-301" id="h4-0-301" class="i">+                }
</a><a href="#h4-0-302" id="h4-0-302" class="i">+
</a><a href="#h4-0-303" id="h4-0-303" class="i">+                registerDialogOnClickCallback().let { { it.invoke(true) } }.also {
</a><a href="#h4-0-304" id="h4-0-304" class="i">+                    if (dataType == DataProcessors.Type.INTEGER ||
</a><a href="#h4-0-305" id="h4-0-305" class="i">+                        dataType == DataProcessors.Type.FLOAT) {
</a><a href="#h4-0-306" id="h4-0-306" class="i">+                        FilledIconButton(onClick = it) {
</a><a href="#h4-0-307" id="h4-0-307" class="i">+                            Text(
</a><a href="#h4-0-308" id="h4-0-308" class="i">+                                text = propertyValue.get().toString(),
</a><a href="#h4-0-309" id="h4-0-309" class="i">+                                modifier = Modifier.wrapContentWidth(),
</a><a href="#h4-0-310" id="h4-0-310" class="i">+                                overflow = TextOverflow.Ellipsis
</a><a href="#h4-0-311" id="h4-0-311" class="i">+                            )
</a><a href="#h4-0-312" id="h4-0-312" class="i">+                        }
</a><a href="#h4-0-313" id="h4-0-313" class="i">+                    } else {
</a><a href="#h4-0-314" id="h4-0-314" class="i">+                        IconButton(onClick = it) {
</a><a href="#h4-0-315" id="h4-0-315" class="i">+                            Icon(Icons.AutoMirrored.Filled.OpenInNew, contentDescription = null)
</a><a href="#h4-0-316" id="h4-0-316" class="i">+                        }
</a><a href="#h4-0-317" id="h4-0-317" class="i">+                    }
</a><a href="#h4-0-318" id="h4-0-318" class="i">+                }
</a><a href="#h4-0-319" id="h4-0-319" class="i">+            }
</a><a href="#h4-0-320" id="h4-0-320" class="i">+
</a><a href="#h4-0-321" id="h4-0-321" class="i">+            DataProcessors.Type.INT_COLOR -&gt; {
</a><a href="#h4-0-322" id="h4-0-322" class="i">+                dialogComposable = {
</a><a href="#h4-0-323" id="h4-0-323" class="i">+                    alertDialogs.ColorPickerDialog(property) {
</a><a href="#h4-0-324" id="h4-0-324" class="i">+                        showDialog = false
</a><a href="#h4-0-325" id="h4-0-325" class="i">+                    }
</a><a href="#h4-0-326" id="h4-0-326" class="i">+                }
</a><a href="#h4-0-327" id="h4-0-327" class="i">+
</a><a href="#h4-0-328" id="h4-0-328" class="i">+                registerDialogOnClickCallback().let { { it.invoke(true) } }.also {
</a><a href="#h4-0-329" id="h4-0-329" class="i">+                    val selectedColor = (propertyValue.getNullable() as? Int)?.let { Color(it) }
</a><a href="#h4-0-330" id="h4-0-330" class="i">+                    AlphaTile(
</a><a href="#h4-0-331" id="h4-0-331" class="i">+                        modifier = Modifier
</a><a href="#h4-0-332" id="h4-0-332" class="i">+                            .size(30.dp)
</a><a href="#h4-0-333" id="h4-0-333" class="i">+                            .border(2.dp, Color.White, shape = RoundedCornerShape(15.dp))
</a><a href="#h4-0-334" id="h4-0-334" class="i">+                            .clip(RoundedCornerShape(15.dp)),
</a><a href="#h4-0-335" id="h4-0-335" class="i">+                        selectedColor = selectedColor ?: Color.Transparent,
</a><a href="#h4-0-336" id="h4-0-336" class="i">+                        tileEvenColor = selectedColor?.let { Color(0xFFCBCBCB) } ?: Color.Transparent,
</a><a href="#h4-0-337" id="h4-0-337" class="i">+                        tileOddColor = selectedColor?.let { Color.White } ?: Color.Transparent,
</a><a href="#h4-0-338" id="h4-0-338" class="i">+                        tileSize = 8.dp,
</a><a href="#h4-0-339" id="h4-0-339" class="i">+                    )
</a><a href="#h4-0-340" id="h4-0-340" class="i">+                }
</a><a href="#h4-0-341" id="h4-0-341" class="i">+            }
</a><a href="#h4-0-342" id="h4-0-342" class="i">+
</a><a href="#h4-0-343" id="h4-0-343" class="i">+            DataProcessors.Type.CONTAINER -&gt; {
</a><a href="#h4-0-344" id="h4-0-344" class="i">+                val container = propertyValue.get() as ConfigContainer
</a><a href="#h4-0-345" id="h4-0-345" class="i">+
</a><a href="#h4-0-346" id="h4-0-346" class="i">+                registerClickCallback {
</a><a href="#h4-0-347" id="h4-0-347" class="i">+                    routes.navController.navigate(FEATURE_CONTAINER_ROUTE.replace(&quot;{name}&quot;, property.name))
</a><a href="#h4-0-348" id="h4-0-348" class="i">+                }
</a><a href="#h4-0-349" id="h4-0-349" class="i">+
</a><a href="#h4-0-350" id="h4-0-350" class="i">+                if (!container.hasGlobalState) return
</a><a href="#h4-0-351" id="h4-0-351" class="i">+
</a><a href="#h4-0-352" id="h4-0-352" class="i">+                var state by remember { mutableStateOf(container.globalState ?: false) }
</a><a href="#h4-0-353" id="h4-0-353" class="i">+
</a><a href="#h4-0-354" id="h4-0-354" class="i">+                Box(
</a><a href="#h4-0-355" id="h4-0-355" class="i">+                    modifier = Modifier
</a><a href="#h4-0-356" id="h4-0-356" class="i">+                        .padding(end = 15.dp),
</a><a href="#h4-0-357" id="h4-0-357" class="i">+                ) {
</a><a href="#h4-0-358" id="h4-0-358" class="i">+
</a><a href="#h4-0-359" id="h4-0-359" class="i">+                    Box(modifier = Modifier
</a><a href="#h4-0-360" id="h4-0-360" class="i">+                        .height(50.dp)
</a><a href="#h4-0-361" id="h4-0-361" class="i">+                        .width(1.dp)
</a><a href="#h4-0-362" id="h4-0-362" class="i">+                        .background(
</a><a href="#h4-0-363" id="h4-0-363" class="i">+                            color = MaterialTheme.colorScheme.primary.copy(alpha = 0.12f),
</a><a href="#h4-0-364" id="h4-0-364" class="i">+                            shape = RoundedCornerShape(5.dp)
</a><a href="#h4-0-365" id="h4-0-365" class="i">+                        ))
</a><a href="#h4-0-366" id="h4-0-366" class="i">+                }
</a><a href="#h4-0-367" id="h4-0-367" class="i">+
</a><a href="#h4-0-368" id="h4-0-368" class="i">+                Switch(
</a><a href="#h4-0-369" id="h4-0-369" class="i">+                    checked = state,
</a><a href="#h4-0-370" id="h4-0-370" class="i">+                    onCheckedChange = {
</a><a href="#h4-0-371" id="h4-0-371" class="i">+                        state = state.not()
</a><a href="#h4-0-372" id="h4-0-372" class="i">+                        container.globalState = state
</a><a href="#h4-0-373" id="h4-0-373" class="i">+                    }
</a><a href="#h4-0-374" id="h4-0-374" class="i">+                )
</a><a href="#h4-0-375" id="h4-0-375" class="i">+            }
</a><a href="#h4-0-376" id="h4-0-376" class="i">+        }
</a><a href="#h4-0-377" id="h4-0-377" class="i">+
</a><a href="#h4-0-378" id="h4-0-378" class="i">+    }
</a><a href="#h4-0-379" id="h4-0-379" class="i">+
</a><a href="#h4-0-380" id="h4-0-380" class="i">+    @Composable
</a><a href="#h4-0-381" id="h4-0-381" class="i">+    private fun PropertyCard(property: PropertyPair&lt;*&gt;) {
</a><a href="#h4-0-382" id="h4-0-382" class="i">+        var clickCallback by remember { mutableStateOf&lt;ClickCallback?&gt;(null) }
</a><a href="#h4-0-383" id="h4-0-383" class="i">+        val noticeColorMap = mapOf(
</a><a href="#h4-0-384" id="h4-0-384" class="i">+            FeatureNotice.UNSTABLE.key to Color(0xFFFFFB87),
</a><a href="#h4-0-385" id="h4-0-385" class="i">+            FeatureNotice.BAN_RISK.key to Color(0xFFFF8585),
</a><a href="#h4-0-386" id="h4-0-386" class="i">+            FeatureNotice.INTERNAL_BEHAVIOR.key to Color(0xFFFFFB87),
</a><a href="#h4-0-387" id="h4-0-387" class="i">+            FeatureNotice.REQUIRE_NATIVE_HOOKS.key to Color(0xFFFF5722),
</a><a href="#h4-0-388" id="h4-0-388" class="i">+        )
</a><a href="#h4-0-389" id="h4-0-389" class="i">+
</a><a href="#h4-0-390" id="h4-0-390" class="i">+        ElevatedCard(
</a><a href="#h4-0-391" id="h4-0-391" class="i">+            modifier = Modifier
</a><a href="#h4-0-392" id="h4-0-392" class="i">+                .fillMaxWidth()
</a><a href="#h4-0-393" id="h4-0-393" class="i">+                .padding(start = 10.dp, end = 10.dp, top = 5.dp, bottom = 5.dp)
</a><a href="#h4-0-394" id="h4-0-394" class="i">+        ) {
</a><a href="#h4-0-395" id="h4-0-395" class="i">+            Row(
</a><a href="#h4-0-396" id="h4-0-396" class="i">+                modifier = Modifier
</a><a href="#h4-0-397" id="h4-0-397" class="i">+                    .fillMaxSize()
</a><a href="#h4-0-398" id="h4-0-398" class="i">+                    .clickable {
</a><a href="#h4-0-399" id="h4-0-399" class="i">+                        clickCallback?.invoke(true)
</a><a href="#h4-0-400" id="h4-0-400" class="i">+                    }
</a><a href="#h4-0-401" id="h4-0-401" class="i">+                    .padding(all = 4.dp),
</a><a href="#h4-0-402" id="h4-0-402" class="i">+                horizontalArrangement = Arrangement.SpaceBetween
</a><a href="#h4-0-403" id="h4-0-403" class="i">+            ) {
</a><a href="#h4-0-404" id="h4-0-404" class="i">+                property.key.params.icon?.let { icon -&gt;
</a><a href="#h4-0-405" id="h4-0-405" class="i">+                    Icon(
</a><a href="#h4-0-406" id="h4-0-406" class="i">+                        imageVector = icon,
</a><a href="#h4-0-407" id="h4-0-407" class="i">+                        contentDescription = null,
</a><a href="#h4-0-408" id="h4-0-408" class="i">+                        modifier = Modifier
</a><a href="#h4-0-409" id="h4-0-409" class="i">+                            .align(Alignment.CenterVertically)
</a><a href="#h4-0-410" id="h4-0-410" class="i">+                            .padding(start = 10.dp)
</a><a href="#h4-0-411" id="h4-0-411" class="i">+                    )
</a><a href="#h4-0-412" id="h4-0-412" class="i">+                }
</a><a href="#h4-0-413" id="h4-0-413" class="i">+
</a><a href="#h4-0-414" id="h4-0-414" class="i">+                Column(
</a><a href="#h4-0-415" id="h4-0-415" class="i">+                    modifier = Modifier
</a><a href="#h4-0-416" id="h4-0-416" class="i">+                        .align(Alignment.CenterVertically)
</a><a href="#h4-0-417" id="h4-0-417" class="i">+                        .weight(1f, fill = true)
</a><a href="#h4-0-418" id="h4-0-418" class="i">+                        .padding(all = 10.dp)
</a><a href="#h4-0-419" id="h4-0-419" class="i">+                ) {
</a><a href="#h4-0-420" id="h4-0-420" class="i">+                    Text(
</a><a href="#h4-0-421" id="h4-0-421" class="i">+                        text = context.translation[property.key.propertyName()],
</a><a href="#h4-0-422" id="h4-0-422" class="i">+                        fontSize = 16.sp,
</a><a href="#h4-0-423" id="h4-0-423" class="i">+                        fontWeight = FontWeight.Bold
</a><a href="#h4-0-424" id="h4-0-424" class="i">+                    )
</a><a href="#h4-0-425" id="h4-0-425" class="i">+                    Text(
</a><a href="#h4-0-426" id="h4-0-426" class="i">+                        text = context.translation[property.key.propertyDescription()],
</a><a href="#h4-0-427" id="h4-0-427" class="i">+                        fontSize = 12.sp,
</a><a href="#h4-0-428" id="h4-0-428" class="i">+                        lineHeight = 15.sp
</a><a href="#h4-0-429" id="h4-0-429" class="i">+                    )
</a><a href="#h4-0-430" id="h4-0-430" class="i">+                    property.key.params.notices.also {
</a><a href="#h4-0-431" id="h4-0-431" class="i">+                        if (it.isNotEmpty()) Spacer(modifier = Modifier.height(5.dp))
</a><a href="#h4-0-432" id="h4-0-432" class="i">+                    }.forEach {
</a><a href="#h4-0-433" id="h4-0-433" class="i">+                        Text(
</a><a href="#h4-0-434" id="h4-0-434" class="i">+                            text = context.translation[&quot;features.notices.${it.key}&quot;],
</a><a href="#h4-0-435" id="h4-0-435" class="i">+                            color = noticeColorMap[it.key] ?: Color(0xFFFFFB87),
</a><a href="#h4-0-436" id="h4-0-436" class="i">+                            fontSize = 12.sp,
</a><a href="#h4-0-437" id="h4-0-437" class="i">+                            lineHeight = 15.sp
</a><a href="#h4-0-438" id="h4-0-438" class="i">+                        )
</a><a href="#h4-0-439" id="h4-0-439" class="i">+                    }
</a><a href="#h4-0-440" id="h4-0-440" class="i">+                }
</a><a href="#h4-0-441" id="h4-0-441" class="i">+                Row(
</a><a href="#h4-0-442" id="h4-0-442" class="i">+                    modifier = Modifier
</a><a href="#h4-0-443" id="h4-0-443" class="i">+                        .align(Alignment.CenterVertically)
</a><a href="#h4-0-444" id="h4-0-444" class="i">+                        .padding(all = 10.dp),
</a><a href="#h4-0-445" id="h4-0-445" class="i">+                    verticalAlignment = Alignment.CenterVertically
</a><a href="#h4-0-446" id="h4-0-446" class="i">+                ) {
</a><a href="#h4-0-447" id="h4-0-447" class="i">+                    PropertyAction(property, registerClickCallback = { callback -&gt;
</a><a href="#h4-0-448" id="h4-0-448" class="i">+                        clickCallback = callback
</a><a href="#h4-0-449" id="h4-0-449" class="i">+                        callback
</a><a href="#h4-0-450" id="h4-0-450" class="i">+                    })
</a><a href="#h4-0-451" id="h4-0-451" class="i">+                }
</a><a href="#h4-0-452" id="h4-0-452" class="i">+            }
</a><a href="#h4-0-453" id="h4-0-453" class="i">+        }
</a><a href="#h4-0-454" id="h4-0-454" class="i">+    }
</a><a href="#h4-0-455" id="h4-0-455" class="i">+
</a><a href="#h4-0-456" id="h4-0-456" class="i">+    @Composable
</a><a href="#h4-0-457" id="h4-0-457" class="i">+    private fun FeatureSearchBar(rowScope: RowScope, focusRequester: FocusRequester) {
</a><a href="#h4-0-458" id="h4-0-458" class="i">+        var searchValue by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h4-0-459" id="h4-0-459" class="i">+        val scope = rememberCoroutineScope()
</a><a href="#h4-0-460" id="h4-0-460" class="i">+        var currentSearchJob by remember { mutableStateOf&lt;Job?&gt;(null) }
</a><a href="#h4-0-461" id="h4-0-461" class="i">+
</a><a href="#h4-0-462" id="h4-0-462" class="i">+        rowScope.apply {
</a><a href="#h4-0-463" id="h4-0-463" class="i">+            TextField(
</a><a href="#h4-0-464" id="h4-0-464" class="i">+                value = searchValue,
</a><a href="#h4-0-465" id="h4-0-465" class="i">+                onValueChange = { keyword -&gt;
</a><a href="#h4-0-466" id="h4-0-466" class="i">+                    searchValue = keyword
</a><a href="#h4-0-467" id="h4-0-467" class="i">+                    if (keyword.isEmpty()) {
</a><a href="#h4-0-468" id="h4-0-468" class="i">+                        navigateToMainRoot()
</a><a href="#h4-0-469" id="h4-0-469" class="i">+                        return@TextField
</a><a href="#h4-0-470" id="h4-0-470" class="i">+                    }
</a><a href="#h4-0-471" id="h4-0-471" class="i">+                    currentSearchJob?.cancel()
</a><a href="#h4-0-472" id="h4-0-472" class="i">+                    scope.launch {
</a><a href="#h4-0-473" id="h4-0-473" class="i">+                        delay(150)
</a><a href="#h4-0-474" id="h4-0-474" class="i">+                        routes.navController.navigate(SEARCH_FEATURE_ROUTE.replace(&quot;{keyword}&quot;, keyword), NavOptions.Builder()
</a><a href="#h4-0-475" id="h4-0-475" class="i">+                            .setLaunchSingleTop(true)
</a><a href="#h4-0-476" id="h4-0-476" class="i">+                            .setPopUpTo(routeInfo.id, false)
</a><a href="#h4-0-477" id="h4-0-477" class="i">+                            .build()
</a><a href="#h4-0-478" id="h4-0-478" class="i">+                        )
</a><a href="#h4-0-479" id="h4-0-479" class="i">+                    }.also { currentSearchJob = it }
</a><a href="#h4-0-480" id="h4-0-480" class="i">+                },
</a><a href="#h4-0-481" id="h4-0-481" class="i">+
</a><a href="#h4-0-482" id="h4-0-482" class="i">+                keyboardActions = KeyboardActions(onDone = {
</a><a href="#h4-0-483" id="h4-0-483" class="i">+                    focusRequester.freeFocus()
</a><a href="#h4-0-484" id="h4-0-484" class="i">+                }),
</a><a href="#h4-0-485" id="h4-0-485" class="i">+                modifier = Modifier
</a><a href="#h4-0-486" id="h4-0-486" class="i">+                    .focusRequester(focusRequester)
</a><a href="#h4-0-487" id="h4-0-487" class="i">+                    .weight(1f, fill = true)
</a><a href="#h4-0-488" id="h4-0-488" class="i">+                    .padding(end = 10.dp)
</a><a href="#h4-0-489" id="h4-0-489" class="i">+                    .height(70.dp),
</a><a href="#h4-0-490" id="h4-0-490" class="i">+                singleLine = true,
</a><a href="#h4-0-491" id="h4-0-491" class="i">+                colors = TextFieldDefaults.colors(
</a><a href="#h4-0-492" id="h4-0-492" class="i">+                    unfocusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h4-0-493" id="h4-0-493" class="i">+                    focusedContainerColor = MaterialTheme.colorScheme.surface,
</a><a href="#h4-0-494" id="h4-0-494" class="i">+                    focusedIndicatorColor = Color.Transparent,
</a><a href="#h4-0-495" id="h4-0-495" class="i">+                    unfocusedIndicatorColor = Color.Transparent,
</a><a href="#h4-0-496" id="h4-0-496" class="i">+                    disabledIndicatorColor = Color.Transparent,
</a><a href="#h4-0-497" id="h4-0-497" class="i">+                    cursorColor = MaterialTheme.colorScheme.primary
</a><a href="#h4-0-498" id="h4-0-498" class="i">+                )
</a><a href="#h4-0-499" id="h4-0-499" class="i">+            )
</a><a href="#h4-0-500" id="h4-0-500" class="i">+        }
</a><a href="#h4-0-501" id="h4-0-501" class="i">+    }
</a><a href="#h4-0-502" id="h4-0-502" class="i">+
</a><a href="#h4-0-503" id="h4-0-503" class="i">+    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = topBarActions@{
</a><a href="#h4-0-504" id="h4-0-504" class="i">+        var showSearchBar by remember { mutableStateOf(false) }
</a><a href="#h4-0-505" id="h4-0-505" class="i">+        val focusRequester = remember { FocusRequester() }
</a><a href="#h4-0-506" id="h4-0-506" class="i">+
</a><a href="#h4-0-507" id="h4-0-507" class="i">+        if (showSearchBar) {
</a><a href="#h4-0-508" id="h4-0-508" class="i">+            FeatureSearchBar(this, focusRequester)
</a><a href="#h4-0-509" id="h4-0-509" class="i">+            LaunchedEffect(true) {
</a><a href="#h4-0-510" id="h4-0-510" class="i">+                focusRequester.requestFocus()
</a><a href="#h4-0-511" id="h4-0-511" class="i">+            }
</a><a href="#h4-0-512" id="h4-0-512" class="i">+        }
</a><a href="#h4-0-513" id="h4-0-513" class="i">+
</a><a href="#h4-0-514" id="h4-0-514" class="i">+        IconButton(onClick = {
</a><a href="#h4-0-515" id="h4-0-515" class="i">+            showSearchBar = showSearchBar.not()
</a><a href="#h4-0-516" id="h4-0-516" class="i">+            if (!showSearchBar &amp;&amp; routes.currentDestination == SEARCH_FEATURE_ROUTE) {
</a><a href="#h4-0-517" id="h4-0-517" class="i">+                navigateToMainRoot()
</a><a href="#h4-0-518" id="h4-0-518" class="i">+            }
</a><a href="#h4-0-519" id="h4-0-519" class="i">+        }) {
</a><a href="#h4-0-520" id="h4-0-520" class="i">+            Icon(
</a><a href="#h4-0-521" id="h4-0-521" class="i">+                imageVector = if (showSearchBar) Icons.Filled.Close
</a><a href="#h4-0-522" id="h4-0-522" class="i">+                else Icons.Filled.Search,
</a><a href="#h4-0-523" id="h4-0-523" class="i">+                contentDescription = null
</a><a href="#h4-0-524" id="h4-0-524" class="i">+            )
</a><a href="#h4-0-525" id="h4-0-525" class="i">+        }
</a><a href="#h4-0-526" id="h4-0-526" class="i">+
</a><a href="#h4-0-527" id="h4-0-527" class="i">+        if (showSearchBar) return@topBarActions
</a><a href="#h4-0-528" id="h4-0-528" class="i">+
</a><a href="#h4-0-529" id="h4-0-529" class="i">+        var showExportDropdownMenu by remember { mutableStateOf(false) }
</a><a href="#h4-0-530" id="h4-0-530" class="i">+        var showResetConfirmationDialog by remember { mutableStateOf(false) }
</a><a href="#h4-0-531" id="h4-0-531" class="i">+        var showExportDialog by remember { mutableStateOf(false) }
</a><a href="#h4-0-532" id="h4-0-532" class="i">+
</a><a href="#h4-0-533" id="h4-0-533" class="i">+        if (showResetConfirmationDialog) {
</a><a href="#h4-0-534" id="h4-0-534" class="i">+            AlertDialog(
</a><a href="#h4-0-535" id="h4-0-535" class="i">+                title = { Text(text = context.translation[&quot;manager.dialogs.reset_config.title&quot;]) },
</a><a href="#h4-0-536" id="h4-0-536" class="i">+                text = { Text(text = context.translation[&quot;manager.dialogs.reset_config.content&quot;]) },
</a><a href="#h4-0-537" id="h4-0-537" class="i">+                onDismissRequest = { showResetConfirmationDialog = false },
</a><a href="#h4-0-538" id="h4-0-538" class="i">+                confirmButton = {
</a><a href="#h4-0-539" id="h4-0-539" class="i">+                    Button(
</a><a href="#h4-0-540" id="h4-0-540" class="i">+                        onClick = {
</a><a href="#h4-0-541" id="h4-0-541" class="i">+                            context.config.reset()
</a><a href="#h4-0-542" id="h4-0-542" class="i">+                            context.shortToast(context.translation[&quot;manager.dialogs.reset_config.success_toast&quot;])
</a><a href="#h4-0-543" id="h4-0-543" class="i">+                            showResetConfirmationDialog = false
</a><a href="#h4-0-544" id="h4-0-544" class="i">+                        }
</a><a href="#h4-0-545" id="h4-0-545" class="i">+                    ) {
</a><a href="#h4-0-546" id="h4-0-546" class="i">+                        Text(text = context.translation[&quot;button.positive&quot;])
</a><a href="#h4-0-547" id="h4-0-547" class="i">+                    }
</a><a href="#h4-0-548" id="h4-0-548" class="i">+                },
</a><a href="#h4-0-549" id="h4-0-549" class="i">+                dismissButton = {
</a><a href="#h4-0-550" id="h4-0-550" class="i">+                    Button(
</a><a href="#h4-0-551" id="h4-0-551" class="i">+                        onClick = {
</a><a href="#h4-0-552" id="h4-0-552" class="i">+                            showResetConfirmationDialog = false
</a><a href="#h4-0-553" id="h4-0-553" class="i">+                        }
</a><a href="#h4-0-554" id="h4-0-554" class="i">+                    ) {
</a><a href="#h4-0-555" id="h4-0-555" class="i">+                        Text(text = context.translation[&quot;button.negative&quot;])
</a><a href="#h4-0-556" id="h4-0-556" class="i">+                    }
</a><a href="#h4-0-557" id="h4-0-557" class="i">+                }
</a><a href="#h4-0-558" id="h4-0-558" class="i">+            )
</a><a href="#h4-0-559" id="h4-0-559" class="i">+        }
</a><a href="#h4-0-560" id="h4-0-560" class="i">+
</a><a href="#h4-0-561" id="h4-0-561" class="i">+        if (showExportDialog) {
</a><a href="#h4-0-562" id="h4-0-562" class="i">+            fun exportConfig(
</a><a href="#h4-0-563" id="h4-0-563" class="i">+                exportSensitiveData: Boolean
</a><a href="#h4-0-564" id="h4-0-564" class="i">+            ) {
</a><a href="#h4-0-565" id="h4-0-565" class="i">+                showExportDialog = false
</a><a href="#h4-0-566" id="h4-0-566" class="i">+                activityLauncher {
</a><a href="#h4-0-567" id="h4-0-567" class="i">+                    saveFile(&quot;config.json&quot;, &quot;application/json&quot;) { uri -&gt;
</a><a href="#h4-0-568" id="h4-0-568" class="i">+                        runCatching {
</a><a href="#h4-0-569" id="h4-0-569" class="i">+                            context.androidContext.contentResolver.openOutputStream(Uri.parse(uri))?.use {
</a><a href="#h4-0-570" id="h4-0-570" class="i">+                                context.config.writeConfig()
</a><a href="#h4-0-571" id="h4-0-571" class="i">+                                context.config.exportToString(exportSensitiveData).byteInputStream().copyTo(it)
</a><a href="#h4-0-572" id="h4-0-572" class="i">+                                context.shortToast(translation[&quot;config_export_success_toast&quot;])
</a><a href="#h4-0-573" id="h4-0-573" class="i">+                            }
</a><a href="#h4-0-574" id="h4-0-574" class="i">+                        }.onFailure {
</a><a href="#h4-0-575" id="h4-0-575" class="i">+                            context.longToast(translation.format(&quot;config_export_failure_toast&quot;, &quot;error&quot; to it.message.toString()))
</a><a href="#h4-0-576" id="h4-0-576" class="i">+                        }
</a><a href="#h4-0-577" id="h4-0-577" class="i">+                    }
</a><a href="#h4-0-578" id="h4-0-578" class="i">+                }
</a><a href="#h4-0-579" id="h4-0-579" class="i">+            }
</a><a href="#h4-0-580" id="h4-0-580" class="i">+
</a><a href="#h4-0-581" id="h4-0-581" class="i">+            AlertDialog(
</a><a href="#h4-0-582" id="h4-0-582" class="i">+                title = { Text(text = context.translation[&quot;manager.dialogs.export_config.title&quot;]) },
</a><a href="#h4-0-583" id="h4-0-583" class="i">+                text = { Text(text = context.translation[&quot;manager.dialogs.export_config.content&quot;]) },
</a><a href="#h4-0-584" id="h4-0-584" class="i">+                onDismissRequest = { showExportDialog = false },
</a><a href="#h4-0-585" id="h4-0-585" class="i">+                confirmButton = {
</a><a href="#h4-0-586" id="h4-0-586" class="i">+                    Button(
</a><a href="#h4-0-587" id="h4-0-587" class="i">+                        onClick = { exportConfig(true) }
</a><a href="#h4-0-588" id="h4-0-588" class="i">+                    ) {
</a><a href="#h4-0-589" id="h4-0-589" class="i">+                        Text(text = context.translation[&quot;button.positive&quot;])
</a><a href="#h4-0-590" id="h4-0-590" class="i">+                    }
</a><a href="#h4-0-591" id="h4-0-591" class="i">+                },
</a><a href="#h4-0-592" id="h4-0-592" class="i">+                dismissButton = {
</a><a href="#h4-0-593" id="h4-0-593" class="i">+                    Button(
</a><a href="#h4-0-594" id="h4-0-594" class="i">+                        onClick = { exportConfig(false) }
</a><a href="#h4-0-595" id="h4-0-595" class="i">+                    ) {
</a><a href="#h4-0-596" id="h4-0-596" class="i">+                        Text(text = context.translation[&quot;button.negative&quot;])
</a><a href="#h4-0-597" id="h4-0-597" class="i">+                    }
</a><a href="#h4-0-598" id="h4-0-598" class="i">+                }
</a><a href="#h4-0-599" id="h4-0-599" class="i">+            )
</a><a href="#h4-0-600" id="h4-0-600" class="i">+        }
</a><a href="#h4-0-601" id="h4-0-601" class="i">+
</a><a href="#h4-0-602" id="h4-0-602" class="i">+        val actions = remember {
</a><a href="#h4-0-603" id="h4-0-603" class="i">+            mapOf(
</a><a href="#h4-0-604" id="h4-0-604" class="i">+                translation[&quot;export_option&quot;] to { showExportDialog = true },
</a><a href="#h4-0-605" id="h4-0-605" class="i">+                translation[&quot;import_option&quot;] to {
</a><a href="#h4-0-606" id="h4-0-606" class="i">+                    activityLauncher {
</a><a href="#h4-0-607" id="h4-0-607" class="i">+                        openFile(&quot;application/json&quot;) { uri -&gt;
</a><a href="#h4-0-608" id="h4-0-608" class="i">+                            context.androidContext.contentResolver.openInputStream(Uri.parse(uri))?.use {
</a><a href="#h4-0-609" id="h4-0-609" class="i">+                                runCatching {
</a><a href="#h4-0-610" id="h4-0-610" class="i">+                                    context.config.loadFromString(it.readBytes().toString(Charsets.UTF_8))
</a><a href="#h4-0-611" id="h4-0-611" class="i">+                                }.onFailure {
</a><a href="#h4-0-612" id="h4-0-612" class="i">+                                    context.longToast(translation.format(&quot;config_import_failure_toast&quot;, &quot;error&quot; to it.message.toString()))
</a><a href="#h4-0-613" id="h4-0-613" class="i">+                                    return@use
</a><a href="#h4-0-614" id="h4-0-614" class="i">+                                }
</a><a href="#h4-0-615" id="h4-0-615" class="i">+                                context.shortToast(translation[&quot;config_import_success_toast&quot;])
</a><a href="#h4-0-616" id="h4-0-616" class="i">+                                context.coroutineScope.launch(Dispatchers.Main) {
</a><a href="#h4-0-617" id="h4-0-617" class="i">+                                    navigateReload()
</a><a href="#h4-0-618" id="h4-0-618" class="i">+                                }
</a><a href="#h4-0-619" id="h4-0-619" class="i">+                            }
</a><a href="#h4-0-620" id="h4-0-620" class="i">+                        }
</a><a href="#h4-0-621" id="h4-0-621" class="i">+                    }
</a><a href="#h4-0-622" id="h4-0-622" class="i">+                },
</a><a href="#h4-0-623" id="h4-0-623" class="i">+                translation[&quot;reset_option&quot;] to { showResetConfirmationDialog = true }
</a><a href="#h4-0-624" id="h4-0-624" class="i">+            )
</a><a href="#h4-0-625" id="h4-0-625" class="i">+        }
</a><a href="#h4-0-626" id="h4-0-626" class="i">+
</a><a href="#h4-0-627" id="h4-0-627" class="i">+        if (context.activity != null) {
</a><a href="#h4-0-628" id="h4-0-628" class="i">+            IconButton(onClick = { showExportDropdownMenu = !showExportDropdownMenu}) {
</a><a href="#h4-0-629" id="h4-0-629" class="i">+                Icon(
</a><a href="#h4-0-630" id="h4-0-630" class="i">+                    imageVector = Icons.Filled.MoreVert,
</a><a href="#h4-0-631" id="h4-0-631" class="i">+                    contentDescription = null
</a><a href="#h4-0-632" id="h4-0-632" class="i">+                )
</a><a href="#h4-0-633" id="h4-0-633" class="i">+            }
</a><a href="#h4-0-634" id="h4-0-634" class="i">+        }
</a><a href="#h4-0-635" id="h4-0-635" class="i">+
</a><a href="#h4-0-636" id="h4-0-636" class="i">+        if (showExportDropdownMenu) {
</a><a href="#h4-0-637" id="h4-0-637" class="i">+            DropdownMenu(expanded = true, onDismissRequest = { showExportDropdownMenu = false }) {
</a><a href="#h4-0-638" id="h4-0-638" class="i">+                actions.forEach { (name, action) -&gt;
</a><a href="#h4-0-639" id="h4-0-639" class="i">+                    DropdownMenuItem(
</a><a href="#h4-0-640" id="h4-0-640" class="i">+                        text = {
</a><a href="#h4-0-641" id="h4-0-641" class="i">+                            Text(text = name)
</a><a href="#h4-0-642" id="h4-0-642" class="i">+                        },
</a><a href="#h4-0-643" id="h4-0-643" class="i">+                        onClick = {
</a><a href="#h4-0-644" id="h4-0-644" class="i">+                            action()
</a><a href="#h4-0-645" id="h4-0-645" class="i">+                            showExportDropdownMenu = false
</a><a href="#h4-0-646" id="h4-0-646" class="i">+                        }
</a><a href="#h4-0-647" id="h4-0-647" class="i">+                    )
</a><a href="#h4-0-648" id="h4-0-648" class="i">+                }
</a><a href="#h4-0-649" id="h4-0-649" class="i">+            }
</a><a href="#h4-0-650" id="h4-0-650" class="i">+        }
</a><a href="#h4-0-651" id="h4-0-651" class="i">+    }
</a><a href="#h4-0-652" id="h4-0-652" class="i">+
</a><a href="#h4-0-653" id="h4-0-653" class="i">+    @Composable
</a><a href="#h4-0-654" id="h4-0-654" class="i">+    private fun PropertiesView(
</a><a href="#h4-0-655" id="h4-0-655" class="i">+        properties: List&lt;PropertyPair&lt;*&gt;&gt;
</a><a href="#h4-0-656" id="h4-0-656" class="i">+    ) {
</a><a href="#h4-0-657" id="h4-0-657" class="i">+        Scaffold(
</a><a href="#h4-0-658" id="h4-0-658" class="i">+            modifier = Modifier.fillMaxSize(),
</a><a href="#h4-0-659" id="h4-0-659" class="i">+            content = { innerPadding -&gt;
</a><a href="#h4-0-660" id="h4-0-660" class="i">+                LazyColumn(
</a><a href="#h4-0-661" id="h4-0-661" class="i">+                    modifier = Modifier
</a><a href="#h4-0-662" id="h4-0-662" class="i">+                        .fillMaxHeight()
</a><a href="#h4-0-663" id="h4-0-663" class="i">+                        .padding(innerPadding),
</a><a href="#h4-0-664" id="h4-0-664" class="i">+                    //save button space
</a><a href="#h4-0-665" id="h4-0-665" class="i">+                    contentPadding = PaddingValues(top = 10.dp, bottom = 110.dp),
</a><a href="#h4-0-666" id="h4-0-666" class="i">+                    verticalArrangement = Arrangement.Top
</a><a href="#h4-0-667" id="h4-0-667" class="i">+                ) {
</a><a href="#h4-0-668" id="h4-0-668" class="i">+                    items(properties) {
</a><a href="#h4-0-669" id="h4-0-669" class="i">+                        PropertyCard(it)
</a><a href="#h4-0-670" id="h4-0-670" class="i">+                    }
</a><a href="#h4-0-671" id="h4-0-671" class="i">+                }
</a><a href="#h4-0-672" id="h4-0-672" class="i">+            }
</a><a href="#h4-0-673" id="h4-0-673" class="i">+        )
</a><a href="#h4-0-674" id="h4-0-674" class="i">+    }
</a><a href="#h4-0-675" id="h4-0-675" class="i">+
</a><a href="#h4-0-676" id="h4-0-676" class="i">+    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h4-0-677" id="h4-0-677" class="i">+        fun saveConfig() {
</a><a href="#h4-0-678" id="h4-0-678" class="i">+            context.coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h4-0-679" id="h4-0-679" class="i">+                context.config.writeConfig()
</a><a href="#h4-0-680" id="h4-0-680" class="i">+                context.log.verbose(&quot;saved config!&quot;)
</a><a href="#h4-0-681" id="h4-0-681" class="i">+            }
</a><a href="#h4-0-682" id="h4-0-682" class="i">+        }
</a><a href="#h4-0-683" id="h4-0-683" class="i">+
</a><a href="#h4-0-684" id="h4-0-684" class="i">+        OnLifecycleEvent { _, event -&gt;
</a><a href="#h4-0-685" id="h4-0-685" class="i">+            if (event == Lifecycle.Event.ON_PAUSE || event == Lifecycle.Event.ON_STOP) {
</a><a href="#h4-0-686" id="h4-0-686" class="i">+                saveConfig()
</a><a href="#h4-0-687" id="h4-0-687" class="i">+            }
</a><a href="#h4-0-688" id="h4-0-688" class="i">+        }
</a><a href="#h4-0-689" id="h4-0-689" class="i">+
</a><a href="#h4-0-690" id="h4-0-690" class="i">+        DisposableEffect(Unit) {
</a><a href="#h4-0-691" id="h4-0-691" class="i">+            onDispose {
</a><a href="#h4-0-692" id="h4-0-692" class="i">+                saveConfig()
</a><a href="#h4-0-693" id="h4-0-693" class="i">+            }
</a><a href="#h4-0-694" id="h4-0-694" class="i">+        }
</a><a href="#h4-0-695" id="h4-0-695" class="i">+    }
</a><a href="#h4-0-696" id="h4-0-696" class="i">+
</a><a href="#h4-0-697" id="h4-0-697" class="i">+
</a><a href="#h4-0-698" id="h4-0-698" class="i">+    @Composable
</a><a href="#h4-0-699" id="h4-0-699" class="i">+    private fun Container(
</a><a href="#h4-0-700" id="h4-0-700" class="i">+        configContainer: ConfigContainer
</a><a href="#h4-0-701" id="h4-0-701" class="i">+    ) {
</a><a href="#h4-0-702" id="h4-0-702" class="i">+        PropertiesView(remember {
</a><a href="#h4-0-703" id="h4-0-703" class="i">+            configContainer.properties.map { PropertyPair(it.key, it.value) }
</a><a href="#h4-0-704" id="h4-0-704" class="i">+        })
</a><a href="#h4-0-705" id="h4-0-705" class="i">+    }
</a><a href="#h4-0-706" id="h4-0-706" class="i">+}</a><a href="#h4-0-707" id="h4-0-707" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRoot.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRoot.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -1,439 +0,0 @@
</a><a href="#h5-0-0" id="h5-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.pages.home
</a><a href="#h5-0-1" id="h5-0-1" class="d">-
</a><a href="#h5-0-2" id="h5-0-2" class="d">-import android.content.Intent
</a><a href="#h5-0-3" id="h5-0-3" class="d">-import android.net.Uri
</a><a href="#h5-0-4" id="h5-0-4" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h5-0-5" id="h5-0-5" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h5-0-6" id="h5-0-6" class="d">-import androidx.compose.foundation.rememberScrollState
</a><a href="#h5-0-7" id="h5-0-7" class="d">-import androidx.compose.foundation.text.ClickableText
</a><a href="#h5-0-8" id="h5-0-8" class="d">-import androidx.compose.foundation.verticalScroll
</a><a href="#h5-0-9" id="h5-0-9" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h5-0-10" id="h5-0-10" class="d">-import androidx.compose.material.icons.automirrored.filled.Help
</a><a href="#h5-0-11" id="h5-0-11" class="d">-import androidx.compose.material.icons.filled.BugReport
</a><a href="#h5-0-12" id="h5-0-12" class="d">-import androidx.compose.material.icons.filled.MoreVert
</a><a href="#h5-0-13" id="h5-0-13" class="d">-import androidx.compose.material.icons.filled.Settings
</a><a href="#h5-0-14" id="h5-0-14" class="d">-import androidx.compose.material3.*
</a><a href="#h5-0-15" id="h5-0-15" class="d">-import androidx.compose.runtime.*
</a><a href="#h5-0-16" id="h5-0-16" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h5-0-17" id="h5-0-17" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h5-0-18" id="h5-0-18" class="d">-import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h5-0-19" id="h5-0-19" class="d">-import androidx.compose.ui.platform.LocalDensity
</a><a href="#h5-0-20" id="h5-0-20" class="d">-import androidx.compose.ui.res.vectorResource
</a><a href="#h5-0-21" id="h5-0-21" class="d">-import androidx.compose.ui.text.SpanStyle
</a><a href="#h5-0-22" id="h5-0-22" class="d">-import androidx.compose.ui.text.buildAnnotatedString
</a><a href="#h5-0-23" id="h5-0-23" class="d">-import androidx.compose.ui.text.font.Font
</a><a href="#h5-0-24" id="h5-0-24" class="d">-import androidx.compose.ui.text.font.FontFamily
</a><a href="#h5-0-25" id="h5-0-25" class="d">-import androidx.compose.ui.text.font.FontWeight
</a><a href="#h5-0-26" id="h5-0-26" class="d">-import androidx.compose.ui.text.style.TextAlign
</a><a href="#h5-0-27" id="h5-0-27" class="d">-import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h5-0-28" id="h5-0-28" class="d">-import androidx.compose.ui.text.withStyle
</a><a href="#h5-0-29" id="h5-0-29" class="d">-import androidx.compose.ui.unit.Dp
</a><a href="#h5-0-30" id="h5-0-30" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h5-0-31" id="h5-0-31" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h5-0-32" id="h5-0-32" class="d">-import androidx.navigation.NavBackStackEntry
</a><a href="#h5-0-33" id="h5-0-33" class="d">-import kotlinx.coroutines.launch
</a><a href="#h5-0-34" id="h5-0-34" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h5-0-35" id="h5-0-35" class="d">-import me.rhunk.snapenhance.action.EnumQuickActions
</a><a href="#h5-0-36" id="h5-0-36" class="d">-import me.rhunk.snapenhance.common.BuildConfig
</a><a href="#h5-0-37" id="h5-0-37" class="d">-import me.rhunk.snapenhance.common.Constants
</a><a href="#h5-0-38" id="h5-0-38" class="d">-import me.rhunk.snapenhance.common.action.EnumAction
</a><a href="#h5-0-39" id="h5-0-39" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h5-0-40" id="h5-0-40" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h5-0-41" id="h5-0-41" class="d">-import me.rhunk.snapenhance.core.ui.Snapenhance
</a><a href="#h5-0-42" id="h5-0-42" class="d">-import me.rhunk.snapenhance.storage.getQuickTiles
</a><a href="#h5-0-43" id="h5-0-43" class="d">-import me.rhunk.snapenhance.storage.setQuickTiles
</a><a href="#h5-0-44" id="h5-0-44" class="d">-import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h5-0-45" id="h5-0-45" class="d">-import me.rhunk.snapenhance.ui.manager.data.Updater
</a><a href="#h5-0-46" id="h5-0-46" class="d">-import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
</a><a href="#h5-0-47" id="h5-0-47" class="d">-import java.text.DateFormat
</a><a href="#h5-0-48" id="h5-0-48" class="d">-
</a><a href="#h5-0-49" id="h5-0-49" class="d">-class HomeRoot : Routes.Route() {
</a><a href="#h5-0-50" id="h5-0-50" class="d">-    companion object {
</a><a href="#h5-0-51" id="h5-0-51" class="d">-        val cardMargin = 10.dp
</a><a href="#h5-0-52" id="h5-0-52" class="d">-    }
</a><a href="#h5-0-53" id="h5-0-53" class="d">-
</a><a href="#h5-0-54" id="h5-0-54" class="d">-    private lateinit var activityLauncherHelper: ActivityLauncherHelper
</a><a href="#h5-0-55" id="h5-0-55" class="d">-
</a><a href="#h5-0-56" id="h5-0-56" class="d">-    private fun launchActionIntent(action: EnumAction) {
</a><a href="#h5-0-57" id="h5-0-57" class="d">-        val intent = context.androidContext.packageManager.getLaunchIntentForPackage(
</a><a href="#h5-0-58" id="h5-0-58" class="d">-            Constants.SNAPCHAT_PACKAGE_NAME
</a><a href="#h5-0-59" id="h5-0-59" class="d">-        )
</a><a href="#h5-0-60" id="h5-0-60" class="d">-        intent?.putExtra(EnumAction.ACTION_PARAMETER, action.key)
</a><a href="#h5-0-61" id="h5-0-61" class="d">-        context.androidContext.startActivity(intent)
</a><a href="#h5-0-62" id="h5-0-62" class="d">-    }
</a><a href="#h5-0-63" id="h5-0-63" class="d">-
</a><a href="#h5-0-64" id="h5-0-64" class="d">-    private val cards by lazy {
</a><a href="#h5-0-65" id="h5-0-65" class="d">-        EnumQuickActions.entries.map {
</a><a href="#h5-0-66" id="h5-0-66" class="d">-            (context.translation[&quot;actions.${it.key}.name&quot;] to it.icon) to it.action
</a><a href="#h5-0-67" id="h5-0-67" class="d">-        }.associate {
</a><a href="#h5-0-68" id="h5-0-68" class="d">-            it.first to it.second
</a><a href="#h5-0-69" id="h5-0-69" class="d">-        }.toMutableMap().apply {
</a><a href="#h5-0-70" id="h5-0-70" class="d">-            EnumAction.entries.forEach { action -&gt;
</a><a href="#h5-0-71" id="h5-0-71" class="d">-                this[context.translation[&quot;actions.${action.key}.name&quot;] to action.icon] = {
</a><a href="#h5-0-72" id="h5-0-72" class="d">-                    launchActionIntent(action)
</a><a href="#h5-0-73" id="h5-0-73" class="d">-                }
</a><a href="#h5-0-74" id="h5-0-74" class="d">-            }
</a><a href="#h5-0-75" id="h5-0-75" class="d">-        }
</a><a href="#h5-0-76" id="h5-0-76" class="d">-    }
</a><a href="#h5-0-77" id="h5-0-77" class="d">-
</a><a href="#h5-0-78" id="h5-0-78" class="d">-    @Composable
</a><a href="#h5-0-79" id="h5-0-79" class="d">-    private fun InfoCard(
</a><a href="#h5-0-80" id="h5-0-80" class="d">-        content: @Composable ColumnScope.() -&gt; Unit,
</a><a href="#h5-0-81" id="h5-0-81" class="d">-    ) {
</a><a href="#h5-0-82" id="h5-0-82" class="d">-        OutlinedCard(
</a><a href="#h5-0-83" id="h5-0-83" class="d">-            modifier = Modifier
</a><a href="#h5-0-84" id="h5-0-84" class="d">-                .padding(all = cardMargin)
</a><a href="#h5-0-85" id="h5-0-85" class="d">-                .fillMaxWidth(),
</a><a href="#h5-0-86" id="h5-0-86" class="d">-            colors = CardDefaults.cardColors(
</a><a href="#h5-0-87" id="h5-0-87" class="d">-                containerColor = MaterialTheme.colorScheme.surfaceVariant,
</a><a href="#h5-0-88" id="h5-0-88" class="d">-                contentColor = MaterialTheme.colorScheme.onSurfaceVariant
</a><a href="#h5-0-89" id="h5-0-89" class="d">-            )
</a><a href="#h5-0-90" id="h5-0-90" class="d">-        ) {
</a><a href="#h5-0-91" id="h5-0-91" class="d">-            Column(
</a><a href="#h5-0-92" id="h5-0-92" class="d">-                modifier = Modifier
</a><a href="#h5-0-93" id="h5-0-93" class="d">-                    .fillMaxWidth()
</a><a href="#h5-0-94" id="h5-0-94" class="d">-                    .padding(all = 15.dp)
</a><a href="#h5-0-95" id="h5-0-95" class="d">-            ) {
</a><a href="#h5-0-96" id="h5-0-96" class="d">-                content()
</a><a href="#h5-0-97" id="h5-0-97" class="d">-            }
</a><a href="#h5-0-98" id="h5-0-98" class="d">-        }
</a><a href="#h5-0-99" id="h5-0-99" class="d">-    }
</a><a href="#h5-0-100" id="h5-0-100" class="d">-
</a><a href="#h5-0-101" id="h5-0-101" class="d">-    @Composable
</a><a href="#h5-0-102" id="h5-0-102" class="d">-    fun ExternalLinkIcon(
</a><a href="#h5-0-103" id="h5-0-103" class="d">-        modifier: Modifier = Modifier,
</a><a href="#h5-0-104" id="h5-0-104" class="d">-        size: Dp = 32.dp,
</a><a href="#h5-0-105" id="h5-0-105" class="d">-        imageVector: ImageVector,
</a><a href="#h5-0-106" id="h5-0-106" class="d">-        dataArray: IntArray
</a><a href="#h5-0-107" id="h5-0-107" class="d">-    ) {
</a><a href="#h5-0-108" id="h5-0-108" class="d">-        Icon(
</a><a href="#h5-0-109" id="h5-0-109" class="d">-            imageVector = imageVector,
</a><a href="#h5-0-110" id="h5-0-110" class="d">-            contentDescription = null,
</a><a href="#h5-0-111" id="h5-0-111" class="d">-            tint = MaterialTheme.colorScheme.onSurfaceVariant,
</a><a href="#h5-0-112" id="h5-0-112" class="d">-            modifier = Modifier
</a><a href="#h5-0-113" id="h5-0-113" class="d">-                .size(size)
</a><a href="#h5-0-114" id="h5-0-114" class="d">-                .then(modifier)
</a><a href="#h5-0-115" id="h5-0-115" class="d">-                .clickable {
</a><a href="#h5-0-116" id="h5-0-116" class="d">-                    context.activity?.startActivity(Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h5-0-117" id="h5-0-117" class="d">-                        data = Uri.parse(
</a><a href="#h5-0-118" id="h5-0-118" class="d">-                            dataArray.reversed().map { (-it xor BuildConfig.APPLICATION_ID.hashCode()).toChar() }.joinToString(&quot;&quot;)
</a><a href="#h5-0-119" id="h5-0-119" class="d">-                        )
</a><a href="#h5-0-120" id="h5-0-120" class="d">-                        flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h5-0-121" id="h5-0-121" class="d">-                    })
</a><a href="#h5-0-122" id="h5-0-122" class="d">-                }
</a><a href="#h5-0-123" id="h5-0-123" class="d">-        )
</a><a href="#h5-0-124" id="h5-0-124" class="d">-    }
</a><a href="#h5-0-125" id="h5-0-125" class="d">-
</a><a href="#h5-0-126" id="h5-0-126" class="d">-
</a><a href="#h5-0-127" id="h5-0-127" class="d">-    override val init: () -&gt; Unit = {
</a><a href="#h5-0-128" id="h5-0-128" class="d">-        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h5-0-129" id="h5-0-129" class="d">-    }
</a><a href="#h5-0-130" id="h5-0-130" class="d">-
</a><a href="#h5-0-131" id="h5-0-131" class="d">-    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = {
</a><a href="#h5-0-132" id="h5-0-132" class="d">-        IconButton(onClick = {
</a><a href="#h5-0-133" id="h5-0-133" class="d">-            routes.homeLogs.navigate()
</a><a href="#h5-0-134" id="h5-0-134" class="d">-        }) {
</a><a href="#h5-0-135" id="h5-0-135" class="d">-            Icon(Icons.Filled.BugReport, contentDescription = null)
</a><a href="#h5-0-136" id="h5-0-136" class="d">-        }
</a><a href="#h5-0-137" id="h5-0-137" class="d">-        IconButton(onClick = {
</a><a href="#h5-0-138" id="h5-0-138" class="d">-            routes.settings.navigate()
</a><a href="#h5-0-139" id="h5-0-139" class="d">-        }) {
</a><a href="#h5-0-140" id="h5-0-140" class="d">-            Icon(Icons.Filled.Settings, contentDescription = null)
</a><a href="#h5-0-141" id="h5-0-141" class="d">-        }
</a><a href="#h5-0-142" id="h5-0-142" class="d">-    }
</a><a href="#h5-0-143" id="h5-0-143" class="d">-
</a><a href="#h5-0-144" id="h5-0-144" class="d">-
</a><a href="#h5-0-145" id="h5-0-145" class="d">-    @OptIn(ExperimentalLayoutApi::class)
</a><a href="#h5-0-146" id="h5-0-146" class="d">-    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h5-0-147" id="h5-0-147" class="d">-        Column(
</a><a href="#h5-0-148" id="h5-0-148" class="d">-            modifier = Modifier
</a><a href="#h5-0-149" id="h5-0-149" class="d">-                .fillMaxSize()
</a><a href="#h5-0-150" id="h5-0-150" class="d">-                .verticalScroll(rememberScrollState())
</a><a href="#h5-0-151" id="h5-0-151" class="d">-        ) {
</a><a href="#h5-0-152" id="h5-0-152" class="d">-            Icon(
</a><a href="#h5-0-153" id="h5-0-153" class="d">-                imageVector = Snapenhance, contentDescription = null,
</a><a href="#h5-0-154" id="h5-0-154" class="d">-                modifier = Modifier
</a><a href="#h5-0-155" id="h5-0-155" class="d">-                    .fillMaxWidth()
</a><a href="#h5-0-156" id="h5-0-156" class="d">-                    .padding(all = 8.dp)
</a><a href="#h5-0-157" id="h5-0-157" class="d">-                    .align(Alignment.CenterHorizontally),
</a><a href="#h5-0-158" id="h5-0-158" class="d">-                tint = MaterialTheme.colorScheme.onSurfaceVariant,
</a><a href="#h5-0-159" id="h5-0-159" class="d">-            )
</a><a href="#h5-0-160" id="h5-0-160" class="d">-
</a><a href="#h5-0-161" id="h5-0-161" class="d">-            Text(
</a><a href="#h5-0-162" id="h5-0-162" class="d">-                text = translation.format(
</a><a href="#h5-0-163" id="h5-0-163" class="d">-                    &quot;version_title&quot;,
</a><a href="#h5-0-164" id="h5-0-164" class="d">-                    &quot;versionName&quot; to BuildConfig.VERSION_NAME
</a><a href="#h5-0-165" id="h5-0-165" class="d">-                ),
</a><a href="#h5-0-166" id="h5-0-166" class="d">-                fontSize = 12.sp,
</a><a href="#h5-0-167" id="h5-0-167" class="d">-                fontFamily = remember {
</a><a href="#h5-0-168" id="h5-0-168" class="d">-                    FontFamily(
</a><a href="#h5-0-169" id="h5-0-169" class="d">-                        Font(R.font.avenir_next_medium, FontWeight.Medium)
</a><a href="#h5-0-170" id="h5-0-170" class="d">-                    )
</a><a href="#h5-0-171" id="h5-0-171" class="d">-                },
</a><a href="#h5-0-172" id="h5-0-172" class="d">-                modifier = Modifier.align(Alignment.CenterHorizontally),
</a><a href="#h5-0-173" id="h5-0-173" class="d">-            )
</a><a href="#h5-0-174" id="h5-0-174" class="d">-
</a><a href="#h5-0-175" id="h5-0-175" class="d">-            Row(
</a><a href="#h5-0-176" id="h5-0-176" class="d">-                horizontalArrangement = Arrangement.spacedBy(
</a><a href="#h5-0-177" id="h5-0-177" class="d">-                    15.dp, Alignment.CenterHorizontally
</a><a href="#h5-0-178" id="h5-0-178" class="d">-                ), modifier = Modifier
</a><a href="#h5-0-179" id="h5-0-179" class="d">-                    .fillMaxWidth()
</a><a href="#h5-0-180" id="h5-0-180" class="d">-                    .padding(all = 10.dp)
</a><a href="#h5-0-181" id="h5-0-181" class="d">-            ) {
</a><a href="#h5-0-182" id="h5-0-182" class="d">-                ExternalLinkIcon(
</a><a href="#h5-0-183" id="h5-0-183" class="d">-                    imageVector = ImageVector.vectorResource(id = R.drawable.ic_telegram),
</a><a href="#h5-0-184" id="h5-0-184" class="d">-                    // https://t.me/snapenhance
</a><a href="#h5-0-185" id="h5-0-185" class="d">-                    dataArray = intArrayOf(
</a><a href="#h5-0-186" id="h5-0-186" class="d">-                        0xe4f8b47, 0xe4f8b41, 0xe4f8b4e, 0xe4f8b43, 0xe4f8b4c, 0xe4f8b4e, 0xe4f8b47,
</a><a href="#h5-0-187" id="h5-0-187" class="d">-                        0xe4f8b54, 0xe4f8b43, 0xe4f8b4e, 0xe4f8b51, 0xe4f8b0d, 0xe4f8b47, 0xe4f8b4f,
</a><a href="#h5-0-188" id="h5-0-188" class="d">-                        0xe4f8b0e, 0xe4f8b58, 0xe4f8b0d, 0xe4f8b0d, 0xe4f8b1a, 0xe4f8b51, 0xe4f8b54,
</a><a href="#h5-0-189" id="h5-0-189" class="d">-                        0xe4f8b58, 0xe4f8b58, 0xe4f8b4c
</a><a href="#h5-0-190" id="h5-0-190" class="d">-                    )
</a><a href="#h5-0-191" id="h5-0-191" class="d">-                )
</a><a href="#h5-0-192" id="h5-0-192" class="d">-
</a><a href="#h5-0-193" id="h5-0-193" class="d">-                ExternalLinkIcon(
</a><a href="#h5-0-194" id="h5-0-194" class="d">-                    imageVector = ImageVector.vectorResource(id = R.drawable.ic_github),
</a><a href="#h5-0-195" id="h5-0-195" class="d">-                    // https://github.com/rhunk/SnapEnhance
</a><a href="#h5-0-196" id="h5-0-196" class="d">-                    dataArray = intArrayOf(
</a><a href="#h5-0-197" id="h5-0-197" class="d">-                        0xe4f8b47, 0xe4f8b41, 0xe4f8b4e, 0xe4f8b43, 0xe4f8b4c, 0xe4f8b4e, 0xe4f8b67,
</a><a href="#h5-0-198" id="h5-0-198" class="d">-                        0xe4f8b54, 0xe4f8b43, 0xe4f8b4e, 0xe4f8b71, 0xe4f8b0d, 0xe4f8b49, 0xe4f8b4e,
</a><a href="#h5-0-199" id="h5-0-199" class="d">-                        0xe4f8b57, 0xe4f8b4c, 0xe4f8b52, 0xe4f8b0d, 0xe4f8b4f, 0xe4f8b4d, 0xe4f8b41,
</a><a href="#h5-0-200" id="h5-0-200" class="d">-                        0xe4f8b0e, 0xe4f8b42, 0xe4f8b57, 0xe4f8b4c, 0xe4f8b58, 0xe4f8b4b, 0xe4f8b45,
</a><a href="#h5-0-201" id="h5-0-201" class="d">-                        0xe4f8b0d, 0xe4f8b0d, 0xe4f8b1a, 0xe4f8b51, 0xe4f8b54, 0xe4f8b58, 0xe4f8b58,
</a><a href="#h5-0-202" id="h5-0-202" class="d">-                        0xe4f8b4c
</a><a href="#h5-0-203" id="h5-0-203" class="d">-                    )
</a><a href="#h5-0-204" id="h5-0-204" class="d">-                )
</a><a href="#h5-0-205" id="h5-0-205" class="d">-
</a><a href="#h5-0-206" id="h5-0-206" class="d">-                ExternalLinkIcon(
</a><a href="#h5-0-207" id="h5-0-207" class="d">-                    size = 36.dp,
</a><a href="#h5-0-208" id="h5-0-208" class="d">-                    modifier = Modifier.offset(y = (-2).dp),
</a><a href="#h5-0-209" id="h5-0-209" class="d">-                    imageVector = Icons.AutoMirrored.Default.Help,
</a><a href="#h5-0-210" id="h5-0-210" class="d">-                    // https://github.com/rhunk/SnapEnhance/wiki
</a><a href="#h5-0-211" id="h5-0-211" class="d">-                    dataArray = intArrayOf(
</a><a href="#h5-0-212" id="h5-0-212" class="d">-                        0xe4f8b4b, 0xe4f8b49, 0xe4f8b4b, 0xe4f8b55, 0xe4f8b0d, 0xe4f8b47, 0xe4f8b41,
</a><a href="#h5-0-213" id="h5-0-213" class="d">-                        0xe4f8b4e, 0xe4f8b43, 0xe4f8b4c, 0xe4f8b4e, 0xe4f8b67, 0xe4f8b54, 0xe4f8b43,
</a><a href="#h5-0-214" id="h5-0-214" class="d">-                        0xe4f8b4e, 0xe4f8b71, 0xe4f8b0d, 0xe4f8b49, 0xe4f8b4e, 0xe4f8b57, 0xe4f8b4c,
</a><a href="#h5-0-215" id="h5-0-215" class="d">-                        0xe4f8b52, 0xe4f8b0d, 0xe4f8b4f, 0xe4f8b4d, 0xe4f8b41, 0xe4f8b0e, 0xe4f8b42,
</a><a href="#h5-0-216" id="h5-0-216" class="d">-                        0xe4f8b57, 0xe4f8b4c, 0xe4f8b58, 0xe4f8b4b, 0xe4f8b45, 0xe4f8b0d, 0xe4f8b0d,
</a><a href="#h5-0-217" id="h5-0-217" class="d">-                        0xe4f8b1a, 0xe4f8b51, 0xe4f8b54, 0xe4f8b58, 0xe4f8b58, 0xe4f8b4c
</a><a href="#h5-0-218" id="h5-0-218" class="d">-                    )
</a><a href="#h5-0-219" id="h5-0-219" class="d">-                )
</a><a href="#h5-0-220" id="h5-0-220" class="d">-            }
</a><a href="#h5-0-221" id="h5-0-221" class="d">-
</a><a href="#h5-0-222" id="h5-0-222" class="d">-            val selectedTiles = rememberAsyncMutableStateList(defaultValue = listOf()) {
</a><a href="#h5-0-223" id="h5-0-223" class="d">-                context.database.getQuickTiles()
</a><a href="#h5-0-224" id="h5-0-224" class="d">-            }
</a><a href="#h5-0-225" id="h5-0-225" class="d">-
</a><a href="#h5-0-226" id="h5-0-226" class="d">-            val latestUpdate by rememberAsyncMutableState(defaultValue = null) {
</a><a href="#h5-0-227" id="h5-0-227" class="d">-                if (!BuildConfig.DEBUG) Updater.checkForLatestRelease() else null
</a><a href="#h5-0-228" id="h5-0-228" class="d">-            }
</a><a href="#h5-0-229" id="h5-0-229" class="d">-
</a><a href="#h5-0-230" id="h5-0-230" class="d">-            if (latestUpdate != null) {
</a><a href="#h5-0-231" id="h5-0-231" class="d">-                Spacer(modifier = Modifier.height(10.dp))
</a><a href="#h5-0-232" id="h5-0-232" class="d">-                InfoCard {
</a><a href="#h5-0-233" id="h5-0-233" class="d">-                    Row(
</a><a href="#h5-0-234" id="h5-0-234" class="d">-                        modifier = Modifier.fillMaxWidth(),
</a><a href="#h5-0-235" id="h5-0-235" class="d">-                        horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h5-0-236" id="h5-0-236" class="d">-                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h5-0-237" id="h5-0-237" class="d">-                    ) {
</a><a href="#h5-0-238" id="h5-0-238" class="d">-                        Column {
</a><a href="#h5-0-239" id="h5-0-239" class="d">-                            Text(
</a><a href="#h5-0-240" id="h5-0-240" class="d">-                                text = translation[&quot;update_title&quot;],
</a><a href="#h5-0-241" id="h5-0-241" class="d">-                                fontSize = 14.sp,
</a><a href="#h5-0-242" id="h5-0-242" class="d">-                                fontWeight = FontWeight.Bold,
</a><a href="#h5-0-243" id="h5-0-243" class="d">-                            )
</a><a href="#h5-0-244" id="h5-0-244" class="d">-                            Text(
</a><a href="#h5-0-245" id="h5-0-245" class="d">-                                fontSize = 12.sp, text = translation.format(
</a><a href="#h5-0-246" id="h5-0-246" class="d">-                                    &quot;update_content&quot;,
</a><a href="#h5-0-247" id="h5-0-247" class="d">-                                    &quot;version&quot; to (latestUpdate?.versionName ?: &quot;unknown&quot;)
</a><a href="#h5-0-248" id="h5-0-248" class="d">-                                ), lineHeight = 20.sp
</a><a href="#h5-0-249" id="h5-0-249" class="d">-                            )
</a><a href="#h5-0-250" id="h5-0-250" class="d">-                        }
</a><a href="#h5-0-251" id="h5-0-251" class="d">-                        Button(onClick = {
</a><a href="#h5-0-252" id="h5-0-252" class="d">-                            context.activity?.startActivity(Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h5-0-253" id="h5-0-253" class="d">-                                data = Uri.parse(latestUpdate?.releaseUrl)
</a><a href="#h5-0-254" id="h5-0-254" class="d">-                            })
</a><a href="#h5-0-255" id="h5-0-255" class="d">-                        }, modifier = Modifier.height(40.dp)) {
</a><a href="#h5-0-256" id="h5-0-256" class="d">-                            Text(text = translation[&quot;update_button&quot;])
</a><a href="#h5-0-257" id="h5-0-257" class="d">-                        }
</a><a href="#h5-0-258" id="h5-0-258" class="d">-                    }
</a><a href="#h5-0-259" id="h5-0-259" class="d">-                }
</a><a href="#h5-0-260" id="h5-0-260" class="d">-            }
</a><a href="#h5-0-261" id="h5-0-261" class="d">-
</a><a href="#h5-0-262" id="h5-0-262" class="d">-            if (BuildConfig.DEBUG) {
</a><a href="#h5-0-263" id="h5-0-263" class="d">-                Spacer(modifier = Modifier.height(10.dp))
</a><a href="#h5-0-264" id="h5-0-264" class="d">-                InfoCard {
</a><a href="#h5-0-265" id="h5-0-265" class="d">-                    Text(
</a><a href="#h5-0-266" id="h5-0-266" class="d">-                        text = translation[&quot;debug_build_summary_title&quot;],
</a><a href="#h5-0-267" id="h5-0-267" class="d">-                        fontSize = 14.sp,
</a><a href="#h5-0-268" id="h5-0-268" class="d">-                        fontWeight = FontWeight.Bold,
</a><a href="#h5-0-269" id="h5-0-269" class="d">-                    )
</a><a href="#h5-0-270" id="h5-0-270" class="d">-                    val buildSummary = buildAnnotatedString {
</a><a href="#h5-0-271" id="h5-0-271" class="d">-                        withStyle(
</a><a href="#h5-0-272" id="h5-0-272" class="d">-                            style = SpanStyle(
</a><a href="#h5-0-273" id="h5-0-273" class="d">-                                fontSize = 13.sp,
</a><a href="#h5-0-274" id="h5-0-274" class="d">-                                color = MaterialTheme.colorScheme.onSurfaceVariant,
</a><a href="#h5-0-275" id="h5-0-275" class="d">-                                fontWeight = FontWeight.Light
</a><a href="#h5-0-276" id="h5-0-276" class="d">-                            )
</a><a href="#h5-0-277" id="h5-0-277" class="d">-                        ) {
</a><a href="#h5-0-278" id="h5-0-278" class="d">-                            append(
</a><a href="#h5-0-279" id="h5-0-279" class="d">-                                remember {
</a><a href="#h5-0-280" id="h5-0-280" class="d">-                                    translation.format(
</a><a href="#h5-0-281" id="h5-0-281" class="d">-                                        &quot;debug_build_summary_content&quot;,
</a><a href="#h5-0-282" id="h5-0-282" class="d">-                                        &quot;versionName&quot; to BuildConfig.VERSION_NAME,
</a><a href="#h5-0-283" id="h5-0-283" class="d">-                                        &quot;versionCode&quot; to BuildConfig.VERSION_CODE.toString(),
</a><a href="#h5-0-284" id="h5-0-284" class="d">-                                    )
</a><a href="#h5-0-285" id="h5-0-285" class="d">-                                }
</a><a href="#h5-0-286" id="h5-0-286" class="d">-                            )
</a><a href="#h5-0-287" id="h5-0-287" class="d">-                            append(&quot; - &quot;)
</a><a href="#h5-0-288" id="h5-0-288" class="d">-                        }
</a><a href="#h5-0-289" id="h5-0-289" class="d">-                        pushStringAnnotation(
</a><a href="#h5-0-290" id="h5-0-290" class="d">-                            tag = &quot;git_hash&quot;,
</a><a href="#h5-0-291" id="h5-0-291" class="d">-                            annotation = BuildConfig.GIT_HASH
</a><a href="#h5-0-292" id="h5-0-292" class="d">-                        )
</a><a href="#h5-0-293" id="h5-0-293" class="d">-                        withStyle(
</a><a href="#h5-0-294" id="h5-0-294" class="d">-                            style = SpanStyle(
</a><a href="#h5-0-295" id="h5-0-295" class="d">-                                fontSize = 13.sp, fontWeight = FontWeight.Bold,
</a><a href="#h5-0-296" id="h5-0-296" class="d">-                                color = MaterialTheme.colorScheme.primary
</a><a href="#h5-0-297" id="h5-0-297" class="d">-                            )
</a><a href="#h5-0-298" id="h5-0-298" class="d">-                        ) {
</a><a href="#h5-0-299" id="h5-0-299" class="d">-                            append(BuildConfig.GIT_HASH.substring(0, 7))
</a><a href="#h5-0-300" id="h5-0-300" class="d">-                        }
</a><a href="#h5-0-301" id="h5-0-301" class="d">-                        pop()
</a><a href="#h5-0-302" id="h5-0-302" class="d">-                    }
</a><a href="#h5-0-303" id="h5-0-303" class="d">-                    ClickableText(
</a><a href="#h5-0-304" id="h5-0-304" class="d">-                        text = buildSummary,
</a><a href="#h5-0-305" id="h5-0-305" class="d">-                        onClick = { offset -&gt;
</a><a href="#h5-0-306" id="h5-0-306" class="d">-                            buildSummary.getStringAnnotations(
</a><a href="#h5-0-307" id="h5-0-307" class="d">-                                tag = &quot;git_hash&quot;, start = offset, end = offset
</a><a href="#h5-0-308" id="h5-0-308" class="d">-                            )
</a><a href="#h5-0-309" id="h5-0-309" class="d">-                                .firstOrNull()?.let {
</a><a href="#h5-0-310" id="h5-0-310" class="d">-                                    context.activity?.startActivity(
</a><a href="#h5-0-311" id="h5-0-311" class="d">-                                        Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h5-0-312" id="h5-0-312" class="d">-                                            data = Uri.parse(
</a><a href="#h5-0-313" id="h5-0-313" class="d">-                                                &quot;https://github.com/rhunk/SnapEnhance/commit/${it.item}&quot;
</a><a href="#h5-0-314" id="h5-0-314" class="d">-                                            )
</a><a href="#h5-0-315" id="h5-0-315" class="d">-                                        })
</a><a href="#h5-0-316" id="h5-0-316" class="d">-                                }
</a><a href="#h5-0-317" id="h5-0-317" class="d">-                        }
</a><a href="#h5-0-318" id="h5-0-318" class="d">-                    )
</a><a href="#h5-0-319" id="h5-0-319" class="d">-                    Text(
</a><a href="#h5-0-320" id="h5-0-320" class="d">-                        fontSize = 12.sp,
</a><a href="#h5-0-321" id="h5-0-321" class="d">-                        text = remember {
</a><a href="#h5-0-322" id="h5-0-322" class="d">-                            translation.format(
</a><a href="#h5-0-323" id="h5-0-323" class="d">-                                &quot;debug_build_summary_date&quot;,
</a><a href="#h5-0-324" id="h5-0-324" class="d">-                                &quot;date&quot; to DateFormat.getDateTimeInstance()
</a><a href="#h5-0-325" id="h5-0-325" class="d">-                                    .format(BuildConfig.BUILD_TIMESTAMP),
</a><a href="#h5-0-326" id="h5-0-326" class="d">-                                &quot;days&quot; to ((System.currentTimeMillis() - BuildConfig.BUILD_TIMESTAMP) / 86400000).toInt()
</a><a href="#h5-0-327" id="h5-0-327" class="d">-                                    .toString()
</a><a href="#h5-0-328" id="h5-0-328" class="d">-                            )
</a><a href="#h5-0-329" id="h5-0-329" class="d">-                        },
</a><a href="#h5-0-330" id="h5-0-330" class="d">-                        lineHeight = 20.sp,
</a><a href="#h5-0-331" id="h5-0-331" class="d">-                        fontWeight = FontWeight.Light
</a><a href="#h5-0-332" id="h5-0-332" class="d">-                    )
</a><a href="#h5-0-333" id="h5-0-333" class="d">-                }
</a><a href="#h5-0-334" id="h5-0-334" class="d">-            }
</a><a href="#h5-0-335" id="h5-0-335" class="d">-
</a><a href="#h5-0-336" id="h5-0-336" class="d">-            var showQuickActionsMenu by remember { mutableStateOf(false) }
</a><a href="#h5-0-337" id="h5-0-337" class="d">-
</a><a href="#h5-0-338" id="h5-0-338" class="d">-            Row(
</a><a href="#h5-0-339" id="h5-0-339" class="d">-                modifier = Modifier
</a><a href="#h5-0-340" id="h5-0-340" class="d">-                    .fillMaxWidth()
</a><a href="#h5-0-341" id="h5-0-341" class="d">-                    .padding(start = 20.dp, end = 10.dp, top = 20.dp),
</a><a href="#h5-0-342" id="h5-0-342" class="d">-                verticalAlignment = Alignment.CenterVertically
</a><a href="#h5-0-343" id="h5-0-343" class="d">-            ) {
</a><a href="#h5-0-344" id="h5-0-344" class="d">-                Text(
</a><a href="#h5-0-345" id="h5-0-345" class="d">-                    translation[&quot;quick_actions_title&quot;], fontSize = 20.sp,
</a><a href="#h5-0-346" id="h5-0-346" class="d">-                    modifier = Modifier.weight(1f)
</a><a href="#h5-0-347" id="h5-0-347" class="d">-                )
</a><a href="#h5-0-348" id="h5-0-348" class="d">-                Box {
</a><a href="#h5-0-349" id="h5-0-349" class="d">-                    IconButton(
</a><a href="#h5-0-350" id="h5-0-350" class="d">-                        onClick = { showQuickActionsMenu = !showQuickActionsMenu },
</a><a href="#h5-0-351" id="h5-0-351" class="d">-                    ) {
</a><a href="#h5-0-352" id="h5-0-352" class="d">-                        Icon(Icons.Default.MoreVert, contentDescription = null)
</a><a href="#h5-0-353" id="h5-0-353" class="d">-                    }
</a><a href="#h5-0-354" id="h5-0-354" class="d">-                    DropdownMenu(
</a><a href="#h5-0-355" id="h5-0-355" class="d">-                        expanded = showQuickActionsMenu,
</a><a href="#h5-0-356" id="h5-0-356" class="d">-                        onDismissRequest = { showQuickActionsMenu = false }
</a><a href="#h5-0-357" id="h5-0-357" class="d">-                    ) {
</a><a href="#h5-0-358" id="h5-0-358" class="d">-                        cards.forEach { (card, _) -&gt;
</a><a href="#h5-0-359" id="h5-0-359" class="d">-                            fun toggle(state: Boolean? = null) {
</a><a href="#h5-0-360" id="h5-0-360" class="d">-                                if (state?.let { !it } ?: selectedTiles.contains(card.first)) {
</a><a href="#h5-0-361" id="h5-0-361" class="d">-                                    selectedTiles.remove(card.first)
</a><a href="#h5-0-362" id="h5-0-362" class="d">-                                } else {
</a><a href="#h5-0-363" id="h5-0-363" class="d">-                                    selectedTiles.add(0, card.first)
</a><a href="#h5-0-364" id="h5-0-364" class="d">-                                }
</a><a href="#h5-0-365" id="h5-0-365" class="d">-                                context.coroutineScope.launch {
</a><a href="#h5-0-366" id="h5-0-366" class="d">-                                    context.database.setQuickTiles(selectedTiles)
</a><a href="#h5-0-367" id="h5-0-367" class="d">-                                }
</a><a href="#h5-0-368" id="h5-0-368" class="d">-                            }
</a><a href="#h5-0-369" id="h5-0-369" class="d">-
</a><a href="#h5-0-370" id="h5-0-370" class="d">-                            DropdownMenuItem(onClick = { toggle() }, text = {
</a><a href="#h5-0-371" id="h5-0-371" class="d">-                                Row(
</a><a href="#h5-0-372" id="h5-0-372" class="d">-                                    verticalAlignment = Alignment.CenterVertically,
</a><a href="#h5-0-373" id="h5-0-373" class="d">-                                    modifier = Modifier.padding(all = 5.dp)
</a><a href="#h5-0-374" id="h5-0-374" class="d">-                                ) {
</a><a href="#h5-0-375" id="h5-0-375" class="d">-                                    Checkbox(
</a><a href="#h5-0-376" id="h5-0-376" class="d">-                                        checked = selectedTiles.contains(card.first),
</a><a href="#h5-0-377" id="h5-0-377" class="d">-                                        onCheckedChange = {
</a><a href="#h5-0-378" id="h5-0-378" class="d">-                                            toggle(it)
</a><a href="#h5-0-379" id="h5-0-379" class="d">-                                        }
</a><a href="#h5-0-380" id="h5-0-380" class="d">-                                    )
</a><a href="#h5-0-381" id="h5-0-381" class="d">-                                    Text(text = card.first)
</a><a href="#h5-0-382" id="h5-0-382" class="d">-                                }
</a><a href="#h5-0-383" id="h5-0-383" class="d">-                            })
</a><a href="#h5-0-384" id="h5-0-384" class="d">-                        }
</a><a href="#h5-0-385" id="h5-0-385" class="d">-                    }
</a><a href="#h5-0-386" id="h5-0-386" class="d">-                }
</a><a href="#h5-0-387" id="h5-0-387" class="d">-            }
</a><a href="#h5-0-388" id="h5-0-388" class="d">-
</a><a href="#h5-0-389" id="h5-0-389" class="d">-            FlowRow(
</a><a href="#h5-0-390" id="h5-0-390" class="d">-                modifier = Modifier
</a><a href="#h5-0-391" id="h5-0-391" class="d">-                    .padding(all = cardMargin)
</a><a href="#h5-0-392" id="h5-0-392" class="d">-                    .fillMaxWidth(),
</a><a href="#h5-0-393" id="h5-0-393" class="d">-                maxItemsInEachRow = 3,
</a><a href="#h5-0-394" id="h5-0-394" class="d">-                horizontalArrangement = Arrangement.SpaceEvenly,
</a><a href="#h5-0-395" id="h5-0-395" class="d">-            ) {
</a><a href="#h5-0-396" id="h5-0-396" class="d">-                val tileHeight = LocalDensity.current.run {
</a><a href="#h5-0-397" id="h5-0-397" class="d">-                    remember { (context.androidContext.resources.displayMetrics.widthPixels / 3).toDp() - cardMargin / 2 }
</a><a href="#h5-0-398" id="h5-0-398" class="d">-                }
</a><a href="#h5-0-399" id="h5-0-399" class="d">-
</a><a href="#h5-0-400" id="h5-0-400" class="d">-                remember(selectedTiles.size, context.translation.loadedLocale) {
</a><a href="#h5-0-401" id="h5-0-401" class="d">-                    selectedTiles.mapNotNull {
</a><a href="#h5-0-402" id="h5-0-402" class="d">-                        cards.entries.find { entry -&gt; entry.key.first == it }
</a><a href="#h5-0-403" id="h5-0-403" class="d">-                    }
</a><a href="#h5-0-404" id="h5-0-404" class="d">-                }.forEach { (card, action) -&gt;
</a><a href="#h5-0-405" id="h5-0-405" class="d">-                    ElevatedCard(
</a><a href="#h5-0-406" id="h5-0-406" class="d">-                        modifier = Modifier
</a><a href="#h5-0-407" id="h5-0-407" class="d">-                            .height(tileHeight)
</a><a href="#h5-0-408" id="h5-0-408" class="d">-                            .weight(1f)
</a><a href="#h5-0-409" id="h5-0-409" class="d">-                            .clickable { action(routes) }
</a><a href="#h5-0-410" id="h5-0-410" class="d">-                            .padding(all = 6.dp),
</a><a href="#h5-0-411" id="h5-0-411" class="d">-                    ) {
</a><a href="#h5-0-412" id="h5-0-412" class="d">-                        Column(
</a><a href="#h5-0-413" id="h5-0-413" class="d">-                            modifier = Modifier
</a><a href="#h5-0-414" id="h5-0-414" class="d">-                                .fillMaxSize()
</a><a href="#h5-0-415" id="h5-0-415" class="d">-                                .padding(all = 5.dp),
</a><a href="#h5-0-416" id="h5-0-416" class="d">-                            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h5-0-417" id="h5-0-417" class="d">-                            verticalArrangement = Arrangement.SpaceEvenly,
</a><a href="#h5-0-418" id="h5-0-418" class="d">-                        ) {
</a><a href="#h5-0-419" id="h5-0-419" class="d">-                            Icon(
</a><a href="#h5-0-420" id="h5-0-420" class="d">-                                imageVector = card.second, contentDescription = null,
</a><a href="#h5-0-421" id="h5-0-421" class="d">-                                tint = MaterialTheme.colorScheme.onSurfaceVariant,
</a><a href="#h5-0-422" id="h5-0-422" class="d">-                                modifier = Modifier.size(50.dp)
</a><a href="#h5-0-423" id="h5-0-423" class="d">-                            )
</a><a href="#h5-0-424" id="h5-0-424" class="d">-                            Text(
</a><a href="#h5-0-425" id="h5-0-425" class="d">-                                text = card.first,
</a><a href="#h5-0-426" id="h5-0-426" class="d">-                                lineHeight = 16.sp,
</a><a href="#h5-0-427" id="h5-0-427" class="d">-                                fontSize = 14.sp,
</a><a href="#h5-0-428" id="h5-0-428" class="d">-                                fontWeight = FontWeight.Bold,
</a><a href="#h5-0-429" id="h5-0-429" class="d">-                                textAlign = TextAlign.Center,
</a><a href="#h5-0-430" id="h5-0-430" class="d">-                                overflow = TextOverflow.Ellipsis,
</a><a href="#h5-0-431" id="h5-0-431" class="d">-                            )
</a><a href="#h5-0-432" id="h5-0-432" class="d">-                        }
</a><a href="#h5-0-433" id="h5-0-433" class="d">-                    }
</a><a href="#h5-0-434" id="h5-0-434" class="d">-                }
</a><a href="#h5-0-435" id="h5-0-435" class="d">-            }
</a><a href="#h5-0-436" id="h5-0-436" class="d">-        }
</a><a href="#h5-0-437" id="h5-0-437" class="d">-    }
</a><a href="#h5-0-438" id="h5-0-438" class="d">-}
</a><b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRootSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/home/HomeRootSection.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -0,0 +1,439 @@
</a><a href="#h6-0-0" id="h6-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages.home
</a><a href="#h6-0-1" id="h6-0-1" class="i">+
</a><a href="#h6-0-2" id="h6-0-2" class="i">+import android.content.Intent
</a><a href="#h6-0-3" id="h6-0-3" class="i">+import android.net.Uri
</a><a href="#h6-0-4" id="h6-0-4" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h6-0-5" id="h6-0-5" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h6-0-6" id="h6-0-6" class="i">+import androidx.compose.foundation.rememberScrollState
</a><a href="#h6-0-7" id="h6-0-7" class="i">+import androidx.compose.foundation.text.ClickableText
</a><a href="#h6-0-8" id="h6-0-8" class="i">+import androidx.compose.foundation.verticalScroll
</a><a href="#h6-0-9" id="h6-0-9" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h6-0-10" id="h6-0-10" class="i">+import androidx.compose.material.icons.automirrored.filled.Help
</a><a href="#h6-0-11" id="h6-0-11" class="i">+import androidx.compose.material.icons.filled.BugReport
</a><a href="#h6-0-12" id="h6-0-12" class="i">+import androidx.compose.material.icons.filled.MoreVert
</a><a href="#h6-0-13" id="h6-0-13" class="i">+import androidx.compose.material.icons.filled.Settings
</a><a href="#h6-0-14" id="h6-0-14" class="i">+import androidx.compose.material3.*
</a><a href="#h6-0-15" id="h6-0-15" class="i">+import androidx.compose.runtime.*
</a><a href="#h6-0-16" id="h6-0-16" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h6-0-17" id="h6-0-17" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h6-0-18" id="h6-0-18" class="i">+import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h6-0-19" id="h6-0-19" class="i">+import androidx.compose.ui.platform.LocalDensity
</a><a href="#h6-0-20" id="h6-0-20" class="i">+import androidx.compose.ui.res.vectorResource
</a><a href="#h6-0-21" id="h6-0-21" class="i">+import androidx.compose.ui.text.SpanStyle
</a><a href="#h6-0-22" id="h6-0-22" class="i">+import androidx.compose.ui.text.buildAnnotatedString
</a><a href="#h6-0-23" id="h6-0-23" class="i">+import androidx.compose.ui.text.font.Font
</a><a href="#h6-0-24" id="h6-0-24" class="i">+import androidx.compose.ui.text.font.FontFamily
</a><a href="#h6-0-25" id="h6-0-25" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h6-0-26" id="h6-0-26" class="i">+import androidx.compose.ui.text.style.TextAlign
</a><a href="#h6-0-27" id="h6-0-27" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h6-0-28" id="h6-0-28" class="i">+import androidx.compose.ui.text.withStyle
</a><a href="#h6-0-29" id="h6-0-29" class="i">+import androidx.compose.ui.unit.Dp
</a><a href="#h6-0-30" id="h6-0-30" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h6-0-31" id="h6-0-31" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h6-0-32" id="h6-0-32" class="i">+import androidx.navigation.NavBackStackEntry
</a><a href="#h6-0-33" id="h6-0-33" class="i">+import kotlinx.coroutines.launch
</a><a href="#h6-0-34" id="h6-0-34" class="i">+import me.rhunk.snapenhance.R
</a><a href="#h6-0-35" id="h6-0-35" class="i">+import me.rhunk.snapenhance.action.EnumQuickActions
</a><a href="#h6-0-36" id="h6-0-36" class="i">+import me.rhunk.snapenhance.common.BuildConfig
</a><a href="#h6-0-37" id="h6-0-37" class="i">+import me.rhunk.snapenhance.common.Constants
</a><a href="#h6-0-38" id="h6-0-38" class="i">+import me.rhunk.snapenhance.common.action.EnumAction
</a><a href="#h6-0-39" id="h6-0-39" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h6-0-40" id="h6-0-40" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableStateList
</a><a href="#h6-0-41" id="h6-0-41" class="i">+import me.rhunk.snapenhance.core.ui.Snapenhance
</a><a href="#h6-0-42" id="h6-0-42" class="i">+import me.rhunk.snapenhance.storage.getQuickTiles
</a><a href="#h6-0-43" id="h6-0-43" class="i">+import me.rhunk.snapenhance.storage.setQuickTiles
</a><a href="#h6-0-44" id="h6-0-44" class="i">+import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h6-0-45" id="h6-0-45" class="i">+import me.rhunk.snapenhance.ui.manager.data.Updater
</a><a href="#h6-0-46" id="h6-0-46" class="i">+import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
</a><a href="#h6-0-47" id="h6-0-47" class="i">+import java.text.DateFormat
</a><a href="#h6-0-48" id="h6-0-48" class="i">+
</a><a href="#h6-0-49" id="h6-0-49" class="i">+class HomeRootSection : Routes.Route() {
</a><a href="#h6-0-50" id="h6-0-50" class="i">+    companion object {
</a><a href="#h6-0-51" id="h6-0-51" class="i">+        val cardMargin = 10.dp
</a><a href="#h6-0-52" id="h6-0-52" class="i">+    }
</a><a href="#h6-0-53" id="h6-0-53" class="i">+
</a><a href="#h6-0-54" id="h6-0-54" class="i">+    private lateinit var activityLauncherHelper: ActivityLauncherHelper
</a><a href="#h6-0-55" id="h6-0-55" class="i">+
</a><a href="#h6-0-56" id="h6-0-56" class="i">+    private fun launchActionIntent(action: EnumAction) {
</a><a href="#h6-0-57" id="h6-0-57" class="i">+        val intent = context.androidContext.packageManager.getLaunchIntentForPackage(
</a><a href="#h6-0-58" id="h6-0-58" class="i">+            Constants.SNAPCHAT_PACKAGE_NAME
</a><a href="#h6-0-59" id="h6-0-59" class="i">+        )
</a><a href="#h6-0-60" id="h6-0-60" class="i">+        intent?.putExtra(EnumAction.ACTION_PARAMETER, action.key)
</a><a href="#h6-0-61" id="h6-0-61" class="i">+        context.androidContext.startActivity(intent)
</a><a href="#h6-0-62" id="h6-0-62" class="i">+    }
</a><a href="#h6-0-63" id="h6-0-63" class="i">+
</a><a href="#h6-0-64" id="h6-0-64" class="i">+    private val cards by lazy {
</a><a href="#h6-0-65" id="h6-0-65" class="i">+        EnumQuickActions.entries.map {
</a><a href="#h6-0-66" id="h6-0-66" class="i">+            (context.translation[&quot;actions.${it.key}.name&quot;] to it.icon) to it.action
</a><a href="#h6-0-67" id="h6-0-67" class="i">+        }.associate {
</a><a href="#h6-0-68" id="h6-0-68" class="i">+            it.first to it.second
</a><a href="#h6-0-69" id="h6-0-69" class="i">+        }.toMutableMap().apply {
</a><a href="#h6-0-70" id="h6-0-70" class="i">+            EnumAction.entries.forEach { action -&gt;
</a><a href="#h6-0-71" id="h6-0-71" class="i">+                this[context.translation[&quot;actions.${action.key}.name&quot;] to action.icon] = {
</a><a href="#h6-0-72" id="h6-0-72" class="i">+                    launchActionIntent(action)
</a><a href="#h6-0-73" id="h6-0-73" class="i">+                }
</a><a href="#h6-0-74" id="h6-0-74" class="i">+            }
</a><a href="#h6-0-75" id="h6-0-75" class="i">+        }
</a><a href="#h6-0-76" id="h6-0-76" class="i">+    }
</a><a href="#h6-0-77" id="h6-0-77" class="i">+
</a><a href="#h6-0-78" id="h6-0-78" class="i">+    @Composable
</a><a href="#h6-0-79" id="h6-0-79" class="i">+    private fun InfoCard(
</a><a href="#h6-0-80" id="h6-0-80" class="i">+        content: @Composable ColumnScope.() -&gt; Unit,
</a><a href="#h6-0-81" id="h6-0-81" class="i">+    ) {
</a><a href="#h6-0-82" id="h6-0-82" class="i">+        OutlinedCard(
</a><a href="#h6-0-83" id="h6-0-83" class="i">+            modifier = Modifier
</a><a href="#h6-0-84" id="h6-0-84" class="i">+                .padding(all = cardMargin)
</a><a href="#h6-0-85" id="h6-0-85" class="i">+                .fillMaxWidth(),
</a><a href="#h6-0-86" id="h6-0-86" class="i">+            colors = CardDefaults.cardColors(
</a><a href="#h6-0-87" id="h6-0-87" class="i">+                containerColor = MaterialTheme.colorScheme.surfaceVariant,
</a><a href="#h6-0-88" id="h6-0-88" class="i">+                contentColor = MaterialTheme.colorScheme.onSurfaceVariant
</a><a href="#h6-0-89" id="h6-0-89" class="i">+            )
</a><a href="#h6-0-90" id="h6-0-90" class="i">+        ) {
</a><a href="#h6-0-91" id="h6-0-91" class="i">+            Column(
</a><a href="#h6-0-92" id="h6-0-92" class="i">+                modifier = Modifier
</a><a href="#h6-0-93" id="h6-0-93" class="i">+                    .fillMaxWidth()
</a><a href="#h6-0-94" id="h6-0-94" class="i">+                    .padding(all = 15.dp)
</a><a href="#h6-0-95" id="h6-0-95" class="i">+            ) {
</a><a href="#h6-0-96" id="h6-0-96" class="i">+                content()
</a><a href="#h6-0-97" id="h6-0-97" class="i">+            }
</a><a href="#h6-0-98" id="h6-0-98" class="i">+        }
</a><a href="#h6-0-99" id="h6-0-99" class="i">+    }
</a><a href="#h6-0-100" id="h6-0-100" class="i">+
</a><a href="#h6-0-101" id="h6-0-101" class="i">+    @Composable
</a><a href="#h6-0-102" id="h6-0-102" class="i">+    fun ExternalLinkIcon(
</a><a href="#h6-0-103" id="h6-0-103" class="i">+        modifier: Modifier = Modifier,
</a><a href="#h6-0-104" id="h6-0-104" class="i">+        size: Dp = 32.dp,
</a><a href="#h6-0-105" id="h6-0-105" class="i">+        imageVector: ImageVector,
</a><a href="#h6-0-106" id="h6-0-106" class="i">+        dataArray: IntArray
</a><a href="#h6-0-107" id="h6-0-107" class="i">+    ) {
</a><a href="#h6-0-108" id="h6-0-108" class="i">+        Icon(
</a><a href="#h6-0-109" id="h6-0-109" class="i">+            imageVector = imageVector,
</a><a href="#h6-0-110" id="h6-0-110" class="i">+            contentDescription = null,
</a><a href="#h6-0-111" id="h6-0-111" class="i">+            tint = MaterialTheme.colorScheme.onSurfaceVariant,
</a><a href="#h6-0-112" id="h6-0-112" class="i">+            modifier = Modifier
</a><a href="#h6-0-113" id="h6-0-113" class="i">+                .size(size)
</a><a href="#h6-0-114" id="h6-0-114" class="i">+                .then(modifier)
</a><a href="#h6-0-115" id="h6-0-115" class="i">+                .clickable {
</a><a href="#h6-0-116" id="h6-0-116" class="i">+                    context.activity?.startActivity(Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h6-0-117" id="h6-0-117" class="i">+                        data = Uri.parse(
</a><a href="#h6-0-118" id="h6-0-118" class="i">+                            dataArray.reversed().map { (-it xor BuildConfig.APPLICATION_ID.hashCode()).toChar() }.joinToString(&quot;&quot;)
</a><a href="#h6-0-119" id="h6-0-119" class="i">+                        )
</a><a href="#h6-0-120" id="h6-0-120" class="i">+                        flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h6-0-121" id="h6-0-121" class="i">+                    })
</a><a href="#h6-0-122" id="h6-0-122" class="i">+                }
</a><a href="#h6-0-123" id="h6-0-123" class="i">+        )
</a><a href="#h6-0-124" id="h6-0-124" class="i">+    }
</a><a href="#h6-0-125" id="h6-0-125" class="i">+
</a><a href="#h6-0-126" id="h6-0-126" class="i">+
</a><a href="#h6-0-127" id="h6-0-127" class="i">+    override val init: () -&gt; Unit = {
</a><a href="#h6-0-128" id="h6-0-128" class="i">+        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h6-0-129" id="h6-0-129" class="i">+    }
</a><a href="#h6-0-130" id="h6-0-130" class="i">+
</a><a href="#h6-0-131" id="h6-0-131" class="i">+    override val topBarActions: @Composable (RowScope.() -&gt; Unit) = {
</a><a href="#h6-0-132" id="h6-0-132" class="i">+        IconButton(onClick = {
</a><a href="#h6-0-133" id="h6-0-133" class="i">+            routes.homeLogs.navigate()
</a><a href="#h6-0-134" id="h6-0-134" class="i">+        }) {
</a><a href="#h6-0-135" id="h6-0-135" class="i">+            Icon(Icons.Filled.BugReport, contentDescription = null)
</a><a href="#h6-0-136" id="h6-0-136" class="i">+        }
</a><a href="#h6-0-137" id="h6-0-137" class="i">+        IconButton(onClick = {
</a><a href="#h6-0-138" id="h6-0-138" class="i">+            routes.settings.navigate()
</a><a href="#h6-0-139" id="h6-0-139" class="i">+        }) {
</a><a href="#h6-0-140" id="h6-0-140" class="i">+            Icon(Icons.Filled.Settings, contentDescription = null)
</a><a href="#h6-0-141" id="h6-0-141" class="i">+        }
</a><a href="#h6-0-142" id="h6-0-142" class="i">+    }
</a><a href="#h6-0-143" id="h6-0-143" class="i">+
</a><a href="#h6-0-144" id="h6-0-144" class="i">+
</a><a href="#h6-0-145" id="h6-0-145" class="i">+    @OptIn(ExperimentalLayoutApi::class)
</a><a href="#h6-0-146" id="h6-0-146" class="i">+    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h6-0-147" id="h6-0-147" class="i">+        Column(
</a><a href="#h6-0-148" id="h6-0-148" class="i">+            modifier = Modifier
</a><a href="#h6-0-149" id="h6-0-149" class="i">+                .fillMaxSize()
</a><a href="#h6-0-150" id="h6-0-150" class="i">+                .verticalScroll(rememberScrollState())
</a><a href="#h6-0-151" id="h6-0-151" class="i">+        ) {
</a><a href="#h6-0-152" id="h6-0-152" class="i">+            Icon(
</a><a href="#h6-0-153" id="h6-0-153" class="i">+                imageVector = Snapenhance, contentDescription = null,
</a><a href="#h6-0-154" id="h6-0-154" class="i">+                modifier = Modifier
</a><a href="#h6-0-155" id="h6-0-155" class="i">+                    .fillMaxWidth()
</a><a href="#h6-0-156" id="h6-0-156" class="i">+                    .padding(all = 8.dp)
</a><a href="#h6-0-157" id="h6-0-157" class="i">+                    .align(Alignment.CenterHorizontally),
</a><a href="#h6-0-158" id="h6-0-158" class="i">+                tint = MaterialTheme.colorScheme.onSurfaceVariant,
</a><a href="#h6-0-159" id="h6-0-159" class="i">+            )
</a><a href="#h6-0-160" id="h6-0-160" class="i">+
</a><a href="#h6-0-161" id="h6-0-161" class="i">+            Text(
</a><a href="#h6-0-162" id="h6-0-162" class="i">+                text = translation.format(
</a><a href="#h6-0-163" id="h6-0-163" class="i">+                    &quot;version_title&quot;,
</a><a href="#h6-0-164" id="h6-0-164" class="i">+                    &quot;versionName&quot; to BuildConfig.VERSION_NAME
</a><a href="#h6-0-165" id="h6-0-165" class="i">+                ),
</a><a href="#h6-0-166" id="h6-0-166" class="i">+                fontSize = 12.sp,
</a><a href="#h6-0-167" id="h6-0-167" class="i">+                fontFamily = remember {
</a><a href="#h6-0-168" id="h6-0-168" class="i">+                    FontFamily(
</a><a href="#h6-0-169" id="h6-0-169" class="i">+                        Font(R.font.avenir_next_medium, FontWeight.Medium)
</a><a href="#h6-0-170" id="h6-0-170" class="i">+                    )
</a><a href="#h6-0-171" id="h6-0-171" class="i">+                },
</a><a href="#h6-0-172" id="h6-0-172" class="i">+                modifier = Modifier.align(Alignment.CenterHorizontally),
</a><a href="#h6-0-173" id="h6-0-173" class="i">+            )
</a><a href="#h6-0-174" id="h6-0-174" class="i">+
</a><a href="#h6-0-175" id="h6-0-175" class="i">+            Row(
</a><a href="#h6-0-176" id="h6-0-176" class="i">+                horizontalArrangement = Arrangement.spacedBy(
</a><a href="#h6-0-177" id="h6-0-177" class="i">+                    15.dp, Alignment.CenterHorizontally
</a><a href="#h6-0-178" id="h6-0-178" class="i">+                ), modifier = Modifier
</a><a href="#h6-0-179" id="h6-0-179" class="i">+                    .fillMaxWidth()
</a><a href="#h6-0-180" id="h6-0-180" class="i">+                    .padding(all = 10.dp)
</a><a href="#h6-0-181" id="h6-0-181" class="i">+            ) {
</a><a href="#h6-0-182" id="h6-0-182" class="i">+                ExternalLinkIcon(
</a><a href="#h6-0-183" id="h6-0-183" class="i">+                    imageVector = ImageVector.vectorResource(id = R.drawable.ic_telegram),
</a><a href="#h6-0-184" id="h6-0-184" class="i">+                    // https://t.me/snapenhance
</a><a href="#h6-0-185" id="h6-0-185" class="i">+                    dataArray = intArrayOf(
</a><a href="#h6-0-186" id="h6-0-186" class="i">+                        0xe4f8b47, 0xe4f8b41, 0xe4f8b4e, 0xe4f8b43, 0xe4f8b4c, 0xe4f8b4e, 0xe4f8b47,
</a><a href="#h6-0-187" id="h6-0-187" class="i">+                        0xe4f8b54, 0xe4f8b43, 0xe4f8b4e, 0xe4f8b51, 0xe4f8b0d, 0xe4f8b47, 0xe4f8b4f,
</a><a href="#h6-0-188" id="h6-0-188" class="i">+                        0xe4f8b0e, 0xe4f8b58, 0xe4f8b0d, 0xe4f8b0d, 0xe4f8b1a, 0xe4f8b51, 0xe4f8b54,
</a><a href="#h6-0-189" id="h6-0-189" class="i">+                        0xe4f8b58, 0xe4f8b58, 0xe4f8b4c
</a><a href="#h6-0-190" id="h6-0-190" class="i">+                    )
</a><a href="#h6-0-191" id="h6-0-191" class="i">+                )
</a><a href="#h6-0-192" id="h6-0-192" class="i">+
</a><a href="#h6-0-193" id="h6-0-193" class="i">+                ExternalLinkIcon(
</a><a href="#h6-0-194" id="h6-0-194" class="i">+                    imageVector = ImageVector.vectorResource(id = R.drawable.ic_github),
</a><a href="#h6-0-195" id="h6-0-195" class="i">+                    // https://github.com/rhunk/SnapEnhance
</a><a href="#h6-0-196" id="h6-0-196" class="i">+                    dataArray = intArrayOf(
</a><a href="#h6-0-197" id="h6-0-197" class="i">+                        0xe4f8b47, 0xe4f8b41, 0xe4f8b4e, 0xe4f8b43, 0xe4f8b4c, 0xe4f8b4e, 0xe4f8b67,
</a><a href="#h6-0-198" id="h6-0-198" class="i">+                        0xe4f8b54, 0xe4f8b43, 0xe4f8b4e, 0xe4f8b71, 0xe4f8b0d, 0xe4f8b49, 0xe4f8b4e,
</a><a href="#h6-0-199" id="h6-0-199" class="i">+                        0xe4f8b57, 0xe4f8b4c, 0xe4f8b52, 0xe4f8b0d, 0xe4f8b4f, 0xe4f8b4d, 0xe4f8b41,
</a><a href="#h6-0-200" id="h6-0-200" class="i">+                        0xe4f8b0e, 0xe4f8b42, 0xe4f8b57, 0xe4f8b4c, 0xe4f8b58, 0xe4f8b4b, 0xe4f8b45,
</a><a href="#h6-0-201" id="h6-0-201" class="i">+                        0xe4f8b0d, 0xe4f8b0d, 0xe4f8b1a, 0xe4f8b51, 0xe4f8b54, 0xe4f8b58, 0xe4f8b58,
</a><a href="#h6-0-202" id="h6-0-202" class="i">+                        0xe4f8b4c
</a><a href="#h6-0-203" id="h6-0-203" class="i">+                    )
</a><a href="#h6-0-204" id="h6-0-204" class="i">+                )
</a><a href="#h6-0-205" id="h6-0-205" class="i">+
</a><a href="#h6-0-206" id="h6-0-206" class="i">+                ExternalLinkIcon(
</a><a href="#h6-0-207" id="h6-0-207" class="i">+                    size = 36.dp,
</a><a href="#h6-0-208" id="h6-0-208" class="i">+                    modifier = Modifier.offset(y = (-2).dp),
</a><a href="#h6-0-209" id="h6-0-209" class="i">+                    imageVector = Icons.AutoMirrored.Default.Help,
</a><a href="#h6-0-210" id="h6-0-210" class="i">+                    // https://github.com/rhunk/SnapEnhance/wiki
</a><a href="#h6-0-211" id="h6-0-211" class="i">+                    dataArray = intArrayOf(
</a><a href="#h6-0-212" id="h6-0-212" class="i">+                        0xe4f8b4b, 0xe4f8b49, 0xe4f8b4b, 0xe4f8b55, 0xe4f8b0d, 0xe4f8b47, 0xe4f8b41,
</a><a href="#h6-0-213" id="h6-0-213" class="i">+                        0xe4f8b4e, 0xe4f8b43, 0xe4f8b4c, 0xe4f8b4e, 0xe4f8b67, 0xe4f8b54, 0xe4f8b43,
</a><a href="#h6-0-214" id="h6-0-214" class="i">+                        0xe4f8b4e, 0xe4f8b71, 0xe4f8b0d, 0xe4f8b49, 0xe4f8b4e, 0xe4f8b57, 0xe4f8b4c,
</a><a href="#h6-0-215" id="h6-0-215" class="i">+                        0xe4f8b52, 0xe4f8b0d, 0xe4f8b4f, 0xe4f8b4d, 0xe4f8b41, 0xe4f8b0e, 0xe4f8b42,
</a><a href="#h6-0-216" id="h6-0-216" class="i">+                        0xe4f8b57, 0xe4f8b4c, 0xe4f8b58, 0xe4f8b4b, 0xe4f8b45, 0xe4f8b0d, 0xe4f8b0d,
</a><a href="#h6-0-217" id="h6-0-217" class="i">+                        0xe4f8b1a, 0xe4f8b51, 0xe4f8b54, 0xe4f8b58, 0xe4f8b58, 0xe4f8b4c
</a><a href="#h6-0-218" id="h6-0-218" class="i">+                    )
</a><a href="#h6-0-219" id="h6-0-219" class="i">+                )
</a><a href="#h6-0-220" id="h6-0-220" class="i">+            }
</a><a href="#h6-0-221" id="h6-0-221" class="i">+
</a><a href="#h6-0-222" id="h6-0-222" class="i">+            val selectedTiles = rememberAsyncMutableStateList(defaultValue = listOf()) {
</a><a href="#h6-0-223" id="h6-0-223" class="i">+                context.database.getQuickTiles()
</a><a href="#h6-0-224" id="h6-0-224" class="i">+            }
</a><a href="#h6-0-225" id="h6-0-225" class="i">+
</a><a href="#h6-0-226" id="h6-0-226" class="i">+            val latestUpdate by rememberAsyncMutableState(defaultValue = null) {
</a><a href="#h6-0-227" id="h6-0-227" class="i">+                if (!BuildConfig.DEBUG) Updater.checkForLatestRelease() else null
</a><a href="#h6-0-228" id="h6-0-228" class="i">+            }
</a><a href="#h6-0-229" id="h6-0-229" class="i">+
</a><a href="#h6-0-230" id="h6-0-230" class="i">+            if (latestUpdate != null) {
</a><a href="#h6-0-231" id="h6-0-231" class="i">+                Spacer(modifier = Modifier.height(10.dp))
</a><a href="#h6-0-232" id="h6-0-232" class="i">+                InfoCard {
</a><a href="#h6-0-233" id="h6-0-233" class="i">+                    Row(
</a><a href="#h6-0-234" id="h6-0-234" class="i">+                        modifier = Modifier.fillMaxWidth(),
</a><a href="#h6-0-235" id="h6-0-235" class="i">+                        horizontalArrangement = Arrangement.SpaceBetween,
</a><a href="#h6-0-236" id="h6-0-236" class="i">+                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h6-0-237" id="h6-0-237" class="i">+                    ) {
</a><a href="#h6-0-238" id="h6-0-238" class="i">+                        Column {
</a><a href="#h6-0-239" id="h6-0-239" class="i">+                            Text(
</a><a href="#h6-0-240" id="h6-0-240" class="i">+                                text = translation[&quot;update_title&quot;],
</a><a href="#h6-0-241" id="h6-0-241" class="i">+                                fontSize = 14.sp,
</a><a href="#h6-0-242" id="h6-0-242" class="i">+                                fontWeight = FontWeight.Bold,
</a><a href="#h6-0-243" id="h6-0-243" class="i">+                            )
</a><a href="#h6-0-244" id="h6-0-244" class="i">+                            Text(
</a><a href="#h6-0-245" id="h6-0-245" class="i">+                                fontSize = 12.sp, text = translation.format(
</a><a href="#h6-0-246" id="h6-0-246" class="i">+                                    &quot;update_content&quot;,
</a><a href="#h6-0-247" id="h6-0-247" class="i">+                                    &quot;version&quot; to (latestUpdate?.versionName ?: &quot;unknown&quot;)
</a><a href="#h6-0-248" id="h6-0-248" class="i">+                                ), lineHeight = 20.sp
</a><a href="#h6-0-249" id="h6-0-249" class="i">+                            )
</a><a href="#h6-0-250" id="h6-0-250" class="i">+                        }
</a><a href="#h6-0-251" id="h6-0-251" class="i">+                        Button(onClick = {
</a><a href="#h6-0-252" id="h6-0-252" class="i">+                            context.activity?.startActivity(Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h6-0-253" id="h6-0-253" class="i">+                                data = Uri.parse(latestUpdate?.releaseUrl)
</a><a href="#h6-0-254" id="h6-0-254" class="i">+                            })
</a><a href="#h6-0-255" id="h6-0-255" class="i">+                        }, modifier = Modifier.height(40.dp)) {
</a><a href="#h6-0-256" id="h6-0-256" class="i">+                            Text(text = translation[&quot;update_button&quot;])
</a><a href="#h6-0-257" id="h6-0-257" class="i">+                        }
</a><a href="#h6-0-258" id="h6-0-258" class="i">+                    }
</a><a href="#h6-0-259" id="h6-0-259" class="i">+                }
</a><a href="#h6-0-260" id="h6-0-260" class="i">+            }
</a><a href="#h6-0-261" id="h6-0-261" class="i">+
</a><a href="#h6-0-262" id="h6-0-262" class="i">+            if (BuildConfig.DEBUG) {
</a><a href="#h6-0-263" id="h6-0-263" class="i">+                Spacer(modifier = Modifier.height(10.dp))
</a><a href="#h6-0-264" id="h6-0-264" class="i">+                InfoCard {
</a><a href="#h6-0-265" id="h6-0-265" class="i">+                    Text(
</a><a href="#h6-0-266" id="h6-0-266" class="i">+                        text = translation[&quot;debug_build_summary_title&quot;],
</a><a href="#h6-0-267" id="h6-0-267" class="i">+                        fontSize = 14.sp,
</a><a href="#h6-0-268" id="h6-0-268" class="i">+                        fontWeight = FontWeight.Bold,
</a><a href="#h6-0-269" id="h6-0-269" class="i">+                    )
</a><a href="#h6-0-270" id="h6-0-270" class="i">+                    val buildSummary = buildAnnotatedString {
</a><a href="#h6-0-271" id="h6-0-271" class="i">+                        withStyle(
</a><a href="#h6-0-272" id="h6-0-272" class="i">+                            style = SpanStyle(
</a><a href="#h6-0-273" id="h6-0-273" class="i">+                                fontSize = 13.sp,
</a><a href="#h6-0-274" id="h6-0-274" class="i">+                                color = MaterialTheme.colorScheme.onSurfaceVariant,
</a><a href="#h6-0-275" id="h6-0-275" class="i">+                                fontWeight = FontWeight.Light
</a><a href="#h6-0-276" id="h6-0-276" class="i">+                            )
</a><a href="#h6-0-277" id="h6-0-277" class="i">+                        ) {
</a><a href="#h6-0-278" id="h6-0-278" class="i">+                            append(
</a><a href="#h6-0-279" id="h6-0-279" class="i">+                                remember {
</a><a href="#h6-0-280" id="h6-0-280" class="i">+                                    translation.format(
</a><a href="#h6-0-281" id="h6-0-281" class="i">+                                        &quot;debug_build_summary_content&quot;,
</a><a href="#h6-0-282" id="h6-0-282" class="i">+                                        &quot;versionName&quot; to BuildConfig.VERSION_NAME,
</a><a href="#h6-0-283" id="h6-0-283" class="i">+                                        &quot;versionCode&quot; to BuildConfig.VERSION_CODE.toString(),
</a><a href="#h6-0-284" id="h6-0-284" class="i">+                                    )
</a><a href="#h6-0-285" id="h6-0-285" class="i">+                                }
</a><a href="#h6-0-286" id="h6-0-286" class="i">+                            )
</a><a href="#h6-0-287" id="h6-0-287" class="i">+                            append(&quot; - &quot;)
</a><a href="#h6-0-288" id="h6-0-288" class="i">+                        }
</a><a href="#h6-0-289" id="h6-0-289" class="i">+                        pushStringAnnotation(
</a><a href="#h6-0-290" id="h6-0-290" class="i">+                            tag = &quot;git_hash&quot;,
</a><a href="#h6-0-291" id="h6-0-291" class="i">+                            annotation = BuildConfig.GIT_HASH
</a><a href="#h6-0-292" id="h6-0-292" class="i">+                        )
</a><a href="#h6-0-293" id="h6-0-293" class="i">+                        withStyle(
</a><a href="#h6-0-294" id="h6-0-294" class="i">+                            style = SpanStyle(
</a><a href="#h6-0-295" id="h6-0-295" class="i">+                                fontSize = 13.sp, fontWeight = FontWeight.Bold,
</a><a href="#h6-0-296" id="h6-0-296" class="i">+                                color = MaterialTheme.colorScheme.primary
</a><a href="#h6-0-297" id="h6-0-297" class="i">+                            )
</a><a href="#h6-0-298" id="h6-0-298" class="i">+                        ) {
</a><a href="#h6-0-299" id="h6-0-299" class="i">+                            append(BuildConfig.GIT_HASH.substring(0, 7))
</a><a href="#h6-0-300" id="h6-0-300" class="i">+                        }
</a><a href="#h6-0-301" id="h6-0-301" class="i">+                        pop()
</a><a href="#h6-0-302" id="h6-0-302" class="i">+                    }
</a><a href="#h6-0-303" id="h6-0-303" class="i">+                    ClickableText(
</a><a href="#h6-0-304" id="h6-0-304" class="i">+                        text = buildSummary,
</a><a href="#h6-0-305" id="h6-0-305" class="i">+                        onClick = { offset -&gt;
</a><a href="#h6-0-306" id="h6-0-306" class="i">+                            buildSummary.getStringAnnotations(
</a><a href="#h6-0-307" id="h6-0-307" class="i">+                                tag = &quot;git_hash&quot;, start = offset, end = offset
</a><a href="#h6-0-308" id="h6-0-308" class="i">+                            )
</a><a href="#h6-0-309" id="h6-0-309" class="i">+                                .firstOrNull()?.let {
</a><a href="#h6-0-310" id="h6-0-310" class="i">+                                    context.activity?.startActivity(
</a><a href="#h6-0-311" id="h6-0-311" class="i">+                                        Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h6-0-312" id="h6-0-312" class="i">+                                            data = Uri.parse(
</a><a href="#h6-0-313" id="h6-0-313" class="i">+                                                &quot;https://github.com/rhunk/SnapEnhance/commit/${it.item}&quot;
</a><a href="#h6-0-314" id="h6-0-314" class="i">+                                            )
</a><a href="#h6-0-315" id="h6-0-315" class="i">+                                        })
</a><a href="#h6-0-316" id="h6-0-316" class="i">+                                }
</a><a href="#h6-0-317" id="h6-0-317" class="i">+                        }
</a><a href="#h6-0-318" id="h6-0-318" class="i">+                    )
</a><a href="#h6-0-319" id="h6-0-319" class="i">+                    Text(
</a><a href="#h6-0-320" id="h6-0-320" class="i">+                        fontSize = 12.sp,
</a><a href="#h6-0-321" id="h6-0-321" class="i">+                        text = remember {
</a><a href="#h6-0-322" id="h6-0-322" class="i">+                            translation.format(
</a><a href="#h6-0-323" id="h6-0-323" class="i">+                                &quot;debug_build_summary_date&quot;,
</a><a href="#h6-0-324" id="h6-0-324" class="i">+                                &quot;date&quot; to DateFormat.getDateTimeInstance()
</a><a href="#h6-0-325" id="h6-0-325" class="i">+                                    .format(BuildConfig.BUILD_TIMESTAMP),
</a><a href="#h6-0-326" id="h6-0-326" class="i">+                                &quot;days&quot; to ((System.currentTimeMillis() - BuildConfig.BUILD_TIMESTAMP) / 86400000).toInt()
</a><a href="#h6-0-327" id="h6-0-327" class="i">+                                    .toString()
</a><a href="#h6-0-328" id="h6-0-328" class="i">+                            )
</a><a href="#h6-0-329" id="h6-0-329" class="i">+                        },
</a><a href="#h6-0-330" id="h6-0-330" class="i">+                        lineHeight = 20.sp,
</a><a href="#h6-0-331" id="h6-0-331" class="i">+                        fontWeight = FontWeight.Light
</a><a href="#h6-0-332" id="h6-0-332" class="i">+                    )
</a><a href="#h6-0-333" id="h6-0-333" class="i">+                }
</a><a href="#h6-0-334" id="h6-0-334" class="i">+            }
</a><a href="#h6-0-335" id="h6-0-335" class="i">+
</a><a href="#h6-0-336" id="h6-0-336" class="i">+            var showQuickActionsMenu by remember { mutableStateOf(false) }
</a><a href="#h6-0-337" id="h6-0-337" class="i">+
</a><a href="#h6-0-338" id="h6-0-338" class="i">+            Row(
</a><a href="#h6-0-339" id="h6-0-339" class="i">+                modifier = Modifier
</a><a href="#h6-0-340" id="h6-0-340" class="i">+                    .fillMaxWidth()
</a><a href="#h6-0-341" id="h6-0-341" class="i">+                    .padding(start = 20.dp, end = 10.dp, top = 20.dp),
</a><a href="#h6-0-342" id="h6-0-342" class="i">+                verticalAlignment = Alignment.CenterVertically
</a><a href="#h6-0-343" id="h6-0-343" class="i">+            ) {
</a><a href="#h6-0-344" id="h6-0-344" class="i">+                Text(
</a><a href="#h6-0-345" id="h6-0-345" class="i">+                    translation[&quot;quick_actions_title&quot;], fontSize = 20.sp,
</a><a href="#h6-0-346" id="h6-0-346" class="i">+                    modifier = Modifier.weight(1f)
</a><a href="#h6-0-347" id="h6-0-347" class="i">+                )
</a><a href="#h6-0-348" id="h6-0-348" class="i">+                Box {
</a><a href="#h6-0-349" id="h6-0-349" class="i">+                    IconButton(
</a><a href="#h6-0-350" id="h6-0-350" class="i">+                        onClick = { showQuickActionsMenu = !showQuickActionsMenu },
</a><a href="#h6-0-351" id="h6-0-351" class="i">+                    ) {
</a><a href="#h6-0-352" id="h6-0-352" class="i">+                        Icon(Icons.Default.MoreVert, contentDescription = null)
</a><a href="#h6-0-353" id="h6-0-353" class="i">+                    }
</a><a href="#h6-0-354" id="h6-0-354" class="i">+                    DropdownMenu(
</a><a href="#h6-0-355" id="h6-0-355" class="i">+                        expanded = showQuickActionsMenu,
</a><a href="#h6-0-356" id="h6-0-356" class="i">+                        onDismissRequest = { showQuickActionsMenu = false }
</a><a href="#h6-0-357" id="h6-0-357" class="i">+                    ) {
</a><a href="#h6-0-358" id="h6-0-358" class="i">+                        cards.forEach { (card, _) -&gt;
</a><a href="#h6-0-359" id="h6-0-359" class="i">+                            fun toggle(state: Boolean? = null) {
</a><a href="#h6-0-360" id="h6-0-360" class="i">+                                if (state?.let { !it } ?: selectedTiles.contains(card.first)) {
</a><a href="#h6-0-361" id="h6-0-361" class="i">+                                    selectedTiles.remove(card.first)
</a><a href="#h6-0-362" id="h6-0-362" class="i">+                                } else {
</a><a href="#h6-0-363" id="h6-0-363" class="i">+                                    selectedTiles.add(0, card.first)
</a><a href="#h6-0-364" id="h6-0-364" class="i">+                                }
</a><a href="#h6-0-365" id="h6-0-365" class="i">+                                context.coroutineScope.launch {
</a><a href="#h6-0-366" id="h6-0-366" class="i">+                                    context.database.setQuickTiles(selectedTiles)
</a><a href="#h6-0-367" id="h6-0-367" class="i">+                                }
</a><a href="#h6-0-368" id="h6-0-368" class="i">+                            }
</a><a href="#h6-0-369" id="h6-0-369" class="i">+
</a><a href="#h6-0-370" id="h6-0-370" class="i">+                            DropdownMenuItem(onClick = { toggle() }, text = {
</a><a href="#h6-0-371" id="h6-0-371" class="i">+                                Row(
</a><a href="#h6-0-372" id="h6-0-372" class="i">+                                    verticalAlignment = Alignment.CenterVertically,
</a><a href="#h6-0-373" id="h6-0-373" class="i">+                                    modifier = Modifier.padding(all = 5.dp)
</a><a href="#h6-0-374" id="h6-0-374" class="i">+                                ) {
</a><a href="#h6-0-375" id="h6-0-375" class="i">+                                    Checkbox(
</a><a href="#h6-0-376" id="h6-0-376" class="i">+                                        checked = selectedTiles.contains(card.first),
</a><a href="#h6-0-377" id="h6-0-377" class="i">+                                        onCheckedChange = {
</a><a href="#h6-0-378" id="h6-0-378" class="i">+                                            toggle(it)
</a><a href="#h6-0-379" id="h6-0-379" class="i">+                                        }
</a><a href="#h6-0-380" id="h6-0-380" class="i">+                                    )
</a><a href="#h6-0-381" id="h6-0-381" class="i">+                                    Text(text = card.first)
</a><a href="#h6-0-382" id="h6-0-382" class="i">+                                }
</a><a href="#h6-0-383" id="h6-0-383" class="i">+                            })
</a><a href="#h6-0-384" id="h6-0-384" class="i">+                        }
</a><a href="#h6-0-385" id="h6-0-385" class="i">+                    }
</a><a href="#h6-0-386" id="h6-0-386" class="i">+                }
</a><a href="#h6-0-387" id="h6-0-387" class="i">+            }
</a><a href="#h6-0-388" id="h6-0-388" class="i">+
</a><a href="#h6-0-389" id="h6-0-389" class="i">+            FlowRow(
</a><a href="#h6-0-390" id="h6-0-390" class="i">+                modifier = Modifier
</a><a href="#h6-0-391" id="h6-0-391" class="i">+                    .padding(all = cardMargin)
</a><a href="#h6-0-392" id="h6-0-392" class="i">+                    .fillMaxWidth(),
</a><a href="#h6-0-393" id="h6-0-393" class="i">+                maxItemsInEachRow = 3,
</a><a href="#h6-0-394" id="h6-0-394" class="i">+                horizontalArrangement = Arrangement.SpaceEvenly,
</a><a href="#h6-0-395" id="h6-0-395" class="i">+            ) {
</a><a href="#h6-0-396" id="h6-0-396" class="i">+                val tileHeight = LocalDensity.current.run {
</a><a href="#h6-0-397" id="h6-0-397" class="i">+                    remember { (context.androidContext.resources.displayMetrics.widthPixels / 3).toDp() - cardMargin / 2 }
</a><a href="#h6-0-398" id="h6-0-398" class="i">+                }
</a><a href="#h6-0-399" id="h6-0-399" class="i">+
</a><a href="#h6-0-400" id="h6-0-400" class="i">+                remember(selectedTiles.size, context.translation.loadedLocale) {
</a><a href="#h6-0-401" id="h6-0-401" class="i">+                    selectedTiles.mapNotNull {
</a><a href="#h6-0-402" id="h6-0-402" class="i">+                        cards.entries.find { entry -&gt; entry.key.first == it }
</a><a href="#h6-0-403" id="h6-0-403" class="i">+                    }
</a><a href="#h6-0-404" id="h6-0-404" class="i">+                }.forEach { (card, action) -&gt;
</a><a href="#h6-0-405" id="h6-0-405" class="i">+                    ElevatedCard(
</a><a href="#h6-0-406" id="h6-0-406" class="i">+                        modifier = Modifier
</a><a href="#h6-0-407" id="h6-0-407" class="i">+                            .height(tileHeight)
</a><a href="#h6-0-408" id="h6-0-408" class="i">+                            .weight(1f)
</a><a href="#h6-0-409" id="h6-0-409" class="i">+                            .clickable { action(routes) }
</a><a href="#h6-0-410" id="h6-0-410" class="i">+                            .padding(all = 6.dp),
</a><a href="#h6-0-411" id="h6-0-411" class="i">+                    ) {
</a><a href="#h6-0-412" id="h6-0-412" class="i">+                        Column(
</a><a href="#h6-0-413" id="h6-0-413" class="i">+                            modifier = Modifier
</a><a href="#h6-0-414" id="h6-0-414" class="i">+                                .fillMaxSize()
</a><a href="#h6-0-415" id="h6-0-415" class="i">+                                .padding(all = 5.dp),
</a><a href="#h6-0-416" id="h6-0-416" class="i">+                            horizontalAlignment = Alignment.CenterHorizontally,
</a><a href="#h6-0-417" id="h6-0-417" class="i">+                            verticalArrangement = Arrangement.SpaceEvenly,
</a><a href="#h6-0-418" id="h6-0-418" class="i">+                        ) {
</a><a href="#h6-0-419" id="h6-0-419" class="i">+                            Icon(
</a><a href="#h6-0-420" id="h6-0-420" class="i">+                                imageVector = card.second, contentDescription = null,
</a><a href="#h6-0-421" id="h6-0-421" class="i">+                                tint = MaterialTheme.colorScheme.onSurfaceVariant,
</a><a href="#h6-0-422" id="h6-0-422" class="i">+                                modifier = Modifier.size(50.dp)
</a><a href="#h6-0-423" id="h6-0-423" class="i">+                            )
</a><a href="#h6-0-424" id="h6-0-424" class="i">+                            Text(
</a><a href="#h6-0-425" id="h6-0-425" class="i">+                                text = card.first,
</a><a href="#h6-0-426" id="h6-0-426" class="i">+                                lineHeight = 16.sp,
</a><a href="#h6-0-427" id="h6-0-427" class="i">+                                fontSize = 14.sp,
</a><a href="#h6-0-428" id="h6-0-428" class="i">+                                fontWeight = FontWeight.Bold,
</a><a href="#h6-0-429" id="h6-0-429" class="i">+                                textAlign = TextAlign.Center,
</a><a href="#h6-0-430" id="h6-0-430" class="i">+                                overflow = TextOverflow.Ellipsis,
</a><a href="#h6-0-431" id="h6-0-431" class="i">+                            )
</a><a href="#h6-0-432" id="h6-0-432" class="i">+                        }
</a><a href="#h6-0-433" id="h6-0-433" class="i">+                    }
</a><a href="#h6-0-434" id="h6-0-434" class="i">+                }
</a><a href="#h6-0-435" id="h6-0-435" class="i">+            }
</a><a href="#h6-0-436" id="h6-0-436" class="i">+        }
</a><a href="#h6-0-437" id="h6-0-437" class="i">+    }
</a><a href="#h6-0-438" id="h6-0-438" class="i">+}
</a><b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRoot.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRoot.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -1,589 +0,0 @@
</a><a href="#h7-0-0" id="h7-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.pages.scripting
</a><a href="#h7-0-1" id="h7-0-1" class="d">-
</a><a href="#h7-0-2" id="h7-0-2" class="d">-import android.content.Intent
</a><a href="#h7-0-3" id="h7-0-3" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h7-0-4" id="h7-0-4" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h7-0-5" id="h7-0-5" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h7-0-6" id="h7-0-6" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h7-0-7" id="h7-0-7" class="d">-import androidx.compose.material.icons.automirrored.filled.LibraryBooks
</a><a href="#h7-0-8" id="h7-0-8" class="d">-import androidx.compose.material.icons.filled.*
</a><a href="#h7-0-9" id="h7-0-9" class="d">-import androidx.compose.material3.*
</a><a href="#h7-0-10" id="h7-0-10" class="d">-import androidx.compose.runtime.*
</a><a href="#h7-0-11" id="h7-0-11" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h7-0-12" id="h7-0-12" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h7-0-13" id="h7-0-13" class="d">-import androidx.compose.ui.focus.FocusRequester
</a><a href="#h7-0-14" id="h7-0-14" class="d">-import androidx.compose.ui.focus.focusRequester
</a><a href="#h7-0-15" id="h7-0-15" class="d">-import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h7-0-16" id="h7-0-16" class="d">-import androidx.compose.ui.layout.onGloballyPositioned
</a><a href="#h7-0-17" id="h7-0-17" class="d">-import androidx.compose.ui.text.font.FontStyle
</a><a href="#h7-0-18" id="h7-0-18" class="d">-import androidx.compose.ui.text.font.FontWeight
</a><a href="#h7-0-19" id="h7-0-19" class="d">-import androidx.compose.ui.text.style.TextAlign
</a><a href="#h7-0-20" id="h7-0-20" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h7-0-21" id="h7-0-21" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h7-0-22" id="h7-0-22" class="d">-import androidx.core.net.toUri
</a><a href="#h7-0-23" id="h7-0-23" class="d">-import androidx.navigation.NavBackStackEntry
</a><a href="#h7-0-24" id="h7-0-24" class="d">-import kotlinx.coroutines.Dispatchers
</a><a href="#h7-0-25" id="h7-0-25" class="d">-import kotlinx.coroutines.asCoroutineDispatcher
</a><a href="#h7-0-26" id="h7-0-26" class="d">-import kotlinx.coroutines.delay
</a><a href="#h7-0-27" id="h7-0-27" class="d">-import kotlinx.coroutines.launch
</a><a href="#h7-0-28" id="h7-0-28" class="d">-import kotlinx.coroutines.withContext
</a><a href="#h7-0-29" id="h7-0-29" class="d">-import me.rhunk.snapenhance.common.scripting.type.ModuleInfo
</a><a href="#h7-0-30" id="h7-0-30" class="d">-import me.rhunk.snapenhance.common.scripting.ui.EnumScriptInterface
</a><a href="#h7-0-31" id="h7-0-31" class="d">-import me.rhunk.snapenhance.common.scripting.ui.InterfaceManager
</a><a href="#h7-0-32" id="h7-0-32" class="d">-import me.rhunk.snapenhance.common.scripting.ui.ScriptInterface
</a><a href="#h7-0-33" id="h7-0-33" class="d">-import me.rhunk.snapenhance.common.ui.AsyncUpdateDispatcher
</a><a href="#h7-0-34" id="h7-0-34" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h7-0-35" id="h7-0-35" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncUpdateDispatcher
</a><a href="#h7-0-36" id="h7-0-36" class="d">-import me.rhunk.snapenhance.storage.isScriptEnabled
</a><a href="#h7-0-37" id="h7-0-37" class="d">-import me.rhunk.snapenhance.storage.setScriptEnabled
</a><a href="#h7-0-38" id="h7-0-38" class="d">-import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h7-0-39" id="h7-0-39" class="d">-import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
</a><a href="#h7-0-40" id="h7-0-40" class="d">-import me.rhunk.snapenhance.ui.util.Dialog
</a><a href="#h7-0-41" id="h7-0-41" class="d">-import me.rhunk.snapenhance.ui.util.chooseFolder
</a><a href="#h7-0-42" id="h7-0-42" class="d">-import me.rhunk.snapenhance.ui.util.pullrefresh.PullRefreshIndicator
</a><a href="#h7-0-43" id="h7-0-43" class="d">-import me.rhunk.snapenhance.ui.util.pullrefresh.pullRefresh
</a><a href="#h7-0-44" id="h7-0-44" class="d">-import me.rhunk.snapenhance.ui.util.pullrefresh.rememberPullRefreshState
</a><a href="#h7-0-45" id="h7-0-45" class="d">-
</a><a href="#h7-0-46" id="h7-0-46" class="d">-class ScriptingRoot : Routes.Route() {
</a><a href="#h7-0-47" id="h7-0-47" class="d">-    private lateinit var activityLauncherHelper: ActivityLauncherHelper
</a><a href="#h7-0-48" id="h7-0-48" class="d">-    private val reloadDispatcher = AsyncUpdateDispatcher(updateOnFirstComposition = false)
</a><a href="#h7-0-49" id="h7-0-49" class="d">-
</a><a href="#h7-0-50" id="h7-0-50" class="d">-    override val init: () -&gt; Unit = {
</a><a href="#h7-0-51" id="h7-0-51" class="d">-        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h7-0-52" id="h7-0-52" class="d">-    }
</a><a href="#h7-0-53" id="h7-0-53" class="d">-
</a><a href="#h7-0-54" id="h7-0-54" class="d">-    @Composable
</a><a href="#h7-0-55" id="h7-0-55" class="d">-    private fun ImportRemoteScript(
</a><a href="#h7-0-56" id="h7-0-56" class="d">-        dismiss: () -&gt; Unit
</a><a href="#h7-0-57" id="h7-0-57" class="d">-    ) {
</a><a href="#h7-0-58" id="h7-0-58" class="d">-        Dialog(onDismissRequest = dismiss) {
</a><a href="#h7-0-59" id="h7-0-59" class="d">-            var url by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h7-0-60" id="h7-0-60" class="d">-            val focusRequester = remember { FocusRequester() }
</a><a href="#h7-0-61" id="h7-0-61" class="d">-            var isLoading by remember {
</a><a href="#h7-0-62" id="h7-0-62" class="d">-                mutableStateOf(false)
</a><a href="#h7-0-63" id="h7-0-63" class="d">-            }
</a><a href="#h7-0-64" id="h7-0-64" class="d">-            ElevatedCard(
</a><a href="#h7-0-65" id="h7-0-65" class="d">-                modifier = Modifier
</a><a href="#h7-0-66" id="h7-0-66" class="d">-                    .fillMaxWidth(),
</a><a href="#h7-0-67" id="h7-0-67" class="d">-            ) {
</a><a href="#h7-0-68" id="h7-0-68" class="d">-                Column(
</a><a href="#h7-0-69" id="h7-0-69" class="d">-                    modifier = Modifier
</a><a href="#h7-0-70" id="h7-0-70" class="d">-                        .fillMaxWidth()
</a><a href="#h7-0-71" id="h7-0-71" class="d">-                        .padding(16.dp),
</a><a href="#h7-0-72" id="h7-0-72" class="d">-                    horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h7-0-73" id="h7-0-73" class="d">-                ) {
</a><a href="#h7-0-74" id="h7-0-74" class="d">-                    Text(
</a><a href="#h7-0-75" id="h7-0-75" class="d">-                        text = &quot;Import Script from URL&quot;,
</a><a href="#h7-0-76" id="h7-0-76" class="d">-                        fontSize = 22.sp,
</a><a href="#h7-0-77" id="h7-0-77" class="d">-                        fontWeight = FontWeight.Bold,
</a><a href="#h7-0-78" id="h7-0-78" class="d">-                        modifier = Modifier.padding(8.dp),
</a><a href="#h7-0-79" id="h7-0-79" class="d">-                    )
</a><a href="#h7-0-80" id="h7-0-80" class="d">-                    Text(
</a><a href="#h7-0-81" id="h7-0-81" class="d">-                        text = &quot;Warning: Imported scripts can be harmful to your device. Only import scripts from trusted sources.&quot;,
</a><a href="#h7-0-82" id="h7-0-82" class="d">-                        fontSize = 14.sp,
</a><a href="#h7-0-83" id="h7-0-83" class="d">-                        fontWeight = FontWeight.Light,
</a><a href="#h7-0-84" id="h7-0-84" class="d">-                        fontStyle = FontStyle.Italic,
</a><a href="#h7-0-85" id="h7-0-85" class="d">-                        modifier = Modifier.padding(8.dp),
</a><a href="#h7-0-86" id="h7-0-86" class="d">-                        textAlign = TextAlign.Center,
</a><a href="#h7-0-87" id="h7-0-87" class="d">-                    )
</a><a href="#h7-0-88" id="h7-0-88" class="d">-                    TextField(
</a><a href="#h7-0-89" id="h7-0-89" class="d">-                        value = url,
</a><a href="#h7-0-90" id="h7-0-90" class="d">-                        onValueChange = {
</a><a href="#h7-0-91" id="h7-0-91" class="d">-                            url = it
</a><a href="#h7-0-92" id="h7-0-92" class="d">-                        },
</a><a href="#h7-0-93" id="h7-0-93" class="d">-                        label = {
</a><a href="#h7-0-94" id="h7-0-94" class="d">-                            Text(text = &quot;Enter URL here:&quot;)
</a><a href="#h7-0-95" id="h7-0-95" class="d">-                        },
</a><a href="#h7-0-96" id="h7-0-96" class="d">-                        modifier = Modifier
</a><a href="#h7-0-97" id="h7-0-97" class="d">-                            .fillMaxWidth()
</a><a href="#h7-0-98" id="h7-0-98" class="d">-                            .focusRequester(focusRequester)
</a><a href="#h7-0-99" id="h7-0-99" class="d">-                            .onGloballyPositioned {
</a><a href="#h7-0-100" id="h7-0-100" class="d">-                                focusRequester.requestFocus()
</a><a href="#h7-0-101" id="h7-0-101" class="d">-                            }
</a><a href="#h7-0-102" id="h7-0-102" class="d">-                    )
</a><a href="#h7-0-103" id="h7-0-103" class="d">-                    Spacer(modifier = Modifier.height(8.dp))
</a><a href="#h7-0-104" id="h7-0-104" class="d">-                    Button(
</a><a href="#h7-0-105" id="h7-0-105" class="d">-                        enabled = url.isNotBlank(),
</a><a href="#h7-0-106" id="h7-0-106" class="d">-                        onClick = {
</a><a href="#h7-0-107" id="h7-0-107" class="d">-                            isLoading = true
</a><a href="#h7-0-108" id="h7-0-108" class="d">-                            context.coroutineScope.launch {
</a><a href="#h7-0-109" id="h7-0-109" class="d">-                                runCatching {
</a><a href="#h7-0-110" id="h7-0-110" class="d">-                                    val moduleInfo = context.scriptManager.importFromUrl(url)
</a><a href="#h7-0-111" id="h7-0-111" class="d">-                                    context.shortToast(&quot;Script ${moduleInfo.name} imported!&quot;)
</a><a href="#h7-0-112" id="h7-0-112" class="d">-                                    reloadDispatcher.dispatch()
</a><a href="#h7-0-113" id="h7-0-113" class="d">-                                    withContext(Dispatchers.Main) {
</a><a href="#h7-0-114" id="h7-0-114" class="d">-                                        dismiss()
</a><a href="#h7-0-115" id="h7-0-115" class="d">-                                    }
</a><a href="#h7-0-116" id="h7-0-116" class="d">-                                    return@launch
</a><a href="#h7-0-117" id="h7-0-117" class="d">-                                }.onFailure {
</a><a href="#h7-0-118" id="h7-0-118" class="d">-                                    context.log.error(&quot;Failed to import script&quot;, it)
</a><a href="#h7-0-119" id="h7-0-119" class="d">-                                    context.shortToast(&quot;Failed to import script. ${it.message}. Check logs for more details&quot;)
</a><a href="#h7-0-120" id="h7-0-120" class="d">-                                }
</a><a href="#h7-0-121" id="h7-0-121" class="d">-                                isLoading = false
</a><a href="#h7-0-122" id="h7-0-122" class="d">-                            }
</a><a href="#h7-0-123" id="h7-0-123" class="d">-                        },
</a><a href="#h7-0-124" id="h7-0-124" class="d">-                    ) {
</a><a href="#h7-0-125" id="h7-0-125" class="d">-                        if (isLoading) {
</a><a href="#h7-0-126" id="h7-0-126" class="d">-                            CircularProgressIndicator(
</a><a href="#h7-0-127" id="h7-0-127" class="d">-                                modifier = Modifier
</a><a href="#h7-0-128" id="h7-0-128" class="d">-                                    .size(30.dp),
</a><a href="#h7-0-129" id="h7-0-129" class="d">-                                strokeWidth = 3.dp,
</a><a href="#h7-0-130" id="h7-0-130" class="d">-                                color = MaterialTheme.colorScheme.onPrimary
</a><a href="#h7-0-131" id="h7-0-131" class="d">-                            )
</a><a href="#h7-0-132" id="h7-0-132" class="d">-                        } else {
</a><a href="#h7-0-133" id="h7-0-133" class="d">-                            Text(text = &quot;Import&quot;)
</a><a href="#h7-0-134" id="h7-0-134" class="d">-                        }
</a><a href="#h7-0-135" id="h7-0-135" class="d">-                    }
</a><a href="#h7-0-136" id="h7-0-136" class="d">-                }
</a><a href="#h7-0-137" id="h7-0-137" class="d">-            }
</a><a href="#h7-0-138" id="h7-0-138" class="d">-        }
</a><a href="#h7-0-139" id="h7-0-139" class="d">-    }
</a><a href="#h7-0-140" id="h7-0-140" class="d">-
</a><a href="#h7-0-141" id="h7-0-141" class="d">-
</a><a href="#h7-0-142" id="h7-0-142" class="d">-    @Composable
</a><a href="#h7-0-143" id="h7-0-143" class="d">-    private fun ModuleActions(
</a><a href="#h7-0-144" id="h7-0-144" class="d">-        script: ModuleInfo,
</a><a href="#h7-0-145" id="h7-0-145" class="d">-        canUpdate: Boolean,
</a><a href="#h7-0-146" id="h7-0-146" class="d">-        dismiss: () -&gt; Unit
</a><a href="#h7-0-147" id="h7-0-147" class="d">-    ) {
</a><a href="#h7-0-148" id="h7-0-148" class="d">-        Dialog(
</a><a href="#h7-0-149" id="h7-0-149" class="d">-            onDismissRequest = dismiss,
</a><a href="#h7-0-150" id="h7-0-150" class="d">-        ) {
</a><a href="#h7-0-151" id="h7-0-151" class="d">-            ElevatedCard(
</a><a href="#h7-0-152" id="h7-0-152" class="d">-                modifier = Modifier
</a><a href="#h7-0-153" id="h7-0-153" class="d">-                    .fillMaxWidth()
</a><a href="#h7-0-154" id="h7-0-154" class="d">-                    .padding(2.dp),
</a><a href="#h7-0-155" id="h7-0-155" class="d">-            ) {
</a><a href="#h7-0-156" id="h7-0-156" class="d">-                val actions = remember {
</a><a href="#h7-0-157" id="h7-0-157" class="d">-                    mutableMapOf&lt;Pair&lt;String, ImageVector&gt;, suspend () -&gt; Unit&gt;().apply {
</a><a href="#h7-0-158" id="h7-0-158" class="d">-                        if (canUpdate) {
</a><a href="#h7-0-159" id="h7-0-159" class="d">-                            put(&quot;Update Module&quot; to Icons.Default.Download) {
</a><a href="#h7-0-160" id="h7-0-160" class="d">-                                dismiss()
</a><a href="#h7-0-161" id="h7-0-161" class="d">-                                context.shortToast(&quot;Updating script ${script.name}...&quot;)
</a><a href="#h7-0-162" id="h7-0-162" class="d">-                                runCatching {
</a><a href="#h7-0-163" id="h7-0-163" class="d">-                                    val modulePath = context.scriptManager.getModulePath(script.name) ?: throw Exception(&quot;Module not found&quot;)
</a><a href="#h7-0-164" id="h7-0-164" class="d">-                                    context.scriptManager.unloadScript(modulePath)
</a><a href="#h7-0-165" id="h7-0-165" class="d">-                                    val moduleInfo = context.scriptManager.importFromUrl(script.updateUrl!!, filepath = modulePath)
</a><a href="#h7-0-166" id="h7-0-166" class="d">-                                    context.shortToast(&quot;Updated ${script.name} to version ${moduleInfo.version}&quot;)
</a><a href="#h7-0-167" id="h7-0-167" class="d">-                                    context.database.setScriptEnabled(script.name, false)
</a><a href="#h7-0-168" id="h7-0-168" class="d">-                                    withContext(context.database.executor.asCoroutineDispatcher()) {
</a><a href="#h7-0-169" id="h7-0-169" class="d">-                                        reloadDispatcher.dispatch()
</a><a href="#h7-0-170" id="h7-0-170" class="d">-                                    }
</a><a href="#h7-0-171" id="h7-0-171" class="d">-                                }.onFailure {
</a><a href="#h7-0-172" id="h7-0-172" class="d">-                                    context.log.error(&quot;Failed to update module&quot;, it)
</a><a href="#h7-0-173" id="h7-0-173" class="d">-                                    context.shortToast(&quot;Failed to update module. Check logs for more details&quot;)
</a><a href="#h7-0-174" id="h7-0-174" class="d">-                                }
</a><a href="#h7-0-175" id="h7-0-175" class="d">-                            }
</a><a href="#h7-0-176" id="h7-0-176" class="d">-                        }
</a><a href="#h7-0-177" id="h7-0-177" class="d">-
</a><a href="#h7-0-178" id="h7-0-178" class="d">-                        put(&quot;Edit Module&quot; to Icons.Default.Edit) {
</a><a href="#h7-0-179" id="h7-0-179" class="d">-                            runCatching {
</a><a href="#h7-0-180" id="h7-0-180" class="d">-                                val modulePath = context.scriptManager.getModulePath(script.name)!!
</a><a href="#h7-0-181" id="h7-0-181" class="d">-                                context.androidContext.startActivity(
</a><a href="#h7-0-182" id="h7-0-182" class="d">-                                    Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h7-0-183" id="h7-0-183" class="d">-                                        data = context.scriptManager.getScriptsFolder()!!
</a><a href="#h7-0-184" id="h7-0-184" class="d">-                                            .findFile(modulePath)!!.uri
</a><a href="#h7-0-185" id="h7-0-185" class="d">-                                        flags =
</a><a href="#h7-0-186" id="h7-0-186" class="d">-                                            Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION
</a><a href="#h7-0-187" id="h7-0-187" class="d">-                                    }
</a><a href="#h7-0-188" id="h7-0-188" class="d">-                                )
</a><a href="#h7-0-189" id="h7-0-189" class="d">-                                dismiss()
</a><a href="#h7-0-190" id="h7-0-190" class="d">-                            }.onFailure {
</a><a href="#h7-0-191" id="h7-0-191" class="d">-                                context.log.error(&quot;Failed to open module file&quot;, it)
</a><a href="#h7-0-192" id="h7-0-192" class="d">-                                context.shortToast(&quot;Failed to open module file. Check logs for more details&quot;)
</a><a href="#h7-0-193" id="h7-0-193" class="d">-                            }
</a><a href="#h7-0-194" id="h7-0-194" class="d">-                        }
</a><a href="#h7-0-195" id="h7-0-195" class="d">-                        put(&quot;Clear Module Data&quot; to Icons.Default.Save) {
</a><a href="#h7-0-196" id="h7-0-196" class="d">-                            runCatching {
</a><a href="#h7-0-197" id="h7-0-197" class="d">-                                context.scriptManager.getModuleDataFolder(script.name)
</a><a href="#h7-0-198" id="h7-0-198" class="d">-                                    .deleteRecursively()
</a><a href="#h7-0-199" id="h7-0-199" class="d">-                                context.shortToast(&quot;Module data cleared!&quot;)
</a><a href="#h7-0-200" id="h7-0-200" class="d">-                                dismiss()
</a><a href="#h7-0-201" id="h7-0-201" class="d">-                            }.onFailure {
</a><a href="#h7-0-202" id="h7-0-202" class="d">-                                context.log.error(&quot;Failed to clear module data&quot;, it)
</a><a href="#h7-0-203" id="h7-0-203" class="d">-                                context.shortToast(&quot;Failed to clear module data. Check logs for more details&quot;)
</a><a href="#h7-0-204" id="h7-0-204" class="d">-                            }
</a><a href="#h7-0-205" id="h7-0-205" class="d">-                        }
</a><a href="#h7-0-206" id="h7-0-206" class="d">-                        put(&quot;Delete Module&quot; to Icons.Default.DeleteOutline) {
</a><a href="#h7-0-207" id="h7-0-207" class="d">-                            context.scriptManager.apply {
</a><a href="#h7-0-208" id="h7-0-208" class="d">-                                runCatching {
</a><a href="#h7-0-209" id="h7-0-209" class="d">-                                    val modulePath = getModulePath(script.name)!!
</a><a href="#h7-0-210" id="h7-0-210" class="d">-                                    unloadScript(modulePath)
</a><a href="#h7-0-211" id="h7-0-211" class="d">-                                    getScriptsFolder()?.findFile(modulePath)?.delete()
</a><a href="#h7-0-212" id="h7-0-212" class="d">-                                    reloadDispatcher.dispatch()
</a><a href="#h7-0-213" id="h7-0-213" class="d">-                                    context.shortToast(&quot;Deleted script ${script.name}!&quot;)
</a><a href="#h7-0-214" id="h7-0-214" class="d">-                                    dismiss()
</a><a href="#h7-0-215" id="h7-0-215" class="d">-                                }.onFailure {
</a><a href="#h7-0-216" id="h7-0-216" class="d">-                                    context.log.error(&quot;Failed to delete module&quot;, it)
</a><a href="#h7-0-217" id="h7-0-217" class="d">-                                    context.shortToast(&quot;Failed to delete module. Check logs for more details&quot;)
</a><a href="#h7-0-218" id="h7-0-218" class="d">-                                }
</a><a href="#h7-0-219" id="h7-0-219" class="d">-                            }
</a><a href="#h7-0-220" id="h7-0-220" class="d">-                        }
</a><a href="#h7-0-221" id="h7-0-221" class="d">-                    }.toMap()
</a><a href="#h7-0-222" id="h7-0-222" class="d">-                }
</a><a href="#h7-0-223" id="h7-0-223" class="d">-
</a><a href="#h7-0-224" id="h7-0-224" class="d">-                LazyColumn(
</a><a href="#h7-0-225" id="h7-0-225" class="d">-                    modifier = Modifier.fillMaxWidth()
</a><a href="#h7-0-226" id="h7-0-226" class="d">-                ) {
</a><a href="#h7-0-227" id="h7-0-227" class="d">-                    item {
</a><a href="#h7-0-228" id="h7-0-228" class="d">-                        Text(
</a><a href="#h7-0-229" id="h7-0-229" class="d">-                            text = &quot;Actions&quot;,
</a><a href="#h7-0-230" id="h7-0-230" class="d">-                            fontSize = 22.sp,
</a><a href="#h7-0-231" id="h7-0-231" class="d">-                            fontWeight = FontWeight.Bold,
</a><a href="#h7-0-232" id="h7-0-232" class="d">-                            modifier = Modifier
</a><a href="#h7-0-233" id="h7-0-233" class="d">-                                .padding(16.dp)
</a><a href="#h7-0-234" id="h7-0-234" class="d">-                                .fillMaxWidth(),
</a><a href="#h7-0-235" id="h7-0-235" class="d">-                            textAlign = TextAlign.Center,
</a><a href="#h7-0-236" id="h7-0-236" class="d">-                        )
</a><a href="#h7-0-237" id="h7-0-237" class="d">-                    }
</a><a href="#h7-0-238" id="h7-0-238" class="d">-                    items(actions.size) { index -&gt;
</a><a href="#h7-0-239" id="h7-0-239" class="d">-                        val action = actions.entries.elementAt(index)
</a><a href="#h7-0-240" id="h7-0-240" class="d">-                        ListItem(
</a><a href="#h7-0-241" id="h7-0-241" class="d">-                            modifier = Modifier
</a><a href="#h7-0-242" id="h7-0-242" class="d">-                                .clickable {
</a><a href="#h7-0-243" id="h7-0-243" class="d">-                                    context.coroutineScope.launch {
</a><a href="#h7-0-244" id="h7-0-244" class="d">-                                        action.value()
</a><a href="#h7-0-245" id="h7-0-245" class="d">-                                        dismiss()
</a><a href="#h7-0-246" id="h7-0-246" class="d">-                                    }
</a><a href="#h7-0-247" id="h7-0-247" class="d">-                                }
</a><a href="#h7-0-248" id="h7-0-248" class="d">-                                .fillMaxWidth(),
</a><a href="#h7-0-249" id="h7-0-249" class="d">-                            leadingContent = {
</a><a href="#h7-0-250" id="h7-0-250" class="d">-                                Icon(
</a><a href="#h7-0-251" id="h7-0-251" class="d">-                                    imageVector = action.key.second,
</a><a href="#h7-0-252" id="h7-0-252" class="d">-                                    contentDescription = action.key.first
</a><a href="#h7-0-253" id="h7-0-253" class="d">-                                )
</a><a href="#h7-0-254" id="h7-0-254" class="d">-                            },
</a><a href="#h7-0-255" id="h7-0-255" class="d">-                            headlineContent = {
</a><a href="#h7-0-256" id="h7-0-256" class="d">-                                Text(text = action.key.first)
</a><a href="#h7-0-257" id="h7-0-257" class="d">-                            },
</a><a href="#h7-0-258" id="h7-0-258" class="d">-                        )
</a><a href="#h7-0-259" id="h7-0-259" class="d">-                    }
</a><a href="#h7-0-260" id="h7-0-260" class="d">-                }
</a><a href="#h7-0-261" id="h7-0-261" class="d">-            }
</a><a href="#h7-0-262" id="h7-0-262" class="d">-        }
</a><a href="#h7-0-263" id="h7-0-263" class="d">-    }
</a><a href="#h7-0-264" id="h7-0-264" class="d">-
</a><a href="#h7-0-265" id="h7-0-265" class="d">-    @Composable
</a><a href="#h7-0-266" id="h7-0-266" class="d">-    fun ModuleItem(script: ModuleInfo) {
</a><a href="#h7-0-267" id="h7-0-267" class="d">-        var enabled by rememberAsyncMutableState(defaultValue = false, keys = arrayOf(script)) {
</a><a href="#h7-0-268" id="h7-0-268" class="d">-            context.database.isScriptEnabled(script.name)
</a><a href="#h7-0-269" id="h7-0-269" class="d">-        }
</a><a href="#h7-0-270" id="h7-0-270" class="d">-        var openSettings by remember(script) { mutableStateOf(false) }
</a><a href="#h7-0-271" id="h7-0-271" class="d">-        var openActions by remember { mutableStateOf(false) }
</a><a href="#h7-0-272" id="h7-0-272" class="d">-
</a><a href="#h7-0-273" id="h7-0-273" class="d">-        val dispatcher = rememberAsyncUpdateDispatcher()
</a><a href="#h7-0-274" id="h7-0-274" class="d">-        val reloadCallback = remember { suspend { dispatcher.dispatch() } }
</a><a href="#h7-0-275" id="h7-0-275" class="d">-        val latestUpdate by rememberAsyncMutableState(defaultValue = null, updateDispatcher = dispatcher, keys = arrayOf(script)) {
</a><a href="#h7-0-276" id="h7-0-276" class="d">-            context.scriptManager.checkForUpdate(script)
</a><a href="#h7-0-277" id="h7-0-277" class="d">-        }
</a><a href="#h7-0-278" id="h7-0-278" class="d">-
</a><a href="#h7-0-279" id="h7-0-279" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h7-0-280" id="h7-0-280" class="d">-            reloadDispatcher.addCallback(reloadCallback)
</a><a href="#h7-0-281" id="h7-0-281" class="d">-        }
</a><a href="#h7-0-282" id="h7-0-282" class="d">-
</a><a href="#h7-0-283" id="h7-0-283" class="d">-        DisposableEffect(Unit) {
</a><a href="#h7-0-284" id="h7-0-284" class="d">-            onDispose {
</a><a href="#h7-0-285" id="h7-0-285" class="d">-                reloadDispatcher.removeCallback(reloadCallback)
</a><a href="#h7-0-286" id="h7-0-286" class="d">-            }
</a><a href="#h7-0-287" id="h7-0-287" class="d">-        }
</a><a href="#h7-0-288" id="h7-0-288" class="d">-
</a><a href="#h7-0-289" id="h7-0-289" class="d">-        Card(
</a><a href="#h7-0-290" id="h7-0-290" class="d">-            modifier = Modifier
</a><a href="#h7-0-291" id="h7-0-291" class="d">-                .fillMaxWidth()
</a><a href="#h7-0-292" id="h7-0-292" class="d">-                .padding(8.dp),
</a><a href="#h7-0-293" id="h7-0-293" class="d">-            elevation = CardDefaults.cardElevation()
</a><a href="#h7-0-294" id="h7-0-294" class="d">-        ) {
</a><a href="#h7-0-295" id="h7-0-295" class="d">-            Row(
</a><a href="#h7-0-296" id="h7-0-296" class="d">-                modifier = Modifier
</a><a href="#h7-0-297" id="h7-0-297" class="d">-                    .fillMaxWidth()
</a><a href="#h7-0-298" id="h7-0-298" class="d">-                    .clickable {
</a><a href="#h7-0-299" id="h7-0-299" class="d">-                        if (!enabled) return@clickable
</a><a href="#h7-0-300" id="h7-0-300" class="d">-                        openSettings = !openSettings
</a><a href="#h7-0-301" id="h7-0-301" class="d">-                    }
</a><a href="#h7-0-302" id="h7-0-302" class="d">-                    .padding(8.dp),
</a><a href="#h7-0-303" id="h7-0-303" class="d">-                verticalAlignment = Alignment.CenterVertically
</a><a href="#h7-0-304" id="h7-0-304" class="d">-            ) {
</a><a href="#h7-0-305" id="h7-0-305" class="d">-                if (enabled) {
</a><a href="#h7-0-306" id="h7-0-306" class="d">-                    Icon(
</a><a href="#h7-0-307" id="h7-0-307" class="d">-                        imageVector = if (openSettings) Icons.Default.ExpandLess else Icons.Default.ExpandMore,
</a><a href="#h7-0-308" id="h7-0-308" class="d">-                        contentDescription = null,
</a><a href="#h7-0-309" id="h7-0-309" class="d">-                        modifier = Modifier
</a><a href="#h7-0-310" id="h7-0-310" class="d">-                            .padding(end = 8.dp)
</a><a href="#h7-0-311" id="h7-0-311" class="d">-                            .size(32.dp),
</a><a href="#h7-0-312" id="h7-0-312" class="d">-                    )
</a><a href="#h7-0-313" id="h7-0-313" class="d">-                }
</a><a href="#h7-0-314" id="h7-0-314" class="d">-
</a><a href="#h7-0-315" id="h7-0-315" class="d">-                Column(
</a><a href="#h7-0-316" id="h7-0-316" class="d">-                    modifier = Modifier
</a><a href="#h7-0-317" id="h7-0-317" class="d">-                        .weight(1f)
</a><a href="#h7-0-318" id="h7-0-318" class="d">-                        .padding(end = 8.dp)
</a><a href="#h7-0-319" id="h7-0-319" class="d">-                ) {
</a><a href="#h7-0-320" id="h7-0-320" class="d">-                    Text(text = script.displayName ?: script.name, fontSize = 20.sp)
</a><a href="#h7-0-321" id="h7-0-321" class="d">-                    Text(text = script.description ?: &quot;No description&quot;, fontSize = 14.sp)
</a><a href="#h7-0-322" id="h7-0-322" class="d">-                    latestUpdate?.let {
</a><a href="#h7-0-323" id="h7-0-323" class="d">-                        Text(text = &quot;Update available: ${it.version}&quot;, fontSize = 14.sp, fontStyle = FontStyle.Italic, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h7-0-324" id="h7-0-324" class="d">-                    }
</a><a href="#h7-0-325" id="h7-0-325" class="d">-                }
</a><a href="#h7-0-326" id="h7-0-326" class="d">-                IconButton(onClick = {
</a><a href="#h7-0-327" id="h7-0-327" class="d">-                    openActions = !openActions
</a><a href="#h7-0-328" id="h7-0-328" class="d">-                }) {
</a><a href="#h7-0-329" id="h7-0-329" class="d">-                    Icon(imageVector = Icons.Default.Build, contentDescription = &quot;Actions&quot;)
</a><a href="#h7-0-330" id="h7-0-330" class="d">-                }
</a><a href="#h7-0-331" id="h7-0-331" class="d">-                Switch(
</a><a href="#h7-0-332" id="h7-0-332" class="d">-                    checked = enabled,
</a><a href="#h7-0-333" id="h7-0-333" class="d">-                    onCheckedChange = { isChecked -&gt;
</a><a href="#h7-0-334" id="h7-0-334" class="d">-                        openSettings = false
</a><a href="#h7-0-335" id="h7-0-335" class="d">-                        context.coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h7-0-336" id="h7-0-336" class="d">-                            runCatching {
</a><a href="#h7-0-337" id="h7-0-337" class="d">-                                val modulePath = context.scriptManager.getModulePath(script.name)!!
</a><a href="#h7-0-338" id="h7-0-338" class="d">-                                context.scriptManager.unloadScript(modulePath)
</a><a href="#h7-0-339" id="h7-0-339" class="d">-                                if (isChecked) {
</a><a href="#h7-0-340" id="h7-0-340" class="d">-                                    context.scriptManager.loadScript(modulePath)
</a><a href="#h7-0-341" id="h7-0-341" class="d">-                                    context.scriptManager.runtime.getModuleByName(script.name)
</a><a href="#h7-0-342" id="h7-0-342" class="d">-                                        ?.callFunction(&quot;module.onSnapEnhanceLoad&quot;)
</a><a href="#h7-0-343" id="h7-0-343" class="d">-                                    context.shortToast(&quot;Loaded script ${script.name}&quot;)
</a><a href="#h7-0-344" id="h7-0-344" class="d">-                                } else {
</a><a href="#h7-0-345" id="h7-0-345" class="d">-                                    context.shortToast(&quot;Unloaded script ${script.name}&quot;)
</a><a href="#h7-0-346" id="h7-0-346" class="d">-                                }
</a><a href="#h7-0-347" id="h7-0-347" class="d">-
</a><a href="#h7-0-348" id="h7-0-348" class="d">-                                context.database.setScriptEnabled(script.name, isChecked)
</a><a href="#h7-0-349" id="h7-0-349" class="d">-                                withContext(Dispatchers.Main) {
</a><a href="#h7-0-350" id="h7-0-350" class="d">-                                    enabled = isChecked
</a><a href="#h7-0-351" id="h7-0-351" class="d">-                                }
</a><a href="#h7-0-352" id="h7-0-352" class="d">-                            }.onFailure { throwable -&gt;
</a><a href="#h7-0-353" id="h7-0-353" class="d">-                                withContext(Dispatchers.Main) {
</a><a href="#h7-0-354" id="h7-0-354" class="d">-                                    enabled = !isChecked
</a><a href="#h7-0-355" id="h7-0-355" class="d">-                                }
</a><a href="#h7-0-356" id="h7-0-356" class="d">-                                (&quot;Failed to ${if (isChecked) &quot;enable&quot; else &quot;disable&quot;} script. Check logs for more details&quot;).also {
</a><a href="#h7-0-357" id="h7-0-357" class="d">-                                    context.log.error(it, throwable)
</a><a href="#h7-0-358" id="h7-0-358" class="d">-                                    context.shortToast(it)
</a><a href="#h7-0-359" id="h7-0-359" class="d">-                                }
</a><a href="#h7-0-360" id="h7-0-360" class="d">-                            }
</a><a href="#h7-0-361" id="h7-0-361" class="d">-                        }
</a><a href="#h7-0-362" id="h7-0-362" class="d">-                    }
</a><a href="#h7-0-363" id="h7-0-363" class="d">-                )
</a><a href="#h7-0-364" id="h7-0-364" class="d">-            }
</a><a href="#h7-0-365" id="h7-0-365" class="d">-
</a><a href="#h7-0-366" id="h7-0-366" class="d">-            if (openSettings) {
</a><a href="#h7-0-367" id="h7-0-367" class="d">-                ScriptSettings(script)
</a><a href="#h7-0-368" id="h7-0-368" class="d">-            }
</a><a href="#h7-0-369" id="h7-0-369" class="d">-        }
</a><a href="#h7-0-370" id="h7-0-370" class="d">-
</a><a href="#h7-0-371" id="h7-0-371" class="d">-        if (openActions) {
</a><a href="#h7-0-372" id="h7-0-372" class="d">-            ModuleActions(
</a><a href="#h7-0-373" id="h7-0-373" class="d">-                script = script,
</a><a href="#h7-0-374" id="h7-0-374" class="d">-                canUpdate = latestUpdate != null,
</a><a href="#h7-0-375" id="h7-0-375" class="d">-            ) { openActions = false }
</a><a href="#h7-0-376" id="h7-0-376" class="d">-        }
</a><a href="#h7-0-377" id="h7-0-377" class="d">-    }
</a><a href="#h7-0-378" id="h7-0-378" class="d">-
</a><a href="#h7-0-379" id="h7-0-379" class="d">-    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h7-0-380" id="h7-0-380" class="d">-        var showImportDialog by remember {
</a><a href="#h7-0-381" id="h7-0-381" class="d">-            mutableStateOf(false)
</a><a href="#h7-0-382" id="h7-0-382" class="d">-        }
</a><a href="#h7-0-383" id="h7-0-383" class="d">-        if (showImportDialog) {
</a><a href="#h7-0-384" id="h7-0-384" class="d">-            ImportRemoteScript {
</a><a href="#h7-0-385" id="h7-0-385" class="d">-                showImportDialog = false
</a><a href="#h7-0-386" id="h7-0-386" class="d">-            }
</a><a href="#h7-0-387" id="h7-0-387" class="d">-        }
</a><a href="#h7-0-388" id="h7-0-388" class="d">-
</a><a href="#h7-0-389" id="h7-0-389" class="d">-        Column(
</a><a href="#h7-0-390" id="h7-0-390" class="d">-            verticalArrangement = Arrangement.spacedBy(8.dp),
</a><a href="#h7-0-391" id="h7-0-391" class="d">-            horizontalAlignment = Alignment.End,
</a><a href="#h7-0-392" id="h7-0-392" class="d">-        ) {
</a><a href="#h7-0-393" id="h7-0-393" class="d">-            ExtendedFloatingActionButton(
</a><a href="#h7-0-394" id="h7-0-394" class="d">-                onClick = {
</a><a href="#h7-0-395" id="h7-0-395" class="d">-                    showImportDialog = true
</a><a href="#h7-0-396" id="h7-0-396" class="d">-                },
</a><a href="#h7-0-397" id="h7-0-397" class="d">-                icon = { Icon(imageVector = Icons.Default.Link, contentDescription = &quot;Link&quot;) },
</a><a href="#h7-0-398" id="h7-0-398" class="d">-                text = {
</a><a href="#h7-0-399" id="h7-0-399" class="d">-                    Text(text = &quot;Import from URL&quot;)
</a><a href="#h7-0-400" id="h7-0-400" class="d">-                },
</a><a href="#h7-0-401" id="h7-0-401" class="d">-            )
</a><a href="#h7-0-402" id="h7-0-402" class="d">-            ExtendedFloatingActionButton(
</a><a href="#h7-0-403" id="h7-0-403" class="d">-                onClick = {
</a><a href="#h7-0-404" id="h7-0-404" class="d">-                    context.scriptManager.getScriptsFolder()?.let {
</a><a href="#h7-0-405" id="h7-0-405" class="d">-                        context.androidContext.startActivity(
</a><a href="#h7-0-406" id="h7-0-406" class="d">-                            Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h7-0-407" id="h7-0-407" class="d">-                                data = it.uri
</a><a href="#h7-0-408" id="h7-0-408" class="d">-                                flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h7-0-409" id="h7-0-409" class="d">-                            }
</a><a href="#h7-0-410" id="h7-0-410" class="d">-                        )
</a><a href="#h7-0-411" id="h7-0-411" class="d">-                    }
</a><a href="#h7-0-412" id="h7-0-412" class="d">-                },
</a><a href="#h7-0-413" id="h7-0-413" class="d">-                icon = {
</a><a href="#h7-0-414" id="h7-0-414" class="d">-                    Icon(
</a><a href="#h7-0-415" id="h7-0-415" class="d">-                        imageVector = Icons.Default.FolderOpen,
</a><a href="#h7-0-416" id="h7-0-416" class="d">-                        contentDescription = &quot;Folder&quot;
</a><a href="#h7-0-417" id="h7-0-417" class="d">-                    )
</a><a href="#h7-0-418" id="h7-0-418" class="d">-                },
</a><a href="#h7-0-419" id="h7-0-419" class="d">-                text = {
</a><a href="#h7-0-420" id="h7-0-420" class="d">-                    Text(text = &quot;Open Scripts Folder&quot;)
</a><a href="#h7-0-421" id="h7-0-421" class="d">-                },
</a><a href="#h7-0-422" id="h7-0-422" class="d">-            )
</a><a href="#h7-0-423" id="h7-0-423" class="d">-        }
</a><a href="#h7-0-424" id="h7-0-424" class="d">-    }
</a><a href="#h7-0-425" id="h7-0-425" class="d">-
</a><a href="#h7-0-426" id="h7-0-426" class="d">-
</a><a href="#h7-0-427" id="h7-0-427" class="d">-    @Composable
</a><a href="#h7-0-428" id="h7-0-428" class="d">-    fun ScriptSettings(script: ModuleInfo) {
</a><a href="#h7-0-429" id="h7-0-429" class="d">-        val settingsInterface = remember {
</a><a href="#h7-0-430" id="h7-0-430" class="d">-            val module =
</a><a href="#h7-0-431" id="h7-0-431" class="d">-                context.scriptManager.runtime.getModuleByName(script.name) ?: return@remember null
</a><a href="#h7-0-432" id="h7-0-432" class="d">-            (module.getBinding(InterfaceManager::class))?.buildInterface(EnumScriptInterface.SETTINGS)
</a><a href="#h7-0-433" id="h7-0-433" class="d">-        }
</a><a href="#h7-0-434" id="h7-0-434" class="d">-
</a><a href="#h7-0-435" id="h7-0-435" class="d">-        if (settingsInterface == null) {
</a><a href="#h7-0-436" id="h7-0-436" class="d">-            Text(
</a><a href="#h7-0-437" id="h7-0-437" class="d">-                text = &quot;This module does not have any settings&quot;,
</a><a href="#h7-0-438" id="h7-0-438" class="d">-                style = MaterialTheme.typography.bodySmall,
</a><a href="#h7-0-439" id="h7-0-439" class="d">-                modifier = Modifier.padding(8.dp)
</a><a href="#h7-0-440" id="h7-0-440" class="d">-            )
</a><a href="#h7-0-441" id="h7-0-441" class="d">-        } else {
</a><a href="#h7-0-442" id="h7-0-442" class="d">-            ScriptInterface(interfaceBuilder = settingsInterface)
</a><a href="#h7-0-443" id="h7-0-443" class="d">-        }
</a><a href="#h7-0-444" id="h7-0-444" class="d">-    }
</a><a href="#h7-0-445" id="h7-0-445" class="d">-
</a><a href="#h7-0-446" id="h7-0-446" class="d">-    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h7-0-447" id="h7-0-447" class="d">-        val scriptingFolder by rememberAsyncMutableState(
</a><a href="#h7-0-448" id="h7-0-448" class="d">-            defaultValue = null,
</a><a href="#h7-0-449" id="h7-0-449" class="d">-            updateDispatcher = reloadDispatcher
</a><a href="#h7-0-450" id="h7-0-450" class="d">-        ) {
</a><a href="#h7-0-451" id="h7-0-451" class="d">-            context.scriptManager.getScriptsFolder()
</a><a href="#h7-0-452" id="h7-0-452" class="d">-        }
</a><a href="#h7-0-453" id="h7-0-453" class="d">-        val scriptModules by rememberAsyncMutableState(
</a><a href="#h7-0-454" id="h7-0-454" class="d">-            defaultValue = emptyList(),
</a><a href="#h7-0-455" id="h7-0-455" class="d">-            updateDispatcher = reloadDispatcher
</a><a href="#h7-0-456" id="h7-0-456" class="d">-        ) {
</a><a href="#h7-0-457" id="h7-0-457" class="d">-            context.scriptManager.sync()
</a><a href="#h7-0-458" id="h7-0-458" class="d">-            context.scriptManager.getSyncedModules()
</a><a href="#h7-0-459" id="h7-0-459" class="d">-        }
</a><a href="#h7-0-460" id="h7-0-460" class="d">-
</a><a href="#h7-0-461" id="h7-0-461" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h7-0-462" id="h7-0-462" class="d">-
</a><a href="#h7-0-463" id="h7-0-463" class="d">-        var refreshing by remember {
</a><a href="#h7-0-464" id="h7-0-464" class="d">-            mutableStateOf(false)
</a><a href="#h7-0-465" id="h7-0-465" class="d">-        }
</a><a href="#h7-0-466" id="h7-0-466" class="d">-
</a><a href="#h7-0-467" id="h7-0-467" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h7-0-468" id="h7-0-468" class="d">-            refreshing = true
</a><a href="#h7-0-469" id="h7-0-469" class="d">-            withContext(Dispatchers.IO) {
</a><a href="#h7-0-470" id="h7-0-470" class="d">-                reloadDispatcher.dispatch()
</a><a href="#h7-0-471" id="h7-0-471" class="d">-                refreshing = false
</a><a href="#h7-0-472" id="h7-0-472" class="d">-            }
</a><a href="#h7-0-473" id="h7-0-473" class="d">-        }
</a><a href="#h7-0-474" id="h7-0-474" class="d">-
</a><a href="#h7-0-475" id="h7-0-475" class="d">-        val pullRefreshState = rememberPullRefreshState(refreshing, onRefresh = {
</a><a href="#h7-0-476" id="h7-0-476" class="d">-            refreshing = true
</a><a href="#h7-0-477" id="h7-0-477" class="d">-            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h7-0-478" id="h7-0-478" class="d">-                reloadDispatcher.dispatch()
</a><a href="#h7-0-479" id="h7-0-479" class="d">-                refreshing = false
</a><a href="#h7-0-480" id="h7-0-480" class="d">-            }
</a><a href="#h7-0-481" id="h7-0-481" class="d">-        })
</a><a href="#h7-0-482" id="h7-0-482" class="d">-
</a><a href="#h7-0-483" id="h7-0-483" class="d">-        Box(
</a><a href="#h7-0-484" id="h7-0-484" class="d">-            modifier = Modifier.fillMaxSize()
</a><a href="#h7-0-485" id="h7-0-485" class="d">-        ) {
</a><a href="#h7-0-486" id="h7-0-486" class="d">-            LazyColumn(
</a><a href="#h7-0-487" id="h7-0-487" class="d">-                modifier = Modifier
</a><a href="#h7-0-488" id="h7-0-488" class="d">-                    .fillMaxSize()
</a><a href="#h7-0-489" id="h7-0-489" class="d">-                    .pullRefresh(pullRefreshState),
</a><a href="#h7-0-490" id="h7-0-490" class="d">-                horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h7-0-491" id="h7-0-491" class="d">-            ) {
</a><a href="#h7-0-492" id="h7-0-492" class="d">-                item {
</a><a href="#h7-0-493" id="h7-0-493" class="d">-                    if (scriptingFolder == null &amp;&amp; !refreshing) {
</a><a href="#h7-0-494" id="h7-0-494" class="d">-                        Text(
</a><a href="#h7-0-495" id="h7-0-495" class="d">-                            text = &quot;No scripts folder selected&quot;,
</a><a href="#h7-0-496" id="h7-0-496" class="d">-                            style = MaterialTheme.typography.bodySmall,
</a><a href="#h7-0-497" id="h7-0-497" class="d">-                            modifier = Modifier.padding(8.dp)
</a><a href="#h7-0-498" id="h7-0-498" class="d">-                        )
</a><a href="#h7-0-499" id="h7-0-499" class="d">-                        Spacer(modifier = Modifier.height(8.dp))
</a><a href="#h7-0-500" id="h7-0-500" class="d">-                        Button(onClick = {
</a><a href="#h7-0-501" id="h7-0-501" class="d">-                            activityLauncherHelper.chooseFolder {
</a><a href="#h7-0-502" id="h7-0-502" class="d">-                                context.config.root.scripting.moduleFolder.set(it)
</a><a href="#h7-0-503" id="h7-0-503" class="d">-                                context.config.writeConfig()
</a><a href="#h7-0-504" id="h7-0-504" class="d">-                                coroutineScope.launch {
</a><a href="#h7-0-505" id="h7-0-505" class="d">-                                    reloadDispatcher.dispatch()
</a><a href="#h7-0-506" id="h7-0-506" class="d">-                                }
</a><a href="#h7-0-507" id="h7-0-507" class="d">-                            }
</a><a href="#h7-0-508" id="h7-0-508" class="d">-                        }) {
</a><a href="#h7-0-509" id="h7-0-509" class="d">-                            Text(text = &quot;Select folder&quot;)
</a><a href="#h7-0-510" id="h7-0-510" class="d">-                        }
</a><a href="#h7-0-511" id="h7-0-511" class="d">-                    } else if (scriptModules.isEmpty()) {
</a><a href="#h7-0-512" id="h7-0-512" class="d">-                        Text(
</a><a href="#h7-0-513" id="h7-0-513" class="d">-                            text = &quot;No scripts found&quot;,
</a><a href="#h7-0-514" id="h7-0-514" class="d">-                            style = MaterialTheme.typography.bodySmall,
</a><a href="#h7-0-515" id="h7-0-515" class="d">-                            modifier = Modifier.padding(8.dp)
</a><a href="#h7-0-516" id="h7-0-516" class="d">-                        )
</a><a href="#h7-0-517" id="h7-0-517" class="d">-                    }
</a><a href="#h7-0-518" id="h7-0-518" class="d">-                }
</a><a href="#h7-0-519" id="h7-0-519" class="d">-                items(scriptModules.size, key = { scriptModules[it].hashCode() }) { index -&gt;
</a><a href="#h7-0-520" id="h7-0-520" class="d">-                    ModuleItem(scriptModules[index])
</a><a href="#h7-0-521" id="h7-0-521" class="d">-                }
</a><a href="#h7-0-522" id="h7-0-522" class="d">-                item {
</a><a href="#h7-0-523" id="h7-0-523" class="d">-                    Spacer(modifier = Modifier.height(200.dp))
</a><a href="#h7-0-524" id="h7-0-524" class="d">-                }
</a><a href="#h7-0-525" id="h7-0-525" class="d">-            }
</a><a href="#h7-0-526" id="h7-0-526" class="d">-
</a><a href="#h7-0-527" id="h7-0-527" class="d">-            PullRefreshIndicator(
</a><a href="#h7-0-528" id="h7-0-528" class="d">-                refreshing = refreshing,
</a><a href="#h7-0-529" id="h7-0-529" class="d">-                state = pullRefreshState,
</a><a href="#h7-0-530" id="h7-0-530" class="d">-                modifier = Modifier.align(Alignment.TopCenter)
</a><a href="#h7-0-531" id="h7-0-531" class="d">-            )
</a><a href="#h7-0-532" id="h7-0-532" class="d">-        }
</a><a href="#h7-0-533" id="h7-0-533" class="d">-
</a><a href="#h7-0-534" id="h7-0-534" class="d">-        var scriptingWarning by remember {
</a><a href="#h7-0-535" id="h7-0-535" class="d">-            mutableStateOf(context.sharedPreferences.run {
</a><a href="#h7-0-536" id="h7-0-536" class="d">-                getBoolean(&quot;scripting_warning&quot;, true).also {
</a><a href="#h7-0-537" id="h7-0-537" class="d">-                    edit().putBoolean(&quot;scripting_warning&quot;, false).apply()
</a><a href="#h7-0-538" id="h7-0-538" class="d">-                }
</a><a href="#h7-0-539" id="h7-0-539" class="d">-            })
</a><a href="#h7-0-540" id="h7-0-540" class="d">-        }
</a><a href="#h7-0-541" id="h7-0-541" class="d">-
</a><a href="#h7-0-542" id="h7-0-542" class="d">-        if (scriptingWarning) {
</a><a href="#h7-0-543" id="h7-0-543" class="d">-            var timeout by remember {
</a><a href="#h7-0-544" id="h7-0-544" class="d">-                mutableIntStateOf(10)
</a><a href="#h7-0-545" id="h7-0-545" class="d">-            }
</a><a href="#h7-0-546" id="h7-0-546" class="d">-
</a><a href="#h7-0-547" id="h7-0-547" class="d">-            LaunchedEffect(Unit) {
</a><a href="#h7-0-548" id="h7-0-548" class="d">-                while (timeout &gt; 0) {
</a><a href="#h7-0-549" id="h7-0-549" class="d">-                    delay(1000)
</a><a href="#h7-0-550" id="h7-0-550" class="d">-                    timeout--
</a><a href="#h7-0-551" id="h7-0-551" class="d">-                }
</a><a href="#h7-0-552" id="h7-0-552" class="d">-            }
</a><a href="#h7-0-553" id="h7-0-553" class="d">-
</a><a href="#h7-0-554" id="h7-0-554" class="d">-            AlertDialog(onDismissRequest = {
</a><a href="#h7-0-555" id="h7-0-555" class="d">-                if (timeout == 0) {
</a><a href="#h7-0-556" id="h7-0-556" class="d">-                    scriptingWarning = false
</a><a href="#h7-0-557" id="h7-0-557" class="d">-                }
</a><a href="#h7-0-558" id="h7-0-558" class="d">-            }, title = {
</a><a href="#h7-0-559" id="h7-0-559" class="d">-                Text(text = context.translation[&quot;manager.dialogs.scripting_warning.title&quot;])
</a><a href="#h7-0-560" id="h7-0-560" class="d">-            }, text = {
</a><a href="#h7-0-561" id="h7-0-561" class="d">-                Text(text = context.translation[&quot;manager.dialogs.scripting_warning.content&quot;])
</a><a href="#h7-0-562" id="h7-0-562" class="d">-            }, confirmButton = {
</a><a href="#h7-0-563" id="h7-0-563" class="d">-                TextButton(
</a><a href="#h7-0-564" id="h7-0-564" class="d">-                    onClick = {
</a><a href="#h7-0-565" id="h7-0-565" class="d">-                        scriptingWarning = false
</a><a href="#h7-0-566" id="h7-0-566" class="d">-                    },
</a><a href="#h7-0-567" id="h7-0-567" class="d">-                    enabled = timeout == 0
</a><a href="#h7-0-568" id="h7-0-568" class="d">-                ) {
</a><a href="#h7-0-569" id="h7-0-569" class="d">-                    Text(text = &quot;OK &quot; + if (timeout &gt; 0) &quot;($timeout)&quot; else &quot;&quot;)
</a><a href="#h7-0-570" id="h7-0-570" class="d">-                }
</a><a href="#h7-0-571" id="h7-0-571" class="d">-            })
</a><a href="#h7-0-572" id="h7-0-572" class="d">-        }
</a><a href="#h7-0-573" id="h7-0-573" class="d">-    }
</a><a href="#h7-0-574" id="h7-0-574" class="d">-
</a><a href="#h7-0-575" id="h7-0-575" class="d">-    override val topBarActions: @Composable() (RowScope.() -&gt; Unit) = {
</a><a href="#h7-0-576" id="h7-0-576" class="d">-        IconButton(onClick = {
</a><a href="#h7-0-577" id="h7-0-577" class="d">-            context.androidContext.startActivity(Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h7-0-578" id="h7-0-578" class="d">-                data = &quot;https://github.com/SnapEnhance/docs&quot;.toUri()
</a><a href="#h7-0-579" id="h7-0-579" class="d">-                flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h7-0-580" id="h7-0-580" class="d">-            })
</a><a href="#h7-0-581" id="h7-0-581" class="d">-        }) {
</a><a href="#h7-0-582" id="h7-0-582" class="d">-            Icon(
</a><a href="#h7-0-583" id="h7-0-583" class="d">-                imageVector = Icons.AutoMirrored.Default.LibraryBooks,
</a><a href="#h7-0-584" id="h7-0-584" class="d">-                contentDescription = &quot;Documentation&quot;
</a><a href="#h7-0-585" id="h7-0-585" class="d">-            )
</a><a href="#h7-0-586" id="h7-0-586" class="d">-        }
</a><a href="#h7-0-587" id="h7-0-587" class="d">-    }
</a><a href="#h7-0-588" id="h7-0-588" class="d">-}</a><a href="#h7-0-589" id="h7-0-589" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/scripting/ScriptingRootSection.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -0,0 +1,589 @@
</a><a href="#h8-0-0" id="h8-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages.scripting
</a><a href="#h8-0-1" id="h8-0-1" class="i">+
</a><a href="#h8-0-2" id="h8-0-2" class="i">+import android.content.Intent
</a><a href="#h8-0-3" id="h8-0-3" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h8-0-4" id="h8-0-4" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h8-0-5" id="h8-0-5" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h8-0-6" id="h8-0-6" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h8-0-7" id="h8-0-7" class="i">+import androidx.compose.material.icons.automirrored.filled.LibraryBooks
</a><a href="#h8-0-8" id="h8-0-8" class="i">+import androidx.compose.material.icons.filled.*
</a><a href="#h8-0-9" id="h8-0-9" class="i">+import androidx.compose.material3.*
</a><a href="#h8-0-10" id="h8-0-10" class="i">+import androidx.compose.runtime.*
</a><a href="#h8-0-11" id="h8-0-11" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h8-0-12" id="h8-0-12" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h8-0-13" id="h8-0-13" class="i">+import androidx.compose.ui.focus.FocusRequester
</a><a href="#h8-0-14" id="h8-0-14" class="i">+import androidx.compose.ui.focus.focusRequester
</a><a href="#h8-0-15" id="h8-0-15" class="i">+import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h8-0-16" id="h8-0-16" class="i">+import androidx.compose.ui.layout.onGloballyPositioned
</a><a href="#h8-0-17" id="h8-0-17" class="i">+import androidx.compose.ui.text.font.FontStyle
</a><a href="#h8-0-18" id="h8-0-18" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h8-0-19" id="h8-0-19" class="i">+import androidx.compose.ui.text.style.TextAlign
</a><a href="#h8-0-20" id="h8-0-20" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h8-0-21" id="h8-0-21" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h8-0-22" id="h8-0-22" class="i">+import androidx.core.net.toUri
</a><a href="#h8-0-23" id="h8-0-23" class="i">+import androidx.navigation.NavBackStackEntry
</a><a href="#h8-0-24" id="h8-0-24" class="i">+import kotlinx.coroutines.Dispatchers
</a><a href="#h8-0-25" id="h8-0-25" class="i">+import kotlinx.coroutines.asCoroutineDispatcher
</a><a href="#h8-0-26" id="h8-0-26" class="i">+import kotlinx.coroutines.delay
</a><a href="#h8-0-27" id="h8-0-27" class="i">+import kotlinx.coroutines.launch
</a><a href="#h8-0-28" id="h8-0-28" class="i">+import kotlinx.coroutines.withContext
</a><a href="#h8-0-29" id="h8-0-29" class="i">+import me.rhunk.snapenhance.common.scripting.type.ModuleInfo
</a><a href="#h8-0-30" id="h8-0-30" class="i">+import me.rhunk.snapenhance.common.scripting.ui.EnumScriptInterface
</a><a href="#h8-0-31" id="h8-0-31" class="i">+import me.rhunk.snapenhance.common.scripting.ui.InterfaceManager
</a><a href="#h8-0-32" id="h8-0-32" class="i">+import me.rhunk.snapenhance.common.scripting.ui.ScriptInterface
</a><a href="#h8-0-33" id="h8-0-33" class="i">+import me.rhunk.snapenhance.common.ui.AsyncUpdateDispatcher
</a><a href="#h8-0-34" id="h8-0-34" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h8-0-35" id="h8-0-35" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncUpdateDispatcher
</a><a href="#h8-0-36" id="h8-0-36" class="i">+import me.rhunk.snapenhance.storage.isScriptEnabled
</a><a href="#h8-0-37" id="h8-0-37" class="i">+import me.rhunk.snapenhance.storage.setScriptEnabled
</a><a href="#h8-0-38" id="h8-0-38" class="i">+import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h8-0-39" id="h8-0-39" class="i">+import me.rhunk.snapenhance.ui.util.ActivityLauncherHelper
</a><a href="#h8-0-40" id="h8-0-40" class="i">+import me.rhunk.snapenhance.ui.util.Dialog
</a><a href="#h8-0-41" id="h8-0-41" class="i">+import me.rhunk.snapenhance.ui.util.chooseFolder
</a><a href="#h8-0-42" id="h8-0-42" class="i">+import me.rhunk.snapenhance.ui.util.pullrefresh.PullRefreshIndicator
</a><a href="#h8-0-43" id="h8-0-43" class="i">+import me.rhunk.snapenhance.ui.util.pullrefresh.pullRefresh
</a><a href="#h8-0-44" id="h8-0-44" class="i">+import me.rhunk.snapenhance.ui.util.pullrefresh.rememberPullRefreshState
</a><a href="#h8-0-45" id="h8-0-45" class="i">+
</a><a href="#h8-0-46" id="h8-0-46" class="i">+class ScriptingRootSection : Routes.Route() {
</a><a href="#h8-0-47" id="h8-0-47" class="i">+    private lateinit var activityLauncherHelper: ActivityLauncherHelper
</a><a href="#h8-0-48" id="h8-0-48" class="i">+    private val reloadDispatcher = AsyncUpdateDispatcher(updateOnFirstComposition = false)
</a><a href="#h8-0-49" id="h8-0-49" class="i">+
</a><a href="#h8-0-50" id="h8-0-50" class="i">+    override val init: () -&gt; Unit = {
</a><a href="#h8-0-51" id="h8-0-51" class="i">+        activityLauncherHelper = ActivityLauncherHelper(context.activity!!)
</a><a href="#h8-0-52" id="h8-0-52" class="i">+    }
</a><a href="#h8-0-53" id="h8-0-53" class="i">+
</a><a href="#h8-0-54" id="h8-0-54" class="i">+    @Composable
</a><a href="#h8-0-55" id="h8-0-55" class="i">+    private fun ImportRemoteScript(
</a><a href="#h8-0-56" id="h8-0-56" class="i">+        dismiss: () -&gt; Unit
</a><a href="#h8-0-57" id="h8-0-57" class="i">+    ) {
</a><a href="#h8-0-58" id="h8-0-58" class="i">+        Dialog(onDismissRequest = dismiss) {
</a><a href="#h8-0-59" id="h8-0-59" class="i">+            var url by remember { mutableStateOf(&quot;&quot;) }
</a><a href="#h8-0-60" id="h8-0-60" class="i">+            val focusRequester = remember { FocusRequester() }
</a><a href="#h8-0-61" id="h8-0-61" class="i">+            var isLoading by remember {
</a><a href="#h8-0-62" id="h8-0-62" class="i">+                mutableStateOf(false)
</a><a href="#h8-0-63" id="h8-0-63" class="i">+            }
</a><a href="#h8-0-64" id="h8-0-64" class="i">+            ElevatedCard(
</a><a href="#h8-0-65" id="h8-0-65" class="i">+                modifier = Modifier
</a><a href="#h8-0-66" id="h8-0-66" class="i">+                    .fillMaxWidth(),
</a><a href="#h8-0-67" id="h8-0-67" class="i">+            ) {
</a><a href="#h8-0-68" id="h8-0-68" class="i">+                Column(
</a><a href="#h8-0-69" id="h8-0-69" class="i">+                    modifier = Modifier
</a><a href="#h8-0-70" id="h8-0-70" class="i">+                        .fillMaxWidth()
</a><a href="#h8-0-71" id="h8-0-71" class="i">+                        .padding(16.dp),
</a><a href="#h8-0-72" id="h8-0-72" class="i">+                    horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h8-0-73" id="h8-0-73" class="i">+                ) {
</a><a href="#h8-0-74" id="h8-0-74" class="i">+                    Text(
</a><a href="#h8-0-75" id="h8-0-75" class="i">+                        text = &quot;Import Script from URL&quot;,
</a><a href="#h8-0-76" id="h8-0-76" class="i">+                        fontSize = 22.sp,
</a><a href="#h8-0-77" id="h8-0-77" class="i">+                        fontWeight = FontWeight.Bold,
</a><a href="#h8-0-78" id="h8-0-78" class="i">+                        modifier = Modifier.padding(8.dp),
</a><a href="#h8-0-79" id="h8-0-79" class="i">+                    )
</a><a href="#h8-0-80" id="h8-0-80" class="i">+                    Text(
</a><a href="#h8-0-81" id="h8-0-81" class="i">+                        text = &quot;Warning: Imported scripts can be harmful to your device. Only import scripts from trusted sources.&quot;,
</a><a href="#h8-0-82" id="h8-0-82" class="i">+                        fontSize = 14.sp,
</a><a href="#h8-0-83" id="h8-0-83" class="i">+                        fontWeight = FontWeight.Light,
</a><a href="#h8-0-84" id="h8-0-84" class="i">+                        fontStyle = FontStyle.Italic,
</a><a href="#h8-0-85" id="h8-0-85" class="i">+                        modifier = Modifier.padding(8.dp),
</a><a href="#h8-0-86" id="h8-0-86" class="i">+                        textAlign = TextAlign.Center,
</a><a href="#h8-0-87" id="h8-0-87" class="i">+                    )
</a><a href="#h8-0-88" id="h8-0-88" class="i">+                    TextField(
</a><a href="#h8-0-89" id="h8-0-89" class="i">+                        value = url,
</a><a href="#h8-0-90" id="h8-0-90" class="i">+                        onValueChange = {
</a><a href="#h8-0-91" id="h8-0-91" class="i">+                            url = it
</a><a href="#h8-0-92" id="h8-0-92" class="i">+                        },
</a><a href="#h8-0-93" id="h8-0-93" class="i">+                        label = {
</a><a href="#h8-0-94" id="h8-0-94" class="i">+                            Text(text = &quot;Enter URL here:&quot;)
</a><a href="#h8-0-95" id="h8-0-95" class="i">+                        },
</a><a href="#h8-0-96" id="h8-0-96" class="i">+                        modifier = Modifier
</a><a href="#h8-0-97" id="h8-0-97" class="i">+                            .fillMaxWidth()
</a><a href="#h8-0-98" id="h8-0-98" class="i">+                            .focusRequester(focusRequester)
</a><a href="#h8-0-99" id="h8-0-99" class="i">+                            .onGloballyPositioned {
</a><a href="#h8-0-100" id="h8-0-100" class="i">+                                focusRequester.requestFocus()
</a><a href="#h8-0-101" id="h8-0-101" class="i">+                            }
</a><a href="#h8-0-102" id="h8-0-102" class="i">+                    )
</a><a href="#h8-0-103" id="h8-0-103" class="i">+                    Spacer(modifier = Modifier.height(8.dp))
</a><a href="#h8-0-104" id="h8-0-104" class="i">+                    Button(
</a><a href="#h8-0-105" id="h8-0-105" class="i">+                        enabled = url.isNotBlank(),
</a><a href="#h8-0-106" id="h8-0-106" class="i">+                        onClick = {
</a><a href="#h8-0-107" id="h8-0-107" class="i">+                            isLoading = true
</a><a href="#h8-0-108" id="h8-0-108" class="i">+                            context.coroutineScope.launch {
</a><a href="#h8-0-109" id="h8-0-109" class="i">+                                runCatching {
</a><a href="#h8-0-110" id="h8-0-110" class="i">+                                    val moduleInfo = context.scriptManager.importFromUrl(url)
</a><a href="#h8-0-111" id="h8-0-111" class="i">+                                    context.shortToast(&quot;Script ${moduleInfo.name} imported!&quot;)
</a><a href="#h8-0-112" id="h8-0-112" class="i">+                                    reloadDispatcher.dispatch()
</a><a href="#h8-0-113" id="h8-0-113" class="i">+                                    withContext(Dispatchers.Main) {
</a><a href="#h8-0-114" id="h8-0-114" class="i">+                                        dismiss()
</a><a href="#h8-0-115" id="h8-0-115" class="i">+                                    }
</a><a href="#h8-0-116" id="h8-0-116" class="i">+                                    return@launch
</a><a href="#h8-0-117" id="h8-0-117" class="i">+                                }.onFailure {
</a><a href="#h8-0-118" id="h8-0-118" class="i">+                                    context.log.error(&quot;Failed to import script&quot;, it)
</a><a href="#h8-0-119" id="h8-0-119" class="i">+                                    context.shortToast(&quot;Failed to import script. ${it.message}. Check logs for more details&quot;)
</a><a href="#h8-0-120" id="h8-0-120" class="i">+                                }
</a><a href="#h8-0-121" id="h8-0-121" class="i">+                                isLoading = false
</a><a href="#h8-0-122" id="h8-0-122" class="i">+                            }
</a><a href="#h8-0-123" id="h8-0-123" class="i">+                        },
</a><a href="#h8-0-124" id="h8-0-124" class="i">+                    ) {
</a><a href="#h8-0-125" id="h8-0-125" class="i">+                        if (isLoading) {
</a><a href="#h8-0-126" id="h8-0-126" class="i">+                            CircularProgressIndicator(
</a><a href="#h8-0-127" id="h8-0-127" class="i">+                                modifier = Modifier
</a><a href="#h8-0-128" id="h8-0-128" class="i">+                                    .size(30.dp),
</a><a href="#h8-0-129" id="h8-0-129" class="i">+                                strokeWidth = 3.dp,
</a><a href="#h8-0-130" id="h8-0-130" class="i">+                                color = MaterialTheme.colorScheme.onPrimary
</a><a href="#h8-0-131" id="h8-0-131" class="i">+                            )
</a><a href="#h8-0-132" id="h8-0-132" class="i">+                        } else {
</a><a href="#h8-0-133" id="h8-0-133" class="i">+                            Text(text = &quot;Import&quot;)
</a><a href="#h8-0-134" id="h8-0-134" class="i">+                        }
</a><a href="#h8-0-135" id="h8-0-135" class="i">+                    }
</a><a href="#h8-0-136" id="h8-0-136" class="i">+                }
</a><a href="#h8-0-137" id="h8-0-137" class="i">+            }
</a><a href="#h8-0-138" id="h8-0-138" class="i">+        }
</a><a href="#h8-0-139" id="h8-0-139" class="i">+    }
</a><a href="#h8-0-140" id="h8-0-140" class="i">+
</a><a href="#h8-0-141" id="h8-0-141" class="i">+
</a><a href="#h8-0-142" id="h8-0-142" class="i">+    @Composable
</a><a href="#h8-0-143" id="h8-0-143" class="i">+    private fun ModuleActions(
</a><a href="#h8-0-144" id="h8-0-144" class="i">+        script: ModuleInfo,
</a><a href="#h8-0-145" id="h8-0-145" class="i">+        canUpdate: Boolean,
</a><a href="#h8-0-146" id="h8-0-146" class="i">+        dismiss: () -&gt; Unit
</a><a href="#h8-0-147" id="h8-0-147" class="i">+    ) {
</a><a href="#h8-0-148" id="h8-0-148" class="i">+        Dialog(
</a><a href="#h8-0-149" id="h8-0-149" class="i">+            onDismissRequest = dismiss,
</a><a href="#h8-0-150" id="h8-0-150" class="i">+        ) {
</a><a href="#h8-0-151" id="h8-0-151" class="i">+            ElevatedCard(
</a><a href="#h8-0-152" id="h8-0-152" class="i">+                modifier = Modifier
</a><a href="#h8-0-153" id="h8-0-153" class="i">+                    .fillMaxWidth()
</a><a href="#h8-0-154" id="h8-0-154" class="i">+                    .padding(2.dp),
</a><a href="#h8-0-155" id="h8-0-155" class="i">+            ) {
</a><a href="#h8-0-156" id="h8-0-156" class="i">+                val actions = remember {
</a><a href="#h8-0-157" id="h8-0-157" class="i">+                    mutableMapOf&lt;Pair&lt;String, ImageVector&gt;, suspend () -&gt; Unit&gt;().apply {
</a><a href="#h8-0-158" id="h8-0-158" class="i">+                        if (canUpdate) {
</a><a href="#h8-0-159" id="h8-0-159" class="i">+                            put(&quot;Update Module&quot; to Icons.Default.Download) {
</a><a href="#h8-0-160" id="h8-0-160" class="i">+                                dismiss()
</a><a href="#h8-0-161" id="h8-0-161" class="i">+                                context.shortToast(&quot;Updating script ${script.name}...&quot;)
</a><a href="#h8-0-162" id="h8-0-162" class="i">+                                runCatching {
</a><a href="#h8-0-163" id="h8-0-163" class="i">+                                    val modulePath = context.scriptManager.getModulePath(script.name) ?: throw Exception(&quot;Module not found&quot;)
</a><a href="#h8-0-164" id="h8-0-164" class="i">+                                    context.scriptManager.unloadScript(modulePath)
</a><a href="#h8-0-165" id="h8-0-165" class="i">+                                    val moduleInfo = context.scriptManager.importFromUrl(script.updateUrl!!, filepath = modulePath)
</a><a href="#h8-0-166" id="h8-0-166" class="i">+                                    context.shortToast(&quot;Updated ${script.name} to version ${moduleInfo.version}&quot;)
</a><a href="#h8-0-167" id="h8-0-167" class="i">+                                    context.database.setScriptEnabled(script.name, false)
</a><a href="#h8-0-168" id="h8-0-168" class="i">+                                    withContext(context.database.executor.asCoroutineDispatcher()) {
</a><a href="#h8-0-169" id="h8-0-169" class="i">+                                        reloadDispatcher.dispatch()
</a><a href="#h8-0-170" id="h8-0-170" class="i">+                                    }
</a><a href="#h8-0-171" id="h8-0-171" class="i">+                                }.onFailure {
</a><a href="#h8-0-172" id="h8-0-172" class="i">+                                    context.log.error(&quot;Failed to update module&quot;, it)
</a><a href="#h8-0-173" id="h8-0-173" class="i">+                                    context.shortToast(&quot;Failed to update module. Check logs for more details&quot;)
</a><a href="#h8-0-174" id="h8-0-174" class="i">+                                }
</a><a href="#h8-0-175" id="h8-0-175" class="i">+                            }
</a><a href="#h8-0-176" id="h8-0-176" class="i">+                        }
</a><a href="#h8-0-177" id="h8-0-177" class="i">+
</a><a href="#h8-0-178" id="h8-0-178" class="i">+                        put(&quot;Edit Module&quot; to Icons.Default.Edit) {
</a><a href="#h8-0-179" id="h8-0-179" class="i">+                            runCatching {
</a><a href="#h8-0-180" id="h8-0-180" class="i">+                                val modulePath = context.scriptManager.getModulePath(script.name)!!
</a><a href="#h8-0-181" id="h8-0-181" class="i">+                                context.androidContext.startActivity(
</a><a href="#h8-0-182" id="h8-0-182" class="i">+                                    Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h8-0-183" id="h8-0-183" class="i">+                                        data = context.scriptManager.getScriptsFolder()!!
</a><a href="#h8-0-184" id="h8-0-184" class="i">+                                            .findFile(modulePath)!!.uri
</a><a href="#h8-0-185" id="h8-0-185" class="i">+                                        flags =
</a><a href="#h8-0-186" id="h8-0-186" class="i">+                                            Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION
</a><a href="#h8-0-187" id="h8-0-187" class="i">+                                    }
</a><a href="#h8-0-188" id="h8-0-188" class="i">+                                )
</a><a href="#h8-0-189" id="h8-0-189" class="i">+                                dismiss()
</a><a href="#h8-0-190" id="h8-0-190" class="i">+                            }.onFailure {
</a><a href="#h8-0-191" id="h8-0-191" class="i">+                                context.log.error(&quot;Failed to open module file&quot;, it)
</a><a href="#h8-0-192" id="h8-0-192" class="i">+                                context.shortToast(&quot;Failed to open module file. Check logs for more details&quot;)
</a><a href="#h8-0-193" id="h8-0-193" class="i">+                            }
</a><a href="#h8-0-194" id="h8-0-194" class="i">+                        }
</a><a href="#h8-0-195" id="h8-0-195" class="i">+                        put(&quot;Clear Module Data&quot; to Icons.Default.Save) {
</a><a href="#h8-0-196" id="h8-0-196" class="i">+                            runCatching {
</a><a href="#h8-0-197" id="h8-0-197" class="i">+                                context.scriptManager.getModuleDataFolder(script.name)
</a><a href="#h8-0-198" id="h8-0-198" class="i">+                                    .deleteRecursively()
</a><a href="#h8-0-199" id="h8-0-199" class="i">+                                context.shortToast(&quot;Module data cleared!&quot;)
</a><a href="#h8-0-200" id="h8-0-200" class="i">+                                dismiss()
</a><a href="#h8-0-201" id="h8-0-201" class="i">+                            }.onFailure {
</a><a href="#h8-0-202" id="h8-0-202" class="i">+                                context.log.error(&quot;Failed to clear module data&quot;, it)
</a><a href="#h8-0-203" id="h8-0-203" class="i">+                                context.shortToast(&quot;Failed to clear module data. Check logs for more details&quot;)
</a><a href="#h8-0-204" id="h8-0-204" class="i">+                            }
</a><a href="#h8-0-205" id="h8-0-205" class="i">+                        }
</a><a href="#h8-0-206" id="h8-0-206" class="i">+                        put(&quot;Delete Module&quot; to Icons.Default.DeleteOutline) {
</a><a href="#h8-0-207" id="h8-0-207" class="i">+                            context.scriptManager.apply {
</a><a href="#h8-0-208" id="h8-0-208" class="i">+                                runCatching {
</a><a href="#h8-0-209" id="h8-0-209" class="i">+                                    val modulePath = getModulePath(script.name)!!
</a><a href="#h8-0-210" id="h8-0-210" class="i">+                                    unloadScript(modulePath)
</a><a href="#h8-0-211" id="h8-0-211" class="i">+                                    getScriptsFolder()?.findFile(modulePath)?.delete()
</a><a href="#h8-0-212" id="h8-0-212" class="i">+                                    reloadDispatcher.dispatch()
</a><a href="#h8-0-213" id="h8-0-213" class="i">+                                    context.shortToast(&quot;Deleted script ${script.name}!&quot;)
</a><a href="#h8-0-214" id="h8-0-214" class="i">+                                    dismiss()
</a><a href="#h8-0-215" id="h8-0-215" class="i">+                                }.onFailure {
</a><a href="#h8-0-216" id="h8-0-216" class="i">+                                    context.log.error(&quot;Failed to delete module&quot;, it)
</a><a href="#h8-0-217" id="h8-0-217" class="i">+                                    context.shortToast(&quot;Failed to delete module. Check logs for more details&quot;)
</a><a href="#h8-0-218" id="h8-0-218" class="i">+                                }
</a><a href="#h8-0-219" id="h8-0-219" class="i">+                            }
</a><a href="#h8-0-220" id="h8-0-220" class="i">+                        }
</a><a href="#h8-0-221" id="h8-0-221" class="i">+                    }.toMap()
</a><a href="#h8-0-222" id="h8-0-222" class="i">+                }
</a><a href="#h8-0-223" id="h8-0-223" class="i">+
</a><a href="#h8-0-224" id="h8-0-224" class="i">+                LazyColumn(
</a><a href="#h8-0-225" id="h8-0-225" class="i">+                    modifier = Modifier.fillMaxWidth()
</a><a href="#h8-0-226" id="h8-0-226" class="i">+                ) {
</a><a href="#h8-0-227" id="h8-0-227" class="i">+                    item {
</a><a href="#h8-0-228" id="h8-0-228" class="i">+                        Text(
</a><a href="#h8-0-229" id="h8-0-229" class="i">+                            text = &quot;Actions&quot;,
</a><a href="#h8-0-230" id="h8-0-230" class="i">+                            fontSize = 22.sp,
</a><a href="#h8-0-231" id="h8-0-231" class="i">+                            fontWeight = FontWeight.Bold,
</a><a href="#h8-0-232" id="h8-0-232" class="i">+                            modifier = Modifier
</a><a href="#h8-0-233" id="h8-0-233" class="i">+                                .padding(16.dp)
</a><a href="#h8-0-234" id="h8-0-234" class="i">+                                .fillMaxWidth(),
</a><a href="#h8-0-235" id="h8-0-235" class="i">+                            textAlign = TextAlign.Center,
</a><a href="#h8-0-236" id="h8-0-236" class="i">+                        )
</a><a href="#h8-0-237" id="h8-0-237" class="i">+                    }
</a><a href="#h8-0-238" id="h8-0-238" class="i">+                    items(actions.size) { index -&gt;
</a><a href="#h8-0-239" id="h8-0-239" class="i">+                        val action = actions.entries.elementAt(index)
</a><a href="#h8-0-240" id="h8-0-240" class="i">+                        ListItem(
</a><a href="#h8-0-241" id="h8-0-241" class="i">+                            modifier = Modifier
</a><a href="#h8-0-242" id="h8-0-242" class="i">+                                .clickable {
</a><a href="#h8-0-243" id="h8-0-243" class="i">+                                    context.coroutineScope.launch {
</a><a href="#h8-0-244" id="h8-0-244" class="i">+                                        action.value()
</a><a href="#h8-0-245" id="h8-0-245" class="i">+                                        dismiss()
</a><a href="#h8-0-246" id="h8-0-246" class="i">+                                    }
</a><a href="#h8-0-247" id="h8-0-247" class="i">+                                }
</a><a href="#h8-0-248" id="h8-0-248" class="i">+                                .fillMaxWidth(),
</a><a href="#h8-0-249" id="h8-0-249" class="i">+                            leadingContent = {
</a><a href="#h8-0-250" id="h8-0-250" class="i">+                                Icon(
</a><a href="#h8-0-251" id="h8-0-251" class="i">+                                    imageVector = action.key.second,
</a><a href="#h8-0-252" id="h8-0-252" class="i">+                                    contentDescription = action.key.first
</a><a href="#h8-0-253" id="h8-0-253" class="i">+                                )
</a><a href="#h8-0-254" id="h8-0-254" class="i">+                            },
</a><a href="#h8-0-255" id="h8-0-255" class="i">+                            headlineContent = {
</a><a href="#h8-0-256" id="h8-0-256" class="i">+                                Text(text = action.key.first)
</a><a href="#h8-0-257" id="h8-0-257" class="i">+                            },
</a><a href="#h8-0-258" id="h8-0-258" class="i">+                        )
</a><a href="#h8-0-259" id="h8-0-259" class="i">+                    }
</a><a href="#h8-0-260" id="h8-0-260" class="i">+                }
</a><a href="#h8-0-261" id="h8-0-261" class="i">+            }
</a><a href="#h8-0-262" id="h8-0-262" class="i">+        }
</a><a href="#h8-0-263" id="h8-0-263" class="i">+    }
</a><a href="#h8-0-264" id="h8-0-264" class="i">+
</a><a href="#h8-0-265" id="h8-0-265" class="i">+    @Composable
</a><a href="#h8-0-266" id="h8-0-266" class="i">+    fun ModuleItem(script: ModuleInfo) {
</a><a href="#h8-0-267" id="h8-0-267" class="i">+        var enabled by rememberAsyncMutableState(defaultValue = false, keys = arrayOf(script)) {
</a><a href="#h8-0-268" id="h8-0-268" class="i">+            context.database.isScriptEnabled(script.name)
</a><a href="#h8-0-269" id="h8-0-269" class="i">+        }
</a><a href="#h8-0-270" id="h8-0-270" class="i">+        var openSettings by remember(script) { mutableStateOf(false) }
</a><a href="#h8-0-271" id="h8-0-271" class="i">+        var openActions by remember { mutableStateOf(false) }
</a><a href="#h8-0-272" id="h8-0-272" class="i">+
</a><a href="#h8-0-273" id="h8-0-273" class="i">+        val dispatcher = rememberAsyncUpdateDispatcher()
</a><a href="#h8-0-274" id="h8-0-274" class="i">+        val reloadCallback = remember { suspend { dispatcher.dispatch() } }
</a><a href="#h8-0-275" id="h8-0-275" class="i">+        val latestUpdate by rememberAsyncMutableState(defaultValue = null, updateDispatcher = dispatcher, keys = arrayOf(script)) {
</a><a href="#h8-0-276" id="h8-0-276" class="i">+            context.scriptManager.checkForUpdate(script)
</a><a href="#h8-0-277" id="h8-0-277" class="i">+        }
</a><a href="#h8-0-278" id="h8-0-278" class="i">+
</a><a href="#h8-0-279" id="h8-0-279" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h8-0-280" id="h8-0-280" class="i">+            reloadDispatcher.addCallback(reloadCallback)
</a><a href="#h8-0-281" id="h8-0-281" class="i">+        }
</a><a href="#h8-0-282" id="h8-0-282" class="i">+
</a><a href="#h8-0-283" id="h8-0-283" class="i">+        DisposableEffect(Unit) {
</a><a href="#h8-0-284" id="h8-0-284" class="i">+            onDispose {
</a><a href="#h8-0-285" id="h8-0-285" class="i">+                reloadDispatcher.removeCallback(reloadCallback)
</a><a href="#h8-0-286" id="h8-0-286" class="i">+            }
</a><a href="#h8-0-287" id="h8-0-287" class="i">+        }
</a><a href="#h8-0-288" id="h8-0-288" class="i">+
</a><a href="#h8-0-289" id="h8-0-289" class="i">+        Card(
</a><a href="#h8-0-290" id="h8-0-290" class="i">+            modifier = Modifier
</a><a href="#h8-0-291" id="h8-0-291" class="i">+                .fillMaxWidth()
</a><a href="#h8-0-292" id="h8-0-292" class="i">+                .padding(8.dp),
</a><a href="#h8-0-293" id="h8-0-293" class="i">+            elevation = CardDefaults.cardElevation()
</a><a href="#h8-0-294" id="h8-0-294" class="i">+        ) {
</a><a href="#h8-0-295" id="h8-0-295" class="i">+            Row(
</a><a href="#h8-0-296" id="h8-0-296" class="i">+                modifier = Modifier
</a><a href="#h8-0-297" id="h8-0-297" class="i">+                    .fillMaxWidth()
</a><a href="#h8-0-298" id="h8-0-298" class="i">+                    .clickable {
</a><a href="#h8-0-299" id="h8-0-299" class="i">+                        if (!enabled) return@clickable
</a><a href="#h8-0-300" id="h8-0-300" class="i">+                        openSettings = !openSettings
</a><a href="#h8-0-301" id="h8-0-301" class="i">+                    }
</a><a href="#h8-0-302" id="h8-0-302" class="i">+                    .padding(8.dp),
</a><a href="#h8-0-303" id="h8-0-303" class="i">+                verticalAlignment = Alignment.CenterVertically
</a><a href="#h8-0-304" id="h8-0-304" class="i">+            ) {
</a><a href="#h8-0-305" id="h8-0-305" class="i">+                if (enabled) {
</a><a href="#h8-0-306" id="h8-0-306" class="i">+                    Icon(
</a><a href="#h8-0-307" id="h8-0-307" class="i">+                        imageVector = if (openSettings) Icons.Default.ExpandLess else Icons.Default.ExpandMore,
</a><a href="#h8-0-308" id="h8-0-308" class="i">+                        contentDescription = null,
</a><a href="#h8-0-309" id="h8-0-309" class="i">+                        modifier = Modifier
</a><a href="#h8-0-310" id="h8-0-310" class="i">+                            .padding(end = 8.dp)
</a><a href="#h8-0-311" id="h8-0-311" class="i">+                            .size(32.dp),
</a><a href="#h8-0-312" id="h8-0-312" class="i">+                    )
</a><a href="#h8-0-313" id="h8-0-313" class="i">+                }
</a><a href="#h8-0-314" id="h8-0-314" class="i">+
</a><a href="#h8-0-315" id="h8-0-315" class="i">+                Column(
</a><a href="#h8-0-316" id="h8-0-316" class="i">+                    modifier = Modifier
</a><a href="#h8-0-317" id="h8-0-317" class="i">+                        .weight(1f)
</a><a href="#h8-0-318" id="h8-0-318" class="i">+                        .padding(end = 8.dp)
</a><a href="#h8-0-319" id="h8-0-319" class="i">+                ) {
</a><a href="#h8-0-320" id="h8-0-320" class="i">+                    Text(text = script.displayName ?: script.name, fontSize = 20.sp)
</a><a href="#h8-0-321" id="h8-0-321" class="i">+                    Text(text = script.description ?: &quot;No description&quot;, fontSize = 14.sp)
</a><a href="#h8-0-322" id="h8-0-322" class="i">+                    latestUpdate?.let {
</a><a href="#h8-0-323" id="h8-0-323" class="i">+                        Text(text = &quot;Update available: ${it.version}&quot;, fontSize = 14.sp, fontStyle = FontStyle.Italic, color = MaterialTheme.colorScheme.onSurfaceVariant)
</a><a href="#h8-0-324" id="h8-0-324" class="i">+                    }
</a><a href="#h8-0-325" id="h8-0-325" class="i">+                }
</a><a href="#h8-0-326" id="h8-0-326" class="i">+                IconButton(onClick = {
</a><a href="#h8-0-327" id="h8-0-327" class="i">+                    openActions = !openActions
</a><a href="#h8-0-328" id="h8-0-328" class="i">+                }) {
</a><a href="#h8-0-329" id="h8-0-329" class="i">+                    Icon(imageVector = Icons.Default.Build, contentDescription = &quot;Actions&quot;)
</a><a href="#h8-0-330" id="h8-0-330" class="i">+                }
</a><a href="#h8-0-331" id="h8-0-331" class="i">+                Switch(
</a><a href="#h8-0-332" id="h8-0-332" class="i">+                    checked = enabled,
</a><a href="#h8-0-333" id="h8-0-333" class="i">+                    onCheckedChange = { isChecked -&gt;
</a><a href="#h8-0-334" id="h8-0-334" class="i">+                        openSettings = false
</a><a href="#h8-0-335" id="h8-0-335" class="i">+                        context.coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h8-0-336" id="h8-0-336" class="i">+                            runCatching {
</a><a href="#h8-0-337" id="h8-0-337" class="i">+                                val modulePath = context.scriptManager.getModulePath(script.name)!!
</a><a href="#h8-0-338" id="h8-0-338" class="i">+                                context.scriptManager.unloadScript(modulePath)
</a><a href="#h8-0-339" id="h8-0-339" class="i">+                                if (isChecked) {
</a><a href="#h8-0-340" id="h8-0-340" class="i">+                                    context.scriptManager.loadScript(modulePath)
</a><a href="#h8-0-341" id="h8-0-341" class="i">+                                    context.scriptManager.runtime.getModuleByName(script.name)
</a><a href="#h8-0-342" id="h8-0-342" class="i">+                                        ?.callFunction(&quot;module.onSnapEnhanceLoad&quot;)
</a><a href="#h8-0-343" id="h8-0-343" class="i">+                                    context.shortToast(&quot;Loaded script ${script.name}&quot;)
</a><a href="#h8-0-344" id="h8-0-344" class="i">+                                } else {
</a><a href="#h8-0-345" id="h8-0-345" class="i">+                                    context.shortToast(&quot;Unloaded script ${script.name}&quot;)
</a><a href="#h8-0-346" id="h8-0-346" class="i">+                                }
</a><a href="#h8-0-347" id="h8-0-347" class="i">+
</a><a href="#h8-0-348" id="h8-0-348" class="i">+                                context.database.setScriptEnabled(script.name, isChecked)
</a><a href="#h8-0-349" id="h8-0-349" class="i">+                                withContext(Dispatchers.Main) {
</a><a href="#h8-0-350" id="h8-0-350" class="i">+                                    enabled = isChecked
</a><a href="#h8-0-351" id="h8-0-351" class="i">+                                }
</a><a href="#h8-0-352" id="h8-0-352" class="i">+                            }.onFailure { throwable -&gt;
</a><a href="#h8-0-353" id="h8-0-353" class="i">+                                withContext(Dispatchers.Main) {
</a><a href="#h8-0-354" id="h8-0-354" class="i">+                                    enabled = !isChecked
</a><a href="#h8-0-355" id="h8-0-355" class="i">+                                }
</a><a href="#h8-0-356" id="h8-0-356" class="i">+                                (&quot;Failed to ${if (isChecked) &quot;enable&quot; else &quot;disable&quot;} script. Check logs for more details&quot;).also {
</a><a href="#h8-0-357" id="h8-0-357" class="i">+                                    context.log.error(it, throwable)
</a><a href="#h8-0-358" id="h8-0-358" class="i">+                                    context.shortToast(it)
</a><a href="#h8-0-359" id="h8-0-359" class="i">+                                }
</a><a href="#h8-0-360" id="h8-0-360" class="i">+                            }
</a><a href="#h8-0-361" id="h8-0-361" class="i">+                        }
</a><a href="#h8-0-362" id="h8-0-362" class="i">+                    }
</a><a href="#h8-0-363" id="h8-0-363" class="i">+                )
</a><a href="#h8-0-364" id="h8-0-364" class="i">+            }
</a><a href="#h8-0-365" id="h8-0-365" class="i">+
</a><a href="#h8-0-366" id="h8-0-366" class="i">+            if (openSettings) {
</a><a href="#h8-0-367" id="h8-0-367" class="i">+                ScriptSettings(script)
</a><a href="#h8-0-368" id="h8-0-368" class="i">+            }
</a><a href="#h8-0-369" id="h8-0-369" class="i">+        }
</a><a href="#h8-0-370" id="h8-0-370" class="i">+
</a><a href="#h8-0-371" id="h8-0-371" class="i">+        if (openActions) {
</a><a href="#h8-0-372" id="h8-0-372" class="i">+            ModuleActions(
</a><a href="#h8-0-373" id="h8-0-373" class="i">+                script = script,
</a><a href="#h8-0-374" id="h8-0-374" class="i">+                canUpdate = latestUpdate != null,
</a><a href="#h8-0-375" id="h8-0-375" class="i">+            ) { openActions = false }
</a><a href="#h8-0-376" id="h8-0-376" class="i">+        }
</a><a href="#h8-0-377" id="h8-0-377" class="i">+    }
</a><a href="#h8-0-378" id="h8-0-378" class="i">+
</a><a href="#h8-0-379" id="h8-0-379" class="i">+    override val floatingActionButton: @Composable () -&gt; Unit = {
</a><a href="#h8-0-380" id="h8-0-380" class="i">+        var showImportDialog by remember {
</a><a href="#h8-0-381" id="h8-0-381" class="i">+            mutableStateOf(false)
</a><a href="#h8-0-382" id="h8-0-382" class="i">+        }
</a><a href="#h8-0-383" id="h8-0-383" class="i">+        if (showImportDialog) {
</a><a href="#h8-0-384" id="h8-0-384" class="i">+            ImportRemoteScript {
</a><a href="#h8-0-385" id="h8-0-385" class="i">+                showImportDialog = false
</a><a href="#h8-0-386" id="h8-0-386" class="i">+            }
</a><a href="#h8-0-387" id="h8-0-387" class="i">+        }
</a><a href="#h8-0-388" id="h8-0-388" class="i">+
</a><a href="#h8-0-389" id="h8-0-389" class="i">+        Column(
</a><a href="#h8-0-390" id="h8-0-390" class="i">+            verticalArrangement = Arrangement.spacedBy(8.dp),
</a><a href="#h8-0-391" id="h8-0-391" class="i">+            horizontalAlignment = Alignment.End,
</a><a href="#h8-0-392" id="h8-0-392" class="i">+        ) {
</a><a href="#h8-0-393" id="h8-0-393" class="i">+            ExtendedFloatingActionButton(
</a><a href="#h8-0-394" id="h8-0-394" class="i">+                onClick = {
</a><a href="#h8-0-395" id="h8-0-395" class="i">+                    showImportDialog = true
</a><a href="#h8-0-396" id="h8-0-396" class="i">+                },
</a><a href="#h8-0-397" id="h8-0-397" class="i">+                icon = { Icon(imageVector = Icons.Default.Link, contentDescription = &quot;Link&quot;) },
</a><a href="#h8-0-398" id="h8-0-398" class="i">+                text = {
</a><a href="#h8-0-399" id="h8-0-399" class="i">+                    Text(text = &quot;Import from URL&quot;)
</a><a href="#h8-0-400" id="h8-0-400" class="i">+                },
</a><a href="#h8-0-401" id="h8-0-401" class="i">+            )
</a><a href="#h8-0-402" id="h8-0-402" class="i">+            ExtendedFloatingActionButton(
</a><a href="#h8-0-403" id="h8-0-403" class="i">+                onClick = {
</a><a href="#h8-0-404" id="h8-0-404" class="i">+                    context.scriptManager.getScriptsFolder()?.let {
</a><a href="#h8-0-405" id="h8-0-405" class="i">+                        context.androidContext.startActivity(
</a><a href="#h8-0-406" id="h8-0-406" class="i">+                            Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h8-0-407" id="h8-0-407" class="i">+                                data = it.uri
</a><a href="#h8-0-408" id="h8-0-408" class="i">+                                flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h8-0-409" id="h8-0-409" class="i">+                            }
</a><a href="#h8-0-410" id="h8-0-410" class="i">+                        )
</a><a href="#h8-0-411" id="h8-0-411" class="i">+                    }
</a><a href="#h8-0-412" id="h8-0-412" class="i">+                },
</a><a href="#h8-0-413" id="h8-0-413" class="i">+                icon = {
</a><a href="#h8-0-414" id="h8-0-414" class="i">+                    Icon(
</a><a href="#h8-0-415" id="h8-0-415" class="i">+                        imageVector = Icons.Default.FolderOpen,
</a><a href="#h8-0-416" id="h8-0-416" class="i">+                        contentDescription = &quot;Folder&quot;
</a><a href="#h8-0-417" id="h8-0-417" class="i">+                    )
</a><a href="#h8-0-418" id="h8-0-418" class="i">+                },
</a><a href="#h8-0-419" id="h8-0-419" class="i">+                text = {
</a><a href="#h8-0-420" id="h8-0-420" class="i">+                    Text(text = &quot;Open Scripts Folder&quot;)
</a><a href="#h8-0-421" id="h8-0-421" class="i">+                },
</a><a href="#h8-0-422" id="h8-0-422" class="i">+            )
</a><a href="#h8-0-423" id="h8-0-423" class="i">+        }
</a><a href="#h8-0-424" id="h8-0-424" class="i">+    }
</a><a href="#h8-0-425" id="h8-0-425" class="i">+
</a><a href="#h8-0-426" id="h8-0-426" class="i">+
</a><a href="#h8-0-427" id="h8-0-427" class="i">+    @Composable
</a><a href="#h8-0-428" id="h8-0-428" class="i">+    fun ScriptSettings(script: ModuleInfo) {
</a><a href="#h8-0-429" id="h8-0-429" class="i">+        val settingsInterface = remember {
</a><a href="#h8-0-430" id="h8-0-430" class="i">+            val module =
</a><a href="#h8-0-431" id="h8-0-431" class="i">+                context.scriptManager.runtime.getModuleByName(script.name) ?: return@remember null
</a><a href="#h8-0-432" id="h8-0-432" class="i">+            (module.getBinding(InterfaceManager::class))?.buildInterface(EnumScriptInterface.SETTINGS)
</a><a href="#h8-0-433" id="h8-0-433" class="i">+        }
</a><a href="#h8-0-434" id="h8-0-434" class="i">+
</a><a href="#h8-0-435" id="h8-0-435" class="i">+        if (settingsInterface == null) {
</a><a href="#h8-0-436" id="h8-0-436" class="i">+            Text(
</a><a href="#h8-0-437" id="h8-0-437" class="i">+                text = &quot;This module does not have any settings&quot;,
</a><a href="#h8-0-438" id="h8-0-438" class="i">+                style = MaterialTheme.typography.bodySmall,
</a><a href="#h8-0-439" id="h8-0-439" class="i">+                modifier = Modifier.padding(8.dp)
</a><a href="#h8-0-440" id="h8-0-440" class="i">+            )
</a><a href="#h8-0-441" id="h8-0-441" class="i">+        } else {
</a><a href="#h8-0-442" id="h8-0-442" class="i">+            ScriptInterface(interfaceBuilder = settingsInterface)
</a><a href="#h8-0-443" id="h8-0-443" class="i">+        }
</a><a href="#h8-0-444" id="h8-0-444" class="i">+    }
</a><a href="#h8-0-445" id="h8-0-445" class="i">+
</a><a href="#h8-0-446" id="h8-0-446" class="i">+    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h8-0-447" id="h8-0-447" class="i">+        val scriptingFolder by rememberAsyncMutableState(
</a><a href="#h8-0-448" id="h8-0-448" class="i">+            defaultValue = null,
</a><a href="#h8-0-449" id="h8-0-449" class="i">+            updateDispatcher = reloadDispatcher
</a><a href="#h8-0-450" id="h8-0-450" class="i">+        ) {
</a><a href="#h8-0-451" id="h8-0-451" class="i">+            context.scriptManager.getScriptsFolder()
</a><a href="#h8-0-452" id="h8-0-452" class="i">+        }
</a><a href="#h8-0-453" id="h8-0-453" class="i">+        val scriptModules by rememberAsyncMutableState(
</a><a href="#h8-0-454" id="h8-0-454" class="i">+            defaultValue = emptyList(),
</a><a href="#h8-0-455" id="h8-0-455" class="i">+            updateDispatcher = reloadDispatcher
</a><a href="#h8-0-456" id="h8-0-456" class="i">+        ) {
</a><a href="#h8-0-457" id="h8-0-457" class="i">+            context.scriptManager.sync()
</a><a href="#h8-0-458" id="h8-0-458" class="i">+            context.scriptManager.getSyncedModules()
</a><a href="#h8-0-459" id="h8-0-459" class="i">+        }
</a><a href="#h8-0-460" id="h8-0-460" class="i">+
</a><a href="#h8-0-461" id="h8-0-461" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h8-0-462" id="h8-0-462" class="i">+
</a><a href="#h8-0-463" id="h8-0-463" class="i">+        var refreshing by remember {
</a><a href="#h8-0-464" id="h8-0-464" class="i">+            mutableStateOf(false)
</a><a href="#h8-0-465" id="h8-0-465" class="i">+        }
</a><a href="#h8-0-466" id="h8-0-466" class="i">+
</a><a href="#h8-0-467" id="h8-0-467" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h8-0-468" id="h8-0-468" class="i">+            refreshing = true
</a><a href="#h8-0-469" id="h8-0-469" class="i">+            withContext(Dispatchers.IO) {
</a><a href="#h8-0-470" id="h8-0-470" class="i">+                reloadDispatcher.dispatch()
</a><a href="#h8-0-471" id="h8-0-471" class="i">+                refreshing = false
</a><a href="#h8-0-472" id="h8-0-472" class="i">+            }
</a><a href="#h8-0-473" id="h8-0-473" class="i">+        }
</a><a href="#h8-0-474" id="h8-0-474" class="i">+
</a><a href="#h8-0-475" id="h8-0-475" class="i">+        val pullRefreshState = rememberPullRefreshState(refreshing, onRefresh = {
</a><a href="#h8-0-476" id="h8-0-476" class="i">+            refreshing = true
</a><a href="#h8-0-477" id="h8-0-477" class="i">+            coroutineScope.launch(Dispatchers.IO) {
</a><a href="#h8-0-478" id="h8-0-478" class="i">+                reloadDispatcher.dispatch()
</a><a href="#h8-0-479" id="h8-0-479" class="i">+                refreshing = false
</a><a href="#h8-0-480" id="h8-0-480" class="i">+            }
</a><a href="#h8-0-481" id="h8-0-481" class="i">+        })
</a><a href="#h8-0-482" id="h8-0-482" class="i">+
</a><a href="#h8-0-483" id="h8-0-483" class="i">+        Box(
</a><a href="#h8-0-484" id="h8-0-484" class="i">+            modifier = Modifier.fillMaxSize()
</a><a href="#h8-0-485" id="h8-0-485" class="i">+        ) {
</a><a href="#h8-0-486" id="h8-0-486" class="i">+            LazyColumn(
</a><a href="#h8-0-487" id="h8-0-487" class="i">+                modifier = Modifier
</a><a href="#h8-0-488" id="h8-0-488" class="i">+                    .fillMaxSize()
</a><a href="#h8-0-489" id="h8-0-489" class="i">+                    .pullRefresh(pullRefreshState),
</a><a href="#h8-0-490" id="h8-0-490" class="i">+                horizontalAlignment = Alignment.CenterHorizontally
</a><a href="#h8-0-491" id="h8-0-491" class="i">+            ) {
</a><a href="#h8-0-492" id="h8-0-492" class="i">+                item {
</a><a href="#h8-0-493" id="h8-0-493" class="i">+                    if (scriptingFolder == null &amp;&amp; !refreshing) {
</a><a href="#h8-0-494" id="h8-0-494" class="i">+                        Text(
</a><a href="#h8-0-495" id="h8-0-495" class="i">+                            text = &quot;No scripts folder selected&quot;,
</a><a href="#h8-0-496" id="h8-0-496" class="i">+                            style = MaterialTheme.typography.bodySmall,
</a><a href="#h8-0-497" id="h8-0-497" class="i">+                            modifier = Modifier.padding(8.dp)
</a><a href="#h8-0-498" id="h8-0-498" class="i">+                        )
</a><a href="#h8-0-499" id="h8-0-499" class="i">+                        Spacer(modifier = Modifier.height(8.dp))
</a><a href="#h8-0-500" id="h8-0-500" class="i">+                        Button(onClick = {
</a><a href="#h8-0-501" id="h8-0-501" class="i">+                            activityLauncherHelper.chooseFolder {
</a><a href="#h8-0-502" id="h8-0-502" class="i">+                                context.config.root.scripting.moduleFolder.set(it)
</a><a href="#h8-0-503" id="h8-0-503" class="i">+                                context.config.writeConfig()
</a><a href="#h8-0-504" id="h8-0-504" class="i">+                                coroutineScope.launch {
</a><a href="#h8-0-505" id="h8-0-505" class="i">+                                    reloadDispatcher.dispatch()
</a><a href="#h8-0-506" id="h8-0-506" class="i">+                                }
</a><a href="#h8-0-507" id="h8-0-507" class="i">+                            }
</a><a href="#h8-0-508" id="h8-0-508" class="i">+                        }) {
</a><a href="#h8-0-509" id="h8-0-509" class="i">+                            Text(text = &quot;Select folder&quot;)
</a><a href="#h8-0-510" id="h8-0-510" class="i">+                        }
</a><a href="#h8-0-511" id="h8-0-511" class="i">+                    } else if (scriptModules.isEmpty()) {
</a><a href="#h8-0-512" id="h8-0-512" class="i">+                        Text(
</a><a href="#h8-0-513" id="h8-0-513" class="i">+                            text = &quot;No scripts found&quot;,
</a><a href="#h8-0-514" id="h8-0-514" class="i">+                            style = MaterialTheme.typography.bodySmall,
</a><a href="#h8-0-515" id="h8-0-515" class="i">+                            modifier = Modifier.padding(8.dp)
</a><a href="#h8-0-516" id="h8-0-516" class="i">+                        )
</a><a href="#h8-0-517" id="h8-0-517" class="i">+                    }
</a><a href="#h8-0-518" id="h8-0-518" class="i">+                }
</a><a href="#h8-0-519" id="h8-0-519" class="i">+                items(scriptModules.size, key = { scriptModules[it].hashCode() }) { index -&gt;
</a><a href="#h8-0-520" id="h8-0-520" class="i">+                    ModuleItem(scriptModules[index])
</a><a href="#h8-0-521" id="h8-0-521" class="i">+                }
</a><a href="#h8-0-522" id="h8-0-522" class="i">+                item {
</a><a href="#h8-0-523" id="h8-0-523" class="i">+                    Spacer(modifier = Modifier.height(200.dp))
</a><a href="#h8-0-524" id="h8-0-524" class="i">+                }
</a><a href="#h8-0-525" id="h8-0-525" class="i">+            }
</a><a href="#h8-0-526" id="h8-0-526" class="i">+
</a><a href="#h8-0-527" id="h8-0-527" class="i">+            PullRefreshIndicator(
</a><a href="#h8-0-528" id="h8-0-528" class="i">+                refreshing = refreshing,
</a><a href="#h8-0-529" id="h8-0-529" class="i">+                state = pullRefreshState,
</a><a href="#h8-0-530" id="h8-0-530" class="i">+                modifier = Modifier.align(Alignment.TopCenter)
</a><a href="#h8-0-531" id="h8-0-531" class="i">+            )
</a><a href="#h8-0-532" id="h8-0-532" class="i">+        }
</a><a href="#h8-0-533" id="h8-0-533" class="i">+
</a><a href="#h8-0-534" id="h8-0-534" class="i">+        var scriptingWarning by remember {
</a><a href="#h8-0-535" id="h8-0-535" class="i">+            mutableStateOf(context.sharedPreferences.run {
</a><a href="#h8-0-536" id="h8-0-536" class="i">+                getBoolean(&quot;scripting_warning&quot;, true).also {
</a><a href="#h8-0-537" id="h8-0-537" class="i">+                    edit().putBoolean(&quot;scripting_warning&quot;, false).apply()
</a><a href="#h8-0-538" id="h8-0-538" class="i">+                }
</a><a href="#h8-0-539" id="h8-0-539" class="i">+            })
</a><a href="#h8-0-540" id="h8-0-540" class="i">+        }
</a><a href="#h8-0-541" id="h8-0-541" class="i">+
</a><a href="#h8-0-542" id="h8-0-542" class="i">+        if (scriptingWarning) {
</a><a href="#h8-0-543" id="h8-0-543" class="i">+            var timeout by remember {
</a><a href="#h8-0-544" id="h8-0-544" class="i">+                mutableIntStateOf(10)
</a><a href="#h8-0-545" id="h8-0-545" class="i">+            }
</a><a href="#h8-0-546" id="h8-0-546" class="i">+
</a><a href="#h8-0-547" id="h8-0-547" class="i">+            LaunchedEffect(Unit) {
</a><a href="#h8-0-548" id="h8-0-548" class="i">+                while (timeout &gt; 0) {
</a><a href="#h8-0-549" id="h8-0-549" class="i">+                    delay(1000)
</a><a href="#h8-0-550" id="h8-0-550" class="i">+                    timeout--
</a><a href="#h8-0-551" id="h8-0-551" class="i">+                }
</a><a href="#h8-0-552" id="h8-0-552" class="i">+            }
</a><a href="#h8-0-553" id="h8-0-553" class="i">+
</a><a href="#h8-0-554" id="h8-0-554" class="i">+            AlertDialog(onDismissRequest = {
</a><a href="#h8-0-555" id="h8-0-555" class="i">+                if (timeout == 0) {
</a><a href="#h8-0-556" id="h8-0-556" class="i">+                    scriptingWarning = false
</a><a href="#h8-0-557" id="h8-0-557" class="i">+                }
</a><a href="#h8-0-558" id="h8-0-558" class="i">+            }, title = {
</a><a href="#h8-0-559" id="h8-0-559" class="i">+                Text(text = context.translation[&quot;manager.dialogs.scripting_warning.title&quot;])
</a><a href="#h8-0-560" id="h8-0-560" class="i">+            }, text = {
</a><a href="#h8-0-561" id="h8-0-561" class="i">+                Text(text = context.translation[&quot;manager.dialogs.scripting_warning.content&quot;])
</a><a href="#h8-0-562" id="h8-0-562" class="i">+            }, confirmButton = {
</a><a href="#h8-0-563" id="h8-0-563" class="i">+                TextButton(
</a><a href="#h8-0-564" id="h8-0-564" class="i">+                    onClick = {
</a><a href="#h8-0-565" id="h8-0-565" class="i">+                        scriptingWarning = false
</a><a href="#h8-0-566" id="h8-0-566" class="i">+                    },
</a><a href="#h8-0-567" id="h8-0-567" class="i">+                    enabled = timeout == 0
</a><a href="#h8-0-568" id="h8-0-568" class="i">+                ) {
</a><a href="#h8-0-569" id="h8-0-569" class="i">+                    Text(text = &quot;OK &quot; + if (timeout &gt; 0) &quot;($timeout)&quot; else &quot;&quot;)
</a><a href="#h8-0-570" id="h8-0-570" class="i">+                }
</a><a href="#h8-0-571" id="h8-0-571" class="i">+            })
</a><a href="#h8-0-572" id="h8-0-572" class="i">+        }
</a><a href="#h8-0-573" id="h8-0-573" class="i">+    }
</a><a href="#h8-0-574" id="h8-0-574" class="i">+
</a><a href="#h8-0-575" id="h8-0-575" class="i">+    override val topBarActions: @Composable() (RowScope.() -&gt; Unit) = {
</a><a href="#h8-0-576" id="h8-0-576" class="i">+        IconButton(onClick = {
</a><a href="#h8-0-577" id="h8-0-577" class="i">+            context.androidContext.startActivity(Intent(Intent.ACTION_VIEW).apply {
</a><a href="#h8-0-578" id="h8-0-578" class="i">+                data = &quot;https://github.com/SnapEnhance/docs&quot;.toUri()
</a><a href="#h8-0-579" id="h8-0-579" class="i">+                flags = Intent.FLAG_ACTIVITY_NEW_TASK
</a><a href="#h8-0-580" id="h8-0-580" class="i">+            })
</a><a href="#h8-0-581" id="h8-0-581" class="i">+        }) {
</a><a href="#h8-0-582" id="h8-0-582" class="i">+            Icon(
</a><a href="#h8-0-583" id="h8-0-583" class="i">+                imageVector = Icons.AutoMirrored.Default.LibraryBooks,
</a><a href="#h8-0-584" id="h8-0-584" class="i">+                contentDescription = &quot;Documentation&quot;
</a><a href="#h8-0-585" id="h8-0-585" class="i">+            )
</a><a href="#h8-0-586" id="h8-0-586" class="i">+        }
</a><a href="#h8-0-587" id="h8-0-587" class="i">+    }
</a><a href="#h8-0-588" id="h8-0-588" class="i">+}</a><a href="#h8-0-589" id="h8-0-589" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRoot.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRoot.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRoot.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -1,289 +0,0 @@
</a><a href="#h9-0-0" id="h9-0-0" class="d">-package me.rhunk.snapenhance.ui.manager.pages.social
</a><a href="#h9-0-1" id="h9-0-1" class="d">-
</a><a href="#h9-0-2" id="h9-0-2" class="d">-import androidx.compose.foundation.ExperimentalFoundationApi
</a><a href="#h9-0-3" id="h9-0-3" class="d">-import androidx.compose.foundation.clickable
</a><a href="#h9-0-4" id="h9-0-4" class="d">-import androidx.compose.foundation.layout.*
</a><a href="#h9-0-5" id="h9-0-5" class="d">-import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h9-0-6" id="h9-0-6" class="d">-import androidx.compose.foundation.pager.HorizontalPager
</a><a href="#h9-0-7" id="h9-0-7" class="d">-import androidx.compose.foundation.pager.rememberPagerState
</a><a href="#h9-0-8" id="h9-0-8" class="d">-import androidx.compose.foundation.shape.RoundedCornerShape
</a><a href="#h9-0-9" id="h9-0-9" class="d">-import androidx.compose.material.icons.Icons
</a><a href="#h9-0-10" id="h9-0-10" class="d">-import androidx.compose.material.icons.filled.RemoveRedEye
</a><a href="#h9-0-11" id="h9-0-11" class="d">-import androidx.compose.material.icons.rounded.Add
</a><a href="#h9-0-12" id="h9-0-12" class="d">-import androidx.compose.material3.*
</a><a href="#h9-0-13" id="h9-0-13" class="d">-import androidx.compose.runtime.*
</a><a href="#h9-0-14" id="h9-0-14" class="d">-import androidx.compose.ui.Alignment
</a><a href="#h9-0-15" id="h9-0-15" class="d">-import androidx.compose.ui.Modifier
</a><a href="#h9-0-16" id="h9-0-16" class="d">-import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h9-0-17" id="h9-0-17" class="d">-import androidx.compose.ui.res.vectorResource
</a><a href="#h9-0-18" id="h9-0-18" class="d">-import androidx.compose.ui.text.font.FontWeight
</a><a href="#h9-0-19" id="h9-0-19" class="d">-import androidx.compose.ui.text.style.TextAlign
</a><a href="#h9-0-20" id="h9-0-20" class="d">-import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h9-0-21" id="h9-0-21" class="d">-import androidx.compose.ui.unit.dp
</a><a href="#h9-0-22" id="h9-0-22" class="d">-import androidx.compose.ui.unit.sp
</a><a href="#h9-0-23" id="h9-0-23" class="d">-import androidx.navigation.NavBackStackEntry
</a><a href="#h9-0-24" id="h9-0-24" class="d">-import kotlinx.coroutines.launch
</a><a href="#h9-0-25" id="h9-0-25" class="d">-import me.rhunk.snapenhance.R
</a><a href="#h9-0-26" id="h9-0-26" class="d">-import me.rhunk.snapenhance.common.data.MessagingFriendInfo
</a><a href="#h9-0-27" id="h9-0-27" class="d">-import me.rhunk.snapenhance.common.data.MessagingGroupInfo
</a><a href="#h9-0-28" id="h9-0-28" class="d">-import me.rhunk.snapenhance.common.data.SocialScope
</a><a href="#h9-0-29" id="h9-0-29" class="d">-import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h9-0-30" id="h9-0-30" class="d">-import me.rhunk.snapenhance.common.util.snap.BitmojiSelfie
</a><a href="#h9-0-31" id="h9-0-31" class="d">-import me.rhunk.snapenhance.storage.*
</a><a href="#h9-0-32" id="h9-0-32" class="d">-import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h9-0-33" id="h9-0-33" class="d">-import me.rhunk.snapenhance.ui.util.coil.BitmojiImage
</a><a href="#h9-0-34" id="h9-0-34" class="d">-import me.rhunk.snapenhance.ui.util.pagerTabIndicatorOffset
</a><a href="#h9-0-35" id="h9-0-35" class="d">-
</a><a href="#h9-0-36" id="h9-0-36" class="d">-class SocialRoot : Routes.Route() {
</a><a href="#h9-0-37" id="h9-0-37" class="d">-    private var friendList: List&lt;MessagingFriendInfo&gt; by mutableStateOf(emptyList())
</a><a href="#h9-0-38" id="h9-0-38" class="d">-    private var groupList: List&lt;MessagingGroupInfo&gt; by mutableStateOf(emptyList())
</a><a href="#h9-0-39" id="h9-0-39" class="d">-
</a><a href="#h9-0-40" id="h9-0-40" class="d">-    private fun updateScopeLists() {
</a><a href="#h9-0-41" id="h9-0-41" class="d">-        context.coroutineScope.launch {
</a><a href="#h9-0-42" id="h9-0-42" class="d">-            friendList = context.database.getFriends(descOrder = true)
</a><a href="#h9-0-43" id="h9-0-43" class="d">-            groupList = context.database.getGroups()
</a><a href="#h9-0-44" id="h9-0-44" class="d">-        }
</a><a href="#h9-0-45" id="h9-0-45" class="d">-    }
</a><a href="#h9-0-46" id="h9-0-46" class="d">-
</a><a href="#h9-0-47" id="h9-0-47" class="d">-    private val addFriendDialog by lazy {
</a><a href="#h9-0-48" id="h9-0-48" class="d">-        AddFriendDialog(context, AddFriendDialog.Actions(
</a><a href="#h9-0-49" id="h9-0-49" class="d">-            onFriendState = { friend, state -&gt;
</a><a href="#h9-0-50" id="h9-0-50" class="d">-                if (state) {
</a><a href="#h9-0-51" id="h9-0-51" class="d">-                    context.bridgeService?.triggerScopeSync(SocialScope.FRIEND, friend.userId)
</a><a href="#h9-0-52" id="h9-0-52" class="d">-                } else {
</a><a href="#h9-0-53" id="h9-0-53" class="d">-                    context.database.deleteFriend(friend.userId)
</a><a href="#h9-0-54" id="h9-0-54" class="d">-                }
</a><a href="#h9-0-55" id="h9-0-55" class="d">-            },
</a><a href="#h9-0-56" id="h9-0-56" class="d">-            onGroupState = { group, state -&gt;
</a><a href="#h9-0-57" id="h9-0-57" class="d">-                if (state) {
</a><a href="#h9-0-58" id="h9-0-58" class="d">-                    context.bridgeService?.triggerScopeSync(SocialScope.GROUP, group.conversationId)
</a><a href="#h9-0-59" id="h9-0-59" class="d">-                } else {
</a><a href="#h9-0-60" id="h9-0-60" class="d">-                    context.database.deleteGroup(group.conversationId)
</a><a href="#h9-0-61" id="h9-0-61" class="d">-                }
</a><a href="#h9-0-62" id="h9-0-62" class="d">-            },
</a><a href="#h9-0-63" id="h9-0-63" class="d">-            getFriendState = { friend -&gt; context.database.getFriendInfo(friend.userId) != null },
</a><a href="#h9-0-64" id="h9-0-64" class="d">-            getGroupState = { group -&gt; context.database.getGroupInfo(group.conversationId) != null }
</a><a href="#h9-0-65" id="h9-0-65" class="d">-        ))
</a><a href="#h9-0-66" id="h9-0-66" class="d">-    }
</a><a href="#h9-0-67" id="h9-0-67" class="d">-
</a><a href="#h9-0-68" id="h9-0-68" class="d">-    @Composable
</a><a href="#h9-0-69" id="h9-0-69" class="d">-    private fun ScopeList(scope: SocialScope) {
</a><a href="#h9-0-70" id="h9-0-70" class="d">-        val remainingHours = remember { context.config.root.streaksReminder.remainingHours.get() }
</a><a href="#h9-0-71" id="h9-0-71" class="d">-
</a><a href="#h9-0-72" id="h9-0-72" class="d">-        LazyColumn(
</a><a href="#h9-0-73" id="h9-0-73" class="d">-            modifier = Modifier
</a><a href="#h9-0-74" id="h9-0-74" class="d">-                .padding(2.dp)
</a><a href="#h9-0-75" id="h9-0-75" class="d">-                .fillMaxWidth()
</a><a href="#h9-0-76" id="h9-0-76" class="d">-                .fillMaxHeight(),
</a><a href="#h9-0-77" id="h9-0-77" class="d">-            contentPadding = PaddingValues(bottom = 110.dp),
</a><a href="#h9-0-78" id="h9-0-78" class="d">-        ) {
</a><a href="#h9-0-79" id="h9-0-79" class="d">-            //check if scope list is empty
</a><a href="#h9-0-80" id="h9-0-80" class="d">-            val listSize = when (scope) {
</a><a href="#h9-0-81" id="h9-0-81" class="d">-                SocialScope.GROUP -&gt; groupList.size
</a><a href="#h9-0-82" id="h9-0-82" class="d">-                SocialScope.FRIEND -&gt; friendList.size
</a><a href="#h9-0-83" id="h9-0-83" class="d">-            }
</a><a href="#h9-0-84" id="h9-0-84" class="d">-
</a><a href="#h9-0-85" id="h9-0-85" class="d">-            if (listSize == 0) {
</a><a href="#h9-0-86" id="h9-0-86" class="d">-                item {
</a><a href="#h9-0-87" id="h9-0-87" class="d">-                    Text(
</a><a href="#h9-0-88" id="h9-0-88" class="d">-                        text = translation[&quot;empty_hint&quot;], modifier = Modifier
</a><a href="#h9-0-89" id="h9-0-89" class="d">-                            .fillMaxWidth()
</a><a href="#h9-0-90" id="h9-0-90" class="d">-                            .padding(10.dp), textAlign = TextAlign.Center
</a><a href="#h9-0-91" id="h9-0-91" class="d">-                    )
</a><a href="#h9-0-92" id="h9-0-92" class="d">-                }
</a><a href="#h9-0-93" id="h9-0-93" class="d">-            }
</a><a href="#h9-0-94" id="h9-0-94" class="d">-
</a><a href="#h9-0-95" id="h9-0-95" class="d">-            items(listSize) { index -&gt;
</a><a href="#h9-0-96" id="h9-0-96" class="d">-                val id = when (scope) {
</a><a href="#h9-0-97" id="h9-0-97" class="d">-                    SocialScope.GROUP -&gt; groupList[index].conversationId
</a><a href="#h9-0-98" id="h9-0-98" class="d">-                    SocialScope.FRIEND -&gt; friendList[index].userId
</a><a href="#h9-0-99" id="h9-0-99" class="d">-                }
</a><a href="#h9-0-100" id="h9-0-100" class="d">-
</a><a href="#h9-0-101" id="h9-0-101" class="d">-                ElevatedCard(
</a><a href="#h9-0-102" id="h9-0-102" class="d">-                    modifier = Modifier
</a><a href="#h9-0-103" id="h9-0-103" class="d">-                        .padding(10.dp)
</a><a href="#h9-0-104" id="h9-0-104" class="d">-                        .fillMaxWidth()
</a><a href="#h9-0-105" id="h9-0-105" class="d">-                        .height(80.dp)
</a><a href="#h9-0-106" id="h9-0-106" class="d">-                        .clickable {
</a><a href="#h9-0-107" id="h9-0-107" class="d">-                            routes.manageScope.navigate {
</a><a href="#h9-0-108" id="h9-0-108" class="d">-                                put(&quot;id&quot;, id)
</a><a href="#h9-0-109" id="h9-0-109" class="d">-                                put(&quot;scope&quot;, scope.key)
</a><a href="#h9-0-110" id="h9-0-110" class="d">-                            }
</a><a href="#h9-0-111" id="h9-0-111" class="d">-                        },
</a><a href="#h9-0-112" id="h9-0-112" class="d">-                ) {
</a><a href="#h9-0-113" id="h9-0-113" class="d">-                    Row(
</a><a href="#h9-0-114" id="h9-0-114" class="d">-                        modifier = Modifier
</a><a href="#h9-0-115" id="h9-0-115" class="d">-                            .padding(10.dp)
</a><a href="#h9-0-116" id="h9-0-116" class="d">-                            .fillMaxSize(),
</a><a href="#h9-0-117" id="h9-0-117" class="d">-                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h9-0-118" id="h9-0-118" class="d">-                    ) {
</a><a href="#h9-0-119" id="h9-0-119" class="d">-                        when (scope) {
</a><a href="#h9-0-120" id="h9-0-120" class="d">-                            SocialScope.GROUP -&gt; {
</a><a href="#h9-0-121" id="h9-0-121" class="d">-                                val group = groupList[index]
</a><a href="#h9-0-122" id="h9-0-122" class="d">-                                Column(
</a><a href="#h9-0-123" id="h9-0-123" class="d">-                                    modifier = Modifier
</a><a href="#h9-0-124" id="h9-0-124" class="d">-                                        .padding(7.dp)
</a><a href="#h9-0-125" id="h9-0-125" class="d">-                                        .fillMaxWidth()
</a><a href="#h9-0-126" id="h9-0-126" class="d">-                                        .weight(1f)
</a><a href="#h9-0-127" id="h9-0-127" class="d">-                                ) {
</a><a href="#h9-0-128" id="h9-0-128" class="d">-                                    Text(
</a><a href="#h9-0-129" id="h9-0-129" class="d">-                                        text = group.name,
</a><a href="#h9-0-130" id="h9-0-130" class="d">-                                        maxLines = 1,
</a><a href="#h9-0-131" id="h9-0-131" class="d">-                                        fontWeight = FontWeight.Bold
</a><a href="#h9-0-132" id="h9-0-132" class="d">-                                    )
</a><a href="#h9-0-133" id="h9-0-133" class="d">-                                }
</a><a href="#h9-0-134" id="h9-0-134" class="d">-                            }
</a><a href="#h9-0-135" id="h9-0-135" class="d">-
</a><a href="#h9-0-136" id="h9-0-136" class="d">-                            SocialScope.FRIEND -&gt; {
</a><a href="#h9-0-137" id="h9-0-137" class="d">-                                val friend = friendList[index]
</a><a href="#h9-0-138" id="h9-0-138" class="d">-                                val streaks by rememberAsyncMutableState(defaultValue = friend.streaks) {
</a><a href="#h9-0-139" id="h9-0-139" class="d">-                                    context.database.getFriendStreaks(friend.userId)
</a><a href="#h9-0-140" id="h9-0-140" class="d">-                                }
</a><a href="#h9-0-141" id="h9-0-141" class="d">-
</a><a href="#h9-0-142" id="h9-0-142" class="d">-                                BitmojiImage(
</a><a href="#h9-0-143" id="h9-0-143" class="d">-                                    context = context,
</a><a href="#h9-0-144" id="h9-0-144" class="d">-                                    url = BitmojiSelfie.getBitmojiSelfie(
</a><a href="#h9-0-145" id="h9-0-145" class="d">-                                        friend.selfieId,
</a><a href="#h9-0-146" id="h9-0-146" class="d">-                                        friend.bitmojiId,
</a><a href="#h9-0-147" id="h9-0-147" class="d">-                                        BitmojiSelfie.BitmojiSelfieType.THREE_D
</a><a href="#h9-0-148" id="h9-0-148" class="d">-                                    )
</a><a href="#h9-0-149" id="h9-0-149" class="d">-                                )
</a><a href="#h9-0-150" id="h9-0-150" class="d">-                                Column(
</a><a href="#h9-0-151" id="h9-0-151" class="d">-                                    modifier = Modifier
</a><a href="#h9-0-152" id="h9-0-152" class="d">-                                        .padding(7.dp)
</a><a href="#h9-0-153" id="h9-0-153" class="d">-                                        .fillMaxWidth()
</a><a href="#h9-0-154" id="h9-0-154" class="d">-                                        .weight(1f)
</a><a href="#h9-0-155" id="h9-0-155" class="d">-                                ) {
</a><a href="#h9-0-156" id="h9-0-156" class="d">-                                    Text(
</a><a href="#h9-0-157" id="h9-0-157" class="d">-                                        text = friend.displayName ?: friend.mutableUsername,
</a><a href="#h9-0-158" id="h9-0-158" class="d">-                                        maxLines = 1,
</a><a href="#h9-0-159" id="h9-0-159" class="d">-                                        fontWeight = FontWeight.Bold
</a><a href="#h9-0-160" id="h9-0-160" class="d">-                                    )
</a><a href="#h9-0-161" id="h9-0-161" class="d">-                                    Text(
</a><a href="#h9-0-162" id="h9-0-162" class="d">-                                        text = friend.mutableUsername,
</a><a href="#h9-0-163" id="h9-0-163" class="d">-                                        maxLines = 1,
</a><a href="#h9-0-164" id="h9-0-164" class="d">-                                        fontSize = 12.sp,
</a><a href="#h9-0-165" id="h9-0-165" class="d">-                                        fontWeight = FontWeight.Light
</a><a href="#h9-0-166" id="h9-0-166" class="d">-                                    )
</a><a href="#h9-0-167" id="h9-0-167" class="d">-                                }
</a><a href="#h9-0-168" id="h9-0-168" class="d">-                                Row(verticalAlignment = Alignment.CenterVertically) {
</a><a href="#h9-0-169" id="h9-0-169" class="d">-                                    streaks?.takeIf { it.notify }?.let { streaks -&gt;
</a><a href="#h9-0-170" id="h9-0-170" class="d">-                                        Icon(
</a><a href="#h9-0-171" id="h9-0-171" class="d">-                                            imageVector = ImageVector.vectorResource(id = R.drawable.streak_icon),
</a><a href="#h9-0-172" id="h9-0-172" class="d">-                                            contentDescription = null,
</a><a href="#h9-0-173" id="h9-0-173" class="d">-                                            modifier = Modifier.height(40.dp),
</a><a href="#h9-0-174" id="h9-0-174" class="d">-                                            tint = if (streaks.isAboutToExpire(remainingHours))
</a><a href="#h9-0-175" id="h9-0-175" class="d">-                                                MaterialTheme.colorScheme.error
</a><a href="#h9-0-176" id="h9-0-176" class="d">-                                            else MaterialTheme.colorScheme.primary
</a><a href="#h9-0-177" id="h9-0-177" class="d">-                                        )
</a><a href="#h9-0-178" id="h9-0-178" class="d">-                                        Text(
</a><a href="#h9-0-179" id="h9-0-179" class="d">-                                            text = translation.format(
</a><a href="#h9-0-180" id="h9-0-180" class="d">-                                                &quot;streaks_expiration_short&quot;,
</a><a href="#h9-0-181" id="h9-0-181" class="d">-                                                &quot;hours&quot; to (((streaks.expirationTimestamp - System.currentTimeMillis()) / 3600000).toInt().takeIf { it &gt; 0 } ?: 0)
</a><a href="#h9-0-182" id="h9-0-182" class="d">-                                                    .toString()
</a><a href="#h9-0-183" id="h9-0-183" class="d">-                                            ),
</a><a href="#h9-0-184" id="h9-0-184" class="d">-                                            maxLines = 1,
</a><a href="#h9-0-185" id="h9-0-185" class="d">-                                            fontWeight = FontWeight.Bold
</a><a href="#h9-0-186" id="h9-0-186" class="d">-                                        )
</a><a href="#h9-0-187" id="h9-0-187" class="d">-                                    }
</a><a href="#h9-0-188" id="h9-0-188" class="d">-                                }
</a><a href="#h9-0-189" id="h9-0-189" class="d">-                            }
</a><a href="#h9-0-190" id="h9-0-190" class="d">-                        }
</a><a href="#h9-0-191" id="h9-0-191" class="d">-
</a><a href="#h9-0-192" id="h9-0-192" class="d">-                        FilledIconButton(onClick = {
</a><a href="#h9-0-193" id="h9-0-193" class="d">-                            routes.messagingPreview.navigate {
</a><a href="#h9-0-194" id="h9-0-194" class="d">-                                put(&quot;id&quot;, id)
</a><a href="#h9-0-195" id="h9-0-195" class="d">-                                put(&quot;scope&quot;, scope.key)
</a><a href="#h9-0-196" id="h9-0-196" class="d">-                            }
</a><a href="#h9-0-197" id="h9-0-197" class="d">-                        }) {
</a><a href="#h9-0-198" id="h9-0-198" class="d">-                            Icon(imageVector = Icons.Filled.RemoveRedEye, contentDescription = null)
</a><a href="#h9-0-199" id="h9-0-199" class="d">-                        }
</a><a href="#h9-0-200" id="h9-0-200" class="d">-                    }
</a><a href="#h9-0-201" id="h9-0-201" class="d">-                }
</a><a href="#h9-0-202" id="h9-0-202" class="d">-            }
</a><a href="#h9-0-203" id="h9-0-203" class="d">-        }
</a><a href="#h9-0-204" id="h9-0-204" class="d">-    }
</a><a href="#h9-0-205" id="h9-0-205" class="d">-
</a><a href="#h9-0-206" id="h9-0-206" class="d">-    @OptIn(ExperimentalFoundationApi::class)
</a><a href="#h9-0-207" id="h9-0-207" class="d">-    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h9-0-208" id="h9-0-208" class="d">-        val titles = remember {
</a><a href="#h9-0-209" id="h9-0-209" class="d">-            listOf(translation[&quot;friends_tab&quot;], translation[&quot;groups_tab&quot;])
</a><a href="#h9-0-210" id="h9-0-210" class="d">-        }
</a><a href="#h9-0-211" id="h9-0-211" class="d">-        val coroutineScope = rememberCoroutineScope()
</a><a href="#h9-0-212" id="h9-0-212" class="d">-        val pagerState = rememberPagerState { titles.size }
</a><a href="#h9-0-213" id="h9-0-213" class="d">-        var showAddFriendDialog by remember { mutableStateOf(false) }
</a><a href="#h9-0-214" id="h9-0-214" class="d">-
</a><a href="#h9-0-215" id="h9-0-215" class="d">-        if (showAddFriendDialog) {
</a><a href="#h9-0-216" id="h9-0-216" class="d">-            addFriendDialog.Content {
</a><a href="#h9-0-217" id="h9-0-217" class="d">-                showAddFriendDialog = false
</a><a href="#h9-0-218" id="h9-0-218" class="d">-            }
</a><a href="#h9-0-219" id="h9-0-219" class="d">-            DisposableEffect(Unit) {
</a><a href="#h9-0-220" id="h9-0-220" class="d">-                onDispose {
</a><a href="#h9-0-221" id="h9-0-221" class="d">-                    updateScopeLists()
</a><a href="#h9-0-222" id="h9-0-222" class="d">-                }
</a><a href="#h9-0-223" id="h9-0-223" class="d">-            }
</a><a href="#h9-0-224" id="h9-0-224" class="d">-        }
</a><a href="#h9-0-225" id="h9-0-225" class="d">-
</a><a href="#h9-0-226" id="h9-0-226" class="d">-        LaunchedEffect(Unit) {
</a><a href="#h9-0-227" id="h9-0-227" class="d">-            updateScopeLists()
</a><a href="#h9-0-228" id="h9-0-228" class="d">-        }
</a><a href="#h9-0-229" id="h9-0-229" class="d">-
</a><a href="#h9-0-230" id="h9-0-230" class="d">-        Scaffold(
</a><a href="#h9-0-231" id="h9-0-231" class="d">-            floatingActionButton = {
</a><a href="#h9-0-232" id="h9-0-232" class="d">-                FloatingActionButton(
</a><a href="#h9-0-233" id="h9-0-233" class="d">-                    onClick = {
</a><a href="#h9-0-234" id="h9-0-234" class="d">-                        showAddFriendDialog = true
</a><a href="#h9-0-235" id="h9-0-235" class="d">-                    },
</a><a href="#h9-0-236" id="h9-0-236" class="d">-                    modifier = Modifier.padding(10.dp),
</a><a href="#h9-0-237" id="h9-0-237" class="d">-                    containerColor = MaterialTheme.colorScheme.primary,
</a><a href="#h9-0-238" id="h9-0-238" class="d">-                    contentColor = MaterialTheme.colorScheme.onPrimary,
</a><a href="#h9-0-239" id="h9-0-239" class="d">-                    shape = RoundedCornerShape(16.dp),
</a><a href="#h9-0-240" id="h9-0-240" class="d">-                ) {
</a><a href="#h9-0-241" id="h9-0-241" class="d">-                    Icon(
</a><a href="#h9-0-242" id="h9-0-242" class="d">-                        imageVector = Icons.Rounded.Add,
</a><a href="#h9-0-243" id="h9-0-243" class="d">-                        contentDescription = null
</a><a href="#h9-0-244" id="h9-0-244" class="d">-                    )
</a><a href="#h9-0-245" id="h9-0-245" class="d">-                }
</a><a href="#h9-0-246" id="h9-0-246" class="d">-            }
</a><a href="#h9-0-247" id="h9-0-247" class="d">-        ) { paddingValues -&gt;
</a><a href="#h9-0-248" id="h9-0-248" class="d">-            Column(modifier = Modifier.padding(paddingValues)) {
</a><a href="#h9-0-249" id="h9-0-249" class="d">-                TabRow(selectedTabIndex = pagerState.currentPage, indicator = { tabPositions -&gt;
</a><a href="#h9-0-250" id="h9-0-250" class="d">-                    TabRowDefaults.SecondaryIndicator(
</a><a href="#h9-0-251" id="h9-0-251" class="d">-                        Modifier.pagerTabIndicatorOffset(
</a><a href="#h9-0-252" id="h9-0-252" class="d">-                            pagerState = pagerState,
</a><a href="#h9-0-253" id="h9-0-253" class="d">-                            tabPositions = tabPositions
</a><a href="#h9-0-254" id="h9-0-254" class="d">-                        )
</a><a href="#h9-0-255" id="h9-0-255" class="d">-                    )
</a><a href="#h9-0-256" id="h9-0-256" class="d">-                }) {
</a><a href="#h9-0-257" id="h9-0-257" class="d">-                    titles.forEachIndexed { index, title -&gt;
</a><a href="#h9-0-258" id="h9-0-258" class="d">-                        Tab(
</a><a href="#h9-0-259" id="h9-0-259" class="d">-                            selected = pagerState.currentPage == index,
</a><a href="#h9-0-260" id="h9-0-260" class="d">-                            onClick = {
</a><a href="#h9-0-261" id="h9-0-261" class="d">-                                coroutineScope.launch {
</a><a href="#h9-0-262" id="h9-0-262" class="d">-                                    pagerState.animateScrollToPage(index)
</a><a href="#h9-0-263" id="h9-0-263" class="d">-                                }
</a><a href="#h9-0-264" id="h9-0-264" class="d">-                            },
</a><a href="#h9-0-265" id="h9-0-265" class="d">-                            text = {
</a><a href="#h9-0-266" id="h9-0-266" class="d">-                                Text(
</a><a href="#h9-0-267" id="h9-0-267" class="d">-                                    text = title,
</a><a href="#h9-0-268" id="h9-0-268" class="d">-                                    maxLines = 2,
</a><a href="#h9-0-269" id="h9-0-269" class="d">-                                    overflow = TextOverflow.Ellipsis
</a><a href="#h9-0-270" id="h9-0-270" class="d">-                                )
</a><a href="#h9-0-271" id="h9-0-271" class="d">-                            }
</a><a href="#h9-0-272" id="h9-0-272" class="d">-                        )
</a><a href="#h9-0-273" id="h9-0-273" class="d">-                    }
</a><a href="#h9-0-274" id="h9-0-274" class="d">-                }
</a><a href="#h9-0-275" id="h9-0-275" class="d">-
</a><a href="#h9-0-276" id="h9-0-276" class="d">-                HorizontalPager(
</a><a href="#h9-0-277" id="h9-0-277" class="d">-                    modifier = Modifier.padding(paddingValues),
</a><a href="#h9-0-278" id="h9-0-278" class="d">-                    state = pagerState
</a><a href="#h9-0-279" id="h9-0-279" class="d">-                ) { page -&gt;
</a><a href="#h9-0-280" id="h9-0-280" class="d">-                    when (page) {
</a><a href="#h9-0-281" id="h9-0-281" class="d">-                        0 -&gt; ScopeList(SocialScope.FRIEND)
</a><a href="#h9-0-282" id="h9-0-282" class="d">-                        1 -&gt; ScopeList(SocialScope.GROUP)
</a><a href="#h9-0-283" id="h9-0-283" class="d">-                    }
</a><a href="#h9-0-284" id="h9-0-284" class="d">-                }
</a><a href="#h9-0-285" id="h9-0-285" class="d">-            }
</a><a href="#h9-0-286" id="h9-0-286" class="d">-        }
</a><a href="#h9-0-287" id="h9-0-287" class="d">-    }
</a><a href="#h9-0-288" id="h9-0-288" class="d">-}</a><a href="#h9-0-289" id="h9-0-289" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRootSection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRootSection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/ui/manager/pages/social/SocialRootSection.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -0,0 +1,289 @@
</a><a href="#h10-0-0" id="h10-0-0" class="i">+package me.rhunk.snapenhance.ui.manager.pages.social
</a><a href="#h10-0-1" id="h10-0-1" class="i">+
</a><a href="#h10-0-2" id="h10-0-2" class="i">+import androidx.compose.foundation.ExperimentalFoundationApi
</a><a href="#h10-0-3" id="h10-0-3" class="i">+import androidx.compose.foundation.clickable
</a><a href="#h10-0-4" id="h10-0-4" class="i">+import androidx.compose.foundation.layout.*
</a><a href="#h10-0-5" id="h10-0-5" class="i">+import androidx.compose.foundation.lazy.LazyColumn
</a><a href="#h10-0-6" id="h10-0-6" class="i">+import androidx.compose.foundation.pager.HorizontalPager
</a><a href="#h10-0-7" id="h10-0-7" class="i">+import androidx.compose.foundation.pager.rememberPagerState
</a><a href="#h10-0-8" id="h10-0-8" class="i">+import androidx.compose.foundation.shape.RoundedCornerShape
</a><a href="#h10-0-9" id="h10-0-9" class="i">+import androidx.compose.material.icons.Icons
</a><a href="#h10-0-10" id="h10-0-10" class="i">+import androidx.compose.material.icons.filled.RemoveRedEye
</a><a href="#h10-0-11" id="h10-0-11" class="i">+import androidx.compose.material.icons.rounded.Add
</a><a href="#h10-0-12" id="h10-0-12" class="i">+import androidx.compose.material3.*
</a><a href="#h10-0-13" id="h10-0-13" class="i">+import androidx.compose.runtime.*
</a><a href="#h10-0-14" id="h10-0-14" class="i">+import androidx.compose.ui.Alignment
</a><a href="#h10-0-15" id="h10-0-15" class="i">+import androidx.compose.ui.Modifier
</a><a href="#h10-0-16" id="h10-0-16" class="i">+import androidx.compose.ui.graphics.vector.ImageVector
</a><a href="#h10-0-17" id="h10-0-17" class="i">+import androidx.compose.ui.res.vectorResource
</a><a href="#h10-0-18" id="h10-0-18" class="i">+import androidx.compose.ui.text.font.FontWeight
</a><a href="#h10-0-19" id="h10-0-19" class="i">+import androidx.compose.ui.text.style.TextAlign
</a><a href="#h10-0-20" id="h10-0-20" class="i">+import androidx.compose.ui.text.style.TextOverflow
</a><a href="#h10-0-21" id="h10-0-21" class="i">+import androidx.compose.ui.unit.dp
</a><a href="#h10-0-22" id="h10-0-22" class="i">+import androidx.compose.ui.unit.sp
</a><a href="#h10-0-23" id="h10-0-23" class="i">+import androidx.navigation.NavBackStackEntry
</a><a href="#h10-0-24" id="h10-0-24" class="i">+import kotlinx.coroutines.launch
</a><a href="#h10-0-25" id="h10-0-25" class="i">+import me.rhunk.snapenhance.R
</a><a href="#h10-0-26" id="h10-0-26" class="i">+import me.rhunk.snapenhance.common.data.MessagingFriendInfo
</a><a href="#h10-0-27" id="h10-0-27" class="i">+import me.rhunk.snapenhance.common.data.MessagingGroupInfo
</a><a href="#h10-0-28" id="h10-0-28" class="i">+import me.rhunk.snapenhance.common.data.SocialScope
</a><a href="#h10-0-29" id="h10-0-29" class="i">+import me.rhunk.snapenhance.common.ui.rememberAsyncMutableState
</a><a href="#h10-0-30" id="h10-0-30" class="i">+import me.rhunk.snapenhance.common.util.snap.BitmojiSelfie
</a><a href="#h10-0-31" id="h10-0-31" class="i">+import me.rhunk.snapenhance.storage.*
</a><a href="#h10-0-32" id="h10-0-32" class="i">+import me.rhunk.snapenhance.ui.manager.Routes
</a><a href="#h10-0-33" id="h10-0-33" class="i">+import me.rhunk.snapenhance.ui.util.coil.BitmojiImage
</a><a href="#h10-0-34" id="h10-0-34" class="i">+import me.rhunk.snapenhance.ui.util.pagerTabIndicatorOffset
</a><a href="#h10-0-35" id="h10-0-35" class="i">+
</a><a href="#h10-0-36" id="h10-0-36" class="i">+class SocialRootSection : Routes.Route() {
</a><a href="#h10-0-37" id="h10-0-37" class="i">+    private var friendList: List&lt;MessagingFriendInfo&gt; by mutableStateOf(emptyList())
</a><a href="#h10-0-38" id="h10-0-38" class="i">+    private var groupList: List&lt;MessagingGroupInfo&gt; by mutableStateOf(emptyList())
</a><a href="#h10-0-39" id="h10-0-39" class="i">+
</a><a href="#h10-0-40" id="h10-0-40" class="i">+    private fun updateScopeLists() {
</a><a href="#h10-0-41" id="h10-0-41" class="i">+        context.coroutineScope.launch {
</a><a href="#h10-0-42" id="h10-0-42" class="i">+            friendList = context.database.getFriends(descOrder = true)
</a><a href="#h10-0-43" id="h10-0-43" class="i">+            groupList = context.database.getGroups()
</a><a href="#h10-0-44" id="h10-0-44" class="i">+        }
</a><a href="#h10-0-45" id="h10-0-45" class="i">+    }
</a><a href="#h10-0-46" id="h10-0-46" class="i">+
</a><a href="#h10-0-47" id="h10-0-47" class="i">+    private val addFriendDialog by lazy {
</a><a href="#h10-0-48" id="h10-0-48" class="i">+        AddFriendDialog(context, AddFriendDialog.Actions(
</a><a href="#h10-0-49" id="h10-0-49" class="i">+            onFriendState = { friend, state -&gt;
</a><a href="#h10-0-50" id="h10-0-50" class="i">+                if (state) {
</a><a href="#h10-0-51" id="h10-0-51" class="i">+                    context.bridgeService?.triggerScopeSync(SocialScope.FRIEND, friend.userId)
</a><a href="#h10-0-52" id="h10-0-52" class="i">+                } else {
</a><a href="#h10-0-53" id="h10-0-53" class="i">+                    context.database.deleteFriend(friend.userId)
</a><a href="#h10-0-54" id="h10-0-54" class="i">+                }
</a><a href="#h10-0-55" id="h10-0-55" class="i">+            },
</a><a href="#h10-0-56" id="h10-0-56" class="i">+            onGroupState = { group, state -&gt;
</a><a href="#h10-0-57" id="h10-0-57" class="i">+                if (state) {
</a><a href="#h10-0-58" id="h10-0-58" class="i">+                    context.bridgeService?.triggerScopeSync(SocialScope.GROUP, group.conversationId)
</a><a href="#h10-0-59" id="h10-0-59" class="i">+                } else {
</a><a href="#h10-0-60" id="h10-0-60" class="i">+                    context.database.deleteGroup(group.conversationId)
</a><a href="#h10-0-61" id="h10-0-61" class="i">+                }
</a><a href="#h10-0-62" id="h10-0-62" class="i">+            },
</a><a href="#h10-0-63" id="h10-0-63" class="i">+            getFriendState = { friend -&gt; context.database.getFriendInfo(friend.userId) != null },
</a><a href="#h10-0-64" id="h10-0-64" class="i">+            getGroupState = { group -&gt; context.database.getGroupInfo(group.conversationId) != null }
</a><a href="#h10-0-65" id="h10-0-65" class="i">+        ))
</a><a href="#h10-0-66" id="h10-0-66" class="i">+    }
</a><a href="#h10-0-67" id="h10-0-67" class="i">+
</a><a href="#h10-0-68" id="h10-0-68" class="i">+    @Composable
</a><a href="#h10-0-69" id="h10-0-69" class="i">+    private fun ScopeList(scope: SocialScope) {
</a><a href="#h10-0-70" id="h10-0-70" class="i">+        val remainingHours = remember { context.config.root.streaksReminder.remainingHours.get() }
</a><a href="#h10-0-71" id="h10-0-71" class="i">+
</a><a href="#h10-0-72" id="h10-0-72" class="i">+        LazyColumn(
</a><a href="#h10-0-73" id="h10-0-73" class="i">+            modifier = Modifier
</a><a href="#h10-0-74" id="h10-0-74" class="i">+                .padding(2.dp)
</a><a href="#h10-0-75" id="h10-0-75" class="i">+                .fillMaxWidth()
</a><a href="#h10-0-76" id="h10-0-76" class="i">+                .fillMaxHeight(),
</a><a href="#h10-0-77" id="h10-0-77" class="i">+            contentPadding = PaddingValues(bottom = 110.dp),
</a><a href="#h10-0-78" id="h10-0-78" class="i">+        ) {
</a><a href="#h10-0-79" id="h10-0-79" class="i">+            //check if scope list is empty
</a><a href="#h10-0-80" id="h10-0-80" class="i">+            val listSize = when (scope) {
</a><a href="#h10-0-81" id="h10-0-81" class="i">+                SocialScope.GROUP -&gt; groupList.size
</a><a href="#h10-0-82" id="h10-0-82" class="i">+                SocialScope.FRIEND -&gt; friendList.size
</a><a href="#h10-0-83" id="h10-0-83" class="i">+            }
</a><a href="#h10-0-84" id="h10-0-84" class="i">+
</a><a href="#h10-0-85" id="h10-0-85" class="i">+            if (listSize == 0) {
</a><a href="#h10-0-86" id="h10-0-86" class="i">+                item {
</a><a href="#h10-0-87" id="h10-0-87" class="i">+                    Text(
</a><a href="#h10-0-88" id="h10-0-88" class="i">+                        text = translation[&quot;empty_hint&quot;], modifier = Modifier
</a><a href="#h10-0-89" id="h10-0-89" class="i">+                            .fillMaxWidth()
</a><a href="#h10-0-90" id="h10-0-90" class="i">+                            .padding(10.dp), textAlign = TextAlign.Center
</a><a href="#h10-0-91" id="h10-0-91" class="i">+                    )
</a><a href="#h10-0-92" id="h10-0-92" class="i">+                }
</a><a href="#h10-0-93" id="h10-0-93" class="i">+            }
</a><a href="#h10-0-94" id="h10-0-94" class="i">+
</a><a href="#h10-0-95" id="h10-0-95" class="i">+            items(listSize) { index -&gt;
</a><a href="#h10-0-96" id="h10-0-96" class="i">+                val id = when (scope) {
</a><a href="#h10-0-97" id="h10-0-97" class="i">+                    SocialScope.GROUP -&gt; groupList[index].conversationId
</a><a href="#h10-0-98" id="h10-0-98" class="i">+                    SocialScope.FRIEND -&gt; friendList[index].userId
</a><a href="#h10-0-99" id="h10-0-99" class="i">+                }
</a><a href="#h10-0-100" id="h10-0-100" class="i">+
</a><a href="#h10-0-101" id="h10-0-101" class="i">+                ElevatedCard(
</a><a href="#h10-0-102" id="h10-0-102" class="i">+                    modifier = Modifier
</a><a href="#h10-0-103" id="h10-0-103" class="i">+                        .padding(10.dp)
</a><a href="#h10-0-104" id="h10-0-104" class="i">+                        .fillMaxWidth()
</a><a href="#h10-0-105" id="h10-0-105" class="i">+                        .height(80.dp)
</a><a href="#h10-0-106" id="h10-0-106" class="i">+                        .clickable {
</a><a href="#h10-0-107" id="h10-0-107" class="i">+                            routes.manageScope.navigate {
</a><a href="#h10-0-108" id="h10-0-108" class="i">+                                put(&quot;id&quot;, id)
</a><a href="#h10-0-109" id="h10-0-109" class="i">+                                put(&quot;scope&quot;, scope.key)
</a><a href="#h10-0-110" id="h10-0-110" class="i">+                            }
</a><a href="#h10-0-111" id="h10-0-111" class="i">+                        },
</a><a href="#h10-0-112" id="h10-0-112" class="i">+                ) {
</a><a href="#h10-0-113" id="h10-0-113" class="i">+                    Row(
</a><a href="#h10-0-114" id="h10-0-114" class="i">+                        modifier = Modifier
</a><a href="#h10-0-115" id="h10-0-115" class="i">+                            .padding(10.dp)
</a><a href="#h10-0-116" id="h10-0-116" class="i">+                            .fillMaxSize(),
</a><a href="#h10-0-117" id="h10-0-117" class="i">+                        verticalAlignment = Alignment.CenterVertically
</a><a href="#h10-0-118" id="h10-0-118" class="i">+                    ) {
</a><a href="#h10-0-119" id="h10-0-119" class="i">+                        when (scope) {
</a><a href="#h10-0-120" id="h10-0-120" class="i">+                            SocialScope.GROUP -&gt; {
</a><a href="#h10-0-121" id="h10-0-121" class="i">+                                val group = groupList[index]
</a><a href="#h10-0-122" id="h10-0-122" class="i">+                                Column(
</a><a href="#h10-0-123" id="h10-0-123" class="i">+                                    modifier = Modifier
</a><a href="#h10-0-124" id="h10-0-124" class="i">+                                        .padding(7.dp)
</a><a href="#h10-0-125" id="h10-0-125" class="i">+                                        .fillMaxWidth()
</a><a href="#h10-0-126" id="h10-0-126" class="i">+                                        .weight(1f)
</a><a href="#h10-0-127" id="h10-0-127" class="i">+                                ) {
</a><a href="#h10-0-128" id="h10-0-128" class="i">+                                    Text(
</a><a href="#h10-0-129" id="h10-0-129" class="i">+                                        text = group.name,
</a><a href="#h10-0-130" id="h10-0-130" class="i">+                                        maxLines = 1,
</a><a href="#h10-0-131" id="h10-0-131" class="i">+                                        fontWeight = FontWeight.Bold
</a><a href="#h10-0-132" id="h10-0-132" class="i">+                                    )
</a><a href="#h10-0-133" id="h10-0-133" class="i">+                                }
</a><a href="#h10-0-134" id="h10-0-134" class="i">+                            }
</a><a href="#h10-0-135" id="h10-0-135" class="i">+
</a><a href="#h10-0-136" id="h10-0-136" class="i">+                            SocialScope.FRIEND -&gt; {
</a><a href="#h10-0-137" id="h10-0-137" class="i">+                                val friend = friendList[index]
</a><a href="#h10-0-138" id="h10-0-138" class="i">+                                val streaks by rememberAsyncMutableState(defaultValue = friend.streaks) {
</a><a href="#h10-0-139" id="h10-0-139" class="i">+                                    context.database.getFriendStreaks(friend.userId)
</a><a href="#h10-0-140" id="h10-0-140" class="i">+                                }
</a><a href="#h10-0-141" id="h10-0-141" class="i">+
</a><a href="#h10-0-142" id="h10-0-142" class="i">+                                BitmojiImage(
</a><a href="#h10-0-143" id="h10-0-143" class="i">+                                    context = context,
</a><a href="#h10-0-144" id="h10-0-144" class="i">+                                    url = BitmojiSelfie.getBitmojiSelfie(
</a><a href="#h10-0-145" id="h10-0-145" class="i">+                                        friend.selfieId,
</a><a href="#h10-0-146" id="h10-0-146" class="i">+                                        friend.bitmojiId,
</a><a href="#h10-0-147" id="h10-0-147" class="i">+                                        BitmojiSelfie.BitmojiSelfieType.THREE_D
</a><a href="#h10-0-148" id="h10-0-148" class="i">+                                    )
</a><a href="#h10-0-149" id="h10-0-149" class="i">+                                )
</a><a href="#h10-0-150" id="h10-0-150" class="i">+                                Column(
</a><a href="#h10-0-151" id="h10-0-151" class="i">+                                    modifier = Modifier
</a><a href="#h10-0-152" id="h10-0-152" class="i">+                                        .padding(7.dp)
</a><a href="#h10-0-153" id="h10-0-153" class="i">+                                        .fillMaxWidth()
</a><a href="#h10-0-154" id="h10-0-154" class="i">+                                        .weight(1f)
</a><a href="#h10-0-155" id="h10-0-155" class="i">+                                ) {
</a><a href="#h10-0-156" id="h10-0-156" class="i">+                                    Text(
</a><a href="#h10-0-157" id="h10-0-157" class="i">+                                        text = friend.displayName ?: friend.mutableUsername,
</a><a href="#h10-0-158" id="h10-0-158" class="i">+                                        maxLines = 1,
</a><a href="#h10-0-159" id="h10-0-159" class="i">+                                        fontWeight = FontWeight.Bold
</a><a href="#h10-0-160" id="h10-0-160" class="i">+                                    )
</a><a href="#h10-0-161" id="h10-0-161" class="i">+                                    Text(
</a><a href="#h10-0-162" id="h10-0-162" class="i">+                                        text = friend.mutableUsername,
</a><a href="#h10-0-163" id="h10-0-163" class="i">+                                        maxLines = 1,
</a><a href="#h10-0-164" id="h10-0-164" class="i">+                                        fontSize = 12.sp,
</a><a href="#h10-0-165" id="h10-0-165" class="i">+                                        fontWeight = FontWeight.Light
</a><a href="#h10-0-166" id="h10-0-166" class="i">+                                    )
</a><a href="#h10-0-167" id="h10-0-167" class="i">+                                }
</a><a href="#h10-0-168" id="h10-0-168" class="i">+                                Row(verticalAlignment = Alignment.CenterVertically) {
</a><a href="#h10-0-169" id="h10-0-169" class="i">+                                    streaks?.takeIf { it.notify }?.let { streaks -&gt;
</a><a href="#h10-0-170" id="h10-0-170" class="i">+                                        Icon(
</a><a href="#h10-0-171" id="h10-0-171" class="i">+                                            imageVector = ImageVector.vectorResource(id = R.drawable.streak_icon),
</a><a href="#h10-0-172" id="h10-0-172" class="i">+                                            contentDescription = null,
</a><a href="#h10-0-173" id="h10-0-173" class="i">+                                            modifier = Modifier.height(40.dp),
</a><a href="#h10-0-174" id="h10-0-174" class="i">+                                            tint = if (streaks.isAboutToExpire(remainingHours))
</a><a href="#h10-0-175" id="h10-0-175" class="i">+                                                MaterialTheme.colorScheme.error
</a><a href="#h10-0-176" id="h10-0-176" class="i">+                                            else MaterialTheme.colorScheme.primary
</a><a href="#h10-0-177" id="h10-0-177" class="i">+                                        )
</a><a href="#h10-0-178" id="h10-0-178" class="i">+                                        Text(
</a><a href="#h10-0-179" id="h10-0-179" class="i">+                                            text = translation.format(
</a><a href="#h10-0-180" id="h10-0-180" class="i">+                                                &quot;streaks_expiration_short&quot;,
</a><a href="#h10-0-181" id="h10-0-181" class="i">+                                                &quot;hours&quot; to (((streaks.expirationTimestamp - System.currentTimeMillis()) / 3600000).toInt().takeIf { it &gt; 0 } ?: 0)
</a><a href="#h10-0-182" id="h10-0-182" class="i">+                                                    .toString()
</a><a href="#h10-0-183" id="h10-0-183" class="i">+                                            ),
</a><a href="#h10-0-184" id="h10-0-184" class="i">+                                            maxLines = 1,
</a><a href="#h10-0-185" id="h10-0-185" class="i">+                                            fontWeight = FontWeight.Bold
</a><a href="#h10-0-186" id="h10-0-186" class="i">+                                        )
</a><a href="#h10-0-187" id="h10-0-187" class="i">+                                    }
</a><a href="#h10-0-188" id="h10-0-188" class="i">+                                }
</a><a href="#h10-0-189" id="h10-0-189" class="i">+                            }
</a><a href="#h10-0-190" id="h10-0-190" class="i">+                        }
</a><a href="#h10-0-191" id="h10-0-191" class="i">+
</a><a href="#h10-0-192" id="h10-0-192" class="i">+                        FilledIconButton(onClick = {
</a><a href="#h10-0-193" id="h10-0-193" class="i">+                            routes.messagingPreview.navigate {
</a><a href="#h10-0-194" id="h10-0-194" class="i">+                                put(&quot;id&quot;, id)
</a><a href="#h10-0-195" id="h10-0-195" class="i">+                                put(&quot;scope&quot;, scope.key)
</a><a href="#h10-0-196" id="h10-0-196" class="i">+                            }
</a><a href="#h10-0-197" id="h10-0-197" class="i">+                        }) {
</a><a href="#h10-0-198" id="h10-0-198" class="i">+                            Icon(imageVector = Icons.Filled.RemoveRedEye, contentDescription = null)
</a><a href="#h10-0-199" id="h10-0-199" class="i">+                        }
</a><a href="#h10-0-200" id="h10-0-200" class="i">+                    }
</a><a href="#h10-0-201" id="h10-0-201" class="i">+                }
</a><a href="#h10-0-202" id="h10-0-202" class="i">+            }
</a><a href="#h10-0-203" id="h10-0-203" class="i">+        }
</a><a href="#h10-0-204" id="h10-0-204" class="i">+    }
</a><a href="#h10-0-205" id="h10-0-205" class="i">+
</a><a href="#h10-0-206" id="h10-0-206" class="i">+    @OptIn(ExperimentalFoundationApi::class)
</a><a href="#h10-0-207" id="h10-0-207" class="i">+    override val content: @Composable (NavBackStackEntry) -&gt; Unit = {
</a><a href="#h10-0-208" id="h10-0-208" class="i">+        val titles = remember {
</a><a href="#h10-0-209" id="h10-0-209" class="i">+            listOf(translation[&quot;friends_tab&quot;], translation[&quot;groups_tab&quot;])
</a><a href="#h10-0-210" id="h10-0-210" class="i">+        }
</a><a href="#h10-0-211" id="h10-0-211" class="i">+        val coroutineScope = rememberCoroutineScope()
</a><a href="#h10-0-212" id="h10-0-212" class="i">+        val pagerState = rememberPagerState { titles.size }
</a><a href="#h10-0-213" id="h10-0-213" class="i">+        var showAddFriendDialog by remember { mutableStateOf(false) }
</a><a href="#h10-0-214" id="h10-0-214" class="i">+
</a><a href="#h10-0-215" id="h10-0-215" class="i">+        if (showAddFriendDialog) {
</a><a href="#h10-0-216" id="h10-0-216" class="i">+            addFriendDialog.Content {
</a><a href="#h10-0-217" id="h10-0-217" class="i">+                showAddFriendDialog = false
</a><a href="#h10-0-218" id="h10-0-218" class="i">+            }
</a><a href="#h10-0-219" id="h10-0-219" class="i">+            DisposableEffect(Unit) {
</a><a href="#h10-0-220" id="h10-0-220" class="i">+                onDispose {
</a><a href="#h10-0-221" id="h10-0-221" class="i">+                    updateScopeLists()
</a><a href="#h10-0-222" id="h10-0-222" class="i">+                }
</a><a href="#h10-0-223" id="h10-0-223" class="i">+            }
</a><a href="#h10-0-224" id="h10-0-224" class="i">+        }
</a><a href="#h10-0-225" id="h10-0-225" class="i">+
</a><a href="#h10-0-226" id="h10-0-226" class="i">+        LaunchedEffect(Unit) {
</a><a href="#h10-0-227" id="h10-0-227" class="i">+            updateScopeLists()
</a><a href="#h10-0-228" id="h10-0-228" class="i">+        }
</a><a href="#h10-0-229" id="h10-0-229" class="i">+
</a><a href="#h10-0-230" id="h10-0-230" class="i">+        Scaffold(
</a><a href="#h10-0-231" id="h10-0-231" class="i">+            floatingActionButton = {
</a><a href="#h10-0-232" id="h10-0-232" class="i">+                FloatingActionButton(
</a><a href="#h10-0-233" id="h10-0-233" class="i">+                    onClick = {
</a><a href="#h10-0-234" id="h10-0-234" class="i">+                        showAddFriendDialog = true
</a><a href="#h10-0-235" id="h10-0-235" class="i">+                    },
</a><a href="#h10-0-236" id="h10-0-236" class="i">+                    modifier = Modifier.padding(10.dp),
</a><a href="#h10-0-237" id="h10-0-237" class="i">+                    containerColor = MaterialTheme.colorScheme.primary,
</a><a href="#h10-0-238" id="h10-0-238" class="i">+                    contentColor = MaterialTheme.colorScheme.onPrimary,
</a><a href="#h10-0-239" id="h10-0-239" class="i">+                    shape = RoundedCornerShape(16.dp),
</a><a href="#h10-0-240" id="h10-0-240" class="i">+                ) {
</a><a href="#h10-0-241" id="h10-0-241" class="i">+                    Icon(
</a><a href="#h10-0-242" id="h10-0-242" class="i">+                        imageVector = Icons.Rounded.Add,
</a><a href="#h10-0-243" id="h10-0-243" class="i">+                        contentDescription = null
</a><a href="#h10-0-244" id="h10-0-244" class="i">+                    )
</a><a href="#h10-0-245" id="h10-0-245" class="i">+                }
</a><a href="#h10-0-246" id="h10-0-246" class="i">+            }
</a><a href="#h10-0-247" id="h10-0-247" class="i">+        ) { paddingValues -&gt;
</a><a href="#h10-0-248" id="h10-0-248" class="i">+            Column(modifier = Modifier.padding(paddingValues)) {
</a><a href="#h10-0-249" id="h10-0-249" class="i">+                TabRow(selectedTabIndex = pagerState.currentPage, indicator = { tabPositions -&gt;
</a><a href="#h10-0-250" id="h10-0-250" class="i">+                    TabRowDefaults.SecondaryIndicator(
</a><a href="#h10-0-251" id="h10-0-251" class="i">+                        Modifier.pagerTabIndicatorOffset(
</a><a href="#h10-0-252" id="h10-0-252" class="i">+                            pagerState = pagerState,
</a><a href="#h10-0-253" id="h10-0-253" class="i">+                            tabPositions = tabPositions
</a><a href="#h10-0-254" id="h10-0-254" class="i">+                        )
</a><a href="#h10-0-255" id="h10-0-255" class="i">+                    )
</a><a href="#h10-0-256" id="h10-0-256" class="i">+                }) {
</a><a href="#h10-0-257" id="h10-0-257" class="i">+                    titles.forEachIndexed { index, title -&gt;
</a><a href="#h10-0-258" id="h10-0-258" class="i">+                        Tab(
</a><a href="#h10-0-259" id="h10-0-259" class="i">+                            selected = pagerState.currentPage == index,
</a><a href="#h10-0-260" id="h10-0-260" class="i">+                            onClick = {
</a><a href="#h10-0-261" id="h10-0-261" class="i">+                                coroutineScope.launch {
</a><a href="#h10-0-262" id="h10-0-262" class="i">+                                    pagerState.animateScrollToPage(index)
</a><a href="#h10-0-263" id="h10-0-263" class="i">+                                }
</a><a href="#h10-0-264" id="h10-0-264" class="i">+                            },
</a><a href="#h10-0-265" id="h10-0-265" class="i">+                            text = {
</a><a href="#h10-0-266" id="h10-0-266" class="i">+                                Text(
</a><a href="#h10-0-267" id="h10-0-267" class="i">+                                    text = title,
</a><a href="#h10-0-268" id="h10-0-268" class="i">+                                    maxLines = 2,
</a><a href="#h10-0-269" id="h10-0-269" class="i">+                                    overflow = TextOverflow.Ellipsis
</a><a href="#h10-0-270" id="h10-0-270" class="i">+                                )
</a><a href="#h10-0-271" id="h10-0-271" class="i">+                            }
</a><a href="#h10-0-272" id="h10-0-272" class="i">+                        )
</a><a href="#h10-0-273" id="h10-0-273" class="i">+                    }
</a><a href="#h10-0-274" id="h10-0-274" class="i">+                }
</a><a href="#h10-0-275" id="h10-0-275" class="i">+
</a><a href="#h10-0-276" id="h10-0-276" class="i">+                HorizontalPager(
</a><a href="#h10-0-277" id="h10-0-277" class="i">+                    modifier = Modifier.padding(paddingValues),
</a><a href="#h10-0-278" id="h10-0-278" class="i">+                    state = pagerState
</a><a href="#h10-0-279" id="h10-0-279" class="i">+                ) { page -&gt;
</a><a href="#h10-0-280" id="h10-0-280" class="i">+                    when (page) {
</a><a href="#h10-0-281" id="h10-0-281" class="i">+                        0 -&gt; ScopeList(SocialScope.FRIEND)
</a><a href="#h10-0-282" id="h10-0-282" class="i">+                        1 -&gt; ScopeList(SocialScope.GROUP)
</a><a href="#h10-0-283" id="h10-0-283" class="i">+                    }
</a><a href="#h10-0-284" id="h10-0-284" class="i">+                }
</a><a href="#h10-0-285" id="h10-0-285" class="i">+            }
</a><a href="#h10-0-286" id="h10-0-286" class="i">+        }
</a><a href="#h10-0-287" id="h10-0-287" class="i">+    }
</a><a href="#h10-0-288" id="h10-0-288" class="i">+}</a><a href="#h10-0-289" id="h10-0-289" class="i">+
\ No newline at end of file
</a></pre>
</div>
</body>
</html>
