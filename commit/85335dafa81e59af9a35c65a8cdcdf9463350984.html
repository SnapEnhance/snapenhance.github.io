<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>refactor: reorganize (#15) - SnapEnhance - An Xposed module offering an enhanced Snapchat experience
</title>
<link rel="icon" type="image/svg+xml" href="../../logo.png"/>
<link rel="alternate icon" href="../../favicon.png"/>
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed" href="../atom.xml" />
<link rel="alternate" type="application/atom+xml" title="SnapEnhance Atom Feed (tags)" href="../tags.xml" />
<link rel="stylesheet" type="text/css" href="../../style.css" />
<link rel="stylesheet" type="text/css" href="../../fonts.css" />
</head>
<body>
<div id="head"><table><tr><td><a class="logo" href="../../"><img src="../../logo.png" alt="" width="32" height="32" /></a></td><td><strong>SnapEnhance</strong><span class="desc"> - An Xposed module offering an enhanced Snapchat experience
</span>
</td></tr></table>
<p><a href="../about.html">About</a> | <a href="../log.html">Log</a> | <a href="../files.html">Files</a> | <a href="../refs.html">Refs</a> | <a href="../file/.gitmodules.html">Submodules</a> | <a href="../file/LICENSE.html">License</a></p>
</div>
<hr/>
<div id="content">
<pre><b>commit</b> <a href="../commit/85335dafa81e59af9a35c65a8cdcdf9463350984.html">85335dafa81e59af9a35c65a8cdcdf9463350984</a>
<b>parent</b> <a href="../commit/cfb0ba5d65e435f622e7408d21c32d9f5855ded0.html">cfb0ba5d65e435f622e7408d21c32d9f5855ded0</a>
<b>Author:</b> auth &lt;<a href="mailto:64337177+authorisation@users.noreply.github.com">64337177+authorisation@users.noreply.github.com</a>&gt;
<b>Date:</b>   Sun,  4 Jun 2023 01:53:05 +0200

refactor: reorganize (#15)

* refactor: organization (1/?)

open for ideas and suggestions
TODO:
    • Merge UI Hide Elements
    • Remove Longitude and Latitude from the menu and integrate into the MapActivity
    • Move New Map UI to Experimental
    • Shorten „Show Message Content in Notification“

And possibly even more

* Merge hide UI Elements

bugfix(?): merge overlay

* add: download options

* add: config listeners

* fix(ci): debug

remove prod as it&#39;s not getting built anymore

* fix(messagelogger): clear database bug

* update locale, reorganize config

* add: set precise location dialog

* config: better notifications

---------

Co-authored-by: rhunk &lt;101876869+rhunk@users.noreply.github.com&gt;
<b>Diffstat:</b>
<table><tr><td class="M">M</td><td><a href="#h0">.github/workflows/android.yml</a></td><td> | </td><td class="num">5</td><td><span class="i"></span><span class="d">-----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h1">.gitignore</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h2">app/src/main/assets/lang/en_US.json</a></td><td> | </td><td class="num">78</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h3">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt</a></td><td> | </td><td class="num">2</td><td><span class="i">+</span><span class="d">-</span></td></tr>
<tr><td class="M">M</td><td><a href="#h4">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></td><td> | </td><td class="num">13</td><td><span class="i">++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h5">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></td><td> | </td><td class="num">291</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++</span><span class="d">------------------------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h6">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt</a></td><td> | </td><td class="num">19</td><td><span class="i">+++++++++++++++++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h7">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h8">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt</a></td><td> | </td><td class="num">13</td><td><span class="i">+++++++++</span><span class="d">----</span></td></tr>
<tr><td class="M">M</td><td><a href="#h9">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt</a></td><td> | </td><td class="num">14</td><td><span class="i">++++</span><span class="d">----------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h10">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt</a></td><td> | </td><td class="num">6</td><td><span class="i">+++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h11">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt</a></td><td> | </td><td class="num">9</td><td><span class="i">++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h12">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></td><td> | </td><td class="num">36</td><td><span class="i">+++++++++++++++++</span><span class="d">-------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h13">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AntiAutoSave.kt</a></td><td> | </td><td class="num">20</td><td><span class="i"></span><span class="d">--------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h14">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt</a></td><td> | </td><td class="num">139</td><td><span class="i"></span><span class="d">-------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h15">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/DisableVideoLengthRestriction.kt</a></td><td> | </td><td class="num">26</td><td><span class="i"></span><span class="d">--------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h16">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/GalleryMediaSendOverride.kt</a></td><td> | </td><td class="num">38</td><td><span class="i"></span><span class="d">--------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h17">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/LocationSpoofer.kt</a></td><td> | </td><td class="num">65</td><td><span class="i"></span><span class="d">-----------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h18">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/MediaQualityLevelOverride.kt</a></td><td> | </td><td class="num">27</td><td><span class="i"></span><span class="d">---------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h19">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt</a></td><td> | </td><td class="num">302</td><td><span class="i"></span><span class="d">------------------------------------------------------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h20">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/SnapchatPlus.kt</a></td><td> | </td><td class="num">30</td><td><span class="i"></span><span class="d">------------------------------</span></td></tr>
<tr><td class="D">D</td><td><a href="#h21">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/UnlimitedSnapViewTime.kt</a></td><td> | </td><td class="num">36</td><td><span class="i"></span><span class="d">------------------------------------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h22">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt</a></td><td> | </td><td class="num">20</td><td><span class="i">++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h23">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a></td><td> | </td><td class="num">135</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h24">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a></td><td> | </td><td class="num">26</td><td><span class="i">++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h25">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a></td><td> | </td><td class="num">38</td><td><span class="i">++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h26">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a></td><td> | </td><td class="num">65</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h27">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a></td><td> | </td><td class="num">27</td><td><span class="i">+++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h28">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a></td><td> | </td><td class="num">301</td><td><span class="i">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h29">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a></td><td> | </td><td class="num">30</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="A">A</td><td><a href="#h30">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a></td><td> | </td><td class="num">36</td><td><span class="i">++++++++++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
<tr><td class="M">M</td><td><a href="#h31">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a></td><td> | </td><td class="num">17</td><td><span class="i">+++++++++</span><span class="d">--------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h32">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/MapActivity.kt</a></td><td> | </td><td class="num">32</td><td><span class="i">+++++++++++++++++++++++++++++</span><span class="d">---</span></td></tr>
<tr><td class="M">M</td><td><a href="#h33">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a></td><td> | </td><td class="num">43</td><td><span class="i">++++++++++++++++++++++</span><span class="d">---------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h34">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h35">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a></td><td> | </td><td class="num">51</td><td><span class="i">+++++++++++++++++++++++++++++</span><span class="d">----------------------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h36">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a></td><td> | </td><td class="num">4</td><td><span class="i">++</span><span class="d">--</span></td></tr>
<tr><td class="M">M</td><td><a href="#h37">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></td><td> | </td><td class="num">18</td><td><span class="i">+++++++++</span><span class="d">---------</span></td></tr>
<tr><td class="M">M</td><td><a href="#h38">app/src/main/res/layout/map.xml</a></td><td> | </td><td class="num">41</td><td><span class="i">++++++++++++++++++++++++++++++</span><span class="d">-----------</span></td></tr>
<tr><td class="A">A</td><td><a href="#h39">app/src/main/res/layout/precise_location_dialog.xml</a></td><td> | </td><td class="num">29</td><td><span class="i">+++++++++++++++++++++++++++++</span><span class="d"></span></td></tr>
</table></pre><pre>40 files changed, 1124 insertions(+), 974 deletions(-)
<hr/><b>diff --git a/<a id="h0" href="../file/.github/workflows/android.yml.html">.github/workflows/android.yml</a> b/<a href="../file/.github/workflows/android.yml.html">.github/workflows/android.yml</a></b>
<a href="#h0-0" id="h0-0" class="h">@@ -34,8 +34,3 @@ jobs:
</a>       with:
         name: app-armv7-release
         path: app/build/outputs/apk/armv7/debug/*.apk
<a href="#h0-0-3" id="h0-0-3" class="d">-    - name: Upload prod
</a><a href="#h0-0-4" id="h0-0-4" class="d">-      uses: actions/upload-artifact@v3.1.2
</a><a href="#h0-0-5" id="h0-0-5" class="d">-      with:
</a><a href="#h0-0-6" id="h0-0-6" class="d">-        name: app-prod-release
</a><a href="#h0-0-7" id="h0-0-7" class="d">-        path: app/build/outputs/apk/prod/debug/*.apk
</a><b>diff --git a/<a id="h1" href="../file/.gitignore.html">.gitignore</a> b/<a href="../file/.gitignore.html">.gitignore</a></b>
<a href="#h1-0" id="h1-0" class="h">@@ -1,10 +1,9 @@
</a> *.iml
 .gradle
<a href="#h1-0-2" id="h1-0-2" class="d">-/local.properties
</a><a href="#h1-0-3" id="h1-0-3" class="i">+local.properties
</a> /.idea/
 .DS_Store
 /build
 /captures
 .externalNativeBuild
<a href="#h1-0-9" id="h1-0-9" class="d">-.cxx
</a><a href="#h1-0-10" id="h1-0-10" class="d">-local.properties
</a><a href="#h1-0-11" id="h1-0-11" class="i">+.cxx</a><a href="#h1-0-12" id="h1-0-12" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h2" href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a> b/<a href="../file/app/src/main/assets/lang/en_US.json.html">app/src/main/assets/lang/en_US.json</a></b>
<a href="#h2-0" id="h2-0" class="h">@@ -1,22 +1,16 @@
</a> {
     &quot;category&quot;: {
<a href="#h2-0-2" id="h2-0-2" class="d">-        &quot;general&quot;: &quot;General&quot;,
</a><a href="#h2-0-3" id="h2-0-3" class="d">-        &quot;spying&quot;: &quot;Spying&quot;,
</a><a href="#h2-0-4" id="h2-0-4" class="d">-        &quot;media_download&quot;: &quot;Media Downloader&quot;,
</a><a href="#h2-0-5" id="h2-0-5" class="d">-        &quot;privacy&quot;: &quot;Privacy&quot;,
</a><a href="#h2-0-6" id="h2-0-6" class="d">-        &quot;ui&quot;: &quot;UI&quot;,
</a><a href="#h2-0-7" id="h2-0-7" class="d">-        &quot;extras&quot;: &quot;Extras&quot;,
</a><a href="#h2-0-8" id="h2-0-8" class="d">-        &quot;tweaks&quot;: &quot;Tweaks&quot;,
</a><a href="#h2-0-9" id="h2-0-9" class="d">-        &quot;location_spoof&quot;: &quot;Location Spoof&quot;,
</a><a href="#h2-0-10" id="h2-0-10" class="d">-        &quot;experimental&quot;: &quot;Experimental&quot;,
</a><a href="#h2-0-11" id="h2-0-11" class="d">-        &quot;debugging&quot;: &quot;Debugging&quot;
</a><a href="#h2-0-12" id="h2-0-12" class="i">+        &quot;spying_privacy&quot;: &quot;Spying &amp; Privacy&quot;,
</a><a href="#h2-0-13" id="h2-0-13" class="i">+        &quot;media_manager&quot;: &quot;Media Manager&quot;,
</a><a href="#h2-0-14" id="h2-0-14" class="i">+        &quot;ui_tweaks&quot;: &quot;UI &amp; Tweaks&quot;,
</a><a href="#h2-0-15" id="h2-0-15" class="i">+        &quot;experimental_debugging&quot;: &quot;Experimental&quot;
</a>     },
 
     &quot;action&quot;: {
         &quot;clean_cache&quot;: &quot;Clean Cache&quot;,
         &quot;clear_message_logger&quot;: &quot;Clear Message Logger&quot;,
         &quot;refresh_mappings&quot;: &quot;Refresh Mappings&quot;,
<a href="#h2-0-22" id="h2-0-22" class="d">-        &quot;open_map&quot;: &quot;Pick a location on the map&quot;
</a><a href="#h2-0-23" id="h2-0-23" class="i">+        &quot;open_map&quot;: &quot;Choose location on map&quot;
</a>     },
    
     &quot;property&quot;: {
<a href="#h2-1" id="h2-1" class="h">@@ -24,16 +18,14 @@
</a>         &quot;prevent_read_receipts&quot;: &quot;Prevent Read Receipts&quot;,
         &quot;hide_bitmoji_presence&quot;: &quot;Hide Bitmoji Presence&quot;,
         &quot;show_message_content_in_notifications&quot;: &quot;Show Message Content In Notifications&quot;,
<a href="#h2-1-3" id="h2-1-3" class="i">+        &quot;better_notifications&quot;: &quot;Better Notifications&quot;,
</a>         &quot;notification_blacklist&quot;: &quot;Notification Blacklist&quot;,
         &quot;message_logger&quot;: &quot;Message Logger&quot;,
         &quot;unlimited_snap_view_time&quot;: &quot;Unlimited Snap View Time&quot;,
<a href="#h2-1-7" id="h2-1-7" class="d">-        &quot;auto_download_snaps&quot;: &quot;Auto Download Snaps&quot;,
</a><a href="#h2-1-8" id="h2-1-8" class="d">-        &quot;auto_download_stories&quot;: &quot;Auto Download Stories&quot;,
</a><a href="#h2-1-9" id="h2-1-9" class="d">-        &quot;auto_download_public_stories&quot;: &quot;Auto Download Public Stories&quot;,
</a><a href="#h2-1-10" id="h2-1-10" class="d">-        &quot;auto_download_spotlight&quot;: &quot;Auto Download Spotlight&quot;,
</a><a href="#h2-1-11" id="h2-1-11" class="i">+        &quot;auto_download_options&quot;: &quot;Auto Download Options&quot;,
</a>         &quot;download_options&quot;: &quot;Download Options&quot;,
<a href="#h2-1-13" id="h2-1-13" class="d">-        &quot;download_inchat_snaps&quot;: &quot;Download Inchat Snaps&quot;,
</a><a href="#h2-1-14" id="h2-1-14" class="d">-        &quot;anti_auto_download_button&quot;: &quot;Anti Auto Download Button&quot;,
</a><a href="#h2-1-15" id="h2-1-15" class="i">+        &quot;chat_download_context_menu&quot;: &quot;Enable Chat Download Context Menu&quot;,
</a><a href="#h2-1-16" id="h2-1-16" class="i">+        &quot;auto_download_blacklist&quot;: &quot;Auto Download Blacklist&quot;,
</a>         &quot;disable_metrics&quot;: &quot;Disable Metrics&quot;,
         &quot;prevent_screenshot_notifications&quot;: &quot;Prevent Screenshot Notifications&quot;,
         &quot;prevent_status_notifications&quot;: &quot;Prevent Status Notifications (Save to camera roll, missed calls)&quot;,
<a href="#h2-2" id="h2-2" class="h">@@ -42,7 +34,7 @@
</a>         &quot;menu_slot_id&quot;: &quot;Friend Menu Slot ID&quot;,
         &quot;message_preview_length&quot;: &quot;Message Preview Length&quot;,
         &quot;gallery_media_send_override&quot;: &quot;Gallery Media Send Override&quot;,
<a href="#h2-2-3" id="h2-2-3" class="d">-        &quot;auto_save&quot;: &quot;Auto Save&quot;,
</a><a href="#h2-2-4" id="h2-2-4" class="i">+        &quot;auto_save_messages&quot;: &quot;Auto Save Messages&quot;,
</a>         &quot;anti_auto_save&quot;: &quot;Anti Auto Save Button&quot;,
         &quot;snapchat_plus&quot;: &quot;Snapchat Plus&quot;,
         &quot;disable_snap_splitting&quot;: &quot;Disable Snap Splitting&quot;,
<a href="#h2-3" id="h2-3" class="h">@@ -62,11 +54,17 @@
</a>         &quot;meo_passcode_bypass&quot;: &quot;My Eyes Only Passcode Bypass&quot;,
         &quot;location_spoof&quot;: &quot;Snapmap Location Spoofer&quot;,
         &quot;latitude_value&quot;: &quot;Latitude&quot;,
<a href="#h2-3-3" id="h2-3-3" class="d">-        &quot;longitude_value&quot;: &quot;Longitude&quot;
</a><a href="#h2-3-4" id="h2-3-4" class="i">+        &quot;longitude_value&quot;: &quot;Longitude&quot;,
</a><a href="#h2-3-5" id="h2-3-5" class="i">+        &quot;hide_ui_elements&quot;: &quot;Hide UI Elements&quot;
</a>     },
 
     &quot;option&quot;: {
         &quot;property&quot;: {
<a href="#h2-3-10" id="h2-3-10" class="i">+            &quot;better_notifications&quot;: {
</a><a href="#h2-3-11" id="h2-3-11" class="i">+                &quot;chat&quot;: &quot;Show chat messages&quot;,
</a><a href="#h2-3-12" id="h2-3-12" class="i">+                &quot;snap&quot;: &quot;Show medias&quot;,
</a><a href="#h2-3-13" id="h2-3-13" class="i">+                &quot;reply_button&quot;: &quot;Add reply button&quot;
</a><a href="#h2-3-14" id="h2-3-14" class="i">+            },
</a>             &quot;download_options&quot;: {
                 &quot;format_user_folder&quot;: &quot;Create folder for each user&quot;,
                 &quot;format_hash&quot;: &quot;Add a unique hash to the file path&quot;,
<a href="#h2-4" id="h2-4" class="h">@@ -74,10 +72,46 @@
</a>                 &quot;format_date_time&quot;: &quot;Add the date and time to the file path&quot;,
                 &quot;merge_overlay&quot;: &quot;Merge Snap Image Overlays&quot;
             },
<a href="#h2-4-3" id="h2-4-3" class="i">+            &quot;auto_download_options&quot;: {
</a><a href="#h2-4-4" id="h2-4-4" class="i">+                &quot;friend_snaps&quot;: &quot;Friend Snaps&quot;,
</a><a href="#h2-4-5" id="h2-4-5" class="i">+                &quot;friend_stories&quot;: &quot;Friend Stories&quot;,
</a><a href="#h2-4-6" id="h2-4-6" class="i">+                &quot;public_stories&quot;: &quot;Public Stories&quot;,
</a><a href="#h2-4-7" id="h2-4-7" class="i">+                &quot;spotlight&quot;: &quot;Spotlight&quot;
</a><a href="#h2-4-8" id="h2-4-8" class="i">+            },
</a><a href="#h2-4-9" id="h2-4-9" class="i">+            &quot;auto_save_messages&quot;: {
</a><a href="#h2-4-10" id="h2-4-10" class="i">+                &quot;NOTE&quot;: &quot;Audio Note&quot;,
</a><a href="#h2-4-11" id="h2-4-11" class="i">+                &quot;CHAT&quot;: &quot;Chat&quot;,
</a><a href="#h2-4-12" id="h2-4-12" class="i">+                &quot;EXTERNAL_MEDIA&quot;: &quot;External Media&quot;,
</a><a href="#h2-4-13" id="h2-4-13" class="i">+                &quot;SNAP&quot;: &quot;Snap&quot;,
</a><a href="#h2-4-14" id="h2-4-14" class="i">+                &quot;STICKER&quot;: &quot;Sticker&quot;
</a><a href="#h2-4-15" id="h2-4-15" class="i">+            },
</a>             &quot;notification_blacklist&quot;: {
                 &quot;chat&quot;: &quot;Chat&quot;,
                 &quot;snap&quot;: &quot;Snap&quot;,
                 &quot;typing&quot;: &quot;Typing&quot;
<a href="#h2-4-20" id="h2-4-20" class="i">+            },
</a><a href="#h2-4-21" id="h2-4-21" class="i">+            &quot;gallery_media_send_override&quot;: {
</a><a href="#h2-4-22" id="h2-4-22" class="i">+                &quot;OFF&quot;: &quot;Off&quot;,
</a><a href="#h2-4-23" id="h2-4-23" class="i">+                &quot;NOTE&quot;: &quot;Audio Note&quot;,
</a><a href="#h2-4-24" id="h2-4-24" class="i">+                &quot;SNAP&quot;: &quot;Snap&quot;,
</a><a href="#h2-4-25" id="h2-4-25" class="i">+                &quot;LIVE_SNAP&quot;: &quot;Snap with audio&quot;
</a><a href="#h2-4-26" id="h2-4-26" class="i">+            },
</a><a href="#h2-4-27" id="h2-4-27" class="i">+            &quot;media_quality_level&quot;: {
</a><a href="#h2-4-28" id="h2-4-28" class="i">+                &quot;LEVEL_NONE&quot;: &quot;Level None&quot;,
</a><a href="#h2-4-29" id="h2-4-29" class="i">+                &quot;LEVEL_1&quot;: &quot;Level 1&quot;,
</a><a href="#h2-4-30" id="h2-4-30" class="i">+                &quot;LEVEL_2&quot;: &quot;Level 2&quot;,
</a><a href="#h2-4-31" id="h2-4-31" class="i">+                &quot;LEVEL_3&quot;: &quot;Level 3&quot;,
</a><a href="#h2-4-32" id="h2-4-32" class="i">+                &quot;LEVEL_4&quot;: &quot;Level 4&quot;,
</a><a href="#h2-4-33" id="h2-4-33" class="i">+                &quot;LEVEL_5&quot;: &quot;Level 5&quot;,
</a><a href="#h2-4-34" id="h2-4-34" class="i">+                &quot;LEVEL_6&quot;: &quot;Level 6&quot;,
</a><a href="#h2-4-35" id="h2-4-35" class="i">+                &quot;LEVEL_7&quot;: &quot;Level 7&quot;,
</a><a href="#h2-4-36" id="h2-4-36" class="i">+                &quot;LEVEL_MAX&quot;: &quot;Level Max&quot;
</a><a href="#h2-4-37" id="h2-4-37" class="i">+            },
</a><a href="#h2-4-38" id="h2-4-38" class="i">+            &quot;hide_ui_elements&quot;: {
</a><a href="#h2-4-39" id="h2-4-39" class="i">+                &quot;remove_call_buttons&quot;: &quot;Remove Call Buttons&quot;,
</a><a href="#h2-4-40" id="h2-4-40" class="i">+                &quot;remove_cognac_button&quot;: &quot;Remove Cognac Button&quot;,
</a><a href="#h2-4-41" id="h2-4-41" class="i">+                &quot;remove_stickers_button&quot;: &quot;Remove Stickers Button&quot;,
</a><a href="#h2-4-42" id="h2-4-42" class="i">+                &quot;remove_voice_record_button&quot;: &quot;Remove Voice Record Button&quot;
</a>             }
         }
     },
<a href="#h2-5" id="h2-5" class="h">@@ -94,6 +128,12 @@
</a>         &quot;preview&quot;: &quot;Preview&quot;
     },
 
<a href="#h2-5-3" id="h2-5-3" class="i">+    &quot;chat_action_menu&quot;: {
</a><a href="#h2-5-4" id="h2-5-4" class="i">+        &quot;preview_button&quot;: &quot;Preview&quot;,
</a><a href="#h2-5-5" id="h2-5-5" class="i">+        &quot;download_button&quot;: &quot;Download&quot;,
</a><a href="#h2-5-6" id="h2-5-6" class="i">+        &quot;delete_logged_message_button&quot;: &quot;Delete Logged Message&quot;
</a><a href="#h2-5-7" id="h2-5-7" class="i">+    },
</a><a href="#h2-5-8" id="h2-5-8" class="i">+
</a>     &quot;opera_context_menu&quot;: {
         &quot;download&quot;: &quot;Download Media&quot;
     },
<b>diff --git a/<a id="h3" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/bridge/common/impl/messagelogger/MessageLoggerRequest.kt</a></b>
<a href="#h3-0" id="h3-0" class="h">@@ -13,7 +13,7 @@ class MessageLoggerRequest(
</a>     override fun write(bundle: Bundle) {
         bundle.putString(&quot;action&quot;, action!!.name)
         bundle.putString(&quot;conversationId&quot;, conversationId)
<a href="#h3-0-3" id="h3-0-3" class="d">-        bundle.putLong(&quot;messageId&quot;, messageId!!)
</a><a href="#h3-0-4" id="h3-0-4" class="i">+        bundle.putLong(&quot;messageId&quot;, messageId ?: 0)
</a>         bundle.putByteArray(&quot;message&quot;, message)
     }
 
<b>diff --git a/<a id="h4" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigCategory.kt</a></b>
<a href="#h4-0" id="h4-0" class="h">@@ -3,13 +3,8 @@ package me.rhunk.snapenhance.config
</a> enum class ConfigCategory(
     val key: String
 ) {
<a href="#h4-0-3" id="h4-0-3" class="d">-    GENERAL(&quot;category.general&quot;),
</a><a href="#h4-0-4" id="h4-0-4" class="d">-    SPYING(&quot;category.spying&quot;),
</a><a href="#h4-0-5" id="h4-0-5" class="d">-    MEDIA_DOWNLOADER(&quot;category.media_download&quot;),
</a><a href="#h4-0-6" id="h4-0-6" class="d">-    PRIVACY(&quot;category.privacy&quot;),
</a><a href="#h4-0-7" id="h4-0-7" class="d">-    UI(&quot;category.ui&quot;),
</a><a href="#h4-0-8" id="h4-0-8" class="d">-    EXTRAS(&quot;category.extras&quot;),
</a><a href="#h4-0-9" id="h4-0-9" class="d">-    TWEAKS(&quot;category.tweaks&quot;),
</a><a href="#h4-0-10" id="h4-0-10" class="d">-    LOCATION_SPOOF(&quot;category.location_spoof&quot;),
</a><a href="#h4-0-11" id="h4-0-11" class="d">-    EXPERIMENTAL(&quot;category.experimental&quot;);
</a><a href="#h4-0-12" id="h4-0-12" class="i">+    SPYING_PRIVACY(&quot;category.spying_privacy&quot;),
</a><a href="#h4-0-13" id="h4-0-13" class="i">+    MEDIA_MANAGEMENT(&quot;category.media_manager&quot;),
</a><a href="#h4-0-14" id="h4-0-14" class="i">+    UI_TWEAKS(&quot;category.ui_tweaks&quot;),
</a><a href="#h4-0-15" id="h4-0-15" class="i">+    EXPERIMENTAL_DEBUGGING(&quot;category.experimental_debugging&quot;);
</a> }
<b>diff --git a/<a id="h5" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigProperty.kt</a></b>
<a href="#h5-0" id="h5-0" class="h">@@ -12,30 +12,45 @@ enum class ConfigProperty(
</a>     val nameKey: String,
     val descriptionKey: String,
     val category: ConfigCategory,
<a href="#h5-0-3" id="h5-0-3" class="d">-    val valueContainer: ConfigValue&lt;*&gt;
</a><a href="#h5-0-4" id="h5-0-4" class="i">+    val valueContainer: ConfigValue&lt;*&gt;,
</a><a href="#h5-0-5" id="h5-0-5" class="i">+    val shouldAppearInSettings: Boolean = true
</a> ) {
<a href="#h5-0-7" id="h5-0-7" class="i">+    
</a><a href="#h5-0-8" id="h5-0-8" class="i">+    //SPYING AND PRIVACY
</a><a href="#h5-0-9" id="h5-0-9" class="i">+    MESSAGE_LOGGER(&quot;property.message_logger&quot;,
</a><a href="#h5-0-10" id="h5-0-10" class="i">+        &quot;description.message_logger&quot;,
</a><a href="#h5-0-11" id="h5-0-11" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a><a href="#h5-0-12" id="h5-0-12" class="i">+        ConfigStateValue(false)
</a><a href="#h5-0-13" id="h5-0-13" class="i">+    ),
</a>     PREVENT_READ_RECEIPTS(
         &quot;property.prevent_read_receipts&quot;,
         &quot;description.prevent_read_receipts&quot;,
<a href="#h5-0-17" id="h5-0-17" class="d">-        ConfigCategory.SPYING,
</a><a href="#h5-0-18" id="h5-0-18" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
     HIDE_BITMOJI_PRESENCE(
         &quot;property.hide_bitmoji_presence&quot;,
         &quot;description.hide_bitmoji_presence&quot;,
<a href="#h5-0-24" id="h5-0-24" class="d">-        ConfigCategory.SPYING,
</a><a href="#h5-0-25" id="h5-0-25" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-0-28" id="h5-0-28" class="d">-    SHOW_MESSAGE_CONTENT_IN_NOTIFICATIONS(
</a><a href="#h5-0-29" id="h5-0-29" class="d">-        &quot;property.show_message_content_in_notifications&quot;,
</a><a href="#h5-0-30" id="h5-0-30" class="d">-        &quot;description.show_message_content_in_notifications&quot;,
</a><a href="#h5-0-31" id="h5-0-31" class="d">-        ConfigCategory.SPYING,
</a><a href="#h5-0-32" id="h5-0-32" class="d">-        ConfigStateValue(false)
</a><a href="#h5-0-33" id="h5-0-33" class="i">+    BETTER_NOTIFICATIONS(
</a><a href="#h5-0-34" id="h5-0-34" class="i">+        &quot;property.better_notifications&quot;,
</a><a href="#h5-0-35" id="h5-0-35" class="i">+        &quot;description.better_notifications&quot;,
</a><a href="#h5-0-36" id="h5-0-36" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a><a href="#h5-0-37" id="h5-0-37" class="i">+        ConfigStateListValue(
</a><a href="#h5-0-38" id="h5-0-38" class="i">+            listOf(&quot;snap&quot;, &quot;chat&quot;, &quot;reply_button&quot;),
</a><a href="#h5-0-39" id="h5-0-39" class="i">+            mutableMapOf(
</a><a href="#h5-0-40" id="h5-0-40" class="i">+                &quot;snap&quot; to false,
</a><a href="#h5-0-41" id="h5-0-41" class="i">+                &quot;chat&quot; to false,
</a><a href="#h5-0-42" id="h5-0-42" class="i">+                &quot;reply_button&quot; to false
</a><a href="#h5-0-43" id="h5-0-43" class="i">+            )
</a><a href="#h5-0-44" id="h5-0-44" class="i">+        )
</a>     ),
     NOTIFICATION_BLACKLIST(
         &quot;property.notification_blacklist&quot;,
         &quot;description.notification_blacklist&quot;,
<a href="#h5-0-49" id="h5-0-49" class="d">-        ConfigCategory.SPYING,
</a><a href="#h5-0-50" id="h5-0-50" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateListValue(
             listOf(&quot;snap&quot;, &quot;chat&quot;, &quot;typing&quot;),
             mutableMapOf(
<a href="#h5-1" id="h5-1" class="h">@@ -45,215 +60,227 @@ enum class ConfigProperty(
</a>             )
         )
     ),
<a href="#h5-1-3" id="h5-1-3" class="d">-
</a><a href="#h5-1-4" id="h5-1-4" class="d">-    MESSAGE_LOGGER(&quot;property.message_logger&quot;, &quot;description.message_logger&quot;, ConfigCategory.SPYING, ConfigStateValue(false)),
</a><a href="#h5-1-5" id="h5-1-5" class="d">-    UNLIMITED_SNAP_VIEW_TIME(&quot;property.unlimited_snap_view_time&quot;, &quot;description.unlimited_snap_view_time&quot;, ConfigCategory.SPYING, ConfigStateValue(false)),
</a><a href="#h5-1-6" id="h5-1-6" class="d">-
</a><a href="#h5-1-7" id="h5-1-7" class="d">-    SAVE_FOLDER(
</a><a href="#h5-1-8" id="h5-1-8" class="d">-        &quot;property.save_folder&quot;, &quot;description.save_folder&quot;, ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h5-1-9" id="h5-1-9" class="d">-        ConfigStringValue(File(
</a><a href="#h5-1-10" id="h5-1-10" class="d">-            Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM).absolutePath + &quot;/Snapchat&quot;,
</a><a href="#h5-1-11" id="h5-1-11" class="d">-            &quot;SnapEnhance&quot;
</a><a href="#h5-1-12" id="h5-1-12" class="d">-        ).absolutePath)
</a><a href="#h5-1-13" id="h5-1-13" class="d">-    ),
</a><a href="#h5-1-14" id="h5-1-14" class="d">-    AUTO_DOWNLOAD_SNAPS(
</a><a href="#h5-1-15" id="h5-1-15" class="d">-        &quot;property.auto_download_snaps&quot;,
</a><a href="#h5-1-16" id="h5-1-16" class="d">-        &quot;description.auto_download_snaps&quot;,
</a><a href="#h5-1-17" id="h5-1-17" class="d">-        ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h5-1-18" id="h5-1-18" class="d">-        ConfigStateValue(false)
</a><a href="#h5-1-19" id="h5-1-19" class="d">-    ),
</a><a href="#h5-1-20" id="h5-1-20" class="d">-    AUTO_DOWNLOAD_STORIES(
</a><a href="#h5-1-21" id="h5-1-21" class="d">-        &quot;property.auto_download_stories&quot;,
</a><a href="#h5-1-22" id="h5-1-22" class="d">-        &quot;description.auto_download_stories&quot;,
</a><a href="#h5-1-23" id="h5-1-23" class="d">-        ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h5-1-24" id="h5-1-24" class="i">+    DISABLE_METRICS(&quot;property.disable_metrics&quot;,
</a><a href="#h5-1-25" id="h5-1-25" class="i">+        &quot;description.disable_metrics&quot;,
</a><a href="#h5-1-26" id="h5-1-26" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-29" id="h5-1-29" class="d">-    AUTO_DOWNLOAD_PUBLIC_STORIES(
</a><a href="#h5-1-30" id="h5-1-30" class="d">-        &quot;property.auto_download_public_stories&quot;,
</a><a href="#h5-1-31" id="h5-1-31" class="d">-        &quot;description.auto_download_public_stories&quot;,
</a><a href="#h5-1-32" id="h5-1-32" class="d">-        ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h5-1-33" id="h5-1-33" class="i">+    BLOCK_ADS(&quot;property.block_ads&quot;,
</a><a href="#h5-1-34" id="h5-1-34" class="i">+        &quot;description.block_ads&quot;,
</a><a href="#h5-1-35" id="h5-1-35" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-38" id="h5-1-38" class="d">-    AUTO_DOWNLOAD_SPOTLIGHT(
</a><a href="#h5-1-39" id="h5-1-39" class="d">-        &quot;property.auto_download_spotlight&quot;,
</a><a href="#h5-1-40" id="h5-1-40" class="d">-        &quot;description.auto_download_spotlight&quot;,
</a><a href="#h5-1-41" id="h5-1-41" class="d">-        ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h5-1-42" id="h5-1-42" class="i">+    UNLIMITED_SNAP_VIEW_TIME(&quot;property.unlimited_snap_view_time&quot;,
</a><a href="#h5-1-43" id="h5-1-43" class="i">+        &quot;description.unlimited_snap_view_time&quot;,
</a><a href="#h5-1-44" id="h5-1-44" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-47" id="h5-1-47" class="d">-    DOWNLOAD_OPTIONS(
</a><a href="#h5-1-48" id="h5-1-48" class="d">-        &quot;property.download_options&quot;, &quot;description.download_options&quot;, ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h5-1-49" id="h5-1-49" class="d">-        ConfigStateListValue(
</a><a href="#h5-1-50" id="h5-1-50" class="d">-            listOf(&quot;format_user_folder&quot;, &quot;format_hash&quot;, &quot;format_date_time&quot;, &quot;format_username&quot;, &quot;merge_overlay&quot;),
</a><a href="#h5-1-51" id="h5-1-51" class="d">-            mutableMapOf(
</a><a href="#h5-1-52" id="h5-1-52" class="d">-                &quot;format_user_folder&quot; to true,
</a><a href="#h5-1-53" id="h5-1-53" class="d">-                &quot;format_hash&quot; to true,
</a><a href="#h5-1-54" id="h5-1-54" class="d">-                &quot;format_date_time&quot; to true,
</a><a href="#h5-1-55" id="h5-1-55" class="d">-                &quot;format_username&quot; to false,
</a><a href="#h5-1-56" id="h5-1-56" class="d">-                &quot;merge_overlay&quot; to false,
</a><a href="#h5-1-57" id="h5-1-57" class="d">-            )
</a><a href="#h5-1-58" id="h5-1-58" class="d">-        )
</a><a href="#h5-1-59" id="h5-1-59" class="d">-    ),
</a><a href="#h5-1-60" id="h5-1-60" class="d">-    DOWNLOAD_INCHAT_SNAPS(
</a><a href="#h5-1-61" id="h5-1-61" class="d">-        &quot;property.download_inchat_snaps&quot;,
</a><a href="#h5-1-62" id="h5-1-62" class="d">-        &quot;description.download_inchat_snaps&quot;,
</a><a href="#h5-1-63" id="h5-1-63" class="d">-        ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h5-1-64" id="h5-1-64" class="d">-        ConfigStateValue(false)
</a><a href="#h5-1-65" id="h5-1-65" class="d">-    ),
</a><a href="#h5-1-66" id="h5-1-66" class="d">-    ANTI_DOWNLOAD_BUTTON(
</a><a href="#h5-1-67" id="h5-1-67" class="d">-        &quot;property.anti_auto_download_button&quot;,
</a><a href="#h5-1-68" id="h5-1-68" class="d">-        &quot;description.anti_auto_download_button&quot;,
</a><a href="#h5-1-69" id="h5-1-69" class="d">-        ConfigCategory.MEDIA_DOWNLOADER,
</a><a href="#h5-1-70" id="h5-1-70" class="d">-        ConfigStateValue(false)
</a><a href="#h5-1-71" id="h5-1-71" class="d">-    ),
</a><a href="#h5-1-72" id="h5-1-72" class="d">-
</a><a href="#h5-1-73" id="h5-1-73" class="d">-    DISABLE_METRICS(&quot;property.disable_metrics&quot;, &quot;description.disable_metrics&quot;, ConfigCategory.PRIVACY, ConfigStateValue(false)),
</a>     PREVENT_SCREENSHOT_NOTIFICATIONS(
         &quot;property.prevent_screenshot_notifications&quot;,
         &quot;description.prevent_screenshot_notifications&quot;,
<a href="#h5-1-77" id="h5-1-77" class="d">-        ConfigCategory.PRIVACY,
</a><a href="#h5-1-78" id="h5-1-78" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
     PREVENT_STATUS_NOTIFICATIONS(
         &quot;property.prevent_status_notifications&quot;,
         &quot;description.prevent_status_notifications&quot;,
<a href="#h5-1-84" id="h5-1-84" class="d">-        ConfigCategory.PRIVACY,
</a><a href="#h5-1-85" id="h5-1-85" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
     ANONYMOUS_STORY_VIEW(
         &quot;property.anonymous_story_view&quot;,
         &quot;description.anonymous_story_view&quot;,
<a href="#h5-1-91" id="h5-1-91" class="d">-        ConfigCategory.PRIVACY,
</a><a href="#h5-1-92" id="h5-1-92" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
     HIDE_TYPING_NOTIFICATION(
         &quot;property.hide_typing_notification&quot;,
         &quot;description.hide_typing_notification&quot;,
<a href="#h5-1-98" id="h5-1-98" class="d">-        ConfigCategory.PRIVACY,
</a><a href="#h5-1-99" id="h5-1-99" class="i">+        ConfigCategory.SPYING_PRIVACY,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-102" id="h5-1-102" class="d">-
</a><a href="#h5-1-103" id="h5-1-103" class="d">-    MENU_SLOT_ID(&quot;property.menu_slot_id&quot;, &quot;description.menu_slot_id&quot;, ConfigCategory.UI, ConfigIntegerValue(1)),
</a><a href="#h5-1-104" id="h5-1-104" class="d">-    MESSAGE_PREVIEW_LENGTH(
</a><a href="#h5-1-105" id="h5-1-105" class="d">-        &quot;property.message_preview_length&quot;,
</a><a href="#h5-1-106" id="h5-1-106" class="d">-        &quot;description.message_preview_length&quot;,
</a><a href="#h5-1-107" id="h5-1-107" class="d">-        ConfigCategory.UI,
</a><a href="#h5-1-108" id="h5-1-108" class="d">-        ConfigIntegerValue(20)
</a><a href="#h5-1-109" id="h5-1-109" class="i">+    
</a><a href="#h5-1-110" id="h5-1-110" class="i">+    //MEDIA MANAGEMENT
</a><a href="#h5-1-111" id="h5-1-111" class="i">+    SAVE_FOLDER(
</a><a href="#h5-1-112" id="h5-1-112" class="i">+        &quot;property.save_folder&quot;, &quot;description.save_folder&quot;, ConfigCategory.MEDIA_MANAGEMENT,
</a><a href="#h5-1-113" id="h5-1-113" class="i">+        ConfigStringValue(File(
</a><a href="#h5-1-114" id="h5-1-114" class="i">+            Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM).absolutePath + &quot;/Snapchat&quot;,
</a><a href="#h5-1-115" id="h5-1-115" class="i">+            &quot;SnapEnhance&quot;
</a><a href="#h5-1-116" id="h5-1-116" class="i">+        ).absolutePath)
</a>     ),
<a href="#h5-1-118" id="h5-1-118" class="d">-
</a><a href="#h5-1-119" id="h5-1-119" class="d">-    AUTO_SAVE(&quot;property.auto_save&quot;, &quot;description.auto_save&quot;, ConfigCategory.EXTRAS, ConfigStateValue(false)),
</a><a href="#h5-1-120" id="h5-1-120" class="d">-    ANTI_AUTO_SAVE(&quot;property.anti_auto_save&quot;, &quot;description.anti_auto_save&quot;, ConfigCategory.EXTRAS, ConfigStateValue(false)),
</a><a href="#h5-1-121" id="h5-1-121" class="d">-    SNAPCHAT_PLUS(&quot;property.snapchat_plus&quot;, &quot;description.snapchat_plus&quot;, ConfigCategory.EXTRAS, ConfigStateValue(false)),
</a><a href="#h5-1-122" id="h5-1-122" class="d">-    DISABLE_SNAP_SPLITTING(
</a><a href="#h5-1-123" id="h5-1-123" class="d">-        &quot;property.disable_snap_splitting&quot;,
</a><a href="#h5-1-124" id="h5-1-124" class="d">-        &quot;description.disable_snap_splitting&quot;,
</a><a href="#h5-1-125" id="h5-1-125" class="d">-        ConfigCategory.EXTRAS,
</a><a href="#h5-1-126" id="h5-1-126" class="i">+    AUTO_DOWNLOAD_OPTIONS(
</a><a href="#h5-1-127" id="h5-1-127" class="i">+        &quot;property.auto_download_options&quot;, &quot;description.auto_download_options&quot;, ConfigCategory.MEDIA_MANAGEMENT,
</a><a href="#h5-1-128" id="h5-1-128" class="i">+        ConfigStateListValue(
</a><a href="#h5-1-129" id="h5-1-129" class="i">+            listOf(&quot;friend_snaps&quot;, &quot;friend_stories&quot;, &quot;public_stories&quot;, &quot;spotlight&quot;),
</a><a href="#h5-1-130" id="h5-1-130" class="i">+            mutableMapOf(
</a><a href="#h5-1-131" id="h5-1-131" class="i">+                &quot;friend_snaps&quot; to false,
</a><a href="#h5-1-132" id="h5-1-132" class="i">+                &quot;friend_stories&quot; to false,
</a><a href="#h5-1-133" id="h5-1-133" class="i">+                &quot;public_stories&quot; to false,
</a><a href="#h5-1-134" id="h5-1-134" class="i">+                &quot;spotlight&quot; to false
</a><a href="#h5-1-135" id="h5-1-135" class="i">+            )
</a><a href="#h5-1-136" id="h5-1-136" class="i">+        )
</a><a href="#h5-1-137" id="h5-1-137" class="i">+    ),
</a><a href="#h5-1-138" id="h5-1-138" class="i">+    DOWNLOAD_OPTIONS(
</a><a href="#h5-1-139" id="h5-1-139" class="i">+        &quot;property.download_options&quot;, &quot;description.download_options&quot;, ConfigCategory.MEDIA_MANAGEMENT,
</a><a href="#h5-1-140" id="h5-1-140" class="i">+        ConfigStateListValue(
</a><a href="#h5-1-141" id="h5-1-141" class="i">+            listOf(&quot;format_user_folder&quot;, &quot;format_hash&quot;, &quot;format_date_time&quot;, &quot;format_username&quot;, &quot;merge_overlay&quot;),
</a><a href="#h5-1-142" id="h5-1-142" class="i">+            mutableMapOf(
</a><a href="#h5-1-143" id="h5-1-143" class="i">+                &quot;format_user_folder&quot; to true,
</a><a href="#h5-1-144" id="h5-1-144" class="i">+                &quot;format_hash&quot; to true,
</a><a href="#h5-1-145" id="h5-1-145" class="i">+                &quot;format_date_time&quot; to true,
</a><a href="#h5-1-146" id="h5-1-146" class="i">+                &quot;format_username&quot; to false,
</a><a href="#h5-1-147" id="h5-1-147" class="i">+                &quot;merge_overlay&quot; to false,
</a><a href="#h5-1-148" id="h5-1-148" class="i">+            )
</a><a href="#h5-1-149" id="h5-1-149" class="i">+        )
</a><a href="#h5-1-150" id="h5-1-150" class="i">+    ),
</a><a href="#h5-1-151" id="h5-1-151" class="i">+    CHAT_DOWNLOAD_CONTEXT_MENU(
</a><a href="#h5-1-152" id="h5-1-152" class="i">+        &quot;property.chat_download_context_menu&quot;,
</a><a href="#h5-1-153" id="h5-1-153" class="i">+        &quot;description.chat_download_context_menu&quot;,
</a><a href="#h5-1-154" id="h5-1-154" class="i">+        ConfigCategory.MEDIA_MANAGEMENT,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-157" id="h5-1-157" class="d">-    DISABLE_VIDEO_LENGTH_RESTRICTION(
</a><a href="#h5-1-158" id="h5-1-158" class="d">-        &quot;property.disable_video_length_restriction&quot;,
</a><a href="#h5-1-159" id="h5-1-159" class="d">-        &quot;description.disable_video_length_restriction&quot;,
</a><a href="#h5-1-160" id="h5-1-160" class="d">-        ConfigCategory.EXTRAS,
</a><a href="#h5-1-161" id="h5-1-161" class="i">+    DOWNLOAD_BLACKLIST(
</a><a href="#h5-1-162" id="h5-1-162" class="i">+        &quot;property.auto_download_blacklist&quot;,
</a><a href="#h5-1-163" id="h5-1-163" class="i">+        &quot;description.auto_download_blacklist&quot;,
</a><a href="#h5-1-164" id="h5-1-164" class="i">+        ConfigCategory.MEDIA_MANAGEMENT,
</a><a href="#h5-1-165" id="h5-1-165" class="i">+        ConfigStateValue(false)
</a><a href="#h5-1-166" id="h5-1-166" class="i">+    ),
</a><a href="#h5-1-167" id="h5-1-167" class="i">+    GALLERY_MEDIA_SEND_OVERRIDE(
</a><a href="#h5-1-168" id="h5-1-168" class="i">+        &quot;property.gallery_media_send_override&quot;,
</a><a href="#h5-1-169" id="h5-1-169" class="i">+        &quot;description.gallery_media_send_override&quot;,
</a><a href="#h5-1-170" id="h5-1-170" class="i">+        ConfigCategory.MEDIA_MANAGEMENT,
</a><a href="#h5-1-171" id="h5-1-171" class="i">+        ConfigStateSelection(
</a><a href="#h5-1-172" id="h5-1-172" class="i">+            listOf(&quot;OFF&quot;, &quot;NOTE&quot;, &quot;SNAP&quot;, &quot;LIVE_SNAP&quot;),
</a><a href="#h5-1-173" id="h5-1-173" class="i">+            &quot;OFF&quot;
</a><a href="#h5-1-174" id="h5-1-174" class="i">+        )
</a><a href="#h5-1-175" id="h5-1-175" class="i">+    ),
</a><a href="#h5-1-176" id="h5-1-176" class="i">+    AUTO_SAVE_MESSAGES(&quot;property.auto_save_messages&quot;,
</a><a href="#h5-1-177" id="h5-1-177" class="i">+        &quot;description.auto_save_messages&quot;,
</a><a href="#h5-1-178" id="h5-1-178" class="i">+        ConfigCategory.MEDIA_MANAGEMENT,
</a><a href="#h5-1-179" id="h5-1-179" class="i">+        ConfigStateListValue(
</a><a href="#h5-1-180" id="h5-1-180" class="i">+            listOf(&quot;CHAT&quot;, &quot;SNAP&quot;, &quot;NOTE&quot;, &quot;EXTERNAL_MEDIA&quot;, &quot;STICKER&quot;)
</a><a href="#h5-1-181" id="h5-1-181" class="i">+        )
</a><a href="#h5-1-182" id="h5-1-182" class="i">+    ),
</a><a href="#h5-1-183" id="h5-1-183" class="i">+    ANTI_AUTO_SAVE(&quot;property.anti_auto_save&quot;,
</a><a href="#h5-1-184" id="h5-1-184" class="i">+        &quot;description.anti_auto_save&quot;,
</a><a href="#h5-1-185" id="h5-1-185" class="i">+        ConfigCategory.MEDIA_MANAGEMENT,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-188" id="h5-1-188" class="i">+    
</a>     OVERRIDE_MEDIA_QUALITY(
         &quot;property.override_media_quality&quot;,
         &quot;description.override_media_quality&quot;,
<a href="#h5-1-192" id="h5-1-192" class="d">-        ConfigCategory.EXTRAS,
</a><a href="#h5-1-193" id="h5-1-193" class="i">+        ConfigCategory.MEDIA_MANAGEMENT,
</a>         ConfigStateValue(false)
     ),
     MEDIA_QUALITY_LEVEL(
         &quot;property.media_quality_level&quot;,
         &quot;description.media_quality_level&quot;,
<a href="#h5-1-199" id="h5-1-199" class="d">-        ConfigCategory.EXTRAS,
</a><a href="#h5-1-200" id="h5-1-200" class="i">+        ConfigCategory.MEDIA_MANAGEMENT,
</a>         ConfigStateSelection(
             listOf(&quot;LEVEL_NONE&quot;, &quot;LEVEL_1&quot;, &quot;LEVEL_2&quot;, &quot;LEVEL_3&quot;, &quot;LEVEL_4&quot;, &quot;LEVEL_5&quot;, &quot;LEVEL_6&quot;, &quot;LEVEL_7&quot;, &quot;LEVEL_MAX&quot;),
             &quot;LEVEL_NONE&quot;
         )
     ),
<a href="#h5-1-206" id="h5-1-206" class="d">-    GALLERY_MEDIA_SEND_OVERRIDE(
</a><a href="#h5-1-207" id="h5-1-207" class="d">-        &quot;property.gallery_media_send_override&quot;,
</a><a href="#h5-1-208" id="h5-1-208" class="d">-        &quot;description.gallery_media_send_override&quot;,
</a><a href="#h5-1-209" id="h5-1-209" class="d">-        ConfigCategory.EXTRAS,
</a><a href="#h5-1-210" id="h5-1-210" class="d">-        ConfigStateSelection(
</a><a href="#h5-1-211" id="h5-1-211" class="d">-            listOf(&quot;OFF&quot;, &quot;NOTE&quot;, &quot;SNAP&quot;, &quot;LIVE_SNAP&quot;),
</a><a href="#h5-1-212" id="h5-1-212" class="d">-            &quot;OFF&quot;
</a><a href="#h5-1-213" id="h5-1-213" class="i">+    
</a><a href="#h5-1-214" id="h5-1-214" class="i">+    //UI AND TWEAKS
</a><a href="#h5-1-215" id="h5-1-215" class="i">+    HIDE_UI_ELEMENTS(
</a><a href="#h5-1-216" id="h5-1-216" class="i">+        &quot;property.hide_ui_elements&quot;,
</a><a href="#h5-1-217" id="h5-1-217" class="i">+        &quot;description.hide_ui_elements&quot;,
</a><a href="#h5-1-218" id="h5-1-218" class="i">+        ConfigCategory.UI_TWEAKS,
</a><a href="#h5-1-219" id="h5-1-219" class="i">+        ConfigStateListValue(
</a><a href="#h5-1-220" id="h5-1-220" class="i">+            listOf(&quot;remove_voice_record_button&quot;, &quot;remove_stickers_button&quot;, &quot;remove_cognac_button&quot;, &quot;remove_call_buttons&quot;),
</a><a href="#h5-1-221" id="h5-1-221" class="i">+            mutableMapOf(
</a><a href="#h5-1-222" id="h5-1-222" class="i">+                &quot;remove_voice_record_button&quot; to false,
</a><a href="#h5-1-223" id="h5-1-223" class="i">+                &quot;remove_stickers_button&quot; to false,
</a><a href="#h5-1-224" id="h5-1-224" class="i">+                &quot;remove_cognac_button&quot; to false,
</a><a href="#h5-1-225" id="h5-1-225" class="i">+                &quot;remove_call_buttons&quot; to false,
</a><a href="#h5-1-226" id="h5-1-226" class="i">+            )
</a>         )
     ),
<a href="#h5-1-229" id="h5-1-229" class="d">-
</a><a href="#h5-1-230" id="h5-1-230" class="d">-    REMOVE_VOICE_RECORD_BUTTON(
</a><a href="#h5-1-231" id="h5-1-231" class="d">-        &quot;property.remove_voice_record_button&quot;,
</a><a href="#h5-1-232" id="h5-1-232" class="d">-        &quot;description.remove_voice_record_button&quot;,
</a><a href="#h5-1-233" id="h5-1-233" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h5-1-234" id="h5-1-234" class="i">+    STREAK_EXPIRATION_INFO(
</a><a href="#h5-1-235" id="h5-1-235" class="i">+        &quot;property.streak_expiration_info&quot;,
</a><a href="#h5-1-236" id="h5-1-236" class="i">+        &quot;description.streakexpirationinfo&quot;,
</a><a href="#h5-1-237" id="h5-1-237" class="i">+        ConfigCategory.UI_TWEAKS,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-240" id="h5-1-240" class="d">-    REMOVE_STICKERS_BUTTON(
</a><a href="#h5-1-241" id="h5-1-241" class="d">-        &quot;property.remove_stickers_button&quot;,
</a><a href="#h5-1-242" id="h5-1-242" class="d">-        &quot;description.remove_stickers_button&quot;,
</a><a href="#h5-1-243" id="h5-1-243" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h5-1-244" id="h5-1-244" class="i">+    DISABLE_SNAP_SPLITTING(
</a><a href="#h5-1-245" id="h5-1-245" class="i">+        &quot;property.disable_snap_splitting&quot;,
</a><a href="#h5-1-246" id="h5-1-246" class="i">+        &quot;description.disable_snap_splitting&quot;,
</a><a href="#h5-1-247" id="h5-1-247" class="i">+        ConfigCategory.UI_TWEAKS,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-250" id="h5-1-250" class="d">-    REMOVE_COGNAC_BUTTON(
</a><a href="#h5-1-251" id="h5-1-251" class="d">-        &quot;property.remove_cognac_button&quot;,
</a><a href="#h5-1-252" id="h5-1-252" class="d">-        &quot;description.remove_cognac_button&quot;,
</a><a href="#h5-1-253" id="h5-1-253" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h5-1-254" id="h5-1-254" class="i">+    DISABLE_VIDEO_LENGTH_RESTRICTION(
</a><a href="#h5-1-255" id="h5-1-255" class="i">+        &quot;property.disable_video_length_restriction&quot;,
</a><a href="#h5-1-256" id="h5-1-256" class="i">+        &quot;description.disable_video_length_restriction&quot;,
</a><a href="#h5-1-257" id="h5-1-257" class="i">+        ConfigCategory.UI_TWEAKS,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-260" id="h5-1-260" class="d">-    REMOVE_CALL_BUTTONS(
</a><a href="#h5-1-261" id="h5-1-261" class="d">-        &quot;property.remove_call_buttons&quot;,
</a><a href="#h5-1-262" id="h5-1-262" class="d">-        &quot;description.remove_call_buttons&quot;,
</a><a href="#h5-1-263" id="h5-1-263" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h5-1-264" id="h5-1-264" class="i">+    SNAPCHAT_PLUS(&quot;property.snapchat_plus&quot;,
</a><a href="#h5-1-265" id="h5-1-265" class="i">+        &quot;description.snapchat_plus&quot;,
</a><a href="#h5-1-266" id="h5-1-266" class="i">+        ConfigCategory.UI_TWEAKS,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-269" id="h5-1-269" class="d">-    BLOCK_ADS(&quot;property.block_ads&quot;, &quot;description.block_ads&quot;, ConfigCategory.TWEAKS, ConfigStateValue(false)),
</a><a href="#h5-1-270" id="h5-1-270" class="d">-    STREAK_EXPIRATION_INFO(
</a><a href="#h5-1-271" id="h5-1-271" class="d">-        &quot;property.streak_expiration_info&quot;,
</a><a href="#h5-1-272" id="h5-1-272" class="d">-        &quot;description.streakexpirationinfo&quot;,
</a><a href="#h5-1-273" id="h5-1-273" class="d">-        ConfigCategory.TWEAKS,
</a><a href="#h5-1-274" id="h5-1-274" class="i">+    NEW_MAP_UI(&quot;property.new_map_ui&quot;,
</a><a href="#h5-1-275" id="h5-1-275" class="i">+        &quot;description.new_map_ui&quot;,
</a><a href="#h5-1-276" id="h5-1-276" class="i">+        ConfigCategory.UI_TWEAKS,
</a>         ConfigStateValue(false)
     ),
<a href="#h5-1-279" id="h5-1-279" class="d">-    NEW_MAP_UI(&quot;property.new_map_ui&quot;, &quot;description.new_map_ui&quot;, ConfigCategory.TWEAKS, ConfigStateValue(false)),
</a><a href="#h5-1-280" id="h5-1-280" class="d">-
</a>     LOCATION_SPOOF(
         &quot;property.location_spoof&quot;,
         &quot;description.location_spoof&quot;,
<a href="#h5-1-284" id="h5-1-284" class="d">-        ConfigCategory.LOCATION_SPOOF,
</a><a href="#h5-1-285" id="h5-1-285" class="i">+        ConfigCategory.UI_TWEAKS,
</a>         ConfigStateValue(false)
     ),
     LATITUDE(
         &quot;property.latitude_value&quot;,
         &quot;description.latitude_value&quot;,
<a href="#h5-1-291" id="h5-1-291" class="d">-        ConfigCategory.LOCATION_SPOOF,
</a><a href="#h5-1-292" id="h5-1-292" class="d">-        ConfigStringValue(&quot;0.0000&quot;)
</a><a href="#h5-1-293" id="h5-1-293" class="i">+        ConfigCategory.UI_TWEAKS,
</a><a href="#h5-1-294" id="h5-1-294" class="i">+        ConfigStringValue(&quot;0.0000&quot;),
</a><a href="#h5-1-295" id="h5-1-295" class="i">+        shouldAppearInSettings = false
</a>     ),
     LONGITUDE(
         &quot;property.longitude_value&quot;,
         &quot;description.longitude_value&quot;,
<a href="#h5-1-300" id="h5-1-300" class="d">-        ConfigCategory.LOCATION_SPOOF,
</a><a href="#h5-1-301" id="h5-1-301" class="d">-        ConfigStringValue(&quot;0.0000&quot;)
</a><a href="#h5-1-302" id="h5-1-302" class="i">+        ConfigCategory.UI_TWEAKS,
</a><a href="#h5-1-303" id="h5-1-303" class="i">+        ConfigStringValue(&quot;0.0000&quot;),
</a><a href="#h5-1-304" id="h5-1-304" class="i">+        shouldAppearInSettings = false
</a>     ),
<a href="#h5-1-306" id="h5-1-306" class="d">-
</a><a href="#h5-1-307" id="h5-1-307" class="i">+    MENU_SLOT_ID(&quot;property.menu_slot_id&quot;,
</a><a href="#h5-1-308" id="h5-1-308" class="i">+        &quot;description.menu_slot_id&quot;,
</a><a href="#h5-1-309" id="h5-1-309" class="i">+        ConfigCategory.UI_TWEAKS,
</a><a href="#h5-1-310" id="h5-1-310" class="i">+        ConfigIntegerValue(1)
</a><a href="#h5-1-311" id="h5-1-311" class="i">+    ),
</a><a href="#h5-1-312" id="h5-1-312" class="i">+    MESSAGE_PREVIEW_LENGTH(
</a><a href="#h5-1-313" id="h5-1-313" class="i">+        &quot;property.message_preview_length&quot;,
</a><a href="#h5-1-314" id="h5-1-314" class="i">+        &quot;description.message_preview_length&quot;,
</a><a href="#h5-1-315" id="h5-1-315" class="i">+        ConfigCategory.UI_TWEAKS,
</a><a href="#h5-1-316" id="h5-1-316" class="i">+        ConfigIntegerValue(20)
</a><a href="#h5-1-317" id="h5-1-317" class="i">+    ),
</a><a href="#h5-1-318" id="h5-1-318" class="i">+    
</a><a href="#h5-1-319" id="h5-1-319" class="i">+    // EXPERIMENTAL DEBUGGING
</a>     USE_DOWNLOAD_MANAGER(
         &quot;property.use_download_manager&quot;,
         &quot;description.use_download_manager&quot;,
<a href="#h5-1-323" id="h5-1-323" class="d">-        ConfigCategory.EXPERIMENTAL,
</a><a href="#h5-1-324" id="h5-1-324" class="i">+        ConfigCategory.EXPERIMENTAL_DEBUGGING,
</a>         ConfigStateValue(false)
     ),
     APP_PASSCODE(
         &quot;property.app_passcode&quot;,
         &quot;description.app_passcode&quot;,
<a href="#h5-1-330" id="h5-1-330" class="d">-        ConfigCategory.EXPERIMENTAL,
</a><a href="#h5-1-331" id="h5-1-331" class="d">-        ConfigStringValue(&quot;&quot;)
</a><a href="#h5-1-332" id="h5-1-332" class="i">+        ConfigCategory.EXPERIMENTAL_DEBUGGING,
</a><a href="#h5-1-333" id="h5-1-333" class="i">+        ConfigStringValue(&quot;&quot;, isHidden = true)
</a>     ),
     APP_LOCK_ON_RESUME(
         &quot;property.app_lock_on_resume&quot;,
         &quot;description.app_lock_on_resume&quot;,
<a href="#h5-1-338" id="h5-1-338" class="d">-        ConfigCategory.EXPERIMENTAL,
</a><a href="#h5-1-339" id="h5-1-339" class="i">+        ConfigCategory.EXPERIMENTAL_DEBUGGING,
</a>         ConfigStateValue(false)
     ),
     MEO_PASSCODE_BYPASS(
     &quot;property.meo_passcode_bypass&quot;,
     &quot;description.meo_passcode_bypass&quot;,
<a href="#h5-1-345" id="h5-1-345" class="d">-        ConfigCategory.EXPERIMENTAL,
</a><a href="#h5-1-346" id="h5-1-346" class="i">+        ConfigCategory.EXPERIMENTAL_DEBUGGING,
</a>         ConfigStateValue(false)
     );
 
<b>diff --git a/<a id="h6" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/ConfigValue.kt</a></b>
<a href="#h6-0" id="h6-0" class="h">@@ -1,7 +1,22 @@
</a> package me.rhunk.snapenhance.config
 
 abstract class ConfigValue&lt;T&gt; {
<a href="#h6-0-3" id="h6-0-3" class="i">+    private val propertyChangeListeners = mutableListOf&lt;(T) -&gt; Unit&gt;()
</a><a href="#h6-0-4" id="h6-0-4" class="i">+
</a><a href="#h6-0-5" id="h6-0-5" class="i">+    fun addPropertyChangeListener(listener: (T) -&gt; Unit) = propertyChangeListeners.add(listener)
</a><a href="#h6-0-6" id="h6-0-6" class="i">+    fun removePropertyChangeListener(listener: (T) -&gt; Unit) = propertyChangeListeners.remove(listener)
</a><a href="#h6-0-7" id="h6-0-7" class="i">+
</a>     abstract fun value(): T
<a href="#h6-0-9" id="h6-0-9" class="d">-    abstract fun write(): String
</a><a href="#h6-0-10" id="h6-0-10" class="d">-    abstract fun read(value: String)
</a><a href="#h6-0-11" id="h6-0-11" class="i">+    abstract fun read(): String
</a><a href="#h6-0-12" id="h6-0-12" class="i">+    protected abstract fun write(value: String)
</a><a href="#h6-0-13" id="h6-0-13" class="i">+
</a><a href="#h6-0-14" id="h6-0-14" class="i">+    protected fun onValueChanged() {
</a><a href="#h6-0-15" id="h6-0-15" class="i">+        propertyChangeListeners.forEach { it(value()) }
</a><a href="#h6-0-16" id="h6-0-16" class="i">+    }
</a><a href="#h6-0-17" id="h6-0-17" class="i">+
</a><a href="#h6-0-18" id="h6-0-18" class="i">+    fun writeFrom(value: String) {
</a><a href="#h6-0-19" id="h6-0-19" class="i">+        val oldValue = read()
</a><a href="#h6-0-20" id="h6-0-20" class="i">+        write(value)
</a><a href="#h6-0-21" id="h6-0-21" class="i">+        if (oldValue != value) onValueChanged()
</a><a href="#h6-0-22" id="h6-0-22" class="i">+    }
</a> } 
\ No newline at end of file
<b>diff --git a/<a id="h7" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigIntegerValue.kt</a></b>
<a href="#h7-0" id="h7-0" class="h">@@ -3,15 +3,15 @@ package me.rhunk.snapenhance.config.impl
</a> import me.rhunk.snapenhance.config.ConfigValue
 
 class ConfigIntegerValue(
<a href="#h7-0-3" id="h7-0-3" class="d">-    var value: Int
</a><a href="#h7-0-4" id="h7-0-4" class="i">+    private var value: Int
</a> ) : ConfigValue&lt;Int&gt;() {
     override fun value() = value
 
<a href="#h7-0-8" id="h7-0-8" class="d">-    override fun write(): String {
</a><a href="#h7-0-9" id="h7-0-9" class="i">+    override fun read(): String {
</a>         return value.toString()
     }
 
<a href="#h7-0-13" id="h7-0-13" class="d">-    override fun read(value: String) {
</a><a href="#h7-0-14" id="h7-0-14" class="i">+    override fun write(value: String) {
</a>         this.value = value.toInt()
     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h8" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateListValue.kt</a></b>
<a href="#h8-0" id="h8-0" class="h">@@ -4,17 +4,22 @@ import me.rhunk.snapenhance.config.ConfigValue
</a> 
 class ConfigStateListValue(
     private val keys: List&lt;String&gt;,
<a href="#h8-0-3" id="h8-0-3" class="d">-    var states: MutableMap&lt;String, Boolean&gt; = mutableMapOf()
</a><a href="#h8-0-4" id="h8-0-4" class="i">+    private var states: MutableMap&lt;String, Boolean&gt; = mutableMapOf()
</a> ) : ConfigValue&lt;Map&lt;String, Boolean&gt;&gt;() {
     override fun value() = states
 
<a href="#h8-0-8" id="h8-0-8" class="d">-    fun value(key: String) = states[key] ?: false
</a><a href="#h8-0-9" id="h8-0-9" class="i">+    fun setKey(key: String, state: Boolean) {
</a><a href="#h8-0-10" id="h8-0-10" class="i">+        states[key] = state
</a><a href="#h8-0-11" id="h8-0-11" class="i">+        onValueChanged()
</a><a href="#h8-0-12" id="h8-0-12" class="i">+    }
</a><a href="#h8-0-13" id="h8-0-13" class="i">+
</a><a href="#h8-0-14" id="h8-0-14" class="i">+    operator fun get(key: String) = states[key] ?: false
</a> 
<a href="#h8-0-16" id="h8-0-16" class="d">-    override fun write(): String {
</a><a href="#h8-0-17" id="h8-0-17" class="i">+    override fun read(): String {
</a>         return keys.joinToString(&quot;|&quot;) { &quot;$it:${states[it]}&quot; }
     }
 
<a href="#h8-0-21" id="h8-0-21" class="d">-    override fun read(value: String) {
</a><a href="#h8-0-22" id="h8-0-22" class="i">+    override fun write(value: String) {
</a>         value.split(&quot;|&quot;).forEach {
             val (key, state) = it.split(&quot;:&quot;)
             states[key] = state.toBoolean()
<b>diff --git a/<a id="h9" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateSelection.kt</a></b>
<a href="#h9-0" id="h9-0" class="h">@@ -4,25 +4,19 @@ import me.rhunk.snapenhance.config.ConfigValue
</a> 
 class ConfigStateSelection(
     private val keys: List&lt;String&gt;,
<a href="#h9-0-3" id="h9-0-3" class="d">-    var state: String = &quot;&quot;
</a><a href="#h9-0-4" id="h9-0-4" class="i">+    private var state: String = &quot;&quot;
</a> ) : ConfigValue&lt;String&gt;() {
<a href="#h9-0-6" id="h9-0-6" class="d">-
</a>     fun keys(): List&lt;String&gt; {
         return keys
     }
<a href="#h9-0-10" id="h9-0-10" class="d">-    override fun value(): String {
</a><a href="#h9-0-11" id="h9-0-11" class="d">-        return state
</a><a href="#h9-0-12" id="h9-0-12" class="d">-    }
</a> 
<a href="#h9-0-14" id="h9-0-14" class="d">-    fun value(key: String) {
</a><a href="#h9-0-15" id="h9-0-15" class="d">-        state = key
</a><a href="#h9-0-16" id="h9-0-16" class="d">-    }
</a><a href="#h9-0-17" id="h9-0-17" class="i">+    override fun value() = state
</a> 
<a href="#h9-0-19" id="h9-0-19" class="d">-    override fun write(): String {
</a><a href="#h9-0-20" id="h9-0-20" class="i">+    override fun read(): String {
</a>         return state
     }
 
<a href="#h9-0-24" id="h9-0-24" class="d">-    override fun read(value: String) {
</a><a href="#h9-0-25" id="h9-0-25" class="i">+    override fun write(value: String) {
</a>         state = value
     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h10" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStateValue.kt</a></b>
<a href="#h10-0" id="h10-0" class="h">@@ -3,15 +3,15 @@ package me.rhunk.snapenhance.config.impl
</a> import me.rhunk.snapenhance.config.ConfigValue
 
 class ConfigStateValue(
<a href="#h10-0-3" id="h10-0-3" class="d">-    var value: Boolean
</a><a href="#h10-0-4" id="h10-0-4" class="i">+    private var value: Boolean
</a> ) : ConfigValue&lt;Boolean&gt;() {
     override fun value() = value
 
<a href="#h10-0-8" id="h10-0-8" class="d">-    override fun write(): String {
</a><a href="#h10-0-9" id="h10-0-9" class="i">+    override fun read(): String {
</a>         return value.toString()
     }
 
<a href="#h10-0-13" id="h10-0-13" class="d">-    override fun read(value: String) {
</a><a href="#h10-0-14" id="h10-0-14" class="i">+    override fun write(value: String) {
</a>         this.value = value.toBoolean()
     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h11" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/config/impl/ConfigStringValue.kt</a></b>
<a href="#h11-0" id="h11-0" class="h">@@ -3,15 +3,18 @@ package me.rhunk.snapenhance.config.impl
</a> import me.rhunk.snapenhance.config.ConfigValue
 
 class ConfigStringValue(
<a href="#h11-0-3" id="h11-0-3" class="d">-    var value: String = &quot;&quot;
</a><a href="#h11-0-4" id="h11-0-4" class="i">+    private var value: String = &quot;&quot;,
</a><a href="#h11-0-5" id="h11-0-5" class="i">+    val isHidden: Boolean = false
</a> ) : ConfigValue&lt;String&gt;() {
     override fun value() = value
 
<a href="#h11-0-9" id="h11-0-9" class="d">-    override fun write(): String {
</a><a href="#h11-0-10" id="h11-0-10" class="i">+    fun hiddenValue() = if (isHidden) value.map { &#39;*&#39; }.joinToString(&quot;&quot;) else value
</a><a href="#h11-0-11" id="h11-0-11" class="i">+
</a><a href="#h11-0-12" id="h11-0-12" class="i">+    override fun read(): String {
</a>         return value
     }
 
<a href="#h11-0-16" id="h11-0-16" class="d">-    override fun read(value: String) {
</a><a href="#h11-0-17" id="h11-0-17" class="i">+    override fun write(value: String) {
</a>         this.value = value
     }
 } 
\ No newline at end of file
<b>diff --git a/<a id="h12" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/downloader/MediaDownloader.kt</a></b>
<a href="#h12-0" id="h12-0" class="h">@@ -60,7 +60,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>     }
 
     private fun canMergeOverlay(): Boolean {
<a href="#h12-0-3" id="h12-0-3" class="d">-        if (context.config.options(ConfigProperty.DOWNLOAD_OPTIONS)[&quot;overlay_merge&quot;] == false) return false
</a><a href="#h12-0-4" id="h12-0-4" class="i">+        if (context.config.options(ConfigProperty.DOWNLOAD_OPTIONS)[&quot;merge_overlay&quot;] == false) return false
</a>         return isFFmpegPresent
     }
 
<a href="#h12-1" id="h12-1" class="h">@@ -228,9 +228,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>         forceDownload: Boolean
     ) {
         //messages
<a href="#h12-1-3" id="h12-1-3" class="d">-        if (paramMap.containsKey(&quot;MESSAGE_ID&quot;) &amp;&amp;
</a><a href="#h12-1-4" id="h12-1-4" class="d">-            (forceDownload || context.config.bool(ConfigProperty.AUTO_DOWNLOAD_SNAPS))) {
</a><a href="#h12-1-5" id="h12-1-5" class="d">-            val id = paramMap[&quot;MESSAGE_ID&quot;].toString()
</a><a href="#h12-1-6" id="h12-1-6" class="i">+        paramMap[&quot;MESSAGE_ID&quot;]?.toString()?.takeIf { forceDownload || canAutoDownload(&quot;friend_snaps&quot;) }?.let { id -&gt;
</a>             val messageId = id.substring(id.lastIndexOf(&quot;:&quot;) + 1).toLong()
             val senderId: String = context.database.getConversationMessageFromId(messageId)!!.sender_id!!
 
<a href="#h12-2" id="h12-2" class="h">@@ -244,23 +242,25 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>         }
 
         //private stories
<a href="#h12-2-3" id="h12-2-3" class="d">-        val playlistV2Group =
</a><a href="#h12-2-4" id="h12-2-4" class="d">-            if (paramMap.containsKey(&quot;PLAYLIST_V2_GROUP&quot;)) paramMap[&quot;PLAYLIST_V2_GROUP&quot;].toString() else null
</a><a href="#h12-2-5" id="h12-2-5" class="d">-        if (playlistV2Group != null &amp;&amp;
</a><a href="#h12-2-6" id="h12-2-6" class="d">-            playlistV2Group.contains(&quot;storyUserId=&quot;) &amp;&amp;
</a><a href="#h12-2-7" id="h12-2-7" class="d">-            (forceDownload || context.config.bool(ConfigProperty.AUTO_DOWNLOAD_STORIES))
</a><a href="#h12-2-8" id="h12-2-8" class="d">-        ) {
</a><a href="#h12-2-9" id="h12-2-9" class="d">-            val storyIdStartIndex = playlistV2Group.indexOf(&quot;storyUserId=&quot;) + 12
</a><a href="#h12-2-10" id="h12-2-10" class="d">-            val storyUserId = playlistV2Group.substring(storyIdStartIndex, playlistV2Group.indexOf(&quot;,&quot;, storyIdStartIndex))
</a><a href="#h12-2-11" id="h12-2-11" class="i">+        paramMap[&quot;PLAYLIST_V2_GROUP&quot;]?.toString()?.takeIf {
</a><a href="#h12-2-12" id="h12-2-12" class="i">+            it.contains(&quot;storyUserId=&quot;) &amp;&amp; (forceDownload || canAutoDownload(&quot;friend_stories&quot;))
</a><a href="#h12-2-13" id="h12-2-13" class="i">+        }?.let { playlistGroup -&gt;
</a><a href="#h12-2-14" id="h12-2-14" class="i">+            val storyIdStartIndex = playlistGroup.indexOf(&quot;storyUserId=&quot;) + 12
</a><a href="#h12-2-15" id="h12-2-15" class="i">+            val storyUserId = playlistGroup.substring(
</a><a href="#h12-2-16" id="h12-2-16" class="i">+                storyIdStartIndex,
</a><a href="#h12-2-17" id="h12-2-17" class="i">+                playlistGroup.indexOf(&quot;,&quot;, storyIdStartIndex)
</a><a href="#h12-2-18" id="h12-2-18" class="i">+            )
</a>             val author = context.database.getFriendInfo(if (storyUserId == &quot;null&quot;) context.database.getMyUserId()!! else storyUserId)
<a href="#h12-2-20" id="h12-2-20" class="i">+
</a>             downloadOperaMedia(mediaInfoMap, author!!.usernameForSorting!!)
             return
         }
<a href="#h12-2-24" id="h12-2-24" class="i">+
</a>         val snapSource = paramMap[&quot;SNAP_SOURCE&quot;].toString()
 
         //public stories
         if ((snapSource == &quot;PUBLIC_USER&quot; || snapSource == &quot;SAVED_STORY&quot;) &amp;&amp;
<a href="#h12-2-29" id="h12-2-29" class="d">-            (forceDownload || context.config.bool(ConfigProperty.AUTO_DOWNLOAD_PUBLIC_STORIES))) {
</a><a href="#h12-2-30" id="h12-2-30" class="i">+            (forceDownload || canAutoDownload(&quot;public_stories&quot;))) {
</a>             val userDisplayName = (if (paramMap.containsKey(&quot;USER_DISPLAY_NAME&quot;)) paramMap[&quot;USER_DISPLAY_NAME&quot;].toString() else &quot;&quot;).replace(
                     &quot;[^\\x00-\\x7F]&quot;.toRegex(),
                     &quot;&quot;)
<a href="#h12-3" id="h12-3" class="h">@@ -269,7 +269,7 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>         }
 
         //spotlight
<a href="#h12-3-3" id="h12-3-3" class="d">-        if (snapSource == &quot;SINGLE_SNAP_STORY&quot; &amp;&amp; (forceDownload || context.config.bool(ConfigProperty.AUTO_DOWNLOAD_SPOTLIGHT))) {
</a><a href="#h12-3-4" id="h12-3-4" class="i">+        if (snapSource == &quot;SINGLE_SNAP_STORY&quot; &amp;&amp; (forceDownload || canAutoDownload(&quot;spotlight&quot;))) {
</a>             downloadOperaMedia(mediaInfoMap, &quot;Spotlight&quot;)
             return
         }
<a href="#h12-4" id="h12-4" class="h">@@ -323,11 +323,9 @@ class MediaDownloader : Feature(&quot;MediaDownloader&quot;, loadParams = FeatureLoadParam
</a>         }
     }
 
<a href="#h12-4-3" id="h12-4-3" class="d">-    private fun canAutoDownload(): Boolean {
</a><a href="#h12-4-4" id="h12-4-4" class="d">-        return context.config.bool(ConfigProperty.AUTO_DOWNLOAD_SNAPS) ||
</a><a href="#h12-4-5" id="h12-4-5" class="d">-                context.config.bool(ConfigProperty.AUTO_DOWNLOAD_STORIES) ||
</a><a href="#h12-4-6" id="h12-4-6" class="d">-                context.config.bool(ConfigProperty.AUTO_DOWNLOAD_PUBLIC_STORIES) ||
</a><a href="#h12-4-7" id="h12-4-7" class="d">-                context.config.bool(ConfigProperty.AUTO_DOWNLOAD_SPOTLIGHT)
</a><a href="#h12-4-8" id="h12-4-8" class="i">+    private fun canAutoDownload(keyFilter: String? = null): Boolean {
</a><a href="#h12-4-9" id="h12-4-9" class="i">+        val options = context.config.options(ConfigProperty.AUTO_DOWNLOAD_OPTIONS)
</a><a href="#h12-4-10" id="h12-4-10" class="i">+        return options.filter { it.value }.any { keyFilter == null || it.key.contains(keyFilter, true) }
</a>     }
 
     override fun asyncOnActivityCreate() {
<b>diff --git a/<a id="h13" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AntiAutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AntiAutoSave.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AntiAutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AntiAutoSave.kt</a></b>
<a href="#h13-0" id="h13-0" class="h">@@ -1,19 +0,0 @@
</a><a href="#h13-0-0" id="h13-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h13-0-1" id="h13-0-1" class="d">-
</a><a href="#h13-0-2" id="h13-0-2" class="d">-import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h13-0-3" id="h13-0-3" class="d">-import me.rhunk.snapenhance.features.BridgeFileFeature
</a><a href="#h13-0-4" id="h13-0-4" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h13-0-5" id="h13-0-5" class="d">-
</a><a href="#h13-0-6" id="h13-0-6" class="d">-class AntiAutoSave : BridgeFileFeature(&quot;AntiAutoSave&quot;, BridgeFileType.ANTI_AUTO_SAVE, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h13-0-7" id="h13-0-7" class="d">-    override fun onActivityCreate() {
</a><a href="#h13-0-8" id="h13-0-8" class="d">-        readFile()
</a><a href="#h13-0-9" id="h13-0-9" class="d">-    }
</a><a href="#h13-0-10" id="h13-0-10" class="d">-
</a><a href="#h13-0-11" id="h13-0-11" class="d">-    fun setConversationIgnored(userId: String, state: Boolean) {
</a><a href="#h13-0-12" id="h13-0-12" class="d">-        setState(userId.hashCode().toLong().toString(16), state)
</a><a href="#h13-0-13" id="h13-0-13" class="d">-    }
</a><a href="#h13-0-14" id="h13-0-14" class="d">-
</a><a href="#h13-0-15" id="h13-0-15" class="d">-    fun isConversationIgnored(userId: String): Boolean {
</a><a href="#h13-0-16" id="h13-0-16" class="d">-        return exists(userId.hashCode().toLong().toString(16))
</a><a href="#h13-0-17" id="h13-0-17" class="d">-    }
</a><a href="#h13-0-18" id="h13-0-18" class="d">-}</a><a href="#h13-0-19" id="h13-0-19" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h14" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/AutoSave.kt</a></b>
<a href="#h14-0" id="h14-0" class="h">@@ -1,138 +0,0 @@
</a><a href="#h14-0-0" id="h14-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h14-0-1" id="h14-0-1" class="d">-
</a><a href="#h14-0-2" id="h14-0-2" class="d">-import me.rhunk.snapenhance.Logger
</a><a href="#h14-0-3" id="h14-0-3" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h14-0-4" id="h14-0-4" class="d">-import me.rhunk.snapenhance.data.ContentType
</a><a href="#h14-0-5" id="h14-0-5" class="d">-import me.rhunk.snapenhance.data.MessageState
</a><a href="#h14-0-6" id="h14-0-6" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h14-0-7" id="h14-0-7" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a><a href="#h14-0-8" id="h14-0-8" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h14-0-9" id="h14-0-9" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h14-0-10" id="h14-0-10" class="d">-import me.rhunk.snapenhance.features.impl.Messaging
</a><a href="#h14-0-11" id="h14-0-11" class="d">-import me.rhunk.snapenhance.features.impl.spying.MessageLogger
</a><a href="#h14-0-12" id="h14-0-12" class="d">-import me.rhunk.snapenhance.features.impl.spying.StealthMode
</a><a href="#h14-0-13" id="h14-0-13" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h14-0-14" id="h14-0-14" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h14-0-15" id="h14-0-15" class="d">-import me.rhunk.snapenhance.util.CallbackBuilder
</a><a href="#h14-0-16" id="h14-0-16" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h14-0-17" id="h14-0-17" class="d">-import java.util.concurrent.Executors
</a><a href="#h14-0-18" id="h14-0-18" class="d">-
</a><a href="#h14-0-19" id="h14-0-19" class="d">-class AutoSave : Feature(&quot;Auto Save&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h14-0-20" id="h14-0-20" class="d">-    private val asyncSaveExecutorService = Executors.newSingleThreadExecutor()
</a><a href="#h14-0-21" id="h14-0-21" class="d">-
</a><a href="#h14-0-22" id="h14-0-22" class="d">-    private val messageLogger by lazy { context.feature(MessageLogger::class) }
</a><a href="#h14-0-23" id="h14-0-23" class="d">-    private val messaging by lazy { context.feature(Messaging::class) }
</a><a href="#h14-0-24" id="h14-0-24" class="d">-
</a><a href="#h14-0-25" id="h14-0-25" class="d">-    private val myUserId by lazy { context.database.getMyUserId() }
</a><a href="#h14-0-26" id="h14-0-26" class="d">-
</a><a href="#h14-0-27" id="h14-0-27" class="d">-    private val fetchConversationWithMessagesCallbackClass by lazy {  context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;FetchConversationWithMessagesCallback&quot;) }
</a><a href="#h14-0-28" id="h14-0-28" class="d">-    private val callbackClass by lazy {  context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;Callback&quot;) }
</a><a href="#h14-0-29" id="h14-0-29" class="d">-
</a><a href="#h14-0-30" id="h14-0-30" class="d">-    private val updateMessageMethod by lazy { context.classCache.conversationManager.methods.first { it.name == &quot;updateMessage&quot; } }
</a><a href="#h14-0-31" id="h14-0-31" class="d">-    private val fetchConversationWithMessagesPaginatedMethod by lazy {
</a><a href="#h14-0-32" id="h14-0-32" class="d">-        context.classCache.conversationManager.methods.first { it.name == &quot;fetchConversationWithMessagesPaginated&quot; }
</a><a href="#h14-0-33" id="h14-0-33" class="d">-    }
</a><a href="#h14-0-34" id="h14-0-34" class="d">-
</a><a href="#h14-0-35" id="h14-0-35" class="d">-    private fun saveMessage(conversationId: SnapUUID, message: Message) {
</a><a href="#h14-0-36" id="h14-0-36" class="d">-        val messageId = message.messageDescriptor.messageId
</a><a href="#h14-0-37" id="h14-0-37" class="d">-        if (messageLogger.isMessageRemoved(messageId)) return
</a><a href="#h14-0-38" id="h14-0-38" class="d">-        if (message.messageState != MessageState.COMMITTED) return
</a><a href="#h14-0-39" id="h14-0-39" class="d">-
</a><a href="#h14-0-40" id="h14-0-40" class="d">-        val callback = CallbackBuilder(callbackClass)
</a><a href="#h14-0-41" id="h14-0-41" class="d">-            .override(&quot;onError&quot;) {
</a><a href="#h14-0-42" id="h14-0-42" class="d">-                Logger.xposedLog(&quot;Error saving message $messageId&quot;)
</a><a href="#h14-0-43" id="h14-0-43" class="d">-            }.build()
</a><a href="#h14-0-44" id="h14-0-44" class="d">-
</a><a href="#h14-0-45" id="h14-0-45" class="d">-        runCatching {
</a><a href="#h14-0-46" id="h14-0-46" class="d">-            updateMessageMethod.invoke(
</a><a href="#h14-0-47" id="h14-0-47" class="d">-                context.feature(Messaging::class).conversationManager,
</a><a href="#h14-0-48" id="h14-0-48" class="d">-                conversationId.instanceNonNull(),
</a><a href="#h14-0-49" id="h14-0-49" class="d">-                messageId,
</a><a href="#h14-0-50" id="h14-0-50" class="d">-                context.classCache.messageUpdateEnum.enumConstants.first { it.toString() == &quot;SAVE&quot; },
</a><a href="#h14-0-51" id="h14-0-51" class="d">-                callback
</a><a href="#h14-0-52" id="h14-0-52" class="d">-            )
</a><a href="#h14-0-53" id="h14-0-53" class="d">-        }.onFailure {
</a><a href="#h14-0-54" id="h14-0-54" class="d">-            Logger.xposedLog(&quot;Error saving message $messageId&quot;, it)
</a><a href="#h14-0-55" id="h14-0-55" class="d">-        }
</a><a href="#h14-0-56" id="h14-0-56" class="d">-
</a><a href="#h14-0-57" id="h14-0-57" class="d">-        //delay between saves
</a><a href="#h14-0-58" id="h14-0-58" class="d">-        Thread.sleep(100L)
</a><a href="#h14-0-59" id="h14-0-59" class="d">-    }
</a><a href="#h14-0-60" id="h14-0-60" class="d">-
</a><a href="#h14-0-61" id="h14-0-61" class="d">-    private fun canSaveMessage(message: Message): Boolean {
</a><a href="#h14-0-62" id="h14-0-62" class="d">-        if (message.messageMetadata.savedBy.any { uuid -&gt; uuid.toString() == myUserId }) return false
</a><a href="#h14-0-63" id="h14-0-63" class="d">-        //only save chats
</a><a href="#h14-0-64" id="h14-0-64" class="d">-        with(message.messageContent.contentType) {
</a><a href="#h14-0-65" id="h14-0-65" class="d">-            if (this != ContentType.CHAT &amp;&amp;
</a><a href="#h14-0-66" id="h14-0-66" class="d">-                this != ContentType.NOTE &amp;&amp;
</a><a href="#h14-0-67" id="h14-0-67" class="d">-                this != ContentType.STICKER &amp;&amp;
</a><a href="#h14-0-68" id="h14-0-68" class="d">-                this != ContentType.EXTERNAL_MEDIA) return false
</a><a href="#h14-0-69" id="h14-0-69" class="d">-        }
</a><a href="#h14-0-70" id="h14-0-70" class="d">-        return true
</a><a href="#h14-0-71" id="h14-0-71" class="d">-    }
</a><a href="#h14-0-72" id="h14-0-72" class="d">-
</a><a href="#h14-0-73" id="h14-0-73" class="d">-    private fun canSave(): Boolean {
</a><a href="#h14-0-74" id="h14-0-74" class="d">-        with(context.feature(Messaging::class)) {
</a><a href="#h14-0-75" id="h14-0-75" class="d">-            if (lastOpenedConversationUUID == null) return@canSave false
</a><a href="#h14-0-76" id="h14-0-76" class="d">-            val conversation = lastOpenedConversationUUID.toString()
</a><a href="#h14-0-77" id="h14-0-77" class="d">-            if (context.feature(StealthMode::class).isStealth(conversation)) return@canSave false
</a><a href="#h14-0-78" id="h14-0-78" class="d">-            if (context.feature(AntiAutoSave::class).isConversationIgnored(conversation)) return@canSave false
</a><a href="#h14-0-79" id="h14-0-79" class="d">-        }
</a><a href="#h14-0-80" id="h14-0-80" class="d">-        return true
</a><a href="#h14-0-81" id="h14-0-81" class="d">-    }
</a><a href="#h14-0-82" id="h14-0-82" class="d">-
</a><a href="#h14-0-83" id="h14-0-83" class="d">-    override fun asyncOnActivityCreate() {
</a><a href="#h14-0-84" id="h14-0-84" class="d">-        //called when enter in a conversation (or when a message is sent)
</a><a href="#h14-0-85" id="h14-0-85" class="d">-        Hooker.hook(
</a><a href="#h14-0-86" id="h14-0-86" class="d">-            context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;FetchConversationWithMessagesCallback&quot;),
</a><a href="#h14-0-87" id="h14-0-87" class="d">-            &quot;onFetchConversationWithMessagesComplete&quot;,
</a><a href="#h14-0-88" id="h14-0-88" class="d">-            HookStage.BEFORE,
</a><a href="#h14-0-89" id="h14-0-89" class="d">-            { context.config.bool(ConfigProperty.AUTO_SAVE) &amp;&amp; canSave()}
</a><a href="#h14-0-90" id="h14-0-90" class="d">-        ) { param -&gt;
</a><a href="#h14-0-91" id="h14-0-91" class="d">-            val conversationId = SnapUUID(param.arg&lt;Any&gt;(0).getObjectField(&quot;mConversationId&quot;)!!)
</a><a href="#h14-0-92" id="h14-0-92" class="d">-            val messages = param.arg&lt;List&lt;Any&gt;&gt;(1).map { Message(it) }
</a><a href="#h14-0-93" id="h14-0-93" class="d">-            messages.forEach {
</a><a href="#h14-0-94" id="h14-0-94" class="d">-                if (!canSaveMessage(it)) return@forEach
</a><a href="#h14-0-95" id="h14-0-95" class="d">-                asyncSaveExecutorService.submit {
</a><a href="#h14-0-96" id="h14-0-96" class="d">-                    saveMessage(conversationId, it)
</a><a href="#h14-0-97" id="h14-0-97" class="d">-                }
</a><a href="#h14-0-98" id="h14-0-98" class="d">-            }
</a><a href="#h14-0-99" id="h14-0-99" class="d">-        }
</a><a href="#h14-0-100" id="h14-0-100" class="d">-
</a><a href="#h14-0-101" id="h14-0-101" class="d">-        //called when a message is received
</a><a href="#h14-0-102" id="h14-0-102" class="d">-        Hooker.hook(
</a><a href="#h14-0-103" id="h14-0-103" class="d">-            context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;FetchMessageCallback&quot;),
</a><a href="#h14-0-104" id="h14-0-104" class="d">-            &quot;onFetchMessageComplete&quot;,
</a><a href="#h14-0-105" id="h14-0-105" class="d">-            HookStage.BEFORE,
</a><a href="#h14-0-106" id="h14-0-106" class="d">-            { context.config.bool(ConfigProperty.AUTO_SAVE) &amp;&amp; canSave()}
</a><a href="#h14-0-107" id="h14-0-107" class="d">-        ) { param -&gt;
</a><a href="#h14-0-108" id="h14-0-108" class="d">-            val message = Message(param.arg(0))
</a><a href="#h14-0-109" id="h14-0-109" class="d">-            if (!canSaveMessage(message)) return@hook
</a><a href="#h14-0-110" id="h14-0-110" class="d">-            val conversationId = message.messageDescriptor.conversationId
</a><a href="#h14-0-111" id="h14-0-111" class="d">-
</a><a href="#h14-0-112" id="h14-0-112" class="d">-            asyncSaveExecutorService.submit {
</a><a href="#h14-0-113" id="h14-0-113" class="d">-                saveMessage(conversationId, message)
</a><a href="#h14-0-114" id="h14-0-114" class="d">-            }
</a><a href="#h14-0-115" id="h14-0-115" class="d">-        }
</a><a href="#h14-0-116" id="h14-0-116" class="d">-
</a><a href="#h14-0-117" id="h14-0-117" class="d">-        Hooker.hook(
</a><a href="#h14-0-118" id="h14-0-118" class="d">-            context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;SendMessageCallback&quot;),
</a><a href="#h14-0-119" id="h14-0-119" class="d">-            &quot;onSuccess&quot;,
</a><a href="#h14-0-120" id="h14-0-120" class="d">-            HookStage.BEFORE,
</a><a href="#h14-0-121" id="h14-0-121" class="d">-            { context.config.bool(ConfigProperty.AUTO_SAVE) &amp;&amp; canSave()}
</a><a href="#h14-0-122" id="h14-0-122" class="d">-        ) {
</a><a href="#h14-0-123" id="h14-0-123" class="d">-            val callback = CallbackBuilder(fetchConversationWithMessagesCallbackClass).build()
</a><a href="#h14-0-124" id="h14-0-124" class="d">-            runCatching {
</a><a href="#h14-0-125" id="h14-0-125" class="d">-                fetchConversationWithMessagesPaginatedMethod.invoke(
</a><a href="#h14-0-126" id="h14-0-126" class="d">-                    messaging.conversationManager, messaging.lastOpenedConversationUUID!!.instanceNonNull(),
</a><a href="#h14-0-127" id="h14-0-127" class="d">-                    Long.MAX_VALUE,
</a><a href="#h14-0-128" id="h14-0-128" class="d">-                    3,
</a><a href="#h14-0-129" id="h14-0-129" class="d">-                    callback
</a><a href="#h14-0-130" id="h14-0-130" class="d">-                )
</a><a href="#h14-0-131" id="h14-0-131" class="d">-            }.onFailure {
</a><a href="#h14-0-132" id="h14-0-132" class="d">-                Logger.xposedLog(&quot;failed to save message&quot;, it)
</a><a href="#h14-0-133" id="h14-0-133" class="d">-            }
</a><a href="#h14-0-134" id="h14-0-134" class="d">-        }
</a><a href="#h14-0-135" id="h14-0-135" class="d">-
</a><a href="#h14-0-136" id="h14-0-136" class="d">-    }
</a><a href="#h14-0-137" id="h14-0-137" class="d">-}</a><a href="#h14-0-138" id="h14-0-138" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h15" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/DisableVideoLengthRestriction.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/DisableVideoLengthRestriction.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/DisableVideoLengthRestriction.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/DisableVideoLengthRestriction.kt</a></b>
<a href="#h15-0" id="h15-0" class="h">@@ -1,25 +0,0 @@
</a><a href="#h15-0-0" id="h15-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h15-0-1" id="h15-0-1" class="d">-
</a><a href="#h15-0-2" id="h15-0-2" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h15-0-3" id="h15-0-3" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h15-0-4" id="h15-0-4" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h15-0-5" id="h15-0-5" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h15-0-6" id="h15-0-6" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h15-0-7" id="h15-0-7" class="d">-import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h15-0-8" id="h15-0-8" class="d">-import me.rhunk.snapenhance.util.setObjectField
</a><a href="#h15-0-9" id="h15-0-9" class="d">-
</a><a href="#h15-0-10" id="h15-0-10" class="d">-class DisableVideoLengthRestriction : Feature(&quot;DisableVideoLengthRestriction&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h15-0-11" id="h15-0-11" class="d">-    override fun asyncOnActivityCreate() {
</a><a href="#h15-0-12" id="h15-0-12" class="d">-        val gridMediaItem = context.mappings.getMappedClass(&quot;GridMediaItem&quot;)
</a><a href="#h15-0-13" id="h15-0-13" class="d">-        val gridMediaItemDurationFieldName = context.mappings.getMappedValue(&quot;GridMediaItemDurationField&quot;)
</a><a href="#h15-0-14" id="h15-0-14" class="d">-
</a><a href="#h15-0-15" id="h15-0-15" class="d">-        Hooker.hookConstructor(gridMediaItem, HookStage.AFTER, {
</a><a href="#h15-0-16" id="h15-0-16" class="d">-            context.config.bool(ConfigProperty.DISABLE_VIDEO_LENGTH_RESTRICTION)
</a><a href="#h15-0-17" id="h15-0-17" class="d">-        }) {param -&gt;
</a><a href="#h15-0-18" id="h15-0-18" class="d">-            val durationMs = param.thisObject&lt;Any&gt;().getObjectField(gridMediaItemDurationFieldName) as Double
</a><a href="#h15-0-19" id="h15-0-19" class="d">-            if (durationMs &gt; 60000) {
</a><a href="#h15-0-20" id="h15-0-20" class="d">-                param.thisObject&lt;Any&gt;().setObjectField(gridMediaItemDurationFieldName, 60000)
</a><a href="#h15-0-21" id="h15-0-21" class="d">-            }
</a><a href="#h15-0-22" id="h15-0-22" class="d">-        }
</a><a href="#h15-0-23" id="h15-0-23" class="d">-    }
</a><a href="#h15-0-24" id="h15-0-24" class="d">-}</a><a href="#h15-0-25" id="h15-0-25" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h16" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/GalleryMediaSendOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/GalleryMediaSendOverride.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/GalleryMediaSendOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/GalleryMediaSendOverride.kt</a></b>
<a href="#h16-0" id="h16-0" class="h">@@ -1,37 +0,0 @@
</a><a href="#h16-0-0" id="h16-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h16-0-1" id="h16-0-1" class="d">-
</a><a href="#h16-0-2" id="h16-0-2" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h16-0-3" id="h16-0-3" class="d">-import me.rhunk.snapenhance.data.ContentType
</a><a href="#h16-0-4" id="h16-0-4" class="d">-import me.rhunk.snapenhance.data.MessageSender
</a><a href="#h16-0-5" id="h16-0-5" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.MessageContent
</a><a href="#h16-0-6" id="h16-0-6" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h16-0-7" id="h16-0-7" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h16-0-8" id="h16-0-8" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h16-0-9" id="h16-0-9" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h16-0-10" id="h16-0-10" class="d">-import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a><a href="#h16-0-11" id="h16-0-11" class="d">-
</a><a href="#h16-0-12" id="h16-0-12" class="d">-class GalleryMediaSendOverride : Feature(&quot;Gallery Media Send Override&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
</a><a href="#h16-0-13" id="h16-0-13" class="d">-
</a><a href="#h16-0-14" id="h16-0-14" class="d">-    override fun init() {
</a><a href="#h16-0-15" id="h16-0-15" class="d">-        Hooker.hook(context.classCache.conversationManager, &quot;sendMessageWithContent&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h16-0-16" id="h16-0-16" class="d">-            val localMessageContent = MessageContent(param.arg(1))
</a><a href="#h16-0-17" id="h16-0-17" class="d">-
</a><a href="#h16-0-18" id="h16-0-18" class="d">-            if (localMessageContent.contentType != ContentType.EXTERNAL_MEDIA) return@hook
</a><a href="#h16-0-19" id="h16-0-19" class="d">-            //story replies
</a><a href="#h16-0-20" id="h16-0-20" class="d">-            val messageProtoReader = ProtoReader(localMessageContent.content)
</a><a href="#h16-0-21" id="h16-0-21" class="d">-            if (messageProtoReader.exists(7)) return@hook
</a><a href="#h16-0-22" id="h16-0-22" class="d">-
</a><a href="#h16-0-23" id="h16-0-23" class="d">-            when (val overrideType = context.config.state(ConfigProperty.GALLERY_MEDIA_SEND_OVERRIDE)) {
</a><a href="#h16-0-24" id="h16-0-24" class="d">-                &quot;SNAP&quot;, &quot;LIVE_SNAP&quot; -&gt; {
</a><a href="#h16-0-25" id="h16-0-25" class="d">-                    localMessageContent.contentType = ContentType.SNAP
</a><a href="#h16-0-26" id="h16-0-26" class="d">-                    localMessageContent.content = MessageSender.redSnapProto(overrideType == &quot;LIVE_SNAP&quot;)
</a><a href="#h16-0-27" id="h16-0-27" class="d">-                }
</a><a href="#h16-0-28" id="h16-0-28" class="d">-                &quot;NOTE&quot; -&gt; {
</a><a href="#h16-0-29" id="h16-0-29" class="d">-                    localMessageContent.contentType = ContentType.NOTE
</a><a href="#h16-0-30" id="h16-0-30" class="d">-                    val mediaDuration = messageProtoReader.getInt(3, 3, 5, 1, 1, 15) ?: 0
</a><a href="#h16-0-31" id="h16-0-31" class="d">-                    localMessageContent.content = MessageSender.audioNoteProto(mediaDuration)
</a><a href="#h16-0-32" id="h16-0-32" class="d">-                }
</a><a href="#h16-0-33" id="h16-0-33" class="d">-            }
</a><a href="#h16-0-34" id="h16-0-34" class="d">-        }
</a><a href="#h16-0-35" id="h16-0-35" class="d">-    }
</a><a href="#h16-0-36" id="h16-0-36" class="d">-}</a><a href="#h16-0-37" id="h16-0-37" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h17" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/LocationSpoofer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/LocationSpoofer.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/LocationSpoofer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/LocationSpoofer.kt</a></b>
<a href="#h17-0" id="h17-0" class="h">@@ -1,64 +0,0 @@
</a><a href="#h17-0-0" id="h17-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h17-0-1" id="h17-0-1" class="d">-
</a><a href="#h17-0-2" id="h17-0-2" class="d">-import android.content.Intent
</a><a href="#h17-0-3" id="h17-0-3" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h17-0-4" id="h17-0-4" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h17-0-5" id="h17-0-5" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h17-0-6" id="h17-0-6" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h17-0-7" id="h17-0-7" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h17-0-8" id="h17-0-8" class="d">-
</a><a href="#h17-0-9" id="h17-0-9" class="d">-class LocationSpoofer: Feature(&quot;LocationSpoof&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h17-0-10" id="h17-0-10" class="d">-    override fun asyncOnActivityCreate() {
</a><a href="#h17-0-11" id="h17-0-11" class="d">-        Hooker.hook(context.mainActivity!!.javaClass, &quot;onActivityResult&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h17-0-12" id="h17-0-12" class="d">-            val intent = param.argNullable&lt;Intent&gt;(2) ?: return@hook
</a><a href="#h17-0-13" id="h17-0-13" class="d">-            val bundle = intent.getBundleExtra(&quot;location&quot;) ?: return@hook
</a><a href="#h17-0-14" id="h17-0-14" class="d">-            param.setResult(null)
</a><a href="#h17-0-15" id="h17-0-15" class="d">-            val latitude = bundle.getFloat(&quot;latitude&quot;)
</a><a href="#h17-0-16" id="h17-0-16" class="d">-            val longitude = bundle.getFloat(&quot;longitude&quot;)
</a><a href="#h17-0-17" id="h17-0-17" class="d">-
</a><a href="#h17-0-18" id="h17-0-18" class="d">-            with(context.config) {
</a><a href="#h17-0-19" id="h17-0-19" class="d">-                get(ConfigProperty.LATITUDE).read(latitude.toString())
</a><a href="#h17-0-20" id="h17-0-20" class="d">-                get(ConfigProperty.LONGITUDE).read(longitude.toString())
</a><a href="#h17-0-21" id="h17-0-21" class="d">-                writeConfig()
</a><a href="#h17-0-22" id="h17-0-22" class="d">-            }
</a><a href="#h17-0-23" id="h17-0-23" class="d">-            context.longToast(&quot;Location set to $latitude, $longitude&quot;)
</a><a href="#h17-0-24" id="h17-0-24" class="d">-        }
</a><a href="#h17-0-25" id="h17-0-25" class="d">-
</a><a href="#h17-0-26" id="h17-0-26" class="d">-        if (!context.config.bool(ConfigProperty.LOCATION_SPOOF)) return
</a><a href="#h17-0-27" id="h17-0-27" class="d">-        val locationClass = android.location.Location::class.java
</a><a href="#h17-0-28" id="h17-0-28" class="d">-        val locationManagerClass = android.location.LocationManager::class.java
</a><a href="#h17-0-29" id="h17-0-29" class="d">-
</a><a href="#h17-0-30" id="h17-0-30" class="d">-        Hooker.hook(locationClass, &quot;getLatitude&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h17-0-31" id="h17-0-31" class="d">-            hookAdapter.setResult(getLatitude())
</a><a href="#h17-0-32" id="h17-0-32" class="d">-        }
</a><a href="#h17-0-33" id="h17-0-33" class="d">-
</a><a href="#h17-0-34" id="h17-0-34" class="d">-        Hooker.hook(locationClass, &quot;getLongitude&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h17-0-35" id="h17-0-35" class="d">-            hookAdapter.setResult(getLongitude())
</a><a href="#h17-0-36" id="h17-0-36" class="d">-        }
</a><a href="#h17-0-37" id="h17-0-37" class="d">-
</a><a href="#h17-0-38" id="h17-0-38" class="d">-        Hooker.hook(locationClass, &quot;getAccuracy&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h17-0-39" id="h17-0-39" class="d">-            hookAdapter.setResult(getAccuracy())
</a><a href="#h17-0-40" id="h17-0-40" class="d">-        }
</a><a href="#h17-0-41" id="h17-0-41" class="d">-
</a><a href="#h17-0-42" id="h17-0-42" class="d">-        //Might be redundant because it calls isProviderEnabledForUser which we also hook, meaning if isProviderEnabledForUser returns true this will also return true
</a><a href="#h17-0-43" id="h17-0-43" class="d">-        Hooker.hook(locationManagerClass, &quot;isProviderEnabled&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h17-0-44" id="h17-0-44" class="d">-            hookAdapter.setResult(true)
</a><a href="#h17-0-45" id="h17-0-45" class="d">-        }
</a><a href="#h17-0-46" id="h17-0-46" class="d">-        
</a><a href="#h17-0-47" id="h17-0-47" class="d">-        Hooker.hook(locationManagerClass, &quot;isProviderEnabledForUser&quot;, HookStage.BEFORE) {hookAdapter -&gt;
</a><a href="#h17-0-48" id="h17-0-48" class="d">-            hookAdapter.setResult(true)
</a><a href="#h17-0-49" id="h17-0-49" class="d">-        }
</a><a href="#h17-0-50" id="h17-0-50" class="d">-    }
</a><a href="#h17-0-51" id="h17-0-51" class="d">-
</a><a href="#h17-0-52" id="h17-0-52" class="d">-    private fun getLatitude():Double {
</a><a href="#h17-0-53" id="h17-0-53" class="d">-        return context.config.string(ConfigProperty.LATITUDE).toDouble()
</a><a href="#h17-0-54" id="h17-0-54" class="d">-    }
</a><a href="#h17-0-55" id="h17-0-55" class="d">-
</a><a href="#h17-0-56" id="h17-0-56" class="d">-    private fun getLongitude():Double {
</a><a href="#h17-0-57" id="h17-0-57" class="d">-        return context.config.string(ConfigProperty.LONGITUDE).toDouble()
</a><a href="#h17-0-58" id="h17-0-58" class="d">-    }
</a><a href="#h17-0-59" id="h17-0-59" class="d">-
</a><a href="#h17-0-60" id="h17-0-60" class="d">-    private fun getAccuracy():Float {
</a><a href="#h17-0-61" id="h17-0-61" class="d">-        return 0.0f
</a><a href="#h17-0-62" id="h17-0-62" class="d">-    }
</a><a href="#h17-0-63" id="h17-0-63" class="d">-}</a><a href="#h17-0-64" id="h17-0-64" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h18" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/MediaQualityLevelOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/MediaQualityLevelOverride.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/MediaQualityLevelOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/MediaQualityLevelOverride.kt</a></b>
<a href="#h18-0" id="h18-0" class="h">@@ -1,26 +0,0 @@
</a><a href="#h18-0-0" id="h18-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h18-0-1" id="h18-0-1" class="d">-
</a><a href="#h18-0-2" id="h18-0-2" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h18-0-3" id="h18-0-3" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h18-0-4" id="h18-0-4" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h18-0-5" id="h18-0-5" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h18-0-6" id="h18-0-6" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h18-0-7" id="h18-0-7" class="d">-
</a><a href="#h18-0-8" id="h18-0-8" class="d">-class MediaQualityLevelOverride : Feature(&quot;MediaQualityLevelOverride&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
</a><a href="#h18-0-9" id="h18-0-9" class="d">-    override fun init() {
</a><a href="#h18-0-10" id="h18-0-10" class="d">-        val enumQualityLevel = context.mappings.getMappedClass(&quot;enums&quot;, &quot;QualityLevel&quot;)
</a><a href="#h18-0-11" id="h18-0-11" class="d">-
</a><a href="#h18-0-12" id="h18-0-12" class="d">-        Hooker.hook(context.mappings.getMappedClass(&quot;MediaQualityLevelProvider&quot;),
</a><a href="#h18-0-13" id="h18-0-13" class="d">-            context.mappings.getMappedValue(&quot;MediaQualityLevelProviderMethod&quot;),
</a><a href="#h18-0-14" id="h18-0-14" class="d">-            HookStage.BEFORE,
</a><a href="#h18-0-15" id="h18-0-15" class="d">-            {context.config.bool(ConfigProperty.OVERRIDE_MEDIA_QUALITY)}
</a><a href="#h18-0-16" id="h18-0-16" class="d">-        ) { param -&gt;
</a><a href="#h18-0-17" id="h18-0-17" class="d">-            val currentCompressionLevel = enumQualityLevel.enumConstants
</a><a href="#h18-0-18" id="h18-0-18" class="d">-                .firstOrNull { it.toString() == context.config.state(ConfigProperty.MEDIA_QUALITY_LEVEL)} ?: run {
</a><a href="#h18-0-19" id="h18-0-19" class="d">-                context.longToast(&quot;Invalid media quality level: ${context.config.state(ConfigProperty.MEDIA_QUALITY_LEVEL)}&quot;)
</a><a href="#h18-0-20" id="h18-0-20" class="d">-                return@hook
</a><a href="#h18-0-21" id="h18-0-21" class="d">-            }
</a><a href="#h18-0-22" id="h18-0-22" class="d">-            param.setResult(currentCompressionLevel)
</a><a href="#h18-0-23" id="h18-0-23" class="d">-        }
</a><a href="#h18-0-24" id="h18-0-24" class="d">-    }
</a><a href="#h18-0-25" id="h18-0-25" class="d">-}</a><a href="#h18-0-26" id="h18-0-26" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h19" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/Notifications.kt</a></b>
<a href="#h19-0" id="h19-0" class="h">@@ -1,301 +0,0 @@
</a><a href="#h19-0-0" id="h19-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h19-0-1" id="h19-0-1" class="d">-
</a><a href="#h19-0-2" id="h19-0-2" class="d">-import android.app.Notification
</a><a href="#h19-0-3" id="h19-0-3" class="d">-import android.app.NotificationManager
</a><a href="#h19-0-4" id="h19-0-4" class="d">-import android.app.PendingIntent
</a><a href="#h19-0-5" id="h19-0-5" class="d">-import android.app.RemoteInput
</a><a href="#h19-0-6" id="h19-0-6" class="d">-import android.content.Context
</a><a href="#h19-0-7" id="h19-0-7" class="d">-import android.content.Intent
</a><a href="#h19-0-8" id="h19-0-8" class="d">-import android.graphics.Bitmap
</a><a href="#h19-0-9" id="h19-0-9" class="d">-import android.os.Bundle
</a><a href="#h19-0-10" id="h19-0-10" class="d">-import android.os.UserHandle
</a><a href="#h19-0-11" id="h19-0-11" class="d">-import de.robv.android.xposed.XposedBridge
</a><a href="#h19-0-12" id="h19-0-12" class="d">-import de.robv.android.xposed.XposedHelpers
</a><a href="#h19-0-13" id="h19-0-13" class="d">-import me.rhunk.snapenhance.Constants
</a><a href="#h19-0-14" id="h19-0-14" class="d">-import me.rhunk.snapenhance.Logger
</a><a href="#h19-0-15" id="h19-0-15" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h19-0-16" id="h19-0-16" class="d">-import me.rhunk.snapenhance.data.ContentType
</a><a href="#h19-0-17" id="h19-0-17" class="d">-import me.rhunk.snapenhance.data.MediaReferenceType
</a><a href="#h19-0-18" id="h19-0-18" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h19-0-19" id="h19-0-19" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a><a href="#h19-0-20" id="h19-0-20" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h19-0-21" id="h19-0-21" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h19-0-22" id="h19-0-22" class="d">-import me.rhunk.snapenhance.features.impl.Messaging
</a><a href="#h19-0-23" id="h19-0-23" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h19-0-24" id="h19-0-24" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h19-0-25" id="h19-0-25" class="d">-import me.rhunk.snapenhance.util.CallbackBuilder
</a><a href="#h19-0-26" id="h19-0-26" class="d">-import me.rhunk.snapenhance.util.EncryptionUtils
</a><a href="#h19-0-27" id="h19-0-27" class="d">-import me.rhunk.snapenhance.util.MediaDownloaderHelper
</a><a href="#h19-0-28" id="h19-0-28" class="d">-import me.rhunk.snapenhance.util.MediaType
</a><a href="#h19-0-29" id="h19-0-29" class="d">-import me.rhunk.snapenhance.util.PreviewUtils
</a><a href="#h19-0-30" id="h19-0-30" class="d">-import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a><a href="#h19-0-31" id="h19-0-31" class="d">-
</a><a href="#h19-0-32" id="h19-0-32" class="d">-class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
</a><a href="#h19-0-33" id="h19-0-33" class="d">-    companion object{
</a><a href="#h19-0-34" id="h19-0-34" class="d">-        const val ACTION_REPLY = &quot;me.rhunk.snapenhance.action.REPLY&quot;
</a><a href="#h19-0-35" id="h19-0-35" class="d">-    }
</a><a href="#h19-0-36" id="h19-0-36" class="d">-
</a><a href="#h19-0-37" id="h19-0-37" class="d">-    private val notificationDataQueue = mutableMapOf&lt;Long, NotificationData&gt;() // messageId =&gt; notification
</a><a href="#h19-0-38" id="h19-0-38" class="d">-    private val cachedMessages = mutableMapOf&lt;String, MutableList&lt;String&gt;&gt;() // conversationId =&gt; cached messages
</a><a href="#h19-0-39" id="h19-0-39" class="d">-    private val notificationIdMap = mutableMapOf&lt;Int, String&gt;() // notificationId =&gt; conversationId
</a><a href="#h19-0-40" id="h19-0-40" class="d">-
</a><a href="#h19-0-41" id="h19-0-41" class="d">-    private val broadcastReceiverClass by lazy {
</a><a href="#h19-0-42" id="h19-0-42" class="d">-        context.androidContext.classLoader.loadClass(&quot;com.snap.widgets.core.BestFriendsWidgetProvider&quot;)
</a><a href="#h19-0-43" id="h19-0-43" class="d">-    }
</a><a href="#h19-0-44" id="h19-0-44" class="d">-
</a><a href="#h19-0-45" id="h19-0-45" class="d">-    private val notifyAsUserMethod by lazy {
</a><a href="#h19-0-46" id="h19-0-46" class="d">-        XposedHelpers.findMethodExact(
</a><a href="#h19-0-47" id="h19-0-47" class="d">-            NotificationManager::class.java, &quot;notifyAsUser&quot;,
</a><a href="#h19-0-48" id="h19-0-48" class="d">-            String::class.java,
</a><a href="#h19-0-49" id="h19-0-49" class="d">-            Int::class.javaPrimitiveType,
</a><a href="#h19-0-50" id="h19-0-50" class="d">-            Notification::class.java,
</a><a href="#h19-0-51" id="h19-0-51" class="d">-            UserHandle::class.java
</a><a href="#h19-0-52" id="h19-0-52" class="d">-        )
</a><a href="#h19-0-53" id="h19-0-53" class="d">-    }
</a><a href="#h19-0-54" id="h19-0-54" class="d">-
</a><a href="#h19-0-55" id="h19-0-55" class="d">-    private val cancelAsUserMethod by lazy {
</a><a href="#h19-0-56" id="h19-0-56" class="d">-        XposedHelpers.findMethodExact(NotificationManager::class.java, &quot;cancelAsUser&quot;, String::class.java, Int::class.javaPrimitiveType, UserHandle::class.java)
</a><a href="#h19-0-57" id="h19-0-57" class="d">-    }
</a><a href="#h19-0-58" id="h19-0-58" class="d">-
</a><a href="#h19-0-59" id="h19-0-59" class="d">-    private val fetchConversationWithMessagesMethod by lazy {
</a><a href="#h19-0-60" id="h19-0-60" class="d">-        context.classCache.conversationManager.methods.first { it.name == &quot;fetchConversationWithMessages&quot;}
</a><a href="#h19-0-61" id="h19-0-61" class="d">-    }
</a><a href="#h19-0-62" id="h19-0-62" class="d">-
</a><a href="#h19-0-63" id="h19-0-63" class="d">-    private val notificationManager by lazy {
</a><a href="#h19-0-64" id="h19-0-64" class="d">-        context.androidContext.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
</a><a href="#h19-0-65" id="h19-0-65" class="d">-    }
</a><a href="#h19-0-66" id="h19-0-66" class="d">-
</a><a href="#h19-0-67" id="h19-0-67" class="d">-    private fun setNotificationText(notification: Notification, text: String) {
</a><a href="#h19-0-68" id="h19-0-68" class="d">-        with(notification.extras) {
</a><a href="#h19-0-69" id="h19-0-69" class="d">-            putString(&quot;android.text&quot;, text)
</a><a href="#h19-0-70" id="h19-0-70" class="d">-            putString(&quot;android.bigText&quot;, text)
</a><a href="#h19-0-71" id="h19-0-71" class="d">-        }
</a><a href="#h19-0-72" id="h19-0-72" class="d">-    }
</a><a href="#h19-0-73" id="h19-0-73" class="d">-
</a><a href="#h19-0-74" id="h19-0-74" class="d">-    private fun computeNotificationText(conversationId: String): String {
</a><a href="#h19-0-75" id="h19-0-75" class="d">-        val messageBuilder = StringBuilder()
</a><a href="#h19-0-76" id="h19-0-76" class="d">-        cachedMessages.computeIfAbsent(conversationId) { mutableListOf() }.forEach {
</a><a href="#h19-0-77" id="h19-0-77" class="d">-            if (messageBuilder.isNotEmpty()) messageBuilder.append(&quot;\n&quot;)
</a><a href="#h19-0-78" id="h19-0-78" class="d">-            messageBuilder.append(it)
</a><a href="#h19-0-79" id="h19-0-79" class="d">-        }
</a><a href="#h19-0-80" id="h19-0-80" class="d">-        return messageBuilder.toString()
</a><a href="#h19-0-81" id="h19-0-81" class="d">-    }
</a><a href="#h19-0-82" id="h19-0-82" class="d">-
</a><a href="#h19-0-83" id="h19-0-83" class="d">-    private fun setupNotificationActionButtons(conversationId: String, notificationData: NotificationData) {
</a><a href="#h19-0-84" id="h19-0-84" class="d">-        val notificationBuilder = XposedHelpers.newInstance(
</a><a href="#h19-0-85" id="h19-0-85" class="d">-            Notification.Builder::class.java,
</a><a href="#h19-0-86" id="h19-0-86" class="d">-            context.androidContext,
</a><a href="#h19-0-87" id="h19-0-87" class="d">-            notificationData.notification
</a><a href="#h19-0-88" id="h19-0-88" class="d">-        ) as Notification.Builder
</a><a href="#h19-0-89" id="h19-0-89" class="d">-
</a><a href="#h19-0-90" id="h19-0-90" class="d">-        val chatReplyInput = RemoteInput.Builder(&quot;chat_reply_input&quot;)
</a><a href="#h19-0-91" id="h19-0-91" class="d">-            .setLabel(&quot;Reply&quot;)
</a><a href="#h19-0-92" id="h19-0-92" class="d">-            .build()
</a><a href="#h19-0-93" id="h19-0-93" class="d">-
</a><a href="#h19-0-94" id="h19-0-94" class="d">-        val replyIntent = Intent()
</a><a href="#h19-0-95" id="h19-0-95" class="d">-            .setClassName(Constants.SNAPCHAT_PACKAGE_NAME, broadcastReceiverClass.name)
</a><a href="#h19-0-96" id="h19-0-96" class="d">-            .putExtra(&quot;conversation_id&quot;, conversationId)
</a><a href="#h19-0-97" id="h19-0-97" class="d">-            .putExtra(&quot;notification_id&quot;, notificationData.id)
</a><a href="#h19-0-98" id="h19-0-98" class="d">-            .setAction(ACTION_REPLY)
</a><a href="#h19-0-99" id="h19-0-99" class="d">-
</a><a href="#h19-0-100" id="h19-0-100" class="d">-        val action = Notification.Action.Builder(
</a><a href="#h19-0-101" id="h19-0-101" class="d">-            null,
</a><a href="#h19-0-102" id="h19-0-102" class="d">-            &quot;Reply&quot;,
</a><a href="#h19-0-103" id="h19-0-103" class="d">-            PendingIntent.getBroadcast(
</a><a href="#h19-0-104" id="h19-0-104" class="d">-                context.androidContext,
</a><a href="#h19-0-105" id="h19-0-105" class="d">-                System.nanoTime().toInt(),
</a><a href="#h19-0-106" id="h19-0-106" class="d">-                replyIntent,
</a><a href="#h19-0-107" id="h19-0-107" class="d">-                PendingIntent.FLAG_CANCEL_CURRENT or PendingIntent.FLAG_MUTABLE
</a><a href="#h19-0-108" id="h19-0-108" class="d">-            )
</a><a href="#h19-0-109" id="h19-0-109" class="d">-        ).addRemoteInput(chatReplyInput).build()
</a><a href="#h19-0-110" id="h19-0-110" class="d">-
</a><a href="#h19-0-111" id="h19-0-111" class="d">-        notificationBuilder.setActions(action)
</a><a href="#h19-0-112" id="h19-0-112" class="d">-        notificationData.notification = notificationBuilder.build()
</a><a href="#h19-0-113" id="h19-0-113" class="d">-    }
</a><a href="#h19-0-114" id="h19-0-114" class="d">-
</a><a href="#h19-0-115" id="h19-0-115" class="d">-    private fun setupBroadcastReceiverHook() {
</a><a href="#h19-0-116" id="h19-0-116" class="d">-        Hooker.hook(broadcastReceiverClass, &quot;onReceive&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h19-0-117" id="h19-0-117" class="d">-            val androidContext = param.arg&lt;Context&gt;(0)
</a><a href="#h19-0-118" id="h19-0-118" class="d">-            val intent = param.arg&lt;Intent&gt;(1)
</a><a href="#h19-0-119" id="h19-0-119" class="d">-            if (intent.action != ACTION_REPLY) return@hook
</a><a href="#h19-0-120" id="h19-0-120" class="d">-            param.setResult(null)
</a><a href="#h19-0-121" id="h19-0-121" class="d">-
</a><a href="#h19-0-122" id="h19-0-122" class="d">-            val notificationManager = androidContext.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
</a><a href="#h19-0-123" id="h19-0-123" class="d">-            val updateNotification: (Int, (Notification) -&gt; Unit) -&gt; Unit = { notificationId, notificationBuilder -&gt;
</a><a href="#h19-0-124" id="h19-0-124" class="d">-                notificationManager.activeNotifications.firstOrNull { it.id == notificationId }?.let {
</a><a href="#h19-0-125" id="h19-0-125" class="d">-                    notificationBuilder(it.notification)
</a><a href="#h19-0-126" id="h19-0-126" class="d">-                    XposedBridge.invokeOriginalMethod(notifyAsUserMethod, notificationManager, arrayOf(
</a><a href="#h19-0-127" id="h19-0-127" class="d">-                        it.tag, it.id, it.notification, it.user
</a><a href="#h19-0-128" id="h19-0-128" class="d">-                    ))
</a><a href="#h19-0-129" id="h19-0-129" class="d">-                }
</a><a href="#h19-0-130" id="h19-0-130" class="d">-            }
</a><a href="#h19-0-131" id="h19-0-131" class="d">-
</a><a href="#h19-0-132" id="h19-0-132" class="d">-            val input = RemoteInput.getResultsFromIntent(intent).getCharSequence(&quot;chat_reply_input&quot;)
</a><a href="#h19-0-133" id="h19-0-133" class="d">-                .toString()
</a><a href="#h19-0-134" id="h19-0-134" class="d">-            val conversationId = intent.getStringExtra(&quot;conversation_id&quot;)!!
</a><a href="#h19-0-135" id="h19-0-135" class="d">-            val notificationId = intent.getIntExtra(&quot;notification_id&quot;, -1)
</a><a href="#h19-0-136" id="h19-0-136" class="d">-
</a><a href="#h19-0-137" id="h19-0-137" class="d">-            context.database.getMyUserId()?.let { context.database.getFriendInfo(it) }?.let { myUser -&gt;
</a><a href="#h19-0-138" id="h19-0-138" class="d">-                cachedMessages.computeIfAbsent(conversationId) { mutableListOf() }.add(&quot;${myUser.displayName}: $input&quot;)
</a><a href="#h19-0-139" id="h19-0-139" class="d">-
</a><a href="#h19-0-140" id="h19-0-140" class="d">-                updateNotification(notificationId) { notification -&gt;
</a><a href="#h19-0-141" id="h19-0-141" class="d">-                    setNotificationText(notification, computeNotificationText(conversationId))
</a><a href="#h19-0-142" id="h19-0-142" class="d">-                }
</a><a href="#h19-0-143" id="h19-0-143" class="d">-
</a><a href="#h19-0-144" id="h19-0-144" class="d">-                context.messageSender.sendChatMessage(listOf(SnapUUID.fromString(conversationId)), input, onError = {
</a><a href="#h19-0-145" id="h19-0-145" class="d">-                    context.longToast(&quot;Failed to send message: $it&quot;)
</a><a href="#h19-0-146" id="h19-0-146" class="d">-                })
</a><a href="#h19-0-147" id="h19-0-147" class="d">-            }
</a><a href="#h19-0-148" id="h19-0-148" class="d">-        }
</a><a href="#h19-0-149" id="h19-0-149" class="d">-    }
</a><a href="#h19-0-150" id="h19-0-150" class="d">-
</a><a href="#h19-0-151" id="h19-0-151" class="d">-    private fun fetchMessagesResult(conversationId: String, messages: List&lt;Message&gt;) {
</a><a href="#h19-0-152" id="h19-0-152" class="d">-        val sendNotificationData = { notificationData: NotificationData, forceCreate: Boolean  -&gt;
</a><a href="#h19-0-153" id="h19-0-153" class="d">-            val notificationId = if (forceCreate) System.nanoTime().toInt() else notificationData.id
</a><a href="#h19-0-154" id="h19-0-154" class="d">-            notificationIdMap.computeIfAbsent(notificationId) { conversationId }
</a><a href="#h19-0-155" id="h19-0-155" class="d">-
</a><a href="#h19-0-156" id="h19-0-156" class="d">-            XposedBridge.invokeOriginalMethod(notifyAsUserMethod, notificationManager, arrayOf(
</a><a href="#h19-0-157" id="h19-0-157" class="d">-                notificationData.tag, if (forceCreate) System.nanoTime().toInt() else notificationData.id, notificationData.notification, notificationData.userHandle
</a><a href="#h19-0-158" id="h19-0-158" class="d">-            ))
</a><a href="#h19-0-159" id="h19-0-159" class="d">-        }
</a><a href="#h19-0-160" id="h19-0-160" class="d">-
</a><a href="#h19-0-161" id="h19-0-161" class="d">-        notificationDataQueue.entries.onEach { (messageId, notificationData) -&gt;
</a><a href="#h19-0-162" id="h19-0-162" class="d">-            val snapMessage = messages.firstOrNull { message -&gt; message.orderKey == messageId } ?: return
</a><a href="#h19-0-163" id="h19-0-163" class="d">-            val senderUsername = context.database.getFriendInfo(snapMessage.senderId.toString())?.displayName ?: throw Throwable(&quot;Cant find senderId of message $snapMessage&quot;)
</a><a href="#h19-0-164" id="h19-0-164" class="d">-
</a><a href="#h19-0-165" id="h19-0-165" class="d">-            val contentType = snapMessage.messageContent.contentType
</a><a href="#h19-0-166" id="h19-0-166" class="d">-            val contentData = snapMessage.messageContent.content
</a><a href="#h19-0-167" id="h19-0-167" class="d">-
</a><a href="#h19-0-168" id="h19-0-168" class="d">-            val formatUsername: (String) -&gt; String = { &quot;$senderUsername: $it&quot; }
</a><a href="#h19-0-169" id="h19-0-169" class="d">-            val notificationCache = cachedMessages.let { it.computeIfAbsent(conversationId) { mutableListOf() } }
</a><a href="#h19-0-170" id="h19-0-170" class="d">-            val appendNotifications: () -&gt; Unit = { setNotificationText(notificationData.notification, computeNotificationText(conversationId))}
</a><a href="#h19-0-171" id="h19-0-171" class="d">-
</a><a href="#h19-0-172" id="h19-0-172" class="d">-            when (contentType) {
</a><a href="#h19-0-173" id="h19-0-173" class="d">-                ContentType.NOTE -&gt; {
</a><a href="#h19-0-174" id="h19-0-174" class="d">-                    notificationCache.add(formatUsername(&quot;sent audio note&quot;))
</a><a href="#h19-0-175" id="h19-0-175" class="d">-                    appendNotifications()
</a><a href="#h19-0-176" id="h19-0-176" class="d">-                }
</a><a href="#h19-0-177" id="h19-0-177" class="d">-                ContentType.CHAT -&gt; {
</a><a href="#h19-0-178" id="h19-0-178" class="d">-                    ProtoReader(contentData).getString(2, 1)?.trim()?.let {
</a><a href="#h19-0-179" id="h19-0-179" class="d">-                        notificationCache.add(formatUsername(it))
</a><a href="#h19-0-180" id="h19-0-180" class="d">-                    }
</a><a href="#h19-0-181" id="h19-0-181" class="d">-                    appendNotifications()
</a><a href="#h19-0-182" id="h19-0-182" class="d">-                }
</a><a href="#h19-0-183" id="h19-0-183" class="d">-                ContentType.SNAP, ContentType.EXTERNAL_MEDIA-&gt; {
</a><a href="#h19-0-184" id="h19-0-184" class="d">-                    //serialize the message content into a json object
</a><a href="#h19-0-185" id="h19-0-185" class="d">-                    val serializedMessageContent = context.gson.toJsonTree(snapMessage.messageContent.instanceNonNull()).asJsonObject
</a><a href="#h19-0-186" id="h19-0-186" class="d">-                    val mediaReferences = serializedMessageContent[&quot;mRemoteMediaReferences&quot;]
</a><a href="#h19-0-187" id="h19-0-187" class="d">-                        .asJsonArray.map { it.asJsonObject[&quot;mMediaReferences&quot;].asJsonArray }
</a><a href="#h19-0-188" id="h19-0-188" class="d">-                        .flatten()
</a><a href="#h19-0-189" id="h19-0-189" class="d">-
</a><a href="#h19-0-190" id="h19-0-190" class="d">-                    mediaReferences.forEach { media -&gt;
</a><a href="#h19-0-191" id="h19-0-191" class="d">-                        val protoMediaReference = media.asJsonObject[&quot;mContentObject&quot;].asJsonArray.map { it.asByte }.toByteArray()
</a><a href="#h19-0-192" id="h19-0-192" class="d">-                        val mediaType = MediaReferenceType.valueOf(media.asJsonObject[&quot;mMediaType&quot;].asString)
</a><a href="#h19-0-193" id="h19-0-193" class="d">-                        runCatching {
</a><a href="#h19-0-194" id="h19-0-194" class="d">-                            //download the media
</a><a href="#h19-0-195" id="h19-0-195" class="d">-                            val mediaInfo = ProtoReader(contentData).let {
</a><a href="#h19-0-196" id="h19-0-196" class="d">-                                if (contentType == ContentType.EXTERNAL_MEDIA)
</a><a href="#h19-0-197" id="h19-0-197" class="d">-                                    return@let it.readPath(*Constants.MESSAGE_EXTERNAL_MEDIA_ENCRYPTION_PROTO_PATH)
</a><a href="#h19-0-198" id="h19-0-198" class="d">-                                else
</a><a href="#h19-0-199" id="h19-0-199" class="d">-                                    return@let it.readPath(*Constants.MESSAGE_SNAP_ENCRYPTION_PROTO_PATH)
</a><a href="#h19-0-200" id="h19-0-200" class="d">-                            }?: return@runCatching
</a><a href="#h19-0-201" id="h19-0-201" class="d">-
</a><a href="#h19-0-202" id="h19-0-202" class="d">-                            val downloadedMedia = MediaDownloaderHelper.downloadMediaFromReference(protoMediaReference, mergeOverlay = false, isPreviewMode = false) {
</a><a href="#h19-0-203" id="h19-0-203" class="d">-                                if (mediaInfo.exists(Constants.ARROYO_ENCRYPTION_PROTO_INDEX))
</a><a href="#h19-0-204" id="h19-0-204" class="d">-                                    EncryptionUtils.decryptInputStream(it, false, mediaInfo, Constants.ARROYO_ENCRYPTION_PROTO_INDEX)
</a><a href="#h19-0-205" id="h19-0-205" class="d">-                                else it
</a><a href="#h19-0-206" id="h19-0-206" class="d">-                            }[MediaType.ORIGINAL] ?: throw Throwable(&quot;Failed to download media&quot;)
</a><a href="#h19-0-207" id="h19-0-207" class="d">-
</a><a href="#h19-0-208" id="h19-0-208" class="d">-                            val bitmapPreview = PreviewUtils.createPreview(downloadedMedia, mediaType == MediaReferenceType.VIDEO)!!
</a><a href="#h19-0-209" id="h19-0-209" class="d">-                            val notificationBuilder = XposedHelpers.newInstance(
</a><a href="#h19-0-210" id="h19-0-210" class="d">-                                Notification.Builder::class.java,
</a><a href="#h19-0-211" id="h19-0-211" class="d">-                                context.androidContext,
</a><a href="#h19-0-212" id="h19-0-212" class="d">-                                notificationData.notification
</a><a href="#h19-0-213" id="h19-0-213" class="d">-                            ) as Notification.Builder
</a><a href="#h19-0-214" id="h19-0-214" class="d">-                            notificationBuilder.setLargeIcon(bitmapPreview)
</a><a href="#h19-0-215" id="h19-0-215" class="d">-                            notificationBuilder.style = Notification.BigPictureStyle().bigPicture(bitmapPreview).bigLargeIcon(null as Bitmap?)
</a><a href="#h19-0-216" id="h19-0-216" class="d">-
</a><a href="#h19-0-217" id="h19-0-217" class="d">-                            sendNotificationData(notificationData.copy(notification = notificationBuilder.build()), true)
</a><a href="#h19-0-218" id="h19-0-218" class="d">-                            return@onEach
</a><a href="#h19-0-219" id="h19-0-219" class="d">-                        }.onFailure {
</a><a href="#h19-0-220" id="h19-0-220" class="d">-                            Logger.xposedLog(&quot;Failed to send preview notification&quot;, it)
</a><a href="#h19-0-221" id="h19-0-221" class="d">-                        }
</a><a href="#h19-0-222" id="h19-0-222" class="d">-                    }
</a><a href="#h19-0-223" id="h19-0-223" class="d">-                }
</a><a href="#h19-0-224" id="h19-0-224" class="d">-                else -&gt; {
</a><a href="#h19-0-225" id="h19-0-225" class="d">-                    notificationCache.add(formatUsername(&quot;sent $contentType&quot;))
</a><a href="#h19-0-226" id="h19-0-226" class="d">-                }
</a><a href="#h19-0-227" id="h19-0-227" class="d">-            }
</a><a href="#h19-0-228" id="h19-0-228" class="d">-
</a><a href="#h19-0-229" id="h19-0-229" class="d">-            if (contentType == ContentType.CHAT) {
</a><a href="#h19-0-230" id="h19-0-230" class="d">-                setupNotificationActionButtons(conversationId, notificationData)
</a><a href="#h19-0-231" id="h19-0-231" class="d">-            }
</a><a href="#h19-0-232" id="h19-0-232" class="d">-
</a><a href="#h19-0-233" id="h19-0-233" class="d">-            sendNotificationData(notificationData, false)
</a><a href="#h19-0-234" id="h19-0-234" class="d">-        }.clear()
</a><a href="#h19-0-235" id="h19-0-235" class="d">-    }
</a><a href="#h19-0-236" id="h19-0-236" class="d">-
</a><a href="#h19-0-237" id="h19-0-237" class="d">-    private fun shouldIgnoreNotification(type: String): Boolean {
</a><a href="#h19-0-238" id="h19-0-238" class="d">-        val states = context.config.options(ConfigProperty.NOTIFICATION_BLACKLIST)
</a><a href="#h19-0-239" id="h19-0-239" class="d">-
</a><a href="#h19-0-240" id="h19-0-240" class="d">-        states[&quot;snap&quot;]?.let { if (type.endsWith(&quot;SNAP&quot;) &amp;&amp; it) return true }
</a><a href="#h19-0-241" id="h19-0-241" class="d">-        states[&quot;chat&quot;]?.let { if (type.endsWith(&quot;CHAT&quot;) &amp;&amp; it) return true }
</a><a href="#h19-0-242" id="h19-0-242" class="d">-        states[&quot;typing&quot;]?.let { if (type.endsWith(&quot;TYPING&quot;) &amp;&amp; it) return true }
</a><a href="#h19-0-243" id="h19-0-243" class="d">-
</a><a href="#h19-0-244" id="h19-0-244" class="d">-        return false
</a><a href="#h19-0-245" id="h19-0-245" class="d">-    }
</a><a href="#h19-0-246" id="h19-0-246" class="d">-
</a><a href="#h19-0-247" id="h19-0-247" class="d">-    override fun init() {
</a><a href="#h19-0-248" id="h19-0-248" class="d">-        setupBroadcastReceiverHook()
</a><a href="#h19-0-249" id="h19-0-249" class="d">-
</a><a href="#h19-0-250" id="h19-0-250" class="d">-        val fetchConversationWithMessagesCallback = context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;FetchConversationWithMessagesCallback&quot;)
</a><a href="#h19-0-251" id="h19-0-251" class="d">-
</a><a href="#h19-0-252" id="h19-0-252" class="d">-        Hooker.hook(notifyAsUserMethod, HookStage.BEFORE) { param -&gt;
</a><a href="#h19-0-253" id="h19-0-253" class="d">-            val notificationData = NotificationData(param.argNullable(0), param.arg(1), param.arg(2), param.arg(3))
</a><a href="#h19-0-254" id="h19-0-254" class="d">-
</a><a href="#h19-0-255" id="h19-0-255" class="d">-            val extras: Bundle = notificationData.notification.extras.getBundle(&quot;system_notification_extras&quot;)?: return@hook
</a><a href="#h19-0-256" id="h19-0-256" class="d">-
</a><a href="#h19-0-257" id="h19-0-257" class="d">-            val messageId = extras.getString(&quot;message_id&quot;) ?: return@hook
</a><a href="#h19-0-258" id="h19-0-258" class="d">-            val notificationType = extras.getString(&quot;notification_type&quot;) ?: return@hook
</a><a href="#h19-0-259" id="h19-0-259" class="d">-            val conversationId = extras.getString(&quot;conversation_id&quot;) ?: return@hook
</a><a href="#h19-0-260" id="h19-0-260" class="d">-
</a><a href="#h19-0-261" id="h19-0-261" class="d">-            if (shouldIgnoreNotification(notificationType)) {
</a><a href="#h19-0-262" id="h19-0-262" class="d">-                param.setResult(null)
</a><a href="#h19-0-263" id="h19-0-263" class="d">-                return@hook
</a><a href="#h19-0-264" id="h19-0-264" class="d">-            }
</a><a href="#h19-0-265" id="h19-0-265" class="d">-
</a><a href="#h19-0-266" id="h19-0-266" class="d">-            if (!context.config.bool(ConfigProperty.SHOW_MESSAGE_CONTENT_IN_NOTIFICATIONS)) return@hook
</a><a href="#h19-0-267" id="h19-0-267" class="d">-
</a><a href="#h19-0-268" id="h19-0-268" class="d">-            if (!notificationType.endsWith(&quot;CHAT&quot;) &amp;&amp; !notificationType.endsWith(&quot;SNAP&quot;)) return@hook
</a><a href="#h19-0-269" id="h19-0-269" class="d">-
</a><a href="#h19-0-270" id="h19-0-270" class="d">-            val conversationManager: Any = context.feature(Messaging::class).conversationManager
</a><a href="#h19-0-271" id="h19-0-271" class="d">-            notificationDataQueue[messageId.toLong()] = notificationData
</a><a href="#h19-0-272" id="h19-0-272" class="d">-
</a><a href="#h19-0-273" id="h19-0-273" class="d">-            val callback = CallbackBuilder(fetchConversationWithMessagesCallback)
</a><a href="#h19-0-274" id="h19-0-274" class="d">-                .override(&quot;onFetchConversationWithMessagesComplete&quot;) { callbackParam -&gt;
</a><a href="#h19-0-275" id="h19-0-275" class="d">-                    val messageList = (callbackParam.arg(1) as List&lt;Any&gt;).map { msg -&gt; Message(msg) }
</a><a href="#h19-0-276" id="h19-0-276" class="d">-                    fetchMessagesResult(conversationId, messageList)
</a><a href="#h19-0-277" id="h19-0-277" class="d">-                }
</a><a href="#h19-0-278" id="h19-0-278" class="d">-                .override(&quot;onError&quot;) {
</a><a href="#h19-0-279" id="h19-0-279" class="d">-                    Logger.xposedLog(&quot;Failed to fetch message ${it.arg(0) as Any}&quot;)
</a><a href="#h19-0-280" id="h19-0-280" class="d">-                }.build()
</a><a href="#h19-0-281" id="h19-0-281" class="d">-
</a><a href="#h19-0-282" id="h19-0-282" class="d">-            fetchConversationWithMessagesMethod.invoke(conversationManager, SnapUUID.fromString(conversationId).instanceNonNull(), callback)
</a><a href="#h19-0-283" id="h19-0-283" class="d">-            param.setResult(null)
</a><a href="#h19-0-284" id="h19-0-284" class="d">-        }
</a><a href="#h19-0-285" id="h19-0-285" class="d">-
</a><a href="#h19-0-286" id="h19-0-286" class="d">-        Hooker.hook(cancelAsUserMethod, HookStage.BEFORE) { param -&gt;
</a><a href="#h19-0-287" id="h19-0-287" class="d">-            val notificationId = param.arg&lt;Int&gt;(1)
</a><a href="#h19-0-288" id="h19-0-288" class="d">-            notificationIdMap[notificationId]?.let {
</a><a href="#h19-0-289" id="h19-0-289" class="d">-                cachedMessages[it]?.clear()
</a><a href="#h19-0-290" id="h19-0-290" class="d">-            }
</a><a href="#h19-0-291" id="h19-0-291" class="d">-        }
</a><a href="#h19-0-292" id="h19-0-292" class="d">-    }
</a><a href="#h19-0-293" id="h19-0-293" class="d">-
</a><a href="#h19-0-294" id="h19-0-294" class="d">-    data class NotificationData(
</a><a href="#h19-0-295" id="h19-0-295" class="d">-        val tag: String?,
</a><a href="#h19-0-296" id="h19-0-296" class="d">-        val id: Int,
</a><a href="#h19-0-297" id="h19-0-297" class="d">-        var notification: Notification,
</a><a href="#h19-0-298" id="h19-0-298" class="d">-        val userHandle: UserHandle
</a><a href="#h19-0-299" id="h19-0-299" class="d">-    )
</a><a href="#h19-0-300" id="h19-0-300" class="d">-}</a><a href="#h19-0-301" id="h19-0-301" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h20" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/SnapchatPlus.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/SnapchatPlus.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/SnapchatPlus.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/SnapchatPlus.kt</a></b>
<a href="#h20-0" id="h20-0" class="h">@@ -1,29 +0,0 @@
</a><a href="#h20-0-0" id="h20-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h20-0-1" id="h20-0-1" class="d">-
</a><a href="#h20-0-2" id="h20-0-2" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h20-0-3" id="h20-0-3" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h20-0-4" id="h20-0-4" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h20-0-5" id="h20-0-5" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h20-0-6" id="h20-0-6" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h20-0-7" id="h20-0-7" class="d">-
</a><a href="#h20-0-8" id="h20-0-8" class="d">-class SnapchatPlus: Feature(&quot;SnapchatPlus&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h20-0-9" id="h20-0-9" class="d">-    private val originalSubscriptionTime = (System.currentTimeMillis() - 7776000000L)
</a><a href="#h20-0-10" id="h20-0-10" class="d">-    private val expirationTimeMillis = (System.currentTimeMillis() + 15552000000L)
</a><a href="#h20-0-11" id="h20-0-11" class="d">-
</a><a href="#h20-0-12" id="h20-0-12" class="d">-    override fun asyncOnActivityCreate() {
</a><a href="#h20-0-13" id="h20-0-13" class="d">-        if (!context.config.bool(ConfigProperty.SNAPCHAT_PLUS)) return
</a><a href="#h20-0-14" id="h20-0-14" class="d">-
</a><a href="#h20-0-15" id="h20-0-15" class="d">-        val subscriptionInfoClass = context.mappings.getMappedClass(&quot;SubscriptionInfoClass&quot;)
</a><a href="#h20-0-16" id="h20-0-16" class="d">-
</a><a href="#h20-0-17" id="h20-0-17" class="d">-        Hooker.hookConstructor(subscriptionInfoClass, HookStage.BEFORE) { param -&gt;
</a><a href="#h20-0-18" id="h20-0-18" class="d">-            if (param.arg&lt;Int&gt;(0) == 2) return@hookConstructor
</a><a href="#h20-0-19" id="h20-0-19" class="d">-            //subscription tier
</a><a href="#h20-0-20" id="h20-0-20" class="d">-            param.setArg(0, 2)
</a><a href="#h20-0-21" id="h20-0-21" class="d">-            //subscription status
</a><a href="#h20-0-22" id="h20-0-22" class="d">-            param.setArg(1, 2)
</a><a href="#h20-0-23" id="h20-0-23" class="d">-
</a><a href="#h20-0-24" id="h20-0-24" class="d">-            param.setArg(2, originalSubscriptionTime)
</a><a href="#h20-0-25" id="h20-0-25" class="d">-            param.setArg(3, expirationTimeMillis)
</a><a href="#h20-0-26" id="h20-0-26" class="d">-        }
</a><a href="#h20-0-27" id="h20-0-27" class="d">-    }
</a><a href="#h20-0-28" id="h20-0-28" class="d">-}</a><a href="#h20-0-29" id="h20-0-29" class="d">-
\ No newline at end of file
</a><b>diff --git a/<a id="h21" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/UnlimitedSnapViewTime.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/UnlimitedSnapViewTime.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/UnlimitedSnapViewTime.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/extras/UnlimitedSnapViewTime.kt</a></b>
<a href="#h21-0" id="h21-0" class="h">@@ -1,36 +0,0 @@
</a><a href="#h21-0-0" id="h21-0-0" class="d">-package me.rhunk.snapenhance.features.impl.extras
</a><a href="#h21-0-1" id="h21-0-1" class="d">-
</a><a href="#h21-0-2" id="h21-0-2" class="d">-import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h21-0-3" id="h21-0-3" class="d">-import me.rhunk.snapenhance.data.ContentType
</a><a href="#h21-0-4" id="h21-0-4" class="d">-import me.rhunk.snapenhance.data.MessageState
</a><a href="#h21-0-5" id="h21-0-5" class="d">-import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h21-0-6" id="h21-0-6" class="d">-import me.rhunk.snapenhance.features.Feature
</a><a href="#h21-0-7" id="h21-0-7" class="d">-import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h21-0-8" id="h21-0-8" class="d">-import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h21-0-9" id="h21-0-9" class="d">-import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h21-0-10" id="h21-0-10" class="d">-import me.rhunk.snapenhance.util.protobuf.ProtoEditor
</a><a href="#h21-0-11" id="h21-0-11" class="d">-import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a><a href="#h21-0-12" id="h21-0-12" class="d">-
</a><a href="#h21-0-13" id="h21-0-13" class="d">-class UnlimitedSnapViewTime :
</a><a href="#h21-0-14" id="h21-0-14" class="d">-    Feature(&quot;UnlimitedSnapViewTime&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h21-0-15" id="h21-0-15" class="d">-    override fun onActivityCreate() {
</a><a href="#h21-0-16" id="h21-0-16" class="d">-        Hooker.hookConstructor(context.classCache.message, HookStage.AFTER, {
</a><a href="#h21-0-17" id="h21-0-17" class="d">-            context.config.bool(ConfigProperty.UNLIMITED_SNAP_VIEW_TIME)
</a><a href="#h21-0-18" id="h21-0-18" class="d">-        }) { param -&gt;
</a><a href="#h21-0-19" id="h21-0-19" class="d">-            val message = Message(param.thisObject())
</a><a href="#h21-0-20" id="h21-0-20" class="d">-            if (message.messageState != MessageState.COMMITTED) return@hookConstructor
</a><a href="#h21-0-21" id="h21-0-21" class="d">-            if (message.messageContent.contentType != ContentType.SNAP) return@hookConstructor
</a><a href="#h21-0-22" id="h21-0-22" class="d">-
</a><a href="#h21-0-23" id="h21-0-23" class="d">-            with(message.messageContent) {
</a><a href="#h21-0-24" id="h21-0-24" class="d">-                val mediaAttributes = ProtoReader(this.content).readPath(11, 5, 2) ?: return@hookConstructor
</a><a href="#h21-0-25" id="h21-0-25" class="d">-                if (mediaAttributes.exists(6)) return@hookConstructor
</a><a href="#h21-0-26" id="h21-0-26" class="d">-                this.content = ProtoEditor(this.content).apply {
</a><a href="#h21-0-27" id="h21-0-27" class="d">-                    edit(11, 5, 2) {
</a><a href="#h21-0-28" id="h21-0-28" class="d">-                        mediaAttributes.getInt(5)?.let { writeConstant(5, it) }
</a><a href="#h21-0-29" id="h21-0-29" class="d">-                        writeBuffer(6, byteArrayOf())
</a><a href="#h21-0-30" id="h21-0-30" class="d">-                    }
</a><a href="#h21-0-31" id="h21-0-31" class="d">-                }.toByteArray()
</a><a href="#h21-0-32" id="h21-0-32" class="d">-            }
</a><a href="#h21-0-33" id="h21-0-33" class="d">-        }
</a><a href="#h21-0-34" id="h21-0-34" class="d">-    }
</a><a href="#h21-0-35" id="h21-0-35" class="d">-}
</a><b>diff --git a/<a id="h22" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AntiAutoSave.kt</a></b>
<a href="#h22-0" id="h22-0" class="h">@@ -0,0 +1,19 @@
</a><a href="#h22-0-0" id="h22-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h22-0-1" id="h22-0-1" class="i">+
</a><a href="#h22-0-2" id="h22-0-2" class="i">+import me.rhunk.snapenhance.bridge.common.impl.file.BridgeFileType
</a><a href="#h22-0-3" id="h22-0-3" class="i">+import me.rhunk.snapenhance.features.BridgeFileFeature
</a><a href="#h22-0-4" id="h22-0-4" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h22-0-5" id="h22-0-5" class="i">+
</a><a href="#h22-0-6" id="h22-0-6" class="i">+class AntiAutoSave : BridgeFileFeature(&quot;AntiAutoSave&quot;, BridgeFileType.ANTI_AUTO_SAVE, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h22-0-7" id="h22-0-7" class="i">+    override fun onActivityCreate() {
</a><a href="#h22-0-8" id="h22-0-8" class="i">+        readFile()
</a><a href="#h22-0-9" id="h22-0-9" class="i">+    }
</a><a href="#h22-0-10" id="h22-0-10" class="i">+
</a><a href="#h22-0-11" id="h22-0-11" class="i">+    fun setConversationIgnored(userId: String, state: Boolean) {
</a><a href="#h22-0-12" id="h22-0-12" class="i">+        setState(userId.hashCode().toLong().toString(16), state)
</a><a href="#h22-0-13" id="h22-0-13" class="i">+    }
</a><a href="#h22-0-14" id="h22-0-14" class="i">+
</a><a href="#h22-0-15" id="h22-0-15" class="i">+    fun isConversationIgnored(userId: String): Boolean {
</a><a href="#h22-0-16" id="h22-0-16" class="i">+        return exists(userId.hashCode().toLong().toString(16))
</a><a href="#h22-0-17" id="h22-0-17" class="i">+    }
</a><a href="#h22-0-18" id="h22-0-18" class="i">+}</a><a href="#h22-0-19" id="h22-0-19" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h23" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/AutoSave.kt</a></b>
<a href="#h23-0" id="h23-0" class="h">@@ -0,0 +1,134 @@
</a><a href="#h23-0-0" id="h23-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h23-0-1" id="h23-0-1" class="i">+
</a><a href="#h23-0-2" id="h23-0-2" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h23-0-3" id="h23-0-3" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h23-0-4" id="h23-0-4" class="i">+import me.rhunk.snapenhance.data.MessageState
</a><a href="#h23-0-5" id="h23-0-5" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h23-0-6" id="h23-0-6" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a><a href="#h23-0-7" id="h23-0-7" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h23-0-8" id="h23-0-8" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h23-0-9" id="h23-0-9" class="i">+import me.rhunk.snapenhance.features.impl.Messaging
</a><a href="#h23-0-10" id="h23-0-10" class="i">+import me.rhunk.snapenhance.features.impl.spying.MessageLogger
</a><a href="#h23-0-11" id="h23-0-11" class="i">+import me.rhunk.snapenhance.features.impl.spying.StealthMode
</a><a href="#h23-0-12" id="h23-0-12" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h23-0-13" id="h23-0-13" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h23-0-14" id="h23-0-14" class="i">+import me.rhunk.snapenhance.util.CallbackBuilder
</a><a href="#h23-0-15" id="h23-0-15" class="i">+import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h23-0-16" id="h23-0-16" class="i">+import java.util.concurrent.Executors
</a><a href="#h23-0-17" id="h23-0-17" class="i">+
</a><a href="#h23-0-18" id="h23-0-18" class="i">+class AutoSave : Feature(&quot;Auto Save&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h23-0-19" id="h23-0-19" class="i">+    private val asyncSaveExecutorService = Executors.newSingleThreadExecutor()
</a><a href="#h23-0-20" id="h23-0-20" class="i">+
</a><a href="#h23-0-21" id="h23-0-21" class="i">+    private val messageLogger by lazy { context.feature(MessageLogger::class) }
</a><a href="#h23-0-22" id="h23-0-22" class="i">+    private val messaging by lazy { context.feature(Messaging::class) }
</a><a href="#h23-0-23" id="h23-0-23" class="i">+
</a><a href="#h23-0-24" id="h23-0-24" class="i">+    private val myUserId by lazy { context.database.getMyUserId() }
</a><a href="#h23-0-25" id="h23-0-25" class="i">+
</a><a href="#h23-0-26" id="h23-0-26" class="i">+    private val fetchConversationWithMessagesCallbackClass by lazy {  context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;FetchConversationWithMessagesCallback&quot;) }
</a><a href="#h23-0-27" id="h23-0-27" class="i">+    private val callbackClass by lazy {  context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;Callback&quot;) }
</a><a href="#h23-0-28" id="h23-0-28" class="i">+
</a><a href="#h23-0-29" id="h23-0-29" class="i">+    private val updateMessageMethod by lazy { context.classCache.conversationManager.methods.first { it.name == &quot;updateMessage&quot; } }
</a><a href="#h23-0-30" id="h23-0-30" class="i">+    private val fetchConversationWithMessagesPaginatedMethod by lazy {
</a><a href="#h23-0-31" id="h23-0-31" class="i">+        context.classCache.conversationManager.methods.first { it.name == &quot;fetchConversationWithMessagesPaginated&quot; }
</a><a href="#h23-0-32" id="h23-0-32" class="i">+    }
</a><a href="#h23-0-33" id="h23-0-33" class="i">+
</a><a href="#h23-0-34" id="h23-0-34" class="i">+    private fun saveMessage(conversationId: SnapUUID, message: Message) {
</a><a href="#h23-0-35" id="h23-0-35" class="i">+        val messageId = message.messageDescriptor.messageId
</a><a href="#h23-0-36" id="h23-0-36" class="i">+        if (messageLogger.isMessageRemoved(messageId)) return
</a><a href="#h23-0-37" id="h23-0-37" class="i">+        if (message.messageState != MessageState.COMMITTED) return
</a><a href="#h23-0-38" id="h23-0-38" class="i">+
</a><a href="#h23-0-39" id="h23-0-39" class="i">+        val callback = CallbackBuilder(callbackClass)
</a><a href="#h23-0-40" id="h23-0-40" class="i">+            .override(&quot;onError&quot;) {
</a><a href="#h23-0-41" id="h23-0-41" class="i">+                Logger.xposedLog(&quot;Error saving message $messageId&quot;)
</a><a href="#h23-0-42" id="h23-0-42" class="i">+            }.build()
</a><a href="#h23-0-43" id="h23-0-43" class="i">+
</a><a href="#h23-0-44" id="h23-0-44" class="i">+        runCatching {
</a><a href="#h23-0-45" id="h23-0-45" class="i">+            updateMessageMethod.invoke(
</a><a href="#h23-0-46" id="h23-0-46" class="i">+                context.feature(Messaging::class).conversationManager,
</a><a href="#h23-0-47" id="h23-0-47" class="i">+                conversationId.instanceNonNull(),
</a><a href="#h23-0-48" id="h23-0-48" class="i">+                messageId,
</a><a href="#h23-0-49" id="h23-0-49" class="i">+                context.classCache.messageUpdateEnum.enumConstants.first { it.toString() == &quot;SAVE&quot; },
</a><a href="#h23-0-50" id="h23-0-50" class="i">+                callback
</a><a href="#h23-0-51" id="h23-0-51" class="i">+            )
</a><a href="#h23-0-52" id="h23-0-52" class="i">+        }.onFailure {
</a><a href="#h23-0-53" id="h23-0-53" class="i">+            Logger.xposedLog(&quot;Error saving message $messageId&quot;, it)
</a><a href="#h23-0-54" id="h23-0-54" class="i">+        }
</a><a href="#h23-0-55" id="h23-0-55" class="i">+
</a><a href="#h23-0-56" id="h23-0-56" class="i">+        //delay between saves
</a><a href="#h23-0-57" id="h23-0-57" class="i">+        Thread.sleep(100L)
</a><a href="#h23-0-58" id="h23-0-58" class="i">+    }
</a><a href="#h23-0-59" id="h23-0-59" class="i">+
</a><a href="#h23-0-60" id="h23-0-60" class="i">+    private fun canSaveMessage(message: Message): Boolean {
</a><a href="#h23-0-61" id="h23-0-61" class="i">+        if (message.messageMetadata.savedBy.any { uuid -&gt; uuid.toString() == myUserId }) return false
</a><a href="#h23-0-62" id="h23-0-62" class="i">+        val contentType = message.messageContent.contentType.toString()
</a><a href="#h23-0-63" id="h23-0-63" class="i">+
</a><a href="#h23-0-64" id="h23-0-64" class="i">+        return context.config.options(ConfigProperty.AUTO_SAVE_MESSAGES).filter { it.value }.any { it.key == contentType }
</a><a href="#h23-0-65" id="h23-0-65" class="i">+    }
</a><a href="#h23-0-66" id="h23-0-66" class="i">+
</a><a href="#h23-0-67" id="h23-0-67" class="i">+    private fun canSave(): Boolean {
</a><a href="#h23-0-68" id="h23-0-68" class="i">+        if (context.config.options(ConfigProperty.AUTO_SAVE_MESSAGES).none { it.value }) return false
</a><a href="#h23-0-69" id="h23-0-69" class="i">+
</a><a href="#h23-0-70" id="h23-0-70" class="i">+        with(context.feature(Messaging::class)) {
</a><a href="#h23-0-71" id="h23-0-71" class="i">+            if (lastOpenedConversationUUID == null) return@canSave false
</a><a href="#h23-0-72" id="h23-0-72" class="i">+            val conversation = lastOpenedConversationUUID.toString()
</a><a href="#h23-0-73" id="h23-0-73" class="i">+            if (context.feature(StealthMode::class).isStealth(conversation)) return@canSave false
</a><a href="#h23-0-74" id="h23-0-74" class="i">+            if (context.feature(AntiAutoSave::class).isConversationIgnored(conversation)) return@canSave false
</a><a href="#h23-0-75" id="h23-0-75" class="i">+        }
</a><a href="#h23-0-76" id="h23-0-76" class="i">+        return true
</a><a href="#h23-0-77" id="h23-0-77" class="i">+    }
</a><a href="#h23-0-78" id="h23-0-78" class="i">+
</a><a href="#h23-0-79" id="h23-0-79" class="i">+    override fun asyncOnActivityCreate() {
</a><a href="#h23-0-80" id="h23-0-80" class="i">+        //called when enter in a conversation (or when a message is sent)
</a><a href="#h23-0-81" id="h23-0-81" class="i">+        Hooker.hook(
</a><a href="#h23-0-82" id="h23-0-82" class="i">+            context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;FetchConversationWithMessagesCallback&quot;),
</a><a href="#h23-0-83" id="h23-0-83" class="i">+            &quot;onFetchConversationWithMessagesComplete&quot;,
</a><a href="#h23-0-84" id="h23-0-84" class="i">+            HookStage.BEFORE,
</a><a href="#h23-0-85" id="h23-0-85" class="i">+            { canSave() }
</a><a href="#h23-0-86" id="h23-0-86" class="i">+        ) { param -&gt;
</a><a href="#h23-0-87" id="h23-0-87" class="i">+            val conversationId = SnapUUID(param.arg&lt;Any&gt;(0).getObjectField(&quot;mConversationId&quot;)!!)
</a><a href="#h23-0-88" id="h23-0-88" class="i">+            val messages = param.arg&lt;List&lt;Any&gt;&gt;(1).map { Message(it) }
</a><a href="#h23-0-89" id="h23-0-89" class="i">+            messages.forEach {
</a><a href="#h23-0-90" id="h23-0-90" class="i">+                if (!canSaveMessage(it)) return@forEach
</a><a href="#h23-0-91" id="h23-0-91" class="i">+                asyncSaveExecutorService.submit {
</a><a href="#h23-0-92" id="h23-0-92" class="i">+                    saveMessage(conversationId, it)
</a><a href="#h23-0-93" id="h23-0-93" class="i">+                }
</a><a href="#h23-0-94" id="h23-0-94" class="i">+            }
</a><a href="#h23-0-95" id="h23-0-95" class="i">+        }
</a><a href="#h23-0-96" id="h23-0-96" class="i">+
</a><a href="#h23-0-97" id="h23-0-97" class="i">+        //called when a message is received
</a><a href="#h23-0-98" id="h23-0-98" class="i">+        Hooker.hook(
</a><a href="#h23-0-99" id="h23-0-99" class="i">+            context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;FetchMessageCallback&quot;),
</a><a href="#h23-0-100" id="h23-0-100" class="i">+            &quot;onFetchMessageComplete&quot;,
</a><a href="#h23-0-101" id="h23-0-101" class="i">+            HookStage.BEFORE,
</a><a href="#h23-0-102" id="h23-0-102" class="i">+            { canSave() }
</a><a href="#h23-0-103" id="h23-0-103" class="i">+        ) { param -&gt;
</a><a href="#h23-0-104" id="h23-0-104" class="i">+            val message = Message(param.arg(0))
</a><a href="#h23-0-105" id="h23-0-105" class="i">+            if (!canSaveMessage(message)) return@hook
</a><a href="#h23-0-106" id="h23-0-106" class="i">+            val conversationId = message.messageDescriptor.conversationId
</a><a href="#h23-0-107" id="h23-0-107" class="i">+
</a><a href="#h23-0-108" id="h23-0-108" class="i">+            asyncSaveExecutorService.submit {
</a><a href="#h23-0-109" id="h23-0-109" class="i">+                saveMessage(conversationId, message)
</a><a href="#h23-0-110" id="h23-0-110" class="i">+            }
</a><a href="#h23-0-111" id="h23-0-111" class="i">+        }
</a><a href="#h23-0-112" id="h23-0-112" class="i">+
</a><a href="#h23-0-113" id="h23-0-113" class="i">+        Hooker.hook(
</a><a href="#h23-0-114" id="h23-0-114" class="i">+            context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;SendMessageCallback&quot;),
</a><a href="#h23-0-115" id="h23-0-115" class="i">+            &quot;onSuccess&quot;,
</a><a href="#h23-0-116" id="h23-0-116" class="i">+            HookStage.BEFORE,
</a><a href="#h23-0-117" id="h23-0-117" class="i">+            { canSave() }
</a><a href="#h23-0-118" id="h23-0-118" class="i">+        ) {
</a><a href="#h23-0-119" id="h23-0-119" class="i">+            val callback = CallbackBuilder(fetchConversationWithMessagesCallbackClass).build()
</a><a href="#h23-0-120" id="h23-0-120" class="i">+            runCatching {
</a><a href="#h23-0-121" id="h23-0-121" class="i">+                fetchConversationWithMessagesPaginatedMethod.invoke(
</a><a href="#h23-0-122" id="h23-0-122" class="i">+                    messaging.conversationManager, messaging.lastOpenedConversationUUID!!.instanceNonNull(),
</a><a href="#h23-0-123" id="h23-0-123" class="i">+                    Long.MAX_VALUE,
</a><a href="#h23-0-124" id="h23-0-124" class="i">+                    3,
</a><a href="#h23-0-125" id="h23-0-125" class="i">+                    callback
</a><a href="#h23-0-126" id="h23-0-126" class="i">+                )
</a><a href="#h23-0-127" id="h23-0-127" class="i">+            }.onFailure {
</a><a href="#h23-0-128" id="h23-0-128" class="i">+                Logger.xposedLog(&quot;failed to save message&quot;, it)
</a><a href="#h23-0-129" id="h23-0-129" class="i">+            }
</a><a href="#h23-0-130" id="h23-0-130" class="i">+        }
</a><a href="#h23-0-131" id="h23-0-131" class="i">+
</a><a href="#h23-0-132" id="h23-0-132" class="i">+    }
</a><a href="#h23-0-133" id="h23-0-133" class="i">+}</a><a href="#h23-0-134" id="h23-0-134" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h24" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/DisableVideoLengthRestriction.kt</a></b>
<a href="#h24-0" id="h24-0" class="h">@@ -0,0 +1,25 @@
</a><a href="#h24-0-0" id="h24-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h24-0-1" id="h24-0-1" class="i">+
</a><a href="#h24-0-2" id="h24-0-2" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h24-0-3" id="h24-0-3" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h24-0-4" id="h24-0-4" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h24-0-5" id="h24-0-5" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h24-0-6" id="h24-0-6" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h24-0-7" id="h24-0-7" class="i">+import me.rhunk.snapenhance.util.getObjectField
</a><a href="#h24-0-8" id="h24-0-8" class="i">+import me.rhunk.snapenhance.util.setObjectField
</a><a href="#h24-0-9" id="h24-0-9" class="i">+
</a><a href="#h24-0-10" id="h24-0-10" class="i">+class DisableVideoLengthRestriction : Feature(&quot;DisableVideoLengthRestriction&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h24-0-11" id="h24-0-11" class="i">+    override fun asyncOnActivityCreate() {
</a><a href="#h24-0-12" id="h24-0-12" class="i">+        val gridMediaItem = context.mappings.getMappedClass(&quot;GridMediaItem&quot;)
</a><a href="#h24-0-13" id="h24-0-13" class="i">+        val gridMediaItemDurationFieldName = context.mappings.getMappedValue(&quot;GridMediaItemDurationField&quot;)
</a><a href="#h24-0-14" id="h24-0-14" class="i">+
</a><a href="#h24-0-15" id="h24-0-15" class="i">+        Hooker.hookConstructor(gridMediaItem, HookStage.AFTER, {
</a><a href="#h24-0-16" id="h24-0-16" class="i">+            context.config.bool(ConfigProperty.DISABLE_VIDEO_LENGTH_RESTRICTION)
</a><a href="#h24-0-17" id="h24-0-17" class="i">+        }) {param -&gt;
</a><a href="#h24-0-18" id="h24-0-18" class="i">+            val durationMs = param.thisObject&lt;Any&gt;().getObjectField(gridMediaItemDurationFieldName) as Double
</a><a href="#h24-0-19" id="h24-0-19" class="i">+            if (durationMs &gt; 60000) {
</a><a href="#h24-0-20" id="h24-0-20" class="i">+                param.thisObject&lt;Any&gt;().setObjectField(gridMediaItemDurationFieldName, 60000)
</a><a href="#h24-0-21" id="h24-0-21" class="i">+            }
</a><a href="#h24-0-22" id="h24-0-22" class="i">+        }
</a><a href="#h24-0-23" id="h24-0-23" class="i">+    }
</a><a href="#h24-0-24" id="h24-0-24" class="i">+}</a><a href="#h24-0-25" id="h24-0-25" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h25" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/GalleryMediaSendOverride.kt</a></b>
<a href="#h25-0" id="h25-0" class="h">@@ -0,0 +1,37 @@
</a><a href="#h25-0-0" id="h25-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h25-0-1" id="h25-0-1" class="i">+
</a><a href="#h25-0-2" id="h25-0-2" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h25-0-3" id="h25-0-3" class="i">+import me.rhunk.snapenhance.data.ContentType
</a><a href="#h25-0-4" id="h25-0-4" class="i">+import me.rhunk.snapenhance.data.MessageSender
</a><a href="#h25-0-5" id="h25-0-5" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.MessageContent
</a><a href="#h25-0-6" id="h25-0-6" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h25-0-7" id="h25-0-7" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h25-0-8" id="h25-0-8" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h25-0-9" id="h25-0-9" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h25-0-10" id="h25-0-10" class="i">+import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a><a href="#h25-0-11" id="h25-0-11" class="i">+
</a><a href="#h25-0-12" id="h25-0-12" class="i">+class GalleryMediaSendOverride : Feature(&quot;Gallery Media Send Override&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
</a><a href="#h25-0-13" id="h25-0-13" class="i">+
</a><a href="#h25-0-14" id="h25-0-14" class="i">+    override fun init() {
</a><a href="#h25-0-15" id="h25-0-15" class="i">+        Hooker.hook(context.classCache.conversationManager, &quot;sendMessageWithContent&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h25-0-16" id="h25-0-16" class="i">+            val localMessageContent = MessageContent(param.arg(1))
</a><a href="#h25-0-17" id="h25-0-17" class="i">+
</a><a href="#h25-0-18" id="h25-0-18" class="i">+            if (localMessageContent.contentType != ContentType.EXTERNAL_MEDIA) return@hook
</a><a href="#h25-0-19" id="h25-0-19" class="i">+            //story replies
</a><a href="#h25-0-20" id="h25-0-20" class="i">+            val messageProtoReader = ProtoReader(localMessageContent.content)
</a><a href="#h25-0-21" id="h25-0-21" class="i">+            if (messageProtoReader.exists(7)) return@hook
</a><a href="#h25-0-22" id="h25-0-22" class="i">+
</a><a href="#h25-0-23" id="h25-0-23" class="i">+            when (val overrideType = context.config.state(ConfigProperty.GALLERY_MEDIA_SEND_OVERRIDE)) {
</a><a href="#h25-0-24" id="h25-0-24" class="i">+                &quot;SNAP&quot;, &quot;LIVE_SNAP&quot; -&gt; {
</a><a href="#h25-0-25" id="h25-0-25" class="i">+                    localMessageContent.contentType = ContentType.SNAP
</a><a href="#h25-0-26" id="h25-0-26" class="i">+                    localMessageContent.content = MessageSender.redSnapProto(overrideType == &quot;LIVE_SNAP&quot;)
</a><a href="#h25-0-27" id="h25-0-27" class="i">+                }
</a><a href="#h25-0-28" id="h25-0-28" class="i">+                &quot;NOTE&quot; -&gt; {
</a><a href="#h25-0-29" id="h25-0-29" class="i">+                    localMessageContent.contentType = ContentType.NOTE
</a><a href="#h25-0-30" id="h25-0-30" class="i">+                    val mediaDuration = messageProtoReader.getInt(3, 3, 5, 1, 1, 15) ?: 0
</a><a href="#h25-0-31" id="h25-0-31" class="i">+                    localMessageContent.content = MessageSender.audioNoteProto(mediaDuration)
</a><a href="#h25-0-32" id="h25-0-32" class="i">+                }
</a><a href="#h25-0-33" id="h25-0-33" class="i">+            }
</a><a href="#h25-0-34" id="h25-0-34" class="i">+        }
</a><a href="#h25-0-35" id="h25-0-35" class="i">+    }
</a><a href="#h25-0-36" id="h25-0-36" class="i">+}</a><a href="#h25-0-37" id="h25-0-37" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h26" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/LocationSpoofer.kt</a></b>
<a href="#h26-0" id="h26-0" class="h">@@ -0,0 +1,64 @@
</a><a href="#h26-0-0" id="h26-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h26-0-1" id="h26-0-1" class="i">+
</a><a href="#h26-0-2" id="h26-0-2" class="i">+import android.content.Intent
</a><a href="#h26-0-3" id="h26-0-3" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h26-0-4" id="h26-0-4" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h26-0-5" id="h26-0-5" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h26-0-6" id="h26-0-6" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h26-0-7" id="h26-0-7" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h26-0-8" id="h26-0-8" class="i">+
</a><a href="#h26-0-9" id="h26-0-9" class="i">+class LocationSpoofer: Feature(&quot;LocationSpoof&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h26-0-10" id="h26-0-10" class="i">+    override fun asyncOnActivityCreate() {
</a><a href="#h26-0-11" id="h26-0-11" class="i">+        Hooker.hook(context.mainActivity!!.javaClass, &quot;onActivityResult&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h26-0-12" id="h26-0-12" class="i">+            val intent = param.argNullable&lt;Intent&gt;(2) ?: return@hook
</a><a href="#h26-0-13" id="h26-0-13" class="i">+            val bundle = intent.getBundleExtra(&quot;location&quot;) ?: return@hook
</a><a href="#h26-0-14" id="h26-0-14" class="i">+            param.setResult(null)
</a><a href="#h26-0-15" id="h26-0-15" class="i">+            val latitude = bundle.getFloat(&quot;latitude&quot;)
</a><a href="#h26-0-16" id="h26-0-16" class="i">+            val longitude = bundle.getFloat(&quot;longitude&quot;)
</a><a href="#h26-0-17" id="h26-0-17" class="i">+
</a><a href="#h26-0-18" id="h26-0-18" class="i">+            with(context.config) {
</a><a href="#h26-0-19" id="h26-0-19" class="i">+                get(ConfigProperty.LATITUDE).writeFrom(latitude.toString())
</a><a href="#h26-0-20" id="h26-0-20" class="i">+                get(ConfigProperty.LONGITUDE).writeFrom(longitude.toString())
</a><a href="#h26-0-21" id="h26-0-21" class="i">+                writeConfig()
</a><a href="#h26-0-22" id="h26-0-22" class="i">+            }
</a><a href="#h26-0-23" id="h26-0-23" class="i">+            context.longToast(&quot;Location set to $latitude, $longitude&quot;)
</a><a href="#h26-0-24" id="h26-0-24" class="i">+        }
</a><a href="#h26-0-25" id="h26-0-25" class="i">+
</a><a href="#h26-0-26" id="h26-0-26" class="i">+        if (!context.config.bool(ConfigProperty.LOCATION_SPOOF)) return
</a><a href="#h26-0-27" id="h26-0-27" class="i">+        val locationClass = android.location.Location::class.java
</a><a href="#h26-0-28" id="h26-0-28" class="i">+        val locationManagerClass = android.location.LocationManager::class.java
</a><a href="#h26-0-29" id="h26-0-29" class="i">+
</a><a href="#h26-0-30" id="h26-0-30" class="i">+        Hooker.hook(locationClass, &quot;getLatitude&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h26-0-31" id="h26-0-31" class="i">+            hookAdapter.setResult(getLatitude())
</a><a href="#h26-0-32" id="h26-0-32" class="i">+        }
</a><a href="#h26-0-33" id="h26-0-33" class="i">+
</a><a href="#h26-0-34" id="h26-0-34" class="i">+        Hooker.hook(locationClass, &quot;getLongitude&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h26-0-35" id="h26-0-35" class="i">+            hookAdapter.setResult(getLongitude())
</a><a href="#h26-0-36" id="h26-0-36" class="i">+        }
</a><a href="#h26-0-37" id="h26-0-37" class="i">+
</a><a href="#h26-0-38" id="h26-0-38" class="i">+        Hooker.hook(locationClass, &quot;getAccuracy&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h26-0-39" id="h26-0-39" class="i">+            hookAdapter.setResult(getAccuracy())
</a><a href="#h26-0-40" id="h26-0-40" class="i">+        }
</a><a href="#h26-0-41" id="h26-0-41" class="i">+
</a><a href="#h26-0-42" id="h26-0-42" class="i">+        //Might be redundant because it calls isProviderEnabledForUser which we also hook, meaning if isProviderEnabledForUser returns true this will also return true
</a><a href="#h26-0-43" id="h26-0-43" class="i">+        Hooker.hook(locationManagerClass, &quot;isProviderEnabled&quot;, HookStage.BEFORE) { hookAdapter -&gt;
</a><a href="#h26-0-44" id="h26-0-44" class="i">+            hookAdapter.setResult(true)
</a><a href="#h26-0-45" id="h26-0-45" class="i">+        }
</a><a href="#h26-0-46" id="h26-0-46" class="i">+        
</a><a href="#h26-0-47" id="h26-0-47" class="i">+        Hooker.hook(locationManagerClass, &quot;isProviderEnabledForUser&quot;, HookStage.BEFORE) {hookAdapter -&gt;
</a><a href="#h26-0-48" id="h26-0-48" class="i">+            hookAdapter.setResult(true)
</a><a href="#h26-0-49" id="h26-0-49" class="i">+        }
</a><a href="#h26-0-50" id="h26-0-50" class="i">+    }
</a><a href="#h26-0-51" id="h26-0-51" class="i">+
</a><a href="#h26-0-52" id="h26-0-52" class="i">+    private fun getLatitude():Double {
</a><a href="#h26-0-53" id="h26-0-53" class="i">+        return context.config.string(ConfigProperty.LATITUDE).toDouble()
</a><a href="#h26-0-54" id="h26-0-54" class="i">+    }
</a><a href="#h26-0-55" id="h26-0-55" class="i">+
</a><a href="#h26-0-56" id="h26-0-56" class="i">+    private fun getLongitude():Double {
</a><a href="#h26-0-57" id="h26-0-57" class="i">+        return context.config.string(ConfigProperty.LONGITUDE).toDouble()
</a><a href="#h26-0-58" id="h26-0-58" class="i">+    }
</a><a href="#h26-0-59" id="h26-0-59" class="i">+
</a><a href="#h26-0-60" id="h26-0-60" class="i">+    private fun getAccuracy():Float {
</a><a href="#h26-0-61" id="h26-0-61" class="i">+        return 0.0f
</a><a href="#h26-0-62" id="h26-0-62" class="i">+    }
</a><a href="#h26-0-63" id="h26-0-63" class="i">+}</a><a href="#h26-0-64" id="h26-0-64" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h27" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/MediaQualityLevelOverride.kt</a></b>
<a href="#h27-0" id="h27-0" class="h">@@ -0,0 +1,26 @@
</a><a href="#h27-0-0" id="h27-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h27-0-1" id="h27-0-1" class="i">+
</a><a href="#h27-0-2" id="h27-0-2" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h27-0-3" id="h27-0-3" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h27-0-4" id="h27-0-4" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h27-0-5" id="h27-0-5" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h27-0-6" id="h27-0-6" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h27-0-7" id="h27-0-7" class="i">+
</a><a href="#h27-0-8" id="h27-0-8" class="i">+class MediaQualityLevelOverride : Feature(&quot;MediaQualityLevelOverride&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
</a><a href="#h27-0-9" id="h27-0-9" class="i">+    override fun init() {
</a><a href="#h27-0-10" id="h27-0-10" class="i">+        val enumQualityLevel = context.mappings.getMappedClass(&quot;enums&quot;, &quot;QualityLevel&quot;)
</a><a href="#h27-0-11" id="h27-0-11" class="i">+
</a><a href="#h27-0-12" id="h27-0-12" class="i">+        Hooker.hook(context.mappings.getMappedClass(&quot;MediaQualityLevelProvider&quot;),
</a><a href="#h27-0-13" id="h27-0-13" class="i">+            context.mappings.getMappedValue(&quot;MediaQualityLevelProviderMethod&quot;),
</a><a href="#h27-0-14" id="h27-0-14" class="i">+            HookStage.BEFORE,
</a><a href="#h27-0-15" id="h27-0-15" class="i">+            {context.config.bool(ConfigProperty.OVERRIDE_MEDIA_QUALITY)}
</a><a href="#h27-0-16" id="h27-0-16" class="i">+        ) { param -&gt;
</a><a href="#h27-0-17" id="h27-0-17" class="i">+            val currentCompressionLevel = enumQualityLevel.enumConstants
</a><a href="#h27-0-18" id="h27-0-18" class="i">+                .firstOrNull { it.toString() == context.config.state(ConfigProperty.MEDIA_QUALITY_LEVEL)} ?: run {
</a><a href="#h27-0-19" id="h27-0-19" class="i">+                context.longToast(&quot;Invalid media quality level: ${context.config.state(ConfigProperty.MEDIA_QUALITY_LEVEL)}&quot;)
</a><a href="#h27-0-20" id="h27-0-20" class="i">+                return@hook
</a><a href="#h27-0-21" id="h27-0-21" class="i">+            }
</a><a href="#h27-0-22" id="h27-0-22" class="i">+            param.setResult(currentCompressionLevel)
</a><a href="#h27-0-23" id="h27-0-23" class="i">+        }
</a><a href="#h27-0-24" id="h27-0-24" class="i">+    }
</a><a href="#h27-0-25" id="h27-0-25" class="i">+}</a><a href="#h27-0-26" id="h27-0-26" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h28" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/Notifications.kt</a></b>
<a href="#h28-0" id="h28-0" class="h">@@ -0,0 +1,300 @@
</a><a href="#h28-0-0" id="h28-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h28-0-1" id="h28-0-1" class="i">+
</a><a href="#h28-0-2" id="h28-0-2" class="i">+import android.app.Notification
</a><a href="#h28-0-3" id="h28-0-3" class="i">+import android.app.NotificationManager
</a><a href="#h28-0-4" id="h28-0-4" class="i">+import android.app.PendingIntent
</a><a href="#h28-0-5" id="h28-0-5" class="i">+import android.app.RemoteInput
</a><a href="#h28-0-6" id="h28-0-6" class="i">+import android.content.Context
</a><a href="#h28-0-7" id="h28-0-7" class="i">+import android.content.Intent
</a><a href="#h28-0-8" id="h28-0-8" class="i">+import android.graphics.Bitmap
</a><a href="#h28-0-9" id="h28-0-9" class="i">+import android.os.Bundle
</a><a href="#h28-0-10" id="h28-0-10" class="i">+import android.os.UserHandle
</a><a href="#h28-0-11" id="h28-0-11" class="i">+import de.robv.android.xposed.XposedBridge
</a><a href="#h28-0-12" id="h28-0-12" class="i">+import de.robv.android.xposed.XposedHelpers
</a><a href="#h28-0-13" id="h28-0-13" class="i">+import me.rhunk.snapenhance.Constants
</a><a href="#h28-0-14" id="h28-0-14" class="i">+import me.rhunk.snapenhance.Logger
</a><a href="#h28-0-15" id="h28-0-15" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h28-0-16" id="h28-0-16" class="i">+import me.rhunk.snapenhance.data.ContentType
</a><a href="#h28-0-17" id="h28-0-17" class="i">+import me.rhunk.snapenhance.data.MediaReferenceType
</a><a href="#h28-0-18" id="h28-0-18" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h28-0-19" id="h28-0-19" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.SnapUUID
</a><a href="#h28-0-20" id="h28-0-20" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h28-0-21" id="h28-0-21" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h28-0-22" id="h28-0-22" class="i">+import me.rhunk.snapenhance.features.impl.Messaging
</a><a href="#h28-0-23" id="h28-0-23" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h28-0-24" id="h28-0-24" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h28-0-25" id="h28-0-25" class="i">+import me.rhunk.snapenhance.util.CallbackBuilder
</a><a href="#h28-0-26" id="h28-0-26" class="i">+import me.rhunk.snapenhance.util.EncryptionUtils
</a><a href="#h28-0-27" id="h28-0-27" class="i">+import me.rhunk.snapenhance.util.MediaDownloaderHelper
</a><a href="#h28-0-28" id="h28-0-28" class="i">+import me.rhunk.snapenhance.util.MediaType
</a><a href="#h28-0-29" id="h28-0-29" class="i">+import me.rhunk.snapenhance.util.PreviewUtils
</a><a href="#h28-0-30" id="h28-0-30" class="i">+import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a><a href="#h28-0-31" id="h28-0-31" class="i">+
</a><a href="#h28-0-32" id="h28-0-32" class="i">+class Notifications : Feature(&quot;Notifications&quot;, loadParams = FeatureLoadParams.INIT_SYNC) {
</a><a href="#h28-0-33" id="h28-0-33" class="i">+    companion object{
</a><a href="#h28-0-34" id="h28-0-34" class="i">+        const val ACTION_REPLY = &quot;me.rhunk.snapenhance.action.REPLY&quot;
</a><a href="#h28-0-35" id="h28-0-35" class="i">+    }
</a><a href="#h28-0-36" id="h28-0-36" class="i">+
</a><a href="#h28-0-37" id="h28-0-37" class="i">+    private val notificationDataQueue = mutableMapOf&lt;Long, NotificationData&gt;() // messageId =&gt; notification
</a><a href="#h28-0-38" id="h28-0-38" class="i">+    private val cachedMessages = mutableMapOf&lt;String, MutableList&lt;String&gt;&gt;() // conversationId =&gt; cached messages
</a><a href="#h28-0-39" id="h28-0-39" class="i">+    private val notificationIdMap = mutableMapOf&lt;Int, String&gt;() // notificationId =&gt; conversationId
</a><a href="#h28-0-40" id="h28-0-40" class="i">+
</a><a href="#h28-0-41" id="h28-0-41" class="i">+    private val broadcastReceiverClass by lazy {
</a><a href="#h28-0-42" id="h28-0-42" class="i">+        context.androidContext.classLoader.loadClass(&quot;com.snap.widgets.core.BestFriendsWidgetProvider&quot;)
</a><a href="#h28-0-43" id="h28-0-43" class="i">+    }
</a><a href="#h28-0-44" id="h28-0-44" class="i">+
</a><a href="#h28-0-45" id="h28-0-45" class="i">+    private val notifyAsUserMethod by lazy {
</a><a href="#h28-0-46" id="h28-0-46" class="i">+        XposedHelpers.findMethodExact(
</a><a href="#h28-0-47" id="h28-0-47" class="i">+            NotificationManager::class.java, &quot;notifyAsUser&quot;,
</a><a href="#h28-0-48" id="h28-0-48" class="i">+            String::class.java,
</a><a href="#h28-0-49" id="h28-0-49" class="i">+            Int::class.javaPrimitiveType,
</a><a href="#h28-0-50" id="h28-0-50" class="i">+            Notification::class.java,
</a><a href="#h28-0-51" id="h28-0-51" class="i">+            UserHandle::class.java
</a><a href="#h28-0-52" id="h28-0-52" class="i">+        )
</a><a href="#h28-0-53" id="h28-0-53" class="i">+    }
</a><a href="#h28-0-54" id="h28-0-54" class="i">+
</a><a href="#h28-0-55" id="h28-0-55" class="i">+    private val cancelAsUserMethod by lazy {
</a><a href="#h28-0-56" id="h28-0-56" class="i">+        XposedHelpers.findMethodExact(NotificationManager::class.java, &quot;cancelAsUser&quot;, String::class.java, Int::class.javaPrimitiveType, UserHandle::class.java)
</a><a href="#h28-0-57" id="h28-0-57" class="i">+    }
</a><a href="#h28-0-58" id="h28-0-58" class="i">+
</a><a href="#h28-0-59" id="h28-0-59" class="i">+    private val fetchConversationWithMessagesMethod by lazy {
</a><a href="#h28-0-60" id="h28-0-60" class="i">+        context.classCache.conversationManager.methods.first { it.name == &quot;fetchConversationWithMessages&quot;}
</a><a href="#h28-0-61" id="h28-0-61" class="i">+    }
</a><a href="#h28-0-62" id="h28-0-62" class="i">+
</a><a href="#h28-0-63" id="h28-0-63" class="i">+    private val notificationManager by lazy {
</a><a href="#h28-0-64" id="h28-0-64" class="i">+        context.androidContext.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
</a><a href="#h28-0-65" id="h28-0-65" class="i">+    }
</a><a href="#h28-0-66" id="h28-0-66" class="i">+
</a><a href="#h28-0-67" id="h28-0-67" class="i">+    private fun setNotificationText(notification: Notification, text: String) {
</a><a href="#h28-0-68" id="h28-0-68" class="i">+        with(notification.extras) {
</a><a href="#h28-0-69" id="h28-0-69" class="i">+            putString(&quot;android.text&quot;, text)
</a><a href="#h28-0-70" id="h28-0-70" class="i">+            putString(&quot;android.bigText&quot;, text)
</a><a href="#h28-0-71" id="h28-0-71" class="i">+        }
</a><a href="#h28-0-72" id="h28-0-72" class="i">+    }
</a><a href="#h28-0-73" id="h28-0-73" class="i">+
</a><a href="#h28-0-74" id="h28-0-74" class="i">+    private fun computeNotificationText(conversationId: String): String {
</a><a href="#h28-0-75" id="h28-0-75" class="i">+        val messageBuilder = StringBuilder()
</a><a href="#h28-0-76" id="h28-0-76" class="i">+        cachedMessages.computeIfAbsent(conversationId) { mutableListOf() }.forEach {
</a><a href="#h28-0-77" id="h28-0-77" class="i">+            if (messageBuilder.isNotEmpty()) messageBuilder.append(&quot;\n&quot;)
</a><a href="#h28-0-78" id="h28-0-78" class="i">+            messageBuilder.append(it)
</a><a href="#h28-0-79" id="h28-0-79" class="i">+        }
</a><a href="#h28-0-80" id="h28-0-80" class="i">+        return messageBuilder.toString()
</a><a href="#h28-0-81" id="h28-0-81" class="i">+    }
</a><a href="#h28-0-82" id="h28-0-82" class="i">+
</a><a href="#h28-0-83" id="h28-0-83" class="i">+    private fun setupNotificationActionButtons(conversationId: String, notificationData: NotificationData) {
</a><a href="#h28-0-84" id="h28-0-84" class="i">+        val notificationBuilder = XposedHelpers.newInstance(
</a><a href="#h28-0-85" id="h28-0-85" class="i">+            Notification.Builder::class.java,
</a><a href="#h28-0-86" id="h28-0-86" class="i">+            context.androidContext,
</a><a href="#h28-0-87" id="h28-0-87" class="i">+            notificationData.notification
</a><a href="#h28-0-88" id="h28-0-88" class="i">+        ) as Notification.Builder
</a><a href="#h28-0-89" id="h28-0-89" class="i">+
</a><a href="#h28-0-90" id="h28-0-90" class="i">+        val chatReplyInput = RemoteInput.Builder(&quot;chat_reply_input&quot;)
</a><a href="#h28-0-91" id="h28-0-91" class="i">+            .setLabel(&quot;Reply&quot;)
</a><a href="#h28-0-92" id="h28-0-92" class="i">+            .build()
</a><a href="#h28-0-93" id="h28-0-93" class="i">+
</a><a href="#h28-0-94" id="h28-0-94" class="i">+        val replyIntent = Intent()
</a><a href="#h28-0-95" id="h28-0-95" class="i">+            .setClassName(Constants.SNAPCHAT_PACKAGE_NAME, broadcastReceiverClass.name)
</a><a href="#h28-0-96" id="h28-0-96" class="i">+            .putExtra(&quot;conversation_id&quot;, conversationId)
</a><a href="#h28-0-97" id="h28-0-97" class="i">+            .putExtra(&quot;notification_id&quot;, notificationData.id)
</a><a href="#h28-0-98" id="h28-0-98" class="i">+            .setAction(ACTION_REPLY)
</a><a href="#h28-0-99" id="h28-0-99" class="i">+
</a><a href="#h28-0-100" id="h28-0-100" class="i">+        val action = Notification.Action.Builder(
</a><a href="#h28-0-101" id="h28-0-101" class="i">+            null,
</a><a href="#h28-0-102" id="h28-0-102" class="i">+            &quot;Reply&quot;,
</a><a href="#h28-0-103" id="h28-0-103" class="i">+            PendingIntent.getBroadcast(
</a><a href="#h28-0-104" id="h28-0-104" class="i">+                context.androidContext,
</a><a href="#h28-0-105" id="h28-0-105" class="i">+                System.nanoTime().toInt(),
</a><a href="#h28-0-106" id="h28-0-106" class="i">+                replyIntent,
</a><a href="#h28-0-107" id="h28-0-107" class="i">+                PendingIntent.FLAG_CANCEL_CURRENT or PendingIntent.FLAG_MUTABLE
</a><a href="#h28-0-108" id="h28-0-108" class="i">+            )
</a><a href="#h28-0-109" id="h28-0-109" class="i">+        ).addRemoteInput(chatReplyInput).build()
</a><a href="#h28-0-110" id="h28-0-110" class="i">+
</a><a href="#h28-0-111" id="h28-0-111" class="i">+        notificationBuilder.setActions(action)
</a><a href="#h28-0-112" id="h28-0-112" class="i">+        notificationData.notification = notificationBuilder.build()
</a><a href="#h28-0-113" id="h28-0-113" class="i">+    }
</a><a href="#h28-0-114" id="h28-0-114" class="i">+
</a><a href="#h28-0-115" id="h28-0-115" class="i">+    private fun setupBroadcastReceiverHook() {
</a><a href="#h28-0-116" id="h28-0-116" class="i">+        Hooker.hook(broadcastReceiverClass, &quot;onReceive&quot;, HookStage.BEFORE) { param -&gt;
</a><a href="#h28-0-117" id="h28-0-117" class="i">+            val androidContext = param.arg&lt;Context&gt;(0)
</a><a href="#h28-0-118" id="h28-0-118" class="i">+            val intent = param.arg&lt;Intent&gt;(1)
</a><a href="#h28-0-119" id="h28-0-119" class="i">+            if (intent.action != ACTION_REPLY) return@hook
</a><a href="#h28-0-120" id="h28-0-120" class="i">+            param.setResult(null)
</a><a href="#h28-0-121" id="h28-0-121" class="i">+
</a><a href="#h28-0-122" id="h28-0-122" class="i">+            val notificationManager = androidContext.getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
</a><a href="#h28-0-123" id="h28-0-123" class="i">+            val updateNotification: (Int, (Notification) -&gt; Unit) -&gt; Unit = { notificationId, notificationBuilder -&gt;
</a><a href="#h28-0-124" id="h28-0-124" class="i">+                notificationManager.activeNotifications.firstOrNull { it.id == notificationId }?.let {
</a><a href="#h28-0-125" id="h28-0-125" class="i">+                    notificationBuilder(it.notification)
</a><a href="#h28-0-126" id="h28-0-126" class="i">+                    XposedBridge.invokeOriginalMethod(notifyAsUserMethod, notificationManager, arrayOf(
</a><a href="#h28-0-127" id="h28-0-127" class="i">+                        it.tag, it.id, it.notification, it.user
</a><a href="#h28-0-128" id="h28-0-128" class="i">+                    ))
</a><a href="#h28-0-129" id="h28-0-129" class="i">+                }
</a><a href="#h28-0-130" id="h28-0-130" class="i">+            }
</a><a href="#h28-0-131" id="h28-0-131" class="i">+
</a><a href="#h28-0-132" id="h28-0-132" class="i">+            val input = RemoteInput.getResultsFromIntent(intent).getCharSequence(&quot;chat_reply_input&quot;)
</a><a href="#h28-0-133" id="h28-0-133" class="i">+                .toString()
</a><a href="#h28-0-134" id="h28-0-134" class="i">+            val conversationId = intent.getStringExtra(&quot;conversation_id&quot;)!!
</a><a href="#h28-0-135" id="h28-0-135" class="i">+            val notificationId = intent.getIntExtra(&quot;notification_id&quot;, -1)
</a><a href="#h28-0-136" id="h28-0-136" class="i">+
</a><a href="#h28-0-137" id="h28-0-137" class="i">+            context.database.getMyUserId()?.let { context.database.getFriendInfo(it) }?.let { myUser -&gt;
</a><a href="#h28-0-138" id="h28-0-138" class="i">+                cachedMessages.computeIfAbsent(conversationId) { mutableListOf() }.add(&quot;${myUser.displayName}: $input&quot;)
</a><a href="#h28-0-139" id="h28-0-139" class="i">+
</a><a href="#h28-0-140" id="h28-0-140" class="i">+                updateNotification(notificationId) { notification -&gt;
</a><a href="#h28-0-141" id="h28-0-141" class="i">+                    setNotificationText(notification, computeNotificationText(conversationId))
</a><a href="#h28-0-142" id="h28-0-142" class="i">+                }
</a><a href="#h28-0-143" id="h28-0-143" class="i">+
</a><a href="#h28-0-144" id="h28-0-144" class="i">+                context.messageSender.sendChatMessage(listOf(SnapUUID.fromString(conversationId)), input, onError = {
</a><a href="#h28-0-145" id="h28-0-145" class="i">+                    context.longToast(&quot;Failed to send message: $it&quot;)
</a><a href="#h28-0-146" id="h28-0-146" class="i">+                })
</a><a href="#h28-0-147" id="h28-0-147" class="i">+            }
</a><a href="#h28-0-148" id="h28-0-148" class="i">+        }
</a><a href="#h28-0-149" id="h28-0-149" class="i">+    }
</a><a href="#h28-0-150" id="h28-0-150" class="i">+
</a><a href="#h28-0-151" id="h28-0-151" class="i">+    private fun fetchMessagesResult(conversationId: String, messages: List&lt;Message&gt;) {
</a><a href="#h28-0-152" id="h28-0-152" class="i">+        val sendNotificationData = { notificationData: NotificationData, forceCreate: Boolean  -&gt;
</a><a href="#h28-0-153" id="h28-0-153" class="i">+            val notificationId = if (forceCreate) System.nanoTime().toInt() else notificationData.id
</a><a href="#h28-0-154" id="h28-0-154" class="i">+            notificationIdMap.computeIfAbsent(notificationId) { conversationId }
</a><a href="#h28-0-155" id="h28-0-155" class="i">+
</a><a href="#h28-0-156" id="h28-0-156" class="i">+            XposedBridge.invokeOriginalMethod(notifyAsUserMethod, notificationManager, arrayOf(
</a><a href="#h28-0-157" id="h28-0-157" class="i">+                notificationData.tag, if (forceCreate) System.nanoTime().toInt() else notificationData.id, notificationData.notification, notificationData.userHandle
</a><a href="#h28-0-158" id="h28-0-158" class="i">+            ))
</a><a href="#h28-0-159" id="h28-0-159" class="i">+        }
</a><a href="#h28-0-160" id="h28-0-160" class="i">+
</a><a href="#h28-0-161" id="h28-0-161" class="i">+        notificationDataQueue.entries.onEach { (messageId, notificationData) -&gt;
</a><a href="#h28-0-162" id="h28-0-162" class="i">+            val snapMessage = messages.firstOrNull { message -&gt; message.orderKey == messageId } ?: return
</a><a href="#h28-0-163" id="h28-0-163" class="i">+            val senderUsername = context.database.getFriendInfo(snapMessage.senderId.toString())?.displayName ?: throw Throwable(&quot;Cant find senderId of message $snapMessage&quot;)
</a><a href="#h28-0-164" id="h28-0-164" class="i">+
</a><a href="#h28-0-165" id="h28-0-165" class="i">+            val contentType = snapMessage.messageContent.contentType
</a><a href="#h28-0-166" id="h28-0-166" class="i">+            val contentData = snapMessage.messageContent.content
</a><a href="#h28-0-167" id="h28-0-167" class="i">+
</a><a href="#h28-0-168" id="h28-0-168" class="i">+            val formatUsername: (String) -&gt; String = { &quot;$senderUsername: $it&quot; }
</a><a href="#h28-0-169" id="h28-0-169" class="i">+            val notificationCache = cachedMessages.let { it.computeIfAbsent(conversationId) { mutableListOf() } }
</a><a href="#h28-0-170" id="h28-0-170" class="i">+            val appendNotifications: () -&gt; Unit = { setNotificationText(notificationData.notification, computeNotificationText(conversationId))}
</a><a href="#h28-0-171" id="h28-0-171" class="i">+
</a><a href="#h28-0-172" id="h28-0-172" class="i">+            when (contentType) {
</a><a href="#h28-0-173" id="h28-0-173" class="i">+                ContentType.NOTE -&gt; {
</a><a href="#h28-0-174" id="h28-0-174" class="i">+                    notificationCache.add(formatUsername(&quot;sent audio note&quot;))
</a><a href="#h28-0-175" id="h28-0-175" class="i">+                    appendNotifications()
</a><a href="#h28-0-176" id="h28-0-176" class="i">+                }
</a><a href="#h28-0-177" id="h28-0-177" class="i">+                ContentType.CHAT -&gt; {
</a><a href="#h28-0-178" id="h28-0-178" class="i">+                    ProtoReader(contentData).getString(2, 1)?.trim()?.let {
</a><a href="#h28-0-179" id="h28-0-179" class="i">+                        notificationCache.add(formatUsername(it))
</a><a href="#h28-0-180" id="h28-0-180" class="i">+                    }
</a><a href="#h28-0-181" id="h28-0-181" class="i">+                    appendNotifications()
</a><a href="#h28-0-182" id="h28-0-182" class="i">+                }
</a><a href="#h28-0-183" id="h28-0-183" class="i">+                ContentType.SNAP, ContentType.EXTERNAL_MEDIA-&gt; {
</a><a href="#h28-0-184" id="h28-0-184" class="i">+                    //serialize the message content into a json object
</a><a href="#h28-0-185" id="h28-0-185" class="i">+                    val serializedMessageContent = context.gson.toJsonTree(snapMessage.messageContent.instanceNonNull()).asJsonObject
</a><a href="#h28-0-186" id="h28-0-186" class="i">+                    val mediaReferences = serializedMessageContent[&quot;mRemoteMediaReferences&quot;]
</a><a href="#h28-0-187" id="h28-0-187" class="i">+                        .asJsonArray.map { it.asJsonObject[&quot;mMediaReferences&quot;].asJsonArray }
</a><a href="#h28-0-188" id="h28-0-188" class="i">+                        .flatten()
</a><a href="#h28-0-189" id="h28-0-189" class="i">+
</a><a href="#h28-0-190" id="h28-0-190" class="i">+                    mediaReferences.forEach { media -&gt;
</a><a href="#h28-0-191" id="h28-0-191" class="i">+                        val protoMediaReference = media.asJsonObject[&quot;mContentObject&quot;].asJsonArray.map { it.asByte }.toByteArray()
</a><a href="#h28-0-192" id="h28-0-192" class="i">+                        val mediaType = MediaReferenceType.valueOf(media.asJsonObject[&quot;mMediaType&quot;].asString)
</a><a href="#h28-0-193" id="h28-0-193" class="i">+                        runCatching {
</a><a href="#h28-0-194" id="h28-0-194" class="i">+                            //download the media
</a><a href="#h28-0-195" id="h28-0-195" class="i">+                            val mediaInfo = ProtoReader(contentData).let {
</a><a href="#h28-0-196" id="h28-0-196" class="i">+                                if (contentType == ContentType.EXTERNAL_MEDIA)
</a><a href="#h28-0-197" id="h28-0-197" class="i">+                                    return@let it.readPath(*Constants.MESSAGE_EXTERNAL_MEDIA_ENCRYPTION_PROTO_PATH)
</a><a href="#h28-0-198" id="h28-0-198" class="i">+                                else
</a><a href="#h28-0-199" id="h28-0-199" class="i">+                                    return@let it.readPath(*Constants.MESSAGE_SNAP_ENCRYPTION_PROTO_PATH)
</a><a href="#h28-0-200" id="h28-0-200" class="i">+                            }?: return@runCatching
</a><a href="#h28-0-201" id="h28-0-201" class="i">+
</a><a href="#h28-0-202" id="h28-0-202" class="i">+                            val downloadedMedia = MediaDownloaderHelper.downloadMediaFromReference(protoMediaReference, mergeOverlay = false, isPreviewMode = false) {
</a><a href="#h28-0-203" id="h28-0-203" class="i">+                                if (mediaInfo.exists(Constants.ARROYO_ENCRYPTION_PROTO_INDEX))
</a><a href="#h28-0-204" id="h28-0-204" class="i">+                                    EncryptionUtils.decryptInputStream(it, false, mediaInfo, Constants.ARROYO_ENCRYPTION_PROTO_INDEX)
</a><a href="#h28-0-205" id="h28-0-205" class="i">+                                else it
</a><a href="#h28-0-206" id="h28-0-206" class="i">+                            }[MediaType.ORIGINAL] ?: throw Throwable(&quot;Failed to download media&quot;)
</a><a href="#h28-0-207" id="h28-0-207" class="i">+
</a><a href="#h28-0-208" id="h28-0-208" class="i">+                            val bitmapPreview = PreviewUtils.createPreview(downloadedMedia, mediaType.name.contains(&quot;VIDEO&quot;))!!
</a><a href="#h28-0-209" id="h28-0-209" class="i">+                            val notificationBuilder = XposedHelpers.newInstance(
</a><a href="#h28-0-210" id="h28-0-210" class="i">+                                Notification.Builder::class.java,
</a><a href="#h28-0-211" id="h28-0-211" class="i">+                                context.androidContext,
</a><a href="#h28-0-212" id="h28-0-212" class="i">+                                notificationData.notification
</a><a href="#h28-0-213" id="h28-0-213" class="i">+                            ) as Notification.Builder
</a><a href="#h28-0-214" id="h28-0-214" class="i">+                            notificationBuilder.setLargeIcon(bitmapPreview)
</a><a href="#h28-0-215" id="h28-0-215" class="i">+                            notificationBuilder.style = Notification.BigPictureStyle().bigPicture(bitmapPreview).bigLargeIcon(null as Bitmap?)
</a><a href="#h28-0-216" id="h28-0-216" class="i">+
</a><a href="#h28-0-217" id="h28-0-217" class="i">+                            sendNotificationData(notificationData.copy(notification = notificationBuilder.build()), true)
</a><a href="#h28-0-218" id="h28-0-218" class="i">+                            return@onEach
</a><a href="#h28-0-219" id="h28-0-219" class="i">+                        }.onFailure {
</a><a href="#h28-0-220" id="h28-0-220" class="i">+                            Logger.xposedLog(&quot;Failed to send preview notification&quot;, it)
</a><a href="#h28-0-221" id="h28-0-221" class="i">+                        }
</a><a href="#h28-0-222" id="h28-0-222" class="i">+                    }
</a><a href="#h28-0-223" id="h28-0-223" class="i">+                }
</a><a href="#h28-0-224" id="h28-0-224" class="i">+                else -&gt; {
</a><a href="#h28-0-225" id="h28-0-225" class="i">+                    notificationCache.add(formatUsername(&quot;sent $contentType&quot;))
</a><a href="#h28-0-226" id="h28-0-226" class="i">+                }
</a><a href="#h28-0-227" id="h28-0-227" class="i">+            }
</a><a href="#h28-0-228" id="h28-0-228" class="i">+
</a><a href="#h28-0-229" id="h28-0-229" class="i">+            if (contentType == ContentType.CHAT &amp;&amp; context.config.options(ConfigProperty.BETTER_NOTIFICATIONS)[&quot;reply_button&quot;] == true) {
</a><a href="#h28-0-230" id="h28-0-230" class="i">+                setupNotificationActionButtons(conversationId, notificationData)
</a><a href="#h28-0-231" id="h28-0-231" class="i">+            }
</a><a href="#h28-0-232" id="h28-0-232" class="i">+
</a><a href="#h28-0-233" id="h28-0-233" class="i">+            sendNotificationData(notificationData, false)
</a><a href="#h28-0-234" id="h28-0-234" class="i">+        }.clear()
</a><a href="#h28-0-235" id="h28-0-235" class="i">+    }
</a><a href="#h28-0-236" id="h28-0-236" class="i">+
</a><a href="#h28-0-237" id="h28-0-237" class="i">+    private fun shouldIgnoreNotification(type: String): Boolean {
</a><a href="#h28-0-238" id="h28-0-238" class="i">+        val states = context.config.options(ConfigProperty.NOTIFICATION_BLACKLIST)
</a><a href="#h28-0-239" id="h28-0-239" class="i">+
</a><a href="#h28-0-240" id="h28-0-240" class="i">+        states[&quot;snap&quot;]?.let { if (type.endsWith(&quot;SNAP&quot;) &amp;&amp; it) return true }
</a><a href="#h28-0-241" id="h28-0-241" class="i">+        states[&quot;chat&quot;]?.let { if (type.endsWith(&quot;CHAT&quot;) &amp;&amp; it) return true }
</a><a href="#h28-0-242" id="h28-0-242" class="i">+        states[&quot;typing&quot;]?.let { if (type.endsWith(&quot;TYPING&quot;) &amp;&amp; it) return true }
</a><a href="#h28-0-243" id="h28-0-243" class="i">+
</a><a href="#h28-0-244" id="h28-0-244" class="i">+        return false
</a><a href="#h28-0-245" id="h28-0-245" class="i">+    }
</a><a href="#h28-0-246" id="h28-0-246" class="i">+
</a><a href="#h28-0-247" id="h28-0-247" class="i">+    override fun init() {
</a><a href="#h28-0-248" id="h28-0-248" class="i">+        setupBroadcastReceiverHook()
</a><a href="#h28-0-249" id="h28-0-249" class="i">+
</a><a href="#h28-0-250" id="h28-0-250" class="i">+        val fetchConversationWithMessagesCallback = context.mappings.getMappedClass(&quot;callbacks&quot;, &quot;FetchConversationWithMessagesCallback&quot;)
</a><a href="#h28-0-251" id="h28-0-251" class="i">+
</a><a href="#h28-0-252" id="h28-0-252" class="i">+        Hooker.hook(notifyAsUserMethod, HookStage.BEFORE) { param -&gt;
</a><a href="#h28-0-253" id="h28-0-253" class="i">+            val notificationData = NotificationData(param.argNullable(0), param.arg(1), param.arg(2), param.arg(3))
</a><a href="#h28-0-254" id="h28-0-254" class="i">+
</a><a href="#h28-0-255" id="h28-0-255" class="i">+            val extras: Bundle = notificationData.notification.extras.getBundle(&quot;system_notification_extras&quot;)?: return@hook
</a><a href="#h28-0-256" id="h28-0-256" class="i">+
</a><a href="#h28-0-257" id="h28-0-257" class="i">+            val messageId = extras.getString(&quot;message_id&quot;) ?: return@hook
</a><a href="#h28-0-258" id="h28-0-258" class="i">+            val notificationType = extras.getString(&quot;notification_type&quot;) ?: return@hook
</a><a href="#h28-0-259" id="h28-0-259" class="i">+            val conversationId = extras.getString(&quot;conversation_id&quot;) ?: return@hook
</a><a href="#h28-0-260" id="h28-0-260" class="i">+
</a><a href="#h28-0-261" id="h28-0-261" class="i">+            if (shouldIgnoreNotification(notificationType)) {
</a><a href="#h28-0-262" id="h28-0-262" class="i">+                param.setResult(null)
</a><a href="#h28-0-263" id="h28-0-263" class="i">+                return@hook
</a><a href="#h28-0-264" id="h28-0-264" class="i">+            }
</a><a href="#h28-0-265" id="h28-0-265" class="i">+
</a><a href="#h28-0-266" id="h28-0-266" class="i">+            if (context.config.options(ConfigProperty.BETTER_NOTIFICATIONS)
</a><a href="#h28-0-267" id="h28-0-267" class="i">+                .filter { it.value }.none { notificationType.endsWith(it.key.uppercase())}) return@hook
</a><a href="#h28-0-268" id="h28-0-268" class="i">+
</a><a href="#h28-0-269" id="h28-0-269" class="i">+            val conversationManager: Any = context.feature(Messaging::class).conversationManager
</a><a href="#h28-0-270" id="h28-0-270" class="i">+            notificationDataQueue[messageId.toLong()] = notificationData
</a><a href="#h28-0-271" id="h28-0-271" class="i">+
</a><a href="#h28-0-272" id="h28-0-272" class="i">+            val callback = CallbackBuilder(fetchConversationWithMessagesCallback)
</a><a href="#h28-0-273" id="h28-0-273" class="i">+                .override(&quot;onFetchConversationWithMessagesComplete&quot;) { callbackParam -&gt;
</a><a href="#h28-0-274" id="h28-0-274" class="i">+                    val messageList = (callbackParam.arg(1) as List&lt;Any&gt;).map { msg -&gt; Message(msg) }
</a><a href="#h28-0-275" id="h28-0-275" class="i">+                    fetchMessagesResult(conversationId, messageList)
</a><a href="#h28-0-276" id="h28-0-276" class="i">+                }
</a><a href="#h28-0-277" id="h28-0-277" class="i">+                .override(&quot;onError&quot;) {
</a><a href="#h28-0-278" id="h28-0-278" class="i">+                    Logger.xposedLog(&quot;Failed to fetch message ${it.arg(0) as Any}&quot;)
</a><a href="#h28-0-279" id="h28-0-279" class="i">+                }.build()
</a><a href="#h28-0-280" id="h28-0-280" class="i">+
</a><a href="#h28-0-281" id="h28-0-281" class="i">+            fetchConversationWithMessagesMethod.invoke(conversationManager, SnapUUID.fromString(conversationId).instanceNonNull(), callback)
</a><a href="#h28-0-282" id="h28-0-282" class="i">+            param.setResult(null)
</a><a href="#h28-0-283" id="h28-0-283" class="i">+        }
</a><a href="#h28-0-284" id="h28-0-284" class="i">+
</a><a href="#h28-0-285" id="h28-0-285" class="i">+        Hooker.hook(cancelAsUserMethod, HookStage.BEFORE) { param -&gt;
</a><a href="#h28-0-286" id="h28-0-286" class="i">+            val notificationId = param.arg&lt;Int&gt;(1)
</a><a href="#h28-0-287" id="h28-0-287" class="i">+            notificationIdMap[notificationId]?.let {
</a><a href="#h28-0-288" id="h28-0-288" class="i">+                cachedMessages[it]?.clear()
</a><a href="#h28-0-289" id="h28-0-289" class="i">+            }
</a><a href="#h28-0-290" id="h28-0-290" class="i">+        }
</a><a href="#h28-0-291" id="h28-0-291" class="i">+    }
</a><a href="#h28-0-292" id="h28-0-292" class="i">+
</a><a href="#h28-0-293" id="h28-0-293" class="i">+    data class NotificationData(
</a><a href="#h28-0-294" id="h28-0-294" class="i">+        val tag: String?,
</a><a href="#h28-0-295" id="h28-0-295" class="i">+        val id: Int,
</a><a href="#h28-0-296" id="h28-0-296" class="i">+        var notification: Notification,
</a><a href="#h28-0-297" id="h28-0-297" class="i">+        val userHandle: UserHandle
</a><a href="#h28-0-298" id="h28-0-298" class="i">+    )
</a><a href="#h28-0-299" id="h28-0-299" class="i">+}</a><a href="#h28-0-300" id="h28-0-300" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h29" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/SnapchatPlus.kt</a></b>
<a href="#h29-0" id="h29-0" class="h">@@ -0,0 +1,29 @@
</a><a href="#h29-0-0" id="h29-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h29-0-1" id="h29-0-1" class="i">+
</a><a href="#h29-0-2" id="h29-0-2" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h29-0-3" id="h29-0-3" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h29-0-4" id="h29-0-4" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h29-0-5" id="h29-0-5" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h29-0-6" id="h29-0-6" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h29-0-7" id="h29-0-7" class="i">+
</a><a href="#h29-0-8" id="h29-0-8" class="i">+class SnapchatPlus: Feature(&quot;SnapchatPlus&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_ASYNC) {
</a><a href="#h29-0-9" id="h29-0-9" class="i">+    private val originalSubscriptionTime = (System.currentTimeMillis() - 7776000000L)
</a><a href="#h29-0-10" id="h29-0-10" class="i">+    private val expirationTimeMillis = (System.currentTimeMillis() + 15552000000L)
</a><a href="#h29-0-11" id="h29-0-11" class="i">+
</a><a href="#h29-0-12" id="h29-0-12" class="i">+    override fun asyncOnActivityCreate() {
</a><a href="#h29-0-13" id="h29-0-13" class="i">+        if (!context.config.bool(ConfigProperty.SNAPCHAT_PLUS)) return
</a><a href="#h29-0-14" id="h29-0-14" class="i">+
</a><a href="#h29-0-15" id="h29-0-15" class="i">+        val subscriptionInfoClass = context.mappings.getMappedClass(&quot;SubscriptionInfoClass&quot;)
</a><a href="#h29-0-16" id="h29-0-16" class="i">+
</a><a href="#h29-0-17" id="h29-0-17" class="i">+        Hooker.hookConstructor(subscriptionInfoClass, HookStage.BEFORE) { param -&gt;
</a><a href="#h29-0-18" id="h29-0-18" class="i">+            if (param.arg&lt;Int&gt;(0) == 2) return@hookConstructor
</a><a href="#h29-0-19" id="h29-0-19" class="i">+            //subscription tier
</a><a href="#h29-0-20" id="h29-0-20" class="i">+            param.setArg(0, 2)
</a><a href="#h29-0-21" id="h29-0-21" class="i">+            //subscription status
</a><a href="#h29-0-22" id="h29-0-22" class="i">+            param.setArg(1, 2)
</a><a href="#h29-0-23" id="h29-0-23" class="i">+
</a><a href="#h29-0-24" id="h29-0-24" class="i">+            param.setArg(2, originalSubscriptionTime)
</a><a href="#h29-0-25" id="h29-0-25" class="i">+            param.setArg(3, expirationTimeMillis)
</a><a href="#h29-0-26" id="h29-0-26" class="i">+        }
</a><a href="#h29-0-27" id="h29-0-27" class="i">+    }
</a><a href="#h29-0-28" id="h29-0-28" class="i">+}</a><a href="#h29-0-29" id="h29-0-29" class="i">+
\ No newline at end of file
</a><b>diff --git a/<a id="h30" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/tweaks/UnlimitedSnapViewTime.kt</a></b>
<a href="#h30-0" id="h30-0" class="h">@@ -0,0 +1,36 @@
</a><a href="#h30-0-0" id="h30-0-0" class="i">+package me.rhunk.snapenhance.features.impl.tweaks
</a><a href="#h30-0-1" id="h30-0-1" class="i">+
</a><a href="#h30-0-2" id="h30-0-2" class="i">+import me.rhunk.snapenhance.config.ConfigProperty
</a><a href="#h30-0-3" id="h30-0-3" class="i">+import me.rhunk.snapenhance.data.ContentType
</a><a href="#h30-0-4" id="h30-0-4" class="i">+import me.rhunk.snapenhance.data.MessageState
</a><a href="#h30-0-5" id="h30-0-5" class="i">+import me.rhunk.snapenhance.data.wrapper.impl.Message
</a><a href="#h30-0-6" id="h30-0-6" class="i">+import me.rhunk.snapenhance.features.Feature
</a><a href="#h30-0-7" id="h30-0-7" class="i">+import me.rhunk.snapenhance.features.FeatureLoadParams
</a><a href="#h30-0-8" id="h30-0-8" class="i">+import me.rhunk.snapenhance.hook.HookStage
</a><a href="#h30-0-9" id="h30-0-9" class="i">+import me.rhunk.snapenhance.hook.Hooker
</a><a href="#h30-0-10" id="h30-0-10" class="i">+import me.rhunk.snapenhance.util.protobuf.ProtoEditor
</a><a href="#h30-0-11" id="h30-0-11" class="i">+import me.rhunk.snapenhance.util.protobuf.ProtoReader
</a><a href="#h30-0-12" id="h30-0-12" class="i">+
</a><a href="#h30-0-13" id="h30-0-13" class="i">+class UnlimitedSnapViewTime :
</a><a href="#h30-0-14" id="h30-0-14" class="i">+    Feature(&quot;UnlimitedSnapViewTime&quot;, loadParams = FeatureLoadParams.ACTIVITY_CREATE_SYNC) {
</a><a href="#h30-0-15" id="h30-0-15" class="i">+    override fun onActivityCreate() {
</a><a href="#h30-0-16" id="h30-0-16" class="i">+        Hooker.hookConstructor(context.classCache.message, HookStage.AFTER, {
</a><a href="#h30-0-17" id="h30-0-17" class="i">+            context.config.bool(ConfigProperty.UNLIMITED_SNAP_VIEW_TIME)
</a><a href="#h30-0-18" id="h30-0-18" class="i">+        }) { param -&gt;
</a><a href="#h30-0-19" id="h30-0-19" class="i">+            val message = Message(param.thisObject())
</a><a href="#h30-0-20" id="h30-0-20" class="i">+            if (message.messageState != MessageState.COMMITTED) return@hookConstructor
</a><a href="#h30-0-21" id="h30-0-21" class="i">+            if (message.messageContent.contentType != ContentType.SNAP) return@hookConstructor
</a><a href="#h30-0-22" id="h30-0-22" class="i">+
</a><a href="#h30-0-23" id="h30-0-23" class="i">+            with(message.messageContent) {
</a><a href="#h30-0-24" id="h30-0-24" class="i">+                val mediaAttributes = ProtoReader(this.content).readPath(11, 5, 2) ?: return@hookConstructor
</a><a href="#h30-0-25" id="h30-0-25" class="i">+                if (mediaAttributes.exists(6)) return@hookConstructor
</a><a href="#h30-0-26" id="h30-0-26" class="i">+                this.content = ProtoEditor(this.content).apply {
</a><a href="#h30-0-27" id="h30-0-27" class="i">+                    edit(11, 5, 2) {
</a><a href="#h30-0-28" id="h30-0-28" class="i">+                        mediaAttributes.getInt(5)?.let { writeConstant(5, it) }
</a><a href="#h30-0-29" id="h30-0-29" class="i">+                        writeBuffer(6, byteArrayOf())
</a><a href="#h30-0-30" id="h30-0-30" class="i">+                    }
</a><a href="#h30-0-31" id="h30-0-31" class="i">+                }.toByteArray()
</a><a href="#h30-0-32" id="h30-0-32" class="i">+            }
</a><a href="#h30-0-33" id="h30-0-33" class="i">+        }
</a><a href="#h30-0-34" id="h30-0-34" class="i">+    }
</a><a href="#h30-0-35" id="h30-0-35" class="i">+}
</a><b>diff --git a/<a id="h31" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/UITweaks.kt</a></b>
<a href="#h31-0" id="h31-0" class="h">@@ -22,14 +22,15 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a>         val chatNoteRecordButton = resources.getIdentifier(&quot;chat_note_record_button&quot;, &quot;id&quot;, Constants.SNAPCHAT_PACKAGE_NAME)
         val chatInputBarSticker = resources.getIdentifier(&quot;chat_input_bar_sticker&quot;, &quot;id&quot;, Constants.SNAPCHAT_PACKAGE_NAME)
         val chatInputBarCognac = resources.getIdentifier(&quot;chat_input_bar_cognac&quot;, &quot;id&quot;, Constants.SNAPCHAT_PACKAGE_NAME)
<a href="#h31-0-3" id="h31-0-3" class="d">-
</a><a href="#h31-0-4" id="h31-0-4" class="i">+        val hiddenElements = context.config.options(ConfigProperty.HIDE_UI_ELEMENTS)
</a><a href="#h31-0-5" id="h31-0-5" class="i">+        
</a>         Hooker.hook(View::class.java, &quot;setVisibility&quot;, HookStage.BEFORE) { methodParam -&gt;
             val viewId = (methodParam.thisObject() as View).id
<a href="#h31-0-8" id="h31-0-8" class="d">-            if (viewId == chatNoteRecordButton &amp;&amp; context.config.bool(ConfigProperty.REMOVE_VOICE_RECORD_BUTTON)) {
</a><a href="#h31-0-9" id="h31-0-9" class="i">+            if (viewId == chatNoteRecordButton &amp;&amp; hiddenElements[&quot;remove_voice_record_button&quot;] == true) {
</a>                 methodParam.setArg(0, View.GONE)
             }
             if (viewId == callButton1 || viewId == callButton2) {
<a href="#h31-0-13" id="h31-0-13" class="d">-                if (!context.config.bool(ConfigProperty.REMOVE_CALL_BUTTONS)) return@hook
</a><a href="#h31-0-14" id="h31-0-14" class="i">+                if (hiddenElements[&quot;remove_call_buttons&quot;] == false) return@hook
</a>                 methodParam.setArg(0, View.GONE)
             }
         }
<a href="#h31-1" id="h31-1" class="h">@@ -45,23 +46,23 @@ class UITweaks : Feature(&quot;UITweaks&quot;, loadParams = FeatureLoadParams.ACTIVITY_CRE
</a>             val view: View = param.arg(0)
             val viewId = view.id
 
<a href="#h31-1-3" id="h31-1-3" class="d">-            if (viewId == chatNoteRecordButton &amp;&amp; context.config.bool(ConfigProperty.REMOVE_VOICE_RECORD_BUTTON)) {
</a><a href="#h31-1-4" id="h31-1-4" class="i">+            if (viewId == chatNoteRecordButton &amp;&amp; hiddenElements[&quot;remove_voice_record_button&quot;] == true) {
</a>                 view.isEnabled = false
                 view.setWillNotDraw(true)
             }
 
<a href="#h31-1-9" id="h31-1-9" class="d">-            if (chatInputBarCognac == viewId &amp;&amp; context.config.bool(ConfigProperty.REMOVE_COGNAC_BUTTON)) {
</a><a href="#h31-1-10" id="h31-1-10" class="i">+            if (chatInputBarCognac == viewId &amp;&amp; hiddenElements[&quot;remove_cognac_button&quot;] == true) {
</a>                 view.visibility = View.GONE
             }
<a href="#h31-1-13" id="h31-1-13" class="d">-            if (chatInputBarSticker == viewId &amp;&amp; context.config.bool(ConfigProperty.REMOVE_STICKERS_BUTTON)) {
</a><a href="#h31-1-14" id="h31-1-14" class="i">+            if (chatInputBarSticker == viewId &amp;&amp; hiddenElements[&quot;remove_stickers_button&quot;] == true) {
</a>                 view.visibility = View.GONE
             }
             if (viewId == callButton1 || viewId == callButton2) {
<a href="#h31-1-18" id="h31-1-18" class="d">-                if (!context.config.bool(ConfigProperty.REMOVE_CALL_BUTTONS)) return@hook
</a><a href="#h31-1-19" id="h31-1-19" class="i">+                if (hiddenElements[&quot;remove_call_buttons&quot;] == false) return@hook
</a>                 if (view.visibility == View.GONE) return@hook
             }
             if (viewId == callButtonsStub) {
<a href="#h31-1-23" id="h31-1-23" class="d">-                if (!context.config.bool(ConfigProperty.REMOVE_CALL_BUTTONS)) return@hook
</a><a href="#h31-1-24" id="h31-1-24" class="i">+                if (hiddenElements[&quot;remove_call_buttons&quot;] == false) return@hook
</a>                 param.setResult(null)
             }
         }
<b>diff --git a/<a id="h32" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/MapActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/MapActivity.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/MapActivity.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/MapActivity.kt</a></b>
<a href="#h32-0" id="h32-0" class="h">@@ -1,10 +1,13 @@
</a> package me.rhunk.snapenhance.features.impl.ui.menus
 
<a href="#h32-0-2" id="h32-0-2" class="i">+import android.annotation.SuppressLint
</a> import android.app.Activity
<a href="#h32-0-4" id="h32-0-4" class="i">+import android.app.AlertDialog
</a> import android.content.Context
 import android.os.Bundle
 import android.view.MotionEvent
 import android.widget.Button
<a href="#h32-0-9" id="h32-0-9" class="i">+import android.widget.EditText
</a> import me.rhunk.snapenhance.R
 import org.osmdroid.config.Configuration
 import org.osmdroid.tileprovider.tilesource.TileSourceFactory
<a href="#h32-1" id="h32-1" class="h">@@ -20,12 +23,13 @@ class MapActivity : Activity() {
</a> 
     private lateinit var mapView: MapView
 
<a href="#h32-1-3" id="h32-1-3" class="i">+    @SuppressLint(&quot;MissingInflatedId&quot;, &quot;ResourceType&quot;)
</a>     override fun onCreate(savedInstanceState: Bundle?) {
         super.onCreate(savedInstanceState)
 
         val contextBundle = intent.extras?.getBundle(&quot;location&quot;) ?: return
<a href="#h32-1-8" id="h32-1-8" class="d">-        val latitude = contextBundle.getDouble(&quot;latitude&quot;)
</a><a href="#h32-1-9" id="h32-1-9" class="d">-        val longitude = contextBundle.getDouble(&quot;longitude&quot;)
</a><a href="#h32-1-10" id="h32-1-10" class="i">+        val locationLatitude = contextBundle.getDouble(&quot;latitude&quot;)
</a><a href="#h32-1-11" id="h32-1-11" class="i">+        val locationLongitude = contextBundle.getDouble(&quot;longitude&quot;)
</a> 
         Configuration.getInstance().load(applicationContext, getSharedPreferences(&quot;osmdroid&quot;, Context.MODE_PRIVATE))
 
<a href="#h32-2" id="h32-2" class="h">@@ -35,7 +39,7 @@ class MapActivity : Activity() {
</a>         mapView.setMultiTouchControls(true);
         mapView.setTileSource(TileSourceFactory.MAPNIK)
 
<a href="#h32-2-3" id="h32-2-3" class="d">-        val startPoint = GeoPoint(latitude, longitude)
</a><a href="#h32-2-4" id="h32-2-4" class="i">+        val startPoint = GeoPoint(locationLatitude, locationLongitude)
</a>         mapView.controller.setZoom(10.0)
         mapView.controller.setCenter(startPoint)
 
<a href="#h32-3" id="h32-3" class="h">@@ -64,6 +68,28 @@ class MapActivity : Activity() {
</a>             setResult(RESULT_OK, intent.putExtra(&quot;location&quot;, bundle))
             finish()
         }
<a href="#h32-3-3" id="h32-3-3" class="i">+
</a><a href="#h32-3-4" id="h32-3-4" class="i">+        val setPreciseLocationButton = findViewById&lt;Button&gt;(R.id.set_precise_location_button)
</a><a href="#h32-3-5" id="h32-3-5" class="i">+
</a><a href="#h32-3-6" id="h32-3-6" class="i">+        setPreciseLocationButton.setOnClickListener {
</a><a href="#h32-3-7" id="h32-3-7" class="i">+            val locationDialog = layoutInflater.inflate(R.layout.precise_location_dialog, null)
</a><a href="#h32-3-8" id="h32-3-8" class="i">+            val dialogLatitude = locationDialog.findViewById&lt;EditText&gt;(R.id.dialog_latitude).also { it.setText(marker.position.latitude.toString()) }
</a><a href="#h32-3-9" id="h32-3-9" class="i">+            val dialogLongitude = locationDialog.findViewById&lt;EditText&gt;(R.id.dialog_longitude).also { it.setText(marker.position.longitude.toString()) }
</a><a href="#h32-3-10" id="h32-3-10" class="i">+
</a><a href="#h32-3-11" id="h32-3-11" class="i">+            AlertDialog.Builder(this)
</a><a href="#h32-3-12" id="h32-3-12" class="i">+                .setView(locationDialog)
</a><a href="#h32-3-13" id="h32-3-13" class="i">+                .setTitle(&quot;Set a precise location&quot;)
</a><a href="#h32-3-14" id="h32-3-14" class="i">+                .setPositiveButton(&quot;Set&quot;) { _, _ -&gt;
</a><a href="#h32-3-15" id="h32-3-15" class="i">+                    val latitude = dialogLatitude.text.toString().toDoubleOrNull()
</a><a href="#h32-3-16" id="h32-3-16" class="i">+                    val longitude = dialogLongitude.text.toString().toDoubleOrNull()
</a><a href="#h32-3-17" id="h32-3-17" class="i">+                    if (latitude != null &amp;&amp; longitude != null) {
</a><a href="#h32-3-18" id="h32-3-18" class="i">+                        val preciseLocation = GeoPoint(latitude, longitude)
</a><a href="#h32-3-19" id="h32-3-19" class="i">+                        mapView.controller.setCenter(preciseLocation)
</a><a href="#h32-3-20" id="h32-3-20" class="i">+                        marker.position = preciseLocation
</a><a href="#h32-3-21" id="h32-3-21" class="i">+                        mapView.invalidate()
</a><a href="#h32-3-22" id="h32-3-22" class="i">+                    }
</a><a href="#h32-3-23" id="h32-3-23" class="i">+                }.setNegativeButton(&quot;Cancel&quot;) { _, _ -&gt; }.show()
</a><a href="#h32-3-24" id="h32-3-24" class="i">+        }
</a>     }
 
     override fun onDestroy() {
<b>diff --git a/<a id="h33" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/ChatActionMenu.kt</a></b>
<a href="#h33-0" id="h33-0" class="h">@@ -64,34 +64,35 @@ class ChatActionMenu : AbstractMenu() {
</a>                 )
             )
         }
<a href="#h33-0-3" id="h33-0-3" class="d">-        if (context.config.bool(ConfigProperty.DOWNLOAD_INCHAT_SNAPS)) {
</a><a href="#h33-0-4" id="h33-0-4" class="d">-            val previewButton = Button(viewGroup.context)
</a><a href="#h33-0-5" id="h33-0-5" class="d">-            applyButtonTheme(parent, previewButton)
</a><a href="#h33-0-6" id="h33-0-6" class="d">-            previewButton.text = &quot;Preview&quot;
</a><a href="#h33-0-7" id="h33-0-7" class="d">-            previewButton.setOnClickListener {
</a><a href="#h33-0-8" id="h33-0-8" class="d">-                closeActionMenu()
</a><a href="#h33-0-9" id="h33-0-9" class="d">-                context.executeAsync { context.feature(MediaDownloader::class).onMessageActionMenu(true) }
</a><a href="#h33-0-10" id="h33-0-10" class="d">-            }
</a><a href="#h33-0-11" id="h33-0-11" class="d">-            parent.addView(previewButton)
</a><a href="#h33-0-12" id="h33-0-12" class="d">-        }
</a><a href="#h33-0-13" id="h33-0-13" class="i">+        if (context.config.bool(ConfigProperty.CHAT_DOWNLOAD_CONTEXT_MENU)) {
</a><a href="#h33-0-14" id="h33-0-14" class="i">+            parent.addView(Button(viewGroup.context).apply {
</a><a href="#h33-0-15" id="h33-0-15" class="i">+                applyButtonTheme(parent, this)
</a><a href="#h33-0-16" id="h33-0-16" class="i">+                text = this@ChatActionMenu.context.translation.get(&quot;chat_action_menu.preview_button&quot;)
</a><a href="#h33-0-17" id="h33-0-17" class="i">+                setOnClickListener {
</a><a href="#h33-0-18" id="h33-0-18" class="i">+                    closeActionMenu()
</a><a href="#h33-0-19" id="h33-0-19" class="i">+                    this@ChatActionMenu.context.executeAsync { this@ChatActionMenu.context.feature(MediaDownloader::class).onMessageActionMenu(true) }
</a><a href="#h33-0-20" id="h33-0-20" class="i">+                }
</a><a href="#h33-0-21" id="h33-0-21" class="i">+            })
</a> 
<a href="#h33-0-23" id="h33-0-23" class="d">-        //download snap in chat
</a><a href="#h33-0-24" id="h33-0-24" class="d">-        if (context.config.bool(ConfigProperty.DOWNLOAD_INCHAT_SNAPS)) {
</a><a href="#h33-0-25" id="h33-0-25" class="d">-            val downloadButton = Button(viewGroup.context)
</a><a href="#h33-0-26" id="h33-0-26" class="d">-            applyButtonTheme(parent, downloadButton)
</a><a href="#h33-0-27" id="h33-0-27" class="d">-            downloadButton.text = &quot;Download&quot;
</a><a href="#h33-0-28" id="h33-0-28" class="d">-            downloadButton.setOnClickListener {
</a><a href="#h33-0-29" id="h33-0-29" class="d">-                closeActionMenu()
</a><a href="#h33-0-30" id="h33-0-30" class="d">-                context.executeAsync { context.feature(MediaDownloader::class).onMessageActionMenu(false) }
</a><a href="#h33-0-31" id="h33-0-31" class="d">-            }
</a><a href="#h33-0-32" id="h33-0-32" class="d">-            parent.addView(downloadButton)
</a><a href="#h33-0-33" id="h33-0-33" class="i">+            parent.addView(Button(viewGroup.context).apply {
</a><a href="#h33-0-34" id="h33-0-34" class="i">+                applyButtonTheme(parent, this)
</a><a href="#h33-0-35" id="h33-0-35" class="i">+                text = this@ChatActionMenu.context.translation.get(&quot;chat_action_menu.download_button&quot;)
</a><a href="#h33-0-36" id="h33-0-36" class="i">+                setOnClickListener {
</a><a href="#h33-0-37" id="h33-0-37" class="i">+                    closeActionMenu()
</a><a href="#h33-0-38" id="h33-0-38" class="i">+                    this@ChatActionMenu.context.executeAsync {
</a><a href="#h33-0-39" id="h33-0-39" class="i">+                        this@ChatActionMenu.context.feature(
</a><a href="#h33-0-40" id="h33-0-40" class="i">+                            MediaDownloader::class
</a><a href="#h33-0-41" id="h33-0-41" class="i">+                        ).onMessageActionMenu(false)
</a><a href="#h33-0-42" id="h33-0-42" class="i">+                    }
</a><a href="#h33-0-43" id="h33-0-43" class="i">+                }
</a><a href="#h33-0-44" id="h33-0-44" class="i">+            })
</a>         }
 
         //delete logged message button
         if (context.config.bool(ConfigProperty.MESSAGE_LOGGER)) {
             val downloadButton = Button(viewGroup.context)
             applyButtonTheme(parent, downloadButton)
<a href="#h33-0-51" id="h33-0-51" class="d">-            downloadButton.text = &quot;Deleted logged message&quot;
</a><a href="#h33-0-52" id="h33-0-52" class="i">+            downloadButton.text = context.translation.get(&quot;chat_action_menu.delete_logged_message_button&quot;)
</a>             downloadButton.setOnClickListener {
                 closeActionMenu()
                 context.executeAsync {
<b>diff --git a/<a id="h34" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/FriendFeedInfoMenu.kt</a></b>
<a href="#h34-0" id="h34-0" class="h">@@ -21,7 +21,7 @@ import me.rhunk.snapenhance.database.objects.FriendInfo
</a> import me.rhunk.snapenhance.database.objects.UserConversationLink
 import me.rhunk.snapenhance.features.impl.Messaging
 import me.rhunk.snapenhance.features.impl.downloader.AntiAutoDownload
<a href="#h34-0-3" id="h34-0-3" class="d">-import me.rhunk.snapenhance.features.impl.extras.AntiAutoSave
</a><a href="#h34-0-4" id="h34-0-4" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.AntiAutoSave
</a> import me.rhunk.snapenhance.features.impl.spying.StealthMode
 import me.rhunk.snapenhance.features.impl.ui.menus.AbstractMenu
 import me.rhunk.snapenhance.features.impl.ui.menus.ViewAppearanceHelper.applyTheme
<a href="#h34-1" id="h34-1" class="h">@@ -215,7 +215,7 @@ class FriendFeedInfoMenu : AbstractMenu() {
</a> 
         run {
             val userId = context.database.getFriendFeedInfoByConversationId(conversationId)?.friendUserId ?: return@run
<a href="#h34-1-3" id="h34-1-3" class="d">-            if (context.config.bool(ConfigProperty.ANTI_DOWNLOAD_BUTTON)) {
</a><a href="#h34-1-4" id="h34-1-4" class="i">+            if (context.config.bool(ConfigProperty.DOWNLOAD_BLACKLIST)) {
</a>                 createToggleFeature(viewModel,
                     viewConsumer,
                     &quot;friend_menu_option.anti_auto_download&quot;,
<b>diff --git a/<a id="h35" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/features/impl/ui/menus/impl/SettingsMenu.kt</a></b>
<a href="#h35-0" id="h35-0" class="h">@@ -35,10 +35,11 @@ class SettingsMenu : AbstractMenu() {
</a>     @SuppressLint(&quot;SetTextI18n&quot;)
     private fun createPropertyView(viewModel: View, property: ConfigProperty): View {
         val updateButtonText: (TextView, String) -&gt; Unit = { textView, text -&gt;
<a href="#h35-0-3" id="h35-0-3" class="d">-            textView.text = &quot;${context.translation.get(property.nameKey)} $text&quot;
</a><a href="#h35-0-4" id="h35-0-4" class="i">+            textView.text = &quot;${context.translation.get(property.nameKey)}${if (text.isEmpty()) &quot;&quot; else &quot;: $text&quot;}&quot;
</a>         }
<a href="#h35-0-6" id="h35-0-6" class="d">-        val updateStateSelectionText: (TextView, String) -&gt; Unit = { textView, text -&gt;
</a><a href="#h35-0-7" id="h35-0-7" class="d">-            updateButtonText(textView, text.let { if (it.isEmpty()) &quot;(empty)&quot; else &quot;: $it&quot; })
</a><a href="#h35-0-8" id="h35-0-8" class="i">+
</a><a href="#h35-0-9" id="h35-0-9" class="i">+        val updateLocalizedText: (TextView, String) -&gt; Unit = { textView, value -&gt;
</a><a href="#h35-0-10" id="h35-0-10" class="i">+            updateButtonText(textView, value.let { if (it.isEmpty()) &quot;(empty)&quot; else context.translation.get(&quot;option.&quot; + property.nameKey + &quot;.&quot; + it) })
</a>         }
 
         val textEditor: ((String) -&gt; Unit) -&gt; Unit = { updateValue -&gt;
<a href="#h35-1" id="h35-1" class="h">@@ -61,23 +62,29 @@ class SettingsMenu : AbstractMenu() {
</a>         val resultView: View = when (property.valueContainer) {
             is ConfigStringValue -&gt; {
                 val textView = TextView(viewModel.context)
<a href="#h35-1-3" id="h35-1-3" class="d">-                updateButtonText(textView, property.valueContainer.value)
</a><a href="#h35-1-4" id="h35-1-4" class="i">+                updateButtonText(textView, property.valueContainer.let {
</a><a href="#h35-1-5" id="h35-1-5" class="i">+                    if (it.isHidden) it.hiddenValue()
</a><a href="#h35-1-6" id="h35-1-6" class="i">+                    else it.value()
</a><a href="#h35-1-7" id="h35-1-7" class="i">+                })
</a>                 ViewAppearanceHelper.applyTheme(viewModel, textView)
                 textView.setOnClickListener {
                     textEditor { value -&gt;
<a href="#h35-1-11" id="h35-1-11" class="d">-                        property.valueContainer.value = value
</a><a href="#h35-1-12" id="h35-1-12" class="d">-                        updateButtonText(textView, value)
</a><a href="#h35-1-13" id="h35-1-13" class="i">+                        property.valueContainer.writeFrom(value)
</a><a href="#h35-1-14" id="h35-1-14" class="i">+                        updateButtonText(textView, property.valueContainer.let {
</a><a href="#h35-1-15" id="h35-1-15" class="i">+                            if (it.isHidden) it.hiddenValue()
</a><a href="#h35-1-16" id="h35-1-16" class="i">+                            else it.value()
</a><a href="#h35-1-17" id="h35-1-17" class="i">+                        })
</a>                     }
                 }
                 textView
             }
             is ConfigIntegerValue -&gt; {
                 val button = Button(viewModel.context)
<a href="#h35-1-24" id="h35-1-24" class="d">-                updateButtonText(button, property.valueContainer.value.toString())
</a><a href="#h35-1-25" id="h35-1-25" class="i">+                updateButtonText(button, property.valueContainer.value().toString())
</a>                 button.setOnClickListener {
                     textEditor { value -&gt;
                         runCatching {
<a href="#h35-1-29" id="h35-1-29" class="d">-                            property.valueContainer.value = value.toInt()
</a><a href="#h35-1-30" id="h35-1-30" class="i">+                            property.valueContainer.writeFrom(value)
</a>                             updateButtonText(button, value)
                         }.onFailure {
                             context.shortToast(&quot;Invalid value&quot;)
<a href="#h35-2" id="h35-2" class="h">@@ -90,30 +97,30 @@ class SettingsMenu : AbstractMenu() {
</a>             is ConfigStateValue -&gt; {
                 val switch = Switch(viewModel.context)
                 switch.text = context.translation.get(property.nameKey)
<a href="#h35-2-3" id="h35-2-3" class="d">-                switch.isChecked = property.valueContainer.value
</a><a href="#h35-2-4" id="h35-2-4" class="i">+                switch.isChecked = property.valueContainer.value()
</a>                 switch.setOnCheckedChangeListener { _, isChecked -&gt;
<a href="#h35-2-6" id="h35-2-6" class="d">-                    property.valueContainer.value = isChecked
</a><a href="#h35-2-7" id="h35-2-7" class="i">+                    property.valueContainer.writeFrom(isChecked.toString())
</a>                 }
                 ViewAppearanceHelper.applyTheme(viewModel, switch)
                 switch
             }
             is ConfigStateSelection -&gt; {
                 val button = Button(viewModel.context)
<a href="#h35-2-14" id="h35-2-14" class="d">-                updateStateSelectionText(button, property.valueContainer.value())
</a><a href="#h35-2-15" id="h35-2-15" class="i">+                updateLocalizedText(button, property.valueContainer.value())
</a> 
                 button.setOnClickListener {_ -&gt;
                     val builder = AlertDialog.Builder(viewModel.context)
                     builder.setTitle(context.translation.get(property.nameKey))
 
                     builder.setSingleChoiceItems(
<a href="#h35-2-22" id="h35-2-22" class="d">-                        property.valueContainer.keys().toTypedArray(),
</a><a href="#h35-2-23" id="h35-2-23" class="i">+                        property.valueContainer.keys().toTypedArray().map { context.translation.get(&quot;option.&quot; + property.nameKey + &quot;.&quot; + it) }.toTypedArray(),
</a>                         property.valueContainer.keys().indexOf(property.valueContainer.value())
                     ) { _, which -&gt;
<a href="#h35-2-26" id="h35-2-26" class="d">-                        property.valueContainer.value(property.valueContainer.keys()[which])
</a><a href="#h35-2-27" id="h35-2-27" class="i">+                        property.valueContainer.writeFrom(property.valueContainer.keys()[which])
</a>                     }
 
                     builder.setPositiveButton(&quot;OK&quot;) { _, _ -&gt;
<a href="#h35-2-31" id="h35-2-31" class="d">-                        updateStateSelectionText(button, property.valueContainer.value())
</a><a href="#h35-2-32" id="h35-2-32" class="i">+                        updateLocalizedText(button, property.valueContainer.value())
</a>                     }
 
                     builder.show()
<a href="#h35-3" id="h35-3" class="h">@@ -123,25 +130,25 @@ class SettingsMenu : AbstractMenu() {
</a>             }
             is ConfigStateListValue -&gt; {
                 val button = Button(viewModel.context)
<a href="#h35-3-3" id="h35-3-3" class="d">-                updateStateSelectionText(button, property.valueContainer.toString())
</a><a href="#h35-3-4" id="h35-3-4" class="i">+                updateButtonText(button, &quot;(${property.valueContainer.value().count { it.value }})&quot;)
</a> 
                 button.setOnClickListener {_ -&gt;
                     val builder = AlertDialog.Builder(viewModel.context)
                     builder.setTitle(context.translation.get(property.nameKey))
 
<a href="#h35-3-10" id="h35-3-10" class="d">-                    val sortedStates = property.valueContainer.states.toSortedMap()
</a><a href="#h35-3-11" id="h35-3-11" class="i">+                    val sortedStates = property.valueContainer.value().toSortedMap()
</a> 
                     builder.setMultiChoiceItems(
                         sortedStates.toSortedMap().map { context.translation.get(&quot;option.&quot; + property.nameKey + &quot;.&quot; +it.key) }.toTypedArray(),
                         sortedStates.map { it.value }.toBooleanArray()
                     ) { _, which, isChecked -&gt;
                         sortedStates.keys.toList()[which].let { key -&gt;
<a href="#h35-3-18" id="h35-3-18" class="d">-                            property.valueContainer.states[key] = isChecked
</a><a href="#h35-3-19" id="h35-3-19" class="i">+                            property.valueContainer.setKey(key, isChecked)
</a>                         }
                     }
 
                     builder.setPositiveButton(&quot;OK&quot;) { _, _ -&gt;
<a href="#h35-3-24" id="h35-3-24" class="d">-                        updateStateSelectionText(button, property.valueContainer.toString())
</a><a href="#h35-3-25" id="h35-3-25" class="i">+                        updateButtonText(button, &quot;(${property.valueContainer.value().count { it.value }})&quot;)
</a>                     }
 
                     builder.show()
<a href="#h35-4" id="h35-4" class="h">@@ -191,15 +198,15 @@ class SettingsMenu : AbstractMenu() {
</a>             it.key.category
         }.forEach { (category, value) -&gt;
             addView(createCategoryTitle(viewModel, category.key))
<a href="#h35-4-3" id="h35-4-3" class="d">-            value.forEach {
</a><a href="#h35-4-4" id="h35-4-4" class="d">-                addView(createPropertyView(viewModel, it.key))
</a><a href="#h35-4-5" id="h35-4-5" class="d">-                actions.find { pair -&gt; pair.first.dependsOnProperty == it.key }?.let { pair -&gt;
</a><a href="#h35-4-6" id="h35-4-6" class="i">+            value.filter { it.key.shouldAppearInSettings }.forEach { (property, _) -&gt;
</a><a href="#h35-4-7" id="h35-4-7" class="i">+                addView(createPropertyView(viewModel, property))
</a><a href="#h35-4-8" id="h35-4-8" class="i">+                actions.find { pair -&gt; pair.first.dependsOnProperty == property}?.let { pair -&gt;
</a>                     addView(pair.second())
                 }
             }
         }
 
<a href="#h35-4-14" id="h35-4-14" class="d">-        addView(createCategoryTitle(viewModel, &quot;category.debugging&quot;))
</a><a href="#h35-4-15" id="h35-4-15" class="i">+        //addView(createCategoryTitle(viewModel, &quot;category.debugging&quot;))
</a>         actions.filter { it.first.dependsOnProperty == null }.forEach {
             addView(it.second())
         }
<b>diff --git a/<a id="h36" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/ConfigManager.kt</a></b>
<a href="#h36-0" id="h36-0" class="h">@@ -41,14 +41,14 @@ class ConfigManager(
</a>             JsonObject::class.java
         )
         entries().forEach { (key, value) -&gt;
<a href="#h36-0-3" id="h36-0-3" class="d">-            value.read(configObject.get(key.name)?.asString ?: value.write())
</a><a href="#h36-0-4" id="h36-0-4" class="i">+            value.writeFrom(configObject.get(key.name)?.asString ?: value.read())
</a>         }
     }
 
     fun writeConfig() {
         val configObject = JsonObject()
         entries().forEach { (key, value) -&gt;
<a href="#h36-0-11" id="h36-0-11" class="d">-            configObject.addProperty(key.name, value.write())
</a><a href="#h36-0-12" id="h36-0-12" class="i">+            configObject.addProperty(key.name, value.read())
</a>         }
         context.bridgeClient.writeFile(
             BridgeFileType.CONFIG,
<b>diff --git a/<a id="h37" href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a> b/<a href="../file/app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt.html">app/src/main/kotlin/me/rhunk/snapenhance/manager/impl/FeatureManager.kt</a></b>
<a href="#h37-0" id="h37-0" class="h">@@ -10,15 +10,15 @@ import me.rhunk.snapenhance.features.impl.downloader.AntiAutoDownload
</a> import me.rhunk.snapenhance.features.impl.downloader.MediaDownloader
 import me.rhunk.snapenhance.features.impl.experiments.AppPasscode
 import me.rhunk.snapenhance.features.impl.experiments.MeoPasscodeBypass
<a href="#h37-0-3" id="h37-0-3" class="d">-import me.rhunk.snapenhance.features.impl.extras.AntiAutoSave
</a><a href="#h37-0-4" id="h37-0-4" class="d">-import me.rhunk.snapenhance.features.impl.extras.AutoSave
</a><a href="#h37-0-5" id="h37-0-5" class="d">-import me.rhunk.snapenhance.features.impl.extras.DisableVideoLengthRestriction
</a><a href="#h37-0-6" id="h37-0-6" class="d">-import me.rhunk.snapenhance.features.impl.extras.GalleryMediaSendOverride
</a><a href="#h37-0-7" id="h37-0-7" class="d">-import me.rhunk.snapenhance.features.impl.extras.LocationSpoofer
</a><a href="#h37-0-8" id="h37-0-8" class="d">-import me.rhunk.snapenhance.features.impl.extras.MediaQualityLevelOverride
</a><a href="#h37-0-9" id="h37-0-9" class="d">-import me.rhunk.snapenhance.features.impl.extras.Notifications
</a><a href="#h37-0-10" id="h37-0-10" class="d">-import me.rhunk.snapenhance.features.impl.extras.SnapchatPlus
</a><a href="#h37-0-11" id="h37-0-11" class="d">-import me.rhunk.snapenhance.features.impl.extras.UnlimitedSnapViewTime
</a><a href="#h37-0-12" id="h37-0-12" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.AntiAutoSave
</a><a href="#h37-0-13" id="h37-0-13" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.AutoSave
</a><a href="#h37-0-14" id="h37-0-14" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.DisableVideoLengthRestriction
</a><a href="#h37-0-15" id="h37-0-15" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.GalleryMediaSendOverride
</a><a href="#h37-0-16" id="h37-0-16" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.LocationSpoofer
</a><a href="#h37-0-17" id="h37-0-17" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.MediaQualityLevelOverride
</a><a href="#h37-0-18" id="h37-0-18" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.Notifications
</a><a href="#h37-0-19" id="h37-0-19" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.SnapchatPlus
</a><a href="#h37-0-20" id="h37-0-20" class="i">+import me.rhunk.snapenhance.features.impl.tweaks.UnlimitedSnapViewTime
</a> import me.rhunk.snapenhance.features.impl.privacy.DisableMetrics
 import me.rhunk.snapenhance.features.impl.privacy.PreventMessageSending
 import me.rhunk.snapenhance.features.impl.spying.AnonymousStoryViewing
<b>diff --git a/<a id="h38" href="../file/app/src/main/res/layout/map.xml.html">app/src/main/res/layout/map.xml</a> b/<a href="../file/app/src/main/res/layout/map.xml.html">app/src/main/res/layout/map.xml</a></b>
<a href="#h38-0" id="h38-0" class="h">@@ -11,15 +11,34 @@
</a> 
     &lt;/org.osmdroid.views.MapView&gt;
 
<a href="#h38-0-3" id="h38-0-3" class="d">-    &lt;Button
</a><a href="#h38-0-4" id="h38-0-4" class="d">-        android:id=&quot;@+id/apply_location_button&quot;
</a><a href="#h38-0-5" id="h38-0-5" class="d">-        android:layout_width=&quot;wrap_content&quot;
</a><a href="#h38-0-6" id="h38-0-6" class="d">-        android:layout_height=&quot;wrap_content&quot;
</a><a href="#h38-0-7" id="h38-0-7" class="d">-        android:layout_gravity=&quot;bottom|right&quot;
</a><a href="#h38-0-8" id="h38-0-8" class="d">-        android:layout_marginEnd=&quot;20dp&quot;
</a><a href="#h38-0-9" id="h38-0-9" class="d">-        android:layout_marginBottom=&quot;20dp&quot;
</a><a href="#h38-0-10" id="h38-0-10" class="d">-        android:textSize=&quot;20sp&quot;
</a><a href="#h38-0-11" id="h38-0-11" class="d">-        android:background=&quot;@android:color/white&quot;
</a><a href="#h38-0-12" id="h38-0-12" class="d">-        android:text=&quot;Apply&quot;
</a><a href="#h38-0-13" id="h38-0-13" class="d">-        tools:ignore=&quot;HardcodedText,RtlHardcoded&quot; /&gt;
</a><a href="#h38-0-14" id="h38-0-14" class="i">+    &lt;FrameLayout
</a><a href="#h38-0-15" id="h38-0-15" class="i">+        android:layout_width=&quot;match_parent&quot;
</a><a href="#h38-0-16" id="h38-0-16" class="i">+        android:layout_height=&quot;wrap_content&quot;&gt;
</a><a href="#h38-0-17" id="h38-0-17" class="i">+
</a><a href="#h38-0-18" id="h38-0-18" class="i">+        &lt;Button
</a><a href="#h38-0-19" id="h38-0-19" class="i">+            android:id=&quot;@+id/set_precise_location_button&quot;
</a><a href="#h38-0-20" id="h38-0-20" class="i">+            android:layout_width=&quot;wrap_content&quot;
</a><a href="#h38-0-21" id="h38-0-21" class="i">+            android:layout_height=&quot;match_parent&quot;
</a><a href="#h38-0-22" id="h38-0-22" class="i">+            android:layout_gravity=&quot;left&quot;
</a><a href="#h38-0-23" id="h38-0-23" class="i">+            android:layout_marginStart=&quot;20dp&quot;
</a><a href="#h38-0-24" id="h38-0-24" class="i">+            android:layout_marginTop=&quot;20dp&quot;
</a><a href="#h38-0-25" id="h38-0-25" class="i">+            android:padding=&quot;10dp&quot;
</a><a href="#h38-0-26" id="h38-0-26" class="i">+            android:background=&quot;@android:color/white&quot;
</a><a href="#h38-0-27" id="h38-0-27" class="i">+            android:text=&quot;Set Precise Location&quot;
</a><a href="#h38-0-28" id="h38-0-28" class="i">+            android:textSize=&quot;20sp&quot;
</a><a href="#h38-0-29" id="h38-0-29" class="i">+            tools:ignore=&quot;HardcodedText,RtlHardcoded&quot; /&gt;
</a><a href="#h38-0-30" id="h38-0-30" class="i">+
</a><a href="#h38-0-31" id="h38-0-31" class="i">+        &lt;Button
</a><a href="#h38-0-32" id="h38-0-32" class="i">+            android:id=&quot;@+id/apply_location_button&quot;
</a><a href="#h38-0-33" id="h38-0-33" class="i">+            android:layout_width=&quot;wrap_content&quot;
</a><a href="#h38-0-34" id="h38-0-34" class="i">+            android:layout_height=&quot;wrap_content&quot;
</a><a href="#h38-0-35" id="h38-0-35" class="i">+            android:layout_gravity=&quot;right&quot;
</a><a href="#h38-0-36" id="h38-0-36" class="i">+            android:layout_marginTop=&quot;20dp&quot;
</a><a href="#h38-0-37" id="h38-0-37" class="i">+            android:layout_marginRight=&quot;20dp&quot;
</a><a href="#h38-0-38" id="h38-0-38" class="i">+            android:background=&quot;@android:color/white&quot;
</a><a href="#h38-0-39" id="h38-0-39" class="i">+            android:text=&quot;Apply&quot;
</a><a href="#h38-0-40" id="h38-0-40" class="i">+            android:textSize=&quot;20sp&quot;
</a><a href="#h38-0-41" id="h38-0-41" class="i">+            tools:ignore=&quot;HardcodedText,RtlHardcoded&quot; /&gt;
</a><a href="#h38-0-42" id="h38-0-42" class="i">+    &lt;/FrameLayout&gt;
</a><a href="#h38-0-43" id="h38-0-43" class="i">+
</a> &lt;/FrameLayout&gt;
<b>diff --git a/<a id="h39" href="../file/app/src/main/res/layout/precise_location_dialog.xml.html">app/src/main/res/layout/precise_location_dialog.xml</a> b/<a href="../file/app/src/main/res/layout/precise_location_dialog.xml.html">app/src/main/res/layout/precise_location_dialog.xml</a></b>
<a href="#h39-0" id="h39-0" class="h">@@ -0,0 +1,28 @@
</a><a href="#h39-0-0" id="h39-0-0" class="i">+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
</a><a href="#h39-0-1" id="h39-0-1" class="i">+&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
</a><a href="#h39-0-2" id="h39-0-2" class="i">+    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
</a><a href="#h39-0-3" id="h39-0-3" class="i">+    android:layout_width=&quot;match_parent&quot;
</a><a href="#h39-0-4" id="h39-0-4" class="i">+    android:layout_height=&quot;match_parent&quot;
</a><a href="#h39-0-5" id="h39-0-5" class="i">+    android:padding=&quot;20dp&quot;
</a><a href="#h39-0-6" id="h39-0-6" class="i">+    android:orientation=&quot;vertical&quot;
</a><a href="#h39-0-7" id="h39-0-7" class="i">+    tools:ignore=&quot;HardcodedText&quot;&gt;
</a><a href="#h39-0-8" id="h39-0-8" class="i">+
</a><a href="#h39-0-9" id="h39-0-9" class="i">+    &lt;EditText
</a><a href="#h39-0-10" id="h39-0-10" class="i">+        android:id=&quot;@+id/dialog_latitude&quot;
</a><a href="#h39-0-11" id="h39-0-11" class="i">+        android:layout_width=&quot;match_parent&quot;
</a><a href="#h39-0-12" id="h39-0-12" class="i">+        android:layout_height=&quot;wrap_content&quot;
</a><a href="#h39-0-13" id="h39-0-13" class="i">+        android:ems=&quot;10&quot;
</a><a href="#h39-0-14" id="h39-0-14" class="i">+        android:inputType=&quot;numberDecimal&quot;
</a><a href="#h39-0-15" id="h39-0-15" class="i">+        android:hint=&quot;Latitude&quot;
</a><a href="#h39-0-16" id="h39-0-16" class="i">+        android:autofillHints=&quot;&quot; /&gt;
</a><a href="#h39-0-17" id="h39-0-17" class="i">+
</a><a href="#h39-0-18" id="h39-0-18" class="i">+    &lt;EditText
</a><a href="#h39-0-19" id="h39-0-19" class="i">+        android:id=&quot;@+id/dialog_longitude&quot;
</a><a href="#h39-0-20" id="h39-0-20" class="i">+        android:layout_width=&quot;match_parent&quot;
</a><a href="#h39-0-21" id="h39-0-21" class="i">+        android:layout_height=&quot;wrap_content&quot;
</a><a href="#h39-0-22" id="h39-0-22" class="i">+        android:ems=&quot;10&quot;
</a><a href="#h39-0-23" id="h39-0-23" class="i">+        android:inputType=&quot;numberDecimal&quot;
</a><a href="#h39-0-24" id="h39-0-24" class="i">+        android:hint=&quot;Longitude&quot;
</a><a href="#h39-0-25" id="h39-0-25" class="i">+        android:autofillHints=&quot;&quot; /&gt;
</a><a href="#h39-0-26" id="h39-0-26" class="i">+
</a><a href="#h39-0-27" id="h39-0-27" class="i">+&lt;/LinearLayout&gt;</a><a href="#h39-0-28" id="h39-0-28" class="i">+
\ No newline at end of file
</a></pre>
</div>
</body>
</html>
